# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
pkgname=emacs-rudel-bzr
pkgver=632
pkgrel=1
pkgdesc="A collaborative editing environment for GNU Emacs"
arch=('any')
url="http://www.emacswiki.org/emacs/Rudel"
license=('GPL')
depends=('emacs' 'cedet')
makedepends=('bzr')
provides=('emacs-rudel')
conflicts=('emacs-rudel-git' 'emacs-rudel-svn')
install=$pkgname.install 

_bzrtrunk="bzr://rudel.bzr.sourceforge.net/bzrroot/rudel/trunk"
_bzrmod="rudel"

build() {
  cd "$srcdir"
  msg "Connecting to Bazaar server..."

  if [[ -d $_bzrmod/.bzr ]]; then
    (cd $_bzrmod && bzr update -v && cd ..)
    msg "Local checkout updated or server timeout"
  else
    bzr co --lightweight -v $_bzrtrunk $_bzrmod
    msg "Checkout done or server timeout"
  fi
  
  msg "Bazaar checkout done or server timeout"
  msg "Starting make..."

  [ -d "$srcdir/$_bzrmod-build" ] && rm -rf "$srcdir/$_bzrmod-build"
  cp -r "$srcdir/$_bzrmod" "$srcdir/$_bzrmod-build"
  cd "$srcdir/$_bzrmod-build"

  #
  # BUILD HERE
  #

  emacs --script rudel-compile.el 
}

package() {
  install -d $pkgdir/usr/share/emacs/site-lisp/rudel
  cd "$srcdir/$_bzrmod-build"
  cp -a * $pkgdir/usr/share/emacs/site-lisp/rudel
}
