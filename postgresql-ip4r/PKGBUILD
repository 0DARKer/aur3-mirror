# Maintainer: Alex "grevus" Lobtsov <dessander@gmail.com>
pkgname=postgresql-ip4r
pkgver=2.0
pkgrel=1
pkgdesc="ip4r support for postgresql"
url="http://ip4r.projects.pgfoundry.org/"
arch=('x86_64' 'i686')
license=('BSD')
depends=(
    'postgresql>=9.2'
)
makedepends=()

_pkg_name=ip4r-extension

source=(
    'ip4r.tgz::http://pgfoundry.org/frs/download.php/3383/$_pkg_name-$pkgver.tgz'
)
md5sums=(
    'a17d5b5314eba314ef9d255cf16e48bd'
)

conflicts=()

build() {
    cd "${srcdir}/${_pkg_name}-${pkgver}"

    make || return 1
    make DESTDIR="${srcdir}/pkg-all" install || return 1
}

package() {
    mkdir -p ${pkgdir}/usr/lib/postgresql
    mkdir -p ${pkgdir}/usr/share/postgresql/extension
    mkdir -p ${pkgdir}/usr/share/doc/postgresql/extension

    cp -p ${srcdir}/pkg-all/usr/lib/postgresql/ip4r.so ${pkgdir}/usr/lib/postgresql/ || return 1

    cp -p ${srcdir}/pkg-all/usr/share/postgresql/extension/ip4r--2.0.sql \
          ${srcdir}/pkg-all/usr/share/postgresql/extension/ip4r--unpackaged1--2.0.sql \
          ${srcdir}/pkg-all/usr/share/postgresql/extension/ip4r--unpackaged2.0--2.0.sql \
          ${srcdir}/pkg-all/usr/share/postgresql/extension/ip4r.control \
          ${pkgdir}/usr/share/postgresql/extension/ || return 1

    cp -p ${srcdir}/pkg-all/usr/share/doc/postgresql/extension/README.ip4r \
          ${pkgdir}/usr/share/doc/postgresql/extension/ || return 1
}
