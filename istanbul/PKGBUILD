# Maintainer: Limao Luo <luolimao@gmail.com>
# Contributor: SÃ©bastien Luttringer <seblu@aur.archlinux.org>
# Contributor: Angel 'angvp' Velasquez <angvp@archlinux.com.ve>

pkgname=istanbul
pkgver=0.2.2
pkgrel=8
pkgdesc='Desktop Session Recorder'
arch=(i686 x86_64)
url='http://live.gnome.org/Istanbul'
license=(GPL2)
depends=(gnome-python-extras gstreamer0.10-base-plugins
    gstreamer0.10-python pygtk python2-gconf python-xlib)
makedepends=(intltool)
options=(!libtool)
install=$pkgname.install
source=(http://zaheer.merali.org/$pkgname-$pkgver.tar.bz2
    00-audio_eos.patch
    01-python-import.patch
    02-window-record.patch
    03-manpage.patch
    04-desktop-entry.patch
    05-honour-umask.patch
    06-eggtrayicon-removal.patch
    07-fix_grab_xid.patch
    08-fix_preview_window.patch
    09-dir-overwrite.patch
    10-kfreebsd-noalsa.patch
    11-URI_exception.patch)
sha256sums=('3baa2462ecf1b13d0d95cd035fe0f0fc0fcc3df8cb04a3b7f237e90e9a40acd5'
    'd31da7ddaeef9c0cf725c9bf9c824208c26ad84e59c88d015c78bf81b7e0ec8a'
    'ae1ade21362af451b350d813585e53b89d817c711461e1c39ce0ec229b262cf4'
    '325a8cd96731ac0096864105866b5a894bf7441625e154e2826abedb74a70174'
    'faeac21acdfb4e6264511012714f5c4fd356369cad71d83f0c54a01b9fdccd97'
    '8c44bb605848072cdee1db4fc702a3809bdf66b7e1c147941c769e2122164dbc'
    '480d4144ec7f30be0ac530bd45c21d840c7177fb2c97fc0281d2cdde9bd677e1'
    'af6de18022f16b0009c371ee4e19c24238fbbed678d9afc14492ca5b02246f52'
    'aae8c26d094e9e8ea130db0203138d370b741a9c8a28cd911d1dc060a291ee5c'
    '4cd9a64dd43a9c6698c2a4c48baf4918f5a0717b5c2aebdd961aa19426e8ad9a'
    'ce992726fe0c4c4b09608f608d97c464389f93a2a66b95029327349ecfe30c8e'
    '73a92464827c74254e89f995c84408f36ffc0b6c6fe167b195d2ef89aebf6d88'
    '72faeee07b002f54b3be9496ae05253e437992401e3813d5a62f23df7dbd5cc9')
sha512sums=('b7d5b99cb3860414f4139fd1fa887e4d58f99fc5c94f9d24d7a96f03e82ec7338d733e3ab7d8b8db6ae2c00f69aa48a099b957a23e3827c7d6505ab92bbb5c60'
    '1a8d803d20099a56fab490a488fd31995529c50c38f4f5bb61b9763dfabe26e1129e02402ed2693b31c1f01f3bb6a5d9f4062c778886327484acfb4889c6068f'
    'f1ab9cb98a7503f616bcfcdf1d6c801829152059a0998b71c9562255ea06cbded384c5e6949c38b763f758834f4b20831b8e3283ad93ada1f369c4d2bd285bee'
    '997b1676b0c7836f6c7bc70d19af938832bb7ca9b0e1ba204d632e12a6af38ba6d0607e55e005edfa636c03a329d6e6b06901039ed7d7aac11984b2ef2ee0803'
    'e3d4d4f6837e2f03ef53ce678c9204146a391f6a1b9cf9fa93ef2fb861235fadc1cc9af9520832f4c89f6824abc111425328d4e9dd31fca2365b13861b72a43d'
    'ca3c586036547c24cd93da8865a3cb4d4a2fd774f5f64dfa1e797754acc479f799793e3688e03a325145736e03992ae212eae4dc841846827e73f9e5370e0040'
    'b472c4c568bb2daeedfbfb833defe0ac2428942acfa32d4a1d46514b39938d2de0b8f5df71c7854ef5e0912e951e682b341641a6cfe54e030fa1da4a2b2aadda'
    'f56d0cb71a368a50873b134bfc45bef53b663b3e011efff8882ef3f145df40a3f8bcef88f0cbb65d8984dc951cd2307e03d2fa79d54dc7ddb0ca94054de558b0'
    'f953da646c928d72d1552d63c43a279f696065516e2756ea453d0d2a9b84d31e0b57882f0b44dad101fb403f7ea1d432503b7fde1976d67a71ecc3ed74c3c8f1'
    'bd97d40b1a875c633812ac4f31a965eddb5a67514dcae18d32a7bc4799f6fae09e4f335076c2aaee8e48e2cff26aed51d1aca5c892d45551da828fb3c520d5d3'
    'ee000849efd41b74b939e03e80d2c0235765575adfe2d5a406ffcaa0223ed5bd603f78104ea774a2f3c095ad3e53655da9770ff7a6665564138f0de26f235d2f'
    '298d60403be66612909238db9e54711aa8c5802e0f19060dd8e13af16a1a4a2f1b8d002b914ce4b414a16a093030cbba1b35ed1d6aa885f893848066e8d67f03'
    'd564a518a7f1e74c21fcf2cce96e6113b1ddd7bce5a786657b1ea28b840f3d56ebb1518ae660dbc6b91a4c40d27188cca4ff9f8797ca9949f686e119700a8c07')

build() {
    shopt -s nullglob
    cd "$srcdir"/$pkgname-$pkgver
    msg "Patching..."
    sed -i 's:/usr/bin/python:&2:' bin/istanbul.in
    for p in "$srcdir"/??-*.patch; do
        msg2 "Applying ${p##*/}"
        patch -Np1 -i "$p"
    done
    ./configure --prefix=/usr \
        --sysconfdir=/etc  \
        --disable-schemas-install \
        --with-gconf-schema-file-dir=/usr/share/gconf/schemas
    make
}

package() {
    cd "$srcdir"/$pkgname-$pkgver/
    # fix crazy python module compiling
    cp py-compile common/py-compile-destdir
    make DESTDIR="$pkgdir" install

    install -d "$pkgdir"/usr/share/gconf/schemas
    gconf-merge-schema "$pkgdir"/usr/share/gconf/schemas/$pkgname.schemas "$pkgdir"/usr/etc/gconf/schemas/*.schemas
    rm -f "$pkgdir"/usr/etc/gconf/schemas/*.schemas
}
