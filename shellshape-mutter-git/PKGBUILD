# Maintainer:  Jussi Timperi <jussi.timperi at gmail dot com>
# Contributor: Jan "heftig" Steffens <jan.steffens@gmail.com>
# Contributor: Ionut Biru <ibiru@archlinux.org>
# Contributor: Michael Kanis <mkanis_at_gmx_dot_de>

pkgname=shellshape-mutter-git
pkgver=20110627
pkgrel=1
pkgdesc="A window manager for GNOME3, forked for shellshape"
arch=(i686 x86_64)
license=('GPL')
depends=('startup-notification' 'gconf' 'zenity' 'libcanberra' 'clutter' 'gobject-introspection')
makedepends=('intltool' 'gnome-doc-utils' 'git')
conflicts=('mutter' 'shellshape-mutter')
provides=('mutter' 'shellshape-mutter')
url="http://gfxmonk.net/shellshape/"
options=('!libtool' '!emptydirs')
install=mutter.install
source=()
sha256sums=()

_gitroot="git://github.com/gfxmonk/mutter.git"
_gitname="shellshape-mutter"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."
  
  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  ./autogen.sh --prefix=/usr --sysconfdir=/etc \
    --libexecdir=/usr/lib/mutter \
    --localstatedir=/var --disable-static
  make
}

package() {
  cd "${srcdir}/$_gitname-build"
  make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="${pkgdir}" install

  install -m755 -d "${pkgdir}/usr/share/gconf/schemas"
  gconf-merge-schema "${pkgdir}/usr/share/gconf/schemas/mutter.schemas" --domain mutter ${pkgdir}/etc/gconf/schemas/*.schemas
  rm -f ${pkgdir}/etc/gconf/schemas/*.schemas
}
