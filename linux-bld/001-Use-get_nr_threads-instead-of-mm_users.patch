From 4b8e37c4d9bf9cde0b68e2233d9b0cea41bffdc7 Mon Sep 17 00:00:00 2001
From: rakib <rakib.mullick@gmail.com>
Date: Wed, 14 May 2014 10:51:09 +0600
Subject: [PATCH]  Use get_nr_threads() instead of ->mm_users to get # of
 threads.

---
 kernel/sched/bld.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/kernel/sched/bld.h b/kernel/sched/bld.h
index d1e5631..ad251d5 100644
--- a/kernel/sched/bld.h
+++ b/kernel/sched/bld.h
@@ -131,7 +131,7 @@ static int bld_get_cpu(struct task_struct *p, int sd_flags, int wake_flags)
 {
 	unsigned int cpu;
 
-	if (sd_flags == SD_BALANCE_WAKE || (sd_flags == SD_BALANCE_EXEC && (p->mm && atomic_read(&p->mm->mm_users) > 1)))
+	if (sd_flags == SD_BALANCE_WAKE || (sd_flags == SD_BALANCE_EXEC && (get_nr_threads(p) > 1)))
 		cpu = bld_pick_cpu_domain(p, sd_flags, wake_flags);
 	else {
 		if (rt_task(p))
-- 
1.9.3

