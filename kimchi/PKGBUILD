# Maintainer: Dis McCarthy <aurarch@sigkill.net>
pkgname=kimchi
gitname=kimchi-1.1.0
pkgver=1.1.0
pkgrel=2

pkgdesc="HTML5 management for KVM"

arch=(any)

url="https://github.com/kimchi-project/kimchi"

license=('LGPL2.1' 'APACHE')

depends=('python2-cherrypy'
  'python2-cheetah'
  'libvirt-python'
  'python2-imaging'
  'pypam2-bzr'
  'python2-m2crypto'
  'python2-jsonschema'
  'qemu'
  'python2-psutil'
  'python2-ethtool'
  'python2-ipaddr'
  'python2-lxml'
  'open-iscsi'
  'lvm2'
  'python2-lxml'
)

makedepends=('git')

# User files that should be saved. They are kept as Pacnew and Pacsave Files
backup=('etc/kimchi/kimchi.conf')

source=("git+git://github.com/kimchi-project/kimchi.git#tag=${pkgname}-${pkgver}"
 "python2.patch"
 "quiet.patch"
 "kimchid.service"
)

md5sums=('SKIP' 
 '4b215fb07f64edd8c504fad04d85f2e8'
 '487c1e611c397f50c61a7933cef58ffb'
 '356d68fd7735c826c36cbde651ebd675'
)

build() {
  cd "$srcdir/${pkgname}"
  msg "Patching for python2"
  patch -p1 -i ../python2.patch
  msg "Patching for quieter logs"
  patch -p1 -i ../quiet.patch
  ./autogen.sh --prefix=/usr --sysconfdir=/etc --localstatedir=/var PYTHON=/usr/bin/python2
  make
}

package() {
  cd "$srcdir/${pkgname}"
  make DESTDIR=$pkgdir install
  # Systemd units
  install -Dm0644 ../kimchid.service "${pkgdir}/usr/lib/systemd/system/kimchid.service"
}
