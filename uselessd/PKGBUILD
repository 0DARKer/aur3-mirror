# Maintainer: Jack L. Frost <fbt@fleshless.org>
# vim: ft=sh syn=sh et

pkgdesc="A fork of systemd aiming to provide the init system parts of systemd only."
pkgname=( 'uselessd' 'libsystemd-uselessd' )
pkgver=5
pkgrel=1
arch=( 'i686' 'x86_64' )
url="http://uselessd.darknedgy.net"
license=( 'GPL2' 'LGPL2.1' 'MIT' )

makedepends=(
    'dbus' 'libcap' 'kmod' 'pam' 'acl' 'attr' 'python'
    'intltool' 'docbook-xsl' 'libxslt' 'gperf' 'linux-api-headers'
)

options=( 'strip' )
source=(
    "https://bitbucket.org/bcsd/uselessd/downloads/uselessd-${pkgver}.tar.xz"
    'uselessd.install'
)

md5sums=('6f4bdf5c71f89135a89a4648718b6a1d'
         'a0551c95d19ed6eaae35c8e2af58c987')

build() {
  cd "${pkgname}-${pkgver}"

  ./configure

  make
}

package_uselessd() {
    pkgdesc="A fork of systemd aiming to provide the init system parts of systemd only."
    license=( 'GPL2' 'LGPL2.1' 'MIT' )
    
    depends=(
        'acl' 'dbus' 'kmod' 'libcap' 'pam' 'device-mapper'
        'libsystemd-uselessd' 'util-linux'
    )

    provides=( "uselessd=${pkgver}" )
    conflicts=( "systemd" )

    install='uselessd.install'

    make -C "$pkgname-$pkgver" DESTDIR="$pkgdir" install

    # Package the libs separately
    install -dm755 "${srcdir}/_libsystemd/usr/lib"
    mv "$pkgdir"/usr/lib/libsystemd* "${srcdir}/_libsystemd/usr/lib"
}

package_libsystemd-uselessd() {
    pkgdesc="systemd client libraries (the uselessd version)"
    license=( 'GPL2' )

    provides=( 'libsystemd-id128.so' 'libsystemd-daemon.so' )

    mv "$srcdir/_libsystemd"/* "$pkgdir"
}
