# Maintainer: Kniyl <mathias dot ettinger at gmail dot com>

pkgname=xkaapi
pkgver=1.0_rc4
pkgrel=2
pkgdesc="C++ library that implements work stealing algorithm for multithreaded computation"
url="http://kaapi.gforge.inria.fr/dokuwiki/doku.php"
arch=('i686' 'x86_64')
license=('CeCILL')
depends=('glibc' 'hwloc')
source=('https://gforge.inria.fr/frs/download.php/28167/xkaapi-1.0-rc4.tar.gz'
        'kaapi++.patch')
md5sums=('370ea315850e3c5cbe64ba90835c024a'
         '25f23c1b3d772af0c212f2dce225066d')

build() {
  cd "${srcdir}"
  rm -rf ${pkgname}-build
  cp -r ${pkgname}-${pkgver//_/-} ${pkgname}-build

  msg "Applying patches..."
  patch -i kaapi++.patch ${pkgname}-build/api/kaapixx/kaapi++.h
	sed -i 's|  bool work_queue|  inline bool work_queue|g' \
		${pkgname}-build/api/kastl/kastl/kastl_workqueue.h 
  
  cd ${pkgname}-build

  msg "Starting make..."
#  ./bootstrap
  ./configure \
    --prefix=/usr \
    --enable-mode=release \
    --enable-api-kastl

  make
}

package() {
  cd ${pkgname}-build

  make DESTDIR="${pkgdir}" install
}
