# Maintainer: jsteel <jsteel at vorx dot com>

pkgname=lightning
pkgver=1.0
pkgrel=1
pkgdesc="An integrated calendar extension for Mozilla Thunderbird"
arch=('i686' 'x86_64')
url="http://www.mozilla.org/projects/calendar/lightning"
license=('MPL' 'GPL' 'LGPL')
depends=('thunderbird' 'libnotify')
makedepends=('unzip')
source=(http://releases.mozilla.org/pub/mozilla.org/calendar/$pkgname/releases/$pkgver/linux/$pkgname.xpi)
md5sums=('e1af536e4bdeb415b259c589912d6a25')

build() {
  mkdir -p $srcdir/$pkgname
  cd $srcdir/$pkgname
  unzip -o ../../$pkgname.xpi
}

package() {
  _emid=`grep em:id $srcdir/$pkgname/install.rdf | tail -n1 | sed 's/.*>\(.*\)<.*/\1/'`
  mkdir -p $pkgdir/usr/lib/thunderbird/extensions/$_emid
  cd $pkgdir/usr/lib/thunderbird/extensions/$_emid
  cp -R $srcdir/$pkgname/* .

  if [[ $(uname -m) == i686 ]]; then
    rm -rv $pkgdir/usr/lib/thunderbird/extensions/$_emid/components/Linux_x86_64-gcc3/
  else
    rm -rv $pkgdir/usr/lib/thunderbird/extensions/$_emid/components/Linux_x86-gcc3/
  fi

  find -type d -exec chmod 0755 \{\} \+
  find -type f -exec chmod 0644 \{\} \+
  find -name '*.so' -exec chmod 0644 \{\} \+
}
