# Maintainer: Peter Nguyen <peter.hieu.nguyen@gmail.com>
pkgname=mongrel2
pkgver=1.8.0
pkgrel=2
pkgdesc="A language agnostic web server for applications"
url="http://mongrel2.org"
license=("BSD")
arch=("i686" "x86_64")
depends=("sqlite3" "zeromq")

_gitroot='git://github.com/zedshaw/mongrel2.git'
_gitbranch='release/v1.8.0'
_gitname='v1.8.0'

build() {
    cd ${srcdir}

    msg "Cloning release branch of GIT repository..."
    if [[ -d ${srcdir}/${_gitname} ]] ; then  ## check if local git source directory is present
        cd ${srcdir}/${_gitname};  ## enter the local git source directory
        git pull origin;  ## update the local git source
        msg "The local files are updated..."
      else
        git clone -b ${_gitbranch} ${_gitroot} ${gitname};  ## obtain the git source from git
    fi
    msg "GIT checkout done."

    git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build; ## clone the git repo into a build directory
    cd ${srcdir}/${_gitname}-build;  ## enter the build directory

    msg2 "Starting make for: ${pkgname}";

    make clean && make; ## make mongrel2

    cd ${srcdir}/${_gitname}-build/tools/procer;
    make clean && make; ## make procer
}
 
package() {
    cd ${srcdir}/${_gitname}-build;
    make PREFIX="$pkgdir/usr" install;
 
    cd ${srcdir}/${_gitname}-build/tools/procer;
    make PREFIX="$pkgdir/usr" install;
}
