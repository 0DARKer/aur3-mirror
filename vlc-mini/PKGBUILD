# -*- shell-script -*-
#
# Contributor: Adrian C. <anrxc..sysphere.org>

basename=vlc
pkgname=vlc-mini
pkgver=2.0.1
pkgrel=1
pkgdesc="A MPEG, VCD, DVD and DivX player with minimal dependencies"
arch=("i686" "x86_64")
url="http://www.videolan.org/vlc/"
license=("GPL2")
depends=("libmad" "ffmpeg" "fribidi" "sysfsutils" "qt"
         "libdvdread" "libxml2" "libraw1394" "a52dec" "x264"
         "libmpeg2" "libv4l" "libavc1394" "live-media" "libxcb"
         "flac" "faad2")
makedepends=("pkgconfig" "live-media" "lirc-utils" "ncurses")
optdepends=("libdvdcss: for decoding encrypted DVDs"
            "lirc-utils: for lirc plugin"
            "ncurses: for ncurses interface support")
provides=("vlc")
conflicts=("vlc")
backup=("usr/share/vlc/http/.hosts"
        "usr/share/vlc/http/dialogs/.hosts")
options=("!libtool")
install="${pkgname}.install"
source=("http://download.videolan.org/pub/videolan/${basename}/${pkgver}/${basename}-${pkgver}.tar.xz")
md5sums=("5ad114755670e4881a2b35354e2f79bc")


build() {
  cd "${srcdir}/${basename}-${pkgver}"

# Source code build
  sed -i -e 's:truetype/freefont:TTF:g' modules/text_renderer/freetype.c
  ./configure --prefix=/usr \
              --enable-loader --enable-live555 \
              --enable-optimize-memory --enable-optimizations \
              --enable-sout --enable-dv --enable-dvdread --enable-vcd \
              --enable-libass --enable-mad --enable-qt4 --enable-vlc \
              --enable-a52 --enable-flac --enable-httpd --enable-realrtsp \
              --enable-vorbis --enable-ogg --enable-theora \
              --enable-xvideo --enable-xcb --enable-freetype --enable-fribidi \
              --enable-fontconfig --enable-libxml2 --enable-alsa --enable-screen \
              --enable-libmpeg2 --enable-faad --enable-vlm --enable-v4l2 \
              --enable-avcodec --enable-avformat --enable-x264 \
              --enable-lirc --enable-ncurses \
              --disable-udev --disable-dbus --disable-nls --disable-rpath --disable-mtp \
              --disable-dbus-control --disable-telepathy --disable-debug \
              --disable-gprof --disable-cprof --disable-run-as-root \
              --disable-coverage --disable-switcher --disable-shout \
              --disable-lua --disable-libproxy --disable-dvdnav --disable-oss \
              --disable-libcddb --disable-growl --disable-notify \
              --disable-taglib --disable-dc1394 --disable-pvr --disable-gnomevfs \
              --disable-dshow --disable-bda --disable-opencv --disable-smb \
              --disable-vcdx --disable-libtar --disable-dca \
              --disable-mkv --disable-mod --disable-mpc --disable-wma-fixed \
              --disable-gme --disable-swscale --disable-shine \
              --disable-postproc --disable-png --disable-fluidsynth \
              --disable-twolame --disable-quicktime --disable-real \
              --disable-dirac --disable-schroedinger --disable-opengl \
              --disable-zvbi --disable-telx --disable-tiger \
              --disable-kate --disable-glx --disable-tremor --disable-speex \
              --disable-sdl-image --disable-svg --disable-sdl \
              --disable-directx --disable-directfb --disable-pulse --disable-portaudio \
              --disable-aa --disable-caca --disable-wingdi \
              --disable-waveout --disable-macosx-audio --disable-jack --disable-upnp \
              --disable-skins2 --disable-fbosd --disable-visual \
              --disable-macosx --disable-xosd --disable-goom --disable-atmo \
              --disable-bonjour --disable-libgcrypt --disable-gnutls \
              --disable-remoteosd --disable-update-check --disable-loader
  CFLAGS="-fPIC"
  make
  make DESTDIR=${pkgdir}/ install

# Install icons
  for res in 16 32 48 128; do
    install -D -m644 ${srcdir}/vlc-${pkgver}/share/icons/${res}x${res}/vlc.png \
        ${pkgdir}/usr/share/icons/hicolor/${res}x${res}/apps/vlc.png
  done
}
