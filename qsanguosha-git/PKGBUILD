# Author: Moligaloo <Moligaloo@gmail.com>
# Maintainer: Vehiclee <>
# Contributor: Iven Day <ivenvd@gmail.com>
# Contributor: abf <zouxiaomingabf@gmail.com>

pkgname=qsanguosha-git
pkgver=20110131
pkgrel=1
pkgdesc="An open source online version of the famous board game Sanguosha"
arch=('i686' 'x86_64')
url="https://github.com/Moligaloo/QSanguosha"
license=('GPL2')
depends=('qt' 'irrklang' 'libircclient' 'plib')
makedepends=('gcc' 'make' 'git' 'swig')
optdepends=('pulseaudio:for run multi client')
source=('qsanguosha' 'qsanguosha.desktop' 'sgs.png')
conflicts=(qsanguosha)
provides=(qsanguosha)
install=qsanguosha.install
options=(!strip)
md5sums=('49ccb51ea1ba979f8c8b469b122f69d6'
         'bcec919dcee9ce523ab704eed670edc4'
         '47a4b4e51141e7fd7ed8e0198243dfc6')

_gitroot=http://github.com/Moligaloo/QSanguosha.git
_gitname=QSanguosha

build() {
    cd ${srcdir}
    if [ -d ${_gitname} ]; then
		cd ${_gitname} && git pull origin
	msg "The local files are updated."
    else
		git clone ${_gitroot}
		cd ${_gitname}
    fi
    msg "GIT checkout done or server timeout"
    msg "Starting make..."

	cd ${srcdir}/${_gitname}/swig
	sh swig.sh || return 1
	cd ${srcdir}/${_gitname}
	qmake || return 1
	make || return 1
	lrelease sanguosha.ts || return 1
	mkdir -p ${pkgdir}/opt/qsanguosha
	#cp -R {lib,god,font,fire,doc,audio,maneuvering,thicket,standard,yitian,wind,QSanguosha,qt_zh_CN.qm} ${pkgdir}/opt/qsanguosha/  || return 1
	cp -R {lib,font,doc,audio,QSanguosha,qt_zh_CN.qm,backdrop,image,lang,scenarios,lua,sanguosha.lua} ${pkgdir}/opt/qsanguosha/ || return 1
	install -D -m755 ${srcdir}/qsanguosha "${pkgdir}/usr/bin/qsanguosha" || return 1
	install -D -m644 ${srcdir}/qsanguosha.desktop "${pkgdir}/usr/share/applications/qsanguosha.desktop" || return 1
	install -D -m644 ${srcdir}/sgs.png "${pkgdir}/usr/share/pixmaps/QSanguosha.png" || return 1
	install -D -m644 ${srcdir}/${_gitname}/sanguosha.qm "${pkgdir}/opt/qsanguosha/sanguosha.qm" || return 1
}
 