# Maintainer: Jurij Podgor≈°ek <gismopwn at gmail dot com>
# Contributor: Joao Cordeiro <jlcordeiro at gmail dot com>

# Change this to 1 to install the graphical version (depends on opengl and sdl)
NOTEYE_GUI=1

pkgname=hydraslayer
pkgver=15.6
pkgrel=1
pkgdesc="Roguelike influenced by mathematical puzzles. In Hydra Slayer your task is to enter Hydra Nest and clear it."
arch=('i686' 'x86_64')
url="http://www.roguetemple.com/z/hydra.php"
license=('GPL2')
if [ $NOTEYE_GUI = 1 ]; then
  depends=('ncurses' 'gcc-libs' 'lua51' 'sdl_net' 'sdl_mixer' 'sdl_image' 'sdl' 'glu')
else 
  depends=('ncurses' 'gcc-libs' 'lua51')
fi
changelog=
source=(http://www.roguetemple.com/z/noteye-76.zip
        hydraslayer.sh
        Makefile.patch)
md5sums=('650d0fd56b6d5ba72527737596c92766'
         '857aac6353443f442a3a3a47ba6399cb'
         '87574b1a345c237c29145fba4ee061cb')

build() {

  _dest_dir=$pkgdir/usr/share/hydraslayer

  mkdir -p $_dest_dir || return 1

  if [ $NOTEYE_GUI = 1 ]; then
    patch "$srcdir/noteye/src/Makefile" Makefile.patch
    cd "$srcdir/noteye/src"
    make

    install -D -m 755 ../hydraslayer "$_dest_dir"
    install -D -m 755 ../noteye "$_dest_dir"
    install -D -m 744 ../common/dftconfig.noe "$_dest_dir/config.noe"
    install -D -m 755 ../libnoteye.so "$_dest_dir"
    mkdir -m 755 "$_dest_dir/user"

    target_dirs=('common' 'gfx' 'games')
    for tdir in ${target_dirs[@]}; do
      mkdir "$_dest_dir/$tdir"

      for file in $(ls ../$tdir); do
        if [ -f $file ]; then
          install -D -m 744 ../$tdir/$file "$_dest_dir/$tdir"
        else
          cp -r ../$tdir/$file "$_dest_dir/$tdir/$file"
          chmod 744 -R "$_dest_dir/$tdir/$file"
        fi
      done
    done
  else
    cd "$srcdir/noteye/hydra"
    make

    install -T -D -m 755 hydra "$_dest_dir/hydraslayer"
  fi

  install -T -D -m 755 "$srcdir/hydraslayer.sh" "$pkgdir/usr/bin/hydraslayer"

  chown -R :games $_dest_dir 
  chmod -R g+srw $_dest_dir
}

# vim:set ts=2 sw=2 et:
