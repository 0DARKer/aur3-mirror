# Maintainer: Jurij Podgor≈°ek <gismopwn at gmail dot com>
# Contributor: Joao Cordeiro <jlcordeiro at gmail dot com>

# Change this to 1 to install the graphical version (depends on opengl and sdl)
NOTEYE_GUI=1

pkgname=hydraslayer
pkgver=15.3
pkgrel=2
pkgdesc="Roguelike influenced by mathematical puzzles. In Hydra Slayer your task is to enter Hydra Nest and clear it."
arch=('i686' 'x86_64')
url="http://www.roguetemple.com/z/hydra.php"
license=('GPL2')
if [ $NOTEYE_GUI = 1 ]; then
  depends=('ncurses' 'gcc-libs' 'lua51' 'sdl_net' 'sdl_mixer' 'sdl_image' 'sdl' 'glu')
else 
  depends=('ncurses' 'gcc-libs' 'lua51')
fi
changelog=
source=(http://www.roguetemple.com/z/noteye-73.zip
        hydraslayer.sh
        Makefile.patch)
md5sums=('c97bb0f246efbcf58dbf257ebc749fca'
         '857aac6353443f442a3a3a47ba6399cb'
         '14e1235cb91d203913f3f3bdca602ae8')

build() {

  _dest_dir=$pkgdir/usr/share/hydraslayer

  mkdir -p $_dest_dir || return 1

  if [ $NOTEYE_GUI = 1 ]; then
    patch -R "$srcdir/noteye/src/Makefile" Makefile.patch
    cd "$srcdir/noteye/src"
    make

    install -D -m 755 ../hydraslayer "$_dest_dir"
    install -D -m 755 ../noteye "$_dest_dir"
    install -D -m 744 ../config.noe "$_dest_dir"
    install -D -m 755 ../libnoteye.so "$_dest_dir"

    target_dirs=('common' 'gfx' 'games')
    for tdir in ${target_dirs[@]}; do
      mkdir "$_dest_dir/$tdir"

      for file in $(ls ../$tdir); do
        install -D -m 744 ../$tdir/$file "$_dest_dir/$tdir"
      done
    done
  else
    cd "$srcdir/noteye/hydra"
    make

    install -T -D -m 755 hydra "$_dest_dir/hydraslayer"
  fi

  install -T -D -m 755 "$srcdir/hydraslayer.sh" "$pkgdir/usr/bin/hydraslayer"

  chown -R :games $_dest_dir 
  chmod -R g+srw $_dest_dir
}

# vim:set ts=2 sw=2 et:
