# Maintainer: Alexej Magura <agm2819*gmail*>
#
# Contributor: revel <revelΘmuub·net>
# Contributor: joyfulgirl <joyfulgirl (at) archlinux.us>

pkgname=cl-asdf
_realname=asdf
pkgver=2.33
pkgrel=2
pkgdesc="clisp's Another System Definition Facility (pre-installed in SBCL)"
arch=('any')
url="http://common-lisp.net/project/asdf"
license=('MIT')
depends=('common-lisp') # requires common-lisp for it to be at all useful, but doesn't need it to build.
makedepends=('texinfo-legacy' 'texlive-bin')
provides=('asdf=2.33')
install=asdf.install
source=("http://common-lisp.net/project/$_realname/archives/$_realname-${pkgver}.tar.gz"
	"makefile"
	"doc-makefile_patch")
md5sums=(a28d111a9b2b8431ff38df5855ab25b3
	 c1a4751c75b28ec7c32fb3e0960ae09a
	 05dd29d2041fb9a02707ec8a7a4538f6)

prepare() {


    cd $srcdir
    
    if [[ -d "$pkgname-$pkgver" ]]; then
	rm -rf "$pkgname-$pkgver";
    fi

    mkdir -p $pkgname-$pkgver

    for dirs in $(ls -a1 $srcdir | sed -r "s:^(\\.\\.|\\.).*$:: ; s:^makefile$:: ; s:^$_realname-$pkgver\\.tar\\.gz$:: ; s:^$pkgname-$pkgver$:: ; s:^doc-makefile_patch$:: ; /^$/d")
    do
	mv $dirs $pkgname-$pkgver 
    done

    cd $pkgname-$pkgver 

    rm -rf build

}

build() {
    
    # build asdf.lisp
    cd $srcdir/$pkgname-$pkgver

    make
    
    
#    cd $srcdir/$pkgname-$pkgver/bin

    # build asdf-2.33.info 
    cd $srcdir/$pkgname-$pkgver/doc

    patch Makefile $srcdir/doc-makefile_patch

    make PKGVER=$pkgver asdf.info

    # extract the copyright portion of the debian/copyright file; save it to doc/copyright

    cd $srcdir/$pkgname-$pkgver/debian

    cat copyright | sed -e :a -e '$q;N;25,$D;ba' > ../doc/copyright

}

package() {
    cd $srcdir/$pkgname-$pkgver

    make -f $srcdir/makefile \
	PKGNAME=$pkgname \
	PKGVER=$pkgver \
	REALNAME=$_realname \
	DESTDIR=$pkgdir install
    
}

    
