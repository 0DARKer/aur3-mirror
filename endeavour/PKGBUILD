# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Eric Belanger <eric@archlinux.org>

pkgname=endeavour
pkgver=2.10.1
pkgrel=2
pkgdesc="A file browser/file manager"
arch=('i686' 'x86_64')
url="http://savannah.gnu.org/submissions_uploads/"
license=('GPL')
depends=('imlib' 'giflib' 'libmng' 'libxxf86vm' 'gcc-libs' 'bzip2')
source=(http://savannah.gnu.org/submissions_uploads/$pkgname-$pkgver.tar.bz2 arch.patch)
md5sums=('d67e374d1e97c6c3a72e61b45c2deea4' '46efc1ddfeb6549ad87991dc186f9589')

build() {
  cd $srcdir/$pkgname-$pkgver
  make clean || return 1
  sed -i 's|mistaken for|mistaken for\\n\\|' endeavour2/mime_type_edit_dlg.c || return 1
  patch -p1 < ../arch.patch || return 1
  [ "$CARCH" == "i686" ]  && ./configure Linux --prefix=/usr \
    --disable=libxar --disable=libzip  --enable=arch-i686 
  [ "$CARCH" == "x86_64" ] && ./configure Linux --prefix=/usr \
    --disable=libxar --disable=libzip
  sed -i 's/lgif/giflib/' endeavour2/Makefile 

  if [ "$CARCH" = "i686" ]; then
    make all || return 1
  elif [ "$CARCH" = "x86_64" ]; then
    make CC="cc -fPIC" CPP="c++ -fPIC" all || return 1
  fi
  make PREFIX=$pkgdir/usr install
  
  cp -r $srcdir/$pkgname-$pkgver/${pkgname}2/data/help \
    $pkgdir/usr/share/${pkgname}2/ || return 1
  cp -r $pkgdir/usr/man $pkgdir/usr/share/ || return 1
  rm -r $pkgdir/usr/man || return 1
  cd $srcdir/$pkgname-$pkgver/${pkgname}2/utils || return 1
  for _i in confirmation-dialog dnd-drag-maker dnd-drop-reader file-selector lsmimetypes \
    memory-usage-estimator notify open properties purge recover recycle rls splash style-editor
  do
    install -Dm755 ${_i} $pkgdir/usr/bin || return 1
  done
  ln -s /usr/lib/endeavour2/bin/download.front $pkgdir/usr/bin/download.front 
  ln -s /usr/lib/endeavour2/bin/format.front $pkgdir/usr/bin/format.front
  ln -s /usr/lib/endeavour2/bin/fsck.front $pkgdir/usr/bin/fsck.front
  ln -s /usr/lib/endeavour2/bin/hedit $pkgdir/usr/bin/hedit
  ln -s /usr/lib/endeavour2/bin/style-editor $pkgdir/usr/bin/style-editor
  ln -s /usr/lib/endeavour2/bin/sysinfo $pkgdir/usr/bin/sysinfo.endeavour2
  ln -s /usr/lib/endeavour2/bin/tedit $pkgdir/usr/bin/tedit
  ln -s /usr/lib/endeavour2/bin/ziptool.front $pkgdir/usr/bin/ziptool.front
} 
