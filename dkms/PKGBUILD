# $Id:$
# Contributor: Balwinder S "bsd" Dheeman (bdheeman AT gmail.com)
# Maintainer: Balwinder S "bsd" Dheeman (bdheeman AT gmail.com)

pkgname=dkms
pkgver=2.1.1.2
pkgrel=3
pkgdesc="A Dynamic Kernel Modules System or Framework"
arch=('any')
url=http://linux.dell.com/dkms/
license=('GPL')
depends=('kernel26-headers')
backup=('etc/dkms/framework.conf')
install=dkms.install
changelog=ChangeLog
source=(http://linux.dell.com/$pkgname/permalink/$pkgname-$pkgver.tar.gz
    'dkms.patch' 'dkms_autoinstaller.patch')

build() {
    cd "$srcdir/$pkgname-$pkgver"
    if [ -x configure ]; then
	./configure --prefix=/usr
    fi
    make || return 1
}

package() {
    cd "$srcdir/$pkgname-$pkgver" || return $1
    make DESTDIR="$pkgdir" install || return $1

    # patch dkms, rc_script and create symlink
    patch -d$pkgdir -p1 -i $srcdir/dkms.patch || return $1
    patch -d$pkgdir -p1 -i $srcdir/dkms_autoinstaller.patch || return $1
    mkdir -p $pkgdir/etc/rc.d
    ln -s ../../usr/lib/dkms/dkms_autoinstaller $pkgdir/etc/rc.d/

    # remove debian/ubuntu specific stuff
    #rm -rf $pkgdir/etc/kernel
}

# vim:set ts=2 sw=2 et:
md5sums=('f8e5f1a2ac065b75c10b1fdaa2ef342f'
         '2b83a59d64d119af61bb347f21c40994'
         '37bec6064a1c254e14fb054c939853aa')
