--- a/usr/sbin/dkms	2010-04-11 05:04:45.000000000 +0000
+++ b/usr/sbin/dkms	2010-04-11 05:09:56.000000000 +0000
@@ -196,7 +196,8 @@
 function do_depmod()
 {
     # $1 = kernel version
-    /sbin/depmod -au "$1" -F "/boot/System.map-$1"
+    magic=$(echo ${1:0:1}${1:2:1}-${1##*-} |sed 's/-ARCH//')
+    /sbin/depmod -au "$1" -F "/boot/System.map${magic}"
 }
 
 function remake_initrd()
@@ -1172,7 +1173,7 @@
         if [[ $(VER $1) < $(VER 2.5) ]]; then
             invoke_command "make KERNELRELEASE=$1 dep" "make dep" background
         else
-            invoke_command "make KERNELRELEASE=$1 prepare-all scripts" "make prepare-all" background
+            invoke_command "make KERNELRELEASE=$1 prepare scripts" "make prepare" background
         fi
     fi
     cd - >/dev/null
