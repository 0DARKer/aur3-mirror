From d6a0b2707bfc7996d1e4d7696a2aed58decd3fb1 Mon Sep 17 00:00:00 2001
From: Pablo Recio Quijano <rikutheronin@gmail.com>
Date: Sun, 8 Aug 2010 11:41:33 +0200
Subject: [PATCH 1/3] Added combobox in the prefs window.

Signed-off-by: Pablo Recio Quijano <rikutheronin@gmail.com>
---
 data/prefs.glade |  172 ++++++++++++++++++++++++++++++++++++------------------
 1 files changed, 115 insertions(+), 57 deletions(-)

diff --git a/data/prefs.glade b/data/prefs.glade
index d7b2441..1c91f33 100644
--- a/data/prefs.glade
+++ b/data/prefs.glade
@@ -276,84 +276,142 @@
                       </packing>
                     </child>
                     <child>
-                      <widget class="GtkFrame" id="frame4">
+                      <widget class="GtkHBox" id="hbox5">
                         <property name="visible">True</property>
-                        <property name="label_xalign">0</property>
-                        <property name="shadow_type">none</property>
                         <child>
-                          <widget class="GtkAlignment" id="alignment4">
+                          <widget class="GtkFrame" id="frame4">
                             <property name="visible">True</property>
-                            <property name="left_padding">12</property>
+                            <property name="label_xalign">0</property>
+                            <property name="shadow_type">none</property>
                             <child>
-                              <widget class="GtkVBox" id="vbox11">
+                              <widget class="GtkAlignment" id="alignment4">
                                 <property name="visible">True</property>
-                                <property name="spacing">6</property>
-                                <property name="homogeneous">True</property>
-                                <child>
-                                  <widget class="GtkCheckButton" id="window_ontop">
-                                    <property name="label" translatable="yes">Stay on top</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">False</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="focus_on_click">False</property>
-                                    <property name="active">True</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_ontop_toggled"/>
-                                  </widget>
-                                  <packing>
-                                    <property name="expand">False</property>
-                                    <property name="position">0</property>
-                                  </packing>
-                                </child>
-                                <child>
-                                  <widget class="GtkCheckButton" id="window_losefocus">
-                                    <property name="label" translatable="yes">Hide on lose focus</property>
-                                    <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="use_underline">True</property>
-                                    <property name="active">True</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_losefocus_toggled"/>
-                                  </widget>
-                                  <packing>
-                                    <property name="expand">False</property>
-                                    <property name="fill">False</property>
-                                    <property name="position">1</property>
-                                  </packing>
-                                </child>
+                                <property name="left_padding">12</property>
                                 <child>
-                                  <widget class="GtkCheckButton" id="window_tabbar">
-                                    <property name="label" translatable="yes">Show tab bar</property>
+                                  <widget class="GtkVBox" id="vbox11">
                                     <property name="visible">True</property>
-                                    <property name="can_focus">True</property>
-                                    <property name="receives_default">False</property>
-                                    <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
-                                    <property name="draw_indicator">True</property>
-                                    <signal name="toggled" handler="on_window_tabbar_toggled"/>
+                                    <property name="spacing">6</property>
+                                    <property name="homogeneous">True</property>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_ontop">
+                                        <property name="label" translatable="yes">Stay on top</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="use_underline">True</property>
+                                        <property name="focus_on_click">False</property>
+                                        <property name="active">True</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_ontop_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="position">0</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_losefocus">
+                                        <property name="label" translatable="yes">Hide on lose focus</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="use_underline">True</property>
+                                        <property name="active">True</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_losefocus_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="fill">False</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkCheckButton" id="window_tabbar">
+                                        <property name="label" translatable="yes">Show tab bar</property>
+                                        <property name="visible">True</property>
+                                        <property name="can_focus">True</property>
+                                        <property name="receives_default">False</property>
+                                        <property name="events">GDK_POINTER_MOTION_MASK | GDK_POINTER_MOTION_HINT_MASK | GDK_BUTTON_PRESS_MASK | GDK_BUTTON_RELEASE_MASK</property>
+                                        <property name="draw_indicator">True</property>
+                                        <signal name="toggled" handler="on_window_tabbar_toggled"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="position">2</property>
+                                      </packing>
+                                    </child>
                                   </widget>
-                                  <packing>
-                                    <property name="position">2</property>
-                                  </packing>
                                 </child>
                               </widget>
                             </child>
+                            <child>
+                              <widget class="GtkLabel" id="label20">
+                                <property name="visible">True</property>
+                                <property name="ypad">6</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Main Window&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="type">label_item</property>
+                              </packing>
+                            </child>
                           </widget>
+                          <packing>
+                            <property name="position">0</property>
+                          </packing>
                         </child>
                         <child>
-                          <widget class="GtkLabel" id="label20">
+                          <widget class="GtkFrame" id="frame1">
                             <property name="visible">True</property>
-                            <property name="ypad">6</property>
-                            <property name="label" translatable="yes">&lt;b&gt;Main Window&lt;/b&gt;</property>
-                            <property name="use_markup">True</property>
+                            <property name="label_xalign">0</property>
+                            <property name="shadow_type">none</property>
+                            <child>
+                              <widget class="GtkAlignment" id="alignment2">
+                                <property name="visible">True</property>
+                                <property name="left_padding">12</property>
+                                <child>
+                                  <widget class="GtkVBox" id="vbox10">
+                                    <property name="visible">True</property>
+                                    <child>
+                                      <placeholder/>
+                                    </child>
+                                    <child>
+                                      <widget class="GtkComboBox" id="monitorinput">
+                                        <property name="visible">True</property>
+                                        <property name="items" translatable="yes"></property>
+                                        <signal name="changed" handler="on_monitorinput_changed"/>
+                                      </widget>
+                                      <packing>
+                                        <property name="expand">False</property>
+                                        <property name="position">1</property>
+                                      </packing>
+                                    </child>
+                                    <child>
+                                      <placeholder/>
+                                    </child>
+                                  </widget>
+                                </child>
+                              </widget>
+                            </child>
+                            <child>
+                              <widget class="GtkLabel" id="label2">
+                                <property name="visible">True</property>
+                                <property name="label" translatable="yes">&lt;b&gt;Display&lt;/b&gt;</property>
+                                <property name="use_markup">True</property>
+                              </widget>
+                              <packing>
+                                <property name="type">label_item</property>
+                              </packing>
+                            </child>
                           </widget>
                           <packing>
-                            <property name="type">label_item</property>
+                            <property name="position">1</property>
                           </packing>
                         </child>
                       </widget>
                       <packing>
+                        <property name="expand">False</property>
+                        <property name="fill">False</property>
                         <property name="position">2</property>
                       </packing>
                     </child>
-- 
1.7.0.4


From df41c23367b30fc307e61dd5add4c64045e1cb32 Mon Sep 17 00:00:00 2001
From: Pablo Recio Quijano <rikutheronin@gmail.com>
Date: Sun, 8 Aug 2010 11:43:38 +0200
Subject: [PATCH 2/3] Added handling of the checkbox to select multiple displays

Signed-off-by: Pablo Recio Quijano <rikutheronin@gmail.com>
---
 src/prefs.py |   19 +++++++++++++++++++
 1 files changed, 19 insertions(+), 0 deletions(-)

diff --git a/src/prefs.py b/src/prefs.py
index b0a69bf..c2d2186 100644
--- a/src/prefs.py
+++ b/src/prefs.py
@@ -194,6 +194,12 @@ class PrefsCallbacks(object):
         val = int(spin.get_value())
         self.client.set_int(KEY('/general/history_size'), val)
 
+    def on_monitorinput_changed(self, monitor):
+        """Changes the monitor
+ 	"""
+        val = monitor.get_active()
+ 	self.client.set_int(KEY('/general/monitor'), val)
+
     def on_scroll_output_toggled(self, chk):
         """Changes the activity of scroll_output in gconf
         """
@@ -309,6 +315,12 @@ class PrefsDialog(SimpleGladeApp):
         column.set_property('expand', False)
         treeview.append_column(column)
 
+        screen = self.get_widget('config-window').get_screen()
+        self.monitorinput = self.get_widget('monitorinput')
+        num_monitors = screen.get_n_monitors()
+        for i in range(num_monitors):
+            self.monitorinput.append_text('%s' % i)
+
         self.populate_shell_combo()
         self.populate_keys_tree()
         self.load_configs()
@@ -476,6 +488,13 @@ class PrefsDialog(SimpleGladeApp):
         value = self.client.get_bool(KEY('/general/window_tabbar'))
         self.get_widget('window_tabbar').set_active(value)
 
+        # monitor
+        combo = self.get_widget('monitorinput')
+        value = float(self.client.get_int(KEY('/general/monitor')))
+        for i in combo.get_model():
+            if i[0] == str(int(value)):
+                combo.set_active_iter(i.iter)
+
         # scrollbar
         value = self.client.get_bool(KEY('/general/use_scrollbar'))
         self.get_widget('use_scrollbar').set_active(value)
-- 
1.7.0.4


From 0f1d52fa37bbafa3edcacea6480dc73bf3238a12 Mon Sep 17 00:00:00 2001
From: Pablo Recio Quijano <rikutheronin@gmail.com>
Date: Sun, 8 Aug 2010 11:44:17 +0200
Subject: [PATCH 3/3] Implemented the behaviour of multimonitor.

Signed-off-by: Pablo Recio Quijano <rikutheronin@gmail.com>
---
 src/guake.py |   14 +++++---------
 1 files changed, 5 insertions(+), 9 deletions(-)

diff --git a/src/guake.py b/src/guake.py
index 6214fb2..9321108 100644
--- a/src/guake.py
+++ b/src/guake.py
@@ -776,6 +776,7 @@ class Guake(SimpleGladeApp):
         """
         # setting window in all desktops
         self.get_widget('window-root').stick()
+        monitor = self.client.get_int(KEY('/general/monitor'))
 
         # add tab must be called before window.show to avoid a
         # blank screen before adding the tab.
@@ -812,7 +813,10 @@ class Guake(SimpleGladeApp):
         is the window_height property, width is window_width and the
         horizontal alignment is given by window_alignment.
         """
+        monitor = self.client.get_int(KEY('/general/monitor'))
         screen = self.window.get_screen()
+        if monitor >= screen.get_n_monitors(): #if we disconnect some monitor
+            monitor = 0
         height = self.client.get_int(KEY('/general/window_height'))
         width = 100
         halignment = self.client.get_int(KEY('/general/window_halignment'))
@@ -820,19 +824,11 @@ class Guake(SimpleGladeApp):
         # get the rectangle just from the first/default monitor in the
         # future we might create a field to select which monitor you
         # wanna use
-        window_rect = screen.get_monitor_geometry(0)
+        window_rect = screen.get_monitor_geometry(monitor)
         total_width = window_rect.width
         window_rect.height = window_rect.height * height / 100
         window_rect.width = window_rect.width * width / 100
 
-        if width < total_width:
-            if halignment == ALIGN_CENTER:
-                window_rect.x = (total_width - window_rect.width) / 2
-            elif halignment == ALIGN_LEFT:
-                window_rect.x = 0
-            elif halignment == ALIGN_RIGHT:
-                window_rect.x = total_width - window_rect.width
-        window_rect.y = 0
         return window_rect
 
     def get_running_fg_processes(self):
-- 
1.7.0.4

