# Maintainer: Sairon Istyar <saironiq@gmail.com>
# Contributor: Thomas Jost <schnouki@schnouki.net>
# Contributor: Samuel Tardieu <sam@rfc1149.net>

pkgname=git-annex-bin
pkgver=auto
pkgrel=2
pkgdesc='Precompiled version of git-annex, webapp and assistant included.'
arch=('i686' 'x86_64')
url="http://git-annex.branchable.com/"
license=(GPL3)
provides=(git-annex)
conflicts=(git-annex git-annex-standalone)
makedepends=(curl sed)

if [ "$CARCH" = "i686" ] ; then
  depends=(git util-linux openssh rsync curl glibc gnupg wget findutils libyaml \
           libffi5 zlib libxml2 gmp xz lsof coreutils gsasl gnutls p11-kit libtasn1-3 nettle \
           libidn libntlm libgnutls26 krb5 libgcrypt icu48 dnsutils)
  _arch=i386
elif [ "$CARCH" = "x86_64" ] ; then
  depends=(git util-linux openssh rsync curl glibc gnupg wget findutils libyaml \
           libffi5 zlib libxml2 gmp xz lsof coreutils gsasl gnutls p11-kit libtasn1-3 nettle \
           libidn libntlm libgnutls26 krb5 libgcrypt icu48 dnsutils)
  _arch=amd64
fi

_url=https://downloads.kitenet.net/git-annex/linux/current/git-annex-standalone-${_arch}.tar.gz
_info=$(curl ${_url}.info)

pkgver() {
  echo "${_info}" | sed 's/.*distributionVersion = "\([0-9.]*\)".*/\1/'
}

sha256sums=($(echo "${_info}" | sed 's/.*keyName = "\(.*\).tar.gz".*/\1/'))

_file=git-annex-standalone-${_arch}-$(pkgver).tar.gz
source=(${_file}::${_url})

package() {
  install -Dm755 "$srcdir/git-annex.linux/shimmed/git-annex/git-annex" "$pkgdir/usr/bin/git-annex"
  ln -s git-annex "$pkgdir/usr/bin/git-annex-shell"
}
