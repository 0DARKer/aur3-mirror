# Maintainer: Sairon Istyar <saironiq@gmail.com>

pkgname=git-annex-bin
pkgver=3.20120928
pkgrel=1
pkgdesc='Precompiled version of git-annex, webapp and assistant included.'
arch=('i686' 'x86_64')
url="http://git-annex.branchable.com/"
license=(GPL3)
depends=(git util-linux openssh rsync pcre curl glibc gnupg wget findutils libyaml libffi)
provides=(git-annex)
conflicts=(git-annex)

# change to 1 to apply lib fixes
_dirty=0

if [ "$CARCH" = "i686" ]; then
  source=(http://downloads.kitenet.net/git-annex/linux/git-annex-standalone-32bit.tar.gz)
  md5sums=('ecf555025af0aff5dd9cbbc458d38d76')
elif [ "$CARCH" = "x86_64" ]; then
  source=(http://downloads.kitenet.net/git-annex/linux/git-annex-standalone-64bit.tar.gz)
  md5sums=('5f729890b63dd01d258e4c6100666a9a')
else
  exit 1
fi

build() {
  cd $srcdir/git-annex.linux
}

package() {
  cd $srcdir/git-annex.linux
  install -Dm755 bin/git-annex "$pkgdir/usr/bin/git-annex"
  ln -s git-annex "$pkgdir/usr/bin/git-annex-shell"

  echo "If you get missing shared object error in git-annex, try making symlinks:"
  echo "  ln -s /lib/libXXX.so /lib/libXXX.so.N"
  echo "Here's what works on my machine:"
  echo "  ln -s /lib/libffi.so /lib/libffi.so.5"
  echo "  ln -s /lib/libpcre.so /lib/libpcre.so.3"
  echo "You can modify \$_dirty variable in PKGBUILD to make this a part of package,"
  echo "so it will be removed when uninstalling."

  if [ $_dirty = 1 ]; then
    mkdir $pkgdir/lib
    cd $pkgdir/lib/
    [ ! -f /lib/libffi.so.5 ] && ln -s libffi.so libffi.so.5
    [ ! -f /lib/libpcre.so.3 ] && ln -s libpcre.so libpcre.so.3
  fi
}
