# Author: Wintershade <Wintershade AT google mail DOT com>
# Contributor: Konrad <konrad AT knauber DOT name>
# Contributor: Luka Perkov <archlinux <at> lukaperkov <dOt> net>

pkgname=rpm-org
pkgver=4.8.1
pkgrel=5
pkgdesc="RPM Package Manager - RPM.org fork, used in major RPM distros"
arch=('i686' 'x86_64')
url=("http://www.rpm.org/")
license=('GPL')
depends=('glibc' 'beecrypt' 'lua' 'zlib' 'file' 'gettext'  'nss' 'nspr' 'gnupg' 'db' 'python2')
optdepends=('bzip2: support for bzip2 compression' 'gzip: support for gzip compression' 'xz-utils: support for xz/lzma compression')
conflicts=('rpm' 'rpmextract')
provides=('rpm=${pkgver}' 'rpmextract=1.0-4')
source=(http://rpm.org/releases/rpm-4.8.x/rpm-${pkgver}.tar.bz2
	'db5.patch'
	'rpmextract.sh')
md5sums=('85b9cabd384ffe47b7c3ffb396133fb1'
	 'e9debb231827c144cda17d66c7af4a5d'
	 'a7b527e4c210e66ef72532c606072e0d')

build() {
  cd ${srcdir}/rpm-${pkgver}
  patch -p1 -i ${srcdir}/db5.patch
  PYTHON=python2 ./configure --localstatedir=/var --prefix=/usr --without-selinux --with-external-db CPPFLAGS="`pkg-config --cflags nss`"
  make
}

package() {
  cd ${srcdir}/rpm-${pkgver}
  make prefix=${pkgdir}/usr localstatedir=${pkgdir}/var install
  rmdir $pkgdir/var/tmp
  install -m755 ${srcdir}/rpmextract.sh ${pkgdir}/usr/bin/
}
