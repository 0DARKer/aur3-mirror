# Maintainer: Jason Melton <jason.melton@gmail.com>

pkgname=stuntrally
pkgver=1.1
pkgrel=1
pkgdesc="Stunt Rally game with track editor, based on VDrift and OGRE"
arch=(i686 x86_64)
url="http://code.google.com/p/vdrift-ogre"
license=('GPL3')
depends=('mygui' 'sdl' 'libogg' 'libvorbis')
makedepends=('mercurial' 'cmake' 'boost')
source=()

_hgroot_1="https://vdrift-ogre.googlecode.com/hg/"
_hgrepo_1="stuntrally"

_hgroot_2="https://data.vdrift-ogre.googlecode.com/hg/"
_hgrepo_2="data"

_hgroot_3="https://tracks.vdrift-ogre.googlecode.com/hg/"
_hgrepo_3="tracks"

_source() {
    cd ${srcdir}
    msg "Connecting to Mercurial server...."

    msg "Pulling stuntrally files...."
    if [ -d ${_hgrepo_1} ]; then
        cd ${_hgrepo_1} && hg pull -u
        cd ..
    else
        hg clone ${_hgroot_1} ${_hgrepo_1}
    fi
    cd stuntrally

    msg "Pulling data files...."
    if [ -d ${_hgrepo_2} ]; then
        cd ${_hgrepo_2} && hg pull -u
        cd ..
    else
        hg clone ${_hgroot_2} ${_hgrepo_2}
    fi
    cd data

    msg "Pulling track files...."
    if [ -d ${_hgrepo_3} ]; then
        cd ${_hgrepo_3} && hg pull -u
        cd ..
    else
        hg clone ${_hgroot_3} ${_hgrepo_3}
    fi
}

build() {
    _source

    cd ${srcdir}
    rm -rf build
    mkdir build && cd build

    cmake -DCMAKE_INSTALL_PREFIX=${pkgdir}/opt/stuntrally ../stuntrally    || return 1
    make || return 1
}

package() {
    cd ${srcdir}/build
    make install
}

