# Maintainer: jsteel <mail at jsteel dot org>
# Contributer: Markus Golser <elmargol@googlemail.com>

pkgname='openclonk-hg'
pkgver=4849
pkgrel=1
pkgdesc="A multiplayer-action-tactic-skill game"
url="http://www.openclonk.org"
license=('custom')
arch=('i686' 'x86_64')
depends=('libx11' 'libxxf86vm' 'libxpm' 'glew' 'libpng' 'openssl' 'sdl' 'sdl_mixer' 'gtk2' 'libjpeg' 'zlib')
makedepends=('mercurial' 'boost')
source=('clonk')
md5sums=('7ff9e69ba280517f089386ec6c22d875')
_hgroot='http://hg.openclonk.org'
_hgrepo='openclonk'

build() {
  cd "$srcdir"
  if [ -d $_hgrepo ]; then
    cd $_hgrepo
    hg pull -u
  else
    hg clone $_hgroot/$_hgrepo
    cd $_hgrepo
  fi
  msg "Starting build process"
  autoreconf -i
  ./configure 'CXX=g++ -std=gnu++0x' --with-gtk=2.0
  make
}

package() {
  mkdir -p "$pkgdir"/usr/bin/ "$pkgdir"/usr/share/$pkgname "$pkgdir"/usr/share/licenses/$pkgname
  install -D -m755 "$srcdir"/clonk "$pkgdir"/usr/bin/
  install -D -m755 "$srcdir"/$_hgrepo/clonk "$pkgdir"/usr/share/$pkgname/
  install -D -m644 "$srcdir"/$_hgrepo/licenses/* "$pkgdir"/usr/share/licenses/$pkgname/
  cp -r "$srcdir"/$_hgrepo/planet/* "$pkgdir"/usr/share/$pkgname/
  find "$pkgdir"/usr/share/$pkgname/ -type d -exec chmod a+x {} \;
}
