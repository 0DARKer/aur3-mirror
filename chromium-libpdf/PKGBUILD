# Maintainer: Andrew Webley <unsuspectinghero@gmail.com>
# Contributor: Dmitriy Morozov <archlinux@foxcub.org>


pkgname=chromium-libpdf
#The pkgver is the same as for google chrome unstable, because this library isn't meant to be distributed on its own, and I cannot find any proper version information.
pkgver=26.0.1410.3
pkgrel=1
pkgdesc="PDF Viewer for Chromium"
url="http://wiki.archlinux.org/index.php/Chromium#libpdf.so"
arch=('i686' 'x86_64')
license=('custom')
optdepends=('chromium: default browser to use plugin in'
'chromium-dev: development version of default browser, requires modifying the PKGBUILD'
'iron: alternate google-chrome based browser, requires modifying the PKGBUILD')
sha512sums=('4fdcd90d545f5387fbb03dcc7a6c4c347349a91aae682b710aa1fb968484437eb221cd7899898fbd6b5caaf4a0a3644ea64da19e961fecf85d3ff1c9b5bfdfb1')
if [ "$CARCH" = "i686" ]; then
	_arch="i386"
    sha512sums+=('ba673c5297da064af9bbec51261f9b347ea6ac5d2ffe6952f5dad0b734b614fe7ee11a07ae68fb83686caa58a4635be350043174df917404922a6adf5b224dae')
elif [ "$CARCH" = "x86_64" ]; then
	_arch="amd64"
	sha512sums+=('a2464f10bcf675b38257254e8c22f550f9a909c99cb2a5734136415e40153b8f85bc890a466b15ca4f867813a6592f10b54d17af28bc58585197594361536e4d')
fi
source=(LICENSE
        "https://dl.google.com/linux/direct/google-chrome-unstable_current_${_arch}.deb"
)


build() {
	cd "$srcdir"
	#This extracts the .deb file to only get the relevant tarball, and then extracts that tarball to get the relevant library file.
	bsdtar xvf "google-chrome-unstable_current_${_arch}.deb" data.tar.lzma
	bsdtar xvf data.tar.lzma opt/google/chrome/libpdf.so
	#These lines install the library to the correct directory and with the correct permissions. If you're using iron, change "usr/lib/chromium/" to "/opt/iron".
	install -Dm755 opt/google/chrome/libpdf.so "${pkgdir}/usr/lib/chromium/libpdf.so"
	install -Dm755 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
