# Maintainer: Andrew Webley <unsuspectinghero@gmail.com>
# Contributor: Dmitriy Morozov <archlinux@foxcub.org>
pkgname=chromium-libpdf
#The pkgver is the same as for google chrome unstable, because this library isn't meant to be distributed on its own, and I cannot find any proper version information.
pkgver=25.0.1364.2
pkgrel=1
pkgdesc="PDF Viewer for Chromium"
url="http://wiki.archlinux.org/index.php/Chromium#libpdf.so"
arch=('i686' 'x86_64')
license=('custom')
depends=('chromium')
#Lynx is needed to download and convert the license from a html webpage into a plaintext file. Curl could manage the downloading, but doesn't have the necessary stuff to render html as plaintext.
makedepends=('lynx')
if [ "$CARCH" = "i686" ]; then
	_arch="i386"
	sha512sums=('a7298abbfb9515c69c7592452eb3802224666d9ffa37321bf1cdc43b5478046edc9aa5138d6339df996d95423ccc72ff3cb76c65be0d9716384ca2a2510e537b')
elif [ "$CARCH" = "x86_64" ]; then
	_arch="amd64"
	sha512sums=('d62bf325438dc996543cab418dd034a72d5c9636fee57f0d5d79b48b848b9260dde51ddde1568be0780d3000ecc24a98e5614a67e205b7709a402828beb905a0')
fi
source=("https://dl.google.com/linux/direct/google-chrome-unstable_current_${_arch}.deb")
build() {
	cd "$srcdir"
	lynx https://www.google.com/chrome/intl/en/eula_text.html --dump >> LICENSE
	#This extracts the .deb file to onlt get the relevant tarball, and then extracts that tarball to get the relevant library file.
	bsdtar xvf "google-chrome-unstable_current_${_arch}.deb" data.tar.lzma
	bsdtar xvf data.tar.lzma opt/google/chrome/libpdf.so
	#These lines install the library to the correct directory and with the correct permissions.
	install -Dm755 opt/google/chrome/libpdf.so "${pkgdir}/usr/lib/chromium/libpdf.so"
	install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
#If you're using chromium-dev, then change line 29 so that "${pkgdir}/usr/lib/chromium/libpdf.so" is "${pkgdir}/usr/lib/chromium-dev/libpdf.so"
#If you're using iron, or something else like that, change line 29 so that it points at wherever the browser keeps it's library files.
