# Maintainer: Andrew Webley <unsuspectinghero@gmail.com>
# Contributor: Dmitriy Morozov <archlinux@foxcub.org>


pkgname="chromium-libpdf"
#The pkgver is the same as for google chrome unstable, because this library isn't meant to be distributed on its own, and I cannot find any proper version information.
pkgver="28.0.1487.0"
pkgrel=1
pkgdesc="PDF Viewer for Chromium"
url="http://wiki.archlinux.org/index.php/Chromium#libpdf.so"
arch=('i686' 'x86_64')
license=('custom:chrome')
optdepends=('chromium: default browser to use plugin in'
'chromium-dev: development version of default browser, requires modifying the PKGBUILD'
'iron: alternate google-chrome based browser, requires modifying the PKGBUILD')
sha512sums=('2d09d2ca3c960f38463ed742a2f038e919363fe2cb8d65d86cd4672559b44369037d94f9a09ede478fadd20b4a6dc9271e8d1af1f2cc2bc92ed90d0a4810ac67')
if [ "$CARCH" = "i686" ]; then
	_arch="i386"
    sha512sums+=('4c4223d68e2e4b08b3f4e060668c0812daa1aa8848b67c8ff7cf272849ddcbdb597c6808b0ba147f5d312eca3d8a52d5aa51dad4cc9d46425f8e98a0ab0f1be9')
elif [ "$CARCH" = "x86_64" ]; then
	_arch="amd64"
	sha512sums+=('9d108dbd5b607882cc081e9d93f5418a79f281f39ed0d8ba5131841b4dca2f23b14adf2bde8d05b64bc52f33cc22efe66d0540228051d2d34c533d749932f91e')
fi
source=(LICENSE
		"https://dl.google.com/linux/direct/google-chrome-unstable_current_${_arch}.deb")
build() {
	cd "$srcdir"
	#This extracts the .deb file to only get the relevant tarball, and then extracts that tarball to get the relevant library file.
	bsdtar xvf "google-chrome-unstable_current_$_arch.deb" data.tar.lzma
	bsdtar xvf data.tar.lzma opt/google/chrome/libpdf.so
}
package(){
	#These lines install the library to the correct directory and with the correct permissions.
    #Uncomment relevant lines if you're using something other than chromium, and comment out the next line.
	install -Dm755 opt/google/chrome/libpdf.so "$pkgdir/usr/lib/chromium/libpdf.so"
    #chromium-dev
    #install -Dm755 opt/google/chrome/libpdf.so "$pkgdir/usr/lib/chromium-dev/libpdf.so"
	#iron-browser
    #install -Dm755 opt/google/chrome/libpdf.so "$pkgdir/opt/iron/libpdf.so"
    install -Dm755 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
