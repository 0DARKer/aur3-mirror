# Maintainer: markzz <mark dot weiman at markzz dot com>

# YOU MUST SUPPLY THE ZIP FILE INCLUDED WITH YOUR HUMBLE PURCHASE

pkgname=besiege
pkgver=0.03
pkgrel=1
pkgdesc="A physics based building puzzler."
arch=('i686' 'x86_64')
url="http://besiegethegame.com/"
license=('custom')
makedepends=('unzip')
source=(besiege.desktop besiege)
sha256sums=('c6cef3d0bfef18cf355cbb31843463fbeaad9057d958e055bffaa4a261e5b5dd'
            'fe4049e66f9c02131ae457ac16f5d966333f029cb615a693ba84f69ef944c0bd')
_gamedir=Besiege_Alpha_Linux_v0_03

if [[ $CARCH == 'x86_64' ]]; then
  _arch='x86_64'
elif [[ $CARCH == 'i686' ]]; then
  _arch='x86'
fi

build() {
  msg ""
  msg "You need to download a copy of this game from your Humble library!"
  msg "Searching for the zip file in \"$startdir\"..."
  pkgpath="$startdir"
  
  if [[ ! -f "${pkgpath}/${_gamedir}.zip" ]]; then
    error "Game zip not found! Please type path to ${_gamedir}.zip (/home/user):"
    read pkgpath
    
    if [[ ! -f "${pkgpath}/${_gamedir}.zip" ]]; then
      error "Unable to find game zip!  Aborting!" && return 1
    fi
  fi
  
  msg "Found game zip, unzipping..."
  unzip "${pkgpath}/${_gamedir}.zip" -d "${srcdir}" > /dev/null
}

package() {
  install -d "${pkgdir}/usr/share/besiege"
  install -d "${pkgdir}/usr/share/besiege/Besiege_Data"
  install -d "${pkgdir}/usr/bin"
  install -d "${pkgdir}/usr/share/applications"
  
  cp -r ${srcdir}/${_gamedir}/Besiege_Data/* "${pkgdir}/usr/share/besiege/Besiege_Data"
  install -m755 "${srcdir}/${_gamedir}/Besiege.${_arch}" "${pkgdir}/usr/share/besiege/Besiege"
  install -m755 "${srcdir}/besiege" "${pkgdir}/usr/bin/besiege"
  install -m644 "${srcdir}/besiege.desktop" "${pkgdir}/usr/share/applications/besiege.desktop"
}
