diff -ru medit-0.10.5.orig/plugins/moopython/moopython-pygtkmod.h medit-0.10.5/plugins/moopython/moopython-pygtkmod.h
--- medit-0.10.5.orig/plugins/moopython/moopython-pygtkmod.h	2010-12-06 14:35:08.000000000 -0500
+++ medit-0.10.5/plugins/moopython/moopython-pygtkmod.h	2010-12-06 14:35:29.000000000 -0500
@@ -20,7 +20,7 @@
 G_GNUC_UNUSED static void
 init_pygtk_mod (void)
 {
-    PyObject *gobject, *pygtk;
+    PyObject *gobject;
     PyObject *mdict;
     PyObject *cobject;
 
@@ -29,7 +29,7 @@
 
     mdict = PyModule_GetDict (gobject);
     cobject = PyDict_GetItemString (mdict, "_PyGObject_API");
-
+    
     if (!cobject || !PyCObject_Check (cobject))
     {
         PyErr_SetString (PyExc_RuntimeError,
@@ -38,21 +38,13 @@
     }
 
     _PyGObject_API = (struct _PyGObject_Functions *) PyCObject_AsVoidPtr (cobject);
-
-    if (!(pygtk = PyImport_ImportModule("gtk._gtk")))
-        return;
-
-    mdict = PyModule_GetDict (pygtk);
-    cobject = PyDict_GetItemString (mdict, "_PyGtk_API");
-
-    if (!cobject || !PyCObject_Check (cobject))
-    {
-        PyErr_SetString (PyExc_RuntimeError,
-                         "could not find _PyGtk_API object");
+    
+    void *capsule = PyCapsule_Import("gtk._gtk._PyGtk_API", 0);
+    if (!capsule) {
         return;
     }
-
-    _PyGtk_API = (struct _PyGtk_FunctionStruct*) PyCObject_AsVoidPtr (cobject);
+    
+    _PyGtk_API = (struct _PyGtk_FunctionStruct*) capsule;
 }
 
 
