# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname='cuevanalinks-hg'
pkgver=88
pkgrel=1
pkgdesc="A program to download movies or series from cuevana.tv"
url="https://bitbucket.org/tin_nqn/cuevanalinks"
license='GPL3'
arch=('i686' 'x86_64')
depends=('plac>=0.8' 'python-pyquery>=0.5' 'python2-progressbar')
makedepends=('mercurial')
conflicts=('cuevanalinks')

_hgroot='https://bitbucket.org/tin_nqn'
_hgrepo='cuevanalinks'

build() {
   cd $srcdir

  # Update the repo, else clone a new one
   if [ -d $_hgrepo ]; then
   cd $_hgrepo
   hg pull -u
   else
   hg clone ${_hgroot}/${_hgrepo}
   cd $_hgrepo
   fi

   cd $srcdir/$_hgrepo

   # Python2 fix
   sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' setup.py 
   cd $_hgrepo
   for file in $(find . -name '*.py' -print); do
   sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
   done

   cd ..
   python2 setup.py install --root $pkgdir
}