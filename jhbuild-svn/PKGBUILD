# $Id$
# Contributor: graziano <graziano.giuliani@poste.it>

pkgname=jhbuild-svn
pkgver=2802
pkgrel=1
pkgdesc="\
Jhbuild is a program that can be used to pull a number of modules from CVS \
and build them in the correct order. \
Unlike some build scripts, jhbuild lets you specify what modules you want \
built and it will then go and build those modules plus dependencies."
arch=("i686" "x86_64")
license=('GPL')
depends=(python)
makedepends=(python autoconf automake libtool gettext pkgconfig rsync subversion)
source=( )
md5sums=( )
install=$pkgname.install
url="http://www.jamesh.id.au/software/jhbuild/"

_svntrunk="svn://svn.gnome.org/svn/jhbuild/trunk"
_svnmod=jhbuild-svn

build() {
    cd $startdir/src

    if [ -d $_svnmod/.svn ]; then
      (cd $_svnmod && svn up -r $pkgver)
    else
      svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    msg "SVN checkout done or server timeout"
    msg "Starting make..."

    cp -r $_svnmod $_svnmod-build
    cd $_svnmod-build

    CFLAGS+=' -DWITH_INSTALL=\"/bin/install\" ' \
    make -f Makefile.plain || return 1
    sed "s,@jhbuilddir@,/usr/bin,g" -i jhbuild.in
    make -f Makefile.plain bindir=$startdir/pkg/usr/bin \
         desktopdir=$startdir/pkg/usr/share/applications install || return 1
    PYVER=`python -V 2>&1 | \
           sed 's/Python[[:space:]]\+\([0-9]\+\.[0-9]\+\).*/\1/'`
    mkdir -p $startdir/pkg/usr/lib/python$PYVER/site-packages
    rsync -a --exclude=.svn jhbuild $startdir/pkg/usr/lib/python$PYVER/site-packages
    echo jhbuild > $startdir/pkg/usr/lib/python$PYVER/site-packages/jhbuild.pth
}
