# Maintainer: Somasis <somasissounds@gmail.com>
# Original Maintainer: evr <evanroman at gmail>
# Contributor: KRTac
# Contributor: BjÃ¶rn Pettersson <bjorn@hygiena.org>

pkgname=mpdscribble-git
pkgver=20140202
pkgrel=1
pkgdesc="A mpd client which submits information to a scrobbler, such as last.fm."
url="http://mpd.wikia.com/wiki/Client:Mpdscribble"
arch=('i386' 'x86_64')
license=('GPL')
depends=('curl' 'glib2' 'libmpdclient')
makedepends=('gcc' 'git' 'make')
conflicts=('mpdscribble')
provides=('mpdscribble')
install='mpdscribble.install'
source=('mpdscribble.install')
md5sums=('8349de9fd06cd5d25b8e52446ea96e9a')

_gitroot="git://git.musicpd.org/master/mpdscribble.git"
_gitname="mpdscribble"

package() {
    cd "$srcdir"
    msg "Connecting to $pkgname GIT server...."
    if [ -d "$srcdir/$_gitname" ] ; then
        cd $_gitname && git pull origin
        msg "The local files are updated."
    else
        git clone $_gitroot
    fi
    msg "GIT checkout done or server timeout."
    cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"
    msg "Starting autogen.sh and configuring..."
    ./autogen.sh --prefix="/usr" --sysconfdir="/etc"
    msg "Starting make..."
    make || return 1
    msg "Starting make install..."
    make DESTDIR="$pkgdir" install || return 1
    if [ -f "$pkgdir/etc/mpdscribble.conf" ];then
        rm "$pkgdir/etc/mpdscribble.conf"
    fi
    install -D -m644 "$srcdir/$_gitname/doc/mpdscribble.conf" "$pkgdir/etc/mpdscribble.conf.example"
    mkdir -p "$pkgdir/var/cache/mpdscribble"
    touch "$pkgdir/var/cache/mpdscribble/mpdscribble.cache"
}