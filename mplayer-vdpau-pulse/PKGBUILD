# Maintainer: tayhe <admin at tayhe dot com>
# Contributor: Xavion <Xavion (dot) 0 (at) Gmail (dot) com>
# Contributor: Echo Nolan <echo (at) echonolan (dot) net>
# Contributor: Gianni Vialetto <g (dot) vialetto (at) gmail (dot) com>

pkgname=mplayer-vdpau-pulse
pkgver=32792
pkgrel=1
pkgdesc='A movie player for linux, compiled with PulseAudio and Nvidia vddpau support'
license=('GPL')
url='http://www.mplayerhq.hu/'
arch=('i686' 'x86_64')
depends=('a52dec' 'aalib' 'cdparanoia' 'enca' 'faac' 'jack' 'libxxf86dga' 'libmad' 'libxinerama' 'libtheora' 'xvidcore' 'libmng' 'libxss' 'lame' 'libdca' 'libgl' 'smbclient' 'libcaca' 'x264' 'lirc-utils' 'ttf-dejavu' 'libxvmc'     
         'libvdpau>=0.4' 'opencore-amr' 'sdl' 'schroedinger' 'libvpx' 'pulseaudio')
makedepends=('unzip' 'mesa' 'live-media>=2010.09.25' 'yasm')
provides=("mplayer=${pkgver}")
conflicts=('mplayer')
backup=('etc/mplayer/codecs.conf' 'etc/mplayer/input.conf')
source=(http://mirror.internode.on.net/pub/archlinux/other/mplayer/mplayer-${pkgver}.tar.xz 
        mplayer.desktop 
	mplayer.png)
md5sums=('a48845de4b410ab7799ee87a038dd58e'
         'c0d6ef795cf6de48e3b87ff7c23f0319'
         'd00874ccc644b7f43d6ef1c942fcef28')



build() {
	# Custom CFLAGS break the mplayer build
	unset CFLAGS LDFLAGS

	cd ${srcdir}/mplayer

	# Build
	./configure --prefix=/usr \
	      --enable-runtime-cpudetection \
	      --disable-gui \
	      --disable-arts \
	      --disable-liblzo \
	      --disable-speex \
	      --disable-openal \
	      --disable-fribidi \
	      --disable-libdv \
	      --disable-musepack \
	      --disable-esd \
	      --disable-mga \
	      --enable-xvmc \
	      --language=all \
	      --confdir=/etc/mplayer \
	      --enable-pulse \
	      --enable-vdpau || return 1

	[ '$CARCH' = 'i686' ] &&  sed 's|-march=i486|-march=i686|g' -i config.mak

	make || return 1
	make -j1 DESTDIR=${pkgdir} install || return 1
	install -Dm644 etc/{codecs.conf,input.conf,example.conf} ${pkgdir}/etc/mplayer/ || return 1
	install -dm755 ${pkgdir}/usr/share/mplayer/
	ln -s /usr/share/fonts/TTF/DejaVuSans.ttf ${pkgdir}/usr/share/mplayer/subfont.ttf || return 1
	rm -rf ${pkgdir}/usr/share/mplayer/font
	#desktop file  FS#14770
	install -Dm644 ${srcdir}/mplayer.desktop ${pkgdir}/usr/share/applications/mplayer.desktop || return 1
    install -Dm644 ${srcdir}/mplayer.png ${pkgdir}/usr/share/pixmaps/mplayer.png || return 1
}
