# Maintainer: Daniel Milde <info@milde.cz>

pkgname=ikiwiki
pkgver=3.20110328
pkgrel=1
pkgdesc="wiki/blog compiler"
arch=(i686 x86_64)
license=('GPL')
url="http://ikiwiki.info"
depends=(perl-yaml perl-text-markdown perl-cgi-session perl-cgi-formbuilder perl-timedate perl-html-parser perl-html-scrubber perl-mail-sendmail perl-time-duration perl-uri perl-html-template perl-locale-gettext perl-rpc-xml)
source=("http://ftp.debian.org/debian/pool/main/i/${pkgname}/${pkgname}_${pkgver}.tar.gz")
md5sums=('4ab9f64367c13957b1db19ed8240d6a9')

build() {
  cd ${startdir}/src/${pkgname}

  # Install module into the vendor directories
  perl Makefile.PL PREFIX="/usr" INSTALLDIRS=vendor
  make PREFIX="/usr" || return 1
  make install DESTDIR=${startdir}/pkg || return 1

  # otherwise perl breaks
  find $startdir/pkg -name '.packlist' -exec rm '{}' \;
  find $startdir/pkg -name '*.pod' -exec rm '{}' \;

  #RST plugin docutils hack
  sed -i 's/env python/python2/' ${startdir}/pkg/usr/lib/ikiwiki/plugins/rst
}
