# Maintainer: Ben Ward <benjamin.ward@bathspa.org>
pkgname=rstudio-desktop
_altname=rstudio
pkgver=0.93.14
pkgrel=2
pkgdesc="A new integrated development environment (IDE) for R"
arch=('i686' 'x86_64')
url="http://www.rstudio.org/"
license=('AGPL')
depends=('qt' 'r' 'pango' 'openssl' 'bzip2' 'pam' 'java-runtime' 'unzip' 'glib2' 'libsm' 'libxrender' 'fontconfig' 'libxext')
makedepends=('git' 'cmake' 'boost' 'apache-ant')
source=(http://dl.dropbox.com/u/3277580/rstudio.tar.gz)
provides=('rstudio-desktop')
md5sums=('8575c74512ffb46a4b693320bdd0bb66')

build() {
  cd "${srcdir}/${_altname}"
  

  # link apache ant?
  if [ ! -e /usr/bin/ant ] ; then
    msg "Creating a link so that make can find apache ant"
    ln -s /usr/share/java/apache-ant/bin/ant /usr/bin/ant
  fi

  # install qt sdk
  msg "Downloading and installing Qt SDK"
  cd "${srcdir}/${_altname}/dependencies/linux"
  ./install-qt-sdk

  # Install gwt
  msg "Downloading and installing gwt"
  cd "${srcdir}/${_altname}/dependencies/common"
  ./install-dependencies-java

  # Configure and build
  msg "Configuring the makefile with cmake"
  mkdir "${srcdir}/${_altname}/build"
  cd "${srcdir}/${_altname}/build"
  cmake -DRSTUDIO_TARGET=Desktop -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/opt/rstudio ..
}

package() {
  msg "Starting make..."
  cd "${srcdir}/${_altname}/build"
  make DESTDIR="$pkgdir/" install
}
