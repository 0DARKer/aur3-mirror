# Maintainer: Jack Mitchell <jack@embed.me.uk>

pkgname=libwebsockets-git
pkgver=20130115
pkgrel=0

pkgdesc="C Websockets Server Library"
arch=(i686 x86_64)
url='http://git.warmcat.com/cgi-bin/cgit/libwebsockets'
license=(LGPL)

depends=()
makedepends=(git)
provides=('libwebsockets')

_gitroot="git://git.warmcat.com/libwebsockets"
_gitbranch="master"
_gitname="libwebsockets"

source=()
md5sums=()

build() {

  msg "Building ${pkgname}..."

  if [ -d "$_gitname" ] ; then
    warning 'Repository directory already exists!'
    cd "$_gitname"
    git checkout master
    msg2 "Pulling..."
    git pull "$_gitroot" master
  else
    msg2 "Cloning $_gitroot repository..."
    git clone "$_gitroot" "$_gitname"
    cd "$_gitname"
    git checkout "$_gitbranch"
  fi

  ./autogen.sh

  # Build without testapps for now as it triggers a GCC bug,
  # will keep checking with new revisions of GCC for when it
  # is fixed upstream.
  ./configure --prefix=/usr --without-testapps

  make
}

package(){

  msg "Packaging ${pkgname}..."
  cd "$_gitname"
  make DESTDIR="$pkgdir" install

} 

# Local Variables:
# mode: shell-script
# sh-basic-offset: 2
# End:
# vim:set ts=2 sw=2 et:
