# Maintainer: Arch Linux Pro Audio <archaudio-devel@archaudio.org>
# Contributor: Bj√∂rn Lindig <bjoern.lindig@googlemail.com>
pkgname=supercollider-git-with-plugins-svn
pkgver=20101116
pkgver_plugins=453
pkgrel=1
pkgdesc="An environment and programming language for real time audio synthesis and algorithmic composition. Extended package with SC3-Plugins."
url="http://supercollider.sourceforge.net/"
arch=('i686' 'x86_64')
license=('GPL')
depends=('jack' 'fftw' 'avahi' 'ruby' 'icu')
makedepends=('git' 'libsndfile>=1.0' 'emacs' 'vim' 'gedit' 'gcc>=3.0' 'pkgconfig>=0.14.0' 'scons>=0.96' 'alsa-lib')
#optdepends=('emacs' 'vim' 'ruby' 'gedit')
conflicts=('supercollider')
provides=('supercollider-git')

source=()
md5sums=()

_gitroot="git://supercollider.git.sourceforge.net/gitroot/supercollider/supercollider"
_gitname="supercollider"

# For the Plugins
_svntrunk="https://sc3-plugins.svn.sourceforge.net/svnroot/sc3-plugins"
_svnmod="sc3-plugins"


build() {
  cd $srcdir
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    (cd $_gitname && git pull origin)
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cp -r $_gitname $_gitname-build
  cd $_gitname-build/common
  
  scons PREFIX=/usr SCED=yes DEVELOPMENT=yes READLINE=yes || return 1
  scons DESTDIR=$pkgdir/ install || return 1

  scons -C ../editors/scvim PREFIX=$pkgdir/usr \
    VIMFILE_DIR=/usr/share/vim/addons install-system || return 1

  rm -rf $srcdir/$_svnmod-build

  msg "Done building SuperCollider"
  msg "Starting built of SC3-Plugins"

  cd $srcdir

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver_plugins $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."
  
  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build

  scons PREFIX=/usr SC3PATH=$srcdir/supercollider/common/ || return 1
  scons DESTDIR=$pkgdir/ install || return 1

  rm -rf $srcdir/$_svnmod-build
}
# vim:syntax=sh
