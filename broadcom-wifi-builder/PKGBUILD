# Maintainer: William DÃ­az <wdiaz [at] archlinux [dot] us>
## Maintainer: Alexandr Kotov nektokot at gmail dot com
## Maintainer: Paul N. Maxwell <msg [dot] maxwel [at] gmail [dot] com>

pkgname=broadcom-wifi-builder
pkgver=5.100.82.38
_filever=5_100_82_38
pkgrel=1
pkgdesc="Broadcom 802.11abg Networking Drivers Builder"
arch=('i686' 'x86_64')
[ "$CARCH" = "i686" ] && ARCH=x86_32
[ "$CARCH" = "x86_64" ] && ARCH=x86_64
url="http://www.broadcom.com/support/802.11/linux_sta.php"
license=('MIXED/Proprietary')
depends=('kernel26-headers' 'kernel26')
install=broadcom-wifi-builder.install
source=( http://www.broadcom.com/docs/linux_sta/hybrid-portsrc_${ARCH}-v${_filever}.tar.gz
         license.patch
         semaphore.patch
         mutex-sema.patch
         broadcom-wl )
md5sums=('cac172f7422fa43264049c7065fe21d6'
         '28719144598b7345b95295d705a5c887'
         '59e56c4e1d03fe1143f08886f41fe083'
         '3d8e98753598f2548e3f882dc595b513'
         '61e9abb7e2a33d55c5c6a0760fc1f8b0')
if [ "$CARCH" = "i686" ]; then
md5sums=('c0074a1622c75916442e26763ddf47d0'
         '28719144598b7345b95295d705a5c887'
         '59e56c4e1d03fe1143f08886f41fe083'
         '3d8e98753598f2548e3f882dc595b513'
         '61e9abb7e2a33d55c5c6a0760fc1f8b0')
fi

build() {
  install -d -m 755 ${pkgdir}/usr/src/broadcom-wl
  cd ${pkgdir}/usr/src/broadcom-wl
  tar -xvf ${srcdir}/hybrid-portsrc_${ARCH}-v${_filever}.tar.gz

  patch -p1 < "${srcdir}/license.patch"
  patch -p1 < "${srcdir}/semaphore.patch"
  patch -p1 < "${srcdir}/mutex-sema.patch"

  install -D -m 755 ${srcdir}/broadcom-wl ${pkgdir}/etc/rc.d/broadcom-wl
}

