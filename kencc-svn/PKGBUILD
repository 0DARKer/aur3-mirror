# Maintainer: Jens Staal <staal1978@gmail.com>

pkgname=kencc-svn
pkgver=20110920
pkgrel=1
pkgdesc="A port of the plan9 c-compiler"
arch=('i686' 'x86_64')
license=('MIT')
url="http://code.google.com/p/ken-cc/"
depends=('plan9port') #9base or plan9port
makedepends=('subversion')
options=(!strip)

source=('configure')
md5sums=('1ead297e7563ee42ad6801cd824c270b')

build() {
  cd $srcdir

# Update the repo, else clone a new one
	if [ -d ken-cc-read-only ]; then
		cd ken-cc-read-only
		svn up
		cd $srcdir
	else
		svn checkout http://ken-cc.googlecode.com/svn/trunk/ ken-cc-read-only
	fi


  rm -rf $srcdir/build
  cp -ar $srcdir/ken-cc-read-only $srcdir/build
  cd $srcdir/build
  cp $srcdir/configure $srcdir/build/configure
  ./configure --host Linux --target Linux --object 386
  PATH=$srcdir/build/bin:/opt/plan9/bin:$PATH
  mk
  mk install
}

package() {
  mkdir -p $pkgdir/opt/kencc/bin

  install -m755 $srcdir/build/bin/* $pkgdir/opt/kencc/bin/
  install -Dm644 $srcdir/build/NOTICE $pkgdir/usr/share/licences/kencc/NOTICE
}