#Maintainer: Shanto

pkgname=cairo-dock-plug-ins-bzr
pkgver=1969
pkgrel=1
pkgdesc="All official plugins for cairo-dock from the development branch"
url="http://www.glx-dock.org/"
license="GPL"
arch=('i686' 'x86_64')
groups=('lh')
depends=('cairo-dock-bzr' 'libdbusmenu' 'libetpan' 'ruby' 'python2')
makedepends=('bzr' 'intltool' 'perlxml' 'libxxf86vm' 'vte' 'cmake')
conflicts=('cairo-dock-plugins')
provides=('cairo-dock-plugins')
source=('python2.patch')
md5sums=('89d25a92a3cb800c7ea4126844cce9a5')


_bzrmod=cairo-dock-plug-ins
_bzrtrunk=http://bazaar.launchpad.net/~cairo-dock-team/cairo-dock-plug-ins/plug-ins/

build() {
  cd $srcdir/
  
  msg "Connecting to the server...."

  if [ ! -d ./${_bzrmod} ]; then
    bzr --no-plugins branch ${_bzrtrunk} ${_bzrmod} -r ${pkgver}
  else
    cd ${_bzrmod} && bzr --no-plugins pull ${_bzrtrunk} -r ${pkgver}
  fi

  msg "bzr checkout done or server timeout"

  msg "Removing old build directory..."
  rm -rf $srcdir/$_bzrmod-build
  msg "Creating build directory..."
  cp -r $srcdir/$_bzrmod $srcdir/$_bzrmod-build

  msg "Starting make..."
  cd $srcdir/$_bzrmod-build

  patch -p1 -i $srcdir/python2.patch

  cmake -DCMAKE_INSTALL_PREFIX=/usr -DROOT_PREFIX=$startdir/pkg \
  -Denable-network-monitor=yes \
  -Denable-disks=yes \
  -Denable-old-gnome-integration=yes \
  -Denable-doncky=yes \
  -Denable-scooby-do=yes \
  || return 1

  make || return 1
    
  make install DESTDIR=$startdir/pkg || return 1
      
rm -rf $srcdir/$_bzrmod-build 
}

