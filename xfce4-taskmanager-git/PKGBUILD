# Maintainer: Limao Luo <luolimao@gmail.com>
# Contributor: Raul Castillo <raulmuaddib@gmail.com>

pkgname=xfce4-taskmanager-git
pkgver=20120824
pkgrel=1
pkgdesc="Small taskmanager for the Xfce desktop"
arch=(i686 x86_64)
license=(GPL2)
url="http://www.xfce.org/"
groups=(xfce4-git)
depends=(libwnck)
makedepends=(git xfce4-dev-tools)
conflicts=(xfce4-taskmanager xfce4-taskmanager-svn)
provides=(xfce4-taskmanager)

_gitroot="git://git.xfce.org/apps/xfce4-taskmanager"
_gitname="xfce4-taskmanager"

build() {
    cd $srcdir
    msg "Getting sources..."
    
    if [ -d $srcdir/$_gitname ] ; then
	cd $_gitname && git pull origin
	msg "The local files are updated."
    else
	git clone $_gitroot
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting build..."

    cd $srcdir

    rm -rf $_gitname-build
    cp -r $_gitname $_gitname-build
    cd $_gitname-build


    rm -rf doc/
    ./autogen.sh  --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/lib/xfce4 --localstatedir=/var --disable-static
    echo -e "install:\n\t/bin/true" >> doc/Makefile
    _corecount=$(grep -i processor /proc/cpuinfo | wc -l)
    make -j$_corecount
}

package() {
    cd $srcdir/$_gitname-build/
    make DESTDIR=$pkgdir install

    cd doc/
    for i in index.*; do
	install -Dm644 $i $pkgdir/usr/share/doc/$pkgname/$i
    done
}
