# Maintainer: Philip MÃ¼ller <mail at philip.in-aachen dot net>
pkgname=opa-bin  
pkgver=1.0.5
pkgrel=2
build=2980
pkgdesc="advanced web framework and language"
url="http://www.opalang.org"
arch=('x86_64')
license=('AGPL')
depends=('openssl' 'gdbm' 'tcl' 'tk' 'libx11' 'nodejs')
optdepends=('mongodb: database backend')
provides=(opa)
conflicts=(opa-git)
replaces=()
source=(http://download.opalang.org/linux/opa_$pkgver%2Bbuild$build\_amd64.release.run)
md5sums=('721a56e5b94b9d9224cf0d19a92a85b0')
sha512sums=('69b2965a85028d53cca045377917481a2a9e482f5495cb1cc18769369a39cd12668c08ce41fa71866fbd76a96693b24a7cba8ff4dbd73227bd0cb644af8312f5')

build() {
  cd $srcdir
  chmod +x opa_$pkgver%2Bbuild$build\_amd64.release.run
}

check() {
  cd $srcdir
  ./opa_$pkgver%2Bbuild$build\_amd64.release.run --check
}

package() {
  cd $srcdir
  ./opa_$pkgver%2Bbuild$build\_amd64.release.run --target $srcdir/opa --noexec
  cp -a $srcdir/opa $pkgdir/usr
  $pkgdir/usr/share/opa/install.sh --dir $pkgdir/usr --prefix /usr

  chmod 755 $pkgdir/usr

  rm $pkgdir/usr/install.sh
  rm $pkgdir/usr/share/opa/uninstall.sh
  rm $pkgdir/usr/share/opa/install.sh
  rm -r $pkgdir/usr/lib/ocaml
  rm $pkgdir/usr/bin/ocamlopt.opt
}
