# Maintainer: Philip MÃ¼ller <mail at philip.in-aachen dot net>
pkgname=opa-bin  
version=1.0.5
_build=2988
_x86build=3078
pkgver=${version}_${_build}
pkgrel=2
pkgdesc="advanced web framework and language"
url="http://www.opalang.org"
arch=('i686' 'x86_64')
license=('AGPL')
depends=('openssl' 'gdbm' 'tcl' 'tk' 'libx11' 'nodejs')
optdepends=('mongodb: database backend')
provides=(opa)
conflicts=(opa-git)
replaces=()
_arch='amd64'
_source_path_prefix=''
[[ "${CARCH}" = i686 ]] && _source_path_prefix='i386/'

_source_script_name=opa_${version}%2Bbuild${_build}_amd64.release.run
[[ "${CARCH}" = i686 ]] && _source_script_name=opa_${version}%2Bbuild${_x86build}_i386.run

source=(http://download.opalang.org/linux/${_source_path_prefix}${_source_script_name})
md5sums=('51bafa9faef652d67ea17061fe17f6b1')
sha512sums=('e2949f9c1e6623581c2dd3bb46bf10d963c338eabc3fc01abcf4ee54ac29d1e9731ee9c0440cc6664c3b68f3a569ea504ba4cd21331f82467f6fc3f4c66cdc07')
[[ "${CARCH}" = i686 ]] && md5sums[0]='a6ea21100bfe75d3692fdcca04a7ab1e'
[[ "${CARCH}" = i686 ]] && sha512sums[0]='d533af41c8bddc27cf8cfc067866c662dd1b7f3f4a14a98f0fa6e82a3763dd41e13fe4dff178b8761474bc676ce55809446de25021c2d7ab7c1688dfb58fd4dd'

build() {
  cd $srcdir
  chmod +x $_source_script_name
}

package() {
  cd $srcdir
  ./$_source_script_name --target $srcdir/opa --noexec
  cp -a $srcdir/opa $pkgdir/usr
  $pkgdir/usr/share/opa/install.sh --dir $pkgdir/usr --prefix /usr

  chmod 755 $pkgdir/usr

  rm $pkgdir/usr/install.sh
  rm $pkgdir/usr/share/opa/uninstall.sh
  rm $pkgdir/usr/share/opa/install.sh
}
