# Contributor: M0Rf30
pkgname=xplico
pkgver=0.6.1
pkgrel=3
arch=(i686 x86_64)
pkgdesc="Internet Traffic Decoder. Network Forensic Analysis Tool (NFAT)"
url="http://www.xplico.org/"
install=xplico.install
license=('GPL')
depends=('libpcap' 'sqlite3' 'sox' 'lame' 'perl' 'ghostpdl' 'apache' 'php' 'perl' 'libnet' 'recode')

source=(http://download.berlios.de/xplicoprj/$pkgname-$pkgver.tgz
http://projects.xplico.org/patch/videosnarf_xplico.patch.gz
http://downloads.sourceforge.net/project/ucsniff/videosnarf/videosnarf-0.62.tar.gz
xplico.conf)
md5sums=('d9d1fd911eed3e0503a6a533c1d74fa6'
	 '807031684902a03c523b6dc191d450e9' 
         '6c7bca33ffd937b9a5fbc0fd11cca6a4'
	 'bb0d71769ec6fd6c9d8a1ab06baa7422')

build() {

    cd $srcdir/$pkgname-$pkgver

    msg "Updating the GeoLite City database..."
    wget -N http://geolite.maxmind.com/download/geoip/database/GeoLiteCity.dat.gz
    if [ -f GeoLiteCity.dat.gz ]; then gunzip GeoLiteCity.dat.gz; fi
    make
    make DESTDIR=$pkgdir install    
    install -Dp $srcdir/$pkgname.conf $pkgdir/etc/httpd/conf/extra/httpd-$pkgname.conf
    cd ..
    msg "Add videosnarf patched bin for Voip video decoding"
    patch -Np0 -i videosnarf_xplico.patch
    cd videosnarf-0.62
     aclocal && autoconf
     ./configure --prefix=/usr
     make
     cp src/videosnarf $pkgdir/opt/xplico/bin
     sed 's#TYPE = MYISAM#ENGINE = MYISAM#g' -i ${pkgdir}/opt/xplico/script/db/mysql/*

     
}

