# Contributor: Andreas Sch√∂nfelder <passtschu at freenet dot de>

pkgname=sun-wtk
pkgver=2.5.2
pkgrel=8
pkgdesc="Sun's wireless toolkit (includes ktoolbar and formerly known as j2me)"
license=('custom')
url='http://java.sun.com/products/sjwtoolkit/download-2_5_2.html'
depends=('libxt' 'bash' 'gcc-libs')
[ "$CARCH" = "x86_64" ] && \
  depends=('bin32-jre' ${depends[@]}) || \
  depends=('java-environment' 'java-runtime' ${depends[@]})
makedepends=('unzip')
arch=('i686' 'x86_64')
provides=('j2me')
install=sun-wtk.install
source=("http://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_Developer-Site/en_US/-/USD/VerifyItem-Start/sun_java_wireless_toolkit-${pkgver}_01-linuxi486.bin.sh?BundledLineItemUUID=SEFIBe.msLoAAAEoYT1y9RAs&OrderID=FN9IBe.mZdwAAAEoUz1y9RAs&ProductID=KXpIBe.pPIIAAAEeAO5T8B5l&FileName=/sun_java_wireless_toolkit-${pkgver}_01-linuxi486.bin.sh"
  'sun-wtk.profile'
  'ktoolbar.desktop'
  'ktoolbar.png'
  'LICENSE')
md5sums=('6b70b6e6d426eac121db8a087991589f'
         'ad05a8ccc053a4a1658317ac4df89a32'
         'ca7f128a0dd314cf28e2c7980b8b5cb8'
         '7b4b9c9da994f208dbd4c5dcdbd78926'
         '2297fdc5771ae9d0e8e9fc11d28b4728')

build() {
  install -d "${pkgdir}/etc/profile.d"
  install -m755 "${srcdir}/sun-wtk.profile" "${pkgdir}/etc/profile.d/sun-wtk.sh"

  install -d "${pkgdir}/opt/wtk"
  cd "${pkgdir}/opt/wtk"

  unzip -oqq "${srcdir}/sun_java_wireless_toolkit-${pkgver}_01-linuxi486.bin.sh"
  find . -type d -exec chmod 755 {} \;
  find . -type f -exec chmod 644 {} \;
  find bin/ -type f -exec chmod 755 {} \;
  cd bin
  [ "$CARCH" = "x86_64" ] && \
    sed -i 's/javapathtowtk=//g;s#${javapathtowtk}#/opt/bin32-jre/jre/bin/#g' \
      emulator || \
    sed -i 's/javapathtowtk=//g;s#${javapathtowtk}#${JAVA_HOME}/bin/#g' \
      defaultdevice emulator ktoolbar mekeytool prefs utils wscompile

  install -D -m644 "${srcdir}/ktoolbar.desktop" "${pkgdir}/usr/share/applications/ktoolbar.desktop"
  install -D -m644 "${srcdir}/ktoolbar.png" "${pkgdir}/usr/share/pixmaps/ktoolbar.png"

  cd ${srcdir}
  install -D LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
