# Maintainer: Ivan de Jesús Pompa García <ivan.pompa@gmx.com>

pkgname=textadept-latest-stable
pkgver=6.6
pkgrel=3
pkgdesc="A fast, minimalist, and ridiculously extensible cross-platform text editor. Package for GTK3."
arch=('i686' 'x86_64')
url="http://foicica.com/textadept"
license=('MIT')

depends=('gtk3'
		'lua'
		'desktop-file-utils')

conflicts=('textadept')
provides=('textadept')

source=(
	http://foicica.com/textadept/download/textadept_${pkgver}.src.zip
	textadept.desktop
	textadept.install
	fix-for-mv-libs.patch
)

md5sums=(
	fb4f713d4b00d40cb9234c53079462c0
	dd41525da62f8d63b77e5fdc4b514bc7
	97616a0ecda87a208f69c6ec471f2c23
	33531e46a59f667434e6512f8cf6be27
)


build() {
	cp fix-for-mv-libs.patch ${srcdir}/textadept_${pkgver}.src/src
	cd ${srcdir}/textadept_${pkgver}.src/src
	patch -Np1 < fix-for-mv-libs.patch
	cd ${srcdir}/textadept_${pkgver}.src/src
	make GTK3=1 -e CXX="g++ -lgobject-2.0 -lgmodule-2.0 -llua -lm -ldl" textadept || return 1
  make GTK3=1 -e CXX="g++ -fpermissive -lgmodule-2.0 -llua -lm -ldl" textadept-curses
}

package() {
	if [ ! -d "${pkgdir}/usr/share/textadept" ]; then
		mkdir -p ${pkgdir}/usr/share/textadept
	fi

	if [ ! -d "${pkgdir}/usr/share/doc/textadept" ]; then
		mkdir -p ${pkgdir}/usr/share/doc/textadept
	fi

	cd ${srcdir}/textadept_${pkgver}.src
	cp -R -t ${pkgdir}/usr/share/textadept core init.lua lexers LICENSE \
		modules themes textadept textadept-curses #textadeptjit textadeptjit-curses
	cp -R -t ${pkgdir}/usr/share/textadept core init.lua lexers LICENSE \
		modules themes textadept #textadeptjit
	cp -R doc/* ${pkgdir}/usr/share/doc/textadept

	install -D -m644 ${startdir}/textadept.desktop \
		${pkgdir}/usr/share/applications/${pkgname}.desktop
}

install=textadept.install
