# Maintainer: Pierre Neidhardt <ambrevar at gmail dot com>

_pkgname=demlo
pkgname=$_pkgname
_arcdir=ambrevar-$_pkgname-3b916fc32755
pkgver=1.6
pkgrel=2
pkgdesc="A dynamic and extensible music library organizer"
url="http://ambrevar.bitbucket.org/$_pkgname/"
arch=('any')
license=('MIT')
depends=('ffmpeg' 'lua' 'lua-dkjson' 'lua-filesystem' 'lua-llthreads2' 'lua-penlight' 'lua-socket' 'slnunicode-git')
optdepends=('chromaprint: Internet tagging')
source=(https://bitbucket.org/ambrevar/$_pkgname/get/v$pkgver.tar.bz2)
sha1sums=('f5cf4fd788c6aa1be76fbd9d074022cb98e9a3b0')

package() {
    cd "${srcdir}/$_arcdir"
    install -D -m755 $_pkgname.lua "${pkgdir}/usr/bin/$_pkgname"
    install -D -m644 LICENSE "${pkgdir}/usr/share/licenses/${_pkgname}/LICENSE"

    install -D -m644 ${_pkgname}rc "${pkgdir}/usr/share/${_pkgname}/${_pkgname}rc"

    for i in scripts/*; do
        install -D -m644 "$i" "${pkgdir}/usr/share/${_pkgname}/$i"
    done

    for i in $_pkgname/*; do
        install -D -m644 "$i" "${pkgdir}/usr/share/lua/5.2/$i"
    done

    ## Man page
    install -D -m755 -d "${pkgdir}/usr/share/man/man1/"
    gzip -c $_pkgname.1 > "${pkgdir}/usr/share/man/man1/$_pkgname.1.gz" && \
        chmod 644 "${pkgdir}/usr/share/man/man1/$_pkgname.1.gz"
}
