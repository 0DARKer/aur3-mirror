# Contributor: Artur Bednarek <artur@bednarek.org.pl>

pkgname='smc-svn'
pkgver=1500
pkgrel=1
pkgdesc="A classic 2D jump'n run sidescroller game in a style similar to the original SuperMario game"
url='http://www.secretmaryo.org'
license=('GPL3')
arch=('i686' 'x86_64')
source=()
md5sums=()
depends=('boost' 'cegui' 'libpng' 'sdl_image' 'sdl_mixer' 'sdl_ttf')
makedepends=('subversion' 'autoconf' 'automake')
conflicts=('smc')
provides=('smc')

_svntrunk='http://opensvn.csie.org/SMC/'
_svnmod='SMC'

build() {
cd $startdir/src

if [ -d $_svnmod/.svn ]; then
cd $_svnmod && svn up -r $pkgver && cd ..
else
svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
fi

msg 'SVN checkout done or server timeout'
msg 'Starting make...'

rm -rf $_svnmod-build
cp -r $_svnmod $_svnmod-build
cd $_svnmod-build

cd SMC

  ./autogen.sh || return 1
  ./configure --prefix=/usr/share --bindir=/usr/bin --datadir=/usr/share || return 1
  make install LDADD=-lpng DESTDIR=$startdir/pkg || return 1

  install -D -m644 $startdir/pkg/usr/share/smc/pixmaps/game/items/mushroom_red.png $startdir/pkg/usr/share/pixmaps/smc.png
  install -D -m644 $startdir/src/smc.desktop $startdir/pkg/usr/share/applications/smc.desktop

  cp -r data/music $startdir/pkg/usr/share/smc
}
