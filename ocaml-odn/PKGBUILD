# Maintainer: Magnus Therning <magnus@therning.org>
# Contributor: Sergei Lebedev <superbobry@gmail.com>
pkgname=ocaml-odn
pkgver=0.0.6
pkgrel=1
pkgdesc="OCaml data notation"
arch=('i686' 'x86_64')
url="https://forge.ocamlcore.org/projects/odn"
# LGPL + linking exception
license=('LGPL')
depends=('ocaml' 'ocaml-type-conv' 'ocaml-fileutils')
makedepends=('ocaml-findlib')
source=(https://forge.ocamlcore.org/frs/download.php/638/ocaml-data-notation-$pkgver.tar.gz
        type-conv-compat.patch)
md5sums=('32d916776f37c6439d52a0adf34da922'
         '68fcc2b59f1ac15335916d223511e21d')
options=(!strip)

build() {
    cd ${srcdir}/ocaml-data-notation-${pkgver}
    patch -Np0 < $startdir/type-conv-compat.patch
    ocaml setup.ml -configure --prefix /usr --destdir ${pkgdir} --disable-tests
    ocaml setup.ml -build
}

package() {
    cd ${srcdir}/ocaml-data-notation-${pkgver}
    OCAMLFIND_DESTDIR=${pkgdir}$(ocamlfind printconf destdir)
    mkdir -p $OCAMLFIND_DESTDIR
    OCAMLFIND_DESTDIR=$OCAMLFIND_DESTDIR ocaml setup.ml -install
}
