# Contributor: Bruno Tsubouchi Yporti <yporti@archlinux-br.org>
# Contributor: Ray Kohler <ataraxia937@gmail.com>
# Maintainer: Aurélien DESBRIÈRES <ice.cube@gmx.com>

# Category: office

pkgname=go-oo-bin-base
pkgver=3.2.1
_subver=3.2
_build=9505
pkgrel=2
pkgdesc="Go-OpenOffice, upstream unpatched binaries"
arch=('i686' 'x86_64')
url="http://go-oo.org/discover/"
license=('LGPL')
conflicts=('openoffice-base' 'go-openoffice')
makedepends=('rpmextract')
depends=('gtk2' 'fontconfig' 'libxtst' 'nss' 'libxaw' 'python')

[ "$CARCH" = "x86_64" ] && _arch=x86_64
[ "$CARCH" = "i686" ] && _arch=i586

source=(http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/ooobasis${_subver}-{core01,core02,core03,core04,core05,core06,core07,base,binfilter,calc,draw,impress,pyuno,xsltfilter,writer,javafilter,graphicfilter,ooolinguistic,math,images,ooofonts,en-US{,-base,-binfilter,-calc,-draw,-impress,-math,-res,-writer,-help}}-$pkgver-${_build}.${_arch}.rpm
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/ooobasis${_subver}-{core01,core02,core03,core04,core05,core06,core07,base,binfilter,calc,draw,impress,pyuno,xsltfilter,writer,javafilter,graphicfilter,ooolinguistic,math,images,ooofonts,en-US{,-base,-binfilter,-calc,-draw,-impress,-math,-res,-writer,-help}}-$pkgver-${_build}.${_arch}.rpm.md5
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org${_subver}-freedesktop-menus-${_subver}-${_build}.noarch.rpm
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org${_subver}-freedesktop-menus-${_subver}-${_build}.noarch.rpm.md5
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org-ure-1.6.1-${_build}.$_arch.rpm
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org-ure-1.6.1-${_build}.$_arch.rpm.md5
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org3{,-en-US,-base,-calc,-draw,-impress,-math,-writer}-$pkgver-${_build}.${_arch}.rpm
http://go-oo.mirrorbrain.org/stable/linux-${_arch}/${pkgver}/openoffice.org3{,-en-US,-base,-calc,-draw,-impress,-math,-writer}-$pkgver-${_build}.${_arch}.rpm.md5
template.desktop)

install=go-oo.install
optdepends=('gstreamer0.10-base: gstreamer support' 'mono: mono support')

build() {
	
    cd ${srcdir}
	
    for i in $(ls *.rpm); do
        rpmextract.sh $i
    done
    
    #"base" install
    cp ${srcdir}/opt ${pkgdir} -r
    cp ${srcdir}/usr ${pkgdir} -r
    rm ${pkgdir}/usr/{bin,share/applications} -r

    ## Step 1 
    cd ${pkgdir}/opt/openoffice.org || return 1
    mv ure/ basis${_subver}/ || return 1
    cd basis${_subver} || return 1
    rm ure-link && mv ure ure-link || return 1
    ## Step 2
    cd ${pkgdir}/opt/ || return 1
    mv openoffice.org/basis${_subver}/ openoffice.org3/ || return 1
    cd openoffice.org3/ || return 1
    rm basis-link && mv basis${_subver} basis-link || return 1
    ## Step 3        
    cd ${pkgdir}/opt/ || return 1
    rmdir ${pkgdir}/opt/openoffice.org || return 1
    mv openoffice.org3 go-oo || return 1

    # prepare filesystem entries
    mkdir -p ${pkgdir}/usr/{bin,share/applications}

    # make symlinks
    cd ${pkgdir}/usr/bin
    ln -s ../../opt/go-oo/program/soffice soffice
    ln -s ../../opt/go-oo/program/spadmin spadmin

    # install shortcuts
    mv ${pkgdir}/opt/go-oo/share/xdg/*.desktop  ${pkgdir}/usr/share/applications
    cd ${pkgdir}/usr/share/applications
    sed -i -e 's|Exec=openoffice.org3|Exec=/opt/go-oo/program/soffice|g' *.desktop || return 1
    sed -i -e 's|Exec=/opt/go-oo/program/soffice-printeradmin|Exec=/opt/go-oo/program/spadmin|g' printeradmin.desktop || return 1
    # fix .desktop name (to gooo)    
    sed -i -e 's|Name=OpenOffice.org|Name=Go-OO|g' *.desktop || return 1
    # fix exec commands in shortcuts for Xfce menu
    sed -i -e 's|base %U|base|g' base.desktop || return 1
    sed -i -e 's|calc %U|calc|g' calc.desktop || return 1
    sed -i -e 's|draw %U|draw|g' draw.desktop || return 1
    sed -i -e 's|impress %U|impress|g' impress.desktop || return 1
    sed -i -e 's|math %U|math|g' math.desktop || return 1
    sed -i -e 's|writer %U|writer|g' writer.desktop || return 1
    # remove quickstarter, we disabled it above
    rm -rf ${pkgdir}/usr/share/applications/qstart.desktop
    install -D -m644 ${srcdir}/template.desktop ${pkgdir}/usr/share/applications/template.desktop || return 1

    # fix ownership and permissions
    chown root.root -R ${pkgdir}/
    chmod +rX -R ${pkgdir}/usr

    # some cleanup
    find ${pkgdir}/usr/share/icons -depth -name "CVS" -type d -exec rm -r {} \; > /dev/null 2>&1

    # link the mozilla-plugin
    mkdir -p ${pkgdir}/usr/lib/mozilla/plugins/
    cd ${pkgdir}/usr/lib/mozilla/plugins/
    ln -s /opt/go-oo/program/libnpsoplugin.so .

}
md5sums=
md5sums=('75714a991cd9f42c095ff49afab5aae4'
         '1eaaebb993565e27164e72175e5e8a4c'
         'c820bea45fcb10c3dabd616754f6cb7d'
         '6967ec3530422762a36ffb139642d49f'
         '6484b4b9da11ba68889d3c3fa634c486'
         'a52db013ef3ed833749d507fdf96a0c5'
         '2ecd0f1d19ff36dd9da0f14be0a85637'
         '4b384a3d51d6daf81bd53eb25df53968'
         'a9150732b2489ee7ebdb986db70d866c'
         '42fd5dd83456ca1332cf37c68a4999b2'
         '02d4b4727db445f27dca2bb3aa5df3b9'
         '10498e993ef4999adeb933b942f58215'
         '8ab6b7e1d48d6dc7ed3a4f2faae99a32'
         'be6fa8b4fc1346e56601e9ce7dacab80'
         'c2542ce26b63a215fa8a669060c7f43f'
         'db406ecb35fbf0c785c91570cd40c0ac'
         '357866f475464e38a2d5aef69a4ea9f7'
         '9880722d1d33419e6dcd5907fe53e3c2'
         'fce4ea80e158a637f9d5724fd83a8eb3'
         'a55db9915bc11aab1c5046876c4989f5'
         '292fcb0bc95b57e8af65ed90c6126e07'
         'a87c281a75e835cf26b30586be3f6365'
         '75398379fc3ab299f19983a1b504daed'
         '3b1d93035b9b9e9b365321b1156227b9'
         '5ac5d1ab5b58b512057884a43de18519'
         'cd332c15c3211f5eae47ec15fb59ffd8'
         'f7991454063f5440a73a334984a0c204'
         'ea85c947cd181aed5f643d5c5b2b3503'
         'e2a6ff8281d409176d0a20e66098d646'
         'ef5e927a8b40c8f2d80ea7f602e80a71'
         '87286fdf1cd07cedc527c4132869b9cc'
         'de8982bfd8f9fad476a695ef52e28aab'
         '5c8ac2a533b69b3ce12a8bf1e21dae32'
         '17e50b95fad4c495053801166fb3560f'
         '53744c37b87915b45d682c8853b58d61'
         '9a85c20f9eb47117897d92040dbedf59'
         '0cafae232d729022d1f51fa04b8674d3'
         '6c56f4f9e21a7a3859da62c6dd358ca2'
         '9cabe7df282514e37a13847e72a6ba55'
         '7d25e79b7341334314a0cc39b02f0434'
         'a7234337ee1dec5609a57d073a84aeda'
         '224d1b0501534baff327bdf805b97871'
         'b6cfc83ec2e2de19d4f60d40f2745c83'
         '110070b011ae72d41a78e2720de8622b'
         'b9e135bb45dbbbdf218d0d337608fddd'
         'e56bfc788aa90cc248f82fe929ff7775'
         '8fec6d1a16bcfb8616c856472212a30b'
         '8d3aa43293bdf5c82cad9d0cb9ddae0d'
         'e485f46afbec6a8a6589ac20d751ef10'
         '1a1c7617c2e35f9384d6608da5847e99'
         'cf78b65c066ceedd2f07750d5501a83a'
         'cc29742947dc35dfd1c636cc9cecc5b7'
         '41909425d8ccf31339d08dedc6b5e620'
         'b057d0c678c0e3414fda5c49472ec991'
         'd78b52c09ac4d71200836015e49aafce'
         'c25cc78296350d35e025ae45f131aa54'
         '51f85ad28fc7b361775f166cad6dfdec'
         '87c004440813734b693f1474c027654d'
         '360468c72935672431cf76e776328672'
         'f631e96395c6978efb3920e3c1408409'
         '64be4aae00bb39a5102862ce3cfebe3b'
         '7472bf312ed4a987fc579193c8d1fbb7'
         'f4a4e94eab0b176eaca3ef3a6f24f811'
         '1e51874008c6f2ca9e18c35ec9aa97f1'
         '4208191561f9db1b73f0660a906c0829'
         '69489ae31e9d78d239f45fbb5f623d9a'
         '6a2c408331ebdbc5a488cf4e451a306a'
         'fbba28a44383057ea7bef2fdb335b35f'
         'd38af7cfef7c047d6bbd6a21f3620955'
         'e332d4d232548092197e258a464419d6'
         '6924c1f59586b70d4c387845e0de101c'
         'e062c1b81e07fb788a8f6946fee10fc2'
         'dcb7e40af81f159313082896d6b50531'
         '3ff49e8d1973f9f0525ba7809ca9212a'
         'a8f166632634a51c897e4b79498b7c3b'
         'f560e1e6c48fd24287d3459089373679'
         'a77b485d21025d310c618b82fb97dd0e'
         'af0430290078bdb8ed0aa1d3ccb22278'
         'fd87c4f1601d366aea965a88790fa113'
         '0cfad3312250efabd7149054f137d6ff'
         '6ab11659f8e3706760257f7d95b59902'
         'cede55283da0d31abf5d91da950d0e44'
         'aa60bf7a6495c5789839ee364277e913')
