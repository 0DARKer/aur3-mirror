# Contributor: graysky <graysky AT archlinux dot us>
# Contributor: Jordi Sanfeliu <jordi AT fibranet dot cat>

pkgname=monitorix
pkgver=2.1.1
pkgrel=1
pkgdesc='A lightweight system monitoring tool that uses rrd databases.'
arch=('any')
url=http://www.$pkgname.org/
license=('GPL')
_basedir="srv/http/monitorix"
_libdir="var/lib/$pkgname"
depends=('rrdtool' 'perl-libwww' 'perl-mime-lite' 'perl-cgi' 'perl-mailtools')
optdepends=('lm_sensors: enable support for system temp monitoring'
'smartmontools: enable support for hdd bad sector monitoring.'
'nvidia: enable support for nVidia card temp and usage monitoring.'
'hddtemp: enable support for hdd temp monitoring'
'terminus-font: if your graphs do not contain letters and numbers you may need this font package')
backup=(etc/$pkgname.conf)
source=($url$pkgname-$pkgver.tar.gz $pkgname.rc.d)
install=('readme.install')

package() {
 cd $srcdir/$pkgname-$pkgver
 install -D $pkgname $pkgdir/usr/bin/$pkgname
 mkdir -p $pkgdir/${_basedir}/cgi-bin
 install -D $pkgname.cgi $pkgdir/${_basedir}/cgi-bin/$pkgname.cgi
 mkdir $pkgdir/etc
 # use Arch defaults
 sed -e '/^our $BASE_DIR/ s,\/usr\/share,\/srv\/http,' -e '/^our $BASE_CGI/ s,-cgi,\/cgi-bin,' < $pkgname.conf > $pkgdir/etc/$pkgname.conf
 install -dm777 $pkgdir/${_basedir}/imgs
 mkdir -p $pkgdir/usr/share/doc
 install -D $pkgname.logrotate $pkgdir/etc/logrotate.d/$pkgname
 cp Changes COPYING $pkgname-{alert.sh,apache.conf} $pkgname.spec README README.{FreeBSD,nginx}  $pkgdir/usr/share/doc
 cp {logo_bot,logo_top,${pkgname}ico}.png $pkgdir/${_basedir}
 gzip -9 man/man8/$pkgname.8
 install -Dm644 man/man8/$pkgname.8.gz $pkgdir/usr/share/man/man8/$pkgname.8.gz
 gzip -9 man/man5/$pkgname.conf.5
 install -Dm644 man/man5/$pkgname.conf.5.gz $pkgdir/usr/share/man/man5/$pkgname.conf.5.gz
 mkdir -p $pkgdir/${_libdir}
 cp -r reports $pkgdir/${_libdir}
 install -D ../$pkgname.rc.d $pkgdir/etc/rc.d/$pkgname
}
sha256sums=('647b36ac80f15a805eecb68fc507334ebcbb0cb1fe7efd381eed6a7cf3bc0210'
            '0100234854812c6d49259afda88753047575ba8792200bc954dc5116ef1d8d6e')
sha256sums=('2419593ae00d2a083e7f5258bfab840b48c87be799e8186a599c0a28f4508e33'
            '0100234854812c6d49259afda88753047575ba8792200bc954dc5116ef1d8d6e')
