# Contributor: David Scholl <djscholl@gmail.com>
# Contributor: Fazlul Shahriar <fshahriar@gmail.com>
pkgname=hdf4-nonetcdf
pkgver=2.7
pkgrel=2
pkgdesc="General purpose library and file format for storing scientific data. (NetCDF disabled)"
arch=('i686' 'x86_64')
url="http://www.hdfgroup.org/hdf4.html"
license=('custom')
depends=('zlib' 'libjpeg')
makedepends=('gcc-libs' 'gcc-fortran' 'flex' 'bison')
provides=('hdf4')
conflicts=('hdf4')
source=(http://www.hdfgroup.org/ftp/HDF/HDF_Current/src/hdf-4.$pkgver.tar.gz)
md5sums=('146c3271165a378fb0d5a1be0f8abdf7')

build() {
  cd $startdir/src/hdf-4.$pkgver
  export CFLAGS=$CFLAGS" -fPIC"
  ./configure --prefix=/usr F77=gfortran --disable-netcdf --enable-shared --disable-fortran
  make || return 1
  make prefix=$startdir/pkg/usr install || return 1
  
  pkgdir=$startdir/pkg
  # rename files that conflict with netcdf package
  mv $pkgdir/usr/bin/ncdump $pkgdir/usr/bin/hdf4_ncdump
  mv $pkgdir/usr/bin/ncgen $pkgdir/usr/bin/hdf4_ncgen
  mv $pkgdir/usr/share/man/man1/ncdump.1 $pkgdir/usr/share/man/man1/hdf4_ncdump.1
  mv $pkgdir/usr/share/man/man1/ncgen.1 $pkgdir/usr/share/man/man1/hdf4_ncgen.1
  
  mkdir -p $pkgdir/usr/share/licenses/$pkgname
  cp $startdir/src/hdf-4.$pkgver/COPYING $pkgdir/usr/share/licenses/$pkgname
}
