# Maintainer: marc0s <marc0s@fsfe.org>
pkgname=xsser
pkgver=16
pkgrel=1
pkgdesc="A penetration testing tool for detecting and exploiting XSS vulnerabilites."
arch=('any')
url="http://xsser.sourceforge.net/"
license=('GPL3')
groups=('network')
depends=('python2' 'python-beautifulsoup' 'python-pycurl')
makedepends=('subversion')

_svntrunk="https://xsser.svn.sourceforge.net/svnroot/xsser/"
_svnmod="xsser"

install=
changelog=
source=()
noextract=()
md5sums=() #generate with 'makepkg -g'

build() {
  cd "${srcdir}"
  msg "Starting SVN checkout..."
  if [ -d $_svnmod/.svn ] ; then
    cd $_svnmod && svn up
  else
    svn co $_svntrunk --config-dir ./ $_svnmod
  fi
  msg "SVN checkout done or server timeout"

  msg "Copying files..."
  cd $srcdir/$_svnmod

  # no setup.py so... manual copying ahead
  mkdir -p $pkgdir/usr/lib/python2.7/site-packages
  cp -rvp xsser $pkgdir/usr/lib/python2.7/site-packages
  # clean up .svn directories
  rm -rf $pkgdir/usr/lib/python2.7/site-packages/xsser/.svn
  rm -rf $pkgdir/usr/lib/python2.7/site-packages/xsser/fuzzing/.svn
  rm -rf $pkgdir/usr/lib/python2.7/site-packages/xsser/post/.svn

  install -D -m755 XSSer.py $pkgdir/usr/bin/XSSer

  # install docs and man
  mkdir -p $pkgdir/usr/share/doc/xsser
  cp -rvp doc/* $pkgdir/usr/share/doc/xsser/
  rm $pkgdir/usr/share/doc/xsser/XSSer.1
  
  mkdir -p $pkgdir/usr/share/man/man1
  cp -vp doc/XSSer.1 $pkgdir/usr/share/man/man1/

  # fix for py2k
  sed -i "s|#!/usr/bin/env python$|#!/usr/bin/env python2|" $pkgdir/usr/bin/XSSer
  find $pkgdir/usr/lib/python2.7/site-packages/xsser/ -name '*.py' | \
      xargs sed -i "s|#!/usr/bin/env python$|#!/usr/bin/env python2|"
}

# vim:set ts=2 sw=2 et:
