# Maintainer: Marius L. Meyer <marius.l.meyer at gmail dot com>

pkgname=carl9170-driver
pkgver=2011_03_31
pkgrel=1
pkgdesc="A new WiFi driver for Atheros based USB dongles"
arch=('i686' 'x86_64')
url="http://wireless.kernel.org/en/users/Drivers/carl9170"
license=('GPL2')
depends=('kernel26' 'carl9170-fw')
makedepends=('linux-api-headers' 'kernel26-headers')
optdepends=(
	    'wireless-regdb:		The Linux'
	    'crda:			Wireless Team'
	    'iw:				recommends these'
	    'rfkill:			packages.')

options=()
install=$pkgname.install
source=(http://wireless.kernel.org/download/compat-wireless-2.6/compat-wireless-2011-03-31.tar.bz2)
md5sums=('25e283db60417429287e00103f52d54a')

build() {
  cd compat-wireless-2011-03-31
  ./scripts/driver-select carl9170
  make
}

package() {
  kernver=$(uname -r)
  mkdir -p $pkgdir/lib/modules/$kernver/updates/drivers/net/wireless/ath/carl9170
  mkdir -p $pkgdir/lib/modules/$kernver/updates/{compat,net/{mac80211,wireless}}
  cd compat-wireless-2011-03-31
  make KMODPATH_ARG="INSTALL_MOD_PATH=$pkgdir" install-modules
}

