# Maintainer: melchips <truphemus dot francois at gmail dot com>
# Contributor: atie H. <atie.at.matrix@gmail.com>
# Contributor: L42y <423300@gmail.com>

pkgname=sparkleshare-git
pkgver=20130318
pkgrel=1
pkgdesc="An open-source clone of Dropbox, written in Mono"
arch=('i686' 'x86_64')
url="http://www.sparkleshare.org/"
license=('LGPL')
depends=('mono' 'gtk-sharp-2' 'ndesk-dbus' 'ndesk-dbus-glib' 'intltool' 'webkit-sharp' 'notify-sharp')
makedepends=('git')
options=('!libtool')
source=(build_environment_mk.patch)
md5sums=('5594666ffbf205b83deb20d4b0f497b1')
_gitroot="git://github.com/hbons/SparkleShare.git"
_gitname="SparkleShare"

build() {
  msg "Connecting to SparkleShare GIT server...."

  if [ -d ${srcdir}/${_gitname} ] ; then
    cd ${srcdir}/${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone --depth 1 ${_gitroot}
  fi

  if [ -d ${srcdir}/${_gitname-build} ] ; then
    cd ${srcdir}/${_gitname-build} && git pull origin
  else
    cp -r ${srcdir}/${_gitname} ${srcdir}/${_gitname-build}
  fi

  cd ${srcdir}/${_gitname-build}
  msg "Patching for compiling with System.Web"
  patch -p1 < ../build_environment_mk.patch || return 0

  msg "Starting build"

  ./autogen.sh --prefix=/usr
  make
}

package() {
  cd ${srcdir}/${_gitname-build}

  make DESTDIR=${pkgdir} install

  install -m755 -d ${pkgdir}/usr/share/sparkleshare/html
  install -m755 -d ${pkgdir}/usr/share/sparkleshare/pixmaps  
}
