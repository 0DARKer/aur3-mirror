# Maintainer: Lukas Jirkovsky <l.jirkovsky@gmail.com>
pkgname=java-swing-joxy-git
pkgver=327.4361bb1
pkgrel=1
pkgdesc="Java Swing Look and Feel theme integrated with KDE Oxygen"
arch=('i686' 'x86_64')
url="https://sourceforge.net/projects/joxy/"
license=('GPL3')
depends=('java-runtime' 'qt4')
makedepends=('git' 'java-environment')
source=('joxy::git+git://git.code.sf.net/p/joxy/code' \
        remove-JAVA_HOME.diff)
md5sums=('SKIP'
         'df79f1fc2d827bdcba3728a54b891035')

pkgver() {
  cd "$srcdir/joxy"
  echo $(git rev-list --count master).$(git rev-parse --short master)
}

build() {
  cd "$srcdir/joxy"

  # source profile to make sure the $JAVA_HOME is defined
  if [ -f /etc/profile/openjdk6.sh ] ; then
    . /etc/profile/openjdk6.sh
  else
    . /etc/profile.d/jdk.sh
  fi

  # patch the compile script so it uses our JAVA_HOME
  git apply "$srcdir/remove-JAVA_HOME.diff" | true

  cd src

  # compile the java sources
  find joxy/ -name '*.java' -exec javac -bootclasspath "$JAVA_HOME/jre/lib/rt.jar" '{}' '+'
  # compile the libjoxy.so
  ./compile.sh

  # create a jar file
  find joxy/ -name '*.class' -exec jar cf joxy-$pkgver.jar '{}' '+'
}

package() {
  cd "$srcdir/joxy/src"

  install -Dm644 joxy-$pkgver.jar "$pkgdir/$JAVA_HOME/jre/lib/ext/joxy-$pkgver.jar"
  [ $CARCH == 'i686' ] && _arch=i386
  [ $CARCH == 'x86_64' ] && _arch=amd64
  install -Dm644 libjoxy.so "$pkgdir/$JAVA_HOME/jre/lib/$_arch/libjoxy.so"
}

# vim:set ts=2 sw=2 et:
