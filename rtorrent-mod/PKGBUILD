# Maintainer: karabaja4 <karabaja4 at archlinux.us>

pkgname=rtorrent-mod
pkgver=0.8.6
pkgrel=2
pkgdesc="rtorrent client -  with custom made interface and an IP filter"
arch=('i686' 'x86_64')
url="http://libtorrent.rakshasa.no"
license=('GPL')
depends=('libtorrent=0.12.6' 'curl>=7.14.3' 'xmlrpc-c>=1858')
source=(http://libtorrent.rakshasa.no/downloads/rtorrent-$pkgver.tar.gz
	rtorrent-mod-v2.patch
	rtorrent-0.8.6-ip_filter_no_boost-fast-bsd2.patch
	rtorrent.rc.example)
md5sums=('b804c45c01c40312926bcea6b55bb084'
	 'd7435f7a89d618b2856f029f54dd25fd'
	 'f47cb4ca2a2d580c10c4db258146b5d1'
	 'e4fcd2d10f6bd9a7d1e0068c64a1c087')
conflicts=('rtorrent' 'rtorrent-color' 'rtorrent-extended' \ 
	   'rtorrent-svn' 'rtorrent-unstable' 'rtorrent-vi-color')

build() {
  cd "$srcdir/rtorrent-$pkgver"
  
  #patch the interface
  msg "Patching interface..."
  patch -p1 -i ../rtorrent-mod-v2.patch

  #patch the ipfilter...
  msg "Patching ipfilter..."
  patch -p1 -i ../rtorrent-0.8.6-ip_filter_no_boost-fast-bsd2.patch

  #example file
  mkdir -p ${pkgdir}/usr/share/rtorrent-mod/example-rc/
  cp ${srcdir}/rtorrent.rc.example ${pkgdir}/usr/share/rtorrent-mod/example-rc/

  #make
  CXXFLAGS="$CXXFLAGS -fno-strict-aliasing" \
    ./configure --prefix=/usr --disable-debug --with-xmlrpc-c || return 1
  make || return 1
  make DESTDIR="$pkgdir" install
}
