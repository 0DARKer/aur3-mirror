# Contributor: Artiom MOLCHANOV
# Contributor: SpepS <dreamspepser at yahoo dot it>

pkgname=vloopback-svn
pkgver=22
pkgrel=2
pkgdesc="The video4linux loopback device is a device driver that generates video pipes. It lets a user program feed a video stream to another as if it were coming from an actual video4linux device."
url="http://www.lavrsen.dk/twiki/bin/view/Motion/VideoFourLinuxLoopbackDevice"
replaces=('vloopback')
provides=('vloopback')
makedepends=('subversion' 'kernel26-headers')
conflicts=('vloopback')
license=('GPL')
arch=('i686' 'x86_64')
source=( $pkgname.install )
install=$pkgname.install
md5sums=('a1b019d93bad8aeb072e23bbc392b2d6')

_svntrunk=http://www.lavrsen.dk/svn/vloopback/trunk/

_svnmod=vloopback

build() {
    cd $startdir/src

    if [ -d $_svnmod/.svn ]; then
        (cd $_svnmod && svn up)
    else
        svn co $_svntrunk $_svnmod
    fi

    msg "SVN checkout done or server timeout"
  
    cd $_svnmod
        sed '183 i#include <linux/slab.h>' -i vloopback.c || return 1
        make || return 1
        kernelver=`uname -r`
        mkdir -p $startdir/pkg/lib/modules/$kernelver/kernel/drivers/misc
        cp vloopback.ko $startdir/pkg/lib/modules/$kernelver/kernel/drivers/misc/.

}


