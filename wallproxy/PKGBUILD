# Maintainer: 謝致邦 <Yeking@Red54.com>

pkgname=wallproxy
pkgver=2.1.18.1
pkgrel=1
pkgdesc="A http and socks proxy based on Google App Engine."
arch=("any")
url="http://github.com/Red54/wallproxy"
license=("GPL2")
depends=('python2' 'python2-pyopenssl')
source=(git+$url#tag=v$pkgver
        $pkgname.service)
backup=('etc/wallproxy')
install=wallproxy.install
md5sums=('SKIP'
         '6585482b4a969054224b2532b5fa6a10')

package() {
  cd $srcdir/$pkgbase
  chmod +x local/startup.py server/uploader.py
  mkdir -p $pkgdir/{etc,usr/share/$pkgbase}
  cp -r * $pkgdir/usr/share/$pkgbase
  mv $pkgdir/usr/share/$pkgbase/local/proxy.ini $pkgdir/etc/wallproxy
  ln -s /etc/wallproxy ${pkgdir}/usr/share/$pkgname/local/proxy.ini
  install -Dm644 "${srcdir}/wallproxy.service" "${pkgdir}/usr/lib/systemd/system/wallproxy.service"
}
