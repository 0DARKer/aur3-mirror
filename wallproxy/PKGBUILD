# Maintainer: Toshio Xiang <snachx at gmail dot com>

pkgname=wallproxy
pkgver=2.1.19
pkgrel=1
pkgdesc="A http and socks proxy based on Google App Engine."
arch=("any")
url="https://github.com/wallproxy/wallproxy"
license=("GPL2")
depends=('python2' 'python2-pyopenssl')
source=($pkgname-$pkgver.tar.gz::https://github.com/wallproxy/wallproxy/archive/v2.1.19.tar.gz
        $pkgname.service)
backup=('etc/wallproxy')
install=wallproxy.install
md5sums=('SKIP'
         '6585482b4a969054224b2532b5fa6a10')

package() {
  cd $srcdir/$pkgname-$pkgver/
  chmod +x local/startup.py server/uploader.py
  mkdir -p $pkgdir/{etc,usr/share/$pkgname}
  cp -r * $pkgdir/usr/share/$pkgname
  mv $pkgdir/usr/share/$pkgname/local/proxy.ini $pkgdir/etc/wallproxy
  ln -s /etc/wallproxy ${pkgdir}/usr/share/$pkgname/local/proxy.ini
  install -Dm644 "${srcdir}/wallproxy.service" "${pkgdir}/usr/lib/systemd/system/wallproxy.service"
}
