# arg 1: new package version
# arg 2: old package version

post_install() {
	post_upgrade $1 $2
}

post_upgrade() {
	echo ">>> Adding capablities"
	if [[ -x $(type -P capinstall) ]] ; then
		capinstall /usr/bin/uchsmack cap_mac_admin =ep
		capinstall /usr/bin/usmackexec cap_mac_admin =ep
	else
		echo ">>> capability-helper is not installed"
		if [[ -x $(type -P setcap) ]] ; then
			echo ">>> Setting capability CAP_MAC_ADMIN"
			setcap cap_mac_admin=ep /usr/bin/uchsmack
			setcap cap_mac_admin=ep /usr/bin/usmackexec
		else
			echo ">>> libcap is not installed, adding setuid-root bit instead."
			chmod 4755 /usr/bin/uchsmack
			chmod 4755 /usr/bin/usmackexec
		fi
	fi
}
