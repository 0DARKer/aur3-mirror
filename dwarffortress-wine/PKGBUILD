# Contributor: Tarinaky <tarinaky@gmail.com>
# Maintainer: Paul Bienkowski <opatutlol@aol.com>
pkgname=dwarffortress-wine
pkgver=0.31.16
pkgrel=1
pkgdesc="Windows version of Dwarf Fortress: a single-player fantasy themed game."
arch=(i686 x86_64)
url="http://www.bay12games.com/dwarves/"
license=('custom:dwarffortress')
depends=(wine)
makedepends=(unzip)

ver_string1=${pkgver//./_}
ver_string2=${ver_string1/0/}
source=("http://www.bay12games.com/dwarves/df${ver_string2}_win.zip")
noextract=("df${ver_string}_win.zip")
md5sums=('4ea944347d7c9c29ee8b11100f9fa471')

build() {
    #cd "$srcdir/$pkgname-$pkgver"
    cd "$srcdir"
    mkdir -p "$pkgdir/usr/share/df-wine/"
    mkdir -p "$pkgdir/usr/bin/"
    unzip "df${ver_string2}_win.zip" -d "$pkgdir/usr/share/df-wine/"

    echo "#!/bin/bash" > $pkgdir/usr/bin/df-wine
    echo "unset WINEPREFIX" >> $pkgdir/usr/bin/df-wine
    echo "if [ ! -d $HOME/.df-wine ] ; then" >> $pkgdir/usr/bin/df-wine
    echo "mkdir -p $HOME/.df-wine" >> $pkgdir/usr/bin/df-wine
    echo "#prepare the environment here" >> $pkgdir/usr/bin/df-wine
    echo "cp -r /usr/share/df-wine/* $HOME/.df-wine/" >> $pkgdir/usr/bin/df-wine
    echo "fi" >> $pkgdir/usr/bin/df-wine
    echo "cd $HOME/.df-wine/" >> $pkgdir/usr/bin/df-wine
    #echo "WINEDEBUG=-all wine dwarfort.exe $@" >> $pkgdir/usr/bin/df-wine
    echo "WINEDEBUG=-all wine $HOME/.df-wine/Dwarf\ Fortress.exe $@" >> $pkgdir/usr/bin/df-wine

    chmod +x $pkgdir/usr/bin/df-wine
    
    install -Dm644 $pkgdir/usr/share/df-wine/readme.txt $pkgdir/usr/share/licenses/$pkgname/readme.txt 
}

# vim:set ts=2 sw=2 et:
