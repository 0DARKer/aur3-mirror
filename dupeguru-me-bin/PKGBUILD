# Maintainer: Dan Serban
# Contributor: SiD

pkgname=dupeguru-me-bin
pkgver=6.x.x
pkgrel=1
pkgdesc="Find duplicate songs in your music collection"
arch=(i686 x86_64)
url=http://www.hardcoded.net/dupeguru_me/
license=(custom:Fairware)
depends=(python pyqt sip)
makedepends=(lynx)
_filearch=i386
[ "${CARCH}" == "x86_64" ] && _filearch=amd64

build()
{
  rm dupeguru-me_*.deb 2>/dev/null || true
  _url=$(lynx -dump http://www.hardcoded.net/dupeguru_me/ | grep -o http.*${_filearch}.deb | tail -1)
  wget ${_url}
  bsdtar -xf $(basename ${_url}) data.tar.gz
  bsdtar -xf data.tar.gz
  rm data.tar.gz
  rm usr/local/share/dupeguru_me/sip.so
  cd usr/local/share/dupeguru_me
  rm -rf PyQt4
  mkdir -p "${pkgdir}"/usr/bin
  cd "${srcdir}"/usr
  mv share "${pkgdir}"/usr/
  cd local/share
  mv dupeguru_me "${pkgdir}"/usr/share/
  sed -i 's|#!/usr/bin/env python3.1|#!/usr/bin/python|' "${pkgdir}"/usr/share/dupeguru_me/run.py
  USRBINFILE="${pkgdir}"/usr/bin/dupeguru_me
  echo "#!/bin/bash" > "$USRBINFILE"
  echo "cd /usr/share/dupeguru_me" >> "$USRBINFILE"
  echo "python run.py" >> "$USRBINFILE"
  chmod +x "$USRBINFILE"
}

