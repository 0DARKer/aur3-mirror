# Contributor: Sam Whited <sam@samwhited.com>

pkgname=copy
pkgver=1.28.0657
pkgrel=1
pkgdesc="An application for syncing files with Copy."
arch=('i686' 'x86_64')
url="https://www.copy.com/home/"
license=('custom:copy')
depends=('gcc-libs' 'glibc' 'qtwebkit' 'libpng12')
options=(!strip staticlibs)
source=("copy_agent-${pkgver}.tgz::https://copy.com/install/linux/Copy.tgz")
INTEGRITY_CHECK=('sha512')
sha512sums=('ba34a8711c5cbd3c0d461a4e4d9b46d7f24c0fc91db780b846e1d24ea513bdd3a28bfc3a20ba1c9a6a93ee8cb824dee4376f8c70ba23a15b07bc4d0bdc6e5dfe')

if [ "$CARCH" = "x86_64" ]; then
    _arch='x86_64'
elif [ "$CARCH" = "i686" ]; then
    _arch='x86'
fi

build() {
    # Get binary sources.
    tar -xzf copy_agent-${pkgver}.tgz
}
package() {
    install -d $pkgdir/{opt/copy/imageformats,usr/bin}

    # Install files.
    cd $srcdir/copy/$_arch/
    find . -type d -exec install -d {,${pkgdir}/opt/copy/}{} \;
    find . -type f -exec install -D -m 644 {,${pkgdir}/opt/copy/}{} \;

    # Make Copy executable.
    chmod 755 ${pkgdir}/opt/copy/Copy{Agent,Cmd,Console}

    # TODO: Generate copy.desktop
    # install -D -m644 $pkgdir/opt/copy/copy.desktop $pkgdir/usr/share/applications

    ln -s /opt/copy/Copy{Agent,Cmd,Console} $pkgdir/usr/bin/
}
