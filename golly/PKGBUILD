# Maintainer: p2k <Patrick.Schneider@uni-ulm.de>
pkgname=golly
pkgver=2.1
pkgrel=2
pkgdesc="Game of Life simulator"
arch=('i686' 'x86_64')
url="http://golly.sourceforge.net/"
license=('GPL')
depends=('wxgtk>=2.7' 'perl>=5.8' 'python')
source=(http://downloads.sourceforge.net/golly/golly-$pkgver-src.tar.gz)
md5sums=('c00bc9dc7ea3cc80f32177b2d48c42bb')

build() {
	cd $srcdir/golly-$pkgver-src

	patch -Np0 <<EOF
--- makefile-gtk	2010-01-27 09:41:39.000000000 +0100
+++ makefile-gtk	2010-01-27 09:42:02.000000000 +0100
@@ -29,7 +29,7 @@
 # than 5.10 (this is necessary because boot_DynaLoader is in DynaLoader.a);
 # if using 5.10 or later we can dynamically load the Perl library because
 # it contains the boot_DynaLoader code
-PERL_LINK = \`perl -MExtUtils::Embed -e '\$\$]<5.010 && ldopts'\`
+PERL_LINK = \`perl -MExtUtils::Embed -e ldopts\`
 
 # for Python script support
 PYTHON_INCLUDE = -I\`python -c "import distutils.sysconfig; print distutils.sysconfig.get_python_inc()"\`
EOF

	make -f makefile-gtk || return 1

	mkdir -p $pkgdir/opt/golly
	install golly $pkgdir/opt/golly/golly
	install bgolly $pkgdir/opt/golly/bgolly
	cp -R Scripts $pkgdir/opt/golly/Scripts
	cp -R Patterns $pkgdir/opt/golly/Patterns
	cp -R Help $pkgdir/opt/golly/Help
	cp -R Rules $pkgdir/opt/golly/Rules

	mkdir -p $pkgdir/usr/bin
	cat >$pkgdir/usr/bin/golly <<EOF
#!/bin/bash

cd /opt/golly

./\`basename \$0\` \$*
EOF
	cp $pkgdir/usr/bin/golly $pkgdir/usr/bin/bgolly
	chmod +x $pkgdir/usr/bin/golly $pkgdir/usr/bin/bgolly
}
