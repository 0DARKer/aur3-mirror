# $Id: pkgbuild-mode.el,v 1.23 2007/10/20 16:02:14 juergen Exp $
# Maintainer: Sebastien Binet <binet@farnsworth>
pkgname=libdispatch-svn 
pkgver=188
pkgrel=1
pkgdesc="The libdispatch project consists of the user space implementation of the Grand Central Dispatch API"
url="http://libdispatch.macosforge.org/"
arch=('i686' 'x86_64')
license=('Apache')
depends=('libkqueue')
makedepends=('gcc' 'subversion' 'pkgconfig')
optdepends=('llvm-compiler-rt: for C-Blocks (closures) runtime support')
conflicts=('libdispatch')
provides=('libdispatch')
backup=()

source=(configure.ac.patch)
md5sums=('64b79e49e06417694e41694fd5212775')


_svntrunk=http://svn.macosforge.org/repository/libdispatch/trunk
_svnmod=$pkgname

build() {
  cd $startdir/src
  /bin/rm -rf ${_svnmod}
  msg "fetching sources from SVN..."
  svn co ${_svntrunk} -r ${pkgver} ${_svnmod} || return 1
  
  cd $startdir/src
  patch -p0 < $startdir/src/configure.ac.patch || return 1

  cd $startdir/src/$pkgname
  sh ./autogen.sh || return 1

  cd $startdir/src/$pkgname
  ./configure --prefix=/usr || return 1
  make || return 1
  make DESTDIR=$startdir/pkg install || return 1

  # remove libtool file
  /bin/rm $startdir/pkg/usr/lib/libdispatch.la
}
