# Maintainer: Somebody <somebody[at]foo[dot]tld>

pkgname=ldiag
pkgver=3.1.0.4738
pkgrel=2
pkgdesc="The Lenovo Linux Diagnostics tools"
url="http://support.lenovo.com/us/en/docs/LENV-DIAGS"
arch=('i686' 'x86_64')
license=('custom')
depends=('libsystemd')
optdepends=('qt4: Graphical interface' 'gksu: Provide permissions through graphical interface')

if [ "$CARCH" == "x86_64" ]; then
  source=("http://download.lenovo.com/ibmdl/pub/pc/pccbbs/thinkvantage_en/redhat-x64-${pkgver//[-._]/}.rpm"
          "http://download.lenovo.com/ibmdl/pub/pc/pccbbs/thinkvantage_en/redhat-x64-${pkgver//[-._]/}.txt"
          "lsc_lite.desktop"
          "lsc_lite.png")
  md5sums=('f310688b2fbea4f03ebd41af3686b5e8'
           '816b84afdbcc6dc9ce74a4e32eae5b97'
           '0a78b374e8fdef0829a3af417830c6b6'
           '2feec035e0c1cfaa71cd09577c52a308')
  sha512sums=('f7b3e673746ef3dfc68472eed99ded9168ad1a33d867a9ddf223010d85e73a0d268afd27773ad81f28865a5e002322c2d0a1df5d7ddb16bde1390f6baf434173'
              '6413a66b8fcdb019e4941ff0ae1cb74d6d835aac7f3bb15a4ac3bed4f98d1444560b97b833fd7658bd132f4e4243a327107267dbba017284075d00bac198ad67'
              'c27278e0fbc72ae1d2d6be65d6c8860e9eda9db6c0e570db6b3fa25a89c7367fef8d2fe33466cdcd8cda11705d4114e412b4dffe08fb743d52ec9f404f9aace7'
              'fe0c17b79f2b53efe04ac546970708294a4b001702c0793be985c0b3668c6f5e32af579201a11e91d8fe45da17e7ec2798386821435a117488798aadd5a1f809')
elif [ "$CARCH" == "i686" ]; then
  source=("http://download.lenovo.com/ibmdl/pub/pc/pccbbs/thinkvantage_en/redhat-x86-${pkgver//[-._]/}.rpm"
          "http://download.lenovo.com/ibmdl/pub/pc/pccbbs/thinkvantage_en/redhat-x86-${pkgver//[-._]/}.txt"
          "lsc_lite.desktop"
          "lsc_lite.png")
  md5sums=('4e4eb4b0e3ad3c9f1e1712151bb43926'
           'ecce7209343a78f5ee9cbec4040b53c0'
           '0a78b374e8fdef0829a3af417830c6b6'
           '2feec035e0c1cfaa71cd09577c52a308')
  sha512sums=('e408cfd56d54419d9c0e7b20d53646993d1bab3e9e553b881ee1a722e3c264a2773478cce66037967b04535f79fb09e42550de61092f447d1f630134459539f9'
              'd4a4c56fc3010d3a8e3894d355185403a3b2a0e6378ba4616ea796a717dacdd6a6f527302dd973bd38853940057f2998697272dc8794a8bf434e749f257d0d7f'
              'c27278e0fbc72ae1d2d6be65d6c8860e9eda9db6c0e570db6b3fa25a89c7367fef8d2fe33466cdcd8cda11705d4114e412b4dffe08fb743d52ec9f404f9aace7'
              'fe0c17b79f2b53efe04ac546970708294a4b001702c0793be985c0b3668c6f5e32af579201a11e91d8fe45da17e7ec2798386821435a117488798aadd5a1f809')
fi

package() {
  mkdir -p "${pkgdir}"/opt/lenovo/ldiag "${pkgdir}"/usr/bin "${pkgdir}"/usr/share/{applications,pixmaps}
  cp "${srcdir}"/opt/lenovo/ldiag/* "${pkgdir}"/opt/lenovo/ldiag
  install -D -m644 "${srcdir}/redhat-x64-${pkgver//[-._]/}.txt" "${pkgdir}/usr/share/licenses/ldiag/license.txt"
  install -D -m644 "${srcdir}/lsc_lite.desktop" "${pkgdir}"/usr/share/applications
  install -D -m644 "${srcdir}/lsc_lite.png" "${pkgdir}"/usr/share/pixmaps
  ln -s /usr/lib/libudev.so "${pkgdir}"/opt/lenovo/ldiag/libudev.so.0
  ln -s /opt/lenovo/ldiag/lsc_cli "${pkgdir}"/usr/bin/lsc_cli
  ln -s /opt/lenovo/ldiag/lsc_lite "${pkgdir}"/usr/bin/lsc_lite
}
