# Contributor: Essien Ita Essien <me@essienitaessien.com>

pkgname=kannel
pkgver=1.4.1
pkgrel=3
pkgdesc="Opensource WAP/SMS Gateway"
url="http://www.kannel.org"
license=("custom:KSL")
arch=(i686 x86_64)
depends=('libxml2>=2.2.5' 'libmysqlclient' 'postgresql-libs')
makedepends=(sqlite3)
conflicts=(kannel-mbuni)
provides=(kannel)
groups=(wasp-core)
backup=(etc/kannel.conf)
source=(http://www.kannel.org/download/$pkgver/gateway-$pkgver.tar.bz2 kannel.conf modems.conf smsbox.conf wapbox.conf smsc.conf sendsms-user.conf sms-service.conf rc.bearerbox rc.smsbox rc.wapbox rc.kannel COPYING)
md5sums=('ae78aec906931e2af73f5a6245520cca'
         'c600bc5f10c366467b20a2669e88a478'
         '8420dd67817fbbbcd25cf22375c750de'
         'c847b4c71c53434fe215c694a861716b'
         '2be848c4af28c5b62707e8db3bb1e7c5'
         '4efdd09e08d7e1491b6b578e81219d80'
         '009538b72eedf61682567c63cdcde531'
         '904c0f74de53559e2e109d5d619a2f63'
         '7ec78fa67898902c5d8fc18808103c9e'
         '672c562c8e069223b806c2c2b144bcfc'
         '2bc8228eb403f485723bf286e2b2e16e'
         'ed4234b82177bf6745729e49dfdab82b'
         '03e9fa6510e7957e651adbe338deabd2')

build() {
  cd $startdir/src/gateway-$pkgver
  ./configure --prefix=/usr --with-pgsql --with-mysql
  make || return 1
  make DESTDIR=$startdir/pkg install
  make DESTDIR=$startdir/pkg install-test

  install -D -m 664 $startdir/src/kannel.conf $startdir/pkg/etc/kannel/kannel.conf
  install -D -m 664 $startdir/src/modems.conf $startdir/pkg/etc/kannel/modems.conf
  install -D -m 664 $startdir/src/smsbox.conf $startdir/pkg/etc/kannel/smsbox.conf
  install -D -m 664 $startdir/src/wapbox.conf $startdir/pkg/etc/kannel/wapbox.conf
  install -D -m 664 $startdir/src/smsc.conf $startdir/pkg/etc/kannel/smsc.conf
  install -D -m 664 $startdir/src/sendsms-user.conf $startdir/pkg/etc/kannel/sendsms-user.conf
  install -D -m 664 $startdir/src/sms-service.conf $startdir/pkg/etc/kannel/sms-service.conf

  install -D -m 775 $startdir/src/rc.bearerbox $startdir/pkg/etc/rc.d/bearerbox
  install -D -m 775 $startdir/src/rc.smsbox $startdir/pkg/etc/rc.d/smsbox
  install -D -m 775 $startdir/src/rc.wapbox $startdir/pkg/etc/rc.d/wapbox
  install -D -m 775 $startdir/src/rc.kannel $startdir/pkg/etc/rc.d/kannel

  install -D -m 644 $startdir/src/COPYING $startdir/pkg/usr/share/licenses/$pkgname/COPYING

  mkdir -p $startdir/pkg/var/log/kannel/
}




