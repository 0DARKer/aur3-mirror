# Maintainer: Yngve Inntjore Levinsen <yngve.inntjore.levinsen@cern.ch>


pkgname=geant4
pkgver=4_9_3_p02_1
# geant4 must be linked against a specific clhep version!
_clhepver=2.0.4.7
_clhepdebver=2.0.4.7-1
conflicts=('clhep')
provides=("clhep=${_clhepver}")
pkgrel=2
pkgdesc=""

makedepends=('deb2targz' 'tar')
optdepends=('gnuplot: Plotting functionality' 'root: Analytical framework' 'dawn: Tool to display geometry' 'gv: Postscript viewer' 'cernlib: PAW support and/or g3tog4 support?')
_pkgver=4.9.3.p02-1
arch=('x86_64' 'i686')
license=('http://geant4.web.cern.ch/geant4/license/')
url="http://cern.ch/geant4"
if [ "${CARCH}" = "x86_64" ]; then
md5sums=('de689f18641cfbf8f48e08d3ab9ff138'
         '2e0fdd48d82bcc68ab427c24f4433851'
         'b4187e33d5ca4b914bbac8781ef4044b'
         '6147d7e7331ff7371ff6ae766822054c'
         '5ed1195b51a82be2e4874fde8ff6b2bc'
         '6ac0f05bc4f275995a6db04052c11fd1'
         '4af7425c0e4315533432a595ddb00da6'
         '891af1cf767adbdcb5da87f3f7881819'
         '4f36be076c9fea26e7533a434c2449ff'
         'c6dd80b0463dd80e6b2ebf21e2f39a0f'
         'd4adecc37f228f26849e6585e15bb4bc'
         '7ad93542e3417694ba20cbc1a8603457')
_carch=amd64
elif [ "${CARCH}" = "i686" ]; then
md5sums=('de689f18641cfbf8f48e08d3ab9ff138'
         '2e0fdd48d82bcc68ab427c24f4433851'
         'b4187e33d5ca4b914bbac8781ef4044b'
         '6147d7e7331ff7371ff6ae766822054c'
         '62f097f82e43653c460c31223cbb7c84'
         '236bb0cf4d1b95ad3c951281034193c0'
         '86b99f3d72de15b21f5e3612176712e3'
         'e80c11f6435a1a194fe6005baf6ef172'
         '843be57a6072da435e1bd8560ff10f3b'
         'b9ced7047a783d5c5c253ab34ad0869c'
         '768704ab6bdb407e6249485b98881b26'
         'a62a7bb8f06ef8d0052ddc9bca40abbf')
 _carch=i386
fi

depends=('libx11' 'libxcb' 'glibc' 'zlib' 'libgl' 'libxaw' 'lesstif' 'libxmu' 'xerces-c-2') # "clhep==${_clhepver}")

source=(
  geant4-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/geant4_${_pkgver}_all.deb"
  geant4-common-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/geant4-common_${_pkgver}_all.deb"
  geant4-headers-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/geant4-headers_${_pkgver}_all.deb"
  geant4-examples-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/geant4-examples_${_pkgver}_all.deb"
  libgeant4-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libgeant4-4.9-6_${_pkgver}_${_carch}.deb"
  libgeant4-dev-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libgeant4-dev_${_pkgver}_${_carch}.deb"
  libgeant4-plists-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libgeant4-plists-4.9-6_${_pkgver}_${_carch}.deb"
  libgeant4-plists-dev-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libgeant4-plists-dev_${_pkgver}_${_carch}.deb"
  libg4opengl-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libg4opengl-4.9-6_${_pkgver}_${_carch}.deb"
  libg4opengl-dev-$pkgver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/g/${pkgname}/libg4opengl-dev_${_pkgver}_${_carch}.deb"
# Use this if the clhep version in aur is not the same as required for geant4:
   clhep-$_clhepver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/c/clhep2/clhep2_${_clhepdebver}_${_carch}.deb"
   clhep-dev-$_clhepver.deb::"http://lcg-heppkg.web.cern.ch/lcg-heppkg/debian/pool/hep/c/clhep2/clhep2-dev_${_clhepdebver}_${_carch}.deb"
)

build() {
  install -d ${pkgdir}/usr/share/licenses/${pkgname}
  pwd
  deb2targz geant4-$pkgver.deb > /dev/null
  deb2targz geant4-common-$pkgver.deb > /dev/null
  deb2targz geant4-headers-$pkgver.deb > /dev/null
  deb2targz geant4-examples-$pkgver.deb > /dev/null
  deb2targz libgeant4-$pkgver.deb > /dev/null
  deb2targz libgeant4-dev-$pkgver.deb > /dev/null
  deb2targz libgeant4-plists-$pkgver.deb > /dev/null
  deb2targz libgeant4-plists-dev-$pkgver.deb > /dev/null
  deb2targz libg4opengl-$pkgver.deb > /dev/null
  deb2targz libg4opengl-dev-$pkgver.deb > /dev/null
  deb2targz libg4opengl-$pkgver.deb > /dev/null
  deb2targz libg4opengl-dev-$pkgver.deb > /dev/null
  tar -xzf geant4-$pkgver.tar.gz
  tar -xzf geant4-common-$pkgver.tar.gz
  tar -xzf geant4-headers-$pkgver.tar.gz
  tar -xzf geant4-examples-$pkgver.tar.gz
  tar -xzf libgeant4-$pkgver.tar.gz
  tar -xzf libgeant4-dev-$pkgver.tar.gz
  tar -xzf libgeant4-plists-$pkgver.tar.gz
  tar -xzf libgeant4-plists-dev-$pkgver.tar.gz
  tar -xzf libg4opengl-$pkgver.tar.gz
  tar -xzf libg4opengl-dev-$pkgver.tar.gz
#   #adding clhep:
   deb2targz clhep-$_clhepver.deb
   deb2targz clhep-dev-$_clhepver.deb
   tar -xzf clhep-$_clhepver.tar.gz
   tar -xzf clhep-dev-$_clhepver.tar.gz

  cp -r usr/ ${pkgdir}/
  cp -r etc/ ${pkgdir}/
  install -D -m644 usr/share/doc/${pkgname}/copyright ${pkgdir}/usr/share/licenses/${pkgname}/
  }

post_install() {
  msg "This install of Geant4 does not set up the environment variables."
  msg "Instead, it has installed three scripts, g4make, g4run, and g4env"
  msg "In order to compile a Geant4 project, use the command 'g4make'"
  msg "In order to run a Geant4 project, use 'g4run <executable>'"
  msg "In order to view your current environment setting, use 'g4run g4env'"
}
