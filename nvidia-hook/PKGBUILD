# Maintainer: Alucryd <alucryd at gmail dot com>

pkgname=nvidia-hook
pkgver=2.2
pkgrel=1
pkgdesc="mkinitcpio hook to compile the NVIDIA modules"
url="https://github.com/Alucryd/mkinitcpio-hooks"
arch=('any')
license=('GPL3')
depends=('nvidia-source')
install=${pkgname}.install
source=("https://raw.github.com/Alucryd/mkinitcpio-hooks/master/nvidia")
sha256sums=('1f1b0f539e214d16b1a11d8095fc6bc9f8368f0a5d13e1b1a49155cd6afb0176')

package() {
  cd "${srcdir}"
  install -dm 755 "${pkgdir}/usr/lib/modprobe.d"
  echo "blacklist nouveau" >> "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
  chmod 644 "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
  install -dm 755 "${pkgdir}/usr/lib/initcpio/install"
  sed -i "s|arch|$CARCH|g" nvidia
  install -m 644 nvidia "${pkgdir}/usr/lib/initcpio/install/nvidia"
}

# vim: ts=2 sw=2 et:
