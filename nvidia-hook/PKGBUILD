# Maintainer: Alucryd <alucryd at gmail dot com>

pkgname=nvidia-hook
pkgver=2.1
pkgrel=3
pkgdesc="mkinitcpio hook to compile the NVIDIA modules"
url="http://www.nvidia.com/"
arch=('any')
license=('GPL3')
depends=('nvidia-source')
install=${pkgname}.install
source=("https://raw.github.com/Alucryd/mkinitcpio-hooks/master/nvidia")
sha256sums=('0d9e4e87113f327db0310fc116d97d4bdcf61a9b7f79244b8ef2af4638d57b99')

package() {
	cd "${srcdir}"
	install -dm 755 "${pkgdir}/usr/lib/modprobe.d"
	echo "blacklist nouveau" >> "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
	chmod 644 "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
	install -dm 755 "${pkgdir}/usr/lib/initcpio/install"
	sed -i "s|arch|$CARCH|g" nvidia
	install -m 644 nvidia "${pkgdir}/usr/lib/initcpio/install/nvidia"
}
