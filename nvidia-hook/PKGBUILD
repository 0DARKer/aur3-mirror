# Maintainer: Alucryd <alucryd at gmail dot com>

pkgname=nvidia-hook
pkgver=2.1
pkgrel=3
pkgdesc="mkinitcpio hook to compile the NVIDIA modules"
url="http://www.nvidia.com/"
arch=('any')
license=('GPL3')
depends=('nvidia-source')
install=${pkgname}.install
source=("https://raw.github.com/Alucryd/mkinitcpio-hooks/master/nvidia")
md5sums=('4309f1a2e7cc01fad8c41646d8676eab')

package() {
  cd "${srcdir}"
  install -dm 755 "${pkgdir}/usr/lib/modprobe.d"
  echo "blacklist nouveau" >> "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
  chmod 644 "${pkgdir}/usr/lib/modprobe.d/nvidia.conf"
  install -dm 755 "${pkgdir}/usr/lib/initcpio/install"
  sed -i "s|arch|$CARCH|g" nvidia
  install -m 644 nvidia "${pkgdir}/usr/lib/initcpio/install/nvidia"
}
