# Maintainer: Alex Chamberlain <alex@alexchamberlain.co.uk>
_name=jq
pkgname=$_name
pkgver=1.1
pkgrel=3
epoch=
pkgdesc="Command-line JSON processor"
arch=('i686' 'x86_64')
url="http://stedolan.github.com/jq/"
license=('custom')
groups=()
depends=()
makedepends=('python2' 'git')
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
#source=('git://github.com/stedolan/jq.git#tag=$_name-$pkgver')
source=("$_name-$pkgver.patch")
noextract=()
md5sums=('34d165169e23f7d627d79d4d7db0c890')

__gitroot=https://github.com/stedolan/jq.git
__gitname=$_name-$pkgver
__gittag=$__gitname


build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ ! -d "$__gitname" ]]; then
    git clone "$__gitroot" "$__gitname" 
  fi

  cd "$srcdir/$__gitname"
  git checkout $__gitname

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$__gitname-build"
  mkdir "$srcdir/$__gitname-build"
  cd "$srcdir/$__gitname" && ls -A | grep -v .git | xargs -d '\n' cp -r -t "../$__gitname-build" # do not copy over the .git folder
  cd "$srcdir/$__gitname-build"

  patch -p1 -i ../../$__gitname.patch
  make prefix=/usr
}

package() {
  cd "$srcdir/$__gitname-build"
  make DESTDIR="$pkgdir/" prefix=/usr install

  install -D -m 0644 COPYING "$pkgdir/usr/share/licenses/jq/COPYING"
}

# vim:set ts=2 sw=2 et:
