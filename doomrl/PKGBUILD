# Contributor: KillaB <xGenoBlast@gmail.com>
# Contributor: wizzomafizzo <wizzomafizzo@gmail.com>

pkgname=doomrl
pkgver=0.9.9.1
pkgrel=1
pkgdesc="A roguelike game based on the FPS Doom."
arch=("i686" "x86_64")
url="http://doom.chaosforge.org/"
license="unknown"
[ "$CARCH" = "i686" ]   && depends=("sdl_mixer" "libx11" "zlib" "lua" "timidity-eawpatches")
[ "$CARCH" = "x86_64" ] && depends=("lib32-sdl_mixer" "lib32-libx11" "lib32-zlib" "lib32-smpeg" "lib32-lua" "timidity-eawpatches")
source=("http://doom.chaosforge.org/file_download/6/doomrl-linux-0991.tar.gz" "doomrl")
md5sums=('0b2dfc795c4550c8d848233561c1aebd' '9a4fb2ae47ec81f6792deb1e1d19edb6')

build() {
	cd "$srcdir/doomrl-linux-0991"

	# Copy program and required files
	mkdir -p "$pkgdir/usr/share/doomrl"
	cp -a * "$pkgdir/usr/share/doomrl"

	# Copy script used to run program
	install -D "$srcdir/doomrl" "$pkgdir/usr/bin/doomrl"

	# Needed to fix sound
	mkdir -p "$pkgdir/etc/"
	ln -s "/etc/timidity++/timidity.cfg" "$pkgdir/etc/timidity.cfg"

	# Ugly workaround for liblua
	mkdir -p "$pkgdir/usr/lib"
	[ "$CARCH" = "i686" ] && ln -s "/usr/lib/liblua.so.5.1" "$pkgdir/usr/lib/liblua5.1.so.0"
	[ "$CARCH" = "x86_64" ] && ln -s "/opt/lib32/usr/lib/liblua.so.5.1" "$pkgdir/usr/lib/liblua5.1.so.0"

	# This is needed to save games and scores
	chmod 4755 "$pkgdir/usr/share/doomrl/doomrl"
}
