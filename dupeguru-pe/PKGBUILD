# Maintainer: Virgil Dupras <hsoft@hardcoded.net>
pkgname=dupeguru-pe
pkgver=2.7.1
pkgrel=1
pkgdesc="Find duplicate pictures on your system"
arch=(i686 x86_64)
url="http://www.hardcoded.net/dupeguru_pe/"
license=('BSD')
depends=('python' 'pyqt')
makedepends=(
  'python-distribute'
  'python-pip'
  'python-virtualenv'
  'python-sphinx'
  'gcc'
)
source=("http://concurrencykit.org/releases/ck-$pkgver.tar.gz")
md5sums=('eea3abcb896a6450ec1433199154b6a5')
source=(http://download.hardcoded.net/$pkgname-src-$pkgver.tar.gz
        dupeguru-pe.desktop)
md5sums=('c8d085533d776093fe6331f92e80b6f3'
         'd608a0829d158362c5276507f62d87f3')

build() {
  cd "$srcdir/$pkgname-src-$pkgver"
  if [[ ! -d "env" ]]; then
    msg "Creating virtualenv"
    virtualenv --system-site-packages env
  fi
  
  msg "Installing dependencies"
  source env/bin/activate
  pip install -r requirements.txt
  
  msg "Starting build..."
  python configure.py --edition pe
  python build.py --clean
}

package() {
  cd "$srcdir"
  mkdir -p "${pkgdir}/usr/share/applications"
  cp ${pkgname}.desktop "${pkgdir}/usr/share/applications"
  
  cd "$pkgname-src-$pkgver"
  python package.py
  cd "build/${pkgname}-arch"
  
  mkdir -p "$pkgdir/usr/share/${pkgname}"
  cp -a * "$pkgdir/usr/share/${pkgname}/"
  chmod a+x "$pkgdir/usr/share/${pkgname}/run.py"
  
  mkdir -p "$pkgdir/usr/bin"
  ln -s ../share/${pkgname}/run.py "$pkgdir/usr/bin/${pkgname}"
}
