# $Id: PKGBUILD 111946 2014-05-27 08:42:58Z jgc $
# Maintainer : Martin Wimpress <code@flexion.org>

pkgname=topmenu-gtk3-git
_gitname=topmenu-gtk
pkgver=2014.12.21
pkgrel=2
pkgdesc="A standalone global menu bar for Gtk+ 2.0 based desktop environments."
url="https://gitorious.org/topmenu"
arch=('i686' 'x86_64')
license=('LGPL3')
depends=('gtk3')
makedepends=('git')
options=(!libtool)
source=("git://gitorious.org/topmenu/$_gitname.git" 'gtk3-panel-colors-fix.patch')
sha1sums=('SKIP' '8dae31b202aeb5236734b7af3334b37dd2c075a0')

pkgver() {
   cd "$_gitname"
   git log -1 --format="%cd" --date=short | sed 's|-|.|g'
}

build() {
   cd "${srcdir}/${_gitname}"

   # patch from https://launchpad.net/~webupd8team/+archive/ubuntu/mate/+packages
   patch -Np1 -i "$srcdir/gtk3-panel-colors-fix.patch"

   autoreconf -fi
   ./configure --prefix=/usr --with-gtk=3 --with-wnck=wnck1 --disable-static
   make
}

package() {
    cd "${srcdir}/${_gitname}"
    make DESTDIR="${pkgdir}" install
    rm -rf "${pkgdir}/usr/include"
}
