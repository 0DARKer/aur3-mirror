# Maintainer: Carl Reinke <mindless2112 gmail com>
pkgname=include-what-you-use
pkgver=2.9.1
_pkgver=2.9-1
pkgrel=1
pkgdesc="A tool for use with clang to analyze #includes in C and C++ source files"
url="http://code.google.com/p/include-what-you-use/"
license=('LLVM Release License')
install=
changelog=
source=(
	http://include-what-you-use.googlecode.com/files/${pkgname}-${_pkgver}.tar.gz
	http://llvm.org/releases/2.9/llvm-2.9.tgz
	http://llvm.org/releases/2.9/clang-2.9.tgz
)
noextract=()
sha1sums=(
	'7c28c1d23b52d64574292707a5807d25aa2e2043'
	'500f587f840199ac53c4fc7572839d08fa9d9123'
	'5fd3b5cec050ec12858c1602b23cf096282ad4a4'
)
groups=()
arch=(i686 x86_64)
backup=()
depends=()
makedepends=('gcc' 'llvm=2.9' 'clang=2.9')
optdepends=('python')
conflicts=()
provides=()
replaces=()
options=()

build()
{
	cd "${srcdir}"
	
	mv "${pkgname}" clang-2.9/tools/
	mv clang-2.9 llvm-2.9/tools/clang
	
	cd "${srcdir}/llvm-2.9/tools/clang/tools/${pkgname}"
	
	g++ -D_DEBUG -D_GNU_SOURCE -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS -fno-rtti -I `llvm-config --includedir` -L `llvm-config --libdir` *.cc -lclangFrontend -lclangSerialization -lclangDriver -lclangSema -lclangAnalysis -lclangAST -lclangParse -lclangLex -lclangBasic -lLLVMipo -lLLVMScalarOpts -lLLVMInstCombine -lLLVMTransformUtils -lLLVMipa -lLLVMAnalysis -lLLVMTarget -lLLVMMC -lLLVMCore -lLLVMSupport -lpthread -ldl -lm -o include-what-you-use
}

package()
{
	cd "${srcdir}/llvm-2.9/tools/clang/tools/${pkgname}"
	
	install -Dm755 include-what-you-use "${pkgdir}/usr/bin/iwyu"
	install -Dm755 fix_includes.py "${pkgdir}/usr/bin/iwyu-fix_includes.py"
}

