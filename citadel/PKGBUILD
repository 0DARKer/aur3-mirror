# Maintainer: nnnn20430 <nnnn20430@mindcraft.si.eu.org>
pkgname=citadel
pkgver=v8.24.r0.gdc36da8
pkgrel=1
pkgdesc="Citadel/UX is a collaboration suite (messaging and groupware) that is descended from the Citadel family of programs which became popular in the 1980s and 1990s as a bulletin board system platform."
arch=('i686' 'x86_64')
url="http://www.citadel.org/"
license=('GPL')
depends=('libev' 'c-ares' 'curl' 'expat' 'libical' 'libsieve' 'perl-berkeleydb')
makedepends=('libev' 'c-ares' 'curl' 'expat' 'libical' 'libsieve' 'perl-berkeleydb' 'libtool' 'autoconf' 'make' 'gcc')
optdepends=('openssl: SSL support' 'shared-mime-info: filetype identification')
provides=('libcitadel')
conflicts=()
changelog=""
source=("git://git.citadel.org/appl/gitroot/citadel.git")
install="citadel.install"
md5sums=('SKIP')

#prepare() {
#  cd "$pkgname"
#  git checkout v8.24
#}

pkgver() {
  cd "$pkgname"
  git checkout v8.24
  git describe --long | sed -r 's/([^-]*-g)/r\1/;s/-/./g'
}

build() {
	cd "$srcdir/citadel/libcitadel"
	./bootstrap
	./configure --prefix=/usr
	make
	cd "$srcdir/citadel/citadel"
	./bootstrap
        ./configure --prefix=/usr/local/citadel
	make
}

package() {
	cd "$srcdir/citadel/libcitadel"
	make DESTDIR="$pkgdir" install
        cd "$srcdir/citadel/citadel"
        make DESTDIR="$pkgdir" install
	mkdir -p "$pkgdir/usr/lib/systemd/system"
	cp "$startdir/citadel.service" "$pkgdir/usr/lib/systemd/system/citadel.service"	
}
