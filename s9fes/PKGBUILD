# $Id:$
# Contributor: Balwinder S "bdheeman" Dheeman (bdheeman AT gmail.com)

pkgname=s9fes
pkgver=20090906
pkgrel=4
pkgdesc="Scheme 9 from Empty Space"
arch=('i686' 'x86_64')
url=http://t3x.org/s9fes/
license=('custom')
depends=('libx11>=1.2.2-1')
source=(http://t3x.org/s9fes/$pkgname-$pkgver.tar.gz
	'Makefile.patch')

build() {
    cd $srcdir/$pkgname-$pkgver
    for p in $srcdir/*.patch; do
	msg "Applying patch ${p##*/}"
	patch -sp1 < ${p} || return 1
    done

    case $CARCH in
	i686|i[3-5]86)
	    msg "Starting make '$CARCH'..."
	    make all || return 1
	    make all-s9e || return 1
	    make all-s9sc || return 1
	    ;;
	x86_64)
	    msg "Starting make '$CARCH'..."
	    make -DBITS_PER_WORD_64 all || return 1
	    make -DBITS_PER_WORD_64 all-s9e || return 1
	    make -DBITS_PER_WORD_64 all-s9sc || return 1
	    ;;
	# The following should not happen; provided you're using 'makepkg' ;)
	*) error "Unknown or invalid CARCH=$CARCH"; return 1
    esac
    make DESTDIR=$pkgdir install || return 1
    make DESTDIR=$pkgdir install-s9e || return 1
    make DESTDIR=$pkgdir install-s9sc || return 1

    msg "Install LICENSE..."
    install -Dm644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}

# vim:set ts=4 sw=4 et:
md5sums=('1fd9e5678ab1687ddea9ddca7f98008c'
         '814292bf3977d52ba9b2f51c0330e8cc')
