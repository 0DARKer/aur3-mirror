# $Id: $
# Maintainer: jkam <jkam.mail@gmail.com>

pkgname=wt-c++
pkgver=3.1.5
pkgrel=1
pkgdesc="wt C++ Web Toolkit"
_pkgprefix="/usr"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/witty/files/wt/${pkgver}/wt-${pkgver}.tar.gz"
license=('GPL')
makedepends=('cmake' 'boost')
source=(wt-${pkgver}.tar.gz::http://sourceforge.net/projects/witty/files/wt/${pkgver}/wt-${pkgver}.tar.gz)
md5sums=('1042d6315a6c71b31c4eca87ae9acb72')

build() {
  cd ${srcdir}/wt-${pkgver}
  cmake -DCMAKE_INSTALL_PREFIX=${_pkgprefix} . || return 1
  CPUS=`cat /proc/cpuinfo | grep processor | wc -l`
  mkdir -p ${pkgdir}/etc/ld.so.conf.d
  echo "${_pkgprefix}/lib" > ${pkgdir}/etc/ld.so.conf.d/wt-ld.conf
  echo "using $CPUS CPUS"
  INSTFILE="./${pkgname}.install"
  echo "" > $INSTFILE
  echo "post_install() {" >> $INSTFILE
  echo "ldconfig" >> $INSTFILE
  echo "}" >> $INSTFILE  
  make -j $CPUS || return 1
  make DESTDIR=${pkgdir} install || return 1  
}
