# Maintainer: Estevao Valadao <estevao@archlinux-br.org>
# Contributor: pisuka <tekmon@gmail.com>
# Contributor: Guten <ywzhaifei@gmail.com>
# Contributor: Lee.MaRS <leemars@gmail.com>

pkgname=google-appengine
pkgver=1.5.1
pkgrel=4
arch=('any')
pkgdesc="Google App Engine SDK for Python"
url="http://code.google.com/appengine/"
license=('Apache')
depends=('python2' 'python2-pyopenssl')
options=('!strip')
install=google-appengine.install
source=(http://googleappengine.googlecode.com/files/google_appengine_${pkgver}.zip)
sha1sums=('2b2900ec5f2d9d51282645015b4f1bef07b1cc07')

build() {
  cd "$srcdir"
  mkdir "$pkgdir/opt/"

  # Fix file mode
  find google_appengine -type f -exec chmod 644 '{}' \;
  # Make some .py executable (all of them?)
  chmod 755 google_appengine/*.py

  cp -R google_appengine/ "$pkgdir/opt/$pkgname"
  grep -r -l python "$pkgdir/opt" | xargs sed -i '/#!\/usr\/bin\/env python/s|python|python2|'

  mkdir -p "$pkgdir/usr/bin/"
  find "$pkgdir/opt/$pkgname" -type f -executable -printf "/opt/$pkgname/%P\n" | xargs ln -st "$pkgdir/usr/bin/"
}
