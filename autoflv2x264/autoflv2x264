#!/bin/bash
# Run this script in the dir containing all the flv files you wish to convert to x264.
# There are no arguments. The script will copy both the audio and video bitrates into
# the new file via mediainfo.

# make a list of all flv files for transcoding
for files in $(find -maxdepth 1 -name '*.flv' | sed s'/.\///'); do
 # find flv bitrate for video and audio
 vbps=`mediainfo --inform="Video;%BitRate%" ${files}`
 vkbps=`echo $vbps / 1000 | bc`

 abps=`mediainfo --inform="Audio;%BitRate%" ${files}`
 akbps=`echo $abps / 1000 | bc`
 outputname=`echo "${files}" | sed s'/.flv//'`

 echo filename is ${files}
 echo videobit rate set to ${vkbps}
 echo audobit rate set to ${akbps}
 sleep 2s

 HandBrakeCLI -i "${files}" -o "${outputname}.mkv" --encoder x264 bframes=2:subme=6:mixed-refs=0:weightb=0:ref=5:8x8dct=0:me=umh:direct=temporal:trellis=0:b-adapt=2 --vb ${vkbps} -2 -T --aencoder faac -B ${akbps}
done
