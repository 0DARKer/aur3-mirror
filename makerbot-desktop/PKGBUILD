# Maintainer: Francisco Martinez <zomernifalt at gmail dot com>
pkgname=makerbot-desktop
pkgver=3.5.0
_openmeshver=3.2
_vtk5ver=5.10.1
pkgrel=1
pkgdesc="A complete, free 3D printing solution for discovering, managing, and sharing your 3D prints."
arch=('x86_64')
url="https://www.makerbot.com/desktop"
license=('GPL')
depends=('qt5-base' 'boost' 'qt5-multimedia' 'qt5-webkit' 'jsoncpp' 'postgresql-libs' 'python2'
'libjpeg6' 'yajl' 'qt4' 'libmariadbclient' 'shared-mime-info' 'opencv' 'gl2ps' 'hdf5' 'tcl' 'zenity')
makedepends=('rpmextract')
options=('!strip')
install="$pkgname.install"
_fakefedorarelease=fc20
_baseurl="http://downloads.makerbot.com/makerware/yum/Fedora/20/${CARCH}"
source=(
"$_baseurl/makerware-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/Miracle-Grue-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/OpenMesh-${_openmeshver}-2.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/ToolPathViz-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/conveyor-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/conveyor-ui-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/jsonrpc-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libdigitizer-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libmbqtutils-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libthing-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libtinything-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/makerbot_driver-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/mb_pyserial-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/vtk5-${_vtk5ver}-7.${_fakefedorarelease}.${CARCH}.rpm")
noextract=(
"makerware-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"Miracle-Grue-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"OpenMesh-${_openmeshver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"ToolPathViz-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"conveyor-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"conveyor-ui-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"jsonrpc-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"libdigitizer-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"libmbqtutils-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                 
"libthing-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                     
"libtinything-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                 
"makerbot_driver-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"mb_pyserial-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                  
"vtk5-${_vtk5ver}-7.${_fakefedorarelease}.${CARCH}.rpm")
md5sums=('c4bbbd84757fde6c6e7195c78c47da50'
         'bb7c7c3cfb0bca67aad4e22351ed2cbd'
         '1071449b8b6b7b57170da277f01a69b3'
         '490003337df353b4298c44e26f6e17cb'
         'e038f05a5275c703211adcc39cffe644'
         '4d49d552dcd2cf82e8559a157274b14c'
         '75d35e785cc6c41f6ba276d932996de1'
         '18a33fc7a751e8a56deab951d96b2fce'
         '399961f8432b456cc810a753c8ff2516'
         '395e0eb09f7569aaef37d4b53e279d2f'
         '39d5f71b63eb2754922b8578e62b5d80'
         'dfe18797c0960662577e635a84e56d0b'
         'e4dfc4f5a0b41cd3992b718b94c809d1'
         '65e6ba37e90db128bd990b1e9bbeefcd')
install="$pkgname.install"

package() { 
	cd $pkgdir
	msg2 "Extracting RPMs"
	for i in $srcdir/*.rpm; do rpmextract.sh $i; done
	msg2 "Success"
	
	msg2 "Moving files around"
	mv lib/udev/ usr/lib/
	mv usr/lib64/* usr/lib/
	rm -r lib usr/lib64
	ln -s /usr/lib/libboost_serialization.so usr/lib/libboost_serialization.so.1.54.0
	ln -s /usr/lib/libboost_program_options.so usr/lib/libboost_program_options.so.1.54.0
	ln -s /usr/lib/libboost_filesystem.so usr/lib/libboost_filesystem.so.1.54.0
	ln -s /usr/lib/libboost_system.so usr/lib/libboost_system.so.1.54.0
	ln -s /usr/lib/libtcl.so usr/lib/libtcl8.5.so
	
	msg2 "Creating log files"
	touch var/log/conveyor/conveyord.log
	
	find . -exec chmod 755 {} \;
}
