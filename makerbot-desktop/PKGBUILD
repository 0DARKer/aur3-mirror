# Maintainer: Francisco Martinez <zomernifalt at gmail dot com>
pkgname=makerbot-desktop
pkgver=3.2.2
_openmeshver=2.4
_vtk5ver=5.10.1
pkgrel=3
pkgdesc="A complete, free 3D printing solution for discovering, managing, and sharing your 3D prints."
arch=('x86_64')
url="https://www.makerbot.com/desktop"
license=('GPL')
depends=('qt5-base' 'qt5-multimedia' 'qt5-webkit' 'jsoncpp' 'postgresql-libs' 'python2'
'libjpeg6' 'yajl' 'qt4' 'libmariadbclient' 'shared-mime-info' 'opencv' 'gl2ps' 'hdf5' 'tcl' 'zenity')
makedepends=('rpmextract')
options=('!strip')
install="$pkgname.install"
_fakefedorarelease=fc20
_baseurl="http://downloads.makerbot.com/makerware/yum/Fedora/20/${CARCH}"
source=(
"$_baseurl/makerware-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/Miracle-Grue-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/OpenMesh-${_openmeshver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/ToolPathViz-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/conveyor-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/conveyor-ui-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/jsonrpc-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libdigitizer-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libmbqtutils-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libthing-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/libtinything-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/makerbot_driver-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/mb_pyserial-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"$_baseurl/vtk5-${_vtk5ver}-7.${_fakefedorarelease}.${CARCH}.rpm")
noextract=(
"makerware-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"Miracle-Grue-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"OpenMesh-${_openmeshver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"ToolPathViz-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"conveyor-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"conveyor-ui-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"jsonrpc-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"libdigitizer-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"libmbqtutils-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                 
"libthing-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                     
"libtinything-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                 
"makerbot_driver-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"
"mb_pyserial-${pkgver}-1.${_fakefedorarelease}.${CARCH}.rpm"                                                                                                                                                                  
"vtk5-${_vtk5ver}-7.${_fakefedorarelease}.${CARCH}.rpm")
md5sums=('239e33d2295188314d7402f806f0ccfa'
         '66ade64bf7c2088800bb049f9f195def'
         'b11044a920bb663f58e661c917c5dee2'
         '02a14d4df3cdf21c2728fd15b46a2b18'
         '669741bf7424d1fbaccec7f86e701f14'
         '560b5cf7b610efb03b0136f8e3753f41'
         'abd43956291436125e00e825d4562ade'
         '5a356569d3ffcdf1a241cbad32e48073'
         'b7d440b8eec025327515c57c9ac9eaec'
         '207dbd46e9e81bbef15c79728a8d5419'
         '3bcc86a90c81935df4b240ce0366844c'
         '537bbc8d6b26b8a2b9f1cbf9aee04f27'
         '5384546d8f772b0b2b9e2f5f87608414'
         '9c3cf8b2fe9eebce2797fd6e9b857d13')

install="$pkgname.install"

package() { 
	cd $pkgdir
	msg2 "Extracting RPMs"
	for i in $srcdir/*.rpm; do rpmextract.sh $i; done
	msg2 "Success"
	
	msg2 "Moving files around"
	mv lib/udev/ usr/lib/
	mv usr/lib64/* usr/lib/
	rm -r lib usr/lib64
	ln -s /usr/lib/libboost_program_options.so usr/lib/libboost_program_options.so.1.54.0
	ln -s /usr/lib/libboost_filesystem.so usr/lib/libboost_filesystem.so.1.54.0
	ln -s /usr/lib/libboost_system.so usr/lib/libboost_system.so.1.54.0
	ln -s /usr/lib/libtcl.so usr/lib/libtcl8.5.so
	
	msg2 "Creating log files"
	touch var/log/conveyor/conveyord.log
	
	find . -exec chmod 755 {} \;
}
