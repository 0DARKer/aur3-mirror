# Maintainer: Myles English <myles at rockhead dot biz>
pkgname=slepc
pkgver=3.1_p6
_config=linux-gnu-cxx-debug
pkgrel=1
pkgdesc="Scalable library for Eigenvalue problem computations"
arch=('any')
url="http://www.grycap.upv.es/slepc"
license=('GNUv3')
depends=('python2' 'gcc' 'petsc')
install=slepc.install
source=(http://www.grycap.upv.es/slepc/download/distrib/${pkgname}-${pkgver/_/-}.tgz)
md5sums=('a57f717fa52d3a1fedd98137ca0325a3')
_build_dir=${srcdir}/${pkgname}-${pkgver/_/-}
_install_dir=/usr/lib/slepc/${_config}

build() {
    cd ${_build_dir}

    unset PETSC_ARCH
    export SLEPC_DIR=${_build_dir}

    #export PETSC_DIR=/usr/petsc/linux-gnu-cxx-debug

    python2 ./configure --prefix=${pkgdir}${_install_dir}

    export PETSC_ARCH=installed-petsc

    make
}


package() {
    cd ${_build_dir}
    export PETSC_ARCH=installed-petsc
    export SLEPC_DIR=${_build_dir}
    export PETSC_DIR=/usr/petsc/linux-gnu-cxx-debug
    #echo "${SLEPC_DIR} ${PETSC_ARCH} ${PETSC_DIR}"

    make install

    export SLEPC_DIR=${_install_dir}
    unset PETSC_ARCH

    #sed -i 's#'"${pkgdir}"'##g' "${pkgdir}${_install_dir}/conf/slepcvariables"

    mkdir -p ${pkgdir}/etc/profile.d
    echo "export SLEPC_DIR=${_install_dir}" > ${pkgdir}/etc/profile.d/slepc.sh
    chmod +x ${pkgdir}/etc/profile.d/slepc.sh
}
