pkgname=mingw32-allegro4
pkgver=4.4.2
pkgrel=3
license=('custom')
arch=('any')
options=('!strip' '!buildflags')
depends=(mingw32-runtime mingw32-dx7-headers)
makedepends=('mingw32-gcc' 'cmake')
pkgdesc="Portable library mainly aimed at video game and multimedia programming (legacy version, mingw32)"
source=("http://downloads.sourceforge.net/project/alleg/allegro/$pkgver/allegro-$pkgver.tar.gz"
'cmake-toolchain.cmake')
url=("http://alleg.sourceforge.net/")
md5sums=('4db71b0460fc99926ae91d223199c2e6'
         'dd2b2db48187dff84050fe191d309d81')
build() {
	cd "$srcdir/allegro-$pkgver"
	export MINGDIR="/usr/i486-mingw32"
	unset LDFLAGS
	mkdir package
	cd package
	cmake -DWANT_EXAMPLES=OFF -DWANT_TESTS=OFF -DCMAKE_TOOLCHAIN_FILE="$srcdir/cmake-toolchain.cmake" .. && make
	make install DESTDIR=$pkgdir
	i486-mingw32-strip $pkgdir/usr/i486-mingw32/bin/*.exe
	i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/bin/*.dll
        i486-mingw32-strip -g $pkgdir/usr/i486-mingw32/lib/*.a
}

