# Contributor: sp42b <sp42b|a_t|gmx.net>
# Contributor: AndyRTR <andreas.radke@freenet.de>

pkgname=dvbcut
pkgver=0.6.0
pkgrel=4
pkgdesc="Qt3 application for cutting parts out of DVB streams"
arch=('i686' 'x86_64')
url="http://dvbcut.sourceforge.net/index.html"
license="GPL"
depends=('qt3' 'libao' 'libmad' 'a52dec')
optdepends=('mplayer: for video playback inside of DVBCUT')
source=(http://www.mr511.de/dvbcut/${pkgname}-${pkgver}.tar.gz
        http://dvbcut.svn.sourceforge.net/viewvc/dvbcut/trunk/dvbcut.svg?revision=168)
md5sums=('81c8341a5340b7596aeaa1fd42254550'
         'af5d00410e34867e4d3be60b1c9ee725')


build() {
  cd ${srcdir}/${pkgname}-${pkgver}

  # fix for gcc 4.4; credits to azleifel
  # http://bbs.archlinux.org/viewtopic.php?id=73868
  sed -i 21i'#include <stdio.h>' ${srcdir}/${pkgname}-${pkgver}/src/buffer.cpp
  sed -i 21i'#include <stdio.h>' ${srcdir}/${pkgname}-${pkgver}/src/mpegmuxer.cpp

  # Fix for compilation error under gcc 4.5 (pquiney)
  sed -i 's/index::index/class index/' ${srcdir}/${pkgname}-${pkgver}/src/mpgfile.h
  sed -i 's/index::index/class index/' ${srcdir}/${pkgname}-${pkgver}/src/main.cpp
  
  
  ./configure --prefix=/usr --with-qt3=/opt/qt
  make || return 1

  install -Dm755 ${srcdir}/${pkgname}-${pkgver}/bin/dvbcut ${pkgdir}/usr/bin/dvbcut  
  install -Dm644 ${srcdir}/${pkgname}-${pkgver}/dvbcut.1 ${pkgdir}/usr/share/man/man1/dvbcut.1
  install -Dm644 ${startdir}/dvbcut.desktop ${pkgdir}/usr/share/applications/dvbcut.desktop
  install -Dm644 ${srcdir}/dvbcut.svg\?revision\=168 ${pkgdir}/usr/share/pixmaps/dvbcut.svg
}
