# Original Contributor: Muhammad 'MJ' Jassim <UnbreakableMJ@gmail.com>
# Maintainer: Mirco Chinelli <infinity89.linux@gmail.com>

pkgname=songbird
pkgver=16967
_pkgver=1.4.3
pkgrel=1.4.3
pkgdesc="Digital desktop media player (jukebox) mashed-up with web browser, powered by Mozilla."
url="http://www.songbirdnest.com/"
license=('GPL2')
arch=('i686' 'x86_64')
install=songbird.install
makedepends=('autoconf' 'subversion' 'zip' 'glibc')
depends=('gtk2' 'libxmu' 'gstreamer0.10-base' 'gstreamer0.10-good-plugins' 'gstreamer0.10-python')
#  Much is included internally, so we can ignore most namcap errors about dependencies
optdepends=('gstreamer0.10-bad-plugins' 'gstreamer0.10-ugly-plugins')

conflicts=('songbird-bin' 'songbird-nightly' 'songbird-svn')
source=('songbird-launcher.sh' 'Songbird.desktop')
md5sums=('212e1d5636987fb33a7ee9acda2b0c00'
         '69690161475073725fe611ffee7e43a6')


_svntrunk=http://publicsvn.songbirdnest.com/client/tags/Songbird${_pkgver}
_svnmod=songbird

[ "$CARCH" = "x86_64" ] && _svndependencies=http://publicsvn.songbirdnest.com/vendor-binaries/tags/Songbird${_pkgver}/linux-x86_64
[ "$CARCH" = "i686" ] && _svndependencies=http://publicsvn.songbirdnest.com/vendor-binaries/tags/Songbird${_pkgver}/linux-i686


build() {
  cd ${startdir}/
  
  cd $startdir/src

  svn co $_svntrunk $_svnmod || return 1
  msg "SVN checkout done or server timeout"
  	
  cd $_svnmod/dependencies/
  msg "Checking out dependencies"
  svn co $_svndependencies || return 1
  cd ..
  msg "Starting make..."
  # make -f songbird.mk clean || return 1
  make -f songbird.mk clobber || return 1
  make -f songbird.mk || return 1
  mkdir -p $pkgdir/usr/lib/songbird/
  cd compiled/dist
  cp -r * $pkgdir/usr/lib/songbird/
  
  
  install -D ${startdir}/src/$_svnmod/compiled/dist/chrome/icons/default/default.xpm \
  	     ${startdir}/pkg/usr/share/pixmaps/Songbird.xpm
  
  install -D -m644 ${startdir}/src/Songbird.desktop \
  	     	   ${startdir}/pkg/usr/share/applications/Songbird.desktop
  
  
  install --directory ${startdir}/pkg/usr/bin
  cp ${startdir}/src/songbird-launcher.sh ${startdir}/pkg/usr/bin/songbird
  find $pkgdir/usr/lib/songbird -type d -exec chmod 755 {} \;
}
