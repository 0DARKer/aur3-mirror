# Maintainer: lh <jarryson AT gmail com>

pkgname=ido-bzr
_realname=${pkgname/-bzr}
pkgver=67
pkgrel=1
pkgdesc="Widgets and other objects used for indicators."
arch=('i686' 'x86_64')
url="https://launchpad.net/${_realname}"
license=('GPL')
groups=('lh' 'ayatana')
depends=('gtk2')
makedepends=('gnome-common' 'intltool' 'gtk-doc')
provides=("$_realname")
conflicts=("$_realname")
source=()
md5sums=()

_bzrtrunk=lp:$_realname
_bzrmod=$_realname

apatch(){
  for i in ${startdir}/patches/*.patch; do
      msg2 "$i"
      patch -Np0 -i $i
  done
}

build() {
  cd ${srcdir}

  msg "Connecting to the server...."

  msg "BZR checkout done or server timeout"
  msg "Starting make..."

  if [ ! -d ./${_bzrmod} ]; then
    bzr branch ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  else
    cd ${_bzrmod} && bzr pull -r ${pkgver}
    cd ..
  fi

  rm -rf ${_bzrmod}-build
  cp -r ${_bzrmod} ${_bzrmod}-build
  
  cd ${_bzrmod}-build
  
  apatch
  NOCONFIGURE=1 ./autogen.sh
  ./configure --prefix=/usr --libexecdir=/usr/lib/$_realname --enable-gtk-doc-html=no --disable-static
  make
}
package(){
  cd ${srcdir}/${_bzrmod}-build
  make DESTDIR="$pkgdir" install
}