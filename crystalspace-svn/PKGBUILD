# Contributor: Christoph Zeiler <rabyte*gmail>
# Contributor: Harley Laue <losinggeneration@gmail.com>

pkgname=crystalspace-svn
pkgver=33038
pkgrel=2
pkgdesc="A free and portable 3D Game Development Kit written in C++"
arch=('i686' 'x86_64')
url="http://www.crystalspace3d.org/"
license=('LGPL2')
depends=('speex' 'libgl' 'wxgtk' 'openal' 'alsa-lib' 'python' \
         'cegui' 'libvorbis' 'ode' 'nvidia-cg-toolkit' 'cal3d-svn')
makedepends=('subversion' 'autoconf' 'automake' 'jam' 'pkgconfig' 'swig')
provides=('crystalspace')
conflicts=('crystalspace' 'crystalspace-1.4branch-svn')
source=()
md5sums=()

_svntrunk=http://crystal.svn.sourceforge.net/svnroot/crystal/CS/trunk
_svnmod=crystalspace

build() {
        if [ -d $_svnmod/.svn ]; then
                cd $_svnmod
                svn up -r $pkgver
                cd ..
        else
                svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
        fi

        msg "SVN checkout done or server timeout"

        rm -rf $_svnmod-build
        cp -ru $_svnmod/ $_svnmod-build/
        cd $srcdir/$_svnmod-build

        msg "Starting make..."

        ./configure --prefix=/usr --sysconfdir=/etc --without-java --disable-make-emulation || return 1
        jam -q $MAKEFLAGS || return 1
        jam DESTDIR=$pkgdir install

        # cleanup debugging files cuts installed size in half
        find $pkgdir -iname "*.dbg" -delete
        # cleanup installed html docs
        rm -fr $pkgdir/usr/share/doc/crystalspace-1.9/html
}
