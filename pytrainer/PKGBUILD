# Maintainer: D. Can Celasun <dcelasun at gmail>
# Contributor: Thomas Dziedzic < gostrc at gmail >
# Contributor: Anton Bazhenov <anton.bazhenov at gmail>
# Contributor: Alexander Fehr <pizzapunk gmail com>

pkgname=pytrainer
pkgver=1.8.0
pkgrel=1
pkgdesc='A tool to log your sport activities.'
arch=('i686' 'x86_64')
url='http://sourceforge.net/projects/pytrainer/'
license=('GPL')
depends=('python-lxml' 'pygtk' 'python-matplotlib' 'python-soappy' 'sqlite3' 'gnome-python-extras' 'gpsbabel' 'xulrunner')
optdepends=('firefox: for browser support')
source=("http://downloads.sourceforge.net/project/$pkgname/PyTrainer%20$pkgver/$pkgname-$pkgver.tar.gz"
        $pkgname.sh
        pathfix.patch)
        

md5sums=('f101632933e071cbe6651c10ac78f69d'
         'be93961dd1301ef065301dbad01052dc'
         'c80aa188dce3a5675b15a703873bf3ad')

         
build() {
  
  cd $pkgname-$pkgver
  
  patch -Np2 -i $srcdir/pathfix.patch
  
  # Fix python paths
  
  export PYTHON="/usr/bin/python2"
  sed -i -e "s|#![ ]*/usr/bin/python$|#!/usr/bin/python2|" \
  -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" \
  $(find $srcdir/ -name '*.py')
  
  # Fix python path in the executable
  
  
  
  # Install
  python2 setup.py install --prefix=/usr --root="$pkgdir" || return 1

  # install launcher
  mv -vf "$pkgdir"/usr/{bin,share/$pkgname}/$pkgname
  install -Dm755 ../$pkgname.sh "$pkgdir/usr/bin/$pkgname"
}

