# Maintainer: Cameron Spry <spryct@rose-hulman.edu>
_pkgname=intel-tbb
pkgname=lib32-${_pkgname}
pkgver=4.1u2
pkgrel=2
pkgdesc="32-bit multilib version of Intel's Threaded Building Blocks library"
arch=(x86_64)
license=('GPL')
depends=('lib32-gcc-libs')
makedepends=('gcc-multilib')
url=(http://threadingbuildingblocks.org)
source=(http://threadingbuildingblocks.org/sites/default/files/software_releases/source/tbb41_20130116oss_src.tgz)
sha1sums=('fd7ea56612f145a1f9b3d961a424e9d553bab527')

_foldername=tbb41_20130116oss

build() {
	cd "${srcdir}/${_foldername}"
	export CC="gcc -m32"
	export CXX="g++ -m32"
	export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
	sed -i 's/m64/m32/g' "${srcdir}/${_foldername}/build/linux.gcc.inc"
	make
}

package() {
	cd "${srcdir}/${_foldername}/build/"
	cd `ls -a | grep release`
	
	mkdir "${pkgdir}/usr/"
	mkdir "${pkgdir}/usr/lib32/"
	cp -dpr --no-preserve=ownership *.{so,2} "${pkgdir}/usr/lib32/"
}
