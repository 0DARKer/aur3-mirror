# Maintainer: lorim <lorimz AT gmail DOT com>

pkgname=lib32-cnijfilter-mp560
pkgver=3.20
_pkgreview=1
pkgrel=2
pkgdesc="Canon IJ Printer Driver (MP560 series) (32-bit)"
url="http://software.canon-europe.com/products/0010756.asp"
arch=('x86_64')
license=('custom')
depends=('lib32-popt' 'lib32-gtk2>=2.8.0' 'lib32-libxml2>=2.6.24')
makedepends=('autoconf>=2.13' 'automake>=1.6' 'tar' 'make' 'gcc-multilib')
conflicts=('cnijfilter-common')
install=cnijfilter-mp560.install
source=(http://gdlp01.c-wss.com/gds/7/0100002367/01/cnijfilter-source-${pkgver}-${_pkgreview}.tar.gz
	id.diff)

build() {
  export CC="gcc -m32"
  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/libs
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/cngpij
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/cngpijmon
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/cnijfilter
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/pstocanonij
  ./autogen.sh --prefix=/usr --enable-progpath=/usr/bin --libdir=/usr/lib32
  sed -i 's:filterdir =.*$:filterdir = /usr/lib/cups/filter:g' filter/Makefile
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/lgmon
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/backend
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/backendnet
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/cngpijmon/cnijnpr
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/printui/po
  patch -Np0 -i ${srcdir}/id.diff

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/printui
  ./autogen.sh --prefix=/usr --program-suffix=mp560 --enable-progpath=/usr/bin --libdir=/usr/lib32
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}/ppd
  ./autogen.sh --prefix=/usr --program-suffix=mp560
  make
  make install DESTDIR=${pkgdir}

  cd ${srcdir}/cnijfilter-source-${pkgver}-${_pkgreview}
  install -d ${pkgdir}/usr/lib/bjlib
  install -m 755 360/database/* ${pkgdir}/usr/lib/bjlib
  install -d ${pkgdir}/usr/lib32
  install -s -m 755 360/libs_bin/*.so.* ${pkgdir}/usr/lib32
  install -s -m 755 com/libs_bin/*.so.* ${pkgdir}/usr/lib32
  install -D LICENSE-cnijfilter-${pkgver}EN.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE-cnijfilter-${pkgver}EN.txt
}
md5sums=('0a40b46016511d59d1d0a3d3d9a653dd'
         'cf411560d6be2a11eeb9bbf66f82ea46')
