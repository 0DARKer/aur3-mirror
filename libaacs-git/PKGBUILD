# Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=libaacs-git
pkgver=20130101
pkgrel=1
pkgdesc="Advanced Access Content System. (GIT version)"
arch=('i686' 'x86_64')
license=('LGPL')
url="http://www.videolan.org/developers/libaacs.html"
depends=('libgcrypt')
makedepends=('git' 'flex' 'bison')
options=('!libtool')
provides=('libaacs')
conflicts=('libaacs')
source=('bison_2.6.patch')
md5sums=('0e11e969e8c2d2a4d4f8bb9a1e3df8c4')

_gitroot="git://git.videolan.org/libaacs.git"
_gitname="libaacs"

build() {
    msg "Connecting to GIT server..."

    if [ -d "${srcdir}/${_gitname}" ] ; then
        cd "${_gitname}" && git pull
    else
        git clone --depth=1 "${_gitroot}"
    fi

    cd "${srcdir}"

    msg "GIT checkout done or server timeout"
    msg "Starting build..."

    rm -fr "${srcdir}/${_gitname}-build"
    cp -R "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
    cd "${srcdir}/${_gitname}-build"

    [ "$(LANG=C pacman -Qi automake |grep Version | cut -d ' ' -f10 | sed 's|.[0-9]-[0-9]||g')" = "1.13" ] && sed 's|AM_CONFIG_HEADER(config.h)|AC_CONFIG_HEADERS([config.h])|g' -i configure.ac
    ./bootstrap
    ./configure --prefix=/usr
    patch -Np1 -i "${srcdir}/bison_2.6.patch"
    make
}
package() {
    cd "${srcdir}/${_gitname}-build"
    make DESTDIR="${pkgdir}" install
}
