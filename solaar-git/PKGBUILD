# Maintainer: Diego <cdprincipe@at@gmail@dot@com>

pkgname=solaar-git
pkgver=0.8.99.12.676.1bd6fd5
pkgrel=1
pkgdesc="Linux devices manager for the Logitech Unifying Receiver"
arch=("any")
url="http://pwr.github.io/Solaar/"
license=('GPL')
depends=(
      'systemd' 'python' 'python-pyudev' 'python-gobject'
      )
optdepends=(
      'gtk3: required for GUI application'
      'gobject-introspection: required for GUI application'
      'python-gobject: required for GUI application'
      )
makedepends=('git')
install=solaar.install
conflicts=('solaar')
source=('git://github.com/pwr/Solaar.git')
md5sums=('SKIP')

pkgver() {
  cd Solaar
#  echo $(head ChangeLog | grep -o '[0-9].*[0-9]').$(git rev-list --count HEAD).$(git rev-parse --short HEAD)
  echo $(cat "$srcdir/Solaar/lib/solaar/__init__.py" | grep -o '[0-9].*[0-9]').$(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {
  cd "$srcdir/Solaar"
  python setup.py install --root="$pkgdir/" --optimize=1
  
  # Install udev rule
  install -d "${pkgdir}"/etc/udev/rules.d/
  # Renamed udev rule for enhancing compatibility with ltunify
  install -m644 rules.d/42-logitech-unify-permissions.rules "${pkgdir}"/etc/udev/rules.d/43-logitech-unify-permissions.rules
}

