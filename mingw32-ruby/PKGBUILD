pkgname=mingw32-ruby
pkgver=1.9.3_p125
pkgrel=1
pkgdesc="An object-oriented language for quick and easy programming (mingw32)"
arch=(any)
url="http://www.ruby-lang.org/en/"
depends=(mingw32-openssl)
makedepends=(mingw32-gcc ruby)
license=('BSD' 'custom')
options=(!buildflags !strip)
source=("ftp://ftp.ruby-lang.org/pub/ruby/${pkgver%.*}/ruby-${pkgver//_/-}.tar.bz2")
md5sums=('702529a7f8417ed79f628b77d8061aa5')

build() {
  cd $startdir/src/ruby-${pkgver//_/-}
  unset LDFLAGS
  ./configure \
    --prefix=/usr/i486-mingw32 \
    --host=i486-mingw32 \
    --build=$CHOST
  make || return 1
  make DESTDIR=$startdir/pkg install
  
  i486-mingw32-strip $pkgdir/usr/i486-mingw32/bin/*.exe
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/bin/*.dll
  i486-mingw32-strip -g $pkgdir/usr/i486-mingw32/lib/*.a
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/digest/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/dl/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/enc/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/enc/trans/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/io/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/json/ext/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/mathn/*.so
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/ruby/1.9.1/i386-mingw32/racc/*.so
  rm -rf $pkgdir/usr/i486-mingw32/share/{doc,man}
}
