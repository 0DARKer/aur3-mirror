# Maintainer: peace4all <markspost at rocketmail dot com>
# Contributer: Eikichi

pkgname=wiithon-bzr
pkgver=507
pkgrel=1
pkgdesc="Wiithon - WBFS Partition Manager"
arch=('i686' 'x86_64')
url="https://launchpad.net/wiithon"
license=('GPL3')
depends=('python2-sqlalchemy' 'python' 'unzip' 'gnome-icon-theme' 'pygtk' 'glibc')
makedepends=('bzr')
 if test "$CARCH" == x86_64; then
  makedepends+=('gcc-multilib' 'binutils-multilib')
 fi
install=$pkgname.install
options=('!libtool')

_bzrbranch=lp:wiithon
_bzrmod=wiithon

build() {

	cd ${srcdir}
	msg "Connecting to the server...."

	if [ ! -d ./${_bzrmod} ]; then
	  bzr co ${_bzrbranch} ${_bzrmod}
	else
	  bzr up ${_bzrmod}
	fi

	if [ ! -d ${pkgdir}/usr/games ]; then
	  mkdir -p ${pkgdir}/usr/games
	fi

	msg "BZR checkout done or server timeout"
	msg "Starting make..."
	cd ${srcdir}/${_bzrmod}

	sed -i -e "s|#![ ]*/usr/bin/python|#!/usr/bin/python2|" \
	-e "s|#![ ]*/usr/bin/env python|#!/usr/bin/env python2|" \
	$(find . -name '*.py')

	make
}

package() {
	cd ${srcdir}/${_bzrmod}
	make DESTDIR=${pkgdir} install

	mv ${pkgdir}/usr/games/wiithon* ${pkgdir}/usr/share/wiithon/
	mkdir -p ${pkgdir}/usr/bin
	mv ${pkgdir}/usr/share/wiithon/wiithon ${pkgdir}/usr/bin/
	rm -d "${pkgdir}/usr/games"
}
