# Maintainer: Carlinix rcarlini[at]gmail[dot]com>

pkgname=pgmodeler
pkgver=0.6.2
pkgrel=1
pkgdesc="PostgreSQL Database Modeler:  an open source project of a CASE tool for modeling PostgreSQL databases."
url="http://pgmodeler.com.br/"
arch=('x86_64' 'i686')
license=('GPL3')
depends=('qt5-base' 'qt5-svg' 'libxml2' 'libsm' 'libpqxx') 
optdepends=('postgresql')
makedepends=('wget')
#options=('strip')
#conflicts=()
#replaces=()
#backup=()
install='pgmodeler.install'



if [ "$CARCH" = "i686" ]; then
  source=("http://www.pgmodeler.com.br/releases/${pkgver}/${pkgname}-${pkgver}-linux32.tar.gz")
  buidpgdir=${pkgname}-${pkgver}-linux32
  md5sums=('53b73998dc95511c4190c9b338fa5b57')

elif [ "$CARCH" = "x86_64" ]; then
  source=("http://www.pgmodeler.com.br/releases/${pkgver}/${pkgname}-${pkgver}-linux64.tar.gz")
  md5sums=('960323b5b0f6329ce8b4dbf066b068de')
  buidpgdir=${pkgname}-${pkgver}-linux64
fi

source+=('pgmodeler' 
         'pgmodeler-cli'
         'pgmodeler_icon.png'
         'pgmodeler.desktop' )

md5sums+=('cab87f1334d6b73a97d6342fa0f9eaf2'
          'cde0b41920d38f679772b4f7b249f0c5'
          'eab36908c58e9c442188228c710ec76c'
          '1c19c63e3a71376a267f1efd83be9c2f')

package() {
  msg2 "Creating required dirs"
  mkdir -p "${pkgdir}"/{opt/$pkgname,/usr/share/{$pkgname/{examples,icons},applications,licenses/$pkgname},/etc/{$pkgname,profile.d}}

  msg2 "Moving stuff in place"
  install -m755 $srcdir/$buidpgdir/pgmodeler.vars "${pkgdir}"/etc/profile.d/pgmodeler.sh
  install -m644 $srcdir/$buidpgdir/LICENSE "${pkgdir}"/usr/share/licenses/$pkgname
  mv $srcdir/$buidpgdir/conf/{schemas,defaults,dtd} "${pkgdir}"/usr/share/$pkgname/
  mv $srcdir/$buidpgdir/conf/{pgmodeler_logo.png,pgmodeler_dbm.png} "${pkgdir}"/usr/share/$pkgname/icons/
  mv $srcdir/$buidpgdir/conf/example.dbm "${pkgdir}"/usr/share/$pkgname/examples/
  mv $srcdir/$buidpgdir/conf/*.conf "${pkgdir}"/etc/$pkgname/

  local fmp=''
  for fmp in schemas  dtd; do
    ln -s /usr/share/$pkgname/$fmp ${pkgdir}/etc/$pkgname/$fmp
  done
  
  ln -s /usr/share/$pkgname/examples/example.dbm ${pkgdir}/etc/$pkgname/example.dbm

  mv $srcdir/$buidpgdir/* ${pkgdir}/opt/$pkgname/
  
  mv ${pkgdir}/opt/$pkgname/pgmodeler ${pkgdir}/opt/$pkgname/pgmodeler.orig
  mv ${pkgdir}/opt/$pkgname/pgmodeler-cli ${pkgdir}/opt/$pkgname/pgmodeler-cli.orig
  install -m755  pgmodeler ${pkgdir}/opt/$pkgname/pgmodeler
  install -m755  pgmodeler-cli ${pkgdir}/opt/$pkgname/pgmodeler-cli
  install -m644  pgmodeler_icon.png ${pkgdir}/usr/share/$pkgname/icons/
  install -m644 pgmodeler.desktop  ${pkgdir}/usr/share/applications 
  
  msg2 "Removing redundant files"
  rm -rf ${pkgdir}/opt/$pkgname/{conf,LICENSE,pgmodeler.vars}

  msg2 "Creating configuration files for Arch"
  local pgmodelercfg="${pkgdir}/etc/profile.d/pgmodeler.sh"
  sed -i "s|\(PGMODELER_ROOT=\).*\$|\1\"/opt/${pkgname}/\"|"  $pgmodelercfg
  sed -i "s|\(PGMODELER_CONF_DIR=\).*\$|\1/$HOME/\.${pkgname}/|" $pgmodelercfg
  sed -i "s|\(PGMODELER_TMP_DIR=\).*\$|\1/tmp/${pkgname}|" $pgmodelercfg
}
# vim:set ts=2 sw=2 et:
