# Maintainer: Jens Staal <staal1978@gmail.com>

pkgname=llvmlinux-toolchain-svn-git
pkgver=20120708
pkgrel=1
pkgdesc="a bundle of LLVM, compiler-rt and clang patched to compile Linux"
url="http://llvm.linuxfoundation.org/index.php/Main_Page"
arch=('x86_64')
license=('UIUC' 'MIT')
makedepends=('subversion' 'git' 'cmake' 'python2' 'libffi')
provides=('llvm' 'compiler-rt' 'clang')
replaces=('llvm' 'clang')
conflicts=('llvm' 'clang')

#this checkout contain LLVM-specific patches and build scripts
_llvm_gitroot=('http://git.linuxfoundation.org/llvm-setup.git')
_llvm_gitname=('llvm-setup')

build(){
    cd ${srcdir}
    
    msg "checking out LLVM-specific linux patches and config(s)"
    if [ -d $_llvm_gitname ] ; then
	cd $_llvm_gitname && git pull $_llvm_gitroot
	msg2 "The local files are updated."
    else
	git clone $_llvm_gitroot $_llvm_gitname
    fi
	msg2 "done"
 
     # Use Python 2
    rm -rf  "$srcdir/python2-path" # start fresh
    mkdir -p "$srcdir/python2-path"
    ln -s /usr/bin/python2 "$srcdir/python2-path/python"
    export PATH="$srcdir/python2-path:$PATH"
    
    cd $srcdir/llvm-setup/targets/x86_64/
    make clang-build
}