# Contributor: Douglas Soares de Andrade <dsa@aur.archlinux.org>
# Contributor: Andrew Conkling <andrewski@fr.st>
# Contributor: Daniel J Griffiths <ghost1227@archlinux.us>
# Maintainer: Wan <erwan.ameil at gmail dot com>

pkgname=scribes-bzr
_pkgname=scribes
pkgver=20110209
pkgrel=1
pkgdesc='A simple PyGTK+ text editor'
arch=('i686' 'x86_64')
url='http://scribes.sourceforge.net'
license=('GPL')
depends=('gnome-python-extras' 'gnome-python-desktop' 'gnome-common' 'dbus-python' 'pygtksourceview2' 'gnome-doc-utils' 'xdg-utils' 'gtkspell' 'yelp' 'pyxdg' 'setuptools')
makedepends=('bzr' 'intltool')
conflicts=('scribes')
install=scribes-bzr.install
_bzrbranch='lp:scribes'

build() {
	msg 'Connecting to the server....'

	bzr branch ${_bzrbranch}

	msg 'BZR checkout done or server timeout'
	msg 'Starting make...'

	cd ${_pkgname}
	sed -i 's/python depcheck.py/python2 depcheck.py/' configure.ac
	chmod +x autogen.sh
	./autogen.sh
	sed -i 's/python removepyc.py/python2 removepyc.py/' Makefile
	sed -i 's/python -OO compile.py/python2 -OO compile.py/' Makefile
	make
}

package() {
	cd ${_pkgname}

	make DESTDIR="${pkgdir}" install
	sed -i 's|/usr/bin/python|/usr/bin/python2|' "${pkgdir}/usr/bin/scribes" 
	sed -i 's|/usr/bin/env python|/usr/bin/env python2|' "${pkgdir}/usr/bin/scribesplugin" "${pkgdir}/usr/bin/scribesmodule" 
}
