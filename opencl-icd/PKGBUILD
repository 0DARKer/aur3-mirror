# Maintainer: Lazaros Koromilas <koromilaz@gmail.com>

pkgname=opencl-icd
pkgver=1.2.11.0
_clver=1.2
_pkgdir=icd
pkgrel=2
pkgdesc='OpenCL 1.2 Installable Client Driver (ICD) Loader and Headers'
arch=('any')
url='http://www.khronos.org/registry/cl/'
license=('custom')
makedepends=('cmake' 'wget')
provides=('libcl' 'opencl-headers')
conflicts=('libcl' 'opencl-headers')
source=("http://www.khronos.org/registry/cl/specs/${pkgname}-${pkgver}.tgz")
md5sums=('697bd9f3a66fd61ad58fb4a17fda66c7')
_headers=(
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_d3d10.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_d3d11.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_dx9_media_sharing.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_ext.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_gl_ext.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_gl.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl.hpp"
    "http://www.khronos.org/registry/cl/api/${_clver}/cl_platform.h"
    "http://www.khronos.org/registry/cl/api/${_clver}/opencl.h"
)

build() {
    cd $srcdir/$_pkgdir

    _dirname=inc/CL
    mkdir $_dirname
    pushd $_dirname
    for h in ${_headers[@]}; do
        wget $h
    done
    popd

    make
}

package() {
    cd $srcdir/$_pkgdir

    install -dm755 $pkgdir/etc/OpenCL/vendors
    install -dm755 $pkgdir/usr/include/CL

    for h in inc/CL/*.{h,hpp}; do
        install -m644 $h $pkgdir/usr/include/CL/
    done

    install -D -m755 bin/libOpenCL.so.1.2 $pkgdir/usr/lib/libOpenCL.so.1.2
    ln -s /usr/lib/libOpenCL.so.1.2 $pkgdir/usr/lib/libOpenCL.so.1
    ln -s /usr/lib/libOpenCL.so.1 $pkgdir/usr/lib/libOpenCL.so

    install -D -m644 LICENSE.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
