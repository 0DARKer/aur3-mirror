# Maintainer: Michael Duell <mail@akurei.me> PGP-Key: 6EE23EBE
pkgname=gajim-plugin-otr-hg
pkgver=334
pkgrel=1
pkgdesc="OTR plugin for gajim-hg."
arch=(any)
url="http://trac-plugins.gajim.org/wiki/OffTheRecordPlugin"
license=('GPL')
depends=('gajim-hg' 'python-potr-git')
makedepends=('mercurial')
provides=(gajim-plugin-otr)

_hgroot=http://hg.gajim.org/
_hgrepo=gajim-plugins

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [[ -d "$_hgrepo" ]]; then
    cd "$_hgrepo"
    hg pull -u
    msg "The local files are updated."
  else
    hg clone "$_hgroot""$_hgrepo"
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_hgrepo-build"
  cp -r "$srcdir/$_hgrepo" "$srcdir/$_hgrepo-build"
  cd "$srcdir/$_hgrepo-build"
}

package() {
  cd "$srcdir/$_hgrepo-build"
  sed -i "s#/usr/bin/env python#/usr/bin/env/python2#g" gotr/*
  install -d ${pkgdir}/usr/share/gajim/plugins/gotr
  install -Dm 644 gotr/* ${pkgdir}/usr/share/gajim/plugins/gotr/
}

# vim:set ts=2 sw=2 et:
