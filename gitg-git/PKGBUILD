# Maintainer: Christian Hesse <mail@eworm.de>
# Contributor: Matt Arsenault <arsenm2@rpi.edu>

pkgname=gitg-git
pkgver=20121031
pkgrel=1
pkgdesc="A GitX clone for GTK+/GNOME - git checkout"
arch=('i686' 'x86_64')
url="http://git.gnome.org/cgit/gitg/"
license=('GPL')
depends=('dconf' 'gtksourceview3' 'libgit2-glib-git' 'git' 'desktop-file-utils' 'gsettings-desktop-schemas' 'hicolor-icon-theme' 'libwebkit3' 'libpeas')
makedepends=('autoconf' 'intltool')
provides=('gitg')
conflicts=('gitg')
_gitroot="git://git.gnome.org/gitg"
_gitname="gitg"

build() {
	cd ${srcdir}
	msg "Connecting to git.gnome.org GIT server...."

	if [ -d ${srcdir}/${_gitname} ] ; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot}
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	rm -rf ${srcdir}/${_gitname}-build
	cp -r ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
	cd ${srcdir}/${_gitname}-build

	msg "Starting build"

	./autogen.sh
	./configure --prefix=/usr
	
	# vala stuff does not like parallel building...
	export MAKEFLAGS="-j1"
	make
}

package() {
	cd ${srcdir}/${_gitname}-build

	make DESTDIR=${pkgdir} install
}

