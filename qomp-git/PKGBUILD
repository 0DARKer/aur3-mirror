# Maintainer: archtux <antonio dot arias99999 at gmail dot com>

pkgname=qomp-git
pkgver=237.43cefb6
pkgrel=1
pkgdesc="A platform-independent online music player application that supports Yandex.Music, Myzuka.ru and ProstoPleer.com."
arch=('i686' 'x86_64')
url="https://code.google.com/p/qomp/"
license=('GPL2')
depends=('phonon-qt4')
makedepends=('git')
conflicts=('qomp')
source=('git+https://code.google.com/p/qomp/')
md5sums=('SKIP')

prepare() {
  cd $srcdir/qomp

  # Translations
  git submodule update --init

  cmake -DCMAKE_INSTALL_PREFIX=/usr

  # Fix phonon paths
  cd src
  sed -i 's|<Phonon/MediaObject>|"/usr/include/qt4/phonon/mediaobject.h"|' qompphonon{player.{cpp,h},metadataresolver.h}
  sed -i 's|<Phonon/AudioOutput>|"/usr/include/qt4/phonon/audiooutput.h"|' qompphononplayer.cpp
  sed -i 's|<Phonon/SeekSlider>|"/usr/include/qt4/phonon/seekslider.h"|' qompphononplayer.cpp
  sed -i 's|<Phonon/VolumeSlider>|"/usr/include/qt4/phonon/volumeslider.h"|' qompphononplayer.cpp
}

build() {
  cd $srcdir/qomp
  make
}

package() {
  cd $srcdir/qomp
  make DESTDIR=$pkgdir install
}

pkgver() {
  cd $srcdir/qomp
  echo $(git rev-list --count master).$(git rev-parse --short master)
}