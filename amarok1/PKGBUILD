# Contributor: Juanma Hern√°ndez <juanmah@gmail.com>

pkgname=amarok1
_origname=amarok
pkgver=1.4.10
pkgrel=9
pkgdesc="amaroK - a media player for KDE - v1.4.10 xine engine with wikipedia patch (single package)"
arch=("i686" "x86_64")
url="http://amarok.kde.org"
license=('GPL')
depends=('xine-lib>=1.1.3' 'libmysqlclient>=5.0.45' 'postgresql-libs>=8.2.4' 'ruby' 'tunepimp>=0.5.3' 'kdelibs3>=3.5.7' 'libgpod>=0.6.0'  'libifp>=1.0.0.2' 'libnjb>=2.2.5' 'libvisual>=0.4.0' 'libmtp')
makedepends=('pkgconfig' 'kdelibs3' 'libmtp>=0.2.6.1' 'xine-lib>=1.1.8' 'sdl>=1.2.12')
#conflicts=('amarok')
provides=('amarok1')
install=amarok.install
source=("ftp://ftp.slackware.at/slackware-12.2/source/kde/amarok/${_origname}-${pkgver}.tar.bz2"
	"amarok_addaspodcast.desktop"
        "wikipedia.patch"
        "libmtp.patch"
        "gcc44.patch"
        "amarok-1.4.10.coverfetcher.diff"
	"ruby19_configure2.patch"
	"ruby19_rstring.patch"
	"gcc45.patch")
options=(!makeflags)

build() {
  patch -Np0 -i $srcdir/wikipedia.patch || return 1
  patch -Np0 -i $srcdir/libmtp.patch || return 1
  patch -Np0 -i $srcdir/gcc44.patch || return 1
  patch -Np0 -i $srcdir/amarok-1.4.10.coverfetcher.diff || return 1
  patch -Np0 -i $srcdir/ruby19_configure2.patch || return 1
  patch -Np0 -i $srcdir/ruby19_rstring.patch || return 1
  patch -Np0 -i $srcdir/gcc45.patch || return 1

  cd ${startdir}/src/${_origname}-${pkgver}
  . /etc/profile.d/qt3.sh
  . /etc/profile.d/kde3.sh
   
  # prepare build
  ./configure --prefix=/opt/kde \
  	--with-gnu-ld \
	--enable-mysql \
	--enable-postgresql \
	--with-mp4v2 \
	--with-ifp \
	--with-libnjb \
	--with-libmtp \
	--with-libgpod \
	--without-arts \
	--without-gstreamer \
	--with-xine \
	--without-nmm \
	--without-mas \
	--with-libvisual \
	--disable-debug \
	--enable-debug=no \
	--without-xmms || return 1

  # build
  sed -i -e 's/konquisidebar//g' amarok/src/Makefile
  make || return 1
  make DESTDIR=${startdir}/pkg install || return 1

  mkdir -p ${startdir}/pkg/opt/kde/share/apps/konqueror/servicemenus/
  install -m644 ${startdir}/src/amarok_addaspodcast.desktop ${startdir}/pkg/opt/kde/share/apps/konqueror/servicemenus/
}
md5sums=('3bdbf26181bf5e5925f48968caba7ac2'
         '7736a7e3e22b15818180df3cee7e4a79'
         'a93eb0dad2078afa045a69f38256b369'
         '02eb286127594b9427d27da7eb01f0de'
         'cfa9310dec03c33048e5a067a0334266'
	 'f4e8754cde659342bdfd3fca36612bb5'
         'e3c5201663052b4f346d5002a196421a'
	 '2a7ac1f359eb3cdb8bf724c8be660295'
	 'c441d4711f2c0ffc28a4a0b9757d397b')
