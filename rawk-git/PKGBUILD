# Maintainer: Philipp Millar <poxar[at]gmx[dot]net>
pkgname=rawk-git
pkgver=20130220
pkgrel=1
pkgdesc="A static site generator written in bourne shell."
url="http://rawk.brokenlcd.net"
arch=('any')
license=('ISC')
conflicts=('rawk')
provides=('rawk')
makedepends=('git')
depends=('bash')
optdepends=('smu: for markdown parsing'
'markdown: for markdown parsing')

_gitroot="git://github.com/kisom/rawk.git"
_gitname="rawk"

build() {
    cd ${srcdir}
    msg "Connecting to git server..."

    if [ -d ${srcdir}/${_gitname} ]; then
        cd ${_gitname} && git pull origin
        msg "The local files are updated."
    else
        git clone ${_gitroot}
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    if [ -d ${srcdir}/$_gitname-build ]; then
        rm -rf ${srcdir}/$_gitname-build
    fi

    git clone ${srcdir}/$_gitname ${srcdir}/$_gitname-build 
}

package() {
    cd ${srcdir}/$_gitname-build

    # configure
    cat Makefile.in | sed -e "s|\$PREFIX|${pkgdir}/usr|" \
                    | sed -e "s|\$MANDIR|${pkgdir}/usr/share/man|" \
                    > Makefile

    sed -i -e 's|/usr/local|/usr|' rawk.1
    sed -i -e 's|/usr/local|/usr|' rawkrc.5

    mkdir -p ${pkgdir}/usr/bin
    make install

    mkdir -p ${pkgdir}/usr/share/licenses/rawk
    cp license.txt ${pkgdir}/usr/share/licenses/rawk/license.txt
}
