#PKGBUILD Maintainer: Rafael Reggiani Manzo <rr.manzo#gmail.com>

pkgname=analizo
pkgver=1.18.0
pkgrel=3
pkgdesc="Analizo is a free, multi-language, extensible source code analysis and visualization toolkit."
groups=('analizo')
arch=('any')
url="http://analizo.org"
license=('GPLv3')
depends=('perl' 'perl-cpanplus-dist-arch' 'sloccount' 'doxyparse')
makedepends=('git')
source=("${url}/download/${pkgname}_${pkgver}.tar.gz"
        "0001-Fixes-keys-on-reference-for-ClangStaticAnalyzer.patch")
sha512sums=('581451498abaa5bc123b7067fa69cae935a6e3af4403c59cadbdea472df1b97d0739eccba3d1953a23145eb7a4b6d10100f8ec76de756d5e866a18d91c0c8616'
            '0cfe6be809d1f061fe88099f8a6906de29b8c3a660a42408b3daadcbfa150a40d8842cbd0c14143ce2ac2306e2ce4f0654cfbff5771e0f2716c1b983cd6ff63a')

build(){
  cd "${srcdir}/${pkgname}"
  git apply ../0001-Fixes-keys-on-reference-for-ClangStaticAnalyzer.patch

  #Perl modules
  cpanp -i --skiptest Class::Accessor
  cpanp -i --skiptest Getopt::Euclid
  cpanp -i --skiptest Graph
  cpanp -i --skiptest List::Compare
  cpanp -i --skiptest Statistics::Descriptive
  cpanp -i --skiptest Statistics::OnLine
  cpanp -i --skiptest MRO::Compat
  cpanp -i --skiptest Test::Class
  cpanp -i --skiptest Test::Exception
  cpanp -i --skiptest YAML
  cpanp -i --skiptest File::ShareDir::Install
  cpanp -i --skiptest FindBin::libs
  cpanp -i --skiptest App::Cmd::Setup
  cpanp -i --skiptest Class::Inspector
  cpanp -i --skiptest Graph::Writer::DSM
  cpanp -i --skiptest File::HomeDir
  cpanp -i --skiptest CHI
  cpanp -i --skiptest File::Copy::Recursive
  cpanp -i --skiptest Params::Util
  cpanp -i --skiptest List::MoreUtils
  cpanp -i --skiptest Data::UUID
  cpanp -i --skiptest Params::Validate
  cpanp -i --skiptest Digest::JHash

  #Analizo
  perl Makefile.PL
  make
}

package(){
  cd "${srcdir}/${pkgname}"

  make DESTDIR="${pkgdir}/" install

  ln -s /usr/bin/site_perl/analizo ${pkgdir}/usr/bin/analizo
}