pkgname=mutt-sidebar
pkgver=1.5.20
pkgrel=5
pkgdesc="A small but very powerful text-based mail client with sidebar-patch"
patchdate="20090619"
arch=('i686' 'x86_64')
url="http://lunar-linux.org/index.php?page=mutt-sidebar"
depends=('openssl' 'gdbm' 'mime-types' 'libsasl' 'slang' 'gnupg' 'gpgme')
conflicts=('mutt')
provides=('mutt')
source=(ftp://ftp.mutt.org/mutt/devel/mutt-${pkgver}.tar.gz
http://lunar-linux.org/~tchan/mutt/patch-${pkgver}.sidebar.$patchdate.txt
http://dbg.download.sourcemage.org/grimoire/codex/stable/mail/mutt/patches/trash_folder/trash_folder-1.5.18.patch.bz2
muttrc.example
mutt-unmailbox.patch
mutt_ssl.patch)
md5sums=('027cdd9959203de0c3c64149a7ee351c'
         '5786519489877c92e4fff68cf547e869'
         '9d95c08295f8ec5171f774f776ef8413'
         '336d1d8e290a0595dbe2cd92d720ffc9'
         'fa8e03a49a2fa7b294dc8237d928cdb7'
         '3f54850315502ad47405421339ffae60')
license=('GPL')

build() {
  cd $startdir/src/mutt-$pkgver
  # patch a segfault bug in 1.5.20 -- remove for next release
  patch -p1 -i ../mutt-unmailbox.patch
  # patch for openssl-1
  patch -Np1 -i ${srcdir}/mutt_ssl.patch || return 1

  patch -p1 -i ../patch-${pkgver}.sidebar.$patchdate.txt
  patch -p1 -i ../trash_folder-1.5.18.patch
  ./configure --prefix=/usr --sysconfdir=/etc \
  --enable-pop --enable-imap --enable-smtp --enable-pgp --enable-hcache \
  --enable-gpgme --with-ssl=/usr --with-sasl --without-idn \
  --with-regex --with-slang|| return 1
  make || return 1
  make DESTDIR=$startdir/pkg install
  rm -f ${pkgdir}/usr/bin/{flea,muttbug}
  rm -f ${pkgdir}/usr/share/man/man1/{flea,muttbug}.1
  rm -f ${pkgdir}/etc/mime.types*
  install -m644 -D ${startdir}/src/muttrc.example ${startdir}/pkg/etc/muttrc.example
}
