# Contributor: LUO, Jian <jian (dot) luo (dot) cn _(at)_ gmail (dot) com>

pkgname=myhdl
pkgver=0.6
pkgrel=1
pkgdesc="a Python-Based Hardware Description Language"
arch=(i686 x86_64)
url="http://www.myhdl.org"
source=(http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.gz
        conditional_expression.patch)
depends=('python')
makedepends=('iverilog')
optdepends=('iverilog: for Co-Simulation with Icarus Verilog')
license=('LGPL')
md5sums=('7d4d0fc0f28ccc48b256734b57d71e2a'
         'b137948aeefc37e5d012458c25d4ad6d')

build() {
  cd $startdir/src/$pkgname-$pkgver
  # Patch for conditional expression
  patch -Np0 -i $srcdir/conditional_expression.patch || return 1
  # Build and install python files
  python setup.py install --root=$pkgdir --prefix=/usr

  # Install license
  install -m 0644 -D ./LICENSE.txt $startdir/pkg/usr/share/licenses/$pkgname/LICENSE.txt

  # Make cosimulation modules for Icarus Verilog
  cd $startdir/src/$pkgname-$pkgver/cosimulation/icarus
  make || return 1
  install -m 0755 -D ./myhdl.vpi $pkgdir/usr/lib/ivl/myhdl.vpi
}
# vim: ts=2 sw=2 et ft=sh
