# Maintainer: Jason Melton <jason.melton@gmail.com>

pkgname=dkms-rtl8192se
_pkgname=rtl8192se
_modname=r8192se_pci

pkgver=2.6.0019.1207.2010
_oldpkgver=2.6.0019.1207.2010

pkgrel=3
pkgdesc="DKMS controlled drivers for Realtek 8192SE wireless chipset"
arch=('any')
url="http://www.realtek.com.tw/"
license=('GPL' 'custom')
depends=('dkms' 'sh' 'bash')
provides=('rtl8192se')
conflicts=('rtl8192se')
install=${pkgname}.install

source=("http://www.nd.edu/~pbui/scratch/aur/${_pkgname}_linux_${pkgver}.tar.gz"
	${pkgname}.install
	dkms.conf)

build() {
    cd ${srcdir}/${_pkgname}_linux_${pkgver}
}

package() {
    cd ${srcdir}/${_pkgname}_linux_${pkgver}
    
    # Copy firmware
    mkdir -p ${pkgdir}/lib/firmware 
    cp -fr firmware/RTL8192SE ${pkgdir}/lib/firmware 
    
    # DKMS - copy source tree
    mkdir -p ${pkgdir}/usr/src/${_modname}-${pkgver} 
    cp -a * ${pkgdir}/usr/src/${_modname}-${pkgver} 

    # DKMS - dkms.conf (See: http://linux.dell.com/dkms/manpage.html)
    cp -a ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_modname}-${pkgver}
    sed -i -e "s/PACKAGE_VERSION=\".*\"/PACKAGE_VERSION=\"${pkgver}\"/" ${pkgdir}/usr/src/${_modname}-${pkgver}/dkms.conf
    sed -i -e "s/BUILT_MODULE_NAME\[0\]=\".*\"/BUILT_MODULE_NAME\[0\]=\"${_modname}\"/" ${pkgdir}/usr/src/${_modname}-${pkgver}/dkms.conf

    # dkms-rtl8192se.install
    # UPPERCASE placeholders in .install file are replaced at packaging time.
    sed -i -e "s/OLD_PACKAGE_VERSION/${_oldpkgver}/" ${startdir}/${pkgname}.install
    sed -i -e "s/PACKAGE_VERSION/${pkgver}/" ${startdir}/${pkgname}.install
    sed -i -e "s/MODULE_NAME/${_modname}/" ${startdir}/${pkgname}.install

    # Realtek firmware license
    install -D -m644 firmware/RTL8192SE/Realtek-Firmware-License.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}  
md5sums=('2c122c209784452fd5bbbad3ef1f7fa1'
         'a9d94832e3b4f9c2034ee910bf7860e9'
         'd56e33c3fe727aa20687932672bec597')
