# Maintainer: Kevin Whitaker <eyecreate at gmail dot com>
# Fix: zidane

pkgname=vcmi-svn
pkgver=1602
pkgrel=2
pkgdesc="Heroes of Might and Magic 3 remake"
arch=('i686' 'x86_64')
url="http://forum.vcmi.eu/portal.php"
license=('GPL')
depends=('sdl' 'boost' 'sdl_mixer' 'sdl_image' 'sdl_ttf' 'zlib' 'ffmpeg')
makedepends=('subversion' 'automake' 'autoconf' 'libtool')
source=()
md5sums=()

_svntrunk=https://vcmi.svn.sourceforge.net/svnroot/vcmi/trunk
_svnmod=vcmi


build() {
  cd $srcdir  
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi
  cd $_svnmod
  autoreconf -i
  ./configure --prefix=/usr
  sed -i "s/#include <boost\/cstdint.hpp>/#ifdef __cplusplus\n#define __STDC_CONSTANT_MACROS\n#ifdef _STDINT_H\n#undef _STDINT_H\n#endif\n#include <boost\/cstdint.hpp>\n#endif/" ./global.h
  make || return 1
  make DESTDIR=$pkgdir install || return 1
  msg "Data files must be put in /usr/share/vcmi/ folder!"
}