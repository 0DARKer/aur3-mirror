# Contributor: Bartek Iwaniec <hash87 [at] gmail [dot] com>

pkgname=kde-extragear-plasmoids
arch=(i686 x86_64)
pkgver=4.6.0
pkgrel=2
_pubtransver=0.8.3
pkgdesc="Additional Plasmoids from kde-look.org"
url="http://www.kde-look.org/"
license="GPL"
depends=('kdebase-workspace>=4.6.0' 'qjson')
makedepends=('cmake' 'gcc' 'automoc4' 'gettext' 'boost')
source=(
	http://litc.gildiarpg.pl/downloads/quickaccess-r14.tar.gz
	http://litc.gildiarpg.pl/downloads/wifi-signal.tar.gz
	http://kde-look.org/CONTENT/content-files/91009-iHateTheCashew-4.4.tbz
	http://www.kde-look.org/CONTENT/content-files/92825-adjustableclock-2.6.1.tar.bz2
	#http://playwolf.googlecode.com/files/playwolf-0.8.1.tar.bz2
	http://www.kde-look.org/CONTENT/content-files/109367-yasp-scripted-1.0.6.tar.bz2
	http://www.kde-look.org/CONTENT/content-files/99737-fancytasks-1.0.94.tar.bz2
	http://sourceforge.net/projects/yawp/files/yawp/0.3.6/yawp-0.3.6.tar.bz2
	http://ivplasma.googlecode.com/files/toggle-compositing-0.2.3.tar.gz
	http://kde-look.org/CONTENT/content-files/97511-translatoid-1.30.tar.gz
	http://www.kde-look.org/CONTENT/content-files/92309-0.2-beta1.tar.bz2
	http://kde-look.org/CONTENT/content-files/98925-cwp-1.3.3.tar.bz2
	https://bitbucket.org/jimi312/smooth-tasks-kde-sc-4.6/get/804a4a935cc8.tar.bz2
	http://cdlszm.org/downloads/plasma-applet-daisy-0.0.4.25.tar.gz
	http://www.kde-look.org/CONTENT/content-files/91495-runcommand-2.2.tar.bz2
	http://kde-look.org/CONTENT/content-files/106175-publictransport-${_pubtransver}_ttmate-0.2.tar.gz
	http://socket-sentry.googlecode.com/files/socketsentry-0.9.3.tar.gz
	http://kde-look.org/CONTENT/content-files/104631-v2.1.1.tar.gz
	http://kde-look.org/CONTENT/content-files/107779-plasmoid-eventlist-0.3.tar.bz2
	http://kde-look.org/CONTENT/content-files/127019-playwolf-elements-0.2.2.tar.bz2
	http://kde-look.org/CONTENT/content-files/127462-fastuserswitch-0.2.1.tar.bz2
)
md5sums=('0aefd018b76b342cb3d2f53593513aad'
         '5c147b8c4c98043559716ae070bc06f2'
         '521952f888a4fe8a72969a586743c4b6'
         'a688bcfc5bf3a901fa140afea60ed713'
         'ed2288249e39f7639786785a7884f62d'
         '1e9b9c36a5fc227ce441a6f5618b83e6'
         'd64c6d528e3ba7b7afba63e6670211c8'
         'c811dd4d9842d1628b748e01855357b5'
         '7f5e2c4d11756da3b0fa9c80076426df'
         'df2624396c2838457b866483dfbf9265'
         'c736026cdde8148cfff8a99261a3f1a8'
         '2c859ee1a73f29be66ec2a455fb8ef77'
         '269fd526453a16066cb704352505f7e9'
         '1af09c59f3cba642db36871fb9cd340a'
         '02bf5490313bef1467dcebc072580ca4'
         'b737c58ccf79d63bf15c87d99728518a'
         '2cdf92909254140a532c5b93bc6e6e30'
         'b9b76b88b6a4ac3487f250db1595b4eb'
         'd2c8c95ba7774dc1ac90c0c62540b064'
         '5c8cd66451e57e6650f7e5ba861a60cf')

build() {
#Move public transport directories to srcdir
cd $srcdir/publictransport-${_pubtransver}_timetablemate-0.2 || return 1
mv plasma-applet-publictransport-${_pubtransver} ..
mv plasma-dataengine-publictransport-${_pubtransver} ..
mv publictransport-icons-${_pubtransver} ..
#mv timetablemate-0.2 .. #uncomment and install kwebkitpart-svn if you need timetablemate
rm -r $srcdir/publictransport-${_pubtransver}_timetablemate-0.2

#Build plasmoids
cd $srcdir || return 1
for _plasmoid_dir in *
do
   if [ -d $_plasmoid_dir ]
   then
       if [ -f $_plasmoid_dir/CMakeLists.txt ]
       then
	 cd $_plasmoid_dir
	 if [ $_plasmoid_dir != $startdir/src ]
	 then
	    make_plasmoid || return 1
	    cd $startdir/src
	 fi
       fi
   fi
done

#Remove conflicting files
rm ${pkgdir}/usr/share/apps/cmake/modules/FindQJSON.cmake || return 1
}



make_plasmoid() {
	cmake -DCMAKE_INSTALL_PREFIX=`kde4-config --prefix` -DCMAKE_BUILD_TYPE=Release .
	make || return 1
        make DESTDIR=$pkgdir install || return 1
}

