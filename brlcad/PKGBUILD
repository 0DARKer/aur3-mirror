#  Maintainer: Loui Chang <louipc dot ist at gmail company>

pkgname=brlcad
pkgver=7.18.0
pkgrel=1
pkgdesc="An extensive 3D solid modeling system."
url="http://brlcad.org"
license=('LGPL' 'BSD' 'custom:BDL')
arch=('i686' 'x86_64')
makedepends=('bc' 'libxslt')
install=brlcad.install
depends=('boost' 'flex' 'libpng' 'zlib' 'libgl' 'mesa' 'tk>=8.5')
_pkgprefix=/opt/$pkgname

# Hopefully we could build brlcad with these externally some time.
#	'itcl:        libs included, but package can build with external libs'
#	'itk:         libs included, but package can build with external libs'
#	'opennurbs:   libs included, but package can build with external libs'
#	'tkhtml3-cvs: for man page browsing in mged. CVS repo dead'
#	'tkpng:       for archer'
#	'urt:         Utah Raster Toolkit'
optdepends=('fop: for building pdf documentation')

# tkhtml3-cvs is needed for manpage browsing in mged.
# Older versions won't work properly

options=('!libtool')

source=(
http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.bz2
$pkgname.sh
)

build() {
    cd $srcdir/$pkgname-$pkgver

    ./configure --prefix=${_pkgprefix} \
    --with-opengl=/usr/lib \
    --with-tcl=/usr/lib \
#    --disable-documentation \
#    --disable-step \
#    --disable-tkhtml3 \
#    --disable-tkimg \
#    --disable-opennurbs

# For opennurbs, etc
# gcc -I/opt/brlcad/include -L/opt/brlcad/lib

    make || return 1
}

package() {
    cd $srcdir/$pkgname-$pkgver

    make DESTDIR=$pkgdir install || return 1

    install -D -m755 $srcdir/$pkgname.sh $pkgdir/etc/profile.d/$pkgname.sh

    mkdir -p $pkgdir/usr/share/licenses/$pkgname
    cp $srcdir/$pkgname-$pkgver/doc/legal/bdl.txt \
        $pkgdir/usr/share/licenses/$pkgname
    cp $srcdir/$pkgname-$pkgver/doc/legal/bsd.txt \
        $pkgdir/usr/share/licenses/$pkgname
    mkdir -p $pkgdir/etc/ld.so.conf.d
    echo ${_pkgprefix}/lib > $pkgdir/etc/ld.so.conf.d/$pkgname.conf
}

md5sums=('c3b7d5f5578d87cc2132720a54517d61'
         '451f65ed85b1364cc7a0bfa93192d93b')
