# Contributor: Borislav Gerassimov (slimmer) <borislavba (at) gmail.com>
# Ljukee <lukas.ryc (at) gmail.com>
pkgname=qutim-svn
pkgver=529
pkgrel=2
pkgdesc="Multiplatform instant messenger - Core only. SVN version"                                                                                         
arch=('i686' 'x86_64')
url="http://qutim.org"
license=('GPL')
depends=('qt' 'openssl' 'libxss')
makedepends=('gcc' 'make' 'cmake' 'subversion' 'pkgconfig')
optdepends=(
    'qutim-protocol-*-svn: Messaging protocols support'
    'qutim-plugin-*: Additional features'
)
conflicts=('qutim' 'qutim-svn-dev' 'qutim-archangel')
provides=('qutim' 'qutim-svn-dev' 'qutim-archangel')
replaces=('qutim-svn-dev' 'qutim-archangel')

_svnmod=qutim
_svntrunk=http://qutim.org/svn/qutim

build() {
msg "Downloading from ${_svntrunk} ..."
  cd ${srcdir}
  if [ -d ${_svnmod}/.svn ]; then
    (cd ${_svnmod} && svn up -r ${pkgver})
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
  fi
msg2 "SVN checkout done or server timeout"

msg "Creating temporary build directory..."
  rm -Rf ${_svnmod}-build
  cp -r ${_svnmod}/trunk ${_svnmod}-build
  cd ${_svnmod}-build/

msg "Building and installing..."  
  cmake . -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release || return 1
  make DESTDIR=${pkgdir} install || return 1

msg "Removing build directory..."
  cd ${srcdir}
  rm -Rf ${_svnmod}-build
}
