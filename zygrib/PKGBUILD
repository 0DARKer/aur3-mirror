# Maintainer: Max Sydorenko <maxsydorenko at gmail dot com>
# Contributor: Pierre DOUCET <pierre at equinoxefr.org>
pkgname=zygrib
_upname=zyGrib # upstream, case-sensitive project name
pkgver=6.2.3
pkgrel=1
pkgdesc="Weather data visualization, GRIB file viewer"
arch=('i686' 'x86_64')
url="http://www.zygrib.org/"
license=('GPL3')
depends=('qt4>=4.5' 'bzip2' 'zlib>=1.2.3' 'proj>=4.6.0' 'ttf-liberation' 'libnova') #'qwt<6.1.0' 
optdepends=('zygrib-maps: gshhs high-resolution maps from zygrib.org')
source=($_upname-$pkgver.tgz::http://www.zygrib.org/getfile.php?file=$_upname-$pkgver.tgz \
	zyGrib_Qt_path.patch
	zyGrib_ARCH_0.1.patch
        zygrib.sh 
	zygrib.desktop
        zygrib.png) # creative commons licence
md5sums=('bc74bb78b991c93297d22ced77f2f716'
	'578b84ef728288125f0a3529efca7bc2'
	'c2e2e663f79fd8529b781d94b53a424b'
	'06b65dbdbcd029d5172ce811b79200c1'
	'c5b5f1af03375d4512c51e29656c4f31'
	'522f9a9d71d16a76da48f601ba88fa49')
prepare() {
  cd "$srcdir/$_upname-$pkgver"
  msg "Please, read comments section here https://aur.archlinux.org/packages/zygrib/ before build"
  patch -p1 -i $srcdir/zyGrib_Qt_path.patch # Qt4 path patched 
# patch -p1 -i $srcdir/zyGrib_ARCH_0.1.patch # Qt4 path patched + system-wide qwt is used. qwt 6.0.x is required
}
build() {
  cd "$srcdir/$_upname-$pkgver"
  make INSTALLDIR=$pkgdir/opt/zygrib || return 1  
}

package() {
  install -d -m 755 $pkgdir/opt/$pkgname/{bin,data,data/colors,data/config,data/fonts/liberation-fonts,data/gis,data/img,data/maps/gshhs,data/stuff,data/tr}
  install -d -m 755 $pkgdir/usr/{bin,share/{applications,pixmaps}}
  install -D -m 755 $srcdir/zygrib.sh $pkgdir/usr/bin/zygrib
  install -D -m 644 $srcdir/zygrib.desktop $pkgdir/usr/share/applications
  install -D -m 644 $srcdir/zygrib.png $pkgdir/usr/share/pixmaps
  install -D -m 755 $srcdir/$_upname-$pkgver/src/$_upname $pkgdir/opt/$pkgname/bin
  install -D -m 644 $srcdir/$_upname-$pkgver/data/colors/* $pkgdir/opt/$pkgname/data/colors
install -D -m 644 $srcdir/$_upname-$pkgver/data/gis/* $pkgdir/opt/$pkgname/data/gis
install -D -m 644 $srcdir/$_upname-$pkgver/data/img/* $pkgdir/opt/$pkgname/data/img
install -D -m 644 $srcdir/$_upname-$pkgver/data/maps/gshhs/* $pkgdir/opt/$pkgname/data/maps/gshhs
install -D -m 644 $srcdir/$_upname-$pkgver/data/stuff/* $pkgdir/opt/$pkgname/data/stuff
install -D -m 644 $srcdir/$_upname-$pkgver/data/tr/* $pkgdir/opt/$pkgname/data/tr
}
