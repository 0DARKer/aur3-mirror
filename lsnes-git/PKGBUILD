# Maintainer: Sigurd NÃ¦ss <sigurdkn@gmail.com>
pkgname=lsnes-git
pkgver=20130201
pkgrel=3
pkgdesc="A rerecording Super Nintendo emulator based on the extremely accurate Bsnes."
arch=('i686' 'x86_64')
url="http://tasvideos.org/Lsnes.html"
depends=(libsamplerate portaudio opus wxgtk lua ffmpeg boost-libs)
makedepends=(git boost)
license=('GPL')
source=('http://bsnes.googlecode.com/files/bsnes_v085-source.tar.bz2')
md5sums=('2419710087ba28c894e5aa1c3c41b6e7')

build() {
	cd $srcdir || exit 1
	rm -Rf lsnes
	git clone git://repo.or.cz/lsnes.git || exit 1
	# Prepare bsnes
	cd bsnes_v085-source/bsnes || exit 1
	cat $srcdir/lsnes/bsnes-patches/v085/*.patch | patch -p1 || exit 1
	# Prepare gambatte
	cd $srcdir
	rm -Rf gambatte
	svn co -r 364 https://gambatte.svn.sourceforge.net/svnroot/gambatte || exit 1
	cd gambatte
	cat $srcdir/lsnes/libgambatte-patches/svn364/*.patch | patch -p1 || exit 1
	cd $srcdir/lsnes || exit 1
	ln -s $srcdir/bsnes_v085-source/bsnes . || exit 1
	make CC=g++ SOUND=portaudio THREADS=NATIVE JOYSTICK=evdev SECRET_RABBIT_CODE=yes BSNES_VERSION=085 BSNES_IS_COMPAT=yes OPUS_CODEC=yes || exit 1
	install -D lsnes $pkgdir/usr/bin/lsnes
}
