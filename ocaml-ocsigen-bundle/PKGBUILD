# Maintainer: Thibault Suzanne <thi.suzanne@gmail.com>

_srcname='ocsigen-bundle'
pkgname="ocaml-${_srcname}"
pkgver='2.0.2'
pkgrel=3
pkgdesc='Clean and safe tools for developing and running client/server Web 2.0 applications with OCaml'
arch=('i686' 'x86_64')
url='http://ocsigen.org/'
license=('LGPL')
depends=('ocaml>=3.12.0' 'ocaml-compiler-libs' 'libev' 'glibc' 
  'ocaml-calendar' 'ocaml-cryptokit' 'ocamlnet' 'ocaml-pcre' 'ocaml-react' 'ocaml-ssl' 'ocaml-sqlite3'
  'ocaml-text')
makedepends=('ocaml-findlib')
optdepends=('ocaml-zip' 'ocamlduce' 'ocaml-type-conv')
provides=("ocaml-ocsigenserver=${pkgver}" "ocaml-lwt=${pkgver}" "ocaml-tyxml=${pkgver}"
  "ocaml-eliom=${pkgver}" "ocaml-js_of_ocaml=${pkgver}" "ocaml-deriving-ocsigen=0.3b")

conflicts=("ocaml-ocsigenserver" "ocaml-lwt" "ocaml-tyxml"
  "ocaml-eliom" "ocaml-js_of_ocaml" "ocaml-deriving-ocsigen")

options=('!strip')
source=("http://ocsigen.org/download/${_srcname}-${pkgver}.tar.gz")
md5sums=('bf259b3ebe7b812282e74b9567ae719a')


build() {
  cd "${srcdir}/${_srcname}-${pkgver}"
  chmod +x configure
  ./configure --prefix=/usr
  make || return 1
}


package() {
  cd "$srcdir/${_srcname}-${pkgver}"
  make \
    SITELIB="${pkgdir}/usr/lib/ocaml" \
    BINDIR="${pkgdir}/usr/bin" \
    LDCONF="${pkgdir}/usr/lib/ocaml/ld.conf" \
    COMMANDPIPE="${pkgdir}/var/run/ocsigen" \
    CONFIGDIR="${pkgdir}/etc/ocsigenserver" \
    LOGDIR="${pkgdir}/var/log/ocsigenserver" \
    STATICPAGESDIR="${pkgdir}/srv/ocsigenserver" \
    DATADIR="${pkgdir}/var/lib/ocsigenserver" \
    MANDIR="${pkgdir}/usr/share/man/man1" \
    -e install
  rm -f "${pkgdir}/usr/lib/ocaml/ld.conf"
}
