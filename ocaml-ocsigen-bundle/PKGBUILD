# Maintainer: Thibault Suzanne <thi.suzanne@gmail.com>

_srcname='ocsigen-bundle'
pkgname="ocaml-${_srcname}"
pkgver='2.0.2'
pkgrel=1
pkgdesc='Clean and safe tools for developing and running client/server Web 2.0 applications with OCaml'
arch=('i686' 'x86_64')
url='http://ocsigen.org/'
license=('LGPL')
depends=('ocaml>=3.12.0' 'ocaml-compiler-libs' 'libev' 'glibc' 
  'ocaml-calendar' 'ocaml-cryptokit' 'ocamlnet' 'ocaml-pcre' 'ocaml-react' 'ocaml-ssl' 'ocaml-sqlite3'
  'ocaml-text')
makedepends=('ocaml-findlib')
optdepends=('ocaml-zip' 'ocamlduce' 'ocaml-type-conv')
provides=("ocaml-ocsigenserver=${pkgver}" "ocaml-lwt=${pkgver}" 
  "ocaml-eliom=${pkgver}" "ocaml-js_of_ocaml=${pkgver}" "ocaml-deriving-ocsigen=0.3b")

conflicts=("ocaml-ocsigenserver" "ocaml-lwt" 
  "ocaml-eliom" "ocaml-js_of_ocaml" "ocaml-deriving-ocsigen")

options=('!strip')
source=("http://ocsigen.org/download/${_srcname}-${pkgver}.tar.gz")
md5sums=('bf259b3ebe7b812282e74b9567ae719a')

build() {
  cd "${srcdir}/${_srcname}-${pkgver}"
  chmod +x configure
  ./configure --prefix="${pkgdir}/usr"
  make -e
}


package() {
  mkdir -p "${pkgdir}/usr/lib"
  mkdir -p "${pkgdir}/usr/lib/ocaml"
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/local"
  cd "$srcdir/${_srcname}-${pkgver}"
  make -e install
  
  mkdir -p "${pkgdir}/etc/rc.d"
  cp "${startdir}/etc_rc.d_ocsigenserver" "${pkgdir}/etc/rc.d/ocsigenserver"
}
