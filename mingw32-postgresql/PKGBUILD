pkgname=mingw32-postgresql
pkgver=9.1.2
pkgrel=2
pkgdesc="PostgreSQL (mingw32)"
arch=('any')
url="http://www.postgresql.org/"
license=('custom:PostgreSQL')
makedepends=('mingw32-gcc')
options=('!strip' '!buildflags' '!libtool')
source=("http://ftp.postgresql.org/pub/source/v$pkgver/postgresql-$pkgver.tar.bz2")
md5sums=('7dbff52221954c46595313eb7f92c3e0')

build() {
  cd "${srcdir}/postgresql-$pkgver"

  unset LDFLAGS

  ./configure --prefix=/usr/i486-mingw32 --host=i486-mingw32
  make
}

package() {
  cd "${srcdir}/postgresql-$pkgver"

  make DESTDIR=${pkgdir} install
  mv $pkgdir/usr/i486-mingw32/lib/*.dll $pkgdir/usr/i486-mingw32/bin
  i486-mingw32-strip $pkgdir/usr/i486-mingw32/bin/*.exe
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/bin/*.dll
  i486-mingw32-strip -x $pkgdir/usr/i486-mingw32/lib/postgresql/*.dll
  i486-mingw32-strip -g $pkgdir/usr/i486-mingw32/lib/*.a
  rm -R $pkgdir/usr/i486-mingw32/lib/postgresql/pgxs
}