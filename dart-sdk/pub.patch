--- src/dart-sdk/bin/pub	2013-10-22 05:51:13.000000000 -0600
+++ pub	2013-10-28 11:28:17.924039151 -0600
@@ -9,7 +9,13 @@
 # Setting BIN_DIR this way is ugly, but is needed to handle the case where
 # dart-sdk/bin has been symlinked to. On MacOS, readlink doesn't work
 # with this case.
-BIN_DIR="$(cd "${0%/*}" ; pwd -P)"
+_source="${BASH_SOURCE[0]}"
+while [ -h "$_source" ]; do # resolve $_source until the file is no longer a symlink
+  BIN_DIR="$( cd -P "$( dirname "$_source" )" && pwd )"
+  _source="$(readlink "$_source")"
+  [[ $_source != /* ]] && _source="$BIN_DIR/$_source" # if $_source was a relative symlink, we need to resolve it relative to the path where the symlink file was located
+done
+BIN_DIR="$( cd -P "$( dirname "$_source" )" && pwd )"
 SDK_DIR="$(cd "${BIN_DIR}/.." ; pwd -P)"
 
 SNAPSHOT="$BIN_DIR/snapshots/pub.dart.snapshot"
@@ -40,4 +46,4 @@
   PUB="$SDK_DIR/lib/_internal/pub/bin/pub.dart"
 
   exec "$DART" "--package-root=$PACKAGES_DIR" "$PUB" "$@"
-fi
\ No newline at end of file
+fi
