# Maintainer: Alexander Boyko <brdcom@ya.ru>
pkgname=bgbilling
_pkgname=BGBillingServer
pkgver=5.2
pkgrel=1422
pkgdesc="Billing system BGBilling 5.2"
arch=('i686' 'x86_64') 
url="http://bgbilling.ru"
license=('custom')
depends=('mysql' 'activemq' 'java-runtime=6' 'pbzip2')
makedepends=('unzip' 'dos2unix')
source=(bgbilling
	service
	setenv.sh.patch)
install=install
md5sums=('1cf78bd1085acbb18132a4435f9f481b'
         'c8843bcacf5a387a38238e2930c10b17'
         '0f7f773fb2e39637f1db752e439561e9')

build() {
  wget -c ftp://bgbilling.ru/pub/bgbilling/${pkgver}/${_pkgname}_${pkgver}_*.zip
  wget -c http://bgbilling.ru/test_license/5.0/lic.properties
  unzip -o ${_pkgname}_${pkgver}_*.zip

  install -d -m0755 ${pkgdir}/etc/conf.d
  install -d -m0755 ${pkgdir}/opt
  install -d -m0755 ${pkgdir}/usr/lib/systemd/system

  mv ${srcdir}/${_pkgname} ${pkgdir}/opt/${pkgname}
  install -D -m0644 ${srcdir}/dump.sql ${pkgdir}/opt/${pkgname}/dump.sql
  rm -f ${pkgdir}/opt/${pkgname}/data/lic.properties
  install -D -m0644 ${srcdir}/lic.properties ${pkgdir}/opt/${pkgname}/data/lic.properties
  install -D -m0644 ${srcdir}/service ${pkgdir}/usr/lib/systemd/system/${pkgname}.service
  install -D -m0644 ${srcdir}/${pkgname} ${pkgdir}/etc/conf.d/${pkgname}

  cd ${pkgdir}/opt/${pkgname}/script/
  dos2unix *
  chmod 0755 *
  cd ..
  dos2unix *.sh
  chmod 0755 *.sh


  cp ${srcdir}/setenv.sh.patch ${pkgdir}/opt/${pkgname}
  cd ${pkgdir}/opt/${pkgname}
  patch -p0 <setenv.sh.patch
  rm setenv.sh.patch

  cd ${pkgdir}/opt/${pkgname}
  rm -rf ./script
  rm -rf *.ini
  rm -rf *.bat
  rm -rf *.exe
}
