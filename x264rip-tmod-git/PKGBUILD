pkgname=x264rip-tmod-git
pkgver=20120119
pkgrel=1
pkgdesc="H.264/MPEG-4 AVC video encoder for both 8 and 10 bit output with lavf import, audio encoder and muxer"
arch=('i686' 'x86_64')
url="https://astrataro.wordpress.com/"
license=('GPL')
# depends on libav>0.8
depends=('glibc' 'libav-beta')
makedepends=('git' 'yasm')

_gitroot="git://github.com/astrataro/x264_tMod.git"
_gitname="x264_tMod"
buildparams="--enable-nonfree --enable-strip --enable-lto"

build() {
	cd $srcdir
	msg "Connecting to the Git repository..."
	
	if [[ -d $srcdir/$_gitname ]] ; then
		cd $_gitname
		git pull origin
	else
		git clone $_gitroot --branch tMod
	fi
	
	msg "Git clone done"
	msg "Starting make..."
	
	rm -rf $srcdir/$_gitname-build
	git clone $srcdir/$_gitname $srcdir/$_gitname-build --branch tMod
	
	cd $srcdir/$_gitname-build
	
	chmod +x configure version.sh
	mkdir -p $pkgdir/usr/bin
	./configure $buildparams --bit-depth=10
	make
	mv x264 $pkgdir/usr/bin/x264-10bit
	./configure $buildparams
	make
	mv x264 $pkgdir/usr/bin/x264-8bit
	rm -rf $srcdir/$_gitname-build
}
