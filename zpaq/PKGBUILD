# Maintainer: Marco Schulze <marco.c.schulze-gmail.com>
# Contributor: TuxSpirit<tuxpsiritATarchlinuxDOTfr>
# Contributor: Jan Stępień <jstepien@users.sourceforge.net>

pkgname=zpaq
pkgdesc="Programmable file compressor, library and utilities. Based on the PAQ compression algorithm"
url="http://mattmahoney.net/dc/zpaq.html"
pkgver=6.16
pkgrel=2

_zpaq_ver=616

arch=('i686' 'x86_64')
license=('GPL3' 'MIT')

source=(http://mattmahoney.net/dc/zpaq${_zpaq_ver}.zip)
sha512sums=('7b6a4d8827eb17f92a77dbc46c5398791c0817e78d1400bb108758c9133614a0da161f18249ff436f92f2630f42e5f10e4a8f987d9b89c97c0b5b2ba97b6898a')

build()
{
	cd "$srcdir"

	if [ -z "$CC" ]; then
		CC=gcc
	fi
	if [ -z "$CXX" ]; then
		CXX=g++
	fi

	msg "Building libzpaq"
	$CXX -fPIC $CXXFLAGS -DNDEBUG -c libzpaq.cpp
	$CXX -shared $LDFLAGS -o libzpaq.so libzpaq.o

	msg "Building zpaq"
	$CC $CFLAGS -DNDEBUG -fopenmp -c divsufsort.c
	$CXX $CXXFLAGS $LDFLAGS -DNDEBUG -lpthread -fopenmp zpaq.cpp divsufsort.o -L. -lzpaq -o zpaq
}

package()
{
        install -d $pkgdir/usr/{bin,include,lib}

	install libzpaq.h $pkgdir/usr/include
	install libzpaq.so $pkgdir/usr/lib

	install zpaq $pkgdir/usr/bin
}
