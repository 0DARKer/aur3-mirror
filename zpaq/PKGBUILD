# Maintainer: Marco Schulze <marco.c.schulze-gmail.com>
# Contributor: TuxSpirit<tuxpsiritATarchlinuxDOTfr>

pkgname=zpaq
pkgdesc="Programmable file compressor, library and utilities. Based on the PAQ compression algorithm"
url="http://mattmahoney.net/dc/zpaq.html"
pkgver=3.00
pkgrel=1

_zpaq_ver=300

arch=('i686' 'x86_64')
license=('GPL3' 'MIT')
makedepends=('unzip')

source=(http://mattmahoney.net/dc/zpaq${_zpaq_ver}.zip)
sha512sums=('076f5b3876c9c75c269d64081d59f68ba9b7430a0708fe00451911ca04f82386968788ccc0e57b5366c37ae7f11d61a59f700921c01a03193b89ce9dfb94eb1c')

build()
{
	## The provided makefile is not used, since it's Windows-specific
	# TODO: zpaqopt script/-DOPT switch
	# TODO: libzpaqo compilation

	cd "$srcdir"

	msg "Building libzpaq"
	$CXX $CXXFLAGS -DNDEBUG -c libzpaq.cpp
	ar rcs libzpaq.a libzpaq.o

	msg "Building zpaq"
	$CC $CFLAGS -DNDEBUG -c divsufsort.c
	$CXX $CXXFLAGS $LDFLAGS -DNDEBUG zpaq.cpp divsufsort.o -lpthread -fopenmp -L. -lzpaq -o zpaq
}

package()
{
        mkdir -p $pkgdir/usr/{bin,include,lib}

	cp libzpaq.h $pkgdir/usr/include
	cp libzpaq.a $pkgdir/usr/lib

	cp zpaq $pkgdir/usr/bin
}
