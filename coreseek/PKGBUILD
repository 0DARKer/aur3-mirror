# Contributor: lishengming.zju <lishengming.zju@gmail.com>
pkgname='coreseek'
pkgver=4.1beta
_pkgver=4.1-beta
pkgrel=1
pkgdesc='Free open-source SQL full-text search engine.'
arch=('i686' 'x86_64')
url='http://www.coreseek.cn'
license=('GPLv2')
depends=('libxml2' 'expat' 'libmysqlclient')
makepends=('gcc' 'make' 'automake >= 1.11' 'autoconf >= 2.65' 'libtool >= 2.2.6b' 'm4 >= 1.4.13')
source=("http://www.coreseek.cn/uploads/csft/4.0/$pkgname-$_pkgver.tar.gz")
md5sums=('a10e71df2ea2def275b24cba4115aa69')

build() {
  cd "${srcdir}/${pkgname}-${_pkgver}"
  cd mmseg-3.2.14
  sh ./bootstrap
  ./configure --prefix=/usr
  make &&  make DESTDIR="${pkgdir}" install
  cd ../csft-4.1
  sh buildconf.sh
  ./configure --prefix=/usr --sysconfdir=/etc/csft --localstatedir=/var/csft --without-unixodbc --with-mmseg \
  --with-mmseg-includes=${pkgdir}/usr/include/mmseg/ --with-mmseg-libs=${pkgdir}/usr/lib/ --with-mysql
  make && make DESTDIR="${pkgdir}" install
}
package() {
  #mv mmseg etc files to /etc/mmseg/
  mv "${pkgdir}/usr/etc/" "${pkgdir}/etc/mmseg/"
}