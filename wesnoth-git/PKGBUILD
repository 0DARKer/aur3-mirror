# Maintainer: Archadept
#   Revision: 2013-04-19

pkgname=wesnoth-git
pkgver=1.11.2.169.gb92b229
pkgrel=1
pkgdesc="The latest version of a turn-based strategy game on a fantasy world."
arch=('x86_64')
url="http://www.wesnoth.org/"
license=('GPL')
depends=('boost' 'fribidi' 'lua' 'sdl' 'sdl_ttf' 'sdl_net' 'sdl_mixer' 'sdl_image')
makedepends=('openssh' 'python' 'scons' 'git')
conflicts=('wesnoth' 'wesnoth-data' 'wesnoth-devel')
provides=('wesnoth')
replaces=('wesnoth-svn')

source=()
md5sums=()

_gittrunk=git://git.code.sf.net/p/wesnoth/code
_gitmod=wesnoth
pkgver() {
  cd $_gitmod
  git describe | sed 's/-/./g'
}

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server..."
  msg "Checking out $_gitmod"

  if [ -d $_gitmod/.git ]; then
    (cd $_gitmod && git pull)
  else
    git clone $_gittrunk $_gitmod
  fi

  msg "GIT checkout done or server timeout"
  msg "Setting up build environment..."

  rm -rf ${srcdir}/$_gitmod-build
  cp -r ${_gitmod} ${_gitmod}-build || return 1
  cd ${_gitmod}-build

  msg "Starting build"
  scons prefsdir=.config/wesnoth-git prefix=/usr debug=yes || return 1
  scons destdir=${pkgdir} install || return 1
}
