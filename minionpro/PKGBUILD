# Maintainer:  Stefan Husmann <stefan-husmann@t-online.de>
pkgname=minionpro
pkgver=2.015
pkgrel=2
pkgdesc="Myriad and Minion for LaTeX (the not-xeLaTeX way)"
url="http://lglinux.blogspot.com/2007/09/myriad-and-minion-for-latex.html"
arch=('any')
license=('unknown')
depends=('texlive-core')
makedepends=('unzip')
install=minionpro.install
source=(ftp://dante.ctan.org/tex-archive/fonts/minionpro/scripts.zip \
  ftp://dante.ctan.org/tex-archive/fonts/minionpro/enc-2.000.zip \
  ftp://dante.ctan.org/tex-archive/fonts/minionpro/metrics-base.zip \
http://ardownload.adobe.com/pub/adobe/reader/unix/8.x/8.1.3/deu/AdobeReader_deu-8.1.3-1.i486.tar.bz2 \
  ftp://tug.ctan.org/pub/tex-archive/fonts/mnsymbol.zip \
  http://faq.ktug.or.kr/wiki/uploads/MyriadProAR7.pdf \
  http://faq.ktug.or.kr/wiki/uploads/MyriadProAR7.zip \
http://www.adobe.com/products/eulas/pdfs/Reader_Player_AIR_WWEULA-Combined-20080204_1313.pdf#page=78)
md5sums=('ec2cf45336fe2bdbc63e404c72f4eb6e' 'ac1e22a5f484b93e60bd84951bab7527'\
         'cf1ba13d39085ae58a7e96a5466bd66e' 'c56ad633db07b8a21d222f6d38455940'\
         '5c851f41606ef7dc66c361149018d53b' '24fae0babc3d07eea2c84ddd32ddf1ef'\
         'a183b5a604e7bc4004de9ed9eaba5ce7' '1636037610ee2aa35c5fb736a697b7e0')
noexpand=('enc-2.000.zip' 'metrics-base.zip' 'MyriadProAR7.zip')

build() {
  cd $srcdir/AdobeReader 
  tar xvf COMMON.TAR || return 1
  mv Adobe/Reader8/Resource/Font/M*.otf $srcdir/otf || return 1
  cd $srcdir
  ./convert.sh || return 1
  install -d $pkgdir/usr/share/texmf/fonts/type1/adobe/MinionPro || return 1
  install -d $pkgdir/usr/share/texmf/fonts/type1/adobe/MyriadPro || return 1
  cp pfb/Min*.pfb \
    $pkgdir/usr/share/texmf/fonts/type1/adobe/MinionPro || return 1
  cp pfb/Myr*.pfb \
    $pkgdir/usr/share/texmf/fonts/type1/adobe/MyriadPro || return 1
  unzip -quo -d $pkgdir/usr/share/texmf enc-2.000.zip || return 1
  unzip -quo -d $pkgdir/usr/share/texmf metrics-base.zip || return 1
  cd $srcdir/mnsymbol/tex
  [ -f MnSymbol.drv ] && rm MnSymbol.drv 
  [ -f MnSymbol.sty ] && rm MnSymbol.sty 
  latex MnSymbol.ins || return 1
  install -Dm644 MnSymbol.sty \
    $pkgdir/usr/share/texmf/tex/latex/MnSymbol/MnSymbol.sty || return 1
  cd ..
  install -d $pkgdir/usr/share/texmf/fonts/source/public/MnSymbol || return 1
  cp -r source/* \
    $pkgdir/usr/share/texmf/fonts/source/public/MnSymbol || return 1
  for _i in MnSymbol.ps MnSymbol.pdf README
  do
    install -Dm644 ${_i} $pkgdir/usr/share/texmf/doc/latex/MnSymbol/${_i}
  done || return 1
  sed -i 's+\[++' enc/MnSymbol.map || return 1
  install -Dm644 enc/MnSymbol.map \
    $pkgdir/usr/share/texmf/fonts/map/dvips/MnSymbol/MnSymbol.map || return 1
  install -d $pkgdir/usr/share/texmf/fonts/enc/dvips/MnSymbol || return 1
  cp enc/*.enc $pkgdir/usr/share/texmf/fonts/enc/dvips/MnSymbol || return 1
  install -d $pkgdir/usr/share/texmf/fonts/type1/public/MnSymbol || return 1
  cp pfb/*.pfb \
    $pkgdir/usr/share/texmf/fonts/type1/public/MnSymbol || return 1
  install -d $pkgdir/usr/share/texmf/fonts/tfm/public/MnSymbol || return 1
  cp tfm/*.tfm \
    $pkgdir/usr/share/texmf/fonts/tfm/public/MnSymbol || return 1
  [ -d myriad ] || mkdir myriad
  cd myriad
  unzip -quo $srcdir/MyriadProAR7.zip || return 1
  [ -d fonts/tfm/adobe ] && rm -r fonts/tfm/adobe
  mv fonts/tfm/Adobe fonts/tfm/adobe
  [ -d fonts/type1/adobe ] && rm -r fonts/type1/adobe
  mv fonts/type1/Adobe fonts/type1/adobe
  [ -d fonts/enc ] || mkdir fonts/enc
  cp -r dvips fonts/enc/
  rm -r dvips
  sed -i 's+\[++' fonts/enc/dvips/MyriadPro/MyriadPro.map 
  install -Dm644 fonts/enc/dvips/MyriadPro/MyriadPro.map \
    $pkgdir/usr/share/texmf/fonts/map/dvips/MyriadPro/MyriadPro.map \
    || return 1
  rm fonts/enc/dvips/MyriadPro/MyriadPro.map 
  cp -R * $pkgdir/usr/share/texmf || return 1
  install -Dm644 $srcdir/MyriadProAR7.pdf \
    $pkgdir/usr/share/texmf/doc/latex/MyriadPro/MyriadPro.pdf || return 1
  sed -i 's+\[++' \
   $pkgdir/usr/share/texmf/fonts/map/dvips/MinionPro/MinionPro.map || return 1
  chmod o+r $pkgdir/usr/share/texmf/doc/latex/MinionPro/tabfigures.pdf \
    $pkgdir/usr/share/texmf/doc/latex/MinionPro/fontaxes.pdf \
    $pkgdir/usr/share/texmf/doc/latex/MinionPro/otfontdef.pdf || return 1
  install -Dm644 \
    $srcdir/Reader_Player_AIR_WWEULA-Combined-20080204_1313.pdf#page=78 \
    "$pkgdir/usr/share/licenses/$pkgname/license.pdf" || return 1
  echo done

}