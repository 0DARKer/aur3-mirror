# Maintainer: localizator <localizator at ukr dot net>

pkgname=vkaudiosaver
_realname=VkAudioSaver
pkgver=1.4.0
pkgrel=1
pkgdesc="A tool for listening & downloading the music from social network VK.COM"
arch=('i686' 'x86_64')
url="http://vkaudiosaver.ru/"
license=('GPL3')
groups=("network")

if [ "$CARCH" = "i686" ]; then
    _arch='i386'
	depends=('fontconfig' 'freetype2' 'libstdc++5' 'libx11' 'libxext' 'libxrender' 'zlib' 'libpng12')
    sha256sums=('cae7435f9ba8cdb546d0c0e550ad0d8f260ec121bee58effeab7ae4fbd193ec1'
                '0d1d48e4f3d4990c55999c1a70e7a8af3fa5fe8df6b5c555e72bf040cc48f666')
elif [ "$CARCH" = "x86_64" ]; then
    _arch='amd64'
	depends=('fontconfig' 'freetype2' 'libstdc++5' 'libx11' 'libxext' 'libxrender' 'zlib' 'libpng12'
	'lib32-fontconfig' 'lib32-freetype2' 'lib32-libxext' 'lib32-zlib' 'lib32-gcc-libs' 'lib32-libxrandr' 'lib32-libstdc++5' 'lib32-libpng12')
    sha256sums=('530d66f1e7a09e5e3c8c3cd1f296b34647509b14ccd23c6ae286cef63cb93c04'
                '0d1d48e4f3d4990c55999c1a70e7a8af3fa5fe8df6b5c555e72bf040cc48f666')
fi

source=("${pkgname}-${pkgver}-${_arch}.tar.gz::https://dl.dropboxusercontent.com/u/24598537/build/${pkgname}/${pkgname}-${pkgver}-${_arch}.tar.gz"
        "vkaudiosaver.desktop")

package() {

  msg "Preparing install"
  mkdir -p ${pkgdir}/usr/{bin,share}
  mkdir -p ${pkgdir}/usr/share/pixmaps
  msg2 "Done preparing!"

  msg "Actual installation"
  cp -dpr --no-preserve=ownership ${srcdir}/{opt,usr} ${pkgdir}
  rm ${pkgdir}/usr/share/applications/${pkgname}.desktop
  cp ${srcdir}/${pkgname}.desktop ${pkgdir}/usr/share/applications
  ln -s "${pkgdir}/opt/$_realname/${pkgname}" "${pkgdir}/usr/bin/${pkgname}"
  ln -s "${pkgdir}/opt/$_realname/icon64.png" "${pkgdir}/usr/share/pixmaps/${pkgname}.png"
  msg2 "Installation finished!"

}