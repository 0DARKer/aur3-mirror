# Maintainer: skydrome <irc.freenode.net>
# Contributor: skydrome <irc.freenode.net>

pkgname=rutorrent-plugins-svn
pkgver=1902
pkgrel=1
pkgdesc="Plugins for ruTorrent"
arch=('any')
url="http://code.google.com/p/rutorrent/"
license=('GPL')
depends=('rutorrent-svn' 'curl' )
makedepends=('subversion')
optdepends=('mktorrent: to create torrent files with mktorrent'
            'buildtorrent: to create torrent files with buildtorrent'
            'transmission-cli: to create torrent files with transmission'
            'php-geoip: to enable geoip plugin'
            'geoip: enable geoip plugin'
            'unrar: enable unpack plugin'
            'unzip: enable unpack plugin')
provides=('rutorrent-plugins')
conflicts=('rutorrent-plugins')
install=
source=("plugins.ini")
md5sums=('8a5d8b83e60a3e55716d87906cc8a734')

_svntrunk="http://rutorrent.googlecode.com/svn/trunk/plugins/"
_svnmod="plugins"

build() {
    cd "$srcdir"
    if [ -d ${_svnmod}/.svn ]; then
        cd "$_svnmod" && svn up -r "$pkgver"
    else
        svn co "$_svntrunk" --config-dir ./ -r "$pkgver" "$_svnmod"
    fi

	sed -i "s:\$defaultTheme .*:\$defaultTheme = \"Oblivion\";:" ${srcdir}/${_svnmod}/theme/conf.php

    msg "SVN checkout done or server timeout"
    msg "Starting make..."
    cd "$srcdir"
    mkdir -p ${pkgdir}/srv/http/rutorrent
}

package() {
    cp -r "$_svnmod" ${pkgdir}/srv/http/rutorrent
    chmod -R 755 ${pkgdir}/srv/http/rutorrent/${_svnmod}
}
