# Contributor: Kosenko Roman <madkite@gmail.com>
pkgname=yzis-svn
pkgver=0.1
_svntrunk='svn://svn.yzis.org/yzis/trunk'
pkgrel=2719
true && pkgrel=$(svn info "${_svntrunk}" | awk '/Revision/ {print $2}')
pkgdesc='Vi-like editor with frontends for Qt4 and NCurses'
url='http://www.yzis.org'
license=('GPL')
depends=('qt>=4.1.0' 'lua>=5.1' 'ncurses')
makedepends=('subversion' 'cmake' 'doxygen')
arch=('i686' 'x86_64')
source=()
md5sums=()
provides=(yzis)
conflicts=(yzis)

_svnsrc="${SRCDEST}/${pkgname}-${pkgver}.tar.gz"

build() {
	cd ${startdir}/src/
	[ -d ${pkgname} ] && rm -rf ${pkgname}
	[ -f ${_svnsrc} ] && tar -xzf ${_svnsrc}
	msg "Connecting to ${_svntrunk} SVN server..."
	if [ -d ${pkgname}/.svn ]; then
		svn up ${pkgname}
	else
		svn co "${_svntrunk}" ${pkgname}
	fi
	msg 'SVN checkout done or server timeout'
	tar -czf ${_svnsrc} ${pkgname}
	cd ${pkgname}
	msg 'Starting make...'
	mkdir build
	cd build
	cmake -DENABLE_LIBYZISRUNNER=off -DCMAKE_VERBOSE_MAKEFILE=on -DGENERATE_DOC=on \
		-DCMAKE_INSTALL_PREFIX=${startdir}/pkg/usr ..
	make || return $?
	make test || return $?
	make install || return $?
}
