#! /bin/bash
# Maintainer: Jorge Barroso <jorge.barroso.11@gmail.com>
# Thanks again to: superlex
 
# We're getting this from Debian Experimental
 
_libmozjs=26
_debname=iceweasel
_debver=26.0
_debrel=1
_debrepo=http://ftp.de.debian.org/debian/pool/main/i/
 
pkgname=iceweasel-bin
pkgver=${_debver}.deb${_debrel}
pkgrel=1
pkgdesc="Debian Browser based on Mozilla Firefox (bin version)"
arch=('i686' 'x86_64')
url=("http://www.geticeweasel.org")
license=('MPL' 'GPL' 'LGPL')
conflicts=("$_debname")
provides=("$_debname"="$_debver")
 
depends=( 'gtk2' 'mozilla-common' 'libxt' 'startup-notification' 'mime-types' 'dbus-glib' 'alsa-lib'
         'libnotify' 'desktop-file-utils' 'hicolor-icon-theme' 'libvpx' 'libevent' 'nss>=3.14.1' 'hunspell' 'sqlite')
 
optdepends=('iceweasel-sync: Speed up Iceweasel using tmpfs'
            'mozplugger: A Mozilla & Firefox multimedia plugin.'
            'mozilla-searchplugins: extra search plugins'
            'iceweasel-extension-archsearch: Iceweasel Arch search engines (AUR, Pkgs, BBS, Wiki, etc.)'
            'iceweasel-extension-archforumsearch-it: Iceweasel search engines for Arch Linux Italian forum'
            'iceweasel-i18n-it: Language Pack for Iceweasel'
            'iceweasel-i18n-es: Spanish language pack for Iceweasel'
            'iceweasel-i18n-fr: French language pack for Iceweasel')
 
install=iceweasel.install
 
 if [ "$CARCH" = "x86_64" ]; then
    _debarch=amd64
sha512sums=('0c3bb3fe48cb19c52ba03f595f67266205eed0024c5db6e4e45d59903ea7320b8d3e9b2955ffc8ccc3c96f3f599e80b8a96f17a9b84b2d5b775ffc542ddb25da'
            '3433534c2395a86a0f80ea8fdcc3734e8f8e6bedff9f410fd825266f6388c377ceea449078918627cc64d6ef9ac3e0c0f4206dba648522069dc0b4364f29156c'
            '9a4628a2e623930675be3b1516f13164a58675f9b338022bb87640dec49014d5412bba2ab5af1ca86e3326889a4718519c8c76aed943616e40702e56528cab8c')
else
    _debarch=i386
sha512sums=('d29363134ab65c2e378aae9f598cbaf9ac8f96a302e15177365dfd122766b7f6d0491d7adae4abfa448dad802cbb3c08e15a96eb814fa67a1f48c1729979aa59'
            '2c586de07090c27e6bdb24a18342ea73a2a6adfb9777f21a06acbaf217e547a72425183f0e2c4dcf260efefaae71ed9456f921ab97b0754669b438366823655f'
            'dad04f8b73c95782cfbc4fdea6abca867f5f3309d8c63fdd05f900d24c207846fbc6be06f2217ab7c81f9502e46e6a015c237ad060b19fae5c4f8d2467508bd9')
 fi
 
source=("${_debrepo}/${_debname}/${_debname}_${_debver}-${_debrel}_${_debarch}.deb"
        "${_debrepo}/${_debname}/xulrunner-${_debver}_${_debver}-${_debrel}_${_debarch}.deb"
        "${_debrepo}/${_debname}/libmozjs${_libmozjs}d_${_debver}-${_debrel}_${_debarch}.deb")
 
noextract=("xulrunner-${_debver}_${_debver}-${_debrel}_${_debarch}.deb"
           "libmozjs${_libmozjs}d_${_debver}-${_debrel}_${_debarch}.deb")
 
 
build(){
      mkdir -p "${srcdir}/xul_dir"
      bsdtar -xf "xulrunner-${_debver}_${_debver}-${_debrel}_${_debarch}.deb" -C "${srcdir}/xul_dir"
      tar Jxvf "${srcdir}/xul_dir/data.tar.xz" -C "${srcdir}/xul_dir"
 
      mkdir -p "${srcdir}/libmoz_dir"
      bsdtar -xf "libmozjs${_libmozjs}d_${_debver}-${_debrel}_${_debarch}.deb" -C "${srcdir}/libmoz_dir"
      tar Jxvf "${srcdir}/libmoz_dir/data.tar.xz" -C "${srcdir}/libmoz_dir"
}
 
package(){
      msg2 "Installing Iceweasel..."
      tar Jxvf "${srcdir}"/data.tar.xz -C "$pkgdir"/
     
      msg2 "Installing xulrunner..."
      rm -v "${pkgdir}/usr/lib/$_debname/xulrunner"
      rm -v "${srcdir}"/xul_dir/usr/lib/xulrunner-${_debver}/{chrome,defaults,icons}
      cp -R "${srcdir}"/xul_dir/usr/lib/xulrunner-${_debver} "${pkgdir}/usr/lib/$_debname/xulrunner"         
      cp -R "${srcdir}"/xul_dir/usr/share/xulrunner-${_debver}/{chrome,defaults,icons} "${pkgdir}/usr/lib/$_debname/xulrunner/"
   
      msg2 "Installing libmozjs"
      rm -v "${pkgdir}/usr/lib/$_debname/xulrunner/libmozjs.so.${_libmozjs}d"
      cp "${srcdir}/libmoz_dir/usr/lib/libmozjs.so.${_libmozjs}d" "${pkgdir}/usr/lib/$_debname/xulrunner/"
     
 
      msg2 "Cleaning up unwanted files..."
      rm -rv "${pkgdir}"/usr/lib/{mozilla,mime}
      rm -rv "${pkgdir}"/usr/share/{bug,mozilla,doc}
      rm -v "${pkgdir}"/usr/bin/firefox
}
 
# vim:set ts=2 sw=2 et: