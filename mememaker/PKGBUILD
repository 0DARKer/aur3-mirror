# Maintainer: Daniel Wallace<daniel.wallace at gatech dot edu>
pkgname=mememaker
pkgver=20120321
pkgrel=11
pkgdesc="create memes from the command line, including the posibility to create split memes now with all options available from the command line"
arch=('any')
url="http://www.reddit.com/r/ScriptSwap/comments/r1oxf/bash_meme_maker_script_creates_meme_in_terminal/"
license=('GPL')
depends=('curl' 'imagemagick')
provides=('mememaker')
install=mememaker.install
source=($pkgname.zip
        $pkgname.install
        splitmeme-patch.diff
        bash_completion
        zsh_completion)

build(){
  cd $srcdir
  patch -p0 < splitmeme-patch.diff
  #sed -i 's/.\/list.txt/\/usr\/share\/mememaker\/list.txt/g' $srcdir/$pkgname.sh
  sed -i 's/\"\$meme/\/tmp\/\"\$meme/g' $srcdir/$pkgname.sh
  sed -i 's/\"\$2/\/tmp\/\"\$2/g' $srcdir/$pkgname.sh
  sed -i 's/\"\$3/\/tmp\/\"\$3/g' $srcdir/$pkgname.sh
  sed -i 's/.\/memes/\/usr\/share\/mememaker\/memes/g' $srcdir/$pkgname.sh
  sed -i 's/.\/meme.jpg/\/tmp\/meme.jpg/g' $srcdir/$pkgname.sh
  sed -i 's/\ meme.jpg/\ \/tmp\/meme.jpg/g' $srcdir/$pkgname.sh
  sed -i 's/\ out.png/\ \/tmp\/out.png/g' $srcdir/$pkgname.sh
  sed -i 's/caption/label/g' $srcdir/$pkgname.sh
  sed -n 's/^apikey=/&/w imgurrc' < $srcdir/$pkgname.sh
  sed -i 's/apikey=/imgur\ /' $srcdir/imgurrc 
  sed -i 's/\"//g' $srcdir/imgurrc
  sed -i '/apikey=/ c\apikey='"\"$\(awk \'\/imgur\/ \{print \$2\}\' \/etc\/imgurrc \)\""'' $srcdir/$pkgname.sh
  sed 's/\ /_/g;s/:/\ /g;s/\_//g' $srcdir/list.txt|awk '{ print "mv","./memes/"$1".jpg","./memes/"$2".jpg" }'|sh
  sed -i 's:cat ./list.txt:'"echo\ \"\$\(ls \/usr\/share\/mememaker\/memes\/\|cut\ \-d\'\.\'\ \-f1\)\""':' $srcdir/$pkgname.sh
}

package() {
  cd $srcdir
  install -D list.txt $pkgdir/usr/share/mememaker/list.txt
  cp -pr --no-preserve=ownership memes $pkgdir/usr/share/mememaker/memes/
  chmod 777 $pkgdir/usr/share/mememaker/memes/
  install -Dm755 $pkgname.sh $pkgdir/usr/bin/$pkgname
  install -Dm644 imgurrc $pkgdir/etc/imgurrc
  install -Dm644 $srcdir/bash_completion $pkgdir/etc/bash_completion.d/mememaker
  install -Dm644 $srcdir/zsh_completion $pkgdir/usr/share/zsh/site-functions/_mememaker
}

# vim:set ts=2 sw=2 et:
md5sums=('31010fd0580f444b6c64c72135970fcf'
         'b89d1414d659056f134f6b69be931a16'
         '41da4519703f2cb2dccad7e61f1dc34c'
         'd0e1b35d6313583d2529941bbbbd074a'
         '738e09328551b0f6054b173ae832fb2f')
