--- vkolev-gsharkdown-gsharkdown-0.3.5/gsharkdown.py	2011-08-05 09:19:18.000000000 +0200
+++ src/vkolev-gsharkdown-gsharkdown-0.3.5/gsharkdown.py	2011-08-17 01:53:37.000000000 +0200
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python2
 #-*- encoding: utf-8 -*-
 
 """
@@ -34,9 +34,10 @@
 
 try:
     import pynotify
+    HAVE_NOTIFY = True
 except ImportError:
     print "You don't have pynotify installed!"
-    sys.exit(1)
+    HAVE_NOTIFY = False
 
 try:
     import pygst
@@ -48,9 +49,10 @@
 
 try:
     import pylast
+    HAVE_PYLAST = True
 except ImportError:
     print "You need to install pylast: sudo pip install pylast"
-    sys.exit(1)
+    HAVE_PYLAST = False
 
 try:
     from configobj import ConfigObj
@@ -81,12 +83,22 @@
 if os.path.exists("%s/.gsharkdown/gsharkdown.ini" % os.environ.get("HOME")):
     CONFIG = ConfigObj("%s/.gsharkdown/gsharkdown.ini" % os.environ.get("HOME"))
     try:
-        test = CONFIG['scrobbling']
+        if HAVE_PYLAST:
+            test = CONFIG['scrobbling']
+        else:
+            raise KeyError()
     except KeyError:
         CONFIG['scrobbling'] = 0
         CONFIG['lastuser'] = ""
         CONFIG['lastpass'] = ""
-        CONFIG.write()
+    try:
+        if HAVE_NOTIFY:
+            test = CONFIG['show_notification']
+        else:
+            raise KeyError()
+    except KeyError:
+        CONFIG['show_notification'] = 0
+    CONFIG.write()
 else:
     try:
         os.mkdir("%s/.gsharkdown/" % os.environ.get("HOME"))
@@ -175,12 +187,12 @@
         else:
             print "Playlist not found"
 
-        if int(CONFIG['show_notification']) == 1:
+        if int(CONFIG['show_notification']) == 1 and HAVE_NOTIFY:
             pynotify.init("gSharkDown")
         
         # Scrobbling initialisation
         self.lastfm = ""
-        if int(CONFIG['scrobbling']) == 1:
+        if int(CONFIG['scrobbling']) == 1 and HAVE_PYLAST:
             self.lastfm = pylast.LastFMNetwork(api_key=LAST_KEY,
                                           api_secret=LAST_SECRET,
                                           username=CONFIG['lastuser'],
@@ -673,14 +685,20 @@
         self.notify = builder.get_object("checkbutton1")
         self.notify.set_active(int(CONFIG['show_stat_icon']))
         self.bubble = builder.get_object("checkbutton2")
-        self.bubble.set_active(int(CONFIG['show_notification']))
+        if HAVE_NOTIFY:
+            self.bubble.set_active(int(CONFIG['show_notification']))
+        else:
+            self.bubble.set_sensitive(False)
         self.lastuser = builder.get_object("entry2")
         self.lastuser.set_text(CONFIG['lastuser'])
         self.lastpass = builder.get_object("entry3")
         self.lastpass.set_visibility(False)
         self.lastpass.set_text(CONFIG['lastpass'])
         self.scrobble = builder.get_object("checkbutton3")
-        self.scrobble.set_active(int(CONFIG['scrobbling']))
+        if HAVE_PYLAST:
+            self.scrobble.set_active(int(CONFIG['scrobbling']))
+        else:
+            self.scrobble.set_sensitive(False)
         self.lastuser.set_sensitive(self.scrobble.get_active())
         self.lastpass.set_sensitive(self.scrobble.get_active())
         builder.connect_signals(self)
