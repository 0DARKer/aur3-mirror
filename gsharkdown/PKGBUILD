# Maintainer: archtux <antonio.arias99999@gmail.com>
# Contributor: SpepS <dreamspepser at yahoo dot it>

pkgname=gsharkdown
pkgver=0.2.9
pkgrel=1
pkgdesc="Application for downloading and playing music from grooveshark.com"
arch=('any')
url="https://bitbucket.org/vkolev/gsharkdown"
license=('GPL3')
depends=('gnome-icon-theme' 'gstreamer0.10-python' 'python-configobj' 'python-notify')
source=(https://bitbucket.org/vkolev/gsharkdown/get/$pkgname-$pkgver-$pkgrel.tar.bz2)
md5sums=('15e1737709f9b746498d71cfbdbbc6ba')

build() {
   cd $srcdir/vkolev*

   # Place configuration files in ~/.config/gsharkdown
   sed -i "s|\(data/[a-z]*\.\(ini\)*\(pkl\)*\" % \)BASE|\1HOME|;\
          51iHOMEPATH = os.path.expanduser('~/.config/gsharkdown')" $pkgname.py

   # bin
   install -d $pkgdir/usr/bin
   cat << EOF >> $pkgdir/usr/bin/$pkgname
#!/bin/bash
CPATH="\$HOME/.config/$pkgname/data"
CFILE=$pkgname.ini
PLIST=playlist.pkl
cd /usr/share/$pkgname
[ -d "\$CPATH" ] || mkdir -p "\$CPATH"
[ -f "\$CPATH/\$CFILE" ] || cp data/\$CFILE "\$CPATH"
[ -f "\$CPATH/\$PLIST" ] || cp data/\$PLIST "\$CPATH"
python2 $pkgname.py $@
EOF

   chmod +x $pkgdir/usr/bin/$pkgname

   # Data
   install -d $pkgdir/usr/share/$pkgname
   cp -a * $pkgdir/usr/share/$pkgname

   # Desktop icon
   install -Dm644 data/gsharkdown_64.png $pkgdir/usr/share/pixmaps/gsharkdown.png
   install -Dm644 $startdir/gsharkdown.desktop $pkgdir/usr/share/applications/gsharkdown.desktop
}