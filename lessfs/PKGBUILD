# Maintainer:  Hubert Kario <kario@wit.edu.pl>

pkgname=lessfs
pkgver=1.4.9
pkgrel=1
pkgdesc="High performance inline data deduplicating file system for FUSE"
arch=('i686' 'x86_64')
license=('GPL')
url="http://www.lessfs.com/"

makedepends=('gcc' 'make' 'fuse' 'tokyocabinet' 'mhash' 'openssl')
depends=('tokyocabinet' 'mhash' 'openssl' 'lzo2')
optdepends=('hamsterdb: alternative database to tokyo cabinet')
backup=('etc/lessfs/sample.cfg')
#conflicts=("$_pkgname")
#provides=("$_pkgname=$pkgver")

source=(http://sourceforge.net/projects/lessfs/files/lessfs/lessfs-$pkgver/lessfs-$pkgver.tar.gz/download)
sha1sums=('eb981084016f59386c6e836ea84cb5ea74048a0a')

build() {
	cd "$pkgname-$pkgver"
        if ( pacman -Q hamsterdb 2>/dev/null >/dev/null ); then
	    ./configure --with-crypto --with-lzo --with-hamsterdb --prefix=/usr || return 1 ;
        else
            echo "==================================";
            echo " WARNING!";
            echo "hamsterdb not found, skipping dependancy!" ;
            echo "==================================";
	    ./configure --with-crypto --with-lzo --prefix=/usr || return 1 ;
        fi
	make || return 1
	make prefix="$pkgdir/usr" install || return 1
        mkdir -p "$pkgdir/etc/lessfs"
        install -m 644 -D etc/lessfs.cfg-hamsterdb $pkgdir/etc/lessfs/sample.cfg-hamsterdb
        install -m 644 -D etc/lessfs.cfg-tokyocabinet $pkgdir/etc/lessfs/sample.cfg-tokyocabinet
        install -m 644 -D etc/lessfs.cfg $pkgdir/etc/lessfs/sample.cfg
        mkdir -p "$pkgdir/usr/share/doc/lessfs"
        install -m 644 -D FAQ README README.replication README.file_io README.crypto README.performance_or_suffer ChangeLog "$pkgdir/usr/share/doc/lessfs"
}
