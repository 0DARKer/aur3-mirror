# Mantainer:   Gianni Vialetto <gianni@rootcube.net> 
# Contributor: Bartlomiej Piotrowski <barthalion@gmail.com>
# Contributor: Thomas Mudrunka <harvie@@email..cz>

pkgname=torchat
pkgver=0.9.9.551
pkgrel=1
pkgdesc="A decentralized instant messenger built on top of the Tor Network"
arch=('any')
license=('GPL')
url="https://github.com/prof7bit/TorChat"
depends=('tor' 'python2' 'wxpython')
source=("https://github.com/downloads/prof7bit/TorChat/${pkgname}-source-${pkgver}.zip"
        "${pkgname}"
        "${pkgname}.desktop")
md5sums=('ad064a2db9bd99193234f7483f7f5a04'
         '579b4ff498ff1211960c95c1a7d1efb5'
         '4b9f593f2fd8dcff9c0e0252e9f199a7')

package() {
    install -m777 -d ${pkgdir}/opt/torchat/
    cp -r ${srcdir}/src/* ${pkgdir}/opt/torchat/

    find ${pkgdir}/opt/torchat/ -iname "*.py" | xargs sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|'
    find ${pkgdir}/opt/torchat/ -iname "*.py" | xargs sed -i 's|#!/usr/bin/python|#!/usr/bin/python2|'
    rm ${pkgdir}/opt/torchat/portable.txt

    install -d ${pkgdir}/usr/bin
    install ${srcdir}/torchat ${pkgdir}/usr/bin

    install -d ${pkgdir}/usr/share/applications
    install ${srcdir}/$pkgname.desktop ${pkgdir}/usr/share/applications/

    install -d ${pkgdir}/usr/share/pixmaps
    install ${srcdir}/src/icons/torchat.png ${pkgdir}/usr/share/pixmaps/
}
