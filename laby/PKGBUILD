# Maintainer: helq

pkgname=laby
pkgver=0.6.2
pkgrel=1
pkgdesc="This is a small program to learn how to program with ants and spider webs"
arch=('i686' 'x86_64')
url="http://www.pps.jussieu.fr/~gimenez/laby/"
license=('GPL3')
source=("http://www.pps.jussieu.fr/~gimenez/data/fdls/${pkgname}-${pkgver}.tar.gz"
        "laby.desktop"
        "laby.svg"
        "laby.6.gz"
        "META")
depends=('gtksourceview2' 'fontconfig>=2.8.0' 'ocaml')
makedepends=('ocaml-findlib' 'lablgtk2')
replaces=()
conflicts=()
provides=()
sha256sums=('800082f48b2d8c72c6051175309f602510ce83c845ab75a74337f25265f0fdcc'
            'f0fdb2d87ad599a676ddfc42ecdd1b5851e0672f566ff440e979528ec87b8c76'
            '6642ad66330c947e1078904d97e9863c00c32b56d7f72a9244df1fc2d6b4ce61'
            '184484cfc35d3be94af9a03e9b2f789402e9d4961c8497dd8ed24f7a5747ed89'
            '7bd12e805fb7a0f1075e385c59317bbb80d765b12ee7a60f80875e2494e0b8d0')

build() {
  echo "You need to add two links in the system"
  echo "At the end of the compilation will be removed changes"
  echo ""
  echo "copying the file META to /usr/lib/ocaml/lablgtk2/META"
  sudo cp "${srcdir}/META" "/usr/lib/ocaml/lablgtk2/META"
  echo "creating a link: /usr/lib/ocaml/lablgtk2 --> /usr/lib/ocaml/site-packages"
  sudo ln -s /usr/lib/ocaml/lablgtk2 /usr/lib/ocaml/site-packages
  cd "${srcdir}/${pkgname}-${pkgver}"
  echo ""
  make
  echo ""
  echo "Removing changes"
  sudo rm "/usr/lib/ocaml/lablgtk2/META" 
  sudo rm "/usr/lib/ocaml/site-packages"
}

package() {
  cd "$pkgdir/"
  mkdir "usr"
  cd "$pkgdir/usr"
  mkdir "bin" "share"
  cp "${srcdir}/${pkgname}-${pkgver}/${pkgname}-linuxelf-i386.native" "${pkgdir}/usr/bin/laby"
  cd "${pkgdir}/usr/share"
  mkdir "applications" "icons" "icons/hicolor" "icons/hicolor/scalable/" "icons/hicolor/scalable/apps/" "laby" "man" "man/man6" "pixmaps"
  cp "${srcdir}/laby.desktop" "${pkgdir}/usr/share/applications"
  cp "${srcdir}/laby.svg" "${pkgdir}/usr/share/icons/hicolor/scalable/apps/"
  cd "${srcdir}/${pkgname}-${pkgver}/data"
  cp -r * "${pkgdir}/usr/share/laby"
  cp "${srcdir}/laby.6.gz" "${pkgdir}/usr/share/man/man6/"
  cd "${pkgdir}/usr/share/pixmaps"
  ln -s "../icons/hicolor/scalable/apps/laby.svg" laby.svg
}
