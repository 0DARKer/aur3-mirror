# Maintainer: Daichi Shinozaki <dsdseg@gmail.com>
pkgname=gpsshogi-svn
pkgver=r2922
pkgrel=1
pkgdesc="Shogi (Japanese chess) playing program based on OpenShogiLib"
arch=('i686' 'x86_64')
url='http://gps.tanaka.ecc.u-tokyo.ac.jp/gpsshogi/index.php?GPSShogiEn'
license=('custom')
groups=('lib')
depends=('boost' 'boost-libs' 'libosl-svn')
makedepends=('boost' 'libosl-svn')
#checkdepends=('cppunit')
install='gpsshogi.profile'
source=("gpsshogi.tar.gz::http://gps.tanaka.ecc.u-tokyo.ac.jp/cgi-bin/viewvc.cgi/trunk/gpsshogi/?root=gpsshogi&view=tar"
'makefile.conf.patch'
'gpsshogi.profile'
)
md5sums=('SKIP'
         '539c37dcf4feb57b24ce2c155856f4e8'
         '3bafa7d5464e856bca8b3e801e3a8617')

pkgver() {
 curl -s "http://gps.tanaka.ecc.u-tokyo.ac.jp/cgi-bin/viewvc.cgi/trunk/gpsshogi/?root=gpsshogi" |\
  sed -n -e 's/^.*Revision \([0-9]*\).*$/r\1/p'
}

prepare() {
  cd "$srcdir"/${pkgname%-svn}
  cat $srcdir/makefile.conf.patch
  patch --verbose -i $srcdir/makefile.conf.patch
}

build() {
  cd "$srcdir"/gpsshogi/bin
  make
}

#check() {
#  cd "$srcdir/osl"
#  make -k check
#}

package() {
  install -Dm755 $srcdir/gpsshogi.profile ${pkgdir}/etc/profile.d/gpsshogi.sh
  install -Dm644 $srcdir/gpsshogi/makefile.conf $pkgdir/usr/share/gpsshogi/makefile.conf
  mkdir -m755 -p $pkgdir/usr/{bin,include}
  cp -r $srcdir/gpsshogi/data "$pkgdir"/usr/share/gpsshogi/
  cd $srcdir/gpsshogi/bin
  cp -r $srcdir/gpsshogi/include/gpsshogi "$pkgdir"/usr/include/
  install -m755 alphabetastat gpsusi gpsshogi "$pkgdir"/usr/bin/
}
