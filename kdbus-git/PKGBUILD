# Maintainer : Daniel Nagy <danielnagy at gmx de>

pkgname=kdbus-git
pkgver=1213.c28061e
_extramodules=extramodules-3.12-ARCH
pkgrel=1
pkgdesc="kdbus kernel module"
arch=('i686' 'x86_64')
url="https://github.com/gregkh/kdbus"
depends=('linux>=3.12' 'linux<3.13' )
makedepends=('linux-headers>=3.12' 'linux-headers<3.13')
provides=("kdbus")
conflicts=("kdbus")
license=('LGPL2.1')
options=(!strip)
source=( "git+https://github.com/gregkh/kdbus" )
md5sums=('SKIP')

pkgver() {
    cd "$srcdir/kdbus"
    echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
    _kernver="$(cat /usr/lib/modules/${_extramodules}/version)"
    cd "${srcdir}"/kdbus
    # make SYSSRC=/usr/lib/modules/"${_kernver}/build" module
    make
}

package() {
    install -D -m644 "${srcdir}/kdbus/kdbus.ko" \
        "${pkgdir}/usr/lib/modules/${_extramodules}/kdbus.ko"
    gzip "${pkgdir}/usr/lib/modules/${_extramodules}/kdbus.ko"
}
