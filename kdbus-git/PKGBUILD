# Maintainer : Daniel Nagy <danielnagy at gmx de>

pkgname=kdbus-git
_pkgname=kdbus
pkgver=1399.e62195a
pkgrel=1
pkgdesc="kdbus kernel module"
arch=('i686' 'x86_64')
url="https://github.com/gregkh/kdbus"
depends=( 'dkms' )
provides=("kdbus")
conflicts=("kdbus")
license=('LGPL2.1')
install="kdbus-git.install"
options=(!strip)
source=( "git+https://github.com/gregkh/kdbus" "dkms.conf" )
md5sums=('SKIP'
         'a36446ca25771bfd800dc03aaddef968')

pkgver() {
    cd "$srcdir/kdbus"
    echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

package() {
  cd "$srcdir/kdbus"
  rm -fr test
  install -Dm 644 "${srcdir}/dkms.conf" "${pkgdir}/usr/src/${_pkgname}-${pkgver}/dkms.conf"
  install -m 644 * "${pkgdir}/usr/src/${_pkgname}-${pkgver}"/
  sed -i "s|@VERSION@|${pkgver}|g" "${pkgdir}/usr/src/${_pkgname}-${pkgver}/dkms.conf"
}
