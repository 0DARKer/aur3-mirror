# Contributor: Marc poiroud <marci1@archlinux.fr>
# Contributor: Ray Kohler <ataraxia937 at gmail dot com>
# Maintainer: Laurie Clark-Michalek <bluepeppers@archlinux.us>

pkgname=megamario
pkgver=1.6c
pkgrel=3
pkgdesc="Mario Bros Clone"
arch=('i686' 'x86_64')
url="http://mmario.sourceforge.net/"
license=('GPL')
depends=('libgl' 'sdl_mixer' 'sdl_ttf' 'sdl_image')
source=(http://downloads.sourceforge.net/mmario/MegaMario_v${pkgver}_full.zip
        path_max.patch
	      megamario.desktop)
md5sums=('2f9654857e85f581e03920fd5647de6d'
         '6871d11d803133ea446d4da9b556b283'
         'a22469cbecc7b0ed0559f82ed4c6636b')

build () {
	cd $srcdir
  patch -p1 < $srcdir/path_max.patch || return 1
	make PREFIX=/usr || return 1
	make PREFIX=$pkgdir/usr install || return 1
	install -D -m644 megamario.desktop $pkgdir/usr/share/applications/megamario.desktop
	install -D -m644 $pkgdir/usr/share/megamario/gfx/characters/big/player3r.png $pkgdir/usr/share/pixmaps/megamario.png

# crappy Makefile
	cd $pkgdir/usr/share/$pkgname
	find -type d -exec chmod 755 {} \;
	find -type f -exec chmod 644 {} \;

# Segfault fix
	ln $pkgdir/usr/share/megamario/gfx/background/Iceland.jpg $pkgdir/usr/share/megamario/gfx/background/iceland.jpg
	ln $pkgdir/usr/share/megamario/gfx/background/canyon.jpg $pkgdir/usr/share/megamario/gfx/background/Canyon.jpg
}
