#Contributor: Michael Krauss <hippodriver@gmx.net>
#old contributor: Jacek Poplawski <jacekpoplawski@gmail.com> 

pkgname=lgeneral
pkgver=1.2
pkgrel=1
pkgdesc="turn-based strategy engine heavily inspired by Panzer General"
url="http://lgames.sourceforge.net/index.php?project=LGeneral"
license=('GPL' 'custom')
depends=("sdl" "sdl_mixer")
makedepends=('automake-1.9')
optdepends=('lgeneral-data: automatically install PG data from the internet')
arch=('x86_64' 'i686')
source=(
  http://downloads.sourceforge.net/lgeneral/lgeneral-1.2.tar.gz
  patch0.diff
  lgeneral-1.2_beta13-as-needed.patch
  lgeneral.desktop
  COPYING
)

build() {
	export PATH=$PATH:"/opt/automake-1.9/bin"
	cd $startdir/src/lgeneral-1.2
	./configure --prefix=/usr
	# patch it
	patch src/misc.h $startdir/patch0.diff
	patch -p0 < $startdir/lgeneral-1.2_beta13-as-needed.patch
	CFLAGS='-g' make || return 1
	make install prefix=$startdir/pkg/usr

	# menu stuff
	mkdir -p $startdir/pkg/usr/share/pixmaps
	mkdir -p $startdir/pkg/usr/share/applications
	cp $startdir/src/lgeneral-1.2/lgeneral48.png\
           $startdir/pkg/usr/share/pixmaps/lgeneral.png
	cp $startdir/lgeneral.desktop $startdir/pkg/usr/share/applications
	
	# License
	mkdir -p $startdir/pkg/usr/share/licenses/lgeneral
	cp $startdir/COPYING $startdir/pkg/usr/share/licenses/lgeneral/COPYING
}

md5sums=('a34eae8bc2c05cfa81fe9a9994988613'
         '3ef9ebd3be24b6102ed6063d421f84cb'
         '19d46a5cc790805eaa0978ba7bef4de6'
         '8b12bb7e90c4739debeada0e444688ec'
         'e711ea63f9d950d00866d3ce40e25a17')

