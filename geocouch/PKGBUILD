# Maintainer: Leif Warner <abimelech@gmail.com>

pkgname=geocouch
pkgver=1.1.0
pkgrel=1
pkgdesc="A CouchDB add-on to support geospatial indexing and queries."
arch=('i686' 'x86_64')
url="http://github.com/couchbase/geocouch"
license=('APACHE')
depends=('couchdb=1.1.0')
source=('http://mirror.atlanticmetro.net/apache/couchdb/1.1.0/apache-couchdb-1.1.0.tar.gz' 'https://github.com/couchbase/geocouch/tarball/couchbase_1.1_geo')
install=geocouch.install

md5sums=('907b763d3a14b6649bf0371ffa75a36b'
         '1f2a15b9bdff34a7cc019ff4301603a0')

build() {
    cd $srcdir/couchbase-geocouch-15c07a7
    export COUCH_SRC=$srcdir/apache-couchdb-1.1.0/src/couchdb
    make 
}

package(){
    cd "$srcdir/couchbase-geocouch-15c07a7"
    install -D -m644 etc/couchdb/local.d/geocouch.ini $pkgdir/etc/couchdb/local.d/geocouch.ini
    install -d $pkgdir/usr/share/couchdb/www/script/test
    cp share/www/script/test/* $pkgdir/usr/share/couchdb/www/script/test/
    install -d $pkgdir/usr/lib/couchdb/erlang/lib/geocouch/ebin
    cp build/* $pkgdir/usr/lib/couchdb/erlang/lib/geocouch/ebin/
}
