# Maintainer: Leif Warner <abimelech@gmail.com>

pkgname=geocouch
pkgver=1.1.0
pkgrel=1
pkgdesc="A CouchDB add-on to support geospatial indexing and queries."
arch=('i686' 'x86_64')
url="http://github.com/couchbase/geocouch"
license=('APACHE')
depends=('couchdb=1.1.0')
source=('https://github.com/couchbase/geocouch/tarball/couchbase_1.1_geo')
install=geocouch.install

md5sums=('1f2a15b9bdff34a7cc019ff4301603a0')

build() {
    cd $srcdir/couchbase-geocouch-15c07a7
    export COUCH_SRC=/usr/lib/couchdb/erlang/lib/couch-1.1.0/include/
    make 
}

package(){
    cd "$srcdir/couchbase-geocouch-15c07a7"
    install -d -m755 -o couchdb -g daemon $pkgdir/etc/couchdb/local.d
    install -m644 -o couchdb -g daemon etc/couchdb/local.d/geocouch.ini $pkgdir/etc/couchdb/local.d/geocouch.ini
    install -d $pkgdir/usr/share/couchdb/www/script/test
    cp share/www/script/test/* $pkgdir/usr/share/couchdb/www/script/test/
    install -d $pkgdir/usr/lib/couchdb/erlang/lib/geocouch/ebin
    cp build/* $pkgdir/usr/lib/couchdb/erlang/lib/geocouch/ebin/
}
