# Contributor: refujee <refujee@gmail.com>
# Maintainer: sausageandeggs <sausageandeggs at archlinux.us>
pkgname=powder-toy
pkgver=46.3
pkgrel=1
pkgdesc="Desktop version of the classic falling sand physics sandbox,simulates air pressure, velocity & heat!"
arch=(i686 x86_64)
[[ $CARCH == x86_64 ]] && depends=('lib32-sdl' 'lib32-bzip2')
[[ $CARCH == i686  ]] && depends=('sdl')
url="http://powdertoy.co.uk/"
license=('GPL')
source=(http://powdertoy.co.uk/Download/powder-$pkgver-lin32.zip
		$pkgname.desktop $pkgname.png)

build() {
	_tst=$(cat /proc/cpuinfo | grep -iwo 'sse\+.\?')
	if	[[ $_tst == *3 ]]; then export _cpu=sse3
	elif [[ $_tst == *2 ]]; then export _cpu=sse2
	else export _cpu=sse
	fi
}

package() {
	mkdir -p $pkgdir/usr/bin/
	install -Dm 755 $srcdir/powder-$_cpu $pkgdir/usr/bin/powder
	install -Dm 644 $srcdir/$pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
	install -Dm 644 $srcdir/$pkgname.png $pkgdir/usr/share/pixmaps/$pkgname.png
}

md5sums=('24379e5fea3cdc12c399b5dcbe04db84'
         '3d0768fadfcdf1e27a03a192d71cfa84'
         'f7b06b42a0a3793fa219d8e7b62593d1')
