From bdd131bb6878874d82a24e7922e72b13f2adb2f7 Mon Sep 17 00:00:00 2001
From: Dirk Hartmann <monex@liquid-co.de>
Date: Sat, 28 Jul 2012 18:10:18 +0200
Subject: [PATCH 2/2] fix ffmpeg compile

replace depreciated function calls
---
 src/zm_ffmpeg_camera.cpp |    2 +-
 src/zm_mpeg.cpp          |    6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/zm_ffmpeg_camera.cpp b/src/zm_ffmpeg_camera.cpp
index 8b3bd57..f2e63b7 100644
--- a/src/zm_ffmpeg_camera.cpp
+++ b/src/zm_ffmpeg_camera.cpp
@@ -91,7 +91,7 @@ int FfmpegCamera::PrimeCapture()
     Info( "Priming capture from %s", mPath.c_str() );
 
     // Open the input, not necessarily a file
-    if ( av_open_input_file( &mFormatContext, mPath.c_str(), NULL, 0, NULL ) !=0 )
+    if ( avformat_open_input( &mFormatContext, mPath.c_str(), NULL, NULL ) !=0 )
         Fatal( "Unable to open input %s due to: %s", mPath.c_str(), strerror(errno) );
 
     // Locate stream info from input
diff --git a/src/zm_mpeg.cpp b/src/zm_mpeg.cpp
index c2a365f..4cc6dda 100644
--- a/src/zm_mpeg.cpp
+++ b/src/zm_mpeg.cpp
@@ -130,7 +130,7 @@ void VideoStream::SetParameters()
 {
 	/* set the output parameters (must be done even if no
 	   parameters). */
-	if ( av_set_parameters(ofc, NULL) < 0 )
+	if ( avformat_write_header(ofc, NULL) < 0 )
 	{
 		Panic( "Invalid output format parameters" );
 	}
@@ -222,7 +222,7 @@ void VideoStream::OpenStream()
 	if ( !(of->flags & AVFMT_NOFILE) )
 	{
 #if LIBAVUTIL_VERSION_INT >= AV_VERSION_INT(51,2,1)
-		if ( avio_open(&ofc->pb, filename, URL_WRONLY) < 0 )
+		if ( avio_open(&ofc->pb, filename, AVIO_FLAG_WRITE) < 0 )
 #else
 		if ( url_fopen(&ofc->pb, filename, URL_WRONLY) < 0 )
 #endif
@@ -241,7 +241,7 @@ void VideoStream::OpenStream()
 	}
 
 	/* write the stream header, if any */
-	av_write_header(ofc);
+	avformat_write_header(ofc, NULL);
 }
 
 VideoStream::VideoStream( const char *filename, const char *format, int bitrate, double frame_rate, int colours, int width, int height )
-- 
1.7.7


