# Maintainer: Colard Benjamin <caemirr@gmail.com>
pkgname=ryzom-client-hg
pkgver=1409
pkgrel=1
pkgdesc="Ryzom is a Free to Play MMORPG"
arch=('i686' 'x86_64')
license=('AGPL3' 'CC-BY-SA')
makedepends=('mercurial' 'libsquish' 'libwww' 'luabind' 'cpptest' 'lua' 'openal')
url="http://dev.ryzom.com"
provides=('ryzom')
source=('http://netcologne.dl.sourceforge.net/project/ryzom/ryzom_client_open.7z')
md5sums=('3b3aa3318ec4ce99f48023050e617e46')

_hgroot=http://ryzom.hg.sourceforge.net:8000/hgroot/ryzom/
_hgrepo=ryzom
_build="${srcdir}/${_hgrepo}/build/"
build() {
        cd "${srcdir}/${_hgrepo}"
        hg update
        [ ! -d "${_build}" ] && mkdir "${_build}"
        cd "${_build}"

        cmake   -DNL_ETC_PREFIX=/etc/nel \
                -DNL_DRIVER_PREFIX=/usr/lib/nel \
                -DRYZOM_ETC_PREFIX=/etc/ryzom \
                -DRYZOM_SHARE_PREFIX=/usr/share/games/ryzom \
                -DRYZOM_BIN_PREFIX=/usr/bin/ \
                -DWITH_RYZOM_SERVER=OFF \
                -DWITH_RYZOM_CLIENT=ON \
                -DWITH_NEL=ON \
                -DWITH_SOUND=ON \
                -DWITH_NEL_TOOLS=OFF \
                -DWITH_RYZOM_TOOLS=OFF \
                -DWITH_STATIC=ON \
                -DWITH_STATIC_DRIVERS=ON \
                -DWITH_DRIVER_OPENGL=ON \
                -DWITH_DRIVER_OPENAL=ON \
                -Wno-dev \
                -lmd5 \
                ../code

}

package() {

7zr x -o${pkgdir}/usr/local/share/games/ryzom/ ryzom_client_open.7z

	cd "${_build}"
	make DESTDIR="${pkgdir}" install
}

