_pkgbasename=libc++
pkgname=lib32-$_pkgbasename
pkgver=3.3
pkgrel=1
pkgdesc="libc++ C++ Standard Library (32-bit)."
arch=(x86_64)
url="http://libcxx.llvm.org/"
license=('MIT')
depends=($_pkgbasename)
makedepends=('clang' 'subversion' 'gcc-multilib')
source=()
sha256sums=()

_svnmod="libcxx"
_svntrunk="http://llvm.org/svn/llvm-project/libcxx/tags/RELEASE_33/final"

build() {
	cd ${srcdir}
	
	msg "Fetching source code from subversion repository..."
	if [ -d ${_svnmod}/.svn ]; then
		(cd ${_svnmod} && svn update)
	else
		svn checkout ${_svntrunk} ${_svnmod}
	fi
	
	svn export ${_svnmod} ${_svnmod}-build

	msg "Cross-compiling..."
	cd ${_svnmod}-build

	export PKG_CONFIG_PATH='/usr/lib32/pkgconfig'
	export TRIPLE=i686-pc-linux-gnu
	export CC="`which clang` -target $TRIPLE -m32"
	export CXX="`which clang++` -target $TRIPLE -m32"
	
	cd lib
	./buildit
}

package() {
	cd ${srcdir}/${_svnmod}-build

	umask 022
	install -Dm755 lib/${_pkgbasename}.so.1.0 ${pkgdir}/usr/lib32/${_pkgbasename}.so.1.0
	ln ${pkgdir}/usr/lib32/${_pkgbasename}.so.1.0 ${pkgdir}/usr/lib32/${_pkgbasename}.so.1
	ln ${pkgdir}/usr/lib32/${_pkgbasename}.so.1.0 ${pkgdir}/usr/lib32/${_pkgbasename}.so

	cd ${srcdir}
	rm -rf ${srcdir}/${_svnmod}-build
}
