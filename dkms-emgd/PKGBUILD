# Mantainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=dkms-emgd
_modname=emgd
_modpackage=emgd-dkms
pkgver=1.8.0.2032
ubustring=0ubuntu1~ppa5
pkgrel=4
pkgdesc="Intel EMGD driver in DKMS format."
arch=('i686')
url="http://edc.intel.com/Software/Downloads/EMGD/"
license=('GPL')
depends=('dkms' 'xf86-video-emgd' 'xorg-server=1.9.4.901')
provides=('emgd')
install="dkms-emgd.install"

source=(https://launchpad.net/~gma500/+archive/emgd-fix/+files/${_modpackage}_${pkgver}-${ubustring}.tar.gz
        ${pkgname}.install
        dkms.conf)
md5sums=('9cc5e93185df5d897e1c306778490220'
         'cdb59822b83df7073c731eca30982fc2'
         '278d8e473268bfc88b3b79640615c324')

build() {
    cd ${srcdir}
    # Messages
	warning "This Driver NEED using Xorg 1.9."
        echo
        echo '        Please, edit your /etc/pacman.conf and add:

        [xorg19]
        Server = http://catalyst.apocalypsus.net/repo/xorg19/$arch

        Downgrade all your xorg with packages in Xorg19 repo
        (if need older dependencies, try "http://arm.konnichi.com/extra/os/i686/" 
     
        
        and add to "IgnoreGroup" secction:

        IgnoreGroup = xorg

        to prevent possible upgrade
'
        read -p "If you apply this, please continue, if not, cancel this installation [y/N] " -n 1
	if [[ ! $REPLY =~ ^[Yy]$ ]]; then
		echo ""
		return 1
	fi
}

package() {
    mkdir -p ${pkgdir}/usr/src/${_modname}-${pkgver}
    cp -a ${srcdir}/emgd-dkms-kernel39/* ${pkgdir}/usr/src/${_modname}-${pkgver}
    cp -a ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_modname}-${pkgver}
    install -Dm755 ${srcdir}/emgd-dkms-kernel39/COPYING ${pkgdir}/usr/share/licenses/$pkgname/COPYING
}