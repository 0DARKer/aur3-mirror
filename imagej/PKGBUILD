# This PKGBUILD does not build the sources but rather 
#downloads a precompiled jar from the project website.
#I trust the NIH is doing the right thing for us ;)
#I will hopefully create a PKGBUILD that really builds from sources in a future version

# Contributor: Giulio Guzzinati <skarn86junk@gmail.com>
pkgname=imagej
pkgver=146
pkgrel=1
pkgdesc="Image manipulation software for scientists"
arch=(i686 x86_64)
url="http://rsbweb.nih.gov/ij/index.html"
license=('Public Domain')
depends=(java-runtime)
makedepends=(unzip)
optdepends=(java-environment)
provides=(imagej=$pkgver)
conflicts=()
replaces=()
backup=()
options=()
install=
source=(http://rsbweb.nih.gov/ij/download/zips/ij$pkgver.zip
	imagej
	imagej.desktop
	microscope.xpm)
noextract=(ij$pkgver.zip)
md5sums=('61b96882acc037e72d5da3c41396cad6'
         '8c3f31d67b70a9104c1c0b983b0aac86'
         '9d60878b6adad0e1895ce875bf299147'
         'e7a7cef1b44ad3a8752ba63885fd88fb')

build() {
  unzip "$srcdir/ij$pkgver.zip"
  mkdir "$pkgdir/usr"
  mkdir "$pkgdir/usr/share"
  rm "$srcdir/ImageJ/ImageJ.exe"
  rm -rf "$srcdir/ImageJ/ImageJ.app"
  rm "$srcdir/ImageJ/run"
  mv "$srcdir/ImageJ/" "$pkgdir/usr/share/imagej"

  mkdir "$pkgdir/opt"
  mkdir "$pkgdir/opt/java"
  mkdir "$pkgdir/opt/java/jre"
  mkdir "$pkgdir/opt/java/jre/lib"
  mkdir "$pkgdir/opt/java/jre/lib/ext"
  ln -s "/opt/java/lib/tools.jar" "$pkgdir/opt/java/jre/lib/ext"

  mkdir "$pkgdir/usr/lib/"
  mkdir "$pkgdir/usr/lib/jvm"
  mkdir "$pkgdir/usr/lib/jvm/java-7-openjdk"
  mkdir "$pkgdir/usr/lib/jvm/java-7-openjdk/lib"
  mkdir "$pkgdir/usr/lib/jvm/java-7-openjdk/lib/ext"
  ln -s "/usr/lib/jvm/java-7-openjdk/lib/tools.jar" "$pkgdir/usr/lib/jvm/java-7-openjdk/lib/ext"

  install -D -m 755 imagej \
    $pkgdir/usr/bin/imagej || return 1
  install -D -m 644 imagej.desktop \
    $pkgdir/usr/share/applications/imagej.desktop || return 1
  install -D -m 644 microscope.xpm \
    $pkgdir/usr/share/pixmaps/microscope.xpm || return 1
}

