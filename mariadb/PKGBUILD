# Maintainer: Brad Arrington <bradla8@yahoo.com>

pkgbase=mariadb
pkgname=('mariadb')
pkgver=5.5.21
pkgrel=1
arch=('i686' 'x86_64')
license=('GPL')
url="http://www.mariadb.org/"
depends=('libedit')
makedepends=('zlib' 'perl' 'openssl' 'libtool' 'patch')
options=('!strip' '!libtool')
install=mariadb.install
conflicts=('mysql' 'libmysqlclient' 'mysql-clients')
#source=("http://downloads.askmonty.org/mariadb/5.5/${pkgbase}-${pkgver}.tar.gz"
source=("http://mirror.layerjet.com/mariadb/${pkgbase}-${pkgver}/kvm-tarbake-jaunty-x86/${pkgbase}-${pkgver}.tar.gz"
        'my.cnf'
        'mariadbd'
	'mariadb_install_db')


build() {
  cd "${srcdir}/${pkgbase}-${pkgver}"

# CFLAGS/CXXFLAGS as suggested upstream
  CFLAGS="-fPIC ${CFLAGS} -fno-strict-aliasing" \
  CXXFLAGS="-fPIC ${CXXFLAGS} -fno-strict-aliasing -felide-constructors -fno-rtti" \

  mkdir -p "${pkgdir}/etc/mariadb"

  BUILD/autorun.sh
#./configure --prefix=/usr --enable-assembler \
#--with-extra-charsets=complex  --enable-thread-safe-client  --with-big-tables \
#--with-plugin-maria --with-aria-tmp-tables --without-plugin-innodb_plugin \
#--with-mysqld-ldflags=-static --with-client-ldflags=-static --with-readline \
#--with-ssl --with-plugins=max-no-ndb --with-embedded-server --with-libevent \
#--with-mysqld-ldflags=-all-static  --with-client-ldflags=-all-static \
#--with-zlib-dir=bundled --enable-local-infile

#  ./configure --prefix=/usr \
#    --datadir=/var/lib/mariadb \
#    --sysconfdir=/etc/mariadb \
#    --without-plugin-oqgraph \
#    --without-docs \
#    --without-readline \
#    --with-libedit \
#    --with-ssl \
#    --with-charset=utf8 \
#    --with-collation=utf8_unicode_ci \
#    --with-extra-charsets=complex \
#    --localstatedir=/var \
#    --with-unix-socket-path=/var/run/mariadb/mariadb.sock \
#    --with-plugins=partition,pbxt,ibmdb2i,aria

  cmake .
  make 
}

package_mariadb(){
  pkgdesc="A fast SQL database server branch of MySQL - MariaDB"
  backup=('etc/mariadb/my.cnf')
  install=mariadb.install

  cd "${srcdir}/${pkgbase}-${pkgver}"
  mkdir -p ${pkgdir}/usr/bin/
  make DESTDIR=${pkgdir} install

  cp -Rd ${pkgdir}/var/lib/mariadb/*  ${pkgdir}/usr/share/.
  install -Dm644 ${srcdir}/my.cnf ${pkgdir}/etc/mariadb/my.cnf
  install -Dm755 ${srcdir}/mariadbd ${pkgdir}/etc/rc.d/mariadbd

  install -m755 ${srcdir}/mariadb_install_db "${pkgdir}/usr/bin/"
}
md5sums=('79249a7d98ace89d9758a1f194b9ed07'
         '372e35c8e655e96c43a4a6aa452efd92'
         '4c491570ec9f2db20b080082119a1714'
         '748fe56c33f26e33a6319a55e0786dbf')
