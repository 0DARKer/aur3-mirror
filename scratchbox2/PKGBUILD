# Contributor: Christopher Schwaab -- christopher.schwaab gmail
pkgname=scratchbox2
pkgver=2.2.1
pkgrel=1
pkgdesc="The unobtrusive cross-compilation engine."
arch=('i686' 'x86_64')
url="http://maemo.gitorious.org/scratchbox2"
[ $CARCH = 'i686' ]   && makedepends=('git') \
                      && depends=('glibc' 'perl')
[ $CARCH = 'x86_64' ] && makedepends=('gcc-multilib' 'binutils-multilib' 'gcc-libs-multilib' 'git' ) \
                      && depends=('lib32-glibc' 'perl')
license=('GPL')
conflicts=('scratchbox2-git')

build() {
	_gitroot="git://gitorious.org/scratchbox2/scratchbox2.git"
	_gitname="scratchbox2"

	export LDFLAGS="${LDFLAGS//-Wl,--as-needed}"

	cd ${srcdir}

	if [ ! -d ${srcdir}/$_gitname ] ; then
		msg "Checking out source..."
		git clone $_gitroot $_gitname || return 1
		cd $srcdir/$_gitname
		git checkout 2.2.1 || return 1
	else
		cd $srcdir/$_gitname
	fi

	./autogen.sh || return 1
	./configure || return 1
	make -j1 || return 1
	mkdir -p $pkgdir/usr
	make -j1 prefix=$pkgdir/usr DESTDIR=$pkgdir/usr install || return 1
}
