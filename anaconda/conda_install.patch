--- a/pkgs/conda-2.0.4-py27_0/lib/python2.7/site-packages/conda/install.py	2013-11-04 18:16:08.000000000 +0100
+++ b/pkgs/conda-2.0.4-py27_0/lib/python2.7/site-packages/conda/install.py	2013-11-23 21:14:48.462960816 +0100
@@ -163,11 +163,13 @@
                       # such that running this program on itself
                       # will leave it unchanged
                       'anaconda3')
-def update_prefix(path, new_prefix):
+def update_prefix(path, new_prefix, instdir=None):
+    if instdir is None:
+        instdir = new_prefix
     with open(path, 'rb') as fi:
         data = fi.read()
     new_data = data.replace(prefix_placeholder.encode('utf-8'),
-                            new_prefix.encode('utf-8'))
+                            instdir.encode('utf-8'))
     if new_data == data:
         return
     st = os.stat(path)
@@ -335,7 +337,7 @@
         return None
 
 
-def link(pkgs_dir, prefix, dist, linktype=LINK_HARD):
+def link(pkgs_dir, prefix, dist, linktype=LINK_HARD, instdir=None):
     '''
     Set up a packages in a specified (environment) prefix.  We assume that
     the packages has been extracted (using extract() above).
@@ -348,6 +350,8 @@
         # linking or unlinking some packages
         print('Ignored: %s' % dist)
         return
+    if instdir is None:
+        instdir = prefix
 
     source_dir = join(pkgs_dir, dist)
     info_dir = join(source_dir, 'info')
@@ -383,7 +387,7 @@
             return
 
         for f in sorted(has_prefix_files):
-            update_prefix(join(prefix, f), prefix)
+            update_prefix(join(prefix, f), prefix, instdir=instdir)
 
         create_meta(prefix, dist, info_dir, {
                 'files': files,
@@ -482,6 +486,10 @@
                  default=sys.prefix,
                  help="prefix (defaults to %default)")
 
+    p.add_option('--instdir',
+                 action="store",
+                 help="install dir (defaults to prefix)")
+
     p.add_option('--pkgs-dir',
                  action="store",
                  default=join(sys.prefix, 'pkgs'),
@@ -511,9 +519,14 @@
 
     pkgs_dir = opts.pkgs_dir
     prefix = opts.prefix
+    if not opts.instdir:
+        instdir = prefix
+    else:
+        instdir = opts.instdir
     if opts.verbose:
         print("pkgs_dir: %r" % pkgs_dir)
         print("prefix  : %r" % prefix)
+        print("instdir : %r" % instdir)
         print("dist    : %r" % dist)
 
     if opts.list:
@@ -521,14 +534,14 @@
 
     elif opts.link_all:
         for dist in sorted(extracted(pkgs_dir)):
-            link(pkgs_dir, prefix, dist)
+            link(pkgs_dir, prefix, dist, instdir=instdir)
         messages(prefix)
 
     elif opts.extract:
         extract(pkgs_dir, dist)
 
     elif opts.link:
-        link(pkgs_dir, prefix, dist)
+        link(pkgs_dir, prefix, dist, instdir=instdir)
 
     elif opts.unlink:
         unlink(prefix, dist)
