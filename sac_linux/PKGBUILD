pkgname=sac_linux
pkgver=8.1
pkgrel=1
pkgdesc="http://www.aladdin-rd.ru/ pkiclient"
arch=('i686' 'x86_64')
url="http://www.aladdin-rd.ru/"
progname="SafenetAuthenticationClient"
rpmname="SAC_8_1_0_4_Linux_RPM_"
progver="8.1.0-4"
startdir=`pwd`
depends=(hal)
makedepends=(unzip rpmextract)
license=('custom')
source=('610-011815-002_SAC_Linux_v8.1.zip'
		'eTSrv.service')
md5sums=('d66c9ff919f3b35180dba137857eb88c'
		 'f4a77180dcaa9c2809eca89039294098')
package() {
  cd ${srcdir}/SAC\ ${pkgver}\ Linux/
  if test "$CARCH" == 'x86_64'; then
		cd x86_64
		mainsrc2="${srcdir}/SAC ${pkgver} Linux/x86_64";
		rpmname=${rpmname}64
		safename=${progname}-${progver}.x86_64.rpm
  else
		cd x32
		mainsrc2="${srcdir}/SAC ${pkgver} Linux/x32";
		rpmname=${rpmname}32
		safename=${progname}-${progver}.i386.rpm
  fi
  cd "${mainsrc2}"
  echo "zipfile: ${mainsrc2}/${rpmname}.zip"
  unzip "${mainsrc2}/${rpmname}.zip"
  echo "mainfile: ${mainsrc2}/${rpmname}/RPM/${safename}"
  #cd ${pkgdir}
  
  cd "${mainsrc2}/${rpmname}/RPM/"
  echo `pwd`
  rpmextract.sh "${safename}" 
  mkdir -p ${pkgdir}/{etc,usr,var,etc/rc.d}
  cp -vr etc/init.d/* ${pkgdir}/etc/rc.d/
  cp -vr etc/ld.so.conf.d ${pkgdir}/etc/
  cp -v etc/*.conf ${pkgdir}/etc/
  if test "$CARCH" == 'x86_64'; then
    cp -vr lib64 ${pkgdir}/
    mkdir -p ${pkgdir}/usr/lib64/systemd/system
    install -Dm644 "${startdir}/eTSrv.service" ${pkgdir}/usr/lib64/systemd/system/
  else
    cp -vr lib ${pkgdir}/
    mkdir -p ${pkgdir}/usr/lib/systemd/system
    install -Dm644 "${startdir}/eTSrv.service" ${pkgdir}/usr/lib/systemd/system/
  fi
  cp -vr usr ${pkgdir}/
  cp -vr var ${pkgdir}/
  #make driver links
  mkdir -p ${pkgdir}/usr/lib/pcsc/drivers
  cd ${pkgdir}/usr/lib/pcsc/drivers
  ln -s /usr/share/eToken/drivers/aks-ifdh.bundle .
}
