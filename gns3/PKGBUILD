# Maintainer: max-k <max-k@post.com>
# Contributor: Tarjaizaid <tarjaizaid@gmail.com>
pkgname=gns3
pkgver=0.8.2
pkgrel=4
pkgdesc="Graphical network simulator based on Dynamips. With pemu included."
arch=(i686 x86_64)
url="http://www.gns3.net/"
license=('GPLv2')
depends=('python2-pyqt' 'python2-sip' 'dynagen' 'inetutils' 'xdotool')
optdepends=('wireshark: to capture frames from your virtual networks'
'virtualbox-sdk>=4.1: to use virtualbox hosts'
'qemu: to run qemu hosts or emulate Cisco ASA5520 and IDS 4235/4215 Sensor'
'vde2: to emulate virtual switches')
conflicts=('pemu')
provides=('pemu')
source=("http://downloads.sourceforge.net/gns-3/GNS3-${pkgver}-src.tar.gz"
"http://downloads.sourceforge.net/project/gns-3/Pemu/2008-03-03/pemu_2008-03-03_bin.tar.bz2")
md5sums=('1e4f1cdd990476c94c1099c50d988e4c'
'147ab04acdca5a79d6a4ab6307a1243d')

build() {
  cd ${srcdir}/GNS3-${pkgver}-src
  python2 setup.py build
}

package() {
  cd ${srcdir}/GNS3-${pkgver}-src
  sed -i "s#/usr/local/libexec#${pkgdir}/usr/local/libexec#" setup.py
  sed -i "s#/usr/local/share#${pkgdir}/usr/local/share#" setup.py
  python2 setup.py install --prefix ${pkgdir}/usr
  gzip ./docs/man/gns3.1
  install -D -m 644 ./docs/man/gns3.1.gz ${pkgdir}/usr/share/man/man1/gns3.1.gz
  #install -D -m 755 ./qemuwrapper/pemubin.py ${pkgdir}/usr/share/GNS3/pemubin.py
  sed -i 's/#!\/usr\/bin\/env python/#!\/usr\/bin\/env python2/' ./qemuwrapper/qemuwrapper.py
  sed -i 's/#!\/usr\/bin\/env python/#!\/usr\/bin\/env python2/' ./vboxwrapper/vboxwrapper.py
  sed -i 's/#!\/usr\/bin\/env python/#!\/usr\/bin\/env python2/' ./vboxwrapper/vboxcontroller_4_1.py
  sed -i 's/#!\/usr\/bin\/env python/#!\/usr\/bin\/env python2/' ./vboxwrapper/vboxtestcase.py
  install -D -m 755 ./qemuwrapper/qemuwrapper.py ${pkgdir}/usr/share/GNS3/qemuwrapper.py
  install -D -m 755 ./vboxwrapper/vboxwrapper.py ${pkgdir}/usr/share/GNS3/vboxwrapper.py
  install -D -m 755 ./vboxwrapper/vboxcontroller_4_1.py ${pkgdir}/usr/share/GNS3/vboxcontroller_4_1.py
  install -D -m 755 ./vboxwrapper/vboxtestcase.py ${pkgdir}/usr/share/GNS3/vboxtestcase.py
  install -D -m 644 ./baseconfig.txt ${pkgdir}/usr/share/GNS3/baseconfig.txt
  cd ${srcdir}/pemu_2008-03-03_bin
  mkdir -p ${pkgdir}/usr/share/GNS3/pemu
  install -D -m 755 ./pemu ${pkgdir}/usr/share/GNS3/pemu/pemu
  install -D -m 644 ./pemu.ini ${pkgdir}/usr/share/GNS3/pemu/pemu.ini
  install -D -m 755 ./ifup ${pkgdir}/usr/share/GNS3/pemu/ifup
  install -D -m 644 ./ifup.ini ${pkgdir}/usr/share/GNS3/pemu/ifup.ini
  install -D -m 644 ./README ${pkgdir}/usr/share/GNS3/pemu/README
}
