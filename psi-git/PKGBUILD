# Contributor: Denis Smirnov <detanator@gmail.com>
pkgname="psi-git"
pkgver=20090106
pkgrel=1
pkgdesc="A jabber client. GIT version"
url="http://psi-im.org/"
license=('custom')
arch=('i686' 'x86_64')
depends=('qt' 'aspell' 'libxss' 'openssl' 'dbus' 'zlib')
makedepends=("git")
conflicts=('psi' 'psi-svn')
provides=('psi' 'psi-svn')
source=()
md5sums=()

_gitroot="git://git.psi-im.org/psi.git"
_gitname="psi"

build() {
	cd $srcdir

   msg "Connecting to $_gitroot ..."
	if [ -d $srcdir/$_gitname ] ; then
		cd $_gitname && git pull origin
		msg "Updating iris ..."
		git submodule update
		msg "The local files are updated."
	  else
		git clone $_gitroot
		cd psi
		msg "Getting iris ..."
		git submodule init
		git submodule update
	fi
   msg "GIT checkout done or server timeout"
   
   	rm -r $srcdir/$_gitname-build
	cp -r $srcdir/$_gitname $srcdir/$_gitname-build

   msg "Building $pkgname ..."
	cd $srcdir/$_gitname-build

	./configure --prefix=/usr
	make || return 1
	make INSTALL_ROOT="$pkgdir" install || return 1

   # Copy Psi license
	install -D COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"

	rm -r $srcdir/$_gitname-build
}
