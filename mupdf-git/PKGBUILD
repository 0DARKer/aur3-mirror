# Maintainer: Army <uli armbruster who uses the google mail service>

pkgname=mupdf-git
pkgver=20110307
pkgrel=1
pkgdesc="lightweight PDF viewer and toolkit written in portable C"
arch=('i686' 'x86_64')
url="http://mupdf.com"
license=(GPL3)
depends=('freetype2' 'libjpeg' 'jbig2dec' 'openjpeg' 'libxext')
makedepends=('git')
provides=('mupdf')
conflicts=('mupdf')
install=mupdf-git.install

_gitroot="http://mupdf.com/repos/mupdf.git"
_gitname="mupdf"

build() {
	cd "$srcdir"
	msg "Connecting to GIT server...."
	
	if [ -d ${_gitname} ] ; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot} ${_gitname}
	fi
	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	rm -rf "${srcdir}/${_gitname}-build"
	cp -a "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
}

package() {
	cd "${srcdir}/${_gitname}-build"
	make build=release prefix="${pkgdir}/usr" install
	# avoiding conflicts with poppler
	cd "${pkgdir}/usr/bin"
	for i in pdf*;do mv "$i" "$i-mupdf";done
	cd "$srcdir/${_gitname}-build/debian"
	install -Dm644 mupdf.desktop "${pkgdir}/usr/share/applications/mupdf.desktop"
	install -Dm644 mupdf.xpm "${pkgdir}/usr/share/pixmaps/mupdf.xpm"
	install -Dm644 mupdf.1 "${pkgdir}/usr/share/man/man1/mupdf.1"
}
