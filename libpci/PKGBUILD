# $Id: $
# Maintainer: Dwight Schauer <dschauer@ti.com>
pkgname=libpci
_pkgname=pciutils
pkgver=3.1.7
pkgrel=1
pkgdesc="Shared object flavor of libpci"
arch=(i686 x86_64)
license=('GPL2')
groups=()
url="http://mj.ucw.cz/pciutils.html"
optdepends=() 
makedepends=('wget')
provides=(libpci)
depends=('glibc' 'pciutils')
_srcurl="http://kernel.org/pub/software/utils/${_pkgname}"
source=("${_srcurl}/${_pkgname}-${pkgver}.tar.bz2")
md5sums=('35222edb86b50a6641352c66fe829b2e')

build() {
  cd ${srcdir}/${_pkgname}-${pkgver}
  CFLAGS="${CFLAGS} -fPIC -DPIC"
  sed -i -e 's/^OPT=.*/OPT=-O2 -pipe -fPIC -DPIC/g' Makefile
  ./update-pciids.sh

  make ZLIB=no PREFIX=/usr SHAREDIR=/usr/share/hwdata MANDIR=/usr/share/man all || return 1
  install -d ${pkgdir}/usr/lib

  pushd .
    cd lib
    createsharedobject="gcc -shared -o libpci.so $(ar t libpci.a) -lresolv"
    echo ${createsharedobject}
    ${createsharedobject} || (
	msg creation of shared object failed
	false)
    install --verbose -m644 libpci.so ${pkgdir}/usr/lib
  popd
}
