# Maintainer: Alex Szczuczko <alex at szc dot ca>

pkgname=papersplease
_pkgname=papers-please
pkgver=1.1.60
pkgrel=1
pkgdesc="Assume the role of an immigration inspector for the communist state of Arstotzka"
arch=('i686' 'x86_64')
url="http://papersplea.se"
license=('custom:commercial')
depends=('bash')
options=(!strip)
source=("$pkgname.desktop"
        "launch-$pkgname.sh"
        "${_pkgname}_${pkgver}_i386.tar.gz::file://${_pkgname}_${pkgver}_i386.tar.gz")
sha256sums=('2844088ad91a9fb3b10e8bdd1d936582e183366a701f2d94ddc786719a3cc02a'
            '73700c808fe7d13c889f83759c4b6cadad7a7498786ef1ce7f54fbe0392f81be'
            '5650880d6ad640ddfab73a7d45f8cfa25e6702c1de16f9422bff1d0c2390dbbe')

# Modify depends for the arch type
if [ "$CARCH" = "x86_64" ]
then
    depends+=('lib32-gcc-libs' 'lib32-libgl')
elif [ "$CARCH" = "i686" ]
then
    depends+=('gcc-libs' 'libgl')
fi

# Disable compression of the package
PKGEXT='.tar'

package() {
    cd "$srcdir/papers-please/"

    #
    # Create /opt/$pkgname directory
    #

    # Binaries
    install -m755 -d "$pkgdir/opt/$pkgname/"
    install -m755 -t "$pkgdir/opt/$pkgname/" "PapersPlease" "lime.ndll" "regexp.dso" "std.dso" "zlib.dso"

    # Launcher
    install -m755 -t "$pkgdir/opt/$pkgname/" "$srcdir/launch-$pkgname.sh"

    # Text/config files
    install -m644 -t "$pkgdir/opt/$pkgname/" "boot.xml" "LICENSE" "manifest" "README"

    # i18n
    install -m755 -d "$pkgdir/opt/$pkgname/loc/"
    find "loc/" -type f -name '*.zip' -print0 | \
        xargs -0 install -m644 -t "$pkgdir/opt/$pkgname/loc/"

    # Assets
    install -m755 -d "$pkgdir/opt/$pkgname/assets/"
    find "assets/" -maxdepth 1 -type f -print0 | \
        xargs -0 install -m644 -t "$pkgdir/opt/$pkgname/assets/"

    # Music
    install -m755 -d "$pkgdir/opt/$pkgname/assets/music/"
    find "assets/music/" -maxdepth 1 -type f -print0 | \
        xargs -0 install -m644 -t "$pkgdir/opt/$pkgname/assets/music/"

    # Sound
    install -m755 -d "$pkgdir/opt/$pkgname/assets/sound/"
    find "assets/sound/" -type f -name "*.wav" -print0 | \
        xargs -0 install -m644 -t "$pkgdir/opt/$pkgname/assets/sound/"


    #
    # System integration
    #

    # /bin
    install -m755 -d "$pkgdir/usr/bin/"
    ln -s "/opt/$pkgname/launch-$pkgname.sh" "$pkgdir/usr/bin/$pkgname"

    # License
    install -m755 -d "$pkgdir/usr/share/licenses/$pkgname/"
    ln -s "/opt/$pkgname/LICENSE" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"

    # Icon
    #install -Dm644 $pkgname.png "$pkgdir/usr/share/icons/$pkgname.png"

    # .desktop File
    install -m755 -d "$pkgdir/usr/share/applications/"
    install -m644 -t "$pkgdir/usr/share/applications/" "$srcdir/$pkgname.desktop"
}
