# Contributor: Wesley <rudirennsau at hotmail dot com>

pkgname=openclonk
pkgver=5.1.1.3
pkgrel=2
pkgdesc="Open Source successor of 'Clonk Rage', based on the source code from Redwolf Design"
arch=('i686' 'x86_64')
url="http://www.openclonk.org/"
license=('custom')
conflicts=(openclonk-hg)
depends=(gtk2 libxxf86vm glew sdl_mixer)
source=(http://hg.openclonk.org/openclonk/archive/openclonk-release-5.1.1.tar.bz2 $pkgname.sh $pkgname.desktop $pkgname.png)

md5sums=('c5bb878cc3de9dae2f209d539b1fbb82'
         '855f9567af89a24ebca9a196b5f5bf69'
         '5dcc82c9a576478b22e657d932d33c28'
         'bdced2f9cb6c732babf9fe800cf9dcc0')

build() {
	cd $srcdir/$pkgname-release-5.1.1

	cmake . || return 1
	make || return 1

	cd planet/
	../c4group *.c4*/ -p
}

package() {
	cd $srcdir/$pkgname-release-5.1.1
	mkdir -p $pkgdir/usr/bin $pkgdir/usr/share/{applications,pixmaps,openclonk,licenses/openclonk}

	cp clonk c4group planet/AUTHORS planet/COPYING planet/*.c4* $pkgdir/usr/share/$pkgname
	cp licenses/*.txt $pkgdir/usr/share/licenses/$pkgname

	install -D -m755 $srcdir/$pkgname.sh $pkgdir/usr/bin/$pkgname
	install -D -m644 $srcdir/$pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
	install -D -m644 $srcdir/$pkgname.png $pkgdir/usr/share/pixmaps/$pkgname.png
}