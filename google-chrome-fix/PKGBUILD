# Maintainer: Oleg Smirnov <oleg.smirnov@gmail.com>
# Contributor: Det <nimetonmaili@gmail.com>
pkgname=google-chrome-fix
pkgver=1
pkgrel=3
pkgdesc="Workaround for Chromium based browsers' libjpeg issue"
arch=('i686' 'x86_64')
url="http://dev.chromium.org/getting-involved/dev-channel"
license=('custom:chrome' 'LGPL')
makedepends=('gdk-pixbuf2')
install=${pkgname}.install
if [ "${CARCH}" = 'x86_64' ]; then
    _arch='amd64'
    md5sums=(171da8d35380522e496057e9729e0351)
else
    _arch='i386'
    md5sums=(963dff9707547ea78c20615fe9cc2e51)
fi
source=(http://mirrors.kernel.org/ubuntu/pool/main/g/gtk+2.0/libgtk2.0-0_2.18.3-1_${_arch}.deb)
package() {
    ar -xv libgtk2.0-0_2.18.3-1_${_arch}.deb
    tar -xvf data.tar.gz

    _libpixbufloader='usr/lib/gtk-2.0/2.10.0/loaders/libpixbufloader-jpeg.so'
    if [[ -d /opt/google/chrome ]]; then
      install -D ${_libpixbufloader} "${pkgdir}"/opt/google/chrome/libpixbufloader-jpeg.so
    fi
    if [[ -d /opt/chromium-browser ]]; then
      install -D ${_libpixbufloader} "${pkgdir}"/opt/chromium-browser/libpixbufloader-jpeg.so
    fi
    if [[ -d /opt/iron ]]; then
      install -D ${_libpixbufloader} "${pkgdir}"/opt/iron/libpixbufloader-jpeg.so
    fi
}
