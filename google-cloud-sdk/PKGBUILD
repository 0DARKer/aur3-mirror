pkgname="google-cloud-sdk"
pkgver="0.9.26"
pkgrel="1"
pkgdesc="A command-line tool to manage Google Compute Engine resources"
url="https://developers.google.com/compute/docs/gcutil/"
license=("Apache")
arch=("any")
source=("https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.zip" "profile.sh")
depends=('python2')
makedepends=('python2')
optdepends=('go: for Go version of App Engine'
            'java-environment: for Java version of App Engine'
            'php: for PHP version of App Engine')
md5sums=('317142211aff34282208912af2a6a28b'
         'd7c7ccb7d32a871d67288228f5b4cd94')
build() {
  true
}

package() {
  mkdir "$pkgdir/opt"
  msg2 "Changing python references to python2"
  sed -i 's/python/python2/g' $srcdir/google-cloud-sdk/install.sh
  find $srcdir -name '*.py' -exec sed -i 's/env python$/env python2/g' {} \;
  
  cp -r "$srcdir/$pkgname" $pkgdir/opt
  mkdir -p $pkgdir/etc/profile.d/
  $pkgdir/opt/google-cloud-sdk/install.sh \
    --usage-reporting false --disable-installation-options \
    --path-update true --bash-completion true --rc-path=$srcdir/fake.bashrc \
    --additional-components pkg-go pkg-python pkg-java
  install -Dm755 $pkgdir/opt/google-cloud-sdk/completion.bash.inc $pkgdir/etc/bash_completion.d/google-cloud-sdk
  install -Dm755 $srcdir/profile.sh $pkgdir/etc/profile.d/google-cloud-sdk 
 
  msg2 "Installing man pages"
  mkdir -p $pkgdir/usr/share/man/man1
  mv $pkgdir/opt/google-cloud-sdk/help/man/man1 $pkgdir/usr/share/man/
  rm -rf $pkgdir/opt/google-cloud-sdk/help/man/
  
  msg2 "Cleaning files and folders"
  rm -rf $pkgdir/opt/google-cloud-sdk/.install/

  msg2 "Fixing files permissions"
  chown root:root -R $pkgdir
}
