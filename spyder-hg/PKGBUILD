# Maintainer: willemw <willemw12@gmail.com>

_pkgname=spyder
pkgname=$_pkgname-hg
pkgver=3296.f449690aa597
pkgrel=1
pkgdesc="Scientific PYthon Development EnviRonment providing MATLAB-like features (formerly pydee)"
arch=('any')
url="https://bitbucket.org/spyder-ide/spyderlib"
license=('MIT')
depends=('desktop-file-utils' 'gtk-update-icon-cache' 'python2-pyflakes' 'python2-pyqt4' 'python2-pyzmq')
makedepends=('mercurial' 'python2-setuptools' 'python2-sphinx' )
#makedepends=('mercurial' 'python-setuptools' 'python-sphinx')
optdepends=('python2-pylint: powerful code analysis'
            'ipython2: enhanced Python interpreter'
            'python2-rope: editor code completion, calltips and go-to-definition'
            'python2-sphinx: object inspector''s rich text mode'
            'python2-numpy: N-dimensional arrays'
            'python2-scipy: signal/image processing'
            'python2-psutil: memory/CPU usage in the status bar'
            'python2-h5py: HDF5 support'
            'python2-matplotlib: 2D/3D plotting')
#            #'python2: python 2 development'
#optdepends=('python-pylint: powerful code analysis'
#            'ipython: enhanced Python interpreter'
#            'python-rope: editor code completion, calltips and go-to-definition'
#            'python-sphinx: object inspector''s rich text mode'
#            'python-numpy: N-dimensional arrays'
#            'python-scipy: signal/image processing'
#            'python-psutil: memory/CPU usage in the status bar'
#            'python-h5py: HDF5 support'
#            'python-matplotlib: 2D/3D plotting')
provides=($_pkgname)
conflicts=($_pkgname)
install=$pkgname.install
source=($pkgname::hg+https://bitbucket.org/spyder-ide/spyderlib)
md5sums=('SKIP')

pkgver() {
  cd $pkgname
  echo $(hg identify -n).$(hg identify -i)
} 

# Python 2
prepare() {
  cd $pkgname
  sed -i "s|PYLINT_PATH = programs.find_program('pylint')|PYLINT_PATH = programs.find_program('pylint2')|" \
         spyderplugins/widgets/pylintgui.py
}

build() {
  cd $pkgname
  python2 setup.py build
  #python setup.py build
}

package() {
  cd $pkgname
  python2 setup.py install --prefix=/usr --root="$pkgdir" --optimize=1
  #python setup.py install --prefix=/usr --root="$pkgdir" --optimize=1

  rm "$pkgdir/usr/bin/spyder_win_post_install.py"
  install -D -m644 spyderlib/__init__.py "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -D -m644 scripts/spyder.desktop "$pkgdir/usr/share/applications/spyder.desktop"
  install -D -m644 img_src/spyder.svg "$pkgdir/usr/share/icons/hicolor/scalable/apps/spyder.svg"
}

