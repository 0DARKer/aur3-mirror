# $Id$
# Maintainer: Egon Ashrafinia <e.ashrafinia@gmail.com>
# Contibutor: Jan de Groot <jgc@archlinux.org>

pkgname=xf86-video-vmware-git
pkgver=20111221
pkgrel=1
pkgdesc="Git version of the X.org vmware video driver"
arch=(i686 x86_64)
url="http://xorg.freedesktop.org/"
license=('custom')
depends=('libdrm')
makedepends=('pkgconfig' 'xorg-server-devel' 'libdrm' 'libx11' 'libxext' 'git')
conflicts=('xf86-video-vmware')
replaces=('xf86-video-vmware')
provides=('xf86-video-vmware')
groups=('xorg-drivers' 'xorg')
options=('!libtool')

_gitroot="git://anongit.freedesktop.org/xorg/driver/xf86-video-vmware"

build() {
  # Get rid of old build dirs
  rm -rf $pkgname-build
  mkdir $pkgname-build

  msg "Connecting to GIT server...."

  if [ -d ${srcdir}/$pkgname ] ; then
    cd $pkgname && git pull origin master
    msg "Local repository updated."
  else
    git clone $_gitroot $pkgname
  fi
  
  cd "$srcdir/$pkgname-build"
  
  ../$pkgname/autogen.sh
  ../$pkgname/configure --prefix=/usr
  make
  
  cd "$srcdir/$pkgname-build"
  
  make DESTDIR="${pkgdir}" install
  
  cd "$srcdir/$pkgname"
  install -m755 -d "${pkgdir}/usr/share/licenses/xf86-video-vmware"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/xf86-video-vmware/"
}
