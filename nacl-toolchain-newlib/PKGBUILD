pkgname=nacl-toolchain-newlib
pkgdesc='Native Client is an open-source technology that allows you to build web applications that seamlessly execute native compiled code inside the browser.'
pkgrel=1
pkgver="7247"
binutilsver="2.20.1"
newlibver="1.18.0"
gccver="4.4.3"
arch=('x86_64' 'i686')
depends=('zlib' 'mpfr' 'bash')
makedepends=('realpath' 'bison')
options=(!strip)
license=('BSD' 'GPL3' 'LGPL3' 'GPL2' 'FDL-1.2')
url='http://code.google.com/chrome/nativeclient/'
source=(http://mirrors.usc.edu/pub/gnu/binutils/binutils-"${binutilsver}".tar.bz2
        ftp://sources.redhat.com/pub/newlib/newlib-"${newlibver}".tar.gz
        http://mirrors.usc.edu/pub/gnu/gcc/gcc-"${gccver}"/gcc-"${gccver}".tar.bz2
        http://gsdview.appspot.com/nativeclient-archive2/x86_toolchain/r"${pkgver}"/nacltoolchain-buildscripts-r"${pkgver}".tar.gz
        http://gsdview.appspot.com/nativeclient-archive2/x86_toolchain/r"${pkgver}"/naclbinutils-"${binutilsver}"-r"${pkgver}".patch.bz2
        http://gsdview.appspot.com/nativeclient-archive2/x86_toolchain/r"${pkgver}"/naclnewlib-"${newlibver}"-r"${pkgver}".patch.bz2
        http://gsdview.appspot.com/nativeclient-archive2/x86_toolchain/r"${pkgver}"/naclgcc-"${gccver}"-r"${pkgver}".patch.bz2)
md5sums=('9cdfb9d6ec0578c166d3beae5e15c4e5'
         '3dae127d4aa659d72f8ea8c0ff2a7a20'
         'fe1ca818fc6d2caeffc9051fe67ff103'
         'af5e716c3bc03c74e88a43339e0f6809'
         '1d18c4253992e599288c588f0a45b6b0'
         'e09f0f3386718170417d57ead515ae1a'
         '1335a1f976354fbe85865bfe724032d3')

build(){
  mkdir "${srcdir}"/"${pkagename}"/SRC
  mv "${srcdir}"/"${pkagename}"/binutils-"${binutilsver}" "${srcdir}"/"${pkagename}"/SRC/binutils
  mv "${srcdir}"/"${pkagename}"/newlib-"${newlibver}" "${srcdir}"/"${pkagename}"/SRC/newlib
  mv "${srcdir}"/"${pkagename}"/gcc-"${gccver}" "${srcdir}"/"${pkagename}"/SRC/gcc
  patch -d "${srcdir}"/"${pkagename}"/SRC -p0 < naclbinutils-"${binutilsver}"-r"${pkgver}".patch
  patch -d "${srcdir}"/"${pkagename}"/SRC -p0 < naclnewlib-"${newlibver}"-r"${pkgver}".patch
  patch -d "${srcdir}"/"${pkagename}"/SRC -p0 < naclgcc-"${gccver}"-r"${pkgver}".patch
  msg 'Go to make sex with your Sweetie, or "Build the Eiffel Tower with chopsticks" (or self-abuse XD), or, or... {insert here "which takes a long time"}... this take a very LONG, LONG TIME'
  make PREFIX="${srcdir}"/build CANNED_REVISION="yes" build-with-newlib
}

package(){
   cd "${srcdir}"/"${pkagename}"
   mkdir "${pkgdir}"/opt/
   cp -R "${srcdir}"/build "${pkgdir}"/opt/"${pkgname}"
}
