# Maintainer: SpepS < dreamspepser at yahoo dot it>

pkgname=avld
pkgver=0.1.4
pkgrel=4
pkgdesc="A V4L dummy video device built to simulate an input video device like a webcam or a video capture card."
arch=('i686' 'x86_64')
url="http://allonlinux.free.fr/Projets/AVLD/"
license=('GPL')
makedepends=('kernel26-headers')
source=("${url}src/${pkgname}_${pkgver}.tar.bz2"
	"${pkgname}_${pkgver}.patch"
	"bad.patch")
install="${pkgname}.install"
md5sums=('dbe16be302293cd0b286f5bef8b33c5f'
         '926ab9d4e3c3ee2c7d0441ce546b2b9c'
         'beb282a1f21ba556cbd6436bf8de3d00')

build() {
  cd "$srcdir/${pkgname}_${pkgver}"

  # Patching for newer kernels and memcpy issue (prevent high cpu usage)
  patch video_device.c ../${pkgname}_${pkgver}.patch
  patch video_device.c ../bad.patch

  make
}

package() {
  cd "$srcdir/${pkgname}_${pkgver}"

  install -Dm644 avld.ko "${pkgdir}/lib/modules/`uname -r`/kernel/drivers/misc/avld.ko"
}
