# Maintainer: Gadget3000 <gadget3000 at msn dot com>
# Contributor: jimmy-6 <jakub.jarozek at gmail dot com>

pkgname=cogs
pkgver=2
pkgrel=2
pkgdesc="A game in which you build machines from sliding tiles"
arch=('i686' 'x86_64')
url="http://www.cogsgame.com/"
license=('unknown')
depends=('gcc-libs' 'sdl<1.3' 'openal')
makedepends=('unzip')
source=(cogs.desktop)
md5sums=('425530cd26af362c2e98d4bf720b4372') #generate with 'makepkg -g'

_archive="cogs-installer-build2"
_archive_md5="be9bd712a2f659ab9fb473875cf780ea"

build() {
  install -Dd ${srcdir}/extractedInstaller
  cd $srcdir
  
  if [ ! -f ${_archive} ]; then
  echo Please place ${_archive} into $(pwd)
  echo Press Enter to continue
  read -a _unused
  fi

  if ! echo "${_archive_md5}  ${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_archive}"
    return 1
  fi

  install -Dd ${pkgdir}/opt/
  unzip -qqo cogs-linux-bin -x guis/* meta/* scripts/* -d ${srcdir}/extractedInstaller/ && msg Finished Extracting
  install -Dd ${pkgdir}/opt/cogs
  mv ${srcdir}/extractedInstaller/data/* ${pkgdir}/opt/cogs/
  install -Dd ${pkgdir}/usr/bin
  ln -s /opt/cogs/Cogs ${pkgdir}/usr/bin/cogs

  # install menu entry
  install -Dd ${pkgdir}/usr/share/applications
  install -m 644 'cogs.desktop' "${pkgdir}/usr/share/applications/cogs.desktop"
}
