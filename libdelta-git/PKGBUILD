# Maintainer: Mariano Street <mstreet@kde.org.ar>

pkgname=libdelta-git
pkgver=20110516
pkgrel=1
pkgdesc='Core library from the Sapphire desktop environment'
arch=(i686 x86_64)
url='http://gitorious.org/delphos/libdelta'
license=('GPL')
groups=('sapphire')
depends=('qt')
makedepends=('qt' 'git' 'cmake')
optdepends=('sapphire-desktop-git: innovative and usability-oriented desktop environment')
provides=('libdelta')
source=(CMakeLists.txt)
md5sums=('1a7ef39ae2b98754afcbaa84315f0a38')

_gitroot='git://gitorious.org/delphos/libdelta.git'
_gitname='libdelta'

build ()
{
    cd "$srcdir"
    msg 'Connecting to GIT server....'
    
    if [ -d $_gitname ]; then
        cd $_gitname && git pull origin
        msg 'The local files are updated.'
    else
        git clone $_gitroot $_gitname
    fi
    
    msg 'GIT checkout done or server timeout.'
    msg 'Starting make...'
    
    rm -rf "$srcdir/$_gitname-build"
    git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"
    
    cp "$startdir/CMakeLists.txt" .
    sed -i "s|/usr|$pkgdir/usr|g" CMakeLists.txt
    mkdir build
    cd build
    cmake ..
    make
}

package ()
{
    cd "$srcdir/$_gitname-build/build"
    make install
} 
