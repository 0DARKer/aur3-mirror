#Contributor: Dr.T.Error <der_dot_t_dot_error_at_online_dot_de>

pkgname=ufoai-git
pkgver=20130309
pkgrel=3
pkgdesc="Development version of 'Ufo: Alien Invasion'. Includes Gamedata. Useing ufoai.org own git. ver 2.5-dev "
url="http://ufoai.org/wiki/News"
license=('GPL')
arch=('i686' 'x86_64')
depends=('libgl' 'curl' 'sdl_image' 'sdl_mixer' 'sdl_ttf' 'libtheora' 'xvidcore')
makedepends=('git')
conflicts=('ufoai' 'ufoai-data' 'ufoai-svn')
source=(ufo.sh ufoded.sh ufoai.png ufoai.desktop)

md5sums=('855b91e47893f297b35b6e9f47145be0'
         '81f3c45d1c3269473d2fe85730fd7e53'
         'ae3be6e45fdd8ff584fcfc55d6a40a72'
         'f212811fecfa6eacff73b09e12df73a3')

_gitroot=git://git.code.sf.net/p/ufoai/code
_gitname=ufoai
_ver=2.5-dev

build() {
	cd $srcdir

	msg "Connecting to GIT server...."

	if [ -d $_gitname ] ; then
	  cd $_gitname && git pull origin
	  msg "The local files are updated."
	else
	  git clone $_gitroot $_gitname
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	cd $_gitname

	./configure --prefix=/usr || return 1

	make || return 1
	make lang || return 1
	make models || return 1 #not necessary, but it will speed things up during runtime i guess
	make maps || return 1
	make pk3 || return 1
}

package() {
	cd $srcdir/$_gitname
	#gamedata
	mkdir -p $pkgdir/usr/share/ufoai/base/
	cp  base/*.pk3 base/*.cfg base/*.txt base/*.so $pkgdir/usr/share/ufoai/base/

	 #binarys
	mkdir -p $pkgdir/usr/share/ufoai/
	cp ufo ufoded ufo2map ufomodel $pkgdir/usr/share/ufoai/

	#translations
	mkdir -p $pkgdir/usr/share/ufoai/$_ver/base/i18n/
	cp -r base/i18n/* $pkgdir/usr/share/ufoai/$_ver/base/i18n/

	#licenses
	mkdir -p $pkgdir/usr/share/licenses/$pkgname
	cp COPYING LICENSES $pkgdir/usr/share/licenses/$pkgname/

	install -D -m644 $srcdir/ufoai.desktop $pkgdir/usr/share/applications/ufoai.desktop
	install -D -m644 $srcdir/ufoai.png $pkgdir/usr/share/pixmaps/ufoai.png
	install -D -m755 $srcdir/ufo.sh $pkgdir/usr/bin/ufo
	install -D -m755 $srcdir/ufoded.sh $pkgdir/usr/bin/ufoded
}
