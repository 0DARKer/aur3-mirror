# Contributor: Byron Clark <byron@theclarkfamily.name>
pkgname=slock-hg
pkgver=20091126
_hgrev=4d3769ac5d02
pkgrel=1
pkgdesc="A simple screen locker for X"
arch=('i686' 'x86_64')
url="http://www.suckless.org/wiki/tools/xlib"
license=('MIT')
depends=('libx11')
makedepends=('mercurial')
provides=('slock')
conflicts=('slock')
source=()
md5sums=()

_hgrepo=http://code.suckless.org/hg
_hgname=slock

build() {
  cd $startdir/src

  if [ -d $_hgname/.hg ]; then
    (cd $_hgname && hg pull -u -r $_hgrev)
  else
    hg clone -r $_hgrev $_hgrepo/$_hgname $_hgname
  fi

  msg "HG checkout done or server timeout"
  msg "Starting make..."

  rm -rf $startdir/src/$_hgname-build
  cp -r $_hgname $_hgname-build
  cd $_hgname-build

  #
  # BUILD
  #
  sed -i 's|PREFIX = /usr/local|PREFIX = /usr|g' config.mk

  make || return 1
  make DESTDIR=$startdir/pkg install || return 1
  install -m644 -D LICENSE $startdir/pkg/usr/share/licenses/$pkgname/LICENSE
}
