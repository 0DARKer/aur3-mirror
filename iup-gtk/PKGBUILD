# Maintainer: Mihai Militaru <mihai dot militaru at xmpp dot ro>

pkgname=iup-gtk
pkgver=3.5
pkgrel=3
pkgdesc="C cross platform GUI toolkit"
arch=('i686' 'x86_64')
url="http://www.tecgraf.puc-rio.br/iup/"
license=('MIT')
depends=('gtk2')
makedepends=('lua' 'cd' 'im' 'mesa' 'libwebkit')

source=(http://sourceforge.net/projects/iup/files/${pkgver}/Docs%20and%20Sources/iup-${pkgver}_Sources.tar.gz)
sha1sums=('e5a3fdde13dcf77eeb5e690b21ff198389b1e889')

build() {
  cd ${srcdir}/iup

  sed -i 's|LIBS += webkit-1.0|LIBS += webkitgtk-1.0|g' srcweb/config.mak

  make IM_LIB=/usr/lib CD_LIB=/usr/lib LUA_LIB=/usr/lib LUA_SUFFIX=""
  mkdir -p ${pkgdir}/usr/{include,lib/lua/5.1}

  install -m644 ${srcdir}/iup/lib/Linux*/libiup*.a ${pkgdir}/usr/lib/
  install -m755 ${srcdir}/iup/lib/Linux*/libiup*.so ${pkgdir}/usr/lib/
  rm -f ${pkgdir}/usr/lib/libiuplua*
  install -m644 ${srcdir}/iup/lib/Linux*/libiuplua*.a ${pkgdir}/usr/lib/lua/5.1/ 
  install -m755 ${srcdir}/iup/lib/Linux*/libiuplua*.so ${pkgdir}/usr/lib/lua/5.1/

  cd ${pkgdir}/usr/lib/lua/5.1/
  ln -s libiuplua51.so libiuplua.so
  ln -s libiupluacd51.so libiupluacd.so
  ln -s libiupluacontrols51.so libiupluacontrols.so
  ln -s libiupluagl51.so libiupluagl.so
  ln -s libiupluaim51.so libiupluaim.so
  ln -s libiupluaimglib51.so libiupluaimglib.so
  ln -s libiuplua_pplot51.so libiuplua_pplot.so
  ln -s libiupluatuio51.so libiupluatuio.so
  
  install ${srcdir}/iup/include/* ${pkgdir}/usr/include/
}
