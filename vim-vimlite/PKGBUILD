# Maintainer: Tianjiao Yin <ytj000@gmail.com>

pkgname=vim-vimlite
pkgver=0.8.3
_srcver=398
pkgrel=1
pkgdesc="Make vim as a C/C++ IDE inspired by CodeLite."
arch=('any')
url="http://www.vim.org/scripts/script.php?script_id=3647"
license=('unknown')
depends=("gvim" "python" "python-lxml" "gcc" "make" "gdb" "cscope")
groups=('vim-plugins')
install=vimdoc.install
source=("http://vimlite.googlecode.com/files/VimLite-${_srcver}.tar.bz2")

build()
{
	cd ${srcdir}

	find -type f -name "*.pyc" | xargs rm -rf
	find -type f -name "*.pyo" | xargs rm -rf

	# Change ~/.vimlite to /usr/share/vim/vimlite
	find -type f -print0 | xargs -0 sed -i "s_~/.vimlite_/usr/share/vim/vimlite_g"
	sed -i "s_\\expand('\$HOME') . '/.vimlite_'/usr/share/vim/vimlite_g" */*.vba
	sed -i "s_\$HOME/.vimlite_'/usr/share/vim/vimlite_g" */*.vba

	# Use python2.
	find -type f -print0 | xargs -0 sed -i 's_/usr/bin/env python_/usr/bin/env python2_'
	find -type f -print0 | xargs -0 sed -i 's_/usr/bin/python_/usr/bin/env python2_'

	rm VimLite-${_srcver}.tar.bz2
}

package() {
	cd ${srcdir}
	vimpath=${pkgdir}/usr/share/vim/vimfiles/
	mkdir -p ${vimpath}
	vim -c "set rtp=${vimpath}" -c "silent so %" -c 'qa!' */*.vba
	rm -f ${vimpath}/.VimballRecord ${vimpath}/doc/tags
	rm -f */*.vba
	mv */vimlite ${pkgdir}/usr/share/vim/vimlite
}
md5sums=('c7fbff4ab60d589cc38007472987ed21')
