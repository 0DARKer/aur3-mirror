# Contributor: Tony Lambiris <tony@libpcap.net>
pkgname=glusterfs-git
pkgver=20100630
pkgrel=1
pkgdesc="A cluster file-system capable of scaling to several peta-bytes (GIT version)."
arch=('i686' 'x86_64')
url="http://www.gluster.org/"
license=('GPL3')
groups=('clustering')
depends=('fuse' 'flex' 'bison' 'libtool' 'automake' 'autoconf')
provides=('glusterfs')
conflicts=('glusterfs')

_gitroot="git://git.gluster.com/glusterfs.git"
_gitname="glusterfs"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ ! -d $_gitname ] ; then
    git clone $_gitroot $_gitname
    cd $_gitname
    # msg "Setting default branch to release-3.0"
    git checkout --track -b REL_3 remotes/origin/release-3.0
  else
    cd $_gitname && git pull
    msg "The local files are updated."
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #

  ./autogen.sh
  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var
  make || return 1
  make DESTDIR="$pkgdir" install

  install -D -m 755 $srcdir/$_gitname-build/README $pkgdir/usr/share/doc/glusterfs/
  install -D -m 755 $srcdir/$_gitname-build/INSTALL $pkgdir/usr/share/doc/glusterfs/
  install -D -m 755 $srcdir/$_gitname-build/COPYING $pkgdir/usr/share/doc/glusterfs/
} 
