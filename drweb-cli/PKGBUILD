pkgname=drweb-cli
pkgver=6.0.1
pkgrel=2
pkgdesc="Dr. Web Antivirus"
arch=('i686')
url="http://www.drweb.com/"
license=('custom')
depends=('perl')
backup=(etc/drweb/drweb32.ini)
options=('!strip')
install=drweb-cli.install
source=(http://download.geo.drweb.com/pub/drweb/unix/release/Linux/components/drweb-bases_6.0.0.1-1011291609~linux_all.tar.gz
	http://download.geo.drweb.com/pub/drweb/unix/release/Linux/components/drweb-common_6.0.1.0-1011241604~linux_all.tar.gz
	http://download.geo.drweb.com/pub/drweb/unix/release/Linux/components/drweb-scanner_6.0.1.1-1011081537~linux_all.tar.gz
	http://download.geo.drweb.com/pub/drweb/unix/release/Linux/components/drweb-updater_6.0.0.2-1011291657~linux_x86.tar.gz
	drweb-cli.install
	drweb32.ini)
md5sums=('275f524778d30320def2ebb9eecd0106'
         'ab8c02e877f1c15fa1dc35958b3192f3'
         'fe303beb39c71ae1a3518bd55b1df075'
         '7e9ea108b5a4cc9e57f8b85b452a61a9'
	 '9bf1978daed60aef322c78a2cdf4a5c8'
         'dbb047091426ac792cc54ba30494c603')

build() {
  umask 0022
  mkdir -p "${srcdir}/build"
  cd "${srcdir}/build"
	for f in drweb-bases.sw drweb-common.sw drweb-scanner.sw drweb-updater.sw; do
		tar xpf ../${f} &>/dev/null || return 1
	done

  cd "${srcdir}/build/opt/drweb"
	for i in drweb lzma read_signed; do
		ln -sf ${i}.real ${i}
	done

  cp -r "${srcdir}"/build/* "${pkgdir}"/ || return 1
  install -Dm644 -o root -g root "${srcdir}/LICENSE" "${pkgdir}/usr/share/licenses/drweb/LICENSE"
  install -Dm644 -o root -g root "${srcdir}/drweb32.ini" "${pkgdir}/etc/drweb/drweb32.ini"
  install -Dm644 -o root -g root "${srcdir}/build/opt/drweb/doc/license.rus.utf8" "${pkgdir}/usr/share/licenses/drweb/LICENSE.rus"
  install -dm 755 -o root -g root "${pkgdir}"/var/drweb
  install -dm 775 -o root -g root "${pkgdir}"/opt/drweb/bases
  install -dm 775 -o root -g root "${pkgdir}"/var/drweb/{drl,run,spool,updates,bases}
  install -dm 770 -o root -g root "${pkgdir}"/var/drweb/{infected,log}
  touch "${pkgdir}"/var/drweb/log/{drweb.log,updater.log}

  chmod 0644 "${pkgdir}"/var/drweb/bases/*
}

