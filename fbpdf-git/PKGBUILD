# Maintainer: Sara <sfauzia at comcast dot net>

pkgname=fbpdf-git 
true && pkgname=(fbpdf-git fbpdf2-git fbdjvu-git)
pkgver=20110819
pkgrel=1
arch=('i686' 'x86_64')
url="http://repo.or.cz/w/fbpdf.git"
license=('GPL')
makedepends=('djvulibre' 'mupdf' 'poppler' 'git')
source=('fbpdf.1' 'fbpdf2.1' 'fbdjvu.1')
md5sums=('162c0dfda0b148fea509ee68f30eeb80'
         '4eb1ca58ee9290404c0cb623f4fa539b'
         'd5324f99dfff37de6d7b933479e616a3')

_gitroot=git://repo.or.cz/fbpdf.git
_gitname=fbpdf

build() {
    cd "${srcdir}"
    msg "Connecting to GIT server...."
    
    if [[ -d ${_gitname} ]]; then
        cd "${_gitname}"
        git pull origin
        msg "The local files are updated."
    else
        git clone "${_gitroot}" 
        cd "${_gitname}"
    fi
    msg "Checkout done or server timeout"
    rm -rf "${srcdir}/${_gitname}-build"
    git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
}

package_fbpdf-git() {
    pkgdesc+=" based on MuPDF."
    depends=('mupdf')
    provides=('fbpdf')
    conflicts=('fbpdf')

    cd "${srcdir}/${_gitname}-build"

    msg "Starting make..."
    make fbpdf
    install -Dm755 "${srcdir}/${_gitname}-build/${_gitname}" "${pkgdir}/usr/bin/${_gitname}"
    # Install man page
    install -Dm644 ${srcdir}/${_gitname}.1 "$pkgdir/usr/share/man/man1/${_gitname}.1"
}

package_fbpdf2-git() {
    pkgdesc+=" based on poppler."
    depends=('poppler')
    provides=('fbpdf2')
    conflicts=('fbpdf2')

    cd "${srcdir}/${_gitname}-build"

    msg "Starting make..."
    make fbpdf2
    install -Dm755 "${srcdir}/${_gitname}-build/${_gitname}2" "${pkgdir}/usr/bin/${_gitname}2"
    # Install man page
    install -Dm644 ${srcdir}/${_gitname}2.1 "$pkgdir/usr/share/man/man1/${_gitname}2.1"
}

package_fbdjvu-git() {
    pkgdesc="A small framebuffer DjVu viewer."
    depends=('djvulibre')
    provides=('fbdjvu')
    conflicts=('fbdjvu')

    cd "${srcdir}/${_gitname}-build"

    msg "Starting make..."
    make fbdjvu
    install -Dm755 "${srcdir}/${_gitname}-build/fbdjvu" "${pkgdir}/usr/bin/fbdjvu"
    # Install man page
    install -Dm644 ${srcdir}/fbdjvu.1 "$pkgdir/usr/share/man/man1/fbdjvu.1"
}

# Package description is here so that the AUR reads it properly
pkgdesc="A small framebuffer pdf viewer"
