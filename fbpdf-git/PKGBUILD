# Maintainer: Sara <sara at archlinux dot us>
pkgname=fbpdf-git
pkgver=20110325
pkgrel=1
pkgdesc="A small framebuffer pdf viewer based on MuPDF."
arch=('i686' 'x86_64')
url="http://repo.or.cz/w/fbpdf.git"
license=('GPL')
depends=('mupdf') 
makedepends=('git')
provides=('fbpdf')
conflicts=('fbpdf')
source=('fbpdf.1')
md5sums=('e3bfe315d11a0e42aeb45b9dc8edf891')

_gitroot=git://repo.or.cz/fbpdf.git
_gitname=fbpdf

build(){
    cd "${srcdir}"
    msg "Connecting to GIT server...."
    
    if [[ -d ${_gitname} ]]; then
        cd "${_gitname}"
        git pull origin
        msg "The local files are updated."
    else
        git clone "${_gitroot}" 
        cd "${_gitname}"
    fi
    msg "Checkout done or server timeout"
    rm -rf "${srcdir}/${_gitname}-build"
    git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
    cd "${srcdir}/${_gitname}-build"

    msg "Starting make..."
    make
}

package(){
    install -Dm755 "${srcdir}/${_gitname}-build/${_gitname}" "${pkgdir}/usr/bin/${_gitname}"
    # Install man page
    install -Dm644 ${srcdir}/${_gitname}.1 "$pkgdir/usr/share/man/man1/${_gitname}.1"
}
