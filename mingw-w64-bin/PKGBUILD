# Maintainer: Daniele Zelante <zeldan at zeldan dot net>

_gccver="4.5.4"
_mingw_w64_ver="1.0"
_mingw_w64_date="20110808" # If the tarball for this date is not available, download the latest

_actual_file="mingw-w64-${_mingw_w64_ver}-bin_${CARCH}-linux_${_mingw_w64_date}.tar.bz2"

pkgname=mingw-w64-bin
pkgver="${_gccver}_${_mingw_w64_date}"
pkgrel=1
pkgdesc="MinGW Toolchain fork for building Windows x86_64 executables - Automated Builds provided by mingw-w64 upstream"
url="http://mingw-w64.sourceforge.net/"
arch=('x86_64')
license=('GPL')
depends=('bash' 'zlib')
makedepends=('aria2' 'tar')
options=(!strip docs zipman !emptydirs)
install=${pkgname}.install


build() {
    cd ${srcdir}/
    
    aria2c http://downloads.sourceforge.net/project/mingw-w64/Toolchains%20targetting%20Win64/Automated%20Builds/${_actual_file}
    
    mkdir -p ${srcdir}/mingw_w64/
    cd ${srcdir}/mingw_w64
    
    bsdtar xf ${srcdir}/${_actual_file}

	# remove wrong permissions in downloaded tarball files
	chmod -R a+X,a+r .
	find . -name '*.a' -exec chmod -x {} \;

	# remove .la files
	find . -name '*.la' -exec rm -f {} \;

}

package() {

    mkdir -p "${pkgdir}/opt/"
    
    cp -r "${srcdir}/mingw_w64" "${pkgdir}/opt/"
    
    #rm -rf ${pkgdir}/usr/share/man/man7/ 
    #rm -rf ${pkgdir}/usr/share/locale/
    #rm -rf ${pkgdir}/usr/share/info/
    # rm -rf ${pkgdir}/usr/share/gcc-${_gccver}/
	(
		mkdir -p "${pkgdir}/usr/bin"
		cd "${pkgdir}/usr/bin"
		find "../../opt/mingw_w64/bin/" -type f -name 'x86_64-w64-mingw32-*' -exec ln -s {} \;
	)

}
