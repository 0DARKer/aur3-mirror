# Maintainer: Dan Serban
# Contributor: John Gerritse <reaphsharc@gmail.com>

pkgname=celtx
pkgver=2.x.x.latest
pkgrel=1
pkgdesc="Integrated solution for media pre-production and collaboration"
url=http://celtx.com/
arch=(any)
license=(CePL) 
depends=(python2)
makedepends=(lynx)
conflicts=(celtx-bin)

build()
{
  rm celtx.tar.bz2 2>/dev/null || true
  _url=$(lynx -dump "http://celtx.com/" | grep -o http.*src.tar.bz2)
  wget -O celtx.tar.bz2 "${_url}"
  msg "Extracting archive..."
  bsdtar -xf celtx.tar.bz2
  msg2 "... completed."
  _basedir="${srcdir}"/$(ls -1d celtx-*-src/ | tail -1)
  cd "${_basedir}"/mozilla
  install mozconfig-nodebug-linux.in .mozconfig
  PYTHON=python2 make -f client.mk build
  make -C ../objdir/celtx/installer
  mkdir -p "${pkgdir}"/usr/share
  bsdtar -xf "${_basedir}"/objdir/dist/celtx*.en-US.linux-${CARCH}.tar.bz2 -C "${pkgdir}"/usr/share
  mkdir -p "${pkgdir}"/usr/share/applications
  DESKTOPFILE="${pkgdir}"/usr/share/applications/brosix.desktop
  echo "[Desktop Entry]" > "${DESKTOPFILE}"
  echo "Name=Celtx" >> "${DESKTOPFILE}"
  echo "Comment=Solution for media pre-production and collaboration" >> "${DESKTOPFILE}"
  echo "Exec=/usr/share/celtx/celtx" >> "${DESKTOPFILE}"
  echo "Icon=/usr/share/celtx/icons/default48.png" >> "${DESKTOPFILE}"
  echo "Type=Application" >> "${DESKTOPFILE}"
  echo "Terminal=false" >> "${DESKTOPFILE}"
  echo "Categories=Office;" >> "${DESKTOPFILE}"
}

