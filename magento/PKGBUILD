# $Id$
# Maintainer: David Roheim <david dot roheim at gmail dot com>

pkgname=('magento')
pkgver=1.7.0.2
pkgrel=3
pkgdesc="Magento Community Edition - PHP based e-commerce"
license=('OSL3')
arch=('any')
url='http://www.magentocommerce.com/'
source=("http://www.magentocommerce.com/downloads/assets/${pkgver}/${pkgname}-${pkgver}.tar.bz2")
sha256sums=('50ff0c265f91850b4bbce2c5af216968edcb5bde9ff3802f2eecd0e741607751')
depends=('php' 'php-mcrypt' 'php-gd' 'mariadb-clients' 'curl')
options=(!strip)
install=${pkgname}.install

build_magento() {
  true
}

package_magento() {
  install -d -m755 ${pkgdir}/usr/share/webapps/${pkgname}
  install -d -m755 ${pkgdir}/etc/webapps/${pkgname}

  install -D -m644 ${srcdir}/${pkgname}/LICENSE.txt     "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt"     || return 1
  install -D -m644 ${srcdir}/${pkgname}/LICENSE.html    "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.html"    || return 1
  install -D -m644 ${srcdir}/${pkgname}/LICENSE_AFL.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE_AFL.txt" || return 1

  mv ${srcdir}/${pkgname}/.htaccess ${pkgdir}/etc/webapps/${pkgname}/htaccess
  mv $srcdir/$pkgname/app/etc $pkgdir/etc/webapps/${pkgname}
  mv $srcdir/$pkgname $pkgdir/usr/share/webapps/

  ln -s /etc/webapps/${pkgname}/etc ${pkgdir}/usr/share/webapps/${pkgname}/app/etc
  ln -s /etc/webapps/${pkgname}/htaccess ${pkgdir}/usr/share/webapps/${pkgname}/.htaccess
}
