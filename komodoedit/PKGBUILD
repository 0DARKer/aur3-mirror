# Maintainer: max-k <max-k@post.com>
# Contributor: max-k <max-k@post.com>

if [ $(uname -m) = "x86_64" ] ; then
_arch="x86_64"
else
_arch="x86"
fi

_major="6.1.3"
_minor=8844

pkgname="komodoedit"
pkgver="${_major}_${_minor}"
pkgrel=1
pkgdesc="Open-Source version of ActiveState Komodo IDE - Based on XUL"
arch=(i686 x86_64)
url="http://www.openkomodo.com/"
license=('MPL')
depends=('glibc>=2.4' 'libjpeg>=6.2' 'gcc-libs' 'gtk2')
optdepends=()
conflicts=('komodoedit-nightly' 'komodoedit-beta')

source=("http://downloads.activestate.com/Komodo/releases/${_major}/Komodo-Edit-${_major}-${_minor}-linux-libcpp6-${_arch}.tar.gz")

if [ $_arch = "x86_64" ] ; then
md5sums=('02f8939ed0352460d758b5d71637f200')
else
md5sums=('45949b817819b9e4dd02b5e3070de03d')
fi

build() {
cd ${startdir}/src/Komodo-Edit-${_major}-${_minor}-linux-libcpp6-${_arch}
./install.sh -s -I ${startdir}/pkg/opt/${pkgname}
sed -i 's/Komodo\ Edit-6.desktop/Komodo\ Edit\ 6/' ${startdir}/pkg/opt/${pkgname}/share/desktop/komodo-edit-6.desktop
grep -v ${startdir} ${startdir}/pkg/opt/${pkgname}/share/desktop/komodo-edit-6.desktop > ${startdir}/${pkgname}.desktop
echo "Exec=/opt/${pkgname}/bin/komodo %F" >> ${startdir}/${pkgname}.desktop
echo "Icon=/opt/${pkgname}/share/icons/komodo48.png" >> ${startdir}/${pkgname}.desktop
install -D -m 644 ${startdir}/${pkgname}.desktop ${startdir}/pkg/usr/share/applications/${pkgname}.desktop
mkdir -p ${startdir}/pkg/usr/bin/
ln -s ${startdir}/pkg/opt/${pkgname}/bin/komodo ${startdir}/pkg/usr/bin/komodo
}
