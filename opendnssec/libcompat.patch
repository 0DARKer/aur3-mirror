--- libhsm/checks/Makefile.am	2010-08-11 13:18:06.000000000 +0200
+++ libhsm/checks/Makefile.am	2012-11-20 21:14:16.325732758 +0100
@@ -3,6 +3,9 @@
 MAINTAINERCLEANFILES = $(srcdir)/Makefile.in
 CLEANFILES = token.db othertoken.db
 
+LIBCOMPAT = ${top_builddir}/common/libcompat.a
+
+
 AM_CPPFLAGS = \
 		-I$(top_builddir)/common \
 		-I$(srcdir)/../src \
@@ -14,7 +17,7 @@
 
 noinst_PROGRAMS = hsmcheck
  
-hsmcheck_LDADD = ../src/libhsm.a @LDNS_LIBS@ @XML2_LIBS@
+hsmcheck_LDADD = ../src/libhsm.a @LDNS_LIBS@ @XML2_LIBS@ $(LIBCOMPAT)
 hsmcheck_LDFLAGS = -no-install
 
 SOFTHSM_ENV = SOFTHSM_CONF=$(srcdir)/softhsm.conf
--- libhsm/src/Makefile.am	2010-08-11 12:21:06.000000000 +0200
+++ libhsm/src/Makefile.am	2012-11-20 21:10:19.005310678 +0100
@@ -2,6 +2,8 @@
 
 MAINTAINERCLEANFILES = $(srcdir)/Makefile.in
 
+LIBCOMPAT = ${top_builddir}/common/libcompat.a
+
 AM_CPPFLAGS = \
 		-I$(top_srcdir)/common \
 		-I$(top_builddir)/common \
@@ -20,7 +22,7 @@
 man1_MANS = ods-hsmutil.1 ods-hsmspeed.1
 
 ods_hsmutil_SOURCES = hsmutil.c hsmtest.c hsmtest.h
-ods_hsmutil_LDADD = libhsm.a @LDNS_LIBS@ @XML2_LIBS@
+ods_hsmutil_LDADD = libhsm.a @LDNS_LIBS@ @XML2_LIBS@ $(LIBCOMPAT)
 
 ods_hsmspeed_SOURCES = hsmspeed.c
-ods_hsmspeed_LDADD = libhsm.a -lpthread @LDNS_LIBS@ @XML2_LIBS@
+ods_hsmspeed_LDADD = libhsm.a -lpthread @LDNS_LIBS@ @XML2_LIBS@ $(LIBCOMPAT)
--- signer/src/Makefile.am    2011-02-17 12:22:41.000000000 +0100
+++ signer/src/Makefile.am 2012-11-20 21:23:17.014005781 +0100
@@ -3,6 +3,7 @@
 MAINTAINERCLEANFILES = $(srcdir)/Makefile.in
 
 LIBHSM = ${top_builddir}/libhsm/src/libhsm.a
+LIBCOMPAT = ${top_builddir}/common/libcompat.a
 
 AM_CPPFLAGS = \
 	-I$(top_srcdir)/common \
@@ -58,7 +59,7 @@
 				tools/toolutil.c tools/toolutil.h \
 				tools/zone_fetcher.c tools/zone_fetcher.h
 
-ods_signerd_LDADD=		$(LIBHSM)
+ods_signerd_LDADD=		$(LIBHSM) $(LIBCOMPAT)
 ods_signerd_LDADD+=		@LDNS_LIBS@ @XML2_LIBS@ @PTHREAD_LIBS@ @RT_LIBS@
 
 ods_signer_SOURCES=		ods-signer.c \

