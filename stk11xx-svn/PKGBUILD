# Maintainer: Marcin Karpezo <sirmacik at gmail dot com>
# Contributor: Adam Russ (mail@russ.co.il)

pkgname=stk11xx-svn
pkgver=99
pkgrel=2
pkgdesc="Syntek DC-1125 Camera Driver (integrated camera in Asus laptops) - SVN" 
url="http://syntekdriver.sourceforge.net" 
license="GPL" 
arch=(i686 x86_64)
depends=('kernel26-headers')
conflicts=('stk11xx')
replaces=('stk11xx')
provides=('stk11xx')
makedepends=('ctags')
source=()
md5sums=()
install=$pkgname.install

_svntrunk=https://syntekdriver.svn.sourceforge.net/svnroot/syntekdriver/trunk/driver
_svnmod=driver

build() {
  cd $startdir/src

  # Update or Checkout svn version
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up )
  else
    svn co -r $pkgver $_svntrunk --config-dir ./ $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build || return 1
  # Configure & install 
	make -f Makefile.standalone || return 1
	install -d $startdir/pkg/lib/modules/`uname -r`/kernel/drivers/media/video
	install -m 644 $startdir/src/$_svnmod-build/stk11xx.ko $startdir/pkg/lib/modules/`uname -r`/kernel/drivers/media/video
	install -d $startdir/pkg/usr/share/stk11xx
	install -m 644 $startdir/src/$_svnmod-build/README $startdir/pkg/usr/share/stk11xx
  rm -rf $startdir/src/$_svnmod-build
}

