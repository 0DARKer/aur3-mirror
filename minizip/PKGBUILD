# Maintainer: Babets
# Contributor:  Leslie P. Polzer <polzer at stardawn dot org>
pkgname=minizip
pkgver=1.1
pkgrel=2
pkgdesc="ZIP file extraction library"
url="http://www.winimage.com/zLibDll/minizip.html"
license=('ZLIB' 'custom')
arch=('i686' 'x86_64')
makedepends=(zlib)
provides=('libminizip')
conflicts=('libminizip')
source=(http://www.winimage.com/zLibDll/unzip11.zip
        LICENSE)
md5sums=('29d6914e204292fa3bcd8f157a735793'
         '66b8119e37a80d8bc9d7b1bac59d7d8e')
sha1sums=('47eefda2456cc9645bb7751f1a96fd6191da45f8'
          'ad1e3fb070e1b63ae5350d9bb9607a79ecc0a5cd')

build() {
  cd $srcdir

  # Patch makefile with the correct libz.a path
  sed -i 's:../../libz.a:/usr/lib/libz.a:g' $srcdir/Makefile

  make
  gcc -shared zip.c unzip.c ioapi.c -o libminizip.so.1 -fPIC

  install -d $pkgdir/usr/{bin,lib,include/minizip,share/licenses/$pkgname}

}

check() {
  cd $srcdir
  touch readme.txt
  make test
}

package() {
  cd "$srcdir"

  install -m 755 {minizip,miniunz} $pkgdir/usr/bin
  install -m 644 libminizip.so.1 $pkgdir/usr/lib
  install -m 644 *.h $pkgdir/usr/include/minizip
  install -m 644 LICENSE $pkgdir/usr/share/licenses/$pkgname
  cd $pkgdir/usr/lib/
  ln -s libminizip.so.1 libminizip.so
}
