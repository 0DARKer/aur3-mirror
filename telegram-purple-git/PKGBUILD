# Maintainer: Francisco Demartino <demartino.francisco@gmail.com>

_pkgname=telegram-purple
pkgname=${_pkgname}-git
pkgver=v0.5.r9.g50c52b0
pkgrel=1
pkgdesc="Adds support for Telegram to Pidgin, Adium, Finch and other Libpurple based messengers."
arch=("any")
url="https://github.com/majn/telegram-purple"
license=("GPL")
makedepends=("git")
depends=('glib2' 'openssl' 'libpurple' 'zlib')

source=("git+https://github.com/majn/telegram-purple" "01-destdir-server-pubkey.patch")
sha512sums=('SKIP'
            '5439b59af61ccc4bbb1123d5b3c0920b7768c0f55acf946cb1660bb238c1cddf93cf8513df7fd10cd3bbb704c99d0de8ca2cb814998d6493d2393bdb4061682a')

pkgver() {
	cd "${srcdir}/${_pkgname}"
	git describe --long | sed -r 's/([^-]*-g)/r\1/;s/-/./g'
}

prepare() {
	cd "${srcdir}/${_pkgname}"
	git submodule update --init --recursive
}

package() {
	cd "${srcdir}/${_pkgname}"

	patch -p1 -i "$srcdir/01-destdir-server-pubkey.patch"

	./configure
	make DESTDIR="$pkgdir/"
	make DESTDIR="$pkgdir/" install
}
