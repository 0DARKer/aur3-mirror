# Maintainer: Kevin Cox <kevincox.ca@gmail.com>
pkgname=buildgen-git
pkgver=0.1
pkgrel=1
pkgdesc="Cross-platform build script generator."
arch=('i686' 'x86_64')
url="https://gitorious.org/buildgen"
license=('MIT style')
depends=('lua luafilesystem lua-penlight')
makedepends=('cmake git')
install=

_gitserver='git://gitorious.org/buildgen/buildgen.git'
_gitname='buildgen'

build() {
	cd "$srcdir"
	msg "Connecting to git server...."

	if [[ -d "$_gitname" ]]; then
		cd "$_gitname"

		if git pull origin ; then
			msg "The local files have been updated."
		else
			msg 'Problem updating sources.'
		fi
	else
		if git clone "$_gitserver" "$_gitname" ; then
			msg "Sources successfully downloaded."
		else
			msg 'Problem retrieving sources.'
		fi
	fi

	msg "Starting build..."

	rm -rf "$srcdir/$_gitname-build"
	git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
	cd "$srcdir/$_gitname-build"

	cmake -DCMAKE_INSTALL_PREFIX=/usr
	make
}

package() {
	cd "$srcdir/$_gitname-build"
	make DESTDIR="$pkgdir/" install
}
