# Maintainer: Kevin Cox <kevincox.ca@gmail.com>
pkgname='buildgen-git'
pkgver='0.1'
pkgrel=1
pkgdesc='Cross-platform build script generator.'
arch=('i686' 'x86_64')
url='https://gitorious.org/buildgen'
license=('MIT style')
depends=('lua')
optdepends=('luafilesystem: Needed somewhere on the system.'
            'lua-penlight:  Needed somewhere on the system.')
makedepends=('cmake' 'git')
provides=('buildgen')

_gitserver='https://bitbucket.org/kevincox/buildgen.git'
_gitname="$srcdir/buildgen"

build() {
	cd "$srcdir"
	msg 'Connecting to git server....'

	if [[ -d "$_gitname" ]]; then
		cd "$_gitname"

		if git pull origin ; then
			msg 'The local files have been updated.'
		else
			msg 'Problem updating sources.'
		fi
	else
		if git clone "$_gitserver" "$_gitname" ; then
			msg 'Sources successfully downloaded.'
		else
			msg 'Problem retrieving sources.'
		fi
	fi

	msg 'Starting build...'

	cd "$_gitname"

	cmake "-DCMAKE_INSTALL_PREFIX=$pkgdir/usr"
	make install
}
