# Maintainer: Patrik Votoƒçek <patrik[at]votocek[dot]cz>

pkgname=0xdbe-eap
_pkgname=0xDBE # Directory name in the tar file
pkgbuild=138.551
pkgver=${pkgbuild}
pkgrel=1
pkgdesc="Lightweight and Smart PHP IDE. 30-day free trial."
arch=('i686' 'x86_64')
options=(!strip)
url="http://www.jetbrains.com/dbe/"
license=('custom')
depends=('java-environment>=6')
source=(http://download.jetbrains.com/dbe/0xdbe-$pkgbuild.tar.gz)
md5sums=('958d8930263a60d3c68cda0a19e06f65')

package() {
  cd ${srcdir}
  mkdir -p ${pkgdir}/opt/${pkgname} || return 1
  cp -R ${srcdir}/${_pkgname}-${pkgbuild}/* ${pkgdir}/opt/${pkgname} || return 1
  if [[ $CARCH = 'i686' ]]; then
     rm -f ${pkgdir}/opt/${pkgname}/bin/libyjpagent-linux64.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/fsnotifier64
  fi
  if [[ $CARCH = 'x86_64' ]]; then
     rm -f ${pkgdir}/opt/${pkgname}/bin/libyjpagent-linux.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/fsnotifier
  fi

(
cat <<EOF
[Desktop Entry]
Version=${pkgver}
Type=Application
Name=0xDBE-EAP
Exec="/opt/${pkgname}/bin/0xdbe.sh" %f
Icon=phpstorm-eap
Comment=New Intelligent IDE for DBAs and Developers 30-day free trial
GenericName=New Intelligent IDE for DBAs and Developers
Categories=Development;IDE;DB;
Terminal=false
StartupNotify=true
StartupWMClass=jetbrains-0xdba
EOF
) > ${startdir}/${pkgname}.desktop

  mkdir -p ${pkgdir}/usr/bin/ || return 1
  mkdir -p ${pkgdir}/usr/share/applications/ || return 1
  mkdir -p ${pkgdir}/usr/share/pixmaps/ || return 1
  mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}/ || return 1
  install -m 644 ${startdir}/0xdbe-eap.desktop ${pkgdir}/usr/share/applications/
  install -m 644 ${pkgdir}/opt/${pkgname}/bin/0xdbe.png ${pkgdir}/usr/share/pixmaps/0xdbe-eap.png
  install -m 644 ${srcdir}/${_pkgname}-${pkgbuild}/license/${_pkgname}_Preview_license.txt ${pkgdir}/usr/share/licenses/${pkgname}/${_pkgname}_license.txt
  ln -s /opt/$pkgname/bin/0xdbe.sh "$pkgdir/usr/bin/0xdbe-eap"
}
