# Contributor: Ameysh <trader9@gmail.com>
pkgname=qtstalker-cvs
pkgver=20070427
pkgrel=1
pkgdesc="A Stock market, commodity and technical analysis charting app based on the Qt toolkit."
url="http://qtstalker.sourceforge.net/"
license='gpl'
depends=('qt>=3.3' 'db>=4.1' 'ta-lib')
makedepends=('cvs')
provides=('qtstalker')
conflicts=('qtstalker')
source=(qtstalker.desktop)
md5sums=('00e13ffea9783a0fca0fdd887ec20ffb')
 
_cvsroot=":pserver:anonymous:@qtstalker.cvs.sourceforge.net:/cvsroot/qtstalker"
_cvsmod="qtstalker"

build() {
	cd $startdir/src
	msg "Connecting to $_cvsmod.sourceforge.net CVS server...."
	cvs -z3 -d $_cvsroot co -D $pkgver -f $_cvsmod
	
	msg "CVS checkout done or server timeout"
	msg "Starting make..."
	
	[ -e $_cvsmod-build ] && rm -Rf $_cvsmod-build
	cp -r $_cvsmod $_cvsmod-build
	cd $_cvsmod-build
		
	find $startdir/src/$_cvsmod-build	-name '*.pro' -exec sed -i "s#\/usr\/local#\/usr#g" '{}' \;
	sed -i 's|\/usr\/local|\/usr|g' plugin.config
	sed -i 's|\/usr\/local|\/usr|g' lib/Config.cpp
	sed -i 's|\/usr\/local|\/usr|g' src/Qtstalker.cpp
	sed -i 's|\/usr\/local|\/usr|g' lib/RcFile.cpp
	sed -i 's|\/usr\/local|\/usr|g' docs/install.html
		
	./configure 
	make || return 1
	make INSTALL_ROOT=$startdir/pkg install 
	
	mkdir -p $startdir/pkg/usr/share/{pixmaps,applications}
  
  install -m 644 -o root -g root pics/qtstalker.xpm $startdir/pkg/usr/share/pixmaps/qtstalker.xpm
  install -m 644 -o root -g root $startdir/qtstalker.desktop $startdir/pkg/usr/share/applications/qtstalker.desktop

  find ${startdir}/pkg -name '*.la' -exec rm {} \;

}
