# $Id$
# Maintainer: Rogof <fake.bios@gmail.com>
# Contributor: Kaiting Chen <kaitocracy@gmail.com>
# Contributor: tocer <tocer.deng@gmail.com>

pkgname=mingw32-v8
pkgver=3.7.0.1
pkgrel=1
pkgdesc='A fast and modern javascript engine (mingw32)'
arch=('i686' 'x86_64')
url='http://code.google.com/p/v8'
license=('BSD')
depends=('mingw32-runtime')
makedepends=('subversion' 'scons')
options=( '!strip' )

build() {
  _source="http://v8.googlecode.com/svn/tags/$pkgver"
  svn checkout "$_source" "$srcdir/$pkgname-$pkgver"

  cd "${srcdir}/${pkgname}-${pkgver}"

  # Use ws2spi.h instead of wspiapi.h (mingw32 can't provide it)
  sed -e 's/wspiapi.h/ws2spi.h/' -i src/win32-headers.h

  # setup environment
  unset CXXFLAGS
  export CXX=i486-mingw32-g++ RANLIB=i486-mingw32-ranlib AR=i486-mingw32-ar

  scons mode=release library=static arch=ia32 os=win32
# scons d8 arch=ia32 os=win32
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  find include -type f \
    -exec install -Dm644 {} $pkgdir/usr/i486-mingw32/{} \;
  rm -rf $pkgdir/usr/include/.svn

  install -Dm755 libv8.a "$pkgdir/usr/i486-mingw32/lib/libv8.a"
# install -Dm755 d8 "$pkgdir/usr/i486-mingw32/bin/d8"
}
