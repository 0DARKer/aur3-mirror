# Maintainer: gandalf3 <zzyxpaw@gmail.com>

pkgname=enigma-dev-git
pkgver=0.0.0
pkgrel=1
pkgdesc="ENIGMA, the Extensible Non-Interpreted Game Maker Augmentation."
url="http://enigma-dev.org"
arch=('x86_64' 'i686')
license=('GPL')
depends=('alure' 'zlib' 'openal' 'libx11' 'libgl' 'mesa' 'gtk2' 'dumb' 'java-runtime') # gcc also a dependency, but in base-devel.
optdepends=()
makedepends=('git' 'python')
conflicts=('lateralgm')
provides=('lateralgm')
replaces=()
backup=()
# install='enigma-dev-git.install'
source=('lateralgm' 'lateralgm.desktop' 'git://github.com/enigma-dev/enigma-dev.git' 'http://enigma-dev.org/docs/wiki/images/4/47/Lateralgmlogo.png') # putting the git url in here causes the python configuration to fail for some reason..
md5sums=('48573826632c979dfae41e0a272a47d9' 'd4894261248f2657614a177cd1a94bc3' 'SKIP' 'e6daacba04f0491b256f8a4d2cc9181a')

build() {
  cd "${srcdir}/enigma-dev"
  msg "Starting python config.."
  python install.py
  cd "${srcdir}/enigma-dev/ENIGMAsystem/SHELL/"
  msg "Starting compile.."
  cd "${srcdir}/enigma-dev"
  make
  }
  
pkgver () {
  cd "${srcdir}/enigma-dev"
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
  }

package() {
  mkdir "${pkgdir}/opt/"
  install -Dm644 "${srcdir}/enigma-dev/pluginsource/COPYING" "$pkgdir/usr/share/licenses/$pkgname/COPYING"
  sed -i 's/enigma/enigma-dev-git/g' "${srcdir}/enigma-dev/packages/linux/usr/bin/enigma-dev"
  cp -r -a "${srcdir}/enigma-dev/packages/linux/usr/share" "${pkgdir}/usr"
  cp -r -a "${srcdir}/enigma-dev/packages/linux/usr/bin" "${pkgdir}/usr/bin"
  cp -r -a "${srcdir}/enigma-dev" "${pkgdir}/opt/${pkgname}"
  chmod -R 777 "${pkgdir}/opt/${pkgname}"
  cd "${pkgdir}/usr/bin/"
  install -D "${srcdir}/lateralgm" "${pkgdir}/usr/bin/lateralgm"
  chmod +x "${pkgdir}/usr/bin/lateralgm"
  chmod +x "${pkgdir}/usr/bin/enigma-dev"
  install -D "${srcdir}/lateralgm.desktop" "${pkgdir}/usr/share/applications/lateralgm.desktop"
  install -D "${srcdir}/Lateralgmlogo.png" ${pkgdir}/usr/share/icons/hicolor/128x128/apps/lateralgm.png
  install -D "${pkgdir}/usr/share/pixmaps/enigma-dev.svg" "${pkgdir}/usr/share/icons/hicolor/scalable/apps/enigma-dev.svg"
# remove some extra stuff to help reduce package size; more of this is may be possible.
  rm -rf "${pkgdir}/usr/share/${pkgname}/packages"
#   msg "important! read the following.."
#   echo "you must give /opt/enigma-dev-git r-w permissions.. run
#   
# chmod -R 777 /opt/enigma-dev-git
# 
# to give it rwx permissions."
}

# vim:set ts=2 sw=2 et:
