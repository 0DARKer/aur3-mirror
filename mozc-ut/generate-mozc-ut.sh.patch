diff -uNr mozcdic-ut-20130516.orig/edict-katakanago/generate-katakanago.sh mozcdic-ut-20130516/edict-katakanago/generate-katakanago.sh
--- mozcdic-ut-20130516.orig/edict-katakanago/generate-katakanago.sh	2013-05-15 22:40:18.000000000 +0900
+++ mozcdic-ut-20130516/edict-katakanago/generate-katakanago.sh	2013-05-16 14:20:41.293741677 +0900
@@ -2,14 +2,12 @@
 
 rm -f edict*
 
-# get edict
-wget http://ftp.monash.edu.au/pub/nihongo/edict.gz
-gzip -d edict.gz
+ln -sf ../../edict-${DICVER} edict
 
-ruby 01-* edict
-ruby 02-* edict.utf8
-ruby remove-duplicates.rb edict.utf8.kata
+ruby -Ku 01-* edict || exit 1
+ruby -Ku 02-* edict.utf8 || exit 1
+ruby -Ku remove-duplicates.rb edict.utf8.kata || exit 1
 
 cat ../mozcdic_all.txt edict.utf8.kata.r > edict.kata
 
-ruby 03-* edict.kata
+ruby -Ku 03-* edict.kata || exit 1
diff -uNr mozcdic-ut-20130516.orig/generate-mozc-ut.sh mozcdic-ut-20130516/generate-mozc-ut.sh
--- mozcdic-ut-20130516.orig/generate-mozc-ut.sh	2013-05-15 22:40:18.000000000 +0900
+++ mozcdic-ut-20130516/generate-mozc-ut.sh	2013-05-16 14:20:52.923827551 +0900
@@ -20,12 +20,8 @@
 rm -f ut-*.txt*
 rm -f */*.txt.r
 
-rm -f chimei/*.CSV
-rm -f chimei/*.zip
 rm -f chimei/chimei.txt
-rm -f chimei/gen_zip_code_seed.py
 
-rm -rf ../mozc-$MOZCVER/
 rm -rf ../mozc-ut-$MOZCVER.$DICVER/
 
 
@@ -34,18 +30,11 @@
 # generate the mozc-ut dictionary
 ##################################################
 
-# unpack official mozc
-echo "unpack official mozc..."
-
-cd ..
-tar jxf mozc-$MOZCVER.tar.bz2
-cd -
-
 # get official mozcdic
 cat ../mozc-$MOZCVER/data/dictionary_oss/dictionary*.txt > mozcdic_all.txt
 
 # get mozcdic costlist
-ruby 32-* mozcdic_all.txt
+ruby -Ku 32-* mozcdic_all.txt || exit 1
 mv mozcdic_all.txt.cost costlist
 
 # get hinsi ID
@@ -53,22 +42,10 @@
 
 
 
-# generate zip code dic
-echo "generate zip code dic..."
-cd chimei/
-wget http://www.post.japanpost.jp/zipcode/dl/kogaki/zip/ken_all.zip
-wget http://www.post.japanpost.jp/zipcode/dl/jigyosyo/zip/jigyosyo.zip
-unzip ken_all.zip
-unzip jigyosyo.zip
-cp ../../mozc-$MOZCVER/dictionary/gen_zip_code_seed.py .
-python gen_zip_code_seed.py --zip_code=KEN_ALL.CSV --jigyosyo=JIGYOSYO.CSV >> \
-../../mozc-$MOZCVER/data/dictionary_oss/dictionary09.txt
-cd -
-
 # generate chimei.txt
 echo "generate chimei.txt..."
 cd chimei/
-ruby get-entries.rb KEN_ALL.CSV
+ruby -Ku get-entries.rb ../../KEN_ALL.CSV || exit 1
 cd -
 
 
@@ -77,16 +54,16 @@
 echo "check major ut dictionaries..."
 
 # ruby 12-* dicfile min_hits
-ruby 12-* altcanna/altcanna.txt 300
-ruby 12-* jinmei/jinmei.txt 20
-ruby 12-* ekimei/ekimei.txt 300
-ruby 12-* chimei/chimei.txt 300
+ruby -Ku 12-* altcanna/altcanna.txt 300 || exit 1
+ruby -Ku 12-* jinmei/jinmei.txt 20 || exit 1
+ruby -Ku 12-* ekimei/ekimei.txt 300 || exit 1
+ruby -Ku 12-* chimei/chimei.txt 300 || exit 1
 
 cat altcanna/altcanna.txt.r jinmei/jinmei.txt.r ekimei/ekimei.txt.r \
 chimei/chimei.txt.r > ut-dic1.txt
 
-ruby 44-* mozcdic_all.txt ut-dic1.txt
-ruby 36-* ut-dic1.txt.yomihyouki
+ruby -Ku 44-* mozcdic_all.txt ut-dic1.txt || exit 1
+ruby -Ku 36-* ut-dic1.txt.yomihyouki || exit 1
 
 cat ut-dic1.txt.yomihyouki.cost mozcdic_all.txt > mozcdic_all.txt.utmajor
 
@@ -95,47 +72,51 @@
 # check minor ut dictionaries
 echo "check minor ut dictionaries..."
 
-ruby 12-* skk/skk.txt 300
-ruby 12-* edict/edict.txt 300
-ruby 12-* hatena/hatena.txt 300
+ruby -Ku 12-* skk/skk.txt 300 || exit 1
+[[ "$EDICT" == "yes" ]] && { ruby -Ku 12-* edict/edict.txt 300 || exit 1; }
+ruby -Ku 12-* hatena/hatena.txt 300 || exit 1
 
-if [ $NICODIC = "true" ]
+if [[ "$NICODIC" == "true" ]]
 then
-	ruby 12-* niconico/niconico.txt 300
+	ruby -Ku 12-* niconico/niconico.txt 300 || exit 1
 fi
 
 
 
-cat skk/skk.txt.r edict/edict.txt.r hatena/hatena.txt.r > ut-dic2.txt
+[[ "$EDICT" == "yes" ]] && EDICT_TXT_R="edict/edict.txt.r"
+cat skk/skk.txt.r $EDICT_TXT_R hatena/hatena.txt.r > ut-dic2.txt
 
-if [ $NICODIC = "true" ]
+if [[ "$NICODIC" == "true" ]]
 then
 	cat niconico/niconico.txt.r ut-dic2.txt > ut-dic2.txt.new
 	mv ut-dic2.txt.new ut-dic2.txt
 fi
 
-ruby 42-* mozcdic_all.txt.utmajor ut-dic2.txt
-ruby 40-* mozcdic_all.txt.utmajor ut-dic2.txt.yomi
-ruby 36-* ut-dic2.txt.yomi.hyouki
+ruby -Ku 42-* mozcdic_all.txt.utmajor ut-dic2.txt || exit 1
+ruby -Ku 40-* mozcdic_all.txt.utmajor ut-dic2.txt.yomi || exit 1
+ruby -Ku 36-* ut-dic2.txt.yomi.hyouki || exit 1
 
 
 
+if [[ "$EDICT" == "yes" ]]; then
 # generate katakana-eigo entries
 echo "generate katakana-eigo entries..."
 
 cd edict-katakanago/
-sh generate-katakanago.sh
+sh generate-katakanago.sh || exit 1
 cd -
 
+EDICT_KATA_COST="edict-katakanago/edict.kata.cost"
+fi
 
 
 # add yomigana ba
 # 「べーとーべん」から「ベートーヴェン」に変換できるようにする
 echo "generate babibubebo from vavivuvevo..."
 
-cat *.cost mozcdic_all.txt edict-katakanago/edict.kata.cost > ut-check-va.txt
-ruby 60-* ut-check-va.txt
-ruby 62-* ut-check-va.txt.va
+cat *.cost mozcdic_all.txt $EDICT_KATA_COST > ut-check-va.txt
+ruby -Ku 60-* ut-check-va.txt || exit 1
+ruby -Ku 62-* ut-check-va.txt.va || exit 1
 
 
 
@@ -144,7 +125,7 @@
 ##################################################
 
 # install mozcdic-ut
-cat *.cost edict-katakanago/edict.kata.cost *.va.to_ba > dictionary-ut.txt
+cat *.cost $EDICT_KATA_COST *.va.to_ba > dictionary-ut.txt
 cat dictionary-ut.txt ../mozc-$MOZCVER/data/dictionary_oss/dictionary00.txt > dictionary00.txt
 mv dictionary00.txt ../mozc-$MOZCVER/data/dictionary_oss/
 
@@ -158,8 +139,10 @@
 cp altcanna/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/altcanna
 mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/chimei
 cp chimei/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/chimei
+if [[ "$EDICT" == "yes" ]]; then
 mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/edict
 cp edict/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/edict
+fi
 mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/ekimei
 cp ekimei/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/ekimei
 mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/hatena
@@ -169,7 +152,7 @@
 mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/skk
 cp skk/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/skk
 
-if [ $NICODIC = "true" ]
+if [[ "$NICODIC" == "true" ]]
 then
 	mkdir -p ../mozc-$MOZCVER/doc-ut/dictionary/niconico
 	cp niconico/doc/* ../mozc-$MOZCVER/doc-ut/dictionary/niconico
@@ -180,17 +163,6 @@
 cp README ../mozc-$MOZCVER/doc-ut/
 cp ChangeLog ../mozc-$MOZCVER/doc-ut/
 
-# debian/rules
-cp -r debian/ ../mozc-$MOZCVER/
-
-# get the latest protobuf
-cd ../mozc-$MOZCVER/
-wget http://protobuf.googlecode.com/files/protobuf-2.5.0.tar.bz2
-tar xf protobuf-2.5.0.tar.bz2
-mv protobuf-2.5.0 protobuf/files
-rm -f protobuf-2.5.0.tar.bz2
-cd -
-
 # rename mozc dir to mozc-ut
 cd ..
 mv mozc-$MOZCVER mozc-ut-$MOZCVER.$DICVER
