# Maintainer: SÃ©bastien Luttringer <seblu@aur.archlinux.org>
# Contributor: Tsekhovoy Eugene aka Krash <8552246@gmail.com>

pkgname=mc-git
pkgver=20110803
pkgrel=1
pkgdesc="GNU Midnight Commander is a s-lang based file manager"
url="http://midnight-commander.org/"
arch=('i686' 'x86_64')
license=('GPL')
depends=('glib2' 'slang' 'perl')
makedepends=('git' 'cvs')
conflicts=('mc' 'mc-cvs' 'mc-fork-svn' 'mc-mp' 'mc-slavz' 'mc-suse')
provides=('mc')

_gitroot="http://midnight-commander.org/git/mc.git"
_gitname="mc"

build() {
    cd ${srcdir}

    msg "Connecting to the git repository..."
    if [ -d ${srcdir}/${_gitname} ]; then
        cd ${_gitname}
        git pull -v origin
    else
        git clone -v "${_gitroot}"
    fi
    msg "GIT checkout done or server timeout"

    rm -rf ${srcdir}/${_gitname}-build
    cp -r  ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
    cd ${srcdir}/${_gitname}-build

    ./autogen.sh

    export MCREVISION="$(git describe --tags)"

    msg "Configuring..."
    ./configure                     \
        --prefix=/usr               \
        --sysconfdir=/etc           \
        --libexecdir=/usr/lib       \
        --enable-background         \
        --enable-network            \
        --enable-netcode            \
        --enable-charset            \
        --enable-nls                \
        --with-vfs                  \
        --with-edit                 \
        --with-screen=slang         \
        --without-x                 \
        --without-samba             \
        --without-gpm-mouse         \
        --without-gnome             \
        --without-debug             \
        --without-included-gettext  \
        --disable-dependency-tracking

    msg "Starting make..."
    make || return 1
    make DESTDIR=${pkgdir} install || return 1
}

# vim:set ts=2 sw=2 ft=sh et:
