# Contributor: Georgios N. Tsalikis <aliverius@tsalikis.net>

pkgname=directfb-multi
pkgver=1.4.11
pkgrel=2
pkgdesc="The multi-application capable build of the DirectFB hardware graphics-acceleration system."
arch=('i686' 'x86_64')
url="http://www.directfb.org"
license=('LGPL2')
#groups=('directfb')
depends=('linux-fusion>=8.2.0' 'xorg-server' 'freetype2' 'libjpeg'  'libtiff' 'sysfsutils' 'libpng')
provides=('directfb=$pkgver')
replaces=('directfb')
options=(!libtool)
source=(http://www.directfb.org/downloads/Core/DirectFB-1.4/DirectFB-$pkgver.tar.gz)
install=directfb.install
md5sums=('94735ccec21120794adcce93a61445d2')

build() {
  cd $startdir/src/DirectFB-$pkgver

  # CFLAGS are redefined here in order to avoid overriding the default optimizations (lots of -O3). 
  if [ "${CARCH}" = "i686" ]; then
  CFLAGS="-march=i686 -mtune=generic -pipe" ./configure  \
	--prefix=/usr --sysconfdir=/etc --enable-multi \
  	--enable-static --enable-fbdev --enable-x11 --disable-sdl --disable-osx	 \
	--enable-unique --enable-zlib --enable-video4linux2 --with-tests
  fi

  if [ "${CARCH}" = "x86_64" ]; then
  CFLAGS="-march=x86-64 -mtune=generic -pipe" ./configure  \
	--prefix=/usr --sysconfdir=/etc --enable-multi \
  	--enable-static --enable-fbdev --enable-x11 --disable-sdl --disable-osx	 \
	--enable-unique --enable-zlib --enable-video4linux2 --with-tests
  fi

  make  || return 1
  make -j1 DESTDIR=$startdir/pkg install || return 1
  
  install -D -m644 $startdir/85-directfb.rules $startdir/pkg/etc/udev/rules.d/85-directfb.rules
} 
