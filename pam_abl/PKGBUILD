## Contributor: quantax -- contact via Arch Linux forum or AUR
## Contributor: Michal Krenek <mikos@sg1.cz>
## Contributor: redden0t8 -- contact via Arch Linux forums or AUR

pkgname=pam_abl
pkgver=0.5.0
pkgrel=2
pkgdesc="Automated blacklisting on repeated failed authentication attempts"
arch=('i686' 'x86_64')
url="http://pam-abl.sourceforge.net/"
license=('GPL')
depends=(db pam)
makedepends=(asciidoc cmake)
source=(http://downloads.sourceforge.net/pam-abl/pam-abl-$pkgver.tar.gz)
md5sums=('cec987b2747c9b7bce75b77aa7f5fe84')
install="pam_abl.install"

build() {
	cd "$srcdir/pam-abl"

	# fix a binary naming issue
	# (names do not agree with previous releases or manpages)
	sed -i "s/pam-abl/pam_abl/g" CMakeLists.txt

	# configure
	cmake . -DCMAKE_INSTALL_PREFIX=/usr

	# build binaries
	make || return 1

	# generate documentation
	cd doc
	sh generate.sh
	cd ..

	# install binaries
	make install DESTDIR="$pkgdir/"

	# install example configuration
	install --mode=0644 -D -- conf/pam_abl.conf \
					"$pkgdir/etc/security/pam_abl.conf.example"

	#install documentation
	install --mode=0644 -D -- doc/pam_abl.1 \
		            "$pkgdir/usr/share/man/man1/pam_abl.1"
	install --mode=0644 -D -- doc/pam_abl.8 \
		            "$pkgdir/usr/share/man/man8/pam_abl.8"
	install --mode=0644 -D -- doc/pam_abl.conf.5 \
		            "$pkgdir/usr/share/man/man5/pam_abl.conf.5"
}

