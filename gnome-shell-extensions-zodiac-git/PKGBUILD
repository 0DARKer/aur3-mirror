#Contributor: Miguel Aguilar <zodiac_es@yahoo.es>

pkgbase=gnome-shell-extensions-zodiac-git
pkgver=20110625
pkgrel=4
arch=(any)

depends=('gnome-shell' 'gtk3')
url="http://github.com/zodiac66/shell-extensions-zodiac"
license=(GPL2)

makedepends=('intltool' 'gnome-doc-utils' 'git' 'gnome-common')

pkgname=(gnome-shell-extensions-zodiac-common-git
         gnome-shell-extension-zodiac-activitiesbutton-git
         gnome-shell-extension-zodiac-autohidetopbar-git
         gnome-shell-extension-zodiac-autohidedock-git
         gnome-shell-extension-zodiac-icon-manager-git
         gnome-shell-extension-zodiac-moveclock-git
         gnome-shell-extensions-zodiac-git)

provides=(gnome-shell-extensions-zodiac-common-git
         gnome-shell-extension-zodiac-activitiesbutton-git
         gnome-shell-extension-zodiac-autohidetopbar-git
         gnome-shell-extension-zodiac-autohidedock-git
         gnome-shell-extension-zodiac-icon-manager-git
         gnome-shell-extension-zodiac-moveclock-git
         gnome-shell-extensions-zodiac-git)

#conflicts=("gnome-shell-extension-activities-button"
#	   "gnome-shell-extension-noa11y"
#	   "gnome-shell-extension-autohide-topbar"
#	   "gnome-shell-frippery")

_gitroot="git://github.com/zodiac66/shell-extensions-zodiac"
_gitname="shell-extensions-zodiac"

install=shell-extensions-zodiac-git.install
options=(!libtool !emptydirs)

#PKGBUILD specific functions

_enabled_extensions="activitiesbutton autohidetopbar autohidedock icon-manager moveclock"

build() {

    cd ${srcdir}/

    msg "Connecting to the GIT server..."
    if [[ -d ${srcdir}/${_gitname} ]] ; then
    	cd ${_gitname}
    	git pull origin
    	msg "The local files are updated..."
    else
    	git clone ${_gitroot} ${_gitname}
    fi

    msg "GIT checkout done."

    msg2 "Starting make for: ${pkgname}"

    if [[ -d ${srcdir}/${_gitname}-build ]]; then
       msg "Cleaning the previous build directory..."
       rm -rf ${srcdir}/${_gitname}-build
    fi

    git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build

    cd ${srcdir}/${_gitname}-build

    msg "Starting configure..."
    # sed -i -e "s|3.0.1|3.0.2|" configure.ac
    ./autogen.sh --prefix=/usr --disable-schemas-compile --enable-extensions="${_enabled_extensions}"
    make
}



package_gnome-shell-extensions-zodiac-common-git() {
  pkgdesc="Zodiac Extensions for GNOME Shell - common files"
  depends=(gnome-shell)
  groups=('shell-extensions-zodiac-git')
  ######################################################################
  # As AUR does not support "splitted PKGBUILD" includes the           #
  # empty package gnome-shell-extensions-zodiac-git to avoid problems  #
  # on upgrades                                                        #
  ######################################################################
  provides=(gnome-shell-extensions-zodiac-common-git \
            gnome-shell-extensions-zodiac-git)  
  pkgname=gnome-shell-extensions-zodiac-common-git

  cd "${srcdir}/${_gitname}-build/po"
  make DESTDIR="$pkgdir" install
}

package_gnome-shell-extension-zodiac-activitiesbutton-git() {
  pkgdesc="Change look of Activities button area"
  depends=(gnome-shell-extensions-zodiac-common-git)
  groups=('shell-extensions-zodiac-git')
  provides=(gnome-shell-extension-zodiac-activitiesbutton-git)
  pkgname=gnome-shell-extension-zodiac-activitiesbutton-git

  cd "${srcdir}/${_gitname}-build/extensions/activitiesbutton"
  make DESTDIR="$pkgdir" install
}


package_gnome-shell-extension-zodiac-autohidetopbar-git() {
  pkgdesc="Autohide top panel"
  depends=(gnome-shell-extensions-zodiac-common-git)
  groups=('shell-extensions-zodiac-git')
  provides=(gnome-shell-extension-zodiac-autohidetopbar-git)
  pkgname=gnome-shell-extension-zodiac-autohidetopbar-git

  cd "${srcdir}/${_gitname}-build/extensions/autohidetopbar"
  make DESTDIR="$pkgdir" install
}

package_gnome-shell-extension-zodiac-autohidedock-git() {
  pkgdesc="A dock autohide for the GNOME Shell"
  depends=(gnome-shell-extensions-zodiac-common-git)
  groups=('shell-extensions-zodiac-git')
  provides=(gnome-shell-extension-zodiac-autohidedock-git)
  pkgname=gnome-shell-extension-zodiac-autohidedock-git

  cd "${srcdir}/${_gitname}-build/extensions/autohidedock"
  make DESTDIR="$pkgdir" install
}


package_gnome-shell-extension-zodiac-icon-manager-git() {
  pkgdesc="Add/remove icons from top bar panel by simple editing dconf settings"
  depends=(gnome-shell-extensions-zodiac-common-git)
  groups=('shell-extensions-zodiac-git')
  provides=(gnome-shell-extension-zodiac-icon-manager-git)
  pkgname=gnome-shell-extension-zodiac-icon-manager-git

  cd "${srcdir}/${_gitname}-build/extensions/icon-manager"
  make DESTDIR="$pkgdir" install
}

package_gnome-shell-extension-zodiac-moveclock-git() {
  pkgdesc="Move clock in panel"
  depends=(gnome-shell-extensions-zodiac-common-git)
  groups=('shell-extensions-zodiac-git')
  provides=(gnome-shell-extension-zodiac-moveclock-git)
  pkgname=gnome-shell-extension-zodiac-moveclock-git

  cd "${srcdir}/${_gitname}-build/extensions/moveclock"
  make DESTDIR="$pkgdir" install
}

package_gnome-shell-extensions-zodiac-git() {
  pkgdesc="Zodiac Extensions for GNOME Shell - activitiesbutton, autohidetopbar, autohidedock, icon-manager, moveclock"
  depends=(gnome-shell)
  #depends=(gnome-shell-extension-zodiac-activitiesbutton-git gnome-shell-extension-zodiac-autohidetopbar-git gnome-shell-extension-zodiac-autohidedock-git gnome-shell-extension-zodiac-icon-manager-git gnome-shell-extension-zodiac-moveclock-git)
  provides=(gnome-shell-extensions-zodiac-git)
  pkgname=gnome-shell-extensions-zodiac-git
}
