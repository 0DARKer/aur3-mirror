# Maintainer: Dan Serban
# Contributors: Charles Ghislain, Guillaume ALAUX, Daniel J Griffiths, Jason Chu, Geoffroy Carrier, Army, kfgz, Thomas Dziedzic

pkgname=jdk
pkgver=7
pkgrel=1
pkgdesc="The Java Development Kit"
url=http://www.oracle.com/technetwork/java/javase/downloads/index.html
arch=(i686 x86_64)
license=(custom)
depends=(jre)
makedepends=(lynx)
provides=('java-environment=7')
conflicts=(java-environment)
install=jdk.install
source=('java-monitoring-and-management-console.desktop'
        'java-visualvm.desktop'
        'jdk.profile'
        'jdk.profile.csh'
        'derby-network-server'
        'derby-network-server.conf'
        'javaws-launcher')
md5sums=('81cf9b716263ba85f0528d3357dccb75'
         'ef27c6d4062f2f97c532a9e893b6adbe'
         'b83ab5742651b4234b7d2e20785c6693'
         '6f4cbf332816d2c4e9578ecd1d0dce7f'
         'a279e195e249000646895d93e199860d'
         '4bdff6982c66d24a879c424aaac3d04d'
         '45c15a6b4767288f2f745598455ea2bf')
_arch=i586
[ "${CARCH}" == "x86_64" ] && _arch=x64

package()
{
  rm jdk.tar.gz 2>/dev/null || true
  _url=$(lynx -dump http://www.oracle.com/technetwork/java/javase/downloads/index.html | grep -o http.*downloads/jdk-7u[0-9]*-download.*html | head -1)
  _url=$(wget -qO - ${_url} | grep -o http.*-linux-${_arch}.tar.gz)
  wget -O jdk.tar.gz "${_url}"
  msg "Extracting..."
  bsdtar -xf jdk.tar.gz
  msg "Packaging..."
  install -Dm644 jdk1.7.0_*/jre/lib/desktop/icons/hicolor/48x48/apps/sun-java.png "${pkgdir}"/usr/share/pixmaps/java.png
  mkdir -p "${pkgdir}"/opt
  mv jdk1.7.0_* "${pkgdir}"/opt/java
  rm -r "${pkgdir}"/opt/java/jre
  find "${pkgdir}"/opt/java -name '*\.bat' -delete
  rm -r "${pkgdir}"/opt/java/lib/desktop
  install -D "${startdir}"/jdk.profile "${pkgdir}"/etc/profile.d/jdk.sh
  install -D "${startdir}"/jdk.profile.csh "${pkgdir}"/etc/profile.d/jdk.csh
  mkdir -p "${pkgdir}"/usr/share/licenses/jdk
  install -Dm644 "${pkgdir}"/opt/java/COPYRIGHT "${pkgdir}"/usr/share/licenses/jdk/COPYRIGHT
  install -Dm644 "${pkgdir}"/opt/java/LICENSE "${pkgdir}"/usr/share/licenses/jdk/LICENSE
  install -Dm644 "${pkgdir}"/opt/java/THIRDPARTYLICENSEREADME.txt "${pkgdir}"/usr/share/licenses/jdk/THIRDPARTYLICENSEREADME.txt
  mkdir -p "${pkgdir}"/usr/share/applications
  install -Dm644 "${startdir}"/java-monitoring-and-management-console.desktop "${pkgdir}"/usr/share/applications/java-monitoring-and-management-console.desktop
  install -Dm644 "${startdir}"/java-visualvm.desktop "${pkgdir}"/usr/share/applications/java-visualvm.desktop
  install -D "${startdir}"/derby-network-server "${pkgdir}"/etc/rc.d/derby-network-server
  install -Dm644 "${startdir}"/derby-network-server.conf "${pkgdir}"/etc/conf.d/derby-network-server
}

