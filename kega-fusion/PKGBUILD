# Maintainer: TryA <tryagainprod@gmail.com>

pkgname=kega-fusion
pkgver=3.63
pkgrel=13
pkgdesc="An emulator of classic Sega consoles, including SMS/GG, Genesis/Megadrive and add-ons"
url="http://www.eidolons-inn.net/tiki-index.php?page=Kega"
license=('unknown')
arch=('i686' 'x86_64')
if [ "${CARCH}" == "x86_64" ]; then
  depends=('lib32-alsa-lib' 'lib32-mesa' 'lib32-gtk2' 'lib32-xcb-util')
else
  depends=('alsa-lib' 'mesa' 'gtk2' 'xcb-util') 
fi
makedepends=('upx')
optdepends=('lib32-gtk-engines: libclearlooks.so library'
            'lib32-bug-buddy: libgnomebreakpad.so library')
install="kega-fusion.install"
source=("Fusion363x.tar.gz"::"http://www.eidolons-inn.net/tiki-download_file.php?fileId=572"
        "Plugins(Linux).tar.gz"::"http://www.eidolons-inn.net/tiki-download_file.php?fileId=568"
        "http://trya.alwaysdata.net/linux/libmpg123.so.0.11.4.gz"
        "http://trya.alwaysdata.net/linux/icons/kega-fusion.png"
        kega-fusion.sh kega-fusion.desktop Fusion.ini)
md5sums=('9a6f93c2f3bd48ef09a9170e7f0512f4'
         '6121a37c42026da032386d9d5a5e9c42'
         '6e9516000e527e025ad9de0b15573a87'
         '1fdaacf18fb2965fb6f64a769037056b'
         '40ec19e8064c4859d62f882a03ec87c3'
         '5ecf6ba3ef1eff460ee659ef7b6e78db'
         '6d744c098bdf2085fe144ffd2794fe6d')
options=(!strip)

build() {
  # plugins
  mkdir -p ${pkgdir}/usr/lib/kega-fusion/plugins
  cp ${srcdir}/Plugins/*.rpi ${pkgdir}/usr/lib/kega-fusion/plugins
  cp ${srcdir}/libmpg123.so.0.11.4 ${pkgdir}/usr/lib/kega-fusion
  
  # default configuration and documentation
  mkdir -p ${pkgdir}/usr/share/kega-fusion
  mkdir -p ${pkgdir}/usr/share/doc/kega-fusion
  cp ${srcdir}/Fusion.ini ${pkgdir}/usr/share/kega-fusion
  cp ${srcdir}/Fusion/*.txt ${pkgdir}/usr/share/doc/kega-fusion
  
  # startup script and executable
  install -Dm755 ${srcdir}/kega-fusion.sh ${pkgdir}/usr/bin/kega-fusion
  upx -d ${srcdir}/Fusion/Fusion
  install -Dm755 ${srcdir}/Fusion/Fusion ${pkgdir}/usr/share/kega-fusion/kega-fusion
  
  # desktop icon
  install -Dm644 ${srcdir}/kega-fusion.desktop ${pkgdir}/usr/share/applications/kega-fusion.desktop
  install -Dm644 ${srcdir}/kega-fusion.png ${pkgdir}/usr/share/pixmaps/kega-fusion.png
}
