# Maintainer: goll <adrian.goll+aur[at]gmail>

pkgname='sslyze'
pkgver=0.9
pkgrel=1
pkgdesc="Fast and full-featured SSL scanner."
arch=('i686' 'x86_64')
url=('https://github.com/iSECPartners/sslyze')
license=('GPLv2')
depends=('python2')
makedepends=('unzip')
noextract=('sslyze-0_9-linux64.zip'
	   'sslyze-0_9-linux32.zip')

source=("https://github.com/iSECPartners/sslyze/releases/download/release-${pkgver}/${pkgname}-${pkgver/./_}-linux64.zip"
        "https://github.com/iSECPartners/sslyze/releases/download/release-${pkgver}/${pkgname}-${pkgver/./_}-linux32.zip")

sha1sums=('01d9fbfde4642353dae91da91a35523f3401a718'
          'e402db269e68402a449175db18e662615bd5e067')

prepare() {
        if test "$CARCH" == x86_64;then
		cd $srcdir && unzip -qqo ${pkgname}-${pkgver/./_}-linux64.zip
	else
		cd $srcdir && unzip -qqo ${pkgname}-${pkgver/./_}-linux32.zip
	fi
}

package() {
	# Install files in /opt
        mkdir -p "$pkgdir/opt/sslyze"
        if test "$CARCH" == x86_64;then
		cp -a $srcdir/${pkgname}-${pkgver/./_}-linux64/. $pkgdir/opt/sslyze
		rm -rf $srcdir/${pkgname}-${pkgver/./_}-linux64/
	else
		cp -a $srcdir/${pkgname}-${pkgver/./_}-linux32/. $pkgdir/opt/sslyze
		rm -rf $srcdir/${pkgname}-${pkgver/./_}-linux32/
	fi
	grep -rl "env python" $pkgdir/opt/sslyze | xargs sed -i 's/env python/env python2/g'
	# Create an indirect launcher in /usr/bin
	mkdir -p "$pkgdir/usr/bin"

	cat > "$pkgdir/usr/bin/sslyze" << EOF
#!/bin/bash
cd /opt/sslyze && python2 sslyze.py \$@
cd \$OLDPWD
EOF
	chmod 755 "$pkgdir/usr/bin/sslyze"
}
