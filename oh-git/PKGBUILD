 
# Maintainer: Jens Staal <staal1978@gmail.com>

pkgname=oh-git
# Shell formerly known as "gosh"
pkgver=20110625
pkgrel=2
pkgdesc="A Plan9 rc-inspired UNIX shell written in Go"
arch=('i686' 'x86_64')
url="https://github.com/michaelmacinnis/oh#readme"
license=('MIT')
depends=('go-tecla-git' 'libtecla' 'go')
provides=('oh')
install=('oh.install')
makedepends=('git')
source=('main.patch')
md5sums=('b88d277f3e719127f9a6525f281fd334')

_gitroot=('git://github.com/michaelmacinnis/oh.git')
_gitname=('oh')

 if [ ${CARCH}=x86_64 ]
    then
     _arch="amd64"
   else
     _arch="i386"
 fi

build() {
 cd $srcdir

msg "getting oh sources"
   if [ -d $_gitname ] ; then
    cd $_gitname && git pull $_gitroot
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

msg "setting up build directory"
  rm -rf $srcdir/build
  cp -ar $srcdir/$_gitname $srcdir/build
  cd $srcdir/build
  patch main.go -i $srcdir/main.patch
  make
}

package() {
 mkdir -p $pkgdir/usr/bin
 cd $srcdir/build
 export CGO_CFLAGS=-I/usr/local/lib -I/usr/lib/go/pkg/linux_$_arch
 export CGO_LDFLAGS=-ltecla -lcurses
 make pkgdir="$pkgdir/usr" install
 export pkgdir=$srcdir/pkg
 mkdir -p $pkgdir/usr/share/licenses/oh
 install -m644 $srcdir/oh/LICENSE $pkgdir/usr/share/licenses/oh/LICENSE
}
