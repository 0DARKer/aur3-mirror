# Maintainer: qs9rx < that nick at enjoys dÃ¶t it>
pkgname=darkplaces-svn
pkgver=11854
pkgrel=1
pkgdesc="An advanced Quake 1 game engine. SVN version"
arch=('i686' 'x86_64')
url="http://icculus.org/twilight/darkplaces/"
license=('GPL2')
depends=('libvorbis' 'sdl' 'libxxf86vm' 'libxpm' 'alsa-lib')
optdepends=('libjpeg6')
makedepends=('subversion')
conflicts=('darkplaces')
install=$pkgname.install

_svntrunk=svn://svn.icculus.org/twilight/trunk/darkplaces
_svnmod=darkplaces

build() {
  cd "$srcdir"

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"

  msg "Homedir patch"
  cd "$srcdir/$_svnmod/"

  msg "Starting make..."
  make release
}

package() {
  mkdir -p ${pkgdir}/usr/{bin,share/licenses}
  cd "$srcdir/$_svnmod/"
  install -Dm755 darkplaces-*{sdl,glx,dedicated} ${pkgdir}/usr/bin/
  install -Dm644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
  
  for i in 16 24 32 48 64 72 ; do
    install -Dm 644 darkplaces${i}x$i.png $pkgdir/usr/share/icons/hicolor/${i}x$i/apps/darkplaces.png
  done
}
