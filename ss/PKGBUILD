# Maintainer: Ecmel Ercan <ecmel.ercan@gmail.com>
pkgname=ss
pkgver=20120121
pkgrel=1
dirname=src
epoch=
pkgdesc="A batch spreadsheet for C programmers."
arch=('i686' 'x86_64')
url="http://fog.misty.com/perry/ss/ref.html"
license=('GPL')
groups=()
depends=('gnuplot' 'netpbm' 'gcc' 'nawk')
makedepends=('unzip' 'groff')
checkdepends=()
optdepends=()
replaces=()
backup=()
changelog=
noextract=(src.zip)
source=(http://fog.misty.com/perry/ss/src.zip)
md5sums=('ca662fc74e723da538b8440558f156b2') #generate with 'makepkg -g'

build() {
  cd "$srcdir"
  unzip -q "src.zip"

  cd "$srcdir/src"
  
  msg "Changing shell to sh"
  
  for x in `find -regex ".*[.]sh$"`; do 
    line=`head -n 1 "$x" | head -c 2`; 
    if [ "$line" = '#!' ]; then 
      echo '#!/usr/bin/env sh' > "${x}-edit"; 
      tail -n +2 $x >> "${x}-edit";
      mv "${x}-edit" $x;
      chmod a+x $x;
    fi; 
  done
    
  sed -i 's/SS="\/home\/perry\/src\/ss\/ss"/SS="ss"/' SS
    
  make  
}

package() {
  cd "$srcdir/src"
  install -m 755 -D ss "$pkgdir/usr/bin/$pkgname"
  install -m 755 -D SS "$pkgdir/usr/bin/SS"
  cd "$srcdir/src/doc"
  install -d "$pkgdir/usr/share/doc/$pkgname" 
  cp *.html "$pkgdir/usr/share/doc/$pkgname/" 
  cp *.ss "$pkgdir/usr/share/doc/$pkgname/" 
  cp *.gif "$pkgdir/usr/share/doc/$pkgname/" 
  cp *.txt "$pkgdir/usr/share/doc/$pkgname/"
  cp examples.zip "$pkgdir/usr/share/doc/$pkgname/" 
}

