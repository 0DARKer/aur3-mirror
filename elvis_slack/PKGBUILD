# Contributor: Rudy Matela <rudy.matela@gmail.com>
# Based on early pkgbuild by froggie <haptikers@gmail.com>
# Date: 2008-10-24 17:36
pkgname=elvis_slack
pkgver=2.2_0
pkgrel=4
pkgdesc="A vi clone with special security features (With Slackware ``Patch'')"
depends=('glibc' 'xorg-xinit' 'ncurses' 'fontconfig' 'expat' 'freetype2' 'zlib')
source=("ftp://ftp.cs.pdx.edu/pub/elvis/elvis-$pkgver.tar.gz"
        "http://slackware.osuosl.org/slackware_source/a/elvis/elvis.clr"
        "http://slackware.osuosl.org/slackware_source/a/elvis/elvis.clr.orig"
		"getline.patch")
url="http://elvis.the-little-red-haired-girl.org/"
md5sums=('6831b8df3e4a530395e66c2889783752'
         'c47a70cb176ebf2eb99b055c4048a560'
         'a4539efb7e8fae629da375d98d3d6ae8'
         'd7517d3dad19f04d4d9a78a18e16e3d1')
arch=('i686' 'x86_64')
license=('PerlArtistic')
conflicts=('elvis')
replaces=('elvis')

build() {
  cd $startdir/src/elvis-$pkgver
  cp $startdir/elvis.clr* ./data
  patch -p0 < $startdir/getline.patch
  ./configure --prefix=/usr --without-x --without-gnome --verbose
  sed 's/\<CTAGS\>/ELVTAGS/g; s/ctags\>/elvtags/g; s/ant" elvtags/ant" ctags/' doc/ctags.man >doc/elvtags.man
  /usr/bin/make || return 1

  /bin/mkdir -p $startdir/pkg/usr/bin/
  for i in elvis ref elvtags elvfmt; do
      install -s -m755 $i $startdir/pkg/usr/bin/
  done

  cd $startdir/src/elvis-$pkgver/data/
  /bin/mkdir -p $startdir/pkg/usr/share/elvis/
  cp -r * $startdir/pkg/usr/share/elvis/

  cd $startdir/src/elvis-$pkgver/doc/
  /bin/mkdir -p $startdir/pkg/usr/man/man1/
  for i in elvis ref elvtags elvfmt; do
      mv $i.man $i.1
      gzip $i.1
      install -m644 $i.1.gz $startdir/pkg/usr/man/man1/
  done

}
