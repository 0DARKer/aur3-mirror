# Maintainer: Alexander Rødseth <rodseth@gmail.com>
pkgname=tiddlywiki
pkgver=2.6.2
pkgrel=2
pkgdesc="Personal wiki where everything is in one html-file"
arch=('i686' 'x86_64')
url="http://www.tiddlywiki.com/"
license=('BSD')
depends=('xdg-utils' 'pcre' 'gc')
makedepends=('shedskin')
source=('http://www.tiddlywiki.com/empty.html'
        'tiddlywiki.py')
md5sums=('3adc28a976845a26ed83091dca84f983'
         'a7220d1c7f6d9c6ead1222a97b40563a')

build() {
  cd "$srcdir"

  msg2 "Compiling wrapperscript..."
  shedskin $pkgname.py
  make CPPFLAGS="-march=native -fomit-frame-pointer"

  msg2 "Packaging data files..."
  mkdir -p "$pkgdir/usr/share/tiddlywiki"
  cp "$srcdir/empty.html" "$pkgdir/usr/share/tiddlywiki/"
  install -D -m 644 empty.html "$pkgdir/usr/share/tiddlywiki/empty.html"
  install -D -m 755 "$pkgname" "$pkgdir/usr/bin/$pkgname"

  msg2 "Packaging license..."
  # Extracting the license
  cat empty.html | head -38 | tail -28 > COPYING
  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}

# vim:set ts=2 sw=2 et:
