# Maintainer: Alexander Rødseth <rodseth@gmail.com>
pkgname=tiddlywiki
pkgver=2.6.1
pkgrel=1
pkgdesc="Personal wiki where everything is in one html-file"
arch=('i686' 'x86_64')
url="http://www.tiddlywiki.com/"
license=('BSD')
depends=('xdg-utils' 'pcre' 'gc' 'gcc-libs-multilib')
makedepends=('shedskin')
source=('http://www.tiddlywiki.com/empty.html'
        'tiddlywiki.py')
md5sums=('1824b920f885643000039ea314c5fc12'
         '88da8f3b9aa4e677d93fb10d69934376')

build() {
  cd "$srcdir"

  msg "Optimizing..."
  shedskin $pkgname.py || return 1
  make CPPFLAGS="-march=native -fomit-frame-pointer" || return 1

  msg "Building..."
  mkdir -p "$pkgdir/usr/share/tiddlywiki"
  cp "$srcdir/empty.html" "$pkgdir/usr/share/tiddlywiki/"
  install -D -m 644 empty.html "$pkgdir/usr/share/tiddlywiki/empty.html"
  install -D -m 755 "$pkgname" "$pkgdir/usr/bin/$pkgname"

  # Extracting the license
  cat empty.html | head -38 | tail -28 > COPYING
  install -D -m 644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}

# vim:set ts=2 sw=2 et:
