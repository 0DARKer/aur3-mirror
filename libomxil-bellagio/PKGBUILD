# Contributor: Fly-away <flyaaway@gmail.com>
pkgname=libomxil-bellagio
pkgver=0.9.3
pkgrel=3
pkgdesc="An opensource implementation of the OpenMAX Integration Layer API"
arch=('arm' 'armv7h' 'i686' 'x86_64')
url="http://omxil.sourceforge.net"
license="LGPL"
replaces=('libomxil' 'libomxil-bellagio-git')
source=("http://ignum.dl.sourceforge.net/project/omxil/omxil/Bellagio%200.9.3/libomxil-bellagio-0.9.3.tar.gz"
       libomxil-bellagio-0.9.3-fix_Werror.patch
       libomxil-bellagio-0.9.3-nodoc.patch
       libomxil-bellagio-0.9.3-unused.patch)
md5sums=('a1de827fdb75c02c84e55f740ca27cb8'
         '0696cc99f4c819999ae85b90e0067c90'
         '31f12f77b8354ceb3b08ccb668edaf2d'
         '66dfc849a628bbc47ee4dc78d6638378')

build() {
  cd ${srcdir}/${pkgname}-$pkgver
  for f in ../*.patch
  do
    patch -p1 < $f
  done

  #Avoid the use of autoreconf
  sed -i -e "s|^docdir.*|docdir=/usr/share/doc/${pkgname}|" Makefile.in
  touch -r config.h.in Makefile.am Makefile.in

  ./configure --prefix=/usr --disable-static --docdir=/usr/share/doc/${pkgname}

  # remove rpath from libtool
  sed -i.rpath 's|^hardcode_libdir_flag_spec=.*|hardcode_libdir_flag_spec=""|g' libtool
  sed -i.rpath 's|^runpath_var=LD_RUN_PATH|runpath_var=DIE_RPATH_DIE|g' libtool
  make -j1 || return 1
  make DESTDIR=${pkgdir} install
}
