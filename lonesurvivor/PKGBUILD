# Maintainer: Daniel Wallace <danielwallace at gtmanfred dot com>

pkgname=lonesurvivor
pkgver=1.11d
_pkgver=$pkgver-1
pkgrel=5
pkgdesc="a psychological survival adventure, with art, design, and music by the one-man studio"
arch=('i686' 'x86_64')
url="http://www.superflatgames.com/"
groups=("humble-indie-bundleV" "games")
license=('custom')
case $CARCH in 
    i686) depends=('gtk2' 'nss' 'libxft');;
    x86_64)depends=('lib32-gtk2' 'lib32-nss' 'lib32-curl' 'lib32-libxft');;
esac
PKGEXT='.pkg.tar'
case $CARCH in 
    i686) _arch=i386; md5sums=('c267e7b6c9a20ca40ee8e795bc92a3fa' '7520a6930d3bc2cbc62a83f0724f7dce');;
    x86_64) _arch=amd64; md5sums=('4d099e1bf1a4fdb30b8b7cff3b485d38' '7520a6930d3bc2cbc62a83f0724f7dce');;
esac
source=($pkgname-$_pkgver-$_arch.tar.gz
        $pkgname.desktop)
options=(!strip)

_humblebundle() {
    export _archive="source[0]%%:*"
    while [[ ! -f ${!_archive} ]];do
        if [[ -n "${_humblebundleVkey}" ]]; then
            _uri="$(curl -s http://www.humblebundle.com/downloads\?key\="${_humblebundleVkey}" | grep "${!_archive}")"
            _uri="${_uri##*data-web\=\'}"
            _uri="${_uri%%\'*}" 
            curl -o "${!_archive}" "${_uri}"
        else
            warning "Please export _humblebundleVkey for downloading"
            echo "Alternatively, place the download into ${startdir} and retry"
        fi
        if [[ -z "${_humblebundVkey}" && ! -f "${startdir}/${!_archive}" ]]; then
            error "Failed to download \"${!_archive}\"."
            exit 1
        fi
        unset _archive _key _uri 
    done
}


package () {
    cd $srcdir/$pkgname
    install -Dm755 "$srcdir/$pkgname/LoneSurvivor" "$pkgdir/usr/bin/$pkgname"
    install -Dm644 "$srcdir/$pkgname/LoneSurvivor.png" "$pkgdir/usr/share/applications/$pkgname.png"
    install -Dm644 "$srcdir/$pkgname.desktop" "$pkgdir/usr/share/applications/$pkgname.desktop"
}
_humblebundle
