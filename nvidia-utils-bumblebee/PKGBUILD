# Maintainer: Samsagax <samsagax@gmail.com>
# Contributor: borman <borisov.mikhail@gmail.com>

pkgname=nvidia-utils-bumblebee

_pacman_get_key()
{
  pacman --print --print-format $1 -S nvidia-utils | grep nvidia-utils
}

pkgver=280.13
pkgrel=3
pkgdesc="NVIDIA drivers utilities and libraries. Repacked and installed in different folder to be used simultaneously with libgl."
arch=('i686' 'x86_64')
url="http://www.nvidia.com/"
depends=('xorg-server' 'libxvmc' 'dkms-nvidia' 'opencl-nvidia')
optdepends=('gtk2: nvidia-settings' 'pkgconfig: nvidia-xconfig')
conflicts=()
provides=("nvidia-utils=$pkgver")
license=('custom')
install=nvidia.install
if [ "$CARCH" = "i686" ]; then
     md5sums=('bdac5fe39ce88a3c21cfc7f6185e7249')
elif [ "$CARCH" = "x86_64" ]; then
     md5sums=('436ae1f0d46520fef8460f276d6a655f')
     optdepends[${#optdepends[@]}]='lib32-nvidia-utils-bumblebee'
fi
source=$(_pacman_get_key %l)

build()
{
  cd $srcdir
  msg "Copying files..."
  cp -a usr $pkgdir || return 1
  mkdir -p $pkgdir/usr/libtemp/nvidia-bumblebee
  mv $pkgdir/usr/lib/* $pkgdir/usr/libtemp/nvidia-bumblebee/
  mv -T $pkgdir/usr/libtemp/ $pkgdir/usr/lib/
  # Dirty hack to use nvidia-smi
  cd $pkgdir/usr/lib/
  ln -s nvidia-bumblebee/libnvidia-ml.so.1
}
