# Maintainer: Samsagax <samsagax@gmail.com>
# Contributor: borman <borisov.mikhail@gmail.com>

pkgname=nvidia-utils-bumblebee

_pacman_get_key()
{
  pacman --print --print-format $1 -S nvidia-utils
}

# Find the newest version in the repository
msg "Checking for original package version"
_src_fullver=$(_pacman_get_key %v)
_src_repo=$(_pacman_get_key %r)
_src_url=$(_pacman_get_key %l)
msg "Original package version: ${_src_fullver} in ${_src_repo}"

pkgver=$(echo $_src_fullver | sed -e 's/\([0-9\.]\+\)-*\(.*\)/\1/')
pkgrel=$(echo $_src_fullver | sed -e 's/\([0-9\.]\+\)-*\(.*\)/\2/')

if false; then
  #Satisfy AUR parser
  pkgver=275.09.07
  pkgrel=1
fi

pkgdesc="NVIDIA drivers utilities and libraries. Repacked and installed in different folder to be used simultaneously with libgl."
arch=('i686' 'x86_64')
url="http://www.nvidia.com/"
depends=('xorg-server')
#optdepends=('gtk2: nvidia-settings' 'pkgconfig: nvidia-xconfig')
conflicts=()
provides=("nvidia-utils=$pkgver")
license=('custom')
install=nvidia.install
source=("${_src_url}")
if [ "$CARCH" = "i686" ]; then
     md5sums=('a71a92159e06285d5c936f9a096edf28')
elif [ "$CARCH" = "x86_64" ]; then
     md5sums=('9b93e85441150187ebc071a74e909426')
     #optdepends[2]=('lib32-nvidia-utils-bumblebee')
fi

build() 
{
  cd $srcdir
  msg "Copying files..."
  cp -a etc $pkgdir || return 1
  mkdir $pkgdir/usr
  cp -a usr/share $pkgdir/usr/share || return 1
  cp -a usr/bin $pkgdir/usr/bin || return 1
  mkdir $pkgdir/usr/lib
  cp -a usr/lib $pkgdir/usr/lib/nvidia-bumblebee || return 1
}

