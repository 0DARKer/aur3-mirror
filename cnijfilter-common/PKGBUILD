# Maintainer: Stefan Hackl <stef.hackl@gmail.com>

pkgname=('cnijfilter-mp550')
true && pkgname=('cnijfilter-common' 'cnijfilter-mp550')
_pkgname=cnijfilter
pkgver=3.20
pkgrel=4
pkgdesc="Canon Printer Driver (For Multifunction MP550)"
url="http://software.canon-europe.com/products/0010757.asp"
arch=('i686' 'x86_64')
license=('custom')
makedepends=('rpmextract')
source=("http://files.canon-europe.com/files/soft37275/software/MP550_rpm_driver_pack.tar")
md5sums=('5d806a0b626cc6aff6f172b95e11e105')

build() {
  mkdir ${srcdir}/${_pkgname}-common
  mkdir ${srcdir}/${_pkgname}-mp550
  cd ${srcdir}
  tar -xf MP550_rpm_driver_pack.tar
  tar -xf ${_pkgname}-mp550series-${pkgver}-1-i386-rpm.tar.gz
  mv ${srcdir}/${_pkgname}-mp550series-${pkgver}-1-i386-rpm/packages/${_pkgname}-mp550series-${pkgver}-1.i386.rpm  ${srcdir}/cnijfilter-mp550
  mv ${srcdir}/${_pkgname}-mp550series-${pkgver}-1-i386-rpm/packages/${_pkgname}-common-${pkgver}-1.i386.rpm ${srcdir}/cnijfilter-common
  cd ${srcdir}/cnijfilter-common
  rpmextract.sh ${_pkgname}-common-${pkgver}-1.i386.rpm
  mkdir -p usr/share/licenses/${_pkgname}
  mv usr/share/doc/${_pkgname}-common-$pkgver/* usr/share/licenses/${_pkgname}
  rm -rf usr/share/doc
  cd ${srcdir}/cnijfilter-mp550
  rpmextract.sh ${_pkgname}-mp550series-${pkgver}-1.i386.rpm
}

package_cnijfilter-common() {
if [ "${CARCH}" = 'x86_64' ]; then
  depends=('lib32-libcups' 'lib32-popt')
elif [ "${CARCH}" = 'i686' ]; then
  depends=('libcups' 'popt')
fi
  cp -r "${srcdir}/${pkgname}/usr" ${pkgdir}
}

package_cnijfilter-mp550() {
if [ "${CARCH}" = 'x86_64' ]; then
  depends=('lib32-libxml2' 'lib32-gtk2' 'lib32-popt' 'lib32-libpng12' 'cnijfilter-common')
elif [ "${CARCH}" = 'i686' ]; then
  depends=('libxml2' 'gtk2' 'libpng12' 'popt' 'cnijfilter-common')
fi
  cp -r "${srcdir}/${pkgname}/usr" ${pkgdir}
}