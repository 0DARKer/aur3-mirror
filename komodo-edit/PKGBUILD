# Maintainer: max-k <max-k@post.com>
# Contributor: max-k <max-k@post.com>

if [ $(uname -m) = "x86_64" ] ; then
_arch="x86_64"
else
_arch="x86"
fi

_major="8.0.2"
_minor=12590

pkgname="komodo-edit"
_bigname="Komodo-Edit"
pkgver="${_major}_${_minor}"
pkgrel=1
pkgdesc="Open-Source version of ActiveState Komodo IDE - Based on XUL"
arch=(i686 x86_64)
url="http://www.activestate.com/komodo-edit"
license=('MPL')
depends=('glibc>=2.4' 'libjpeg>=6.2' 'gcc-libs' 'gtk2')
optdepends=('xterm: can be used by komodo-toolbox')
conflicts=('komodoedit' 'komodoedit-nightly' 'komodoedit-beta')
options=('!strip')

source=("http://downloads.activestate.com/Komodo/releases/${_major}/${_bigname}-${_major}-${_minor}-linux-${_arch}.tar.gz")

if [ $_arch == "x86_64" ] ; then
md5sums=('f2f6f769e048f59990f2cf754360dcd0')
sha256sums=('a3dae8fd35acafb28e0422784b4ce5d02fd91ec53114c41a8b68fcf74bd933f5')
else
md5sums=('4167632e6623aa57021077c25484f469')
sha256sums=('f912bc6ad681e07ba078c227fa42103c0029fd643b55dfad5db67226d0a66c6a')
fi

build() {
cd ${srcdir}/${_bigname}-${_major}-${_minor}-linux-${_arch}
sed -i 's/^    print/   #print\n   /g' support/_install.py
sed -i 's/root.addHandler(console)/#root.addHandler(console)/' support/_install.py
}

package() {
cd ${srcdir}/${_bigname}-${_major}-${_minor}-linux-${_arch}
./install.sh -s -I ${pkgdir}/opt/${pkgname} --dest-dir ${pkgdir}/opt/${pkgname} 2>&1 | sed "s#${pkgdir}##" || exit 1
grep -v ${srcdir} ${pkgdir}/opt/${pkgname}/share/desktop/${pkgname}-8.desktop > ${srcdir}/${pkgname}.desktop
echo "Exec=/opt/${pkgname}/bin/komodo %F" >> ${srcdir}/${pkgname}.desktop
echo "Icon=/opt/${pkgname}/share/icons/komodo128.png" >> ${srcdir}/${pkgname}.desktop
install -D -m 644 ${srcdir}/${pkgname}.desktop ${pkgdir}/usr/share/applications/${pkgname}.desktop
ln -sf "/opt/${pkgname}/lib/mozilla/komodo" "${pkgdir}/opt/${pkgname}/bin/komodo"
install -d "${pkgdir}/usr/bin"
ln -s "/opt/${pkgname}/bin/komodo" "${pkgdir}/usr/bin/komodo"
}
