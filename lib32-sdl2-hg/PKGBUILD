# Contributor: J0k3r <moebius282 e4at gmail D0_T com>

pkgname=lib32-sdl2-hg
pkgver=6963
pkgrel=1
pkgdesc="sdl2-hg 32 bit"
arch=('x86_64')
url="http://www.libsdl.org"
license=('MIT')
groups=()
depends=('lib32-glibc' 'bash')
makedepends=('mercurial')
provides=()
conflicts=()
replaces=()
backup=()
options=(!libtool)
install=
source=()
noextract=()
md5sums=() #generate with 'makepkg -g'

_hgroot='http://hg.libsdl.org/'
_hgrepo='SDL'

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [[ -d "$_hgrepo" ]]; then
    cd "$_hgrepo"
    hg pull -u
    msg "The local files are updated."
  else
    hg clone "$_hgroot" "$_hgrepo"
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_hgrepo-build"
  cp -r "$srcdir/$_hgrepo" "$srcdir/$_hgrepo-build"
  cd "$srcdir/$_hgrepo-build"

  #
  # BUILD HERE
  #
  
  export CC='gcc -m32'
  export CXX="g++ -m32"
  export PKG_CONFIG_PATH='/usr/lib32/pkgconfig'

  ./autogen.sh

  mkdir build
  cd build

  ../configure --prefix=/usr --libdir=/usr/lib32 --disable-video-opengles
  make
}

package() {
  
  cd "$srcdir/$_hgrepo-build"
  cd build/
  make DESTDIR="$pkgdir/" install

  #already included in sdl2-hg
  rm -rf "$pkgdir/usr/share/aclocal/" "$pkgdir/usr/include/" "${pkgdir}/usr/bin/"

  cd ..
  install -Dm644 "COPYING" "${pkgdir}/usr/share/licenses/${pkgname}/COPYING"
}

# vim:set ts=2 sw=2 et:
