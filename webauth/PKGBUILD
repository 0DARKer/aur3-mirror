# Contributor: Morgan LEFIEUX <comete_AT_archlinuxfr.org>
pkgname=webauth
pkgver=3.5.0
pkgrel=1
pkgdesc="A comprehensive system for authenticating web users with Kerberos 5."
url="http://webauthv3.stanford.edu"
depends=('apache' 'heimdal' 'curl' 'openssl' 'openldap')
backup=()
source=(http://webauthv3.stanford.edu/dist/$pkgname-$pkgver.tar.gz)
md5sums=('12d6b4bcf7e8b23577fa63f94584165d')

build() {
  cd $startdir/src/$pkgname-$pkgver
  mkdir -p $startdir/pkg/usr/lib/apache
  ./configure --prefix=/usr --with-apache=/usr \
        --with-krb5=/usr --with-openssl=/usr \
        --with-curl=/usr --with-ldap=/usr \
	--with-apxs=/usr/sbin/apxs \
	--includedir=/usr/include \
	--libdir=/usr/lib/apache
  make || return 1
  install -D -m755 src/libwebauth/.libs/libwebauth.so.1.1.2 \
                   $startdir/pkg/usr/lib/apache/libwebauth.so.1.1.2
		   
  cd $startdir/pkg/usr/lib/apache/
  ln -s libwebauth.so.1.1.2 libwebauth.so
  ln -s libwebauth.so.1.1.2 libwebauth.so.1
  
  cd $startdir/src/$pkgname-$pkgver
  install -D -m755 src/modules/webauth/.libs/mod_webauth.so \
  			$startdir/pkg/usr/lib/apache/mod_webauth.so
			
  install -D -m755 src/modules/webauthldap/.libs/mod_webauthldap.so \
  			$startdir/pkg/usr/lib/apache/mod_webauthldap.so

  install -D -m755 src/utils/.libs/wa_keyring \
  			$startdir/pkg/usr/lib/apache/wa_keyring
}
