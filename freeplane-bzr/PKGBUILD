# Maintainer: Mamoru HIRAI <mamoru_h at leto dot eonet dot ne dot jp>

pkgname=freeplane-bzr
pkgver=2600
pkgrel=3
pkgdesc="a free mindmapping and knowledge management tool"
arch=('i686' 'x86_64')
url="http://freeplane.sourceforge.net"
license=('GPL')
makedepends=('bzr' 'apache-ant')
depends=('java-runtime')
conflicts=('freeplane')
source=('freeplane.desktop' 'freeplane.run')
md5sums=('0029de45c5e261d5bed8ffc5635562d1'
         '549edc47477fe6fcfb1cf59c55f0831f')

_bzrtrunk="bzr://freeplane.bzr.sourceforge.net/bzrroot/freeplane/freeplane_program/trunk"
_bzrmod=freeplane
_builddir=$srcdir/freeplane/freeplane_framework/build

build() {

    cd $srcdir

    if [[ -d $_bzrmod ]]; then
	cd $_bzrmod
	bzr pull $_bzrtrunk -r $pkgver
    else
	bzr branch $_bzrtrunk $_bzrmod -r $pkgver
    fi

    cd $srcdir/$_bzrmod
    /usr/share/java/apache-ant/bin/ant -q clean build
}

package() {

    mkdir -p $pkgdir/usr/share
    cp -r $_builddir $pkgdir/usr/share/$pkgname

    cd $pkgdir/usr/share/$pkgname
    rm *.exe *.bat

    mkdir -p $pkgdir/usr/bin

    install -Dm755 $srcdir/freeplane.run $pkgdir/usr/bin/freeplane
    install -Dm644 $srcdir/freeplane.desktop $pkgdir/usr/share/applications/freeplane.desktop
    install -Dm644 $_builddir/freeplane.svg $pkgdir/usr/share/pixmaps/freeplane.svg
}
