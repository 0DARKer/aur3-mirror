# Maintainer: Daniel Wallace <daniel.wallace at gatech dot edu>
pkgname=fuse-google-drive-git
_pkgname=gdrive
pkgver=20120430
pkgrel=2
pkgdesc="google drive cli fuse client" 
arch=("any")
url="https://github.com/jcline/fuse-google-drive"
license=('GPL')
depends=('libxml2' 'json-c' 'fuse')
makedepends=('git')
source=('redirecturi')
_source=("clientsecrets" "clientid")

_gitroot=https://github.com/jcline/fuse-google-drive.git
_gitname=gdrive
nofiles (){
    echo "Please aquire the information for $1 from http://code.google.com/apis/console"
    echo "You need to generate a clientid, clientsecret, and redirecturi for an install application"
    echo "see the ReadMe at https://github.com/jcline/fuse-google-drive for more information"
}
build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"

  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd $srcdir/$_gitname-build
  for f in ${_source[@]};do
    if [[ -f "$startdir/$f" ]];then
      cp $startdir/$f .
    else
      nofiles $f
      exit
    fi
  done
  sed -i 's:\(gdi_load_clientid("\)clientid:\1/etc/clientid:' gd_interface.c
  sed -i 's:\(gdi_load_clientsecrets("\)clientsecrets:\1/etc/clientsecrets:' gd_interface.c
  sed -i 's:\(gdi_load_redirecturi("\)redirecturi:\1/etc/redirecturi:' gd_interface.c
  ./autogen.sh
  ./configure
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  make DESTDIR=$pkgdir/ install
  install -Dm644 $startdir/${_source[0]} $pkgdir/etc/${_source[0]}
  install -Dm644 $startdir/${_source[1]} $pkgdir/etc/${_source[1]}
  install -Dm644 $startdir/${source[0]} $pkgdir/etc/${source[0]}

}

# vim:set ts=2 sw=2 filetype=PKGBUILD
md5sums=('70bf025fba652f91dd52fd3caa1a6775')


