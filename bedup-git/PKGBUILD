# Maintainer: Oliver Mangold <o.mangold at gmail dot com>
pkgname=bedup-git
pkgver=130602
pkgrel=1
pkgdesc="Offline deduplication utility for the BTRFS filesystem"
arch=('i686' 'x86_64')
url="https://github.com/g2p/bedup"
commit="510980b54dd67d30c4fd72436b2065f369c19d4b"
#commit="HEAD"
source=('bedup-contextlib2.patch')
md5sums=('b6d34b4576def2e96fe430e34ac03630')
license=('GPL')
depends=('python' 'python-distribute' 'python-alembic' 'python-cffi' 'python-sqlalchemy' 'python-xdg' 'python-mako')
makedepends=('gcc')

provides=("bedup")

prepare() {
  if [ ! -e "${srcdir}/bedup.git" ]; then
    git clone "$url" "${srcdir}/bedup.git"
  else
    (cd "${srcdir}/bedup.git"; git pull origin master)
  fi
  cd "${srcdir}/bedup.git"
  git reset --hard "$commit"
  git apply ../bedup-contextlib2.patch
}

build() {
  cd "${srcdir}/bedup.git"
  python setup.py build
}

package() {
  cd "${srcdir}/bedup.git"
  python setup.py install --root "${pkgdir}"
}
