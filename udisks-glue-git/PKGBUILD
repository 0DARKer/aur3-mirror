# Maintainer: Mikhail Borisov <borisov.mikhail@gmail.com>

pkgname=udisks-glue-git
pkgver=20101022
pkgrel=1
pkgdesc="A tool to associate udisks events to user-defined actions"
url="http://github.com/fernandotcl/udisks-glue"
license=('BSD')
arch=('i686' 'x86_64')
depends=('glib2' 'confuse' 'dbus-glib')
makedepends=('git')
provides=('udisks-glue')
conflicts=('udisks-glue')

_gitroot="http://github.com/fernandotcl/udisks-glue.git"
_gitname="udisks-glue"

build() {
  cd $srcdir

  msg "Connecting to the GIT server...."
  if [ -d $_gitname ]; then
    (cd $_gitname && git pull origin || return 1)
  else
    git clone $_gitroot || return 1
  fi

  rm -rf ${_gitname}-build
  cp -r $_gitname ${_gitname}-build
  cd ${_gitname}-build

  # Fix -Wl,--as-needed issue
  # See http://www.gentoo.org/proj/en/qa/asneeded.xml "Importance of linking order"
  sed -e 's/$(CC) $(LDFLAGS) -o $(BIN) $(OBJS)/$(CC) -o $(BIN) $(OBJS) $(LDFLAGS)/g' -i Makefile

  msg "Starting build process."
  make || return 1
  
  cp man/udisks-glue.1 . && gzip udisks-glue.1 || return 1
}

package() {
  cd $srcdir/${_gitname}-build

  make install DESTDIR=$pkgdir || return 1

  install -d -m 0755 $pkgdir/usr/share/licenses/udisks-glue || return 1
  install -m 0644 LICENSE $pkgdir/usr/share/licenses/udisks-glue/LICENSE || return 1

  install -d -m 0755 $pkgdir/usr/share/man/man1/ || return 1
  install -m 0644 udisks-glue.1.gz $pkgdir/usr/share/man/man1/udisks-glue.1 || return 1
}
