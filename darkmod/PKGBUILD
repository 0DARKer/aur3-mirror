# Maintainer: Benjamin Colard <benjamin at colard dot be>
# Contributer: Benjamin Colard <benjamin at colard dot be>

pkgname=darkmod
pkgver=2.01
pkgrel=3
pkgdesc="DOOM III standalone mod based on the Thief series by Looking Glass Studios"
arch=('i686' 'x86_64')
url="http://www.thedarkmod.com/"
license=('CCPL')

makedepends=('unzip' 'xterm')
[ "$CARCH" == i686   ] && depends=('glew' 'libpng' 'libjpeg-turbo' 'libpng12' 'curl' 'libxxf86vm')

[ "$CARCH" == x86_64 ] && depends=('lib32-glew' 'lib32-libpng' 'lib32-libjpeg-turbo' 'lib32-libpng12' 'lib32-curl' 'lib32-libxxf86vm')

install="$pkgname".install
source=(http://www.bloodgate.com/mirrors/tdm/pub/pk4/tdm_update_linux.zip
        darkmod.dir
        "$pkgname".desktop
        "$pkgname".png
        http://taaaki.za.net/tdm_game02.pk4
        http://taaaki.za.net/thedarkmod.x86.tar.gz)

md5sums=('1c5a1bc4d3d6f3fbf0396be0dd0c4b49'
         'ee997b8711f254781d4a76ad724940ef'
         'bc6537224b60c4ccfd04a51d80e340c1'
         '5309e528ce22f28ecc0e9781e43379e0'
         'e5a94776e77446aaacb3bd3d6fdc122e'
         '3de9a78f6f0d23f751a9df3e2ecff364')

build() {
  cd "$srcdir"
	if [ ! -d "$srcdir/darkmod" ]; then
	    mkdir $srcdir/darkmod	
	fi
	cd darkmod
	unzip -o ../../tdm_update_linux.zip
	chmod +x tdm_update.linux
	xterm -e ./tdm_update.linux	
	rm -f TheDarkMod.exe tdm_update.exe
	tar -zxf ../../thedarkmod.x86.tar.gz
	cp ../../tdm_game02.pk4 .
}

package() {
  cd "$srcdir"/darkmod

  install -m755 -d "$pkgdir"/opt/darkmod/
  install -m755 -d "$pkgdir"/usr/bin/
  install -m755 -d "$pkgdir"/usr/share/{applications,icons,licenses/"$pkgname"}

  cp -r * "$pkgdir"/opt/darkmod/
  find "$pkgdir"/opt/darkmod/ -type d -exec chmod 755 {} \;
  find "$pkgdir"/opt/darkmod/ -type f -exec chmod 644 {} \;
  chmod 755 "$pkgdir"/opt/darkmod/thedarkmod.x86
  install -m755 -d "$srcdir"/darkmod/ "$pkgdir"/usr/bin/

  install -Dm644 LICENSE.txt "$pkgdir"/usr/share/licenses/"$pkgname"/LICENSE
  rm -f "$pkgdir"/opt/darkmod/LICENSE.txt

  install -Dm644 "$srcdir"/"$pkgname".png "$pkgdir"/usr/share/icons/
  install -Dm644 "$srcdir"/"$pkgname".desktop "$pkgdir"/usr/share/applications/
}
