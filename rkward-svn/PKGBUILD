# Contributer: Meow (meow@linux.cn)

pkgname=rkward-svn
pkgver=3693
pkgrel=2
pkgdesc="An Easy to use, transparent frontend to the R-language"
arch=('i686' 'x86_64')
url="http://rkward.sourceforge.net/"
license=('GPL')
depends=('kdelibs>=4.0.0' 'qt>=4.3' 'r>=2.8.0' 'docbook-xml' 'docbook-xsl')
makedepends=('cmake' 'automoc4' 'subversion')
provides=('rkward')
conflicts=('kdemod-rkward' 'rkward')

_svntrunk=https://rkward.svn.sourceforge.net/svnroot/rkward/trunk/rkward
_svnmod=rkward

build() {
	cd $srcdir
	if [ -d $_svnmod/.svn ]; then
		(cd $_svnmod && svn up -r $pkgver)
	else
		svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
	fi

	msg "SVN checkout done or server timeout"
	msg "Starting make..."

	rm -rf "$srcdir/$_svnmod-build"
	mv "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
	cd "$srcdir/$_svnmod-build/"

	mkdir -p ${pkgdir}/usr/lib/R/library
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release -DR_LIBDIR=/usr/lib/R/library
	make
}

package(){
	cd "$srcdir/$_svnmod-build/"
	make DESTDIR=$pkgdir install

	# Some cleanup
	rm -vf "${pkgdir}/usr/lib/R/library/R.css"
	rm -vf "${pkgdir}/usr/share/apps/katepart/syntax/r.xml"
}
