# Contributor: MCMic <come.bernigaud@laposte.net>

pkgname=purity
pkgver=20071027
pkgrel=1
pkgdesc="An abstract first-person shooter built on the Quake3 engine."
arch=('i686' 'x86_64')
url="http://vectorpoem.com/purity/"
license=('GPL')
depends=()
makedepends=('make' 'svn')
conflicts=('')
source=('http://vectorpoem.com/purity/latest_content/core.pk3'
		'http://vectorpoem.com/purity/latest_content/map0.pk3'
		'http://vectorpoem.com/purity/latest_content/vm.pk3')
md5sums=('4f5b6af36a738a54570f21fb24177edd'
         'b7f5730e443ea5c066d7ef67bce09892'
         '8396c0dfe49c31ff866800837bf80d9d')
_svn='https://purityq3.svn.sourceforge.net/svnroot/purityq3'

build() {
	cd $srcdir
	msg "Getting svn revision…"
    if [ -d $pkgname/.svn ]; then
      (cd $pkgname && svn up)
    else
      svn co $_svn $pkgname
    fi
	
	msg "Building…"
	cd $pkgname
	make
	
	msg "Cleaning and adapting scripts"
	rm *.exe
	for i in `ls *.bat | cut -d'.' -f1`
		do sed -i "s/@start purity.x86/purity/" $i.bat
		mv $i.bat $i.sh
		chmod +x $i.sh
	done
	
	msg "Packaging"
	mkdir -p ${pkgdir}/opt/
	cp -r ${srcdir}/$pkgname ${pkgdir}/opt/
	build_folder=`ls ${srcdir}/$pkgname/build`
	mkdir -p ${pkgdir}/opt/$pkgname/build/$build_folder/base
	cp ${srcdir}/*.pk3 ${pkgdir}/opt/$pkgname/build/$build_folder/base/
}
