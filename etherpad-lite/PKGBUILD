# Maintainer: Jonas Heinrich <onny@project-insanity.org>

pkgname=etherpad-lite
pkgver=1.2.9
_fullver=a316052
pkgrel=1
pkgdesc="A lightweight fork of etherpad based on javascript"
arch=(any)
url="https://github.com/ether/etherpad-lite"
license=('GPL')
depends=('curl' 'python' 'openssl' 'nodejs')
conflicts=('etherpad-lite-git')
source=("ether-$pkgname-$pkgver-0-g$_fullver.zip::https://nodeload.github.com/ether/etherpad-lite/legacy.zip/master" 
	"etherpad-lite-bin"
	"etherpad-lite.service")
sha512sums=('43950aaf3c0bd59ccedc2a028c880c4c4655a37f2f2ea5f1f03b3e68bb6cecba013dc0cb77c642c0722a8b1545f961e5f5f67f2f76737228dcf8f061756f158f'
	    '7294bee927fa8c020d4514ff843fa8c9774a1b9042d93bedcba7896cc10b986cd566eda74c790406e18729f08271ec5c7c5923f73e0c3774a3690d4ceb02039a'
	    '2199372422ba133ad152c101830ee928813fd3f8b2d3c14981d4175925f067123bcbb0378a83237454d6b7e1c1b03194b68884c958924a27a363db8785b3dceb')

build() {
  cd "$srcdir/ether-$pkgname-$_fullver"
  sed -i 's/"v0.6" \]/"v0.6" \] \&\&  \[ \! \$NODE_V_MINOR = "v0.10" \]/g' bin/installDeps.sh
  ./bin/installDeps.sh
}

package() {
  cd "$srcdir/ether-$pkgname-$_fullver"
  mkdir -p $pkgdir/usr/share/webapps/etherpad-lite
  cp -r * $pkgdir/usr/share/webapps/etherpad-lite
  mkdir -p $pkgdir/usr/bin
  cp $srcdir/etherpad-lite-bin $pkgdir/usr/bin/etherpad-lite
  install -Dm644 "${srcdir}/etherpad-lite.service" "${pkgdir}/usr/lib/systemd/system/etherpad-lite.service"
}
