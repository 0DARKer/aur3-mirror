# Maintainer: Joermungand <joermungand at gmail dot com>

pkgname=infamousplugins-git
pkgver=256.53b4ea2
pkgrel=1
pkgdesc="A collection of open-source LV2 plugins"
arch=('i686' 'x86_64')
url="http://infamousplugins.sourceforge.net"
license=('GPL2')
groups=('lv2-plugins')
depends=('glibc' 'fftw')
makedepends=('git' 'qt4' 'lv2')
provides=('infamousplugins')
conflicts=('infamousplugins')
source=("${pkgname%-*}-code"::'git://git.code.sf.net/p/infamousplugins/code')
md5sums=('SKIP')

pkgver() {
    cd "$srcdir/${pkgname%-*}-code"
    echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
    cd ${pkgname%-*}-code/src/CellularAutomatonSynth
    qmake-qt4
    make
    cd ..
    mkdir -p ../utils
    gcc rule.c -o ../utils/infamous-rule
    cd EnvelopeFollower
    qmake-qt4
    make
    cd ../Hip2B
    qmake-qt4
    make
    cd ../Stuck
    qmake-qt4
    make
    cd ../PowerCut
    qmake-qt4
    make
    cd ../PowerUp
    qmake-qt4
    make
    cd ../EWham
    qmake-qt4
    make
    cd ../cheap_distortion
    make
}

package() {
    cd "$srcdir/${pkgname%-*}-code/src"
    mkdir -p "$pkgdir/usr/lib/lv2"
    cp -Rf CellularAutomatonSynth/casynth.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf EnvelopeFollower/envfollower.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf Hip2B/hip2b.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf Stuck/stuck.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf PowerCut/powercut.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf PowerUp/powerup.lv2 "$pkgdir/usr/lib/lv2/"
    cp -Rf EWham/ewham.lv2 "$pkgdir/usr/lib/lv2/"
    mkdir "$pkgdir/usr/lib/lv2/cheap_distortion.lv2"
    cp cheap_distortion/manifest.ttl "$pkgdir/usr/lib/lv2/cheap_distortion.lv2/"
    cp cheap_distortion/plugin.ttl "$pkgdir/usr/lib/lv2/cheap_distortion.lv2/cheap_distortion.ttl"
    cp cheap_distortion/cheap_distortion.so "$pkgdir/usr/lib/lv2/cheap_distortion.lv2/"
    cd ..
    mkdir -p "$pkgdir/usr/bin"
    cp utils/infamous-rule "$pkgdir/usr/bin/"
    mkdir -p "$pkgdir/usr/share/doc/$pkgname"
    cp CHANGELOG "$pkgdir/usr/share/doc/$pkgname/"
    cp COPYING "$pkgdir/usr/share/doc/$pkgname/"
    cp README  "$pkgdir/usr/share/doc/$pkgname/"
}

