# Maintainer: GordonGR <gordongr@freemail.gr>

pkgname=singularityviewer
pkgver=1.8.0.4114
_filever=5.14
pkgrel=2
pkgdesc="Singularity Viewer is an exciting client for Second Life (secondlife) and OpenSim (opensimulator), which combines the look and feel of Viewer 1.23 with the latest and greatest of available technology."
url="http://www.singularityviewer.org/"
license=('custom')
arch=('i686' 'x86_64')
depends=('apr-util' 'gtk2' 'libgl' 'libidn' 'libjpeg-turbo' 'mesa' 'nss' 'sdl' 'glu' 'pangox-compat')
optdepends=('libpulse: for PulseAudio support' 'alsa-lib: for ALSA support' 'nvidia-utils: for NVIDIA support' 'flashplugin: for inworld Flash support' 'gstreamer0.10: for video support, may need good, bad and ugly plugins' 'lib32-freealut: for OpenAL support')
source=(	"https://bitbucket.org/SingularityViewer/singularityviewer/downloads/Singularity-$CARCH-$pkgver.tar.bz2"
		"singularityviewer.desktop"
		"singularityviewer.launcher")
#ftp://ftp.astron.com/pub/file/file-${_filever}.tar.gz"

if [ "$CARCH" = "i686" ]; then
md5sums=('016bc73c1f75d66f1323d0d94b49fbe4'
         '21b1e68507a1dd851da8ef7d766afe58'
         'eb596f5cf7b6f2d0c55c0082fb99a905')
elif [ "$CARCH" = "x86_64" ]; then
md5sums=('432376840d030d33a9b8afdb1c549f14'
         '21b1e68507a1dd851da8ef7d766afe58'
         'eb596f5cf7b6f2d0c55c0082fb99a905')
fi

#build(){
	
	#Build file-5.13 as a workaround to
	# http://code.google.com/p/singularity-viewer/issues/detail?id=718&sort=-opened&colspec=ID%20Type%20Status%20Priority%20Stars%20Milestone%20Owner%20Summary%20Opened%20Modified
	#cd "${srcdir}/file-${_filever}"
    #./configure --prefix=/usr --datadir=/usr/share/file
    #make 
#}

package() {
  cd $srcdir
  
  # Rename Data Directory
  mv Singularity-$CARCH-${pkgver} singularityviewer
  
  # Install Desktop File
  install -D -m644 $srcdir/singularityviewer.desktop \
    $pkgdir/usr/share/applications/singularityviewer.desktop
  
  # Install Icon File
  install -D -m644 $srcdir/singularityviewer/singularity_icon.png \
    $pkgdir/usr/share/pixmaps/singularityviewer.png
  
  # Install Launcher
  install -D -m755 $srcdir/singularityviewer.launcher \
    $pkgdir/usr/bin/singularityviewer

  # Install License file
  install -D -m755 $srcdir/singularityviewer/licenses.txt \
    $pkgdir/usr/share/licenses/$pkgname/LICENSE
    
  # Move Data to Destination Directory
  install -d $pkgdir/opt
  mv singularityviewer $pkgdir/opt/
  
  # Change Permissions of files to root:games
  chown -R root:games $pkgdir/opt/singularityviewer
  chmod -R g+rw $pkgdir/opt/singularityviewer
  # Make Binary Group-Executable
  chmod g+x $pkgdir/opt/singularityviewer/singularity
  
  # Workaround for the ugly file bug until it's fixed by upstream Singularity:
  #install -D -m755 $srcdir/file-${_filever}/src/.libs/libmagic.so.1.0.0\
  #$pkgdir/opt/singularityviewer/libmagic.so.1.0.0
  
    
}
