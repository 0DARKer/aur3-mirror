# Maintainer: Mitch Bigelow <ipha00@gmail.com>

pkgname=gwoffice-bzr
pkgver=77
pkgrel=5
pkgdesc="Google Web Office - GWoffice - brings your google drive to your dektop"
arch=('i686' 'x86_64')
url="https://launchpad.net/gwoffice"
license=('GPL3')
depends=('granite-bzr' 'libwebkit3' 'gnome-online-accounts' 'libunity' 'libgdata')
makedepends=('bzr' 'cmake' 'vala')
install=$pkgname.install

_bzrtrunk=lp:gwoffice
_bzrmod=gwoffice

build() {
	msg "Connecting to Bazaar server...."

	if [[ -d "$_bzrmod" ]]; then
		cd "$_bzrmod" && bzr pull "$_bzrtrunk" -r "$pkgver"
		msg "The local files are updated."
	else
		bzr branch "$_bzrtrunk" "$_bzrmod" -r "$pkgver"
	fi

	msg "Bazaar checkout done or server timeout"
	msg "Starting build..."

	[ -d "$srcdir/$_bzrmod-build" ] && rm -rf "$srcdir/$_bzrmod-build"
	cp -r "$srcdir/$_bzrmod" "$srcdir/$_bzrmod-build"
	cd "$srcdir/$_bzrmod-build"
	[ -d build ] && rm -rf build
	mkdir build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_EXE_LINKER_FLAGS=-loauth -DGSETTINGS_COMPILE=off
	make
}

package() {
	cd "$srcdir/$_bzrmod-build/build"
	make DESTDIR="$pkgdir/" install
}
