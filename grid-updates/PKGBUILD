# Maintainer : Skydrome <skydrome@i2pmail.org>

pkgname=grid-updates
pkgver=1.1.3
pkgrel=4
pkgdesc="Helps keep Tahoe-LAFS nodes' configurations up-to-date"
url='http://killyourtv.i2p.to/grid-updates'
license=('Public Domain')
arch=('any')
install='grid-updates.install'
depends=('python2')
optdepends=('python2-numpy: enables reliability calculator')
source=("http://killyourtv.i2p.to/${pkgname}/download/${pkgname}-${pkgver}.tar.gz"
        "http://killyourtv.i2p.to/${pkgname}/download/${pkgname}-${pkgver}.tar.gz.sig"
        #"http://darrob.i2p.to/${pkgname}/download/${pkgname}-${pkgver}.tar.gz"
        #"http://darrob.i2p.to/${pkgname}/download/${pkgname}-${pkgver}.tar.gz.sig"
        '0001-style-fix.patch')
sha256sums=('7e00c32204f603a2b5d40bf5b0e02f4215089dc2a6ff500973ebaee4323daabc'
            '261664a122b443cb2b90cd970d68905a77ff7b293e6bfad12ab7a2ad9b1dfb0f'
            '153542a64710d2c6a02f4e1fa82fd43458467d0372af2f6132466ecef3883916')

_patchver="${pkgver}-${pkgrel}-ARCH"

build(){
    cd "${srcdir}/${pkgname}-${pkgver}"
    #patch -Np1 -i ${srcdir}/0001-style-fix.patch

    sed "s|VERSION=.*|VERSION=${_patchver} */|"      -i share/tahoe.css.patched19
    sed "s|VERSION=.*|VERSION=${_patchver} -->|"     -i share/welcome.xhtml.patched19
    sed "s|version__ .*|version__ = '${_patchver}'|" -i gridupdates/version.py

    python2 setup.py build
}

package(){
    cd "${srcdir}/${pkgname}-${pkgver}"
    python2 setup.py install --root="$pkgdir"
}
