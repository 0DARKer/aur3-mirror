# Maintainer: A. Weiss <adam [at] archlinux.us>
# Samuel Mesa <samuelmesa [at] linuxmail.org>

pkgname=osgearth
pkgver=2.4
pkgrel=1
pkgdesc="A terrain rendering toolkit for OpenSceneGraph"
arch=('i686' 'x86_64')
url=('http://www.osgearth.org')
license=('LGPL')
depends=('openscenegraph' 'gdal' 'expat' 'curl' 'minizip')
optdepends=('geos: Imrpoved vector support'
            'sqlite: Flat file cache'
            'libzip: Archive support')
makedepends=('git' 'cmake')
provides=('osgearth')
conflicts=('osgearth')

_gitroot='git://github.com/gwaldron/osgearth.git'
_gitname='osgearth'
_gitbranch="osgearth-2.4"

build() {

	cd $srcdir

  msg "Connecting to $_gitname GIT server...."

	if [[ -d $_gitname ]] ; then
	  cd $_gitname && git pull origin $_gitbranch
	  msg "The local files are updated."
	else
	  git clone $_gitroot --branch $_gitbranch
	fi

  msg "GIT checkout done or server timeout"

	cd $srcdir
        rm -rf build
        mkdir -p build
	cd build

  msg "Starting make..."

        cmake ../$_gitname \
            -DMINIZIP_INCLUDE_DIR=/usr/include/minizip \
            #-DCMAKE_INSTALL_PREFIX=/usr/local \
            #-DLIB_INSTALL_DIR=/usr/local/lib \
            #-DCMAKE_BUILD_TYPE=Release \
            #-DCMAKE_BUILD_TYPE=MinSizeRel \
            #-DOSGEARTH_BUILD_FRAMEWORKS=true \
        make
}

package() {
   cd build
   make DESTDIR=$pkgdir install
   mkdir -p $pkgdir/usr/local/share/osgearth
   cp -r $srcdir/$_gitname/tests $pkgdir/usr/local/share/osgearth
   cp -r $srcdir/$_gitname/data $pkgdir/usr/local/share/osgearth
   #cp -r $srcdir/build/lib $pkgdir/usr/local/lib
}

