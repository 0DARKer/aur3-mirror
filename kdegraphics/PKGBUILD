# $Id: PKGBUILD 111771 2011-02-28 23:53:51Z andrea $
# Maintainer: Andrea Scarpino <andrea@archlinux.org>
# Contributor: Pierre Schmitz <pierre@archlinux.de>
# Contributor: Adria Arrufat <swiftscythe@gmail.com>

pkgbase=kdegraphics
pkgname=('kdegraphics-okular-patched')
pkgdesc='Document Viewer with debugging symbols and patched to fix crash on i686'
pkgver=4.6.1
pkgrel=1
arch=('i686' 'x86_64')
url='http://www.kde.org'
license=('GPL' 'LGPL' 'FDL')
groups=('kde' 'kdegraphics')
options=(!strip)
depends=('kdebase-runtime' 'qimageblitz' 'poppler-qt' 'chmlib' 'djvulibre'
         'ebook-tools' 'libspectre')
url="http://kde.org/applications/graphics/okular/"
install='kdegraphics.install'
makedepends=('pkgconfig' 'cmake' 'automoc4' 'qimageblitz' 'sane' 'lcms'
'libxxf86vm' 'poppler-qt' 'libspectre' 'chmlib' 'djvulibre'
'ebook-tools' 'kdebase-runtime' 'docbook-xsl')
source=("http://download.kde.org/stable/${pkgver}/src/${pkgbase}-${pkgver}.tar.bz2" 'fix.patch')
sha1sums=('8a96d927be9a41ff9a7d222474d0e4759346415b'
'60ccf800a7975f1b3b23aded072512d969f8f5e6')

build() {
	export CFLAGS="$CFLAGS -g"
	export CXXFLAGS="$CXXFLAGS -g"
	cd ${srcdir}
	cd ${pkgbase}-${pkgver}
	patch -Np0 -i ../fix.patch
	cd ..
    rm -rf build
	mkdir build
	cd build
	cmake ../${pkgbase}-${pkgver} \
		-DCMAKE_BUILD_TYPE=debugfull \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DKDE4_ENABLE_FINAL=ON
	cd okular
	make
	cd $srcdir/build/okular
	make DESTDIR=$pkgdir install
	cd $srcdir/build/doc/okular
	make DESTDIR=$pkgdir install
}
