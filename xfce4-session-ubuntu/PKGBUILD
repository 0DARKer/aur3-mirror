pkgname=xfce4-session-ubuntu
pkgver=4.6.2
_patchver=4.6.1
pkgrel=1
pkgdesc="A session manager for Xfce, with hibernate and suspend buttons and ubuntu patches"
arch=(i686 x86_64)
license=('GPL2')
url="http://www.xfce.org/"
groups=('xfce4')
depends=("libxfcegui4>=4.6.4" 'libwnck' 'hicolor-icon-theme')
makedepends=('pkgconfig' 'perlxml' 'xorg-server-utils' 'intltool')
optdepends=('fortune-mod:       for xfce4-tips')
replaces=('xfce4-toys' 'xfce4-session')
conflicts=('xfce4-session')
provides=('xfce4-session')
options=('!libtool')
install=${pkgname}.install
source=(http://www.xfce.org/archive/xfce-${pkgver}/src/xfce4-session-${pkgver}.tar.bz2 http://archive.ubuntu.com/ubuntu/pool/universe/x/xfce4-session/xfce4-session_$_patchver-1ubuntu3.diff.gz)
md5sums=('9d9890130e45e0e9476591ed9ba2c9d5'
         '56760d80555afbd180ad50f348db961e')

build() {
  cd $srcdir

  zcat ../xfce4-session_$_patchver-1ubuntu3.diff.gz | patch -p0
  rm $srcdir/xfce4-session-$_patchver/debian/patches/09_fix-typo-logout-dialog.patch

  cd $srcdir/xfce4-session-$pkgver

  for i in `ls ../xfce4-session-$_patchver/debian/patches/*.patch* | sort`
  do
    patch -p1 -s -i $i
    if [ $? = 0 ]; then
      echo "$i applied"
    else
      echo "Error processing $i"
      return 1
    fi
  done

  ./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/lib/xfce4 \
    --localstatedir=/var --disable-static \
    --enable-legacy-sm --disable-gnome --enable-session-screenshots \
    --with-shutdown-style=auto
  make
  make DESTDIR=$pkgdir install
}
