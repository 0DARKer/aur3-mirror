# Maintainer: Thomas Dziedzic < gostrc at gmail >
# Contributor: Anton Bazhenov <anton.bazhenov at gmail>
# Contributor: Blind <x15@gmx.net>

pkgname=vapor
pkgver=1.5.2
pkgrel=1
pkgdesc='A visualization and analysis platform for ocean, atmosphere, and solar researchers.'
arch=('i686' 'x86_64')
url='http://www.vapor.ucar.edu/'
license=('BSD')
depends=('qt3' 'netcdf' 'libgeotiff' 'perl')
optdepends=('bash: for some scripts'
            'tcsh: for some scripts'
            'perl: for some scripts')
source=("ftp://ftp.ucar.edu/vapor/source/$pkgname-$pkgver-src.tar.gz"
        "$pkgname.patch")
md5sums=('615ac60aaf1680689e98dbb14fe6a6d3'
         'c33c51eff7a197fb809a9a2fca694986')

build() {
  cd $pkgname-$pkgver/$pkgname

  # configure
  sed \
    -e "s,/usr/local,$pkgdir/usr," \
    -e "s,RELEASE=0,RELEASE=1," \
    -e "s,QTDIR =,QTDIR = /opt/qt," \
    -e "s,BUILD_AMR_SUPPORT = 0,BUILD_AMR_SUPPORT = 1," \
    -i options.mk
  sed "s,/usr/bin/install,/bin/install," -i make/config/Linux.mk

  # make and install
  #patch -Np0 -i ../../$pkgname.patch || return 1
  make || return 1
}

package() {
  cd $pkgname-$pkgver/$pkgname

  make install || return 1

  # fix paths in setup scripts
  sed "s,$pkgdir/usr,/usr," -i "$pkgdir"/usr/bin/$pkgname-setup.{csh,sh}

  # install license
  install -Dm644 LICENSE.htm "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.html
}
