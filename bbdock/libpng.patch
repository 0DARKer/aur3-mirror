diff -purN bbdock-0.2.9.orig/src/Slot.cc bbdock-0.2.9/src/Slot.cc
--- bbdock-0.2.9.orig/src/Slot.cc	2011-03-29 13:48:36.000000000 -0600
+++ bbdock-0.2.9/src/Slot.cc	2013-04-10 22:00:39.000000000 -0600
@@ -446,27 +446,28 @@ void Slot::loadIcon()
 			PNG_TRANSFORM_BGR,
 			0 );
 
-		if( !(info->valid & PNG_INFO_IDAT) ||
-			!(normalicon = new int[info->width*info->height]) )
+		width = png_get_image_width( png, info );
+		height = png_get_image_height( png, info );
+
+		if( !(png_get_valid( png, info, PNG_INFO_IDAT)) ||
+			!(normalicon = new int[width*height]) )
 			throw 0;
 
+		png_bytepp row_pointers = png_get_rows( png, info );
 		for( int y = 0, *src, *dest = normalicon; 
-			y < info->height && (src = (int *) info->row_pointers[y]); 
-			y++, dest += info->width )
-			memcpy( dest, src, info->width<<2 );
-
-		width = info->width;
-		height = info->height;
+			y < height && (src = (int *) row_pointers[y]); 
+			y++, dest += width )
+			memcpy( dest, src, width<<2 );
 
 		// convert grayscale image to rgb
-		if( info->color_type == PNG_COLOR_TYPE_GRAY_ALPHA )
-			for( int y = info->height, *line = normalicon;
-				--y; line += info->width )
+		if( png_get_color_type( png, info ) == PNG_COLOR_TYPE_GRAY_ALPHA )
+			for( int y = height, *line = normalicon;
+				--y; line += width )
 			{
-				unsigned char *dest = (unsigned char *) line+(info->width<<2);
-				unsigned char *src = (unsigned char *) line+(info->width<<1);
+				unsigned char *dest = (unsigned char *) line+(width<<2);
+				unsigned char *src = (unsigned char *) line+(width<<1);
 
-				for( int x = info->width; --x; )
+				for( int x = width; --x; )
 				{
 					*(--dest) = *(--src);
 					*(--dest) = *(--src);
