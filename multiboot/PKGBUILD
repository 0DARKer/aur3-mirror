# Maintainer: Dan Serban
# Contributor: Fabien Valthier <hcoohb #at- gmail #d0t- com>

pkgname=multiboot
pkgver=1.0050
pkgrel=1
pkgdesc="Create multiboot USB keys"
arch=(any)
url=http://liveusb.info/dotclear/index.php
license=(GPLv3)
depends=(squashfs-tools hal xz dosfstools cabextract rsync bash cdrkit unzip hdparm gettext parted xterm gksu gtkdialog zenity xdotool wmctrl fuseiso qemu imagemagick syslinux grub2-bios cryptsetup)
#depends=('gettext' 'udev' 'sudo' 'gtkdialog' 'zenity' 'xdotool' 'wmctrl' 'fuse' 'fuseiso' 'qemu' 'imagemagick' 'syslinux' 'grub2' 'cryptsetup' 'rsync' 'cdrkit' 'util-linux-ng' 'coreutils' 'xdg-utils' 'xterm' 'e2fsprogs' 'git' 'xz' 'dosfstools' 'mtools' 'parted' 'hdparm' 'gzip' 'unzip' 'lsof' 'vim')
optdepends=('virtualbox: To test live USB keys in a virtual machine')
source=("http://liveusb.info/multisystem/depot/dists/all/main/binary-i386/m/multisystem_${pkgver}_all.deb"
        "http://archive.ubuntu.com/ubuntu/pool/universe/f/fatresize/fatresize_1.0.2-6ubuntu1_i386.deb")
md5sums=('52e7af7c6bcd5c8ccc25b30359a46aee'
         '76b64525f582bf7ac88d086f39a14bd9')

build()
{
  ar -xv multisystem_${pkgver}_all.deb
  bsdtar -xvf data.tar.gz
  rm data.tar.gz
  ar -xv fatresize_1.0.2-6ubuntu1_i386.deb
  bsdtar -xvf data.tar.gz
  rm data.tar.gz
  cd "$srcdir/usr"
  rm -rf share
  cd "$srcdir/usr/local"
  mv bin share "$srcdir/usr/"
  cd "$srcdir/usr"
  rm -rf local
  mv sbin "$pkgdir/"
  mkdir "$pkgdir/usr"
  mv bin share "$pkgdir/usr/"
  sed -i 's#/usr/local/#/usr/#' "$pkgdir/usr/bin/multisystem"
  sed -i 's#/usr/local/#/usr/#;s#\[fr_FR\]##' "$pkgdir/usr/share/applications/multisystem-liveusb.desktop"
  sed -i 's#/usr/local/#/usr/#;s#\[fr_FR\]##' "$pkgdir/usr/share/applications/multisystem-vbox.desktop"
  sed -i '/testlist=/d' "$pkgdir/usr/share/multisystem/gui_multisystem.sh"
#  sed -i 's/"${detectprocess}" != "2"/"${detectprocess}" == "22"/' "$pkgdir/usr/share/multisystem/gui_multisystem.sh"
}
