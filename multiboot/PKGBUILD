 # Contributor: Fabien Valthier <hcoohb #at- gmail #d0t- com>

pkgname=multiboot
pkgver=v3
pkgrel=8
pkgdesc="A USB Multi-Boot maker"
arch=('any')
url=("http://liveusb.info/dotclear/index.php")
license=('GPL3')
depends=('gettext' 'udev' 'sudo' 'gtkdialog' 'zenity' 'xdotool' 'wmctrl' 'fuse' 'fuseiso' 'qemu' 'imagemagick' 'syslinux' 'grub2' 'cryptsetup' 'rsync' 'cdrkit' 'util-linux-ng' 'coreutils' 'xdg-utils' 'xterm' 'e2fsprogs' 'git' 'xz' 'dosfstools' 'mtools' 'parted' 'hdparm' 'gzip' 'unzip' 'lsof' 'vim')
makedepends=('wget')
optdepends=('virtualbox: To virtually test live USB')
provides=('MultiBoot')
source=('MultiBoot.desktop')
md5sums=('de17aad878521a0d42443866bb3bad4f') #generate with 'makepkg -g'

build() {
  wget "http://liveusb.info/MultiBoot-v3/MultiBoot-$pkgver.tar.bz2"
  #cp ../MultiBoot-$pkgver.tar.bz2 MultiBoot-$pkgver.tar.bz2
  tar xjf MultiBoot-$pkgver.tar.bz2
  cd "${srcdir}"/MultiBoot-$pkgver
  
  # delete the apt-get depedency
  sed -i '/apt-get/d' dependances.txt
  # delete the gksudo depedency
  sed -i '/gksudo/d' dependances.txt
  #modifying the script to start
  sed -i '/testlist=/d' gui-multiboot-liveusb.sh
  sed -i 's/"${detectprocess}" != "2"/"${detectprocess}" == "22"/' gui-multiboot-liveusb.sh

  install -d "${pkgdir}/usr/share/"{applications,pixmaps}
  install -Dm644 pixmaps/multiboot-v3-multiboot.png "${pkgdir}/usr/share/pixmaps"
  install -Dm644 "${srcdir}/MultiBoot.desktop" "${pkgdir}/usr/share/applications"
  install -d "${pkgdir}/usr/share/MultiBoot-$pkgver"
  mv "${srcdir}"/MultiBoot-$pkgver "${pkgdir}/usr/share"  || return 1
  chown -R root.root "${pkgdir}/usr/share/MultiBoot-$pkgver"
  

}
