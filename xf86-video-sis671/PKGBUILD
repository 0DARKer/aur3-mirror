# Maintainer: woelfchen <wwilke at genion dott de>

pkgname=xf86-video-sis671
pkgver=0.9.1
pkgrel=5
pkgdesc="X.org SiS671 video driver"
arch=('x86_64' 'i686')
url="http://web24.server5.publicompserver.de/linux/sis"
license=('custom')
depends=('glibc')
makedepends=('pkg-config' 'xorg-server>=1.9' 'xf86driproto' 'mesa>=7.5' 'glproto>=1.4.9' 'xf86dgaproto' 'xineramaproto' 'xorg-server-devel')
conflicts=('xorg-server>=1.9.9' 'xorg-server<1.9')
groups=('xorg-video-drivers')
source=($url/$pkgname-$pkgver.tar.gz
	$url/Makefile.patch
        $url/sis_mergedfb.patch
	$url/sis_driver.patch
	$url/sis_utility.patch)
md5sums=('8dc6a330720d0f184c8bb85bece71be6' 
	 '4d7e8ac1a0901873a909ffb5145c9b23'
         '4f365ce99ec130c6264937d05094c52a'
	 '4ce2ec313bb332131b0ac71575021ac8'
	 '7637c8c7f7d05c81af4cb0b6fd8934a5')


build() {
  cd "${srcdir}/$pkgname-$pkgver"
  patch -p0 < ../sis_mergedfb.patch || return 1
  patch -p0 < ../sis_driver.patch || return 1
  patch -p0 < ../sis_utility.patch || return 1
  ./configure --prefix=/usr   --enable-dri || return 1
  patch -p0 < ../Makefile.patch || return 1
  make || return 1
  mkdir -p "${pkgdir}/usr/lib/xorg/modules/drivers"  || return 1
  cp src/.libs/sis671_drv.so "${pkgdir}/usr/lib/xorg/modules/drivers"
  mkdir -p "${pkgdir}/usr/share/licenses/xf86-video-sis671"
  cp copying "${pkgdir}/usr/share/licenses/xf86-video-sis671/COPYING"
}

