# Contributor: Liu Chang <goduck777@gmail.com>

pkgname=wallproxy-svn
pkgver=37
pkgrel=1
pkgdesc="A http proxy based on GAppProxy."
license=('GPL')
url="http://code.google.com/p/wallproxy/"
depends=('python' 'pyopenssl')
conflicts=('wallproxy')
provides=('wallproxy')
md5sums=('b06d28e58fc2791c990638a943a82099' 'cc4a4e0e2098e74ef3eedd774798e53a')
source=(wallproxy.png wallproxy.desktop)
arch=('i686' 'x86_64')

_svntrunk="http://wallproxy.googlecode.com/svn/trunk/"
_svnmod="wallproxy-read-only"

build() { 

cd $startdir/src

    msg "Updating SVN entries for $_svnmod..."
    svn checkout $_svntrunk $_svnmod
    svn export $_svnmod wallproxy-${pkgver}
    msg "SVN checkout done or server timeout"

    # install gappproxy
    sed -i -e "s|python|python2|" $srcdir/wallproxy-${pkgver}/local/*.py
    mkdir -p $pkgdir/opt/wallproxy/
    cp -R $srcdir/wallproxy-${pkgver}/* $pkgdir/opt/wallproxy/
    # make shortcut
    mkdir -p $pkgdir/usr/bin/
    mkdir -p $pkgdir/usr/share/pixmaps/
    mkdir -p $pkgdir/usr/share/applications/
    ln -s /opt/wallproxy/local/proxy.py $pkgdir/usr/bin/wallproxy
    cp $startdir/wallproxy.png $pkgdir/usr/share/pixmaps/
    cp $startdir/wallproxy.desktop $pkgdir/usr/share/applications/
}
