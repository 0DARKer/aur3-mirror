# Maintainer: L <alaviss at gmail dot c o m>

pkgname=sachesi
_pkgname=Sachesi #no uppercase letter in pkgname
pkgver=git
pkgrel=1
pkgdesc="Firmware, extractor, searcher and installer for Blackberry 10"
arch=('i686' 'x86_64')
url="https://github.com/xsacha/Sachesi"
license=('GPL3')
depends=('qt5-base' 'qt5-quick1' 'qt5-quickcontrols' 'quazip'
         'libusb' 'openssl' 'zlib')
makedepends=('git' 'gendesk')
source=(git+https://github.com/xsacha/Sachesi.git
        shared.patch)
sha1sums=('SKIP'
          'f4f3a5aa219dbce1644108cf73be80d7941cef58')

pkgver() {
  cd "${srcdir}/${_pkgname}"
  git describe --tags --long | sed 's/-/.r/;s/-/./g'
}

prepare() {
  cd "$srcdir/$pkgname"
  # Use system quazip
  patch -p0 -i "$srcdir/shared.patch"
}

build() {
  cd "$srcdir/$pkgname"
  qmake-qt5 -makefile
  make ${MAKEFLAGS}
}

package() {
  cd "$srcdir/$pkgname"
  install -dm755 "${pkgdir}/usr/bin"
  install -dm755 "${pkgdir}/usr/share/licenses/${_pkgname}"
  install -dm755 "${pkgdir}/usr/share/applications"
  install -Dm755 Sachesi "${pkgdir}/usr/bin/Sachesi"
  install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${_pkgname}/LICENSE"
  # Generate desktop file
  gendesk --pkgname=${_pkgname} --pkgdesc="${pkgdesc}" -n
  install -Dm644 Sachesi.desktop "${pkgdir}/usr/share/applications/Sachesi.desktop"
}
