# Maintainer: Artem Vorotnikov <artem@vorotnikov.me>
# Original author: tritonas00 <tritonas00@gmail.com>

pkgname=rigsofrods-git
pkgver=$(date +%Y%m%d)
_pkgname=rigs-of-rods
pkgrel=1
pkgdesc="An open source vehicle simulator based on soft-body physics"
arch=('i686' 'x86_64')
url="http://www.rigsofrods.com"
license=('GPL')
depends=('angelscript-2.22.1' 'openal' 'wxgtk' 'ogre-1.8' 'caelum' 'mygui' 'ogre-pagedgeometry' 'socketw')
makedepends=('cmake' 'git')
source=("git://github.com/RigsOfRods/rigs-of-rods.git"
        "plugins.cfg"
        "rigsofrods.png"
        "RoRConfig.desktop"
        "RoR.desktop")
sha512sums=('SKIP'
            '49ba63feecdd3b8cc3cb09a931ebecf39dbc61f7e8c4db597ef3309f770227cb2e5fb0aa8626822b7d7dea6dfc571ca538921a065406d3f0c201270eafbdf670'
            '8280ddec6dba37e66c323e469c1894bacc3b592b6ea1f7fd3876bc9e7253b14b4949c3c51d7dd47ad7bd78e085fbe51aad83b1e8d0b0755deda426129e4a6710'
            '28f6fffb1d08c0f16e263c0026e57053e3c43647a176325a91fdafd19b78ec6cbb23f64ca3a5398b3545f2ba73e69e2b2c58c361c0fb35c582fe294436001d27'
            'fcee26f37c9786f6e7fc1ba806516b02579eeb6b11d27af8a56966f148ee8ad1381596609c2475704bd0f29ae4ffb2377ac925de29248327ea1ace1736456a23'
)

build() {
  cd "$srcdir/${_pkgname}"

  export PKG_CONFIG_PATH="/opt/OGRE-1.8/lib/pkgconfig:$PKG_CONFIG_PATH"
  export LD_LIBRARY_PATH="/opt/OGRE-1.8/lib:$LD_LIBRARY_PATH"
  
  cmake -DROR_USE_MYGUI="TRUE" \
-DROR_USE_OPENAL="TRUE" \
-DROR_USE_SOCKETW="TRUE" \
-DROR_USE_PAGED="TRUE" \
-DROR_USE_CAELUM="TRUE" \
-DROR_USE_ANGELSCRIPT="TRUE" \
-DANGELSCRIPT_INCLUDE_DIRS=/opt/ror/include \
-DANGELSCRIPT_LIBRARIES=/opt/ror/lib/libangelscript.so \
-DCMAKE_BUILD_TYPE=RELEASE \
.

  make
}

package() {
cd "$srcdir"

mkdir -p "$pkgdir/opt/ror/rigsofrods"
cp -r $srcdir/${_pkgname}/bin/* "$pkgdir/opt/ror/rigsofrods/"

install -Dm755 rigsofrods.png "$pkgdir/usr/share/pixmaps/rigsofrods.png"
install -Dm755 RoR.desktop "$pkgdir/usr/share/applications/RoR.desktop"
install -Dm755 RoRConfig.desktop "$pkgdir/usr/share/applications/RoRConfig.desktop"
install -Dm755 plugins.cfg "$pkgdir/opt/ror/rigsofrods/plugins.cfg"
}
