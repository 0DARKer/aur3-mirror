# Maintainer: Michael DÃ¼ll <mail@akurei.me> PGP-Key: 6D666EC8
# Contributor: Limao Luo <luolimao+AUR@gmail.com>
# Contributor: Roozbeh Shafiee <Roozbeh@Roozbeh.us>
pkgname=choqok-git
pkgver=20130619
pkgrel=1
pkgdesc="A Twitter/identi.ca/laconica client for KDE 4. GIT version."
url="http://choqok.gnufolks.org"
license=("GPL")
arch=('i686' 'x86_64')
depends=('kdelibs' 'qjson' 'qoauth' 'qca-ossl')
makedepends=('git' 'cmake' 'automoc4' 'docbook-xsl')
conflicts=('choqok-svn' 'choqok')
provides=('choqok')
install="${pkgname}.install"

_gitroot="git://anongit.kde.org/choqok"
_gitname="choqok"

build() {
    cd ${srcdir}
    msg "Connecting to GIT server...."

    if [ -d "${srcdir}/${_gitname}" ] ; then
        cd ${_gitname} && git pull --rebase
    else
        git clone ${_gitroot} ${_gitname}
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    rm -rf ${srcdir}/build
    mkdir -p ${srcdir}/build
    cd ${srcdir}/build

    cmake -DCMAKE_INSTALL_PREFIX=$( kde4-config --prefix ) -DCMAKE_BUILD_TYPE=Release ../${_gitname}

    make
}

package() {
    cd ${srcdir}/build
    make DESTDIR=$pkgdir install
}
