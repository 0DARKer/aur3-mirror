# Maintainer: Clément Guérin <geecko.dev@free.fr>
pkgname=ppsspp-git
pkgver=20121105
pkgrel=1
pkgdesc="A PSP emulator for Android, Windows, Mac, and Linux, written in C++."
arch=('i686' 'x86_64')
url="http://www.ppsspp.org/"
license=('GPL2')
depends=('zlib' 'sdl')
makedepends=('git' 'cmake' 'gcc')
optdepends=()
provides=('ppsspp')

build() {
  cd $srcdir

  if [ -d ppsspp ] ; then
    cd ppsspp && git pull origin
  else
    git clone git://github.com/hrydgard/ppsspp.git
  fi

  cd $srcdir/ppsspp
  
  git submodule init
  git submodule update
  
  export LDFLAGS=""
  
  cd SDL
  ./buildassets.sh
  ./b.sh
}

package() {
  cd $pkgdir
  
  mkdir -p usr/bin
  mkdir -p usr/share/ppsspp
  
  cp $srcdir/ppsspp/SDL/build/ppsspp ./usr/share/ppsspp
  cp $srcdir/ppsspp/SDL/build/ppsspp-headless ./usr/share/ppsspp
  cp -r $srcdir/ppsspp/SDL/assets/ ./usr/share/ppsspp
  
  cd ./usr/bin/
  
  echo '#!/bin/bash' > ppsspp
  echo 'cd /usr/share/ppsspp' >> ppsspp
  echo './ppsspp' >> ppsspp
  chmod +x ppsspp
  
  echo '#!/bin/bash' > ppsspp-headless
  echo 'cd /usr/share/ppsspp' >> ppsspp-headless
  echo './ppsspp-headless' >> ppsspp-headless
  chmod +x ppsspp-headless
}
