# Maintainer: Clément Guérin <geecko.dev@free.fr>
pkgname=ppsspp-git
pkgver=20121206
pkgrel=1
pkgdesc="A PSP emulator for Android, Windows, Mac, and Linux, written in C++."
arch=('i686' 'x86_64')
url="http://www.ppsspp.org/"
license=('GPL2')
depends=('zlib' 'sdl')
makedepends=('git' 'cmake' 'gcc')
optdepends=()
provides=('ppsspp')

build() {
  cd $srcdir

  if [ -d ppsspp ] ; then
    cd ppsspp && git pull origin
  else
    git clone git://github.com/hrydgard/ppsspp.git
  fi

  cd $srcdir/ppsspp
  
  git submodule update --init
  
  export LDFLAGS=""
  
  ./b.sh
}

package() {
  cd $pkgdir
  
  mkdir -p usr/bin
  mkdir -p usr/share/ppsspp
  
  cp $srcdir/ppsspp/build/PPSSPPHeadless ./usr/share/ppsspp
  cp $srcdir/ppsspp/build/PPSSPPSDL ./usr/share/ppsspp
  cp -r $srcdir/ppsspp/assets/ ./usr/share/ppsspp
  
  cd ./usr/bin/
  
  echo '#!/bin/bash' > PPSSPPSDL
  echo 'cd /usr/share/ppsspp' >> PPSSPPSDL
  echo './PPSSPPSDL' >> PPSSPPSDL
  chmod +x PPSSPPSDL
  
  echo '#!/bin/bash' > PPSSPPHeadless
  echo 'cd /usr/share/ppsspp' >> PPSSPPHeadless
  echo './PPSSPPHeadless' >> PPSSPPHeadless
  chmod +x PPSSPPHeadless
}
