# Maintainer: Clement Guerin <geecko.dev@free.fr>
# Contributor: Thiago Kenji Okada <thiago DOT mast3r AT gmail DOT com>
pkgname=ppsspp-git
pkgver=20130726
pkgrel=1
pkgdesc="A PSP emulator for Android, Windows, Mac, and Linux, written in C++."
arch=('i686' 'x86_64')
url="http://www.ppsspp.org/"
license=('GPL2')
depends=('zlib' 'sdl' 'ffmpeg')
makedepends=('git' 'cmake' 'gcc')
optdepends=()
provides=('ppsspp')
source=('ppsspp::git://github.com/hrydgard/ppsspp.git#branch=master')
md5sums=('SKIP')

build() {
	cd $srcdir/ppsspp

	git submodule update --init

	export LDFLAGS="-lavutil -lavformat -lavcodec -lswscale -lswresample"

	mkdir build
	pushd build
	cmake ..
	make
	popd
}

package() {
	cd $pkgdir

	mkdir -p usr/bin
	mkdir -p usr/share/ppsspp

	cp $srcdir/ppsspp/build/PPSSPPSDL ./usr/share/ppsspp
	cp -r $srcdir/ppsspp/build/assets/ ./usr/share/ppsspp

	cd ./usr/bin/

	echo '#!/bin/bash' > PPSSPPSDL
	echo 'cd /usr/share/ppsspp' >> PPSSPPSDL
	echo './PPSSPPSDL' >> PPSSPPSDL
	chmod +x PPSSPPSDL
}
