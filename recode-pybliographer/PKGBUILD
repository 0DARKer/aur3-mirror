# Maintainer: Chad Aeschliman <chadaeschliman at gmail dot com>
# Contributor: eric <eric@archlinux.org>
# Contributor: Tom Newsom <Jeepster@gmx.co.uk>
# Contributor: Stefan Husmann <stefan-husmann@t-oline.de>

pkgname=recode-pybliographer
pkgver=3.6
pkgrel=5
url="http://directory.fsf.org/recode.html"
arch=('i686' 'x86_64')
license=('GPL')
pkgdesc="Converts files between various character sets and usages patched with pybliographer patch"
conflicts=('recode')
provides=('recode')
install=recode-pybliographer.install
source=("http://recode.progiciels-bpi.ca/archives/recode.tar.gz" \
  recode.patch)
md5sums=('be3f40ad2e93dae5cd5f628264bf1877' '23564aea992408803eea0fecf12952d3')

build() {
  cd $srcdir/recode-$pkgver
  
  # Patching it with pybliographer recode patch and another small
  # patch needed to compile
  if [ "$CARCH" = "x86_64" ]; then
    rm config.sub config.guess
    install -Dm755 /usr/share/libtool/config/config.sub config.sub
    install -Dm755 /usr/share/libtool/config/config.guess config.guess
  fi || return 1

  patch -Np1 -i $srcdir/recode.patch || return 1
  ./configure --prefix=/usr --infodir=/usr/share/info || return 1
  make || return 1
  make prefix=$pkgdir/usr infodir=$pkgdir/usr/share/info \
    install || return 1
  find $pkgdir -name '*.la' -exec rm {} \; || return 1
  rm $pkgdir/usr/share/info/dir || return 1
  for _i in  $pkgdir/usr/share/info/recode.info*
  do
    gzip ${_i}
  done || return 1
}
