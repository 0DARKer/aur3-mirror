# Maintainer: Luis Sarmiento <lgsarmientop-ala-unal.edu.co>

pkgname=upak
pkgver=10.6.8
pkgrel=2
pkgdesc="HRIBF Data Acquisition and analysis."
url="http://www.phy.ornl.gov/local/computer/daq/daqsupport.shtml"
arch=('x86_64')
license=('unknown')
depends=('libx11' 'gcc-libs' 'tcsh')
makedepends=('gcc-fortran>=4.2')
source=("ftp://ftp.phy.ornl.gov/pub/${pkgname}/${pkgname}-src.tgz"
	"Makefile_64bits_intel.patch")
md5sums=('8ea938e72020b75cf1ca356d27821823'
         '2dedd08fc175063ac3ec97bb98671475')

build() {
## path Makefile
	 cd "${srcdir}/${pkgname}"
	 patch -Np2 < ${srcdir}/Makefile_64bits_intel.patch
	 
##compile
	_INSTALL_DIRECTORY=${pkgdir}/usr/bin
	mkdir -p ${_INSTALL_DIRECTORY}
	cd "${srcdir}/${pkgname}"
	make clean
	make INSTALL_DIR=${_INSTALL_DIRECTORY} all
}

package() {
	  [ -d ${pkgdir}/usr/lib ] || install -d ${pkgdir}/usr/lib
	  install -Dm755 ${pkgdir}/usr/bin/*.a ${pkgdir}/usr/lib/
	  rm -f ${pkgdir}/usr/bin/*.a
	  
#documentation
	  _DOCDIR=usr/share/doc/${pkgname}
	  [ -d ${pkgdir}/${_DOCDIR} ] || install -d ${pkgdir}/${_DOCDIR}
	  install -Dm644 ${pkgdir}/usr/bin/*.* ${pkgdir}/${_DOCDIR}
	  rm -f ${pkgdir}/usr/bin/*.*

	  cd "${srcdir}/${pkgname}"
	  install -m644 Dreadme/*.doc   ${pkgdir}/${_DOCDIR}
	  install -m644 Dreadme/README-Apr07   ${pkgdir}/${_DOCDIR}
	  install -m644 Dreadme/readme.tex    ${pkgdir}/${_DOCDIR}/readme.txt 
	  install -m644 Dreadme/dvd.tex    ${pkgdir}/${_DOCDIR}/dvd.txt 

	  install -m644 ${pkgdir}/usr/bin/doc/*  ${pkgdir}/${_DOCDIR}
	  rm -rf ${pkgdir}/usr/bin/doc

#permission issues
	  chmod 755 ${pkgdir}/usr/bin/*

}
