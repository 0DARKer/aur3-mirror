# Maintainer: Christian Hesse <mail@eworm.de>

pkgname=vmware-view-client
pkgver=1.7.0.0
pkgrel=3
pkgdesc="VMware View Client connects to virtual machines managed by VMware View (proprietary version with PCoIP support)"
conflicts=('vmware-view-open-client' 'vmware-view-open-client-beta')
arch=('i686' 'x86_64')
url="https://my.vmware.com/web/vmware/info/slug/desktop_end_user_computing/vmware_view/5_0"
license=('custom')
source=("http://archive.canonical.com/pool/partner/v/vmware-view-client/vmware-view-client_${pkgver}.orig.tar.gz"
	'tmpfiles.conf'
	'vmware-view-client.desktop')
depends=()
optdepends=('rdesktop: for RDP remote desktop connections')
install=vmware-view-client.install

if [[ "${CARCH}" == 'x86_64' ]]; then
	_libprefix='lib32-'
else
	_libprefix=''
fi
# no spaces here
depends+=(${_libprefix}{'openssl098','libpng12','gtk2','libxml2','libxtst'})
optdepends+=(${_libprefix}'libudev-compat: for USB redirect support')

package() {
	cd "${srcdir}/vmware-view-client-${pkgver}"

	for FILE in $(find -type f); do
		install -D ${FILE} ${pkgdir}/${FILE}
	done

	# set uid for USB access
	chmod +s ${pkgdir}/usr/lib/vmware/vmware-{usbarbitrator,view-usbd}

	# this needs to be writeable for USB redirection
	install -d ${pkgdir}/var/run/vmware
	install -D -m644 ${srcdir}/tmpfiles.conf ${pkgdir}/usr/lib/tmpfiles.d/vmware-view-client.conf

	# desktop file for menu entries
	install -D -m644 ${srcdir}/vmware-view-client.desktop ${pkgdir}/usr/share/applications/vmware-view-client.desktop
}

sha256sums=('6d148d3fec05a015f702269b14812b5d56e3e65212eeb2e2174b3c5ec178e2d4'
            'ec763930dd50d6e77a31c40c939909752cfb124cafb0a4ca4f76860375a14d75'
            'af6893b96e07e9e8023d64eaa4cece90c73890d744e4d91d80cfdcd3120b60bd')
