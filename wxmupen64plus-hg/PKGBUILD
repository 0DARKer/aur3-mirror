# Maintainer: Abelardo Ricart <aricart@gmail.com>
# Contributor: parsiad

pkgname='wxmupen64plus-hg'
pkgver=531
pkgrel=3
pkgdesc='An experimental Mupen64Plus frontend written with wxWidgets'
url='https://bitbucket.org/auria/wxmupen64plus/'
depends=('wxgtk2.9' 'sdl')
conflicts=('wxmupen64plus')
makedepends=('mercurial' 'python' 'mupen64plus-core-hg')
source=('Scripting.py.patch' 'wscript.patch' 'wxmupen64plus.desktop')
md5sums=('87585b7c826bd062db55a8e9abdbbf47' 
'f5fff75c3b8a8de21315bd87dc9804a9'
'abe57a02b9366b63b83967f94bc3dc5c')
arch=('i686' 'x86_64')
license=('GPL')
install="wxmupen64plus-hg.install"
optdepends=('mupen64plus-input-sdl-hg'
            'mupen64plus-rsp-hle-hg'
            'mupen64plus-audio-sdl-hg'
            'mupen64plus-video-rice-hg')

_hgroot='http://bitbucket.org/auria'
_hgrepo='wxmupen64plus'

build()
{
	# With this patch, you can use the waf version in the 
	# community repo. We'll still build using the package
	# distributed version for now.
	cd "${srcdir}/${_hgrepo}/waflib"
	patch -p0 < "${srcdir}/Scripting.py.patch"
	
	# Fix some wscript nastiness.
	cd "${srcdir}/${_hgrepo}"
	patch -p0 < "${srcdir}/wscript.patch"
	
	./waf --mupenapi="/usr/include/mupen64plus" --wxconfig="/usr/bin/wx-config-2.9" --libdir="/usr/lib" --prefix="${pkgdir}/usr" configure
	./waf
	./waf install

	install -Dm644 "${srcdir}/${_hgrepo}/License.txt" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
	install -Dm644 "${srcdir}/wxmupen64plus.desktop" "${pkgdir}/usr/share/applications/wxmupen64plus.desktop"
}
