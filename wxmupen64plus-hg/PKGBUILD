pkgname="wxmupen64plus-hg"
pkgver=1
pkgrel=1
pkgdesc="An experimental Mupen64Plus frontend written with wxWidgets"
url="https://bitbucket.org/auria/wxmupen64plus/"
depends=("wxgtk-2.9")
makedepends=("mercurial" "python-waf" "tar")
arch=("i686" "x86_64")
license=('GPL')

_hgroot="http://bitbucket.org/auria"
_hgrepo="wxmupen64plus"

build()
{
	# m64p
	mkdir -p "${srcdir}/m64p"
	cd "${srcdir}/m64p"
	wget http://bitbucket.org/richard42/mupen64plus-core/raw/f92cdb8e288e/tools/m64p_helper_scripts.tar.gz || return 1
	tar xvfz m64p_helper_scripts.tar.gz
	./m64p_get.sh || return 1
	./m64p_build.sh || return 1

	mkdir -p "${pkgdir}/usr/lib/wxmupen64plus"
	cp test/*.so "${pkgdir}/usr/lib/wxmupen64plus"
	cp test/libmupen64plus.so.2.0.0 "${pkgdir}/usr/lib/wxmupen64plus/libmupen64plus.so"

	# wxmupen64plus
	cd "${srcdir}/${_hgrepo}"
	waf configure --mupenapi="${srcdir}/m64p/source/mupen64plus-core/src/api" --wxconfig=`which wx-config-2.9` || return 1
	waf || return 1

	mkdir -p "${pkgdir}/usr/bin"
	cp build/wxmupen64plus "${pkgdir}/usr/bin/"

	mkdir -p "${pkgdir}/usr/share/wxmupen64plus"
	cp data/* "${pkgdir}/usr/share/wxmupen64plus"
}
