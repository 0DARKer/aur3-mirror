# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=audio-recorder-bzr
pkgver=321
pkgrel=1
pkgdesc="Audio recorder for GNOME and Unity Desktops"
arch=('i686' 'x86_64')
url="https://launchpad.net/audio-recorder"
license=('GPL')
# Add libappindicator3 for indicator applet support
depends=('dbus-glib' 'gconf' 'gst-plugins-bad' 'gst-plugins-base' 'gst-plugins-good' 'gstreamer' 'gtk3' 'libgnome-media-profiles' 'libpulse')
makedepends=('bzr' 'intltool')
conflicts=('audio-recorder')
provides=('audio-recorder')
_bzrmod="audio-recorder"
_bzrtrunk="lp:${_bzrmod}"

build() {
  cd "${srcdir}"

  msg "Connecting to Bazaar server...."

  if [ -d ${_bzrmod} ] ; then
    cd ${_bzrmod} && bzr pull -r ${pkgver}
    msg "The local files are updated."
  else
    bzr branch ${_bzrtrunk} -r ${pkgver}
  fi

  msg "Bazaar checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${srcdir}/${_bzrmod}-build"
  cp -r "${srcdir}/${_bzrmod}" "${srcdir}/${_bzrmod}-build"
  cd "${srcdir}/${_bzrmod}-build"

  autoreconf -vfi
  ./configure --prefix=/usr
  make
}

package() {
  cd "${srcdir}/${_bzrmod}-build"
  make DESTDIR="${pkgdir}/" install
}
