diff -Naur melt-0.9.1-plugin-for-gcc-4.6-old/melt-run.proto.h melt-0.9.1-plugin-for-gcc-4.6/melt-run.proto.h
--- melt-0.9.1-plugin-for-gcc-4.6-old/melt-run.proto.h	2011-10-06 04:12:45.000000000 +1000
+++ melt-0.9.1-plugin-for-gcc-4.6/melt-run.proto.h	2011-10-26 17:16:32.000000000 +1000
@@ -57,8 +57,15 @@
 
 
 /* Headers from c-family/ should be included before diagnostics.h.  */
+/* Headers from c-family/ should be included directly with GCC4.6, but not with GCC 4.7
+   or when compiling with a C++ compiler. */
+#if defined(GCCPLUGIN_VERSION) || MELT_GCC_VERSION>4006 || defined(__cplusplus)
 #include "c-family/c-pragma.h"
 #include "c-family/c-pretty-print.h"
+#else
+#include "c-pragma.h"
+#include "c-pretty-print.h"
+#endif
 
 #include "diagnostic.h"
 #include "flags.h"
