# Maintainer : Derek Frank <dmfrank at gmx dot com>

_pkgbase="macfanctl"
_pkgconf="${_pkgbase}.conf"
_pkgname="${_pkgbase}d"
_pkgman="${_pkgname}.1"
_systemd="${_pkgname}.service"

pkgname="${_pkgname}-git"
pkgver=1
pkgrel=6
pkgdesc='Git release for Intel Mac fan control with Systemd support.'
arch=('i686', 'x86_64')
url="https://github.com/MikaelStrom/${_pkgname}"
_giturl="git://github.com/MikaelStrom/${_pkgname}.git"
license=('GPL')
conflicts=("${_pkgname}", "${_pkgname}-bzr")
provides=("${_pkgname}")
depends=('glibc')
makedepends=('gcc' 'git')
source=("${_systemd}")
md5sums=('54235124edeb7bf7791e24bc5c812290')
install="${_pkgbase}.install"
backup=("etc/${_pkgconf}")

build() {
    cd "${srcdir}"
    msg 'Connecting to GIT server....'

    if [ -d "${pkgname}" ] ; then
        cd "${pkgname}" && git pull origin
        msg 'The local files are updated.'
    else
        git clone "${_giturl}" "${pkgname}"
    fi

    msg 'GIT checkout done or server timeout'

    msg 'Making macfanctld....'
    cd "${srcdir}/${pkgname}"
    make

	msg 'Packaging....'
}

package() {
    install -Dm755 "${srcdir}/${pkgname}/${_pkgname}" "${pkgdir}/usr/bin/${_pkgname}"

    # Config file
    install -Dm644 "${srcdir}/${pkgname}/${_pkgconf}" "${pkgdir}/etc/${_pkgconf}"

    # Man page
    install -Dm644 "${srcdir}/${pkgname}/${_pkgman}" "${pkgdir}/usr/share/man/man1/${_pkgman}"

    # Systemd
    install -Dm644 "${srcdir}/${_systemd}" "${pkgdir}/usr/lib/systemd/system/${_systemd}"
}
