# Contributor: Douglas Soares de Andrade <dsandrade@gmail.com>
# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>

pkgname=txt2tags3
pkgver=2.6
pkgrel=1
pkgdesc="A text formatting and conversion tool. Python3-version."
arch=('any')
url="http://www.txt2tags.org"
license=('GPL')
depends=('python')
optdepends=('ruby: for running t2tmake.rb' 'sh: for running html-update.sh' \
            'vim: for using the vim-files')
makedepends=('gettext')
conflicts=('txt2tags')
provides=('txt2tags')
source=(http://txt2tags.googlecode.com/files/txt2tags-$pkgver.tgz http://txt2tags.googlecode.com/svn/branches/python3/txt2tags)
md5sums=('ac09fd624f1e3a553d5f0e01271cc0ee'
         '12786a4423eadec9fdd314df176f2f53')

build() {
  cd $srcdir/txt2tags-$pkgver

}
package() {
  install -d $pkgdir/usr/share/vim/vimfiles/{plugin,syntax,compiler,macros}
  install -d $pkgdir/usr/share/man/{it,pt_BR,fr,es,ca}/man1
  install -d $pkgdir/usr/share/man/man1
  cd $srcdir/txt2tags-$pkgver
  install -Dm755 txt2tags $pkgdir/usr/bin/txt2tags
  install -Dm644 extras/pagemaker.vim \
    $pkgdir/usr/share/vim/vimfiles/syntax/pagemaker.vim
  install -Dm644 extras/txt2tags.vim \
    $pkgdir/usr/share/vim/vimfiles/syntax/txt2tags.vim
  install -Dm644 extras/gvim-menu.vim \
    $pkgdir/usr/share/vim/vimfiles/plugin/txt2tags-gvim-menu.vim
  install -Dm644 extras/txt2tags-compiler.vim \
    $pkgdir/usr/share/vim/vimfiles/compiler/txt2tags-compiler.vim
  install -Dm644 extras/unhtml.vim \
    $pkgdir/usr/share/vim/vimfiles/macros/unhtml.vim

   	# Installing other extra tools
  install -m755 extras/{t2tmake.rb,gensite,html-update.sh} $pkgdir/usr/bin

	# Handling the manpage
  cd doc
  for _language in {"it","pt","fr","es","ca"}; do
    install -Dm644 manpage-${_language}.man txt2tags.1-${_language};
    if [ ${_language} == "pt" ]; then
      cp txt2tags.1-${_language} \
	$pkgdir/usr/share/man/pt_BR/man1/txt2tags.1;
    else
      install -Dm644 txt2tags.1-${_language} \
	$pkgdir/usr/share/man/$language/man1/txt2tags.1;
    fi
  done
  
	# English manpage
  install -Dm644 manpage.man $pkgdir/usr/share/man/man1/txt2tags.1
  cd ../po
  for _i in *.po
  do
    msgfmt -o ${_i%.po}.mo ${_i}
    install -Dm644 ${_i%.po}.mo \
      $pkgdir/usr/share/locale/${_i%.po}/LC_MESSAGES/txt2tags.mo
  done
  install -Dm755 $srcdir/txt2tags $pkgdir/usr/bin/txt2tags
}
