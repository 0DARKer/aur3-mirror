From 5caebf28139b73ef3e9e34f484e4f15f7d7697a2 Mon Sep 17 00:00:00 2001
From: wbagdon <wbagdon@gmail.com>
Date: Sun, 11 Mar 2012 00:40:03 -0500
Subject: [PATCH 2/3] support for libpng15

---
 xbmc/lib/cximage-6.0/CxImage/ximapng.h | 17 +++++++++++------
 1 file changed, 11 insertions(+), 6 deletions(-)

diff --git a/xbmc/lib/cximage-6.0/CxImage/ximapng.h b/xbmc/lib/cximage-6.0/CxImage/ximapng.h
index 3201d13..c7c59b9 100644
--- a/xbmc/lib/cximage-6.0/CxImage/ximapng.h
+++ b/xbmc/lib/cximage-6.0/CxImage/ximapng.h
@@ -22,12 +22,12 @@
 #if CXIMAGE_SUPPORT_PNG
 
 extern "C" {
-#ifdef _LINUX
-#undef _DLL
+#ifdef _LINUX
+#undef _DLL
 #include <png.h>
-#else
+#else
 #include "../png/png.h"
-#endif
+#endif
 }
 
 class CxImagePNG: public CxImage
@@ -67,13 +67,18 @@ protected:
 		if (hFile == NULL || !hFile->Flush()) png_error(png_ptr, "Flush Error");
 	}
 
-    static void PNGAPI user_error_fn(png_structp png_ptr,png_const_charp error_msg)
+    	static void PNGAPI user_error_fn(png_structp png_ptr,png_const_charp error_msg)
 	{
+#if PNG_LIBPNG_VER > 10399
+		strncpy((char*)png_get_error_ptr(png_ptr), error_msg, 255);
+		longjmp(png_jmpbuf(png_ptr), 1);
+#else
 		strncpy((char*)png_ptr->error_ptr,error_msg,255);
 		longjmp(png_ptr->jmpbuf, 1);
+#endif
 	}
 };
 
 #endif
 
-#endif
+#endif
\ No newline at end of file
-- 
1.7.11.4

