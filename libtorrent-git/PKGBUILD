# Maintainer:   Lucky <archlinux@builds.lucky.li>
# Based on libtorrent [community]

pkgname=libtorrent-git
_pkgname="${pkgname%-*}"
pkgver=1261.7bf571c
pkgrel=1
pkgdesc="BitTorrent library written in C++"
url="http://libtorrent.rakshasa.no"
license=("GPL")
arch=("i686" "x86_64")
depends=("libsigc++" "openssl")
makedepends=("cppunit" "git")
options=("!libtool")
conflicts=("${_pkgname}")
provides=("${_pkgname}")
source=("git://github.com/rakshasa/${_pkgname}.git")
md5sums=("SKIP")

pkgver() {
  cd "${_pkgname}"
  #git describe --always | sed "s|^${_pkgname}-||g;s|-|.|g"
  echo $(git rev-list --count master).$(git rev-parse --short master)
  #date +%Y%m%d
}

build() {
  cd "${srcdir}/${_pkgname}"

  ./autogen.sh
#  export LIBS="${LIBS} -lpthread"
  export CXXFLAGS="${CXXFLAGS} -fno-strict-aliasing"
  ./configure --prefix=/usr --disable-debug

  make
}

package() {
  cd "${srcdir}/${_pkgname}"

  make DESTDIR="${pkgdir}" install
}
