diff --git a/src/encoding-dialog.c b/src/encoding-dialog.c
index d71271e..2c7cb68 100644
--- a/src/encoding-dialog.c
+++ b/src/encoding-dialog.c
@@ -85,10 +85,12 @@ static char*
 encoding_dialog_get_encoding(GtkDialog* dialog)
 {
     GtkComboBox* combobox;
+    GtkEntry* entry;
 
     combobox = g_object_get_data(G_OBJECT(dialog), "encoding_entry");
+    entry = GTK_ENTRY (gtk_bin_get_child (GTK_BIN (combobox)));
 
-    return gtk_combo_box_get_active_text(combobox);
+    return g_strdup(gtk_entry_get_text(entry));
 }
 
 GtkDialog*
@@ -97,7 +99,7 @@ encoding_dialog_new(GtkWindow* parent)
     GtkBuilder* builder;
     GObject* object;
     GtkDialog* dialog;
-    GtkComboBoxEntry* entry;
+    GtkComboBox* entry;
     GtkTreeModel* model;
 
     builder = gtk_builder_new();
@@ -117,9 +119,9 @@ encoding_dialog_new(GtkWindow* parent)
     }
 
     model = GTK_TREE_MODEL(get_encoding_list_model());
-    entry = GTK_COMBO_BOX_ENTRY(object);
+    entry = GTK_COMBO_BOX(object);
     gtk_combo_box_set_model(GTK_COMBO_BOX(entry), model);
-    gtk_combo_box_entry_set_text_column(entry, ENCODING_COLUMN_ENCODING);
+    gtk_combo_box_set_entry_text_column(entry, ENCODING_COLUMN_ENCODING);
     g_object_set_data(G_OBJECT(dialog), "encoding_entry", entry);
 
     g_object_unref(builder);
diff --git a/src/encoding-dialog.ui b/src/encoding-dialog.ui
index 0e7257e..2919ee8 100644
--- a/src/encoding-dialog.ui
+++ b/src/encoding-dialog.ui
@@ -1,7 +1,6 @@
-<?xml version="1.0"?>
+<?xml version="1.0" encoding="UTF-8"?>
 <interface>
-  <!-- interface-requires gtk+ 2.12 -->
-  <!-- interface-naming-policy project-wide -->
+  <requires lib="gtk+" version="2.20"/>
   <object class="GtkDialog" id="encoding_dialog">
     <property name="border_width">5</property>
     <property name="title" translatable="yes">Select an encoding name to use</property>
@@ -29,9 +28,14 @@
               </packing>
             </child>
             <child>
-              <object class="GtkComboBoxEntry" id="encoding_name_entry">
+              <object class="GtkComboBox" id="encoding_name_entry">
                 <property name="visible">True</property>
                 <property name="has_entry">True</property>
+                <child internal-child="entry">
+                  <object class="GtkEntry" id="combobox-entry">
+                    <property name="can_focus">True</property>
+                  </object>
+                </child>
               </object>
               <packing>
                 <property name="position">1</property>
