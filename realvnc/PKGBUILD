# Maintainer: Kozec <kozec at kozec dot com>
pkgname=realvnc
pkgver=5.1.0
pkgrel=2
_magic_x64=1370
_magic_x86=1369
pkgdesc="RealVNC provides remote control software which lets you see and interact with desktop applications across any network."
arch=(i686 x86_64)
url="http://www.realvnc.com"
license=('custom')
install="realvnc.install"
conflicts=('vnc' 'tightvnc' 'tigervnc' 'xf4vnc-xvnc')
provides=("vnc=$pkgver")
if [ $CARCH == x86_64 ] ; then
	_arch=x64
	source=(install.diff vncinitconfig.diff "VNC-${pkgver}-Linux-x64-ANY.tar.gz::http://www.realvnc.com/download/binary/${_magic_x64}")
	md5sums=('c937757edcaab531dde303197648f3c2'
			 '6371930f6e2229a61c0e286495fc35b2'
			 '9a15ba80055c901c1e541afe7979d09f')
else
	_arch=x86
	source=(install.diff vncinitconfig.diff "VNC-${pkgver}-Linux-x86-ANY.tar.gz::http://www.realvnc.com/download/binary/${_magic_x86}")
	md5sums=('c937757edcaab531dde303197648f3c2'
			 '6371930f6e2229a61c0e286495fc35b2'
			 '9be37f3e4210b819986257a4ff644299')
fi
noextract=()

build() {
	cd "$srcdir/VNC-${pkgver}-Linux-${_arch}"
	cp "vncinstall" "vncinstall.arch"
	chmod +w "vncinstall.arch"
	patch -Np0 -i "$srcdir/install.diff" vncinstall.arch || return 1

	cp "vncinitconfig" "vncinitconfig.arch"
	chmod +w "vncinitconfig.arch"
	patch -Np0 -i "$srcdir/vncinitconfig.diff" vncinitconfig.arch || return 1
}

package() {
	mkdir -p "$pkgdir/usr/bin"
	mkdir -p "$pkgdir/usr/share/man/man1"
	mkdir -p "$pkgdir/usr/share/cups"
	mkdir -p "$pkgdir/etc/vnc"
	cd "$srcdir/VNC-${pkgver}-Linux-${_arch}"
	./vncinstall.arch "$pkgdir"
	./vncinitconfig.arch "$pkgdir" -config
	rm "$pkgdir/etc/vnc/get_primary_ip4"
	rm "$pkgdir/etc/vnc/vncelevate"
	ln -s /usr/lib/vnc/get_primary_ip4 "$pkgdir/etc/vnc/get_primary_ip4"
	ln -s /usr/lib/vnc/vncelevate "$pkgdir/etc/vnc/vncelevate"
}

