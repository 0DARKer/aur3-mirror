# Maintainer: gadget3000 <gadget3000 at msn dot com>
# Contributor: mikers <mikeonthecomputer at gmail dot com>

pkgname=vvvvvv
pkgver=2.0
_build=3
pkgrel=4
pkgdesc="A retro styled 2D platformer"
arch=('i686' 'x86_64')
url="http://thelettervsixtim.es/"
license=('unknown')
depends=('libjpeg6' 'libtiff4' 'slang' 'libcaca' 'aalib' 'esound' 'libmikmod' 'audiofile' 'sdl' 'sdl_image' 'sdl_mixer' 'libogg' 'smpeg' 'libvorbis')
source=('vvvvvv.desktop')
sha256sums=('a5eea031606f206b14f752eee7079fb18b6462fd751087d4641ca1831beb867f')

_archive="VVVVVV_${pkgver}_Linux${_build}.tar.gz"
_archive_md5="8eea8661a21058698d9bbffcd1ee1c65"

build() {
  cd $srcdir
  
  if [ ! -f ${_archive} ]; then
  echo Please place ${_archive} into $(pwd)
  echo Press Enter to continue
  read -a _unused
  fi

  if ! echo "${_archive_md5}  ${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_archive}"
    return 1
  fi

  install -d ${pkgdir}/opt/
  tar xzf ${_archive} -C ${pkgdir}/opt/
  rm -fr ${pkgdir}/opt/VVVVVV/LIB{32,64}
  if [ "$CARCH" = "x86_64" ]; then
    rm -fr ${pkgdir}/opt/VVVVVV/VVVVVV_32
  else
    rm -fr ${pkgdir}/opt/VVVVVV/VVVVVV_64
  fi
  install -d ${pkgdir}/usr/bin
  ln -s /opt/VVVVVV/VVVVVV ${pkgdir}/usr/bin/vvvvvv
  
  # Install the icon file
  install -D -m 644 ${pkgdir}/opt/VVVVVV/data/icons/32_2.png \
      ${pkgdir}/usr/share/pixmaps/vvvvvv_icon.png

  # Install desktop file
  install -D -m 644 ${srcdir}/vvvvvv.desktop \
      ${pkgdir}/usr/share/applications/vvvvvv.desktop
}
