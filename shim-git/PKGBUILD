pkgname=shim-git
_gitroot=git://github.com/nmathewson/shim.git
_gitname=shim
pkgver=20130102
pkgrel=2
pkgdesc="wedge this HTTP proxy between your browser and Tor"
arch=('i686' 'x86_64')
url="https://github.com/nmathewson/shim"
license=('unknown')
depends=('libevent')
makedepends=('git')
optdepends=('tor')
source=('shim.conf'
        'shim.service')
sha256sums=('d4a0af79f6e1494bf8630c09654d15b9791ef10d7337141a969962ecf5041e67'
            '054d6c62ec97debe7cb282601a4db47f18e0fffb2dc63a14c5b80bdb130b350c')

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server..."

  if [[ -d "${_gitname}" ]]; then
    cd "${_gitname}" && git pull origin
    msg "The local files are updated."
  else
    git clone "${_gitroot}" "${_gitname}"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "${srcdir}/${_gitname}-build"
  git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
  cd "${srcdir}/${_gitname}-build"

  ./autogen.sh
  ./configure --prefix=/usr
  make
}

package() {
  cd "${srcdir}/${_gitname}-build"
  make DESTDIR="${pkgdir}/" install
  mkdir -p "${pkgdir}/etc/conf.d"
  mkdir -p "${pkgdir}/usr/lib/systemd/system"
  install -m 644 "${srcdir}/shim.conf" "${pkgdir}/etc/conf.d/shim"
  install -m 644 "${srcdir}/shim.service" "${pkgdir}/usr/lib/systemd/system/"
}

# vim:set ts=2 sw=2 et:
