# Maintainer: Sascha Weaver <wzyboies@gmail.com>

pkgname=shadowsocks-nodejs-git
pkgver=20121219
pkgrel=1
pkgdesc="A lightweight tunnel proxy which can help you get through firewalls. A port of shadowsocks."
arch=('any')
url="https://github.com/clowwindy/shadowsocks-nodejs"
depends=('nodejs')
license=('GPL')
backup=(opt/shadowsocks-nodejs/config.json)
install=shadowsocks-nodejs.install
source=(shadowsocks-nodejs.service)
sha256sums=('e7bb7fe4a5b0de164c04736e95c7bdbeaaacc8e6c608ceba0b6719479f8baecd')

_gitroot="git://github.com/clowwindy/shadowsocks-nodejs.git"
_gitname="shadowsocks-nodejs"

_insdir="/opt/${_gitname}"

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server...."

  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi

  msg "GIT checkout done or server timeout"

  mkdir -p "${pkgdir}/${_insdir}"
  cp -rf "${_gitname}/"* "${pkgdir}/${_insdir}"
  cd "${pkgdir}/${_insdir}"
  rm -rf .git

}

package() {
  install -Dm644 "${srcdir}"/${_gitname}.service "${pkgdir}"/usr/lib/systemd/system/${_gitname}.service
}
