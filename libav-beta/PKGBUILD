pkgname=libav-beta
basename=libav
pkgver=0.8_beta2
pkgrel=1
pkgdesc="A complete, cross-platform solution to decode audio and video"
arch=('i686' 'x86_64')
url="http://www.libav.org/"
license=('GPL3' 'LGPL3')
depends=('bzip2' 'zlib' 'alsa-lib' 'vdpau-video')
makedepends=('yasm')
provides=('ffmpeg' 'libav=$pkgver')
conflicts=('ffmpeg')
source=(http://libav.org/releases/$basename-$pkgver.tar.xz)
md5sums=('641123a37430116df332bf08166b735d')

_aotuv=$(pacman -Q libvorbis-aotuv 2>/dev/null | awk '{print $1}')
_lame=$(pacman -Q lame 2>/dev/null | awk '{print $1}')
_options=""
[ ! -z $_lame ] && _options="$_options --enable-libmp3lame"
[ ! -z $_libvorbis_aotuv ] && _options="$_options --enable-libvorbis"
  
build() {
	cd "$srcdir/$basename-$pkgver"

	./configure \
		--prefix=/usr \
		--enable-gpl \
		--enable-version3 \
		--enable-nonfree \
		--enable-shared --disable-static \
		--enable-pthreads \
		--enable-x11grab \
		--enable-runtime-cpudetect \
		--enable-vaapi \
		--disable-ffmpeg \
		--disable-avplay \
		--disable-avprobe \
		--disable-avserver \
		--disable-avdevice \
		$_options --disable-debug 
	make
}

package() {
	cd "$srcdir/$basename-$pkgver"
	make DESTDIR="$pkgdir/" install
}
