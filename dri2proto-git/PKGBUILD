# Maintainer: Thomas Dziedzic < gostrc at gmail >
# Contributor: Antti "Tera" Oja <antti.bofh@gmail.com>
# Contributor: JiÅ™Ã­ ZÃ¡revÃºcky <zarevucky.jiri@gmail.com>

pkgname=dri2proto-git
pkgver=20111114
pkgrel=1
pkgdesc='X11 DRI extension wire protocol.'
url='http://xorg.freedesktop.org/'
arch=('i686' 'x86_64')
license=('custom')
makedepends=('xorg-util-macros' 'git')
provides=('dri2proto=2.6' 'dri2proto-git')
conflicts=('dri2proto')

_gitroot='git://git.freedesktop.org/git/xorg/proto/dri2proto'
_gitname='dri2proto'

build() {
  msg 'Connecting to git.freedesktop.org GIT server...'

  if [ -d ${_gitname} ] ; then
    cd ${_gitname}
    git pull origin
  else
    git clone ${_gitroot}
  fi

  msg 'GIT checkout done or server timeout'

  cd ${srcdir}

  rm -rf ${_gitname}-build
  cp -R ${_gitname} ${_gitname}-build
  cd ${_gitname}-build

  msg 'Starting make...'

  ./autogen.sh \
    --prefix=/usr

  make
}

package() {
  cd ${_gitname}-build

  make DESTDIR=${pkgdir} install

  # Install license file
  install -D -m644 COPYING ${pkgdir}/usr/share/licenses/${pkgname}/COPYING
}
