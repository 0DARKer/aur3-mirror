# Maintainer: Ying
# Contributor: Ying

pkgname=qt-static
pkgver=4.7.2
pkgrel=1
pkgdesc='A cross-platform application and UI framework. Compile static Qt application'
arch=('i686' 'x86_64')
url='http://qt.nokia.com/'
license=('GPL3' 'LGPL')
depends=('libtiff' 'libpng' 'libmng' 'sqlite3' 'ca-certificates' 'glib2' 'dbus'
    'fontconfig' 'libgl' 'libsm' 'libxrandr' 'libxv' 'libxi' 'alsa-lib'
    'xdg-utils' 'hicolor-icon-theme' 'desktop-file-utils' 'upx')
optdepends=('postgresql-libs: PostgreSQL driver'
	'libmysqlclient: MySQL driver'
	'unixodbc: ODBC driver'
	'libxinerama: Xinerama support'
	'libxcursor: Xcursor support'
	'libxfixes: Xfixes support')
makedepends=('mesa' 'postgresql-libs' 'mysql' 'unixodbc' 'cups' 'gtk2')
install="${pkgname}.install"
options=('!libtool')
_pkgfqn="qt-everywhere-opensource-src-${pkgver}"
source=("ftp://ftp.qt.nokia.com/qt/source/${_pkgfqn}.tar.gz"
        'qmake-static' 'make-static-qt')


build() {
	unset QMAKESPEC
	export QT4DIR=$srcdir/$_pkgfqn
	export PATH=${QT4DIR}/bin:${PATH}
	export LD_LIBRARY_PATH=${QT4DIR}/lib:${LD_LIBRARY_PATH}

	cd $srcdir/$_pkgfqn
	
    sed -i "s|-O2|$CXXFLAGS|" mkspecs/common/g++.conf
	sed -i "/^QMAKE_RPATH/s| -Wl,-rpath,||g" mkspecs/common/g++.conf
	sed -i "/^QMAKE_LFLAGS\s/s|+=|+= $LDFLAGS|g" mkspecs/common/g++.conf

	./configure -static \
		-confirm-license -opensource \
		-prefix /opt/qt-static \
		-largefile \
		-plugin-sql-{psql,mysql,sqlite,odbc} \
		-system-sqlite \
		-xmlpatterns \
		-no-phonon \
		-no-phonon-backend \
		-svg \
		-webkit \
		-script \
		-scripttools \
		-system-zlib \
		-system-libtiff \
		-system-libpng \
		-system-libmng \
		-system-libjpeg \
		-nomake demos \
		-nomake examples \
		-nomake docs \
		-no-rpath \
		-openssl-linked \
		-silent \
		-optimized-qmake \
		-dbus \
		-reduce-relocations \
		-no-separate-debug-info \
		-gtkstyle \
		-opengl \
		-no-openvg \
		-glib \
		-release -nomake demos -nomake examples -nomake tools -qt-zlib -qt-gif -qt-libpng -qt-libmng -qt-libjpeg
	make
}

package() {
	cd $srcdir/$_pkgfqn
	make INSTALL_ROOT=$pkgdir install

	install -d ${pkgdir}/usr/bin/
	install -m644 ${srcdir}/qmake-static ${pkgdir}/usr/bin/qmake-static
	install -m644 ${srcdir}/make-static-qt ${pkgdir}/usr/bin/make-static-qt

	chmod +x ${pkgdir}/usr/bin/qmake-static
	chmod +x ${pkgdir}/usr/bin/make-static-qt
}


md5sums=('66b992f5c21145df08c99d21847f4fdb'
         'ea0914ee23bfd2f461d4fc8655a1db92'
         '6c119506d7b0e2a4ce0067ec84798d55')

