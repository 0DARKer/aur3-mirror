#!/bin/bash

# APP Name
APP=""


if [ "$1" == "-h" ] || [ "$1" == "--help" ] ; then
	echo "This is an automatic compile script for qt application."
	echo "Step 1: qmake -project"
	echo "Step 2: qmake"
	echo "Step 3: make"
	echo "Step 4: compress with upx [OPTIONAL]"
	echo ""
	echo "make-static-qt [OPTION] [DATA]"
	echo "	-h/--help	display help"
	echo "	--appname	set application filename for upx compression. The binary file will be compressed."
	echo ""
	exit 0
elif [ "$1" == "--appname" ] ; then
	APP=$2
fi


export PATH=$PATH:/opt/qt-static/bin

/opt/qt-static/bin/qmake -project

if [ "$?" != "0" ]; then
	echo "Error while executing qmake -project!"
	exit 1
fi

/opt/qt-static/bin/qmake

if [ "$?" != "0" ]; then
	echo "Error while executing qmake!"
	exit 1
fi

make

if [ "$?" != "0" ]; then
	echo "Error while executing make!"
	exit 1
fi



# Compress
echo ""


if [ "$APP" == "" ]; then
	echo "Do you want to compress your compiled application? (yes/no):"
	read -s COMPILE

	while [ true ]
	do
		if [ "$COMPILE" == "no" ]; then
			echo "Finished!"
			exit 0
		elif [ "$COMPILE" == "yes" ]; then
			break
		else
			echo "Wrong Option!"
			echo "Do you want to compress your compiled application? (yes/no):"
			read -s COMPILE
		fi
	done

	echo "Enter the application name to compress it with upx:"
	read -s APP
fi



upx --best $APP


if [ "$?" != "0" ]; then
	echo "Error while executing upx!"
	exit 1
fi

exit 0

