# Maintainer: Your Name <youremail@domain.com>
pkgname=pipelight-git
pkgver=549.2357ef4
pkgrel=1
pkgdesc="Pipelight is a special browser plugin which allows one to use windows only plugins (currently focussing on silverlight) inside Linux browsers (tested with wine-compholio-bin instead of wine-silverlight). Netflix, Lovefilm and others are supported."
arch=("i686" "x86_64")
url="https://launchpad.net/pipelight" #Also http://fds-team.de/cms/articles/2013-08/pipelight-using-silverlight-in-linux-browsers.html
license=('GPL')
makedepends=("git")
depends=("mingw-w32-bin" "wine-silverlight")
#optdepends=()
provides=("silverlight-plugin") # or whatever?
#options=()
install="pipelight.install"
_name=pipelight
source=("$_name::git+https://bitbucket.org/mmueller2012/pipelight.git")
#"pipelight-compholio-config")
groups=("pipelight-devel")

build() {
        #export CXXFLAGS="$CXXFLAGS -fpermissive" # not needed anymore
        #-static" # static would be great, then we wouldn't have to link mingw's libraries into wine's windows directory

	cd "$srcdir/$_name"
	./configure \
        --prefix=/usr \
        --gcc-runtime-dlls=/opt/mingw_w32/i686-w64-mingw32/lib \
        --show-installation-dialogs

	make
}

package() {
	cd "$srcdir/$_name"
	make DESTDIR="$pkgdir/" install

        #instead of cluttering the system with untracked files by "unlocking" plugins, create the copies for the library ourselves here:
        cd "$pkgdir/usr/share/pipelight/configs/"
        for i in *
        do
                install "$pkgdir/usr/lib/pipelight/libpipelight.so" "$pkgdir/usr/lib/pipelight/lib$i.so"
        done
}

pkgver() {
  cd "$srcdir/$_name"
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

md5sums=('SKIP')
