# See http://wiki.archlinux.org/index.php/VCS_PKGBUILD_Guidelines
# for more information on packaging from GIT sources.

# Maintainer: Leo von Klenze <leo@devel.von-klenze.de>
pkgname=cloud9
pkgver=0.4.0
pkgrel=1
pkgdesc="Cloud9 IDE - Your code anywhere, anytime. Open Source Javascript Cloud9 IDE"
arch=('i686' 'x86_64')
url="https://github.com/ajaxorg/cloud9/tree/$pkgver"
license=('GPLv3')
depends=(nodejs)
makedepends=('git')
source=(middleware.patch)
noextract=()
md5sums=(6c6664ccb741a5152771556add84d115)
install=(cloud9.install)

gitroot="https://github.com/ajaxorg/cloud9.git"
gitname="cloud9"
gittag=$pkgver

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $gitname ] ; then
    echo ""
    rm -rf $gitname 
  fi

  git clone $gitroot $gitname
  cd $gitname
  git checkout $gittag
  git submodule update --init --recursive

  # patch middleware to avoid writing to program directory
  patch -p 1 < "../../middleware.patch"
}

package() {
  install -d "$pkgdir/opt/cloud9"
  install -d "$pkgdir/usr/bin"
  ln -s "/opt/cloud9/bin/cloud9.js" "$pkgdir/usr/bin/cloud9"

  find . -path '*/.git*' -prune -or -type f -and -print | while read file; do 
    dir=$(dirname "$pkgdir/opt/$file")
    install -d "$dir"
    cp -a "$file" "$dir"
  done
} 

