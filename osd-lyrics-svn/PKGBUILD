# Maintainer: Mark, Huo Mian <markhuomian[at]gmail[dot]com>
# Contributor: Xiang Yixiang <lovelinux229[at]gmail[dot]com>

pkgname=osd-lyrics-svn
pkgver=314
pkgrel=1
pkgdesc="An OSD lyric show supporting multiple media players and downloading."
arch=('i686' 'x86_64')
url="http://code.google.com/p/osd-lyrics/"
license=('GPL3')
depends=('gtk2' 'dbus-glib' 'curl' 'libnotify' 'libmpd')
makedepends=('subversion' 'pkgconfig')
conflicts=('osd-lyrics')
provides=('osd-lyrics')
install=osd-lyrics.install

_amarok1=false
_mpd=false
_xmms2=false

if [ "$_mpd" = "false" ]; then
     depends=('gtk2' 'dbus-glib' 'curl' 'libnotify')
fi

_svntrunk=http://osd-lyrics.googlecode.com/svn/trunk/
_svnmod=osd-lyrics

build() {
    cd "$srcdir"

    if [ -d $_svnmod/.svn ]; then
        (cd $_svnmod && svn up -r $pkgver)
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    msg "SVN checkout done or server timeout"
    msg "Starting make..."

    rm -rf "$srcdir/$_svnmod-build"
    cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
    cd "$srcdir/$_svnmod-build"

        
    aclocal || return 1
    autoconf || return 1
    automake --add-missing || return 1

    if [ "$_amarok1" = "true" ]; then
	    configure="$configure --enable-amarok1"
    fi

    if [ "$_mpd" = "false" ]; then
	    configure="$configure --disable-mpd"
    fi

    if [ "$_xmms2" = "false" ]; then
	    configure="$configure --disable-xmms2"
    fi

    ./configure --prefix=/usr $configure || return 1
    make || return 1
    make DESTDIR="$pkgdir/" install || return 1
}
