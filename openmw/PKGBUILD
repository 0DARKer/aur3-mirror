
# Maintainer: Pieter van der Kloet <pvdkloet@gmail.com>
pkgname=openmw
pkgver=0.08
pkgrel=1
pkgdesc="OpenMW is a open-source engine reimplementation for the role-playing game Morrowind."
arch=('i686' 'x86_64')
url="http://www.openmw.com"
license=('GPL3')

depends=('openal' 'ogre' 'bullet' 'ffmpeg' 'mygui' 'mpg123' 'libsndfile')

makedepends=('git' 'cmake' 'boost')
install=$pkgname.install

source=('http://sourceforge.net/projects/openmw/files/openmw/openmw-0.08/openmw-0.08.1-source.tar.bz2')
md5sums=('f07e77fc1354b3a9b511f3a71194af1b')

conflicts=('openmw-git')

build() {
  cd "$srcdir"/openmw-0.08

  # Remove -Werror because it fails compilation
  sed -i 's,add_definitions (-Wall -Werror),add_definitions (-Wall),' CMakeLists.txt

  cmake -DCMAKE_INSTALL_PREFIX=/opt
  
  make

  # Install
  sed -i 's,/usr/local/lib/OGRE,/usr/lib/OGRE,' plugins.cfg
  
  # There is currently no make install so we do this manually
  mkdir -p "$pkgdir"/opt/openmw
  cp openmw "$pkgdir"/opt/openmw
  cp esmtool "$pkgdir"/opt/openmw
  cp *.cfg "$pkgdir"/opt/openmw
  cp -r resources "$pkgdir"/opt/openmw
  chmod 0777 "$pkgdir"/opt/openmw  

}

package() {
  # For makepkg package creation 
  cd "$srcdir"/openmw-0.08    

  mkdir -p "$pkgdir"/opt/openmw
  cp openmw "$pkgdir"/opt/openmw
  cp esmtool "$pkgdir"/opt/openmw
  cp *.cfg "$pkgdir"/opt/openmw
  cp -r resources "$pkgdir"/opt/openmw
  chmod 0777 "$pkgdir"/opt/openmw
}


