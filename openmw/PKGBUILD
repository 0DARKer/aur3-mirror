
# Maintainer: Pieter van der Kloet <pvdkloet@gmail.com>
pkgname=openmw
pkgver=0.9.0
pkgrel=1
pkgdesc="OpenMW is a open-source engine reimplementation for the role-playing game Morrowind."
arch=('i686' 'x86_64')
url="http://www.openmw.com"
license=('GPL3')

depends=('openal' 'ogre' 'bullet' 'ffmpeg' 'mygui' 'mpg123' 'libsndfile')

makedepends=('git' 'cmake' 'boost')
install=$pkgname.install

source=('http://openmw.googlecode.com/files/openmw-0.9.0-source.tar.bz2')
md5sums=('025b2d88c8ed29d31590d75c0ead2bdd')

conflicts=('openmw-git')

build() {
  cd "$srcdir"/openmw-"$pkgver"-source

  cmake -DCMAKE_INSTALL_PREFIX=/opt
  
  make

  # Install
  sed -i 's,/usr/local/lib/OGRE,/usr/lib/OGRE,' plugins.cfg
  
  # There is currently no make install so we do this manually
  mkdir -p "$pkgdir"/opt/openmw
  cp openmw "$pkgdir"/opt/openmw
  cp esmtool "$pkgdir"/opt/openmw
  cp *.cfg "$pkgdir"/opt/openmw
  cp -r resources "$pkgdir"/opt/openmw
  chmod 0777 "$pkgdir"/opt/openmw  

}

package() {
  # For makepkg package creation 
  cd "$srcdir"/openmw-"$pkgver"-source

  mkdir -p "$pkgdir"/opt/openmw
  cp openmw "$pkgdir"/opt/openmw
  cp esmtool "$pkgdir"/opt/openmw
  cp *.cfg "$pkgdir"/opt/openmw
  cp -r resources "$pkgdir"/opt/openmw
  chmod 0777 "$pkgdir"/opt/openmw
}


