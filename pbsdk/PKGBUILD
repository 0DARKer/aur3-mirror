# Contributor: Aliaksandr Stelmachonak <mail.avatar at gmail dot com>

pkgname=pbsdk
pkgver=2011.02.10
pkgrel=2
pkgdesc="Unoficial SDK for PocketBook devices"
arch=('any')
url="http://www.the-ebook.org/forum/viewtopic.php?t=17573"
license=('GPL')
depends=()
options=('!strip')
source=(
	'http://sourceforge.net/projects/pbchess/files/PBSDK/PBSDK-linux-2011-02-10.tgz'
	'http://ovh.dl.sourceforge.net/project/pocketbook-free/PocketBook_Pro_SDK_Linux_/sdkrelease_1.0.tar.gz'
)
md5sums=(
	'04bf428413dc60f7082f3a2b0669cc3c'
	'969136ec41eee2de6b5bae5fea7179db'
)

build() {
  mkdir ${pkgdir}/usr
  cp -R ${srcdir}/PBSDK-linux/usr/* ${pkgdir}/usr
  rm ${pkgdir}/usr/bin/curl-config # already exists in filesystem
  # coping files from official SDK
  cp -R ${srcdir}/FRSCSDK/arm-none-linux-gnueabi/sysroot/lib/* ${pkgdir}/usr/local/pocketbook/pocketbook_arm_gnueabi/lib/
  cp -R ${srcdir}/FRSCSDK/arm-none-linux-gnueabi/sysroot/usr/lib/* ${pkgdir}/usr/local/pocketbook/pocketbook_arm_gnueabi/lib/
  cp -R ${srcdir}/FRSCSDK/arm-none-linux-gnueabi/sysroot/usr/include/* ${pkgdir}/usr/arm-linux-gnueabi/include/
  # fixing permissions
  chmod -R 755 ${pkgdir} 
  # collecting include and lib to one location
  cp -R ${pkgdir}/usr/local/pocketbook/pocketbook_arm_gnueabi/include/* ${pkgdir}/usr/arm-linux-gnueabi/include/
  cp -R ${pkgdir}/usr/local/pocketbook/pocketbook_arm_gnueabi/lib/* ${pkgdir}/usr/arm-linux-gnueabi/lib/
  # fixing common.mk
  sed 's/-linkview -lMorphology -lfreetype -ljpeg -lz/-linkview -lMorphology -ljpeg -lpng -lfreetype -lz -lpthread/g' ${srcdir}/PBSDK-linux/usr/local/pocketbook/common.mk > ${pkgdir}/usr/local/pocketbook/common.mk
  # placing examples
  mkdir -p ${pkgdir}/usr/share/doc/pbsdk/examples
  cp -R ${srcdir}/PBSDK-linux/sources/* ${pkgdir}/usr/share/doc/pbsdk/examples
}
