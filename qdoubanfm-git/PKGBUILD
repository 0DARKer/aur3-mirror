# Maintainer: Shadow Ma ( i at shadow.ma )

pkgname=qdoubanfm-git
pkgver=20130209
pkgrel=1
pkgdesc="A DoubanFM Client written in Qt"
arch=('i686' 'x86_64')
url="https://gitcafe.com/zonyitoo/doubanfm-qt"
license=('MIT')
depends=('qt' 'phonon' 'qjson')
makedepends=('git')
 
_gitname="doubanfm-qt"
_gitroot="git://gitcafe.com/zonyitoo/doubanfm-qt.git"
_gitbranch="master"
 
build() {
  cd $srcdir
  msg "Connecting to GIT server...."
 
  if [ -d $_gitname ] ; then
        cd $_gitname && git pull origin && cd ..
        msg "The local files are updated."
  else
        git clone $_gitroot $_gitname -b $_gitbranch
  fi
 
  msg "Clone done, starting make..."

  if [ -d ${_gitname}-build ]; then
  	rm -rf "${_gitname}-build" && mkdir "${_gitname}-build"
  else
  	mkdir "${_gitname}-build"
  fi
  
  cd "${_gitname}-build"
  lrelease ../${_gitname}/lang/*.ts
  qmake ../${_gitname}/doubanfm-qt.pro
  make
  install -D -m 0755 doubanfm-qt ${pkgdir}/usr/bin/doubanfm-qt
  install -D ../${_gitname}/QDoubanFM.desktop ${pkgdir}/usr/share/applications/QDoubanFM.desktop
  install -D ../${_gitname}/QDoubanFM.png ${pkgdir}/usr/share/pixmaps/QDoubanFM.png
  install -D ../${_gitname}/LICENSE ${pkgdir}/usr/share/licenses/qdoubanfm/LICENSE
}

