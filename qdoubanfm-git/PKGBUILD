# Maintainer: Shadow Ma ( i at shadow.ma )

pkgname=qdoubanfm-git
pkgver=20130302
pkgrel=1
pkgdesc="A DoubanFM Client written in Qt"
arch=('i686' 'x86_64')
url="https://gitcafe.com/zonyitoo/doubanfm-qt"
license=('MIT')
depends=('qt4' 'phonon' 'qjson')
makedepends=('git')
 
_gitname="doubanfm-qt"
_gitroot="git://gitcafe.com/zonyitoo/doubanfm-qt.git"
_gitbranch="master"
 
build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."
 
  if [ -d "$_gitname" ] ; then
        cd "$_gitname" && git pull origin && cd ..
        msg "The local files are updated."
  else
        git clone "$_gitroot" "$_gitname" -b "$_gitbranch"
  fi
 
  msg "Clone done, starting make..."

  if [ -d "${_gitname}-build" ]; then
  	rm -rf "${_gitname}-build" && cp -r "${_gitname}" "${_gitname}-build"
  else
  	cp -r "${_gitname}" "${_gitname}-build"
  fi
  
  cd "${_gitname}-build"
  lrelease-qt4 lang/*.ts
  qmake-qt4 doubanfm-qt.pro
  make
}

package() {
  cd "${_gitname}-build"
  install -D -m 0755 doubanfm-qt "${pkgdir}/usr/bin/doubanfm-qt"
  install -d "${pkgdir}/usr/share/QDoubanFM/lang"
  cp -r lang/*.qm "${pkgdir}/usr/share/QDoubanFM/lang"
  install -D QDoubanFM.desktop "${pkgdir}/usr/share/applications/QDoubanFM.desktop"
  install -D QDoubanFM.png "${pkgdir}/usr/share/pixmaps/QDoubanFM.png"
  install -D LICENSE "${pkgdir}/usr/share/licenses/qdoubanfm/LICENSE"
}
