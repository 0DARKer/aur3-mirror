# Maintainer: Felix Yan <felixonmars[at]gmail[dot]com>
# Contributor: DrZaius <lou[at]fakeoutdoorsman[dot]com>
# Contributor: zhuqin <zhuqin83[at]gmail[dot]com>
# Contributor: pressh <pressh[at]gmail[dot]com>

pkgname=x264-jeeb
pkgver=2245
pkgrel=1
pkgdesc="H.264/MPEG-4 AVC video encoder with JEEB's patchsets"
arch=('i686' 'x86_64')
url="http://x264.fushizen.eu/"
license=('GPL')
depends=('glibc' 'ffmpeg' 'faac')
makedepends=('yasm')
conflicts=('x264')
provides=("x264=$(LANG=C pacman -Si x264 | grep Version | awk '{ print $NF }')") 

__gitroot=git://github.com/jeeb/x264_L-SMASH.git
__gitname=x264_L-SMASH

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $__gitname ] ; then
    cd $__gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $__gitroot
    cd $__gitname
  fi

  git checkout r$pkgver

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$__gitname-build"
  git clone "$srcdir/$__gitname" "$srcdir/$__gitname-build"
  cd "$srcdir/$__gitname-build"
  
  ./configure \
    --prefix=/usr \
    --enable-nonfree \
    --enable-shared
  
  make
}

package() {
  cd "$srcdir/$__gitname-build"
  make DESTDIR="$pkgdir" install
}
