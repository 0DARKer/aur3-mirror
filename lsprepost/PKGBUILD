# Maintainer: Tim Hartman <tbhartman at gmail>
pkgname=lsprepost
pkgver=3.0
pkgrel=1
pkgdesc="Pre- and post-processor for LS-DYNA"
arch=("x86_64")
url=("http://www.lstc.com/lspp")
license=('unknown')
depends=('libjpeg' 'libpng12' 'mesa' 'gtk2' 'libxmu')
makedepends=('chrpath')
source=(${pkgname}-${pkgver}.tgz::ftp://ftp.lstc.com/outgoing/lsprepost/${pkgver}/linux64/${pkgname}-${pkgver}-opensuse11.tgz)
md5sums=('0002e4cb69be339fa75341aa8a0a944e')

build() {
  cd "$srcdir"
  mv `ls | grep ${pkgname}${pkgver}` "${pkgname}-${pkgver}"
  cd "${pkgname}-${pkgver}"
  chrpath -d lsprepost
  
  cd lib
  chrpath -d libLSAF.so.0.0.0
  chrpath -d libLSIO.so.0.0.0
  chrpath -d libLSMA.so.0.0.0
  chrpath -d libLSMD.so.0.0.0
  chrpath -d libLSVI.so.0.0.0
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  
  mkdir -p "${pkgdir}/usr/lib/${pkgname}"
  cp -r --preserve=all ./lib/* "${pkgdir}/usr/lib/${pkgname}/."
  cp -r --preserve=all "$pkgname" "${pkgdir}/usr/lib/${pkgname}/."
  
  mkdir -p "${pkgdir}/usr/share/doc/${pkgname}"
  cp -r --preserve=all ./resource/* "${pkgdir}/usr/share/doc/${pkgname}/."
  
  mkdir -p "${pkgdir}/usr/bin"
  echo "#!/bin/bash" > "${pkgdir}/usr/bin/${pkgname}"
  echo "DN=\"/usr/lib/${pkgname}\"" >> "${pkgdir}/usr/bin/${pkgname}"
  echo "export LSPP_HELPDIR=/usr/share/doc/${pkgname}/Help_Document" >> "${pkgdir}/usr/bin/${pkgname}"
  echo "export LD_LIBRARY_PATH=/usr/lib/${pkgname}:\$LD_LIBRARY_PATH" >> "${pkgdir}/usr/bin/${pkgname}"
  echo "\$DN/lsprepost \$*" >> "${pkgdir}/usr/bin/${pkgname}"
  chmod 755 "${pkgdir}/usr/bin/${pkgname}"

  cd "${pkgdir}/usr/lib"
  ln -s /usr/lib/libjpeg.so libjpeg.so.6
  chmod +x libjpeg.so.6
  ln -s /usr/lib/libjpeg.so libjpeg.so.62
  chmod +x libjpeg.so.62
}

# vim:set ts=2 sw=2 et:
