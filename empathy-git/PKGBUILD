# Maintainer: Biru Ionut <biru.ionut at gmail.com>

pkgname=empathy-git
_pkgname=empathy
pkgver=20090624
pkgrel=1
pkgdesc="A GNOME instant messaging client using the Telepathy framework."
arch=('i686' 'x86_64')
url="http://live.gnome.org/Empathy"
license=('GPL2')
depends=('enchant' 'gnome-panel' 'telepathy-mission-control>=4.61' 'telepathy-farsight'
         'libcanberra' 'libnotify' 'libwebkit' 'libchamplain>=0.3.3' 'geoclue')
makedepends=('pkgconfig' 'intltool' 'gnome-doc-utils>=0.12.0' 'git' 'gnome-common' 'gtk-doc')
optdepends=('telepathy-gabble: XMPP/Jabber support'
            'telepathy-butterfly: MSN support'
            'telepathy-idle: IRC support'
            'telepathy-salut: Link-local XMPP support'
            'telepathy-sofiasip: SIP support'
            'telepathy-haze: libpurple support')
options=('!libtool')
conflicts=('empathy' 'empathy-devel')
repaces=('empathy' 'empathy-devel')
install=empathy-git.install
source=()
md5sum=()

_gitroot=git://git.gnome.org/empathy
_gitname=empathy
build() {
    # Build and install

    cd $srcdir
    if [ -d ${_gitname} ]; then
    	cd ${_gitname} && git pull origin
	msg "The local files are updated."
    else
    	git clone ${_gitroot}
    fi
    msg "GIT checkout done or server timeout"
    msg "Starting make..."
    cd $_pkgname
    ./autogen.sh --prefix=/usr --sysconfdir=/etc  \
                --libexecdir=/usr/lib/empathy --enable-shave
    make || return 1
    make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR=$pkgdir install || return 1 

    # Merge schemas file in a single file and remove trash
    mkdir -p $pkgdir/usr/share/gconf/schemas
    gconf-merge-schema $pkgdir/usr/share/gconf/schemas/$pkgname.schemas \
        $pkgdir/etc/gconf/schemas/*.schemas
    rm -rf $pkgdir/etc/gconf
}
