# Maintainer: William Giokas <1007380 at gmail dot com>
pkgname=mangle-git
pkgver=20130314
pkgrel=1
pkgdesc="A simple python image converter for the Amazon Kindle"
arch=('any')
url="http://foosoft.net/mangle/"
license=('GPL')
depends=('python2' 'python2-pyqt' 'python2-imaging')
makedepends=('git')
provides=('mangle')
conflicts=('mangle-git' 'mangle')
install=mangle.install

_gitroot="https://github.com/FooSoft/mangle.git"
_gitname="mangle"

build() {
	cd $SRCDEST
	msg "Connecting to the GIT server...."
	
	if [[ -d $SRCDEST/$_gitname ]] ; then
		cd $_gitname
		git fetch --progress origin
		msg2 "The local files have been updated."
	else
		git clone --bare --progress $_gitroot $_gitname
	fi

  msg "Creating working copy of %s git repo" "$_gitname"
  rm -rf "$srcdir/$_gitname"
  git clone --progress "$SRCDEST/$_gitname" "$srcdir/$_gitname"
}

package() {
  cd $srcdir
	#Make directories
	mkdir -p "$pkgdir/usr/share/mangle/"
	mkdir -p "$pkgdir/usr/bin/"

  	#Copying git files
	cd "$srcdir/mangle"
	cp -R "mangle" "$pkgdir/usr/share/mangle/mangle"
	cp -R "ref" "$pkgdir/usr/share/mangle/ref"
	#Copy main pyw file
	cp mangle.pyw $pkgdir/usr/share/mangle/mangle.pyw
	
	#Making a startup script for mangle
	ln -s $pkgdir/usr/share/mangle/mangle.pyw $pkgdir/usr/bin/mangle
	chmod +x $pkgdir/usr/bin/mangle
}
