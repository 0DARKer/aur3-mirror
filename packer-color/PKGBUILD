# Contributor: Xavion <Xavion (dot) 0 (at) Gmail (dot) com>
# Contributor: Bruenig <Matthew (dot) Bruenig (at) Gmail (dot) com>

_basename_=packer
pkgname=${_basename_}-color
pkgver=20121220
pkgrel=1
pkgdesc="Adds AUR support to 'pacman' | Adds better colourisation and error handling to 'packer'"
url="http://github.com/keenerd/packer"
license="GPL3"
arch=("any")
makedepends=("git")
depends=("grep" "sed" "bash" "curl" "pacman-color" "jshon")
optdepends=("sudo: install and update packages as non-root"
            "customizepkg: apply customizepkg modifications")

_gitroot="http://github.com/keenerd/${_basename_}.git"
_gitname="${_basename_}"

build() {
	cd "${srcdir}"

	# Repository
	msg "Connecting to GIT server ..."
	if [ -d "${srcdir}/${_gitname}" ] ; then
		cd ${_gitname} && git pull origin
	else
		git clone "${_gitroot}"
		cd ${_gitname}
	fi
	
	# Patches
	patch -Np1 < "${startdir}"/${pkgname}.patch

	# Changes
	sed -i 's|packer |packer-color |g' ${_basename_}
	sed -i 's|"pacman"|"pacman-color"|g' ${_basename_}
	sed -i 's|pacman -|pacman-color -|g' ${_basename_}
	sed -i 's|runasroot pacman |runasroot pacman-color |g' ${_basename_}
	sed -i 's| pacman "| pacman-color "|g' ${_basename_}
	sed -i "s|echo \"packer: Option .* is not valid.\"|pacman-color \"\$\@\"|g" ${_basename_}
}

package() {
	cd ${_gitname}

	# Install
	install -D -m755 ${_basename_} "${pkgdir}/usr/bin/${pkgname}"
	install -D -m644 ${_basename_}.8 "${pkgdir}/usr/share/man/man8/${pkgname}.8"
}
