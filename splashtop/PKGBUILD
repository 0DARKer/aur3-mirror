# Contributor: vanhtu1987 <vanhtu1987@gmail.com>
pkgname=splashtop
pkgver=2.0.0.11
pkgrel=5
pkgdesc="High-performance audio-video streaming server"
arch=('x86_64' 'i686')
url="http://www.splashtop.com/streamer/linux"
license=('GPL')
depends=('python2' 'pywebkitgtk' 'python2-keyring' 'apr' 'apr-util')
makedepends=('curl' 'p7zip')
if [ "$CARCH" = "x86_64" ]; then
  source=(http://remotedl.splashtop.com/download/Splashtop_Streamer_Ubuntu_v${pkgver}_amd64.deb)
  md5sums=('114a58a157c9567f6abc7f6397b937c8')
  x264_ubuntu_deb=http://ubuntu.mirror.cambrium.nl/ubuntu//pool/universe/x/x264/libx264-120_0.120.2151+gita3f4407-2_amd64.deb
  x264_lib_path=./usr/lib/x86_64-linux-gnu/libx264.so.120
else
  source=(http://remotedl.splashtop.com/download/Splashtop_Streamer_Ubuntu_v${pkgver}_i386.deb)
  md5sums=('92a11b9ed5a41e81335e11eeb1c53b4b')
  x264_ubuntu_deb=http://ubuntu.mirror.cambrium.nl/ubuntu//pool/universe/x/x264/libx264-120_0.120.2151+gita3f4407-2_i386.deb
  x264_lib_path=./usr/lib/i386-linux-gnu/libx264.so.120
fi

package ()
{
  msg "Extracting Splashtop package"
  #cd "$srcdir/$pkgname-$pkgver"
  tar -xf $srcdir/data.tar.gz -C $pkgdir
  sed -i 's/python /python2 /' $pkgdir/usr/share/applications/SplashtopStreamer.desktop

  msg "Downloading Ubuntu's pre-compiled x264 library"
  curl -C - $x264_ubuntu_deb > libx264.deb

  msg "Integrating libx264 to package"
  7z e $srcdir/libx264.deb
  tar -xf $srcdir/data.tar $x264_lib_path
  mkdir -p $pkgdir/usr/lib
  mv $x264_lib_path $pkgdir/usr/lib/
}

# vim:set ts=2 sw=2 et:
