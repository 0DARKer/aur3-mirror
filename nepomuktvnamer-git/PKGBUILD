# Maintainer: Jakub Kozisek <nodevel at gmail dot com>

pkgname=nepomuktvnamer-git
pkgver=20120211
pkgrel=1
pkgdesc="Nepomuk TV Show manager."
arch=('any')
url="http://trueg.wordpress.com/2012/01/28/something-way-less-dry-tv-shows/"
license=('GPLv2')
depends=('kdebase-runtime>=4.5.80' 'shared-desktop-ontologies-git' 'soprano' 'libtvdb')
makedepends=('git' 'cmake')
conflicts=('nepomuktvnamer')
replaces=('nepomuktvnamer')

_gitroot="git://anongit.kde.org/scratch/trueg/nepomuktvnamer.git"
_gitname="nepomuktvnamer"

source=()
md5sums=()

build() {
  cd ${srcdir}
  msg "Connecting to GIT server..."

  if [ -d "${srcdir}/${_gitname}" ] ; then
    cd ${_gitname} && git pull --rebase
  else
    git clone ${_gitroot}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."
  # Resolve 'shared-desktop-ontologies-git' problem - ugly hack (removes version specification, originally 0.8.35)
  sed -i '/SDO_MIN_VERSION/d' ./nepomuktvnamer/CMakeLists.txt
  cmake -DCMAKE_INSTALL_PREFIX=$( kde4-config --prefix ) -DCMAKE_BUILD_TYPE=Release ./${_gitname}
  make || return 1
  make DESTDIR=$pkgdir install || return 1
}
