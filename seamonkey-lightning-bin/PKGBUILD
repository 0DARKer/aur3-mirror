# Based on PKGBUILD provided by Contributors
# Contributor: Joel Goguen <jgoguen (at-sign) jgoguen (period) ca>
# Contributor: Hugo Osvaldo Barrera <hugo@osvaldobarrera.com.ar>
# Maintainer: Arne Ko arneko yahoo com
pkgname=seamonkey-lightning-bin
pkgver=2.2b1
pkgrel=2
pkgdesc="A version of Mozilla Sunbird integrated with Seamonkey"
arch=('i686' 'x86_64')
url="http://www.mozilla.org/projects/calendar/lightning/"
license=('MPL' 'GPL' 'LGPL')
depends=('seamonkey>=2.17.1' 'libnotify')
makedepends=()
options=(!strip)
provides=(lightning=${pkgver})

source=(lightning-$pkgver.xpi::https://addons.mozilla.org/thunderbird/downloads/file/196536/lightning-$pkgver-sm+tb-linux.xpi)
sha1sums=('99bd58587e3b573eb4f207da7c3f1719a4621dc2')

build() {
	mkdir -p ${pkgdir}/usr/lib/seamonkey-2.17.1/extensions/${pkgname}
	cd ${pkgdir}/usr/lib/seamonkey-2.17.1/extensions/${pkgname}
	bsdtar -x -f ${srcdir}/lightning-$pkgver.xpi

	_emid=$(grep em:id install.rdf | tail -n 1 | sed 's/.*>\(.*\)<.*/\1/')
	cd ../
	mv ${pkgname} ${_emid}
	cd ${_emid}

	# Fix permissions
	find -type d -exec chmod 0755 \{\} \+
	find -type f -exec chmod 0644 \{\} \+
	find -name '*.so' -exec chmod 0755 \{\} \+
}
