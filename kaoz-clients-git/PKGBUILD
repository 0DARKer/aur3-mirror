# Maintainer: Arthur Darcet <arthur.darcet@m4x.org>

pkgname=kaoz-clients-git
pkgver=20130309
pkgrel=3
pkgdesc="Client scripts for kaoz (IRC notifier in python by Binet RÃ©seau)"
arch=('any')
url="https://github.com/BinetReseau/kaoz-clients.git"
license=('MIT')
depends=('socat')
makedepends=('git')
optdepends=('kaoz-git: Needs to be installed somewhere in your network')
install='kaoz-clients.install'
backup=('usr/share/kaoz-clients/pipes/ircpipe.sh' 'usr/share/kaoz-clients/pipes/ircpipe.py')

_gitroot=${url}
_gitname=${pkgname}

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi
}

package() {
  mkdir -p "${pkgdir}/usr/share"
  cp -r "${srcdir}/$_gitname" "${pkgdir}/usr/share/kaoz-clients"
  chmod u=rwX,g=rX,o= "${pkgdir}/usr/share/kaoz-clients/" -R
  chmod o=rX "${pkgdir}/usr/share/kaoz-clients/style/irc-style.sh"
  chmod o=rX "${pkgdir}/usr/share/kaoz-clients/nagios/format-message"
  chmod o=X "${pkgdir}/usr/share/kaoz-clients/pipes/ircpipe.sh"
  chmod o=X "${pkgdir}/usr/share/kaoz-clients/pipes/ircpipe.py"
}
