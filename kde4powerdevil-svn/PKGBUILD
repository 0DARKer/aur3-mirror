# KDE4PowerDevil Subversion Package
# Contributor: David Moore <davidm@sjsoft.com>

# PKGINFO
pkgname=kde4powerdevil-svn
pkgver=865772
pkgrel=1
pkgdesc="KDE4PowerDevil is an utility for KDE4 Laptop Power Management"
arch=('i686' 'x86_64')
url="http://www.kde-apps.org/content/show.php/PowerDevil?content=85078"
license=('GPL')
depends=('qt>=4.4.0' 'kdelibs>=4.1.0' 'kdebase-workspace>=4.1.0' 'phonon>=4.1.0' 'libx11' 'libxpm')
makedepends=('subversion' 'cmake' 'automoc4' 'gcc')
provides=('kde4powerdevil')
#conflicts=('kpowersave' 'kpowersave-svn' 'kpowersave-devel')
#replaces=('kpowersave')
source=()
md5sums=()

# SVN variables
_svnmod="4.1"
_svntrunk="svn://anonsvn.kde.org/home/kde/tags/powerdevil"

# Create the package
build() {
	cd $startdir/src

	# Get the latest SVN source
	msg "Connecting to the SVN server..."

	# Update source if it already exists
	if [ -d ./$_svnmod ]; then
		msg "Updating modules..."
		svn up $_svnmod || return 1
		msg "SVN update finished."
	else
		msg "Checking out source..."
		svn co $_svntrunk/$_svnmod || return 1
		msg "SVN checkout complete."
	fi

	# Create a build directory
	msg "Creating build directory..."
	mkdir -p ./$_svnmod-build && msg "Done."
	cd ./$_svnmod-build
	
	msg "Starting CMake..."
	
	# Installation directory - change '_destdir="/usr"' to '_destdir="/opt/kde"' if
	# you're NOT using KDEMod ( Optional ).
	_destdir="/usr"
	
	# Create the build files in the build directory
	cmake ../$_svnmod -DCMAKE_INSTALL_PREFIX=$_destdir || return 1
	
	msg "Good, starting Make..."
	
	# Make the package
	make || return 1
	
	msg "Make successful, installing..."
	
	# Install the package to the fakeroot directory
	make DESTDIR=$startdir/pkg install || return 1
}
