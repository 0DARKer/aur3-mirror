# Contributor: <fedor@yu.wildpark.net>

pkgname=ss5
pkgver=3.7.4
pkgrel=3
pkgdesc="ss5 is a socks server, which supports both SOCKS4 and SOCKS5 protocols,
that runs on Linux/Solaris platforms."
arch=('i686' 'x86_64')
url="http://ss5.sf.net/"
license=('GPL')
depends=(libldap pam openssl heimdal)
install=ss5.install
source=(http://downloads.sourceforge.net/ss5/$pkgname-$pkgver-1.tar.gz SS5Main.h.patch configure.ac.patch)
md5sums=()
install=$pkgname.install
backup=('/etc/ss5/ss5.conf' '/etc/ss5/ss5.passwd' '/etc/conf.d/ss5' )

build() {
  cd ${startdir}/src/$pkgname-${pkgver}/
# gssapi
  patch -p1 < ../SS5Main.h.patch || return 1
  patch -p1 < ../configure.ac.patch || return 1
#
  autoconf
  ./configure --with-libpath=/usr/lib \
  --with-confpathbase=/etc \
  --with-passwordfile=/etc/ss5/ss5.passwd \
  --with-configfile=/etc/ss5/ss5.conf \
  --with-profilepath=/etc/ss5 \
  --without-gssapi

  make || return 1
  make install dst_dir=${startdir}/pkg
  rm -rf ${startdir}/pkg/etc/sysconfig
  rm -rf ${startdir}/pkg/etc/rc.d/init.d
  #
  install -D -m644 ${startdir}/ss5.confd ${startdir}/pkg/etc/conf.d/ss5
  install -D -m744 ${startdir}/ss5d ${startdir}/pkg/etc/rc.d/ss5
  
}
