# Maintainer: Alexander Fehr <pizzapunk gmail com>

pkgname=firefox-oldbar
pkgver=1.2
_firefoxver=3.6
pkgrel=2
pkgdesc="Firefox add-on which makes the location bar look like in Firefox 2"
arch=('any')
url="https://addons.mozilla.org/en-US/firefox/addon/6227"
license=('custom')
depends=('firefox')
source=(http://releases.mozilla.org/pub/mozilla.org/addons/6227/oldbar-$pkgver-fx.xpi)
md5sums=('a4d7037b8cc1aeee1d2ac60dbc224941')

build() {
  cd $srcdir

  emid=$(sed -n '/.*<em:id>\(.*\)<\/em:id>.*/{s//\1/p;q}' install.rdf) || return 1

  install -d $pkgdir/usr/lib/firefox-$_firefoxver/extensions/$emid || return 1
  cp -a * $pkgdir/usr/lib/firefox-$_firefoxver/extensions/$emid || return 1

  rm -f $pkgdir/usr/lib/firefox-$_firefoxver/extensions/$emid/*.xpi || return 1
  chmod -R -x+X $pkgdir/usr/lib/firefox-$_firefoxver/extensions/$emid || return 1

  # Fix maximum supported version
  sed -i 's|<em:maxVersion>3.0b4pre</em:maxVersion>|<em:maxVersion>3.6.*</em:maxVersion>|' \
    $pkgdir/usr/lib/firefox-$_firefoxver/extensions/$emid/install.rdf || return 1
}
