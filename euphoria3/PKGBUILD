# Contributor: Harald Ersch <harald@ersch.ro>
# Maintainer: Jesse Jaara <gmail: jesse.jaara>

pkgname=euphoria3
pkgver=3.1.1
pkgrel=1
arch=('i686' 'x86_64')
pkgdesc="Old series 3 version. A simple, flexible, and easy programming language for Windows, DOS, Linux and FreeBSD"
url="http://www.rapideuphoria.com"
license="custom:euphoria"
if [ "$CARCH" = "x86_64" ]; then
depends=('lib32-glibc')
makedepends=('upx' 'gcc-multilib')
fi
depends=('glibc')
makedepends=('upx')
source=(http://www.rapideuphoria.com/31/euphor31.tar 64bit_fix.patch)
install=euphoria.install
options=(!strip)
build() {
	cd $startdir/src/$pkgname/source
	export EUDIR=$startdir/src/$pkgname
	export PATH=$startdir/src/$pkgname/bin:$PATH

if [ "$CARCH" = "x86_64" ]; then
        patch -p 2 -i $srcdir/64bit_fix.patch
	sed 's|./emake|sed "s/gcc/gcc -m32/g" -i emake\n./emake|g' -i buildu
        export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
fi
	sed 's|~/upx|upx|g' -i bmakeu
./buildu
install -d   $startdir/pkg/{etc/profile.d/,usr/bin,/usr/lib/euphoria,usr/share/$pkgname/demo/langwar}
install -d  $startdir/pkg/{usr/share/$pkgname/demo/linux,usr/share/$pkgname/demo/bench}
install -d  $startdir/pkg/{usr/share/$pkgname/html,usr/share/$pkgname/doc,usr/include/}
install -d  $startdir/pkg/{usr/share/$pkgname/tutorial,usr/share/licenses/$pkgname}
cp  $startdir/src/$pkgname/bin/ecu.a $startdir/pkg/usr/lib/$pkgname 
cp  $startdir/src/$pkgname/License.txt $startdir/pkg/usr/share/licenses/$pkgname
cp -r $startdir/src/$pkgname/bin/* $startdir/pkg/usr/bin
cp  $startdir/src/$pkgname/*.doc $startdir/pkg/usr/share/$pkgname
cp -r $startdir/src/$pkgname/include/* $startdir/pkg/usr/include
cp -r $startdir/src/$pkgname/demo/* $startdir/pkg/usr/share/$pkgname/demo
cp -r $startdir/src/$pkgname/doc/* $startdir/pkg/usr/share/$pkgname/doc
cp -r $startdir/src/$pkgname/html/* $startdir/pkg/usr/share/$pkgname/html
cp -r $startdir/src/$pkgname/tutorial/* $startdir/pkg/usr/share/$pkgname/tutorial
echo "export EUDIR=/usr" >> $startdir/pkg/etc/profile.d/$pkgname.sh
chmod +x $startdir/pkg/etc/profile.d/$pkgname.sh
}

md5sums=('9bd3f2dd78561f36565ebd47cac7199d'
         'fd1a6e5ce1fee54c2eb4904c2c7c1340')
