# Maintainer: falkTX <falktx@gmail.com>

pkgname=carla
pkgtitle=Carla
pkgver=1.0.0
pkgrel=1
pkgdesc="Audio Plugin Host"
arch=('i686' 'x86_64')
url="http://kxstudio.sf.net/carla"
license=('GPL2')
depends=("qt4" "liblo"
         "alsa-lib" "libpulse"
         "fluidsynth" "linuxsampler-svn"
         "libsndfile" "libsmf" "fftw" "mxml" "zlib" "ntk-git"
         "ffmpeg" "glu")
makedepends=("qt4" "liblo"
             "alsa-lib" "libpulse"
             "fluidsynth" "linuxsampler-svn"
             "libsndfile" "libsmf" "fftw" "mxml" "zlib" "ntk-git"
             "ffmpeg" "glu"
             "gtk2" "gtk3")
optdepends=("gtk2: lv2 gtk2 ui support"
            "gtk3: lv2 gtk3 ui support"
            "zynaddsubfx: zynaddsubfx banks")
conflicts=("carla-git")
source=("https://downloads.sourceforge.net/project/kxstudio/Releases/$pkgname/$pkgtitle-$pkgver-src.tar.bz2"
        "1f9554d88956ade1e5fb52c5038604a5cd3ec013.patch")
md5sums=('0607d3ba72f60e74e516ec38e563983f'
         '10cb630fb5dac545d27e080a5e444644')

build() {
  cd "$srcdir/$pkgtitle-$pkgver"
  make
}

package() {
  cd "$srcdir/$pkgtitle-$pkgver"
  make install DESTDIR="$pkgdir/" PREFIX=/usr

  # Fix for linuxsampler
  sed -i "s/exec /export LD_LIBRARY_PATH=\/usr\/lib\/linuxsampler\nexec /" \
      "$pkgdir/usr/bin/carla" \
      "$pkgdir/usr/bin/carla-control" \
      "$pkgdir/usr/bin/carla-single"
}
