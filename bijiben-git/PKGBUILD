# Maintainer: pictuga <generaleduweb@gmail.com>

pkgname=bijiben-git
_realname=bijiben
pkgver=20121214
pkgrel=1
pkgdesc="Write out notes, every detail matters"
arch=('i686' 'x86_64')
url="http://git.gnome.org/browse/bijiben/"
license=('GPL2')

depends=('dconf' 'gtk3' 'webkitgtk3' 'libzeitgeist' 'libtracker-sparql' 'clutter-gtk' 'libxml2' 'yelp-tools' 'desktop-file-utils' 'hicolor-icon-theme' 'gd')
makedepends=('intltool' 'gnome-doc-utils' 'git' 'gnome-common')

#provides=("${_realname}=${_realver}")
provides=("${_realname}")
conflicts=("${_realname}")
install=bijiben-git.install

_gitroot="git://git.gnome.org/bijiben"
_gitname="bijiben"

build() {
	 cd ${srcdir}/

	 msg "Connecting to the GNOME GIT server..."
	 if [[ -d ${srcdir}/${_gitname} ]] ; then
	 	cd ${_gitname}
	 	git pull origin
	 	msg "The local files are updated..."
	 else
	 	git clone ${_gitroot} ${gitname}
	 fi

	 msg "GIT checkout done."

	 msg2 "Starting make for: ${pkgname}"

	 if [[ -d ${srcdir}/${_gitname}-build ]]; then
		 msg "Cleaning the previous build directory..."
		 rm -rf ${srcdir}/${_gitname}-build
	 fi

	 git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build

	 cd ${srcdir}/${_gitname}-build
	 
	 msg "Starting configure..."

	 ./autogen.sh \
		--prefix=/usr --sysconfdir=/etc \
		--localstatedir=/var --disable-static \
		--libexec=/usr/lib/$_realname

	 make
}

package()

{
	cd ${srcdir}/${_gitname}-build
	make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="${pkgdir}" install

	install -m755 -d "${pkgdir}/usr/share/gconf/schemas"
	gconf-merge-schema "${pkgdir}/usr/share/gconf/schemas/${pkgname}.schemas" ${pkgdir}/etc/gconf/schemas/*.schemas
	rm -f ${pkgdir}/etc/gconf/schemas/*.schemas
}
