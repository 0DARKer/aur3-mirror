# Maintainer: Frozen Fox <frozenfoxz@gmail.com>
# Contributor: Aurelien Foret <orelien@chez.com>
 

pkgname=zsnes-netplay
pkgver=1.42n
pkgrel=2
pkgdesc="Super Nintendo emulator"
url="http://www.zsnes.com/"
arch=('i686' 'x86_64')
license=('GPL')
options=(!buildflags)
conflicts=('zsnes')

if [[ $CARCH == "x86_64" ]]; then
  depends=('gcc-libs-multilib' 'lib32-sdl' 'lib32-libpng>=1.5.0' 
'lib32-libgl' 'lib32-ncurses' 'lib32-mesa')
  makedepends=('nasm' 'gcc-multilib')
else
  depends=('gcc-libs' 'sdl' 'libpng>=1.5.0' 'libgl' 'ncurses' 
'mesa')
  makedepends=('nasm' 'gcc')
fi

source=(http://snesemu.black-ship.net/emus/zsnes/zsnesnet.tar.bz2
        zsnes.patch
        libpng.patch
        zsnes_icon.png)
    
md5sums=('890fa9174edb127b1a3e7607258db32d'
         'aa250af3ef8dbf8a44e095d4cd132db2'
         'f7366961f21ed63d0844a3a6d4780bcf'
         'b5260c02adfc3b7ff725041214b00bfd')

build() {
  cd "$srcdir/"

#  patch -p1 -i ../zsnes.patch
   patch -p1 -i ../libpng.patch
  

  if [ $CARCH == "x86_64" ]; then
    export CC="gcc -m32"
    export CXX="g++ -m32"
  fi
sh  ./autogen.sh --prefix=/usr \
    x_libraries=/usr/lib \
    force_arch=i686 \
    --enable-release
  
  make
}

package() {
  cd "$srcdir"

  cd "${srcdir}"

  make DESTDIR=${pkgdir} install
  
  # adding --mandir= to autoconf line fails
  install -dm755 ${pkgdir}/usr/share

  install -Dm644 ${srcdir}/zsnes_icon.png ${pkgdir}/usr/share/pixmaps/zsnes_icon.png

  mv ${pkgdir}/usr/man ${pkgdir}/usr/share
}

# vim:set ts=2 sw=2 et:
