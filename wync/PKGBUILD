# Maintainer: Jameson Pugh <imntreal@gmail.com>
# Maintainer: stef312 <stef312_at_gmail_dot_com>
# Maintainer: Gaspar de El√≠as <caspercba_at_hotmail_dot_com>
# Maintainer: Artem Sheremet <dot_doom_at_gmail_dot_com>

pkgname=wync
pkgver=2.0.230
pkgrel=1
if test "$CARCH" == x86_64; then
	_arch=64
elif test "$CARCH" == i686; then
	_arch=32
  pkgver=2.0.233
fi
pkgdesc="Microsoft Lync client for Linux"
arch=('x86_64' 'i686')
license=('custom:"Copyright (c) 2014 Fisil LLC"')
depends=('curl' 'gcc-libs-multilib' 'ffmpeg-compat' 'gtk2' 'nss' 'qt5-multimedia' 'libxss' 'qt5-quick1' 'qt5-svg' 'postgresql-libs' 'libxkbfile')
makedepends=('chrpath')
url="http://fisil.com/linuxlync.html"
install="${pkgname}.install"
source=("http://fisil.com/linux/wync_ubuntu${_arch}_v${pkgver}.deb"
				'wync.conf'
				'LICENSE'
				'wync.sh')
if test "$CARCH" == x86_64; then
  sha256sums=('d16943ff3487839ffeb7fa14aeb4cdb972858a6c402c36277af73d888b42ae36'
              'c66fc39d071e1595a6cf94a7db566555a40596a8db1eb2bb4d428f692c1d6a17'
              '53f44cbf22b57f2c93973ee2857ea896ffbd62d49f71c8900487f40381b53521'
              '38b137942e2b026c0ebc90622833d55b93855747aa1e2e6121f120e8643f108c')
elif test "$CARCH" == i686; then
	sha256sums=('0288844b74fd143f6f38c08f1ad2a716f3a3146c2499977bee9ad49ee84f78f6'
              'c66fc39d071e1595a6cf94a7db566555a40596a8db1eb2bb4d428f692c1d6a17'
							'53f44cbf22b57f2c93973ee2857ea896ffbd62d49f71c8900487f40381b53521'
							'38b137942e2b026c0ebc90622833d55b93855747aa1e2e6121f120e8643f108c')
fi

package() {
	cd "${srcdir}"
	ar x "wync_ubuntu${_arch}_v${pkgver}.deb" >/dev/null
	tar -xzf data.tar.gz

	install -Dm 755 "${srcdir}/opt/wync_linux/wync" "${pkgdir}/opt/wync_linux/wync"
	install -m 755 "${srcdir}/wync.sh" "${pkgdir}/opt/wync_linux/wync.sh"
	install -Dm 644 "${srcdir}/opt/wync_linux/lib/libicudata.so.52.1" "${pkgdir}/usr/lib/libicudata.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicutest.so.52.1" "${pkgdir}/usr/lib/libicutest.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicule.so.52.1" "${pkgdir}/usr/lib/libicule.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicutu.so.52.1" "${pkgdir}/usr/lib/libicutu.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicui18n.so.52.1" "${pkgdir}/usr/lib/libicui18n.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libiculx.so.52.1" "${pkgdir}/usr/lib/libiculx.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicuio.so.52.1" "${pkgdir}/usr/lib/libicuio.so.52.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libicuuc.so.52" "${pkgdir}/usr/lib/libicuuc.so.52"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libsipw.so.1.0.0" "${pkgdir}/usr/lib/libsipw.so.1.0.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-nt.so.0.1" "${pkgdir}/usr/lib/libwinpr-nt.so.0.1"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libSDL-1.3.so.0" "${pkgdir}/usr/lib/libSDL-1.3.so.0"

  ## FreeRDP ##
	install -m 644 "${srcdir}/opt/wync_linux/lib/libxfreerdp-server.so.1.1.0" "${pkgdir}/usr/lib/libxfreerdp-server.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libxfreerdp-client.so.1.1.0" "${pkgdir}/usr/lib/libxfreerdp-client.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-utils.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-utils.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-server.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-server.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-rail.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-rail.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-primitives.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-primitives.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-locale.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-locale.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-gdi.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-gdi.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-crypto.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-crypto.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-core.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-core.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-common.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-common.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-codec.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-codec.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-client.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-client.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libfreerdp-cache.so.1.1.0" "${pkgdir}/usr/lib/libfreerdp-cache.so.1.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-thread.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-thread.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-dsparse.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-dsparse.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-sysinfo.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-sysinfo.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-registry.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-registry.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-handle.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-handle.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-crt.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-crt.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-library.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-library.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-rpc.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-rpc.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-path.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-path.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-pool.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-pool.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-sspi.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-sspi.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-file.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-file.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-synch.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-synch.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-input.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-input.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-interlocked.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-interlocked.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-utils.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-utils.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-heap.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-heap.so.0.1.0"
	install -m 644 "${srcdir}/opt/wync_linux/lib/libwinpr-environment.so.0.1.0" "${pkgdir}/usr/lib/libwinpr-environment.so.0.1.0"
  ####

	install -Dm 644 "${srcdir}/usr/share/pixmaps/wync.png" "${pkgdir}/usr/share/pixmaps/wync.png"
	install -Dm 644 "${srcdir}/usr/share/lintian/overrides/wync" "${pkgdir}/usr/share/lintian/overrides/wync"
	install -Dm 644 "${srcdir}/usr/share/menu/wync" "${pkgdir}/usr/share/menu/wync"

	install -dm 755 "${pkgdir}/usr/bin"
	ln -s /opt/wync_linux/wync.sh "${pkgdir}/usr/bin/wync"

	# Fix .desktop file
	sed -i 's/sh \/opt\/wync_linux\/wync.sh/\/usr\/bin\/wync/' "${srcdir}/usr/share/applications/wync.desktop"
	install -Dm 644 "${srcdir}/usr/share/applications/wync.desktop" "${pkgdir}/usr/share/applications/wync.desktop"

	cp -rf "${srcdir}/opt/wync_linux/sounds" "${pkgdir}/opt/wync_linux/"

	# Remove RPATHs
	chrpath -d "${pkgdir}/opt/wync_linux/wync"
	chrpath -d "${pkgdir}/usr/lib/libicudata.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libicutest.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libicule.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libicutu.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libicui18n.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libiculx.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libicuio.so.52.1"
	chrpath -d "${pkgdir}/usr/lib/libsipw.so.1.0.0"

  install -Dm 644 wync.conf "${pkgdir}/etc/ld.so.conf.d/wync.conf"
	install -Dm 644 LICENSE "${pkgdir}/usr/share/licenses/wync/LICENSE"
}

# vim: set ts=2 sw=2 ft=sh noet:
