# Maintainer: Jameson Pugh <imntreal@gmail.com>
# Maintainer: stef312 <stef312_at_gmail_dot_com>
# Maintainer: Gaspar de El√≠as <caspercba_at_hotmail_dot_com>
# Maintainer: Artem Sheremet <dot_doom_at_gmail_dot_com>

pkgname=wync
pkgver=2.0.206
pkgrel=1
if test "$CARCH" == x86_64; then
	_arch=64
elif test "$CARCH" == i686; then
	_arch=32
fi
pkgdesc="Microsoft Lync client for Linux"
arch=('x86_64' 'i686')
license=('custom:"Copyright (c) 2014 Fisil LLC"')
depends=('libxkbfile' 'curl' 'gcc-libs-multilib' 'ffmpeg-compat' 'gtk2' 'nss' 'qt5-multimedia' 'libxss' 'qt5-quick1' 'qt5-svg' 'postgresql-libs')
url="http://fisil.com/products.html"
options=('!strip' 'staticlibs')
source=("http://fisil.com/linux/wync_ubuntu${_arch}_v${pkgver}.deb"
				'wync.conf')
if test "$CARCH" == x86_64; then
	sha256sums=('c54d41da7b42f2c025d9b0bb68db4c7790c570677507e965de5e154a9e233002'
              'c66fc39d071e1595a6cf94a7db566555a40596a8db1eb2bb4d428f692c1d6a17')
elif test "$CARCH" == i686; then
	sha256sums=('0288844b74fd143f6f38c08f1ad2a716f3a3146c2499977bee9ad49ee84f78f6'
              'c66fc39d071e1595a6cf94a7db566555a40596a8db1eb2bb4d428f692c1d6a17')
fi

package() {
	cd "${srcdir}"
	ar x "wync_ubuntu${_arch}_v${pkgver}.deb" >/dev/null
	tar -xzf data.tar.gz -C "${pkgdir}"

	# Remove autorun xdg file
	rm -rf "${pkgdir}/etc"

	# Remove group/world-writable bit
	chmod -R go-w "${pkgdir}/opt"
	chmod -R go-w "${pkgdir}/usr"

	install -dm 755 "${pkgdir}/usr/bin"
	ln -s /opt/wync_linux/wync.sh "${pkgdir}/usr/bin/wync"
	
	install -dm 755 "${pkgdir}/etc/ld.so.conf.d"
  install -m 755 wync.conf "${pkgdir}/etc/ld.so.conf.d/wync.conf"
}

# vim: set ts=2 sw=2 ft=sh noet:
