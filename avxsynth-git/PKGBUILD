# Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=avxsynth-git
pkgver=20130312
pkgrel=1
pkgdesc="Linux Port of AviSynth. (Git version)"
arch=('i686' 'x86_64')
url="http://www.avxsynth.org"
license=('GPL2')
depends=('qt4' 'mplayer' 'log4cpp' 'ffmpegsource' 'pango')
makedepends=('git' 'svn' 'yasm' 'subversion' 'python2')
provides=('avxsynth')
conflicts=('avxsynth')
options=('!libtool')

_gitroot="git://github.com/avxsynth/avxsynth.git"
_gitname="avxsynth"

build() {
  cd "${srcdir}"

  msg "Connecting to avxsynth GIT server..."
  if [ -d "${_gitname}" ] ; then
    cd "${_gitname}"
    git pull
    git fetch extra
    git merge extra/extra master
  else
    git clone --depth=1 "${_gitroot}" "${_gitname}"
    cd "${_gitname}"
    git remote add extra git://github.com/qyot27/avxsynth.git
    git fetch extra
    git merge extra/extra master
  fi

  msg "GIT checkout done or server timeout"

  rm -fr "${srcdir}/${_gitname}-build"
  cp -R "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
  cd "${srcdir}/${_gitname}-build"

  autoreconf -if
  ./configure --prefix=/usr --enable-all --enable-silent-rules

  make
  msg2 "Done"
}

package() {
  cd "${srcdir}/${_gitname}-build"
  make DESTDIR="${pkgdir}" install
}
