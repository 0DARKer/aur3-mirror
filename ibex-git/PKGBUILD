# Maintainer: Christoph Haag <haagch@studi.informatik.uni-stuttgart.de>
pkgname=ibex-git
pkgver=20130317
pkgrel=1
pkgdesc="Ibex - 3D Virtual Reality Desktop/Compositing Manager for X11/Linux, Windows and Mac OS (for e.g. Oculus Rift)"
arch=('i686' 'x86_64')
url="https://bitbucket.org/druidsbane/ibex/overview"
license=('GPL')
depends=('mesa')
makedepends=('irrlicht' 'freeglut' 'glew' 'tinyxml')
source=('fix_install_prefix.diff' 'ibex-startscript')

# not in AUR I think
# optdepends=('blender-ogre-exporter: to convert models to Ogre meshes: https://code.google.com/p/blender2ogre/')

_gitroot="https://bitbucket.org/druidsbane/ibex.git"
_gitname="ibex"

build() {

  msg "Connecting to https://bitbucket.org/druidsbane/ibex.git"
  if [ -d ${srcdir}/$_gitname ] ; then
     cd $_gitname && git pull origin
     msg "The local files are updated."
  else
     git clone $_gitroot
  fi
  msg "GIT checkout done or server timeout"

  # it doesn't respect -DCMAKE_INSTALL_PREFIX so we need to fix it, best to do it in a copy of the git repository
  rm -rf ${srcdir}/$_gitname-copy
  cp -rH ${srcdir}/$_gitname ${srcdir}/$_gitname-copy
  cd ${srcdir}/$_gitname-copy
  git apply ${srcdir}/fix_install_prefix.diff

  rm -rf ${srcdir}/$_gitname-build
  mkdir -p ${srcdir}/${_gitname}-build
  cd ${srcdir}/${_gitname}-build

  msg "Starting make..."

  cmake ../${_gitname}-copy/ -DCMAKE_INSTALL_PREFIX=/usr \
         -DCMAKE_CXX_FLAGS=-lboost_system \
         -DCMAKE_BUILD_TYPE=Release \

  make
}

package() {
  cd ${srcdir}/${_gitname}-build
  make DESTDIR="$pkgdir/" install
  install -m 755 -d ${pkgdir}/usr/bin/
  install -m 755 ${startdir}/ibex-startscript ${pkgdir}/usr/bin/ibex
}

# vim:set ts=2 sw=2 et:
md5sums=('49c6c0e7b3f5f6b2fcc405093248d339'
         '7b6df4c5a397928b839d978ac30ef613')
