# Maintainer : Murtuza Akhtari <inxsible at gmail dot com>
# Contributor: Keshav P R <skodabenz at rocketmail dot com>

pkgname=efibootmgr
pkgver=0.5.4
pkgrel=5
pkgdesc="Tool to modify UEFI Firmware Boot Manager Variables. Needs the kernel module 'efivars'."
arch=('i686' 'x86_64')
url="http://linux.dell.com/efibootmgr/"
license=('GPL2')
depends=('zlib')
makedepends=()
conflicts=('efibootmgr-git')
provides=()
options=(strip purge docs zipman !emptydirs)

source=("http://linux.dell.com/efibootmgr/permalink/${pkgname}-${pkgver}.tar.gz"
		'efibootmgr_after_0.5.4_git.patch' 
		'efibootmgr_default_to_grub2.patch')

sha256sums=('b562a47a4f5327494992f2ee6ae14a75c5aeb9b4a3a78a06749d5cd2917b8e71'
			'9009c56b034f3b2c9fb33bf5b56a8aad5e04bdfea11516c41d7588f2890edc3f'
			'5306a6f952d17215b129392953ae6551df0e4cf1960a959ab98c60f27fab9b90')


build() {
	
	rm -rf ${srcdir}/efibootmgr-${pkgver}_build/ || true
	
	cp -r ${srcdir}/efibootmgr-${pkgver} ${srcdir}/efibootmgr-${pkgver}_build
	
	cd ${srcdir}/efibootmgr-${pkgver}_build/
	
	patch -Np1 -i ${srcdir}/efibootmgr_after_0.5.4_git.patch
	patch -Np1 -i ${srcdir}/efibootmgr_default_to_grub2.patch
	echo
	
	CFLAGS= make
	echo
	
}


package() {
	
	mkdir -p ${pkgdir}/usr/sbin/
	mkdir -p ${pkgdir}/usr/share/man/man8/
	
	cd ${srcdir}/efibootmgr-${pkgver}_build/
	
	install -D -m755 ${srcdir}/efibootmgr-${pkgver}_build/src/efibootmgr/efibootmgr ${pkgdir}/usr/sbin/efibootmgr
	install -D -m644 ${srcdir}/efibootmgr-${pkgver}_build/src/man/man8/efibootmgr.8 ${pkgdir}/usr/share/man/man8/efibootmgr.8
	
}
