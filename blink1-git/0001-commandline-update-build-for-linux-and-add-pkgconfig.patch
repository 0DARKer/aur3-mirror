From f8f8fe61d67c6770c7a6e83eb381213ebdc48eaa Mon Sep 17 00:00:00 2001
From: Christian Hesse <mail@eworm.de>
Date: Mon, 26 Aug 2013 10:21:02 +0200
Subject: [PATCH 1/1] commandline: update build for linux and add pkgconfig
 file

---
 commandline/Makefile      |  8 ++++----
 commandline/blink1-lib.pc | 12 ++++++++++++
 2 files changed, 16 insertions(+), 4 deletions(-)
 create mode 100644 commandline/blink1-lib.pc

diff --git a/commandline/Makefile b/commandline/Makefile
index 21ee11f..977ed2d 100644
--- a/commandline/Makefile
+++ b/commandline/Makefile
@@ -117,13 +117,13 @@ endif
 
 #################  Linux  ####################################################
 ifeq "$(OS)" "linux"
-LIBTARGET = blink1-lib.so
+LIBTARGET = libblink1.so
 CFLAGS += `pkg-config libusb-1.0 --cflags` -fPIC
 LIBS   += `pkg-config libusb-1.0 --libs` -lrt -lpthread -ldl
 
 OBJS = ./hidapi/libusb/hid.o
 
-EXEFLAGS = -static
+EXEFLAGS =
 LIBFLAGS = -shared -o $(LIBTARGET) $(LIBS)
 
 EXE=
@@ -155,7 +155,7 @@ CFLAGS += -I./hidapi/hidapi -I./mongoose -g
 OBJS +=  blink1-lib.o 
 
 #all: msg blink1-tool blink1-server-simple
-all: msg blink1-tool lib
+all: msg lib blink1-tool
 
 msg: 
 	@echo "building for OS=$(OS)"
@@ -177,7 +177,7 @@ $(OBJS): %.o: %.c
 
 blink1-tool: $(OBJS) blink1-tool.o
 	$(CC) $(CFLAGS) -c blink1-tool.c -o blink1-tool.o
-	$(CC) $(CFLAGS) $(EXEFLAGS) -g $(OBJS) $(LIBS) blink1-tool.o -o blink1-tool$(EXE) 
+	$(CC) $(CFLAGS) $(EXEFLAGS) -g $(LIBS) -L. -lblink1 blink1-tool.o -o blink1-tool$(EXE) 
 
 blink1-server-simple: $(OBJS) blink1-server-simple.c
 	$(CC) $(CFLAGS) -c blink1-server-simple.c -o blink1-server-simple.o
diff --git a/commandline/blink1-lib.pc b/commandline/blink1-lib.pc
new file mode 100644
index 0000000..5caba01
--- /dev/null
+++ b/commandline/blink1-lib.pc
@@ -0,0 +1,12 @@
+prefix=/usr
+exec_prefix=${prefix}
+libdir=${exec_prefix}/lib
+sharedlibdir=${libdir}
+includedir=${prefix}/include
+
+Name: blink1
+Description: software for blink(1) USB RGB LED
+Version: git
+
+Libs: -L${libdir} -L${sharedlibdir} -lblink1
+Cflags: -I${includedir}
-- 
1.8.4

