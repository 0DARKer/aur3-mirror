# Maintainer: Sven-Hendrik Haase <sh@lutzhaase.com>
# Contributor: Jaroslav Lichtblau <dragonlord@aur.archlinux.org>

pkgname=vegastrike
pkgver=0.5.1beta1
_pkgver=0.5.1.beta1
pkgrel=1
pkgdesc="3D Action-Space-Sim to trade and bounty hunt in a vast universe"
arch=('i686' 'x86_64')
url="http://vegastrike.sourceforge.net/"
license=('GPL')
depends=('gcc-libs' 'freetype2' 'freeglut' 'gtk2' 'openal' 'sdl' 'python2' 'libvorbis' 'ffmpeg' 'openal' 'boost-libs' 'vegastrike-data')
makedepends=('boost')
#makedepends=('cmake')
source=(http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-src-${_pkgver}-2.tar.bz2
        gcc46.patch)
md5sums=('ccfe1df1e4b481ee28fa7290705cb89d'
         '0c71b5615505da58843427d208e636d0')

build() {
  cd ${srcdir}/$pkgname-src-$_pkgver

  patch -Np0 < "$srcdir/gcc46.patch"

# vegastrike currently crashes with cmake building
  #[[ -d build ]] && rm -r build
  #mkdir build && cd build
  #
  #cmake \
  #    -DUSE_SYSTEM_BOOST=ON \
  #    -DUSE_NET_THREAD_POSIX=ON \
  #    -DCMAKE_CXX_FLAGS="-DDATA_DIR=/usr/share/vegastrike/" \
  #    ..

  ./configure \
      --disable-boost \
      --prefix=/usr \
      --with-boost=system \
      --with-data-dir=/usr/share/vegastrike
  make
}

package() {
  cd ${srcdir}/$pkgname-src-$_pkgver

  #cd build
  make DESTDIR=${pkgdir} install

# move objconv dir to right path and avoiding conflict with mysql's 'replace' file
  install -d ${pkgdir}/usr/share/$pkgname
  mv -f ${pkgdir}/usr/objconv ${pkgdir}/usr/share/$pkgname/objconv
  mv ${pkgdir}/usr/bin/replace ${pkgdir}/usr/bin/vsreplace
}
