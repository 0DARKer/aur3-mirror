# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname=smewt
pkgver=0.3.1
pkgrel=1
pkgdesc="A Smart Media Manager"
arch=('i686' 'x86_64')
url="http://www.smewt.com/"
license=('GPL3')
depends=('python-lxml' 'pygoo>=0.1.3' 'python2-qt' 'python-cheetah' 'python2-feedparser' 'python-guessit')
source=(http://www.smewt.com/downloads/$pkgname-$pkgver.tar.gz)
md5sums=('9d844952173186fc74f6343dd5f7ddfd')

build() {
  cd $srcdir/$pkgname-$pkgver

  python2 setup.py install --root=$pkgdir --optimize=1

  # Python2 fix
  for dir in 3rdparty base guessers gui plugins solvers taggers
  do
  cd $pkgdir/usr/lib/python2.7/site-packages/smewt/$dir
  for file in $(find . -name '*.py' -print); do
  sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
  done
  done

  for dir in movie series speeddial subtitle
  do
  cd $pkgdir/usr/lib/python2.7/site-packages/smewt/media/$dir
  for file in $(find . -name '*.py' -print); do
  sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
  done
  done

  cd $pkgdir/usr/lib/python2.7/site-packages/smewt/guessers
  sed -i 's_#!/usr/bin/env python22.5_#!/usr/bin/env python2_' tmdb.py

  # Desktop icon
  cd $pkgdir/usr/lib/python2.7/site-packages/smewt/icons
  install -Dm644 smewt_64x64.png $pkgdir/usr/share/pixmaps/smewt.png
  install -Dm644 $startdir/smewt.desktop $pkgdir/usr/share/applications/smewt.desktop
}