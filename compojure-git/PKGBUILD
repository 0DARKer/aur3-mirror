# Contributor: chylli (lchangying at gmail dot com)
arch=(i686 x86_64)
pkgname=compojure-git
pkgver=20110506
pkgrel=1
pkgdesc="Concise web framework for Clojure"
url="http://github.com/weavejester/compojure"
license=("CPL" "EPL")
depends=('java-environment' 'clojure' 'leiningen')
makedepends=('apache-ant' 'git')
source=()
md5sums=()

_gitroot=git://github.com/weavejester/compojure.git
_gitname=compojure

build() {
  cd ${srcdir}

  msg "Connecting to github.com GIT server..."
  if [ -d ${_gitname} ]; then
    (cd ${_gitname} && git pull origin)
  else
    git clone ${_gitroot}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting ant build process..."

  rm -rf ${_gitname}-build
  git clone ${_gitname} ${_gitname}-build
  cd ${_gitname}-build

  lein deps && lein jar

  mkdir -p ${pkgdir}/usr/share/clojure
  rm lib/clojure*jar
  install -m 644 -D {compojure*jar,lib/*jar} ${pkgdir}/usr/share/clojure/
}
