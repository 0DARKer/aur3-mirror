# Maintainer: Robert Štětka <robert dot stetka at gmail dot com>
pkgname=freenet-fms
_realname=fms
pkgver=0.3.68
pkgrel=1
url=http://127.0.0.1:8888/USK@0npnMrqZNKRCRoGojZV93UNHCMN-6UU3rRSAmP6jNLE,~BG-edFtdCC1cSH4O3BWdeIYa8Sw5DfyrSV-TKdO5ec,AQACAAE/fms/134/
pkgdesc="Freenet Messaging System"
arch=('i686' 'x86_64')
license=('GPL')
depends=('poco>=1.2.9' 'sqlite3>3.6.14')
makedepends=('cmake')
install=fms.install
source=(http://127.0.0.1:8888/CHK@G--wYvk8T8nzVct2aNSFEYkI7z-9srnNRonsxUnx3sg,73C8cUjx5L5Gm1IyF9VaM4HsEQJ6UZUjZ-PhzaAGQJY,AAIC--8/${_realname}-src-${pkgver}.zip
        'rc.fms'
        'fms.install'
        'bitmapvalidator.patch'
        'fcpv2.patch'
        'imessagelistrequester.patch'
        'simplecaptcha.patch'
        'unlikecaptcha.patch'
        'Mime.patch'
        'nntpconnection.patch'
        'checked.patch'
        'dbmaintenance.patch')
md5sums=('935b559ea64a50a893e77326c35e3542'
         '9b03c9cfc565885e8e0d09ef6e72dceb'
         '6764909fc196c42f7b94e202addf6c56'
         '6ef69b52b47f7281a644c5b58e351b29'
         'b8a1cd8ce356f66a6b5f785d41411dc7'
         'eb1dffb3f6026d765fbe17cc9f23ea33'
         '634f679d7b4c89fb36e3ddd76ff4cf54'
         'e18b2e3e2a9dedc2e2486f66fd113f7f'
         '9516192297c6554ac65fb6753f9a6298'
         '47bddf82512acc7120faa32ee676f589'
         'ded6f60ab2907b0001576c0d30832958'
         '16c676943f1c578cd65804104b5fcd2b')

build() {
  patch -p1 < ../bitmapvalidator.patch
  patch -p1 < ../fcpv2.patch
  patch -p1 < ../imessagelistrequester.patch
  patch -p1 < ../simplecaptcha.patch
  patch -p1 < ../unlikecaptcha.patch
  patch -p1 < ../Mime.patch
  patch -p1 < ../nntpconnection.patch
  patch -p1 < ../checked.patch
  patch -p1 < ../dbmaintenance.patch

  cd "${srcdir}/"

  cmake -D I_HAVE_READ_THE_README=ON -D USE_BUNDLED_SQLITE=OFF . || return 1
  make || return 1

  mkdir -p ${pkgdir}/opt/${_realname}/ || return 1
  cp fms ${pkgdir}/opt/${_realname}/ || return 1
  cp *.htm ${pkgdir}/opt/${_realname}/ || return 1
  cp readme.txt ${pkgdir}/opt/${_realname}/ || return 1
  cp -a fonts/ ${pkgdir}/opt/${_realname}/|| return 1
  cp -R images/ ${pkgdir}/opt/${_realname}/ || return 1
  cp -a styles/ ${pkgdir}/opt/${_realname}/ || return 1
  cp -a translations/ ${pkgdir}/opt/${_realname}/ || return 1

  chown -R 114:114 ${pkgdir}/opt/${_realname} || return 1
  chmod -R ug=rwX,o=rX ${pkgdir}/opt/${_realname}|| return 1

  # rc.d script
  install -Dm755 rc.${_realname} ${pkgdir}/etc/rc.d/${_realname}
}


# vim:set ts=2 sw=2 et:
