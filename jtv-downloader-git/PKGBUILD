
# Maintainer: Policarpo Caballero <policarpocp at gmail dot com>
pkgname=jtv-downloader-git
pkgver=20130424
pkgrel=1
pkgdesc="A live downloader that helps you recording or watching live streams."
arch=('i686' 'x86_64')
url="https://github.com/toine512/jtv-downloader"
license=('GPL3')
depends=('qt4' 'rtmpdump')
makedepends=('git')
install=$pkgname.install
source=(JtvLiveUiTabBasicJustin_tv.h-typo_fix.diff)
md5sums=('641f6983cbed9fbab43ec7bf218a3c3b')

_gitroot="git://github.com/toine512/jtv-downloader.git"
_gitname="jtv-downloader"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
     cd $_gitname && git pull origin && git submodule update --init
     msg "The local files are updated."
   else
     git clone $_gitroot $_gitname && cd $_gitname && git submodule update --init
   fi

   msg "GIT checkout done"
   msg "Starting make..."
   
   cd "$srcdir/$_gitname"

   if true; then
      patch -uN JtvLiveUiTabBasicJustin_tv.h ../../JtvLiveUiTabBasicJustin_tv.h-typo_fix.diff || return 1
   fi
   qmake-qt4 -makefile
   make
}

package() {
  cd "$srcdir/$_gitname"
  install -D -m755 jtv-downloader "${pkgdir}/usr/bin/jtv-downloader"

  # Desktop icon
  cd debian
  install -Dm644 "$_gitname.png" "$pkgdir/usr/share/pixmaps/$_gitname.png"
  install -Dm644 "$_gitname.desktop" "$pkgdir/usr/share/applications/$_gitname.desktop"
}

# vim:set ts=2 sw=2 et:

