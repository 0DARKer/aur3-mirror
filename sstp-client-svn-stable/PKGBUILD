# Contributor: Dmitry V. Luciv <dluciv@dluciv.name>
# Maintainer: Dmitry V. Luciv <dluciv@dluciv.name>

pkgname=sstp-client-svn-stable
pkgver=1.0.9
pkgrel=5
pkgdesc="SSTP client tested SVN experimantally stable revision"
arch=("i686" "x86_64")
url="http://sstp-client.sourceforge.net/"
license=('GPL2')
conflicts=()
provides=('sstp-client-svn-stable')
depends=('ppp' 'openssl')
makedepends=('gcc' 'ppp')
optdepends=()

install=${pkgname}.install

source=( actual_ppp_version.diff )
md5sums=( 0fc3389ff11729d2f2dcc1440a8716e8 )

_svnroot="https://sstp-client.svn.sourceforge.net/svnroot/sstp-client/branches/${pkgver}"
_svnname="sstp-client"
_svnrev="174"

_pfx="/usr"
_lsd="/"

build() {
  cd $srcdir
  msg "Begin checkout..."

  if [ -d $_svnname ]; then
      cd $_svnname && svn up -r $_svnrev
  else
      svn co -r $_svnrev $_svnroot $_svnname
  fi

  msg "Checkout complete or server timeout"

  rm -rf ${srcdir}/${_svnname}-build
  cp -a ${srcdir}/${_svnname} ${srcdir}/${_svnname}-build

  msg "Patching to actual ppp..."
  
  cd ${srcdir}/${_svnname}-build
  patch -p0 -i ../../actual_ppp_version.diff
  
  msg "Begin make..."

  ./configure --prefix=${_pfx} --localstatedir=${_lsd}
  make
}

package() {
  cd ${srcdir}/${_svnname}-build
  make DESTDIR=${pkgdir} install

  install -d ${pkgdir}${_lsd}/run/sstpc
  rm -rf ${pkgdir}/var

  mv ${pkgdir}${_pfx}/sbin ${pkgdir}/usr/bin
}

# End of file
