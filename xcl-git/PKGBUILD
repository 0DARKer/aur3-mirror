# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
pkgname=xcl-git
pkgver=20130311
pkgrel=2
pkgdesc="An native-code implementation of Common Lisp"
arch=('i686' 'x86_64')
url="http://armedbear.org/"
license=('GPL')
depends=('gcc-libs') 
makedepends=('git')
provides=('xcl')
conflicts=('xcl')
source=('etcxclrc')
md5sums=('6f426ad20c0086460067915091cefae8')
backup=('etc/xclrc')

_gitroot="git://github.com/gnooth/xcl.git"
_gitname="xcl"
build() {
  cd "$srcdir"
  msg "Connecting to GIT server..."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  [ -d "$srcdir/$_gitname-build" ] && rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #

  make
  yes "(quit)"|./xcl --eval "(REBUILD-LISP)"
}

package() {
  install -Dm755 "$srcdir/$_gitname-build/xcl" "$pkgdir/usr/bin/xcl"
  install -Dm644 "$srcdir/etcxclrc" "$pkgdir/etc/xclrc"
  install -dm755 "$pkgdir/usr/share/xcl"
  cd "$srcdir/$_gitname-build"
  cp -r lisp compiler clos "$pkgdir/usr/share/xcl"
}
