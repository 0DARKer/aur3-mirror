# Maintainer: ktalog <thektalog@gmail.com>
# Contributor: Florian Mounier aka paradoxxxzero <paradoxxx.zero@gmail.com>
pkgname=cinnamon-system-monitor-applet-git
pkgver=20120126
pkgrel=2
pkgdesc="System monitor extension for Cinnamon (display mem swap cpu usage)"
arch=('any')
url="http://github.com/paradoxxxzero/gnome-shell-system-monitor-applet"
license=('GPL3')
depends=('cinnamon' 'python-gobject' 'libgtop')
makedepends=('git')
install=gschemas.install
source=('cinnamon-system-monitor-applet-config.desktop')
md5sums=('0f5d231b6d13552c8d9c6bf44395b671')

_gitroot="git://github.com/paradoxxxzero/gnome-shell-system-monitor-applet.git"
_gitname="cinnamone-system-monitor-applet"

build() {
    cd ${srcdir}/
    msg "Connecting to the GIT server..."
    if [[ -d ${srcdir}/${_gitname} ]] ; then
	cd ${_gitname}
        git pull origin
        msg "The local files are updated..."
    else
        git clone ${_gitroot} ${_gitname}
    fi
    msg "GIT checkout done."
}

package() {
    cd "$srcdir/$_gitname"
    mkdir -p "$pkgdir/usr/share/cinnamon/extensions/"
    cp -R "system-monitor@paradoxxx.zero.gmail.com" "$pkgdir/usr/share/cinnamon/extensions"
    sed -i 's|org.gnome.shell.extensions|org.cinnamon.extensions|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/extension.js"
    sed -i 's|imports.gi.Shell;|imports.gi.Cinnamon;|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/extension.js"
    sed -i 's|Shell|Cinnamon|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/extension.js"
    sed -i 's|system-monitor-applet-config.desktop|cinnamon-system-monitor-applet-config.desktop|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/extension.js"
    sed -i 's|"3.2.0", "3.2","3.3.2"|"1.2"|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/metadata.json"
    sed -i 's|shell-version|cinnamon-version|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/metadata.json"
    #if you don't want colored circle that represents the hard disk usage uncomment this line below
    sed -i 's|"#444", "#666", "#888", "#aaa", "#ccc", "#eee"|"#f88", "#8f8", "#88f", "#fbb", "#bfb", "#bbf"|' "$pkgdir/usr/share/cinnamon/extensions/system-monitor@paradoxxx.zero.gmail.com/extension.js"

    mkdir -p "$pkgdir/usr/share/glib-2.0/schemas"
    cp "org.gnome.shell.extensions.system-monitor.gschema.xml" "$pkgdir/usr/share/glib-2.0/schemas/org.cinnamon.extensions.system-monitor.gschema.xml"
    sed -i 's|gnome-shell-extensions|cinnamon-extensions|' "$pkgdir/usr/share/glib-2.0/schemas/org.cinnamon.extensions.system-monitor.gschema.xml"
    sed -i 's|org.gnome.shell.extensions|org.cinnamon.extensions|' "$pkgdir/usr/share/glib-2.0/schemas/org.cinnamon.extensions.system-monitor.gschema.xml"
    sed -i 's|/org/gnome/shell/extensions/|/org/cinnamon/extensions/|' "$pkgdir/usr/share/glib-2.0/schemas/org.cinnamon.extensions.system-monitor.gschema.xml"

    mkdir -p "$pkgdir/usr/bin"
    cp "system-monitor-applet-config.py" "$pkgdir/usr/bin/cinnamon-system-monitor-applet-config"
    sed -i 's|org.gnome.shell.extensions|org.cinnamon.extensions|' "$pkgdir/usr/bin/cinnamon-system-monitor-applet-config"
    
    #if you want a shortcut of cinnamon-system-monitor-applet-config, just uncomment two lines below
    mkdir -p "$pkgdir/usr/share/applications"
    cp "$srcdir/cinnamon-system-monitor-applet-config.desktop" "$pkgdir/usr/share/applications"

    for dir in po/* ;do
    [[ -d "$dir" ]] && {
	lang=$(basename "$dir")
	mkdir -p "$pkgdir/usr/share/locale/${lang}/LC_MESSAGES/"
	msgfmt "$dir/system-monitor-applet.po" -o "$pkgdir/usr/share/locale/${lang}/LC_MESSAGES/cinnamon-system-monitor-applet.mo"
    }
    done
}

