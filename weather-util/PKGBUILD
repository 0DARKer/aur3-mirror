# Maintainer: Michael P <ptchinster@archlinux.us>
pkgname=weather-util
pkgver=1.5
pkgrel=11
pkgdesc="provides quick command line access to current weather conditions and forecasts"
arch=('any')
url="http://fungi.yuggoth.org/weather/"
license=('ISC')
groups=()
depends=('python')
makedepends=()
optdepends=()
provides=()
conflicts=("expect")
replaces=()
backup=('etc/weatherrc')
options=()
install=
changelog=
source=( http://fungi.yuggoth.org/weather/src/weather-$pkgver.tar.gz py3000.patch )
noextract=()
md5sums=('87c7f59bd34a2f62e38a11b81160cd6b' '6a893f4a90e9d04aca4da7b79a2d9950')

build() {
	name=${pkgname//-util}
	pyversion=`pacman -Q python | cut -d - -f1 | sed 's/ //'`

	mkdir -p $pkgdir/usr/bin
	mkdir -p $pkgdir/usr/lib/${pyversion}
	mkdir -p $pkgdir/usr/share/man/man{1,5}
	mkdir -p $pkgdir/usr/share/licenses/$pkgname
	mkdir -p $pkgdir/etc

	cd "$name-$pkgver"
	patch -p1 < ../py3000.patch
	
	cp "$name" "$pkgdir/usr/bin"
	cp "${name}.py" "$pkgdir/usr/lib/${pyversion}"
	cp "${name}.1" "$pkgdir/usr/share/man/man1"
	cp "${name}rc.5" "$pkgdir/usr/share/man/man5"
	cp "LICENSE" $pkgdir/usr/share/licenses/$pkgname
	cp "${name}rc" "$pkgdir/etc"

	#sed -i 's_#!/usr/bin/env python_#!/usr/bin/python2_' "${pkgdir}/usr/bin/weather"
	sed -i 's_#!/usr/bin/env python_#!/usr/bin/python_' "${pkgdir}/usr/bin/weather"

	echo "Go to http://www.nws.noaa.gov/tg/siteloc.shtml to find the settings for your /etc/weatherrc file."
}

