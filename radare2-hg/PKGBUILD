pkgname="radare2-hg"
pkgver=1213
pkgrel=1
pkgdesc="A collection of tools with the aim to create a complete, portable, multi-architecture, unix-like toolchain for reverse engineering."
arch=('i686' 'x86_64')
url="http://radare.org"
license=('GPL3')
depends=('vala')
makedepends=('mercurial')
optdeps=('valaswig'
	 'libewf'
	 'libtcc'
	 'lua')
provides=("radare2")
source=()
md5sums=()

_hgroot="http://radare.org/hg"
_hgrepo="radare2"

build() {
	cd ${srcdir}

	if [ -x ${_hgrepo}-build ] ; then
    msg "Removing leftovers..."
    rm -rf ${_hgrepo}-build
  fi
  hg clone ${_hgrepo} ${_hgrepo}-build
	cd ${_hgrepo}-build

	msg "Configuring..."
	./configure --prefix=/usr

	msg "Building..."
	export LDFLAGS="${LDFLAGS//-Wl,--as-needed}"
	make -j1
}

package() {
	cd ${srcdir}/${_hgrepo}-build

	msg "Installing..."
	make DESTDIR=${pkgdir} install
	install -d "${pkgdir}/usr/share/man/man1"
	install -m644 man/* "${pkgdir}/usr/share/man/man1"
	cd ..
	rm -rf ${_hgrepo}-build
}
