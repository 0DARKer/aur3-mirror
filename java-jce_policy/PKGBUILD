# Contributor: Tom <tomgparchaur@gmail.com>
pkgname=java-jce_policy
pkgver=6
pkgrel=2
pkgdesc="Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction Policy Files 6"
arch=('i686' 'x86_64')
url="http://java.sun.com/javase/downloads/index.jsp"
license=('custom')
depends=('jre')
install=${pkgname}.install
source=("install_java_jce_policy")

build() {
	# Sun doesn't give us a direct download for jce_policy-6.zip
	# So the user must download it manually ...
	if [ ! -e "$(dirname ${srcdir})/${pkgname/java-/}-${pkgver}.zip" ]; then
		echo 
		echo "You need to download this manually from Sun Microsystems:"
		echo "JCE Unlimited Strength Jurisdiction Policy Files 6 Release Candidate: ${pkgname/java-/}-${pkgver}.zip"
		echo "and put it in the same directory of this PKGBUILD."
		echo
		echo "Go to: ${url}"
		echo
		return 1
	fi

	ln -s $(dirname ${srcdir})/${pkgname/java-/}-${pkgver}.zip ${srcdir} &> /dev/null

	_mdfiveneeded=b20f9d6ed14e55d73a5ed204bca01e7a
	_mdfivefile=$(md5sum ${srcdir}/${pkgname/java-/}-${pkgver}.zip | cut -d " " -f 1)
	if [ "${_mdfiveneeded}" != "${_mdfivefile}" ]; then
		echo
		echo "The MD5SUM of ${pkgname/java-/}-${pkgver}.zip isn't the correct one."
		echo "Bad download or different file."
		echo
		return 1
	fi

	# Fixed place for the jce_policy files
	mkdir -p ${pkgdir}/usr/share/java/${pkgname}/
	cd ${pkgdir}/usr/share/java/${pkgname}/
	bsdtar -xf ${srcdir}/jce_policy-6.zip || return 1
	mv jce/* . || return 1
	rmdir jce || return 1
	find ${pkgdir}/usr/share/java/${pkgname}/* -type f -exec chmod 644 {} \;
	find ${pkgdir}/usr/share/java/${pkgname}/* -type d -exec chmod 755 {} \;

	# Installing the script
	mkdir -p ${pkgdir}/sbin/ || return 1
	install -m 755 ${srcdir}/install_java_jce_policy ${pkgdir}/sbin/ || return 1

	# The Sun Microsystems License
	mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
	mv ${pkgdir}/usr/share/java/${pkgname}/COPYRIGHT.html ${pkgdir}/usr/share/licenses/${pkgname}/ \
	   || return 1

	# The documentation
	mkdir -p ${pkgdir}/usr/share/doc/${pkgname}
	mv ${pkgdir}/usr/share/java/${pkgname}/README.txt ${pkgdir}/usr/share/doc/${pkgname}/ \
	   || return 1
}

md5sums=('6a959e7a3f3fca563299fe6892befa87')
