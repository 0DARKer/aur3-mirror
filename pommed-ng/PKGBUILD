# Maintainer: Tim HÃ¼tz <tim@huetz.biz>

# Forked from pommed. Previous header:
# Maintainer: Corrado Primier <ilbardo gmail com>
# Contributor: Other contributors existed but lost information
# Contributor: dpevp <daniel.plaza.espi@gmail.com>
# Contributor: jordi Cerdan (jcerdan) <jcerdan@tecob.com>

pkgname=pommed-ng
pkgver=1.40
pkgrel=6
pkgdesc="Handles the hotkeys of Apple MacBook (Pro) laptops"
arch=('i686' 'x86_64')
url="https://github.com/bytbox/pommed-light"
license=('GPL2')
makedepends=('pkgconfig')
depends=('confuse' 'audiofile' 'pciutils' 'dbus-glib' 'gtk2') # alsa-lib reference is fullfilled by audiofile
conflicts=('pommed','pommed-light', 'pommed-git', 'pommed-jalaziz', 'gpomme')
optdepends=('eject: disc ejection support')
source=( "https://github.com/thuetz/${pkgname}/archive/${pkgver}.tar.gz" 'pommed.service' 'gpomme.service' )
dfname="${pkgname}-${pkgver}"
sha256sums=('35e422a930124cf3cf6a1ddc687befad1df19fed60c93a923f13aaba202b011c'
            '00b53ee256fb18e45be255f396b6a015d05b26c08785cd291fbd768cfc076c80'
            'eaeb921be522f7b6ff985b02f1a8a208aa0895f546cce77dd8af01f4cad805e5')

build() {
  cd ${srcdir}/${dfname}
  make pommed
  make gpomme
}

package() {
  install -Dm755 ${srcdir}/${dfname}/pommed/pommed ${pkgdir}/usr/bin/pommed
  install -Dm755 ${srcdir}/${dfname}/gpomme/gpomme ${pkgdir}/usr/bin/gomme
  install -Dm644 ${srcdir}/${dfname}/pommed.conf.mactel ${pkgdir}/etc/pommed.conf.mactel
  install -Dm644 ${srcdir}/${dfname}/pommed.conf.pmac ${pkgdir}/etc/pommed.conf.pmac

  # Man page
  install -Dm644 ${srcdir}/${dfname}/pommed.1 ${pkgdir}/usr/share/man/man1/pommed.1

  # Sounds
  install -Dm644 ${srcdir}/${dfname}/pommed/data/goutte.wav ${pkgdir}/usr/share/pommed/goutte.wav
  install -Dm644 ${srcdir}/${dfname}/pommed/data/click.wav ${pkgdir}/usr/share/pommed/click.wav

  # Themes
  cd ${srcdir}/${dfname}/gpomme/themes/
  for i in * ; do
    if [[ -d $i ]] ; then
      install -dm755 ${i} ${pkgdir}/usr/share/gpomme/themes/${i}
      install -Dm644 ${i}/*.png ${pkgdir}/usr/share/gpomme/themes/${i}/
    fi
  done

  # Systemd
  install -Dm644 ${srcdir}/pommed.service ${pkgdir}/usr/lib/systemd/system/pommed.service
  install -Dm644 ${srcdir}/gpomme.service ${pkgdir}/usr/lib/systemd/system/gpomme.service

  # dbus
  install -Dm644 ${srcdir}/${dfname}/dbus-policy.conf ${pkgdir}/etc/dbus-1/system.d/pommed.conf
}

# vim:set ts=2 sw=2 et:
