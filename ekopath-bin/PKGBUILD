# Maintainer: kfgz <kfgz at interia dot pl>
# Contributor: 6xx
# Contributor: csslayer

pkgname=ekopath-bin
_real_name=ekopath
pkgver=4.0.10
pkgrel=2
pkgdesc="A high-performance Intel 64 / AMD64 compiler for C99, C++ 2003, Fortran 90/95 and partial 2003"
url="http://pathscale.com/ekopath-compiler-suite"
arch=('x86_64')
license=('GPL')
makedepends=('bsdiff')
options=(!strip)
source=(http://c591116.r16.cf2.rackcdn.com/ekopath/nightly/Linux/${_real_name}-${pkgver}-installer.run
       ekopath.sh
       pathcc.patch)
md5sums=('9fb5f6f5160ee13c1400fb54e4f9557a'
         '00c72b71ed4b2f03d1dd84264b405a7a'
         'af9fc2f78c88068fe0fe91c1976e0d23')

package() {
  install -dm755 ${pkgdir}/{etc/profile.d,usr}
  
  cd "${startdir}"

  chmod +x ${_real_name}-${pkgver}-installer.run
  ./${_real_name}-${pkgver}-installer.run  --mode unattended --prefix "${pkgdir}/opt/ekopath"
  
  rm -f "${pkgdir}/opt/ekopath/uninstall"
  mv "${pkgdir}/opt/ekopath/bin/pathcc" "${pkgdir}/opt/ekopath/bin/pathcc.bak"
  bspatch "${pkgdir}/opt/ekopath/bin/pathcc.bak" "${pkgdir}/opt/ekopath/bin/pathcc" "${srcdir}/pathcc.patch"
  chmod +x "${pkgdir}/opt/ekopath/bin/pathcc"
  rm -f "${pkgdir}/opt/ekopath/bin/pathcc.bak"
  install -m644 "${srcdir}/ekopath.sh" "${pkgdir}/etc/profile.d/"
}
