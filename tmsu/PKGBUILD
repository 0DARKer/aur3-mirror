# Maintainer: Andreas Wagner <AndreasBWagner@pointfree.net>
# Contributor: Robert Wertman <robert.wertman+aur@gmail.com>
pkgname=tmsu
pkgver=0.2.0
_extraversion=fc625091a134
pkgrel=4
pkgdesc="An application that allows you to tag your files to organize them."
arch=('i686' 'x86_64')
url="https://bitbucket.org/oniony/tmsu/"
license=('GPL3')
md5sums=('24eb5ed29758a84519c36e322b9c9d3c')
makedepends=('mercurial')
depends=('go-sqlite3' 'go-fuse')
install=${pkgname}.install
source=("$pkgname-$pkgver::https://bitbucket.org/oniony/${pkgname}/get/v${pkgver}.tgz")
md5sums=('b916e3c5d8a132ad5ed4824dc1531586')

build() {
  cd "$srcdir/oniony-tmsu-$_extraversion/"
  make GOPATH="$GOPATH:$(pwd)"
  _backup="${HOME}/.tmsu/default.db.backup.$$$(date +%s%N)"
  _currdb="${HOME}/.tmsu/default.db"
  sed -i 's|^_backup=.*$|_backup='${_backup}'|g' ${startdir}/${pkgname}.install
  sed -i 's|^_currdb=.*$|_currdb='${_currdb}'|g' ${startdir}/${pkgname}.install
}

package() {
  cd "$srcdir/oniony-tmsu-$_extraversion/"
  mkdir -p $pkgdir/usr/bin
  make ZSH_COMP_INSTALL_DIR=$pkgdir/usr/share/zsh/site-functions INSTALL_DIR=$pkgdir/usr/bin install
  mkdir -p $pkgdir/usr/share/tmsu/
  cp -r misc/db-upgrade $pkgdir/usr/share/tmsu/
}
# vim:set ts=2 sw=2 et:
