# Maintainer: Andreas Wagner <AndreasBWagner@pointfree.net>
pkgname=tmsu
pkgver=0.4.2
_extraversion=948cbb8b3b8d
pkgrel=2
pkgdesc="An application that allows you to tag your files to organize them."
arch=('i686' 'x86_64')
url="http://tmsu.org"
license=('GPL3')
makedepends=('git' 'go-fuse' 'go-sqlite3')
provides=('tmsu')
install=${pkgname}.install
source=("${pkgname}.install"
        'https://bitbucket.org/oniony/tmsu/raw/4ee92875a263525cd5c5cb4f85fb5369f47864bc/misc/db-upgrade/0.0.5_to_0.0.6.sql'
        'https://bitbucket.org/oniony/tmsu/raw/4ee92875a263525cd5c5cb4f85fb5369f47864bc/misc/db-upgrade/0.0.9_to_0.1.0.sql'
        'https://bitbucket.org/oniony/tmsu/raw/4ee92875a263525cd5c5cb4f85fb5369f47864bc/misc/db-upgrade/clean_tag_names.sql'
        'https://bitbucket.org/oniony/tmsu/raw/4ee92875a263525cd5c5cb4f85fb5369f47864bc/misc/db-upgrade/0.3_to_0.4.0.sql' 
        'https://bitbucket.org/oniony/tmsu/raw/4ee92875a263525cd5c5cb4f85fb5369f47864bc/misc/db-upgrade/migrate-tags-to-values' 
        "https://bitbucket.org/oniony/${pkgname}/get/v${pkgver}.tar.gz")
sha512sums=('19692b9485339f169895b0d689f2899b363c0e470053e8f58f3771e5fe6b040ffcee7ce572b3652c462048b28837ccb6710b6b8719ae71d376af5bf0d68eb21c'
            '1b59c03745c603b7e8b975c78ee83a9f920b60b15c63ddf965e242f34118410f2f381b7c2067a456a4ce32ed5829c0181e70279961f559340de5d46a0d06735b'
            '6660d1baa3e2a8a5f8e4853a90fe10052d72f979cbaacbe851b4514b6f945d490d47633550df61e22c470b576f6708a3ef3a577c1136e2cfd6630dbd182ad0f3'
            'fcf94113c4e198a629a26ce5aac0ffc6fcc05564dc5e517053d285b425cf5134d57e11bc5973ad5422e4781dfed596242c9488ef4133c75958ead74758424102'
            '1db86efff8a5839d17ae9bbd2a82c3a09a32f85c190346fdb7db60e3fc84a341f472dc8dae62ed2945f844c1a3d03830fae9eca41b4e111ebd4207b6fab58de1'
            '444a7146f9c2d119309b44762e204305365493ec766929d45bcb3133fdba893c96d4d07570bf5f1101f632e206081cd157c303204b8c75b2a0bc884c76adc128'
            '22b21ea0ed5e1fdb22c27e0b0ea43606033323f5d921ce73282bea041e3bf93e19bdb3efceb0566576cebf9e8cf870cefbac5b40c35128340fbb195173b9d5d8')

#prepare() {
#  cd "$srcdir/oniony-tmsu-948cbb8b3b8d/"
#  _backup="${HOME}/.tmsu/default.db.backup"
#  _currdb="${HOME}/.tmsu/default.db"
#  sed -i 's|^_backup=.*$|_backup=\"'${_backup}'\"|' ${startdir}/${pkgname}.install
#  sed -i 's|^_currdb=.*$|_currdb=\"'${_currdb}'\"|' ${startdir}/${pkgname}.install
#}

build() {
  cd "$srcdir/oniony-tmsu-${_extraversion}"
  make compile GOPATH="/usr/lib/go/site:$(pwd)"
}

package() {
  cd "$srcdir/oniony-tmsu-${_extraversion}/"
  mkdir -p $pkgdir/usr/{bin,share/zsh/site-functions/,man/man1/}
  make install INSTALL_DIR=$pkgdir/usr/bin \
  MOUNT_INSTALL_DIR=$pkgdir/usr/bin \
  MAN_INSTALL_DIR=$pkgdir/usr/share/man/man1 \
  ZSH_COMP_INSTALL_DIR=$pkgdir/usr/share/zsh/site-functions
  mkdir $pkgdir/usr/share/tmsu/
  install -Dm644 $srcdir/0.0.5_to_0.0.6.sql $pkgdir/usr/share/tmsu/
  install -Dm644 $srcdir/0.0.9_to_0.1.0.sql $pkgdir/usr/share/tmsu/
  install -Dm644 $srcdir/clean_tag_names.sql $pkgdir/usr/share/tmsu/
  install -Dm644 $srcdir/0.3_to_0.4.0.sql $pkgdir/usr/share/tmsu/
  install -Dm644 $srcdir/migrate-tags-to-values $pkgdir/usr/share/tmsu/
}
# vim:set ts=2 sw=2 et:
