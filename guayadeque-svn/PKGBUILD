# Maintainer: sausageandeggs <sausageandeggs@archlinux.us>
# Contributor: Martin Herndl <martin.herndl@gmail.com>
pkgname=guayadeque-svn 
pkgver=1848
pkgrel=1
pkgdesc="Full Featured Linux media player for large collections"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/guayadeque/"
license=('GPL')
depends=('wxgtk' 'sqlite3' 'curl' 'taglib>=1.6.1' 'flac' 'desktop-file-utils' 'wxsqlite3>=3.0.1')
makedepends=('subversion' 'cmake')
optdepends=('gstreamer0.10-plugins: all Gstreamer plugins to play all kind of music files')
conflicts=('guayadeque')
provides=('guayadeque')
groups=('guayadeque-svn')
source=('guayadeque-unbundle-wxsqlite3.patch' 'CMakeLists.patch')
_svnmod="guayadeque"
_svntrunk="https://guayadeque.svn.sourceforge.net/svnroot/guayadeque/Trunk"

build() {
  cd ${srcdir}

	msg "Getting sources..."
	if [ -d ${_svnmod}/.svn ]; then
		(cd ${_svnmod} && svn up -r ${pkgver})
	else
		svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
		cd ${_svnmod}
	fi

    msg "SVN checkout done or server timeout"
    msg "Creating make environment..."
    rm -rf ${srcdir}/${_svnmod}-build
    cp -r ${srcdir}/${_svnmod} ${srcdir}/${_svnmod}-build
    cd ${srcdir}/${_svnmod}-build

	patch -p0 -i ${srcdir}/CMakeLists.patch 
	patch -p1 -i ${srcdir}/guayadeque-unbundle-wxsqlite3.patch 
          
    msg "Starting make..."
    
	./buildt
	cmake -DCMAKE_INSTALL_PREFIX=/usr -DWXSQLITE3_LIB=wxcode_gtk2u_wxsqlite3-2.8
   	make
	make DESTDIR=${pkgdir} install
}
md5sums=('0ee159818a99dd18a1f4004a104fe86e'
         'f5098ca1038fec275935140aae147c42')
