# Maintainer: Limao Luo <luolimao+AUR@gmail.com>
# Contributor: sausageandeggs <sausageandeggs@archlinux.us>
# Contributor: Martin Herndl <martin.herndl@gmail.com>

_pkgname=guayadeque
pkgname=$_pkgname-svn
pkgver=1879
pkgrel=1
pkgdesc="Full Featured Linux media player for large collections"
arch=(i686 x86_64)
url=http://sourceforge.net/projects/$_pkgname
license=(GPL3)
depends=(desktop-file-utils flac taglib 'wxsqlite3>=3.0.1')
makedepends=(cmake subversion)
optdepends=('gstreamer0.10-plugins: all Gstreamer plugins to play all kind of music files')
provides=($_pkgname)
conflicts=($_pkgname)
install=$pkgname.install
source=(CMakeLists.patch)
sha256sums=('c245ce6df927ffefe0313e468654cad88c06f614312fc60ffbc6d32abd9715fe')
sha512sums=('5457f1b55cc7db7183c0890feccf7405ceb2184f70820df323389dfbec00a66568ebd9c3b0b80c51ca7ac4e66de0c22293806ef09cd8e899f3b2ef332e7d76f0')

_svntrunk=https://$_pkgname.svn.sourceforge.net/svnroot/$_pkgname/Trunk
_svnmod=$_pkgname

build() {
    install -d $_pkgname/
    cd $_pkgname/

    msg "Starting SVN checkout..."
    if [[ -d $_svnmod/.svn ]]; then
        pushd $_svnmod && svn up -r $pkgver
        msg2 "The local files have been updated."
        popd
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi
    msg2 "SVN checkout done or server timeout"

    rm -rf $_svnmod-build/
    cp -r $_svnmod/ $_svnmod-build/
    cd $_svnmod-build/

    msg "Building..."
    patch -Np1 -i ../../CMakeLists.patch
    ./buildt
    cmake -DCMAKE_INSTALL_PREFIX=/usr -DWXSQLITE3_LIB=wxcode_gtk2u_wxsqlite3-2.8 .
    make
}

package() {
    make -C $_pkgname/$_svnmod-build/ DESTDIR="$pkgdir" install
}
