# Contributor: dhamp <dhamp@ya.ru>

_name=eiskaltdcpp
pkgbase=$_name-git
pkgname=$_name-git
true && pkgname=('eiskaltdcpp-git' 'eiskaltdcpp-gtk-git' 'eiskaltdcpp-qt-git' 'eiskaltdcpp-daemon-git' 'eiskaltdcpp-cli-git' 'eiskaltdcpp-core-git' 'eiskaltdcpp-data-git')
pkgver=20111009
pkgrel=1
license=('GPL3')
arch=('i686' 'x86_64')
url="http://code.google.com/p/eiskaltdc/"
#depends=('qt' 'libnotify' 'bzip2' 'pcre' 'lua' 'libidn' 'gtk2')
#makedepends=('git' 'gcc' 'pkgconfig' 'cmake' 'gettext')
#optdepends=('aspell: spellchecking'
            #'qtscriptgenerator: need for qtscript'
            #'php: needed for some optionаl scripts')
conflicts=('eiskaltdcpp')
provides=('eiskaltdcpp')
options=(!emptydirs)
_gitroot="git://github.com/negativ/eiskaltdcpp.git"
_gitname=$_name
build() {
        cd $srcdir
        if [ -d $_gitname ]; then
            cd $_gitname && git pull origin
            msg "The local files are updated."
        else
            git clone --depth=1 $_gitroot $_gitname
        fi
        msg "GIT checkout done or server timeout"
        msg "Starting make..."
        rm -rf $srcdir/build
        mkdir $srcdir/build
        cd $srcdir/build
        cmake ../$_gitname -DCMAKE_INSTALL_PREFIX=/usr -DUSE_MINIUPNP=ON -DLOCAL_MINIUPNP=ON -DPERL_REGEX=ON -DUSE_JS=ON -DUSE_GTK=ON -DLOCAL_BOOST=ON -DLUA_SCRIPT=ON -DWITH_LUASCRIPTS=ON -DWITH_DHT=ON -DNO_UI_DAEMON=ON
        #make
}

package_eiskaltdcpp-git() {
    depends=('qt' 'gtk2' 'libnotify' 'lua' 'libidn' 'pcre' 'bzip2')
    optdepends=('aspell: spellchecking'
            'qtscriptgenerator: need for qtscript'
            'php: needed for some optionаl scripts')
    pkgdesc="DC and ADC client based on dcpp core"
    install=$_name.install
    cd $srcdir/build
    #cmake ..  -DUSE_JS=ON -DUSE_QT=ON -DUSE_GTK=ON -DXMLRPC_DAEMON=ON
    make DESTDIR=$pkgdir install clean
}

package_eiskaltdcpp-gtk-git() {
    depends=('gtk2' 'libnotify' 'desktop-file-utils' 'eiskaltdcpp-core-git' 'eiskaltdcpp-data-git')
    optdepends=('php: needed for some optionаl scripts')
    pkgdesc="Gtk2-based DC and ADC client based on dcpp core"
    install=$_name.install
    cd $srcdir/build
    #cmake .. -DUSE_GTK=ON
    make -C cmake
    make -C eiskaltdcpp-gtk DESTDIR=$pkgdir install clean

}
package_eiskaltdcpp-qt-git() {
    depends=('qt' 'eiskaltdcpp-core-git' 'eiskaltdcpp-data-git')
    optdepends=('aspell: spellchecking'
            'qtscriptgenerator: need for qtscript'
            'php: needed for some optionаl scripts')
    pkgdesc="Qt4-based DC and ADC client based on dcpp core"
    install=$_name.install
    cd $srcdir/build
    #cmake ..  -DUSE_JS=ON -DUSE_QT=ON
    make translations_qt
    make -C eiskaltdcpp-qt DESTDIR=$pkgdir install clean
}

package_eiskaltdcpp-cli-git() {
    depends=('eiskaltdcpp-daemon-git' 'eiskaltdcpp-data-git')
    pkgdesc="EiskaltDC++ cli interface for daemon with xmlrpc"
    cd $srcdir/build
    make -C eiskaltdcpp-cli DESTDIR=$pkgdir install clean
}
package_eiskaltdcpp-daemon-git() {
    depends=('eiskaltdcpp-core-git' 'eiskaltdcpp-data-git' 'gcc-libs')
    pkgdesc="EiskaltDC++ Daemon"
    cd $srcdir/build
    make -C eiskaltdcpp-daemon DESTDIR=$pkgdir install clean
}

package_eiskaltdcpp-core-git() {
    depends=('bzip2' 'openssl' 'lua' 'libidn' 'pcre')
    pkgdesc="EiskaltDC++ core"
    cd $srcdir/build
    make -C cmake
    make -C dcpp DESTDIR=$pkgdir install clean
}

package_eiskaltdcpp-data-git() {
    arch=('any')
    depends=('sh' 'bash' 'hicolor-icon-theme')
    optdepends=('php: needed for some optionаl scripts')
    install=$_name.install
    pkgdesc="EiskaltDC++ data files"
    cd $srcdir/build
    make -C data DESTDIR=$pkgdir install clean
}
pkgdesc="DC and ADC client based on dcpp core"
