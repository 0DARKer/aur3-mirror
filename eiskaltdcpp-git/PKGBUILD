# Contributor: dhamp <dhamp@ya.ru>

_name=eiskaltdcpp
pkgname=$_name-git
pkgver=20111002
pkgrel=1
pkgdesc="DC and ADC client based on dcpp core"
license=('GPL3')
arch=('i686' 'x86_64')
url="http://code.google.com/p/eiskaltdc/"
depends=('qt' 'libnotify' 'bzip2' 'pcre' 'lua' 'libidn' 'gtk2')
makedepends=('git' 'gcc' 'pkgconfig' 'cmake' 'gettext')
optdepends=('aspell: spellchecking'
            'qtscriptgenerator: need for qtscript'
            'php: needed for some option–∞l scripts')
conflicts=('eiskaltdcpp')
provides=('eiskaltdcpp')
options=(!emptydirs)
install=$_name.install
_gitroot="git://github.com/negativ/eiskaltdcpp.git"
_gitname=$_name
build() {
        cd $srcdir
        if [ -d $_gitname ]; then
            cd $_gitname && git pull origin
            msg "The local files are updated."
        else
            git clone $_gitroot
            cd $_gitname
        fi
        msg "GIT checkout done or server timeout"
        msg "Starting make..."
        rm -rf $srcdir/$_gitname/build
        mkdir $srcdir/$_gitname/build
        cd $srcdir/$_gitname/build
        cmake .. -DCMAKE_INSTALL_PREFIX=/usr -DUSE_MINIUPNP=ON -DLOCAL_MINIUPNP=ON -DPERL_REGEX=ON -DUSE_JS=ON -DUSE_GTK=ON -DLOCAL_BOOST=ON -DLUA_SCRIPT=ON -DWITH_LUASCRIPTS=ON -DWITH_DHT=ON
        make DESTDIR=$pkgdir install
        rm -rf $srcdir/$_gitname/build
}
