# Maintainer: winix ( wininix [at] gmail [dot] com )
# Contributor: Gaetan Bisson <bisson@archlinux.org>
# Contributor: Austin ( doorknob60 [at] gmail [dot] com )

pkgname=broadcom-wl-lts
pkgver=5.100.82.38
pkgrel=1
pkgdesc='Broadcom 802.11abgn hybrid Linux networking device driver'
arch=('i686' 'x86_64')
url='http://www.broadcom.com/support/802.11/linux_sta.php'
license=('MIXED/Proprietary')
depends=('kernel26-lts')
makedepends=('kernel26-lts-headers' 'patch' 'make' 'gcc')

ARCH=x86_32
[ "$CARCH" = 'x86_64' ] && \
ARCH=x86_64

source=("http://www.broadcom.com/docs/linux_sta/hybrid-portsrc_${ARCH}-v${pkgver//./_}.tar.gz"
        'license.patch')

sha1sums=('3062830f86c5f1f41d8a4b26d6e0072dc989c7ba'
          '94b85f4e8f800e07799fd28a965bde69633e2cdc')
[ "$CARCH" = 'x86_64' ] && \
sha1sums=('6076de3bd8206b3e7b8bfc2eadbe3a97eec4e735'
          '94b85f4e8f800e07799fd28a965bde69633e2cdc')

install=install

build() {
	cd "$srcdir"
	patch -p1 < license.patch
	make -C /lib/modules/`uname -r`/build M=`pwd`
}

package() {
	cd "$srcdir"
	install -D -m 755 wl.ko "$pkgdir/lib/modules/`uname -r`/kernel/drivers/net/wireless/wl.ko"
	install -D -m 644 lib/LICENSE.txt "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
