# Maintainer: jdarch <jda -dot- cloud -plus- archlinux -at- gmail -dot- com>

pkgname=clblas
pkgver=2.0
pkgrel=1
pkgdesc="A software library containing BLAS functions written in OpenCL"
arch=("i686" "x86_64")
url="https://github.com/clMathLibraries/clBLAS"
license=('APACHE')
builddepends=("amdapp-sdk" "acml-gfortran" "boost")
depends=("amdapp-sdk")

source=("https://github.com/clMathLibraries/clBLAS/archive/v${pkgver}.zip")
md5sums=('da0c44fc2590cea920d4b9f528a1c9e3')
sha512sums=('fdd467c4844f2f645452d3d380304d7846299749c391bb9307951a38cdbac8231f2c0482069051b92c020dc0d481ddb08b8c08c3cd060e598cc23066a7544b86')

if [ "$CARCH" == "x86_64" ]; then
    _bits=64
elif [ "$CARCH" == "i686" ]; then
    _bits=32
fi

build() {
	export DESTDIR="${pkgdir}"
	cd "${srcdir}/clBLAS-${pkgver}/src"
	cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr ./
	make clBLAS
}

package() {
	cd "${srcdir}/clBLAS-${pkgver}/src"
	make install
	rm -rf "${pkgdir}/usr/bin${_bits}"
	mv "${pkgdir}/usr/lib${_bits}" "${pkgdir}/usr/lib"
	mkdir "${pkgdir}/usr/include/clBLAS/"
	mv -t "${pkgdir}/usr/include/clBLAS/" "${pkgdir}"/usr/include/*.h
}
