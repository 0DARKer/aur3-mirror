# Contributor: Mikolaj Pastuszko <deluminathor@gmail.com>
# Contributor: Andrej Gelenberg <andrej.gelenberg@udo.edu>
license=('GPL')
arch=('i686' 'x86_64')
pkgname=brscan3
pkgver=0.2.11_3
pkgrel=1
pkgdesc="SANE drivers from Brother for brscan3 compatibile models"
depends=('sane' 'sed')
makedepends=('sane')
url="http://welcome.solutions.brother.com/bsc/public_s/id/linux/en/download_scn.html"
install=brscan3.install

if [ $(uname -m) = "x86_64" ]; then
  deb="${pkgname}-${pkgver/_/-}.amd64.deb"
  deb_md5sum="0eb2fa17b834de382643d49da386dd11"
else
  deb="${pkgname}-${pkgver/_/-}.i386.deb"
  deb_md5sum="eca738dbe0d615f922fe618b2eea3159"
fi

source=("http://pub.brother.com/pub/com/bsc/linux/dlf/$deb" brscan3.rules)
md5sums=($deb_md5sum '76537a0eb5b68c48b57b4409397a4fa5')

build() {
  cd $srcdir
  ar -x "$deb" || return 1
  install -d -m755 $pkgdir/etc/udev/rules.d || return 1
  install -D -m644 brscan3.rules $pkgdir/etc/udev/rules.d || return 1
  tar -xzf $srcdir/data.tar.gz -C $pkgdir || return 1
  if [ $(uname -m) = "x86_64" ]; then
    mv $pkgdir/usr/lib64 $pkgdir/usr/lib || return 1
  fi
  cd $pkgdir/usr/lib
  ln -sf libbrscandec3.so.1.0.0 libbrscandec3.so.1 || return 1
  ln -sf libbrscandec3.so.1 libbrscandec3.so || return 1
  cd $pkgdir/usr/lib/sane
  ln -sf libsane-brother3.so.1.0.7 libsane-brother3.so.1 || return 1
  ln -sf libsane-brother3.so.1 libsane-brother3.so || return 1
}

