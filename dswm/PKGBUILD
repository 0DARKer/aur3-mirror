pkgname=dswm
pkgver=0.0.3
pkgrel=4
pkgdesc="Deep Space Window Manager - tiling window manager, oriented for good usability and good emacs integration (StumpWM-based)."
url="http://sourceforge.net/projects/dswm/"
arch=('x86_64' 'i686')
license=('GPLv2')
depends=('sbcl' 'clx-sbcl' 'cl-ppcre-sbcl')
optdepends=('emacs')
makedepends=()
conflicts=()
replaces=()
backup=()
install='dswm.install'
options=(!strip)
source=("http://sourceforge.net/projects/${pkgname}/files/${pkgver}-git/${pkgname}-${pkgver}-git.tar.gz")
md5sums=('c9eae7cd3589e90c76279111be50f2f5')

build() {
  cd $startdir/src/$pkgname-$pkgver-git
  ./configure --prefix=/usr \
              --with-lisp=sbcl \
              --with-ppcre=/usr/share/common-lisp/source/cl-ppcre

# this is necesary since the AUR packages do not modify the asdf's registry by default
      _sbcl_bopt="sbcl_BUILDOPTS=--eval \"(require :asdf)\" \
--eval \"(pushnew #p\\\"/usr/share/common-lisp/systems/\\\" asdf:*central-registry* :test #'equal)\" \
--eval \"(asdf:operate 'asdf:load-op 'clx)\" \
--load ./make-image.lisp"
      _sbcl_iopt="sbcl_INFOOPTS=--eval \"(require 'asdf)\" \
--eval \"(pushnew #p\\\"/usr/share/common-lisp/systems/\\\" asdf:*central-registry* :test #'equal)\" \
--eval \"(asdf:operate 'asdf:load-op 'clx)\" \
--eval \"(require 'dswm)\" \
--load ./manual.lisp \
--eval \"(progn (dswm::generate-manual) (sb-ext:quit))\""

  make "$_sbcl_bopt" "$_sbcl_iopt"
  make destdir="${pkgdir}" install
}
