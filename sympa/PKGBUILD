# Maintainer: Dimitri Pekarovsky <dimitri dot pekarovsky where gmail dot com>

pkgname=sympa
pkgver=6.1.16
pkgrel=1
pkgdesc="Sympa is a mailing list management software"
url="http://www.sympa.org/"
arch=('i686' 'x86_64')
license=('GPL')
depends=('perl-mailtools' 'perl-template-toolkit')
source=(http://www.sympa.org/distribution/$pkgname-$pkgver.tar.gz
        sympa.rc)
md5sums=('5351bb1f6a5e93e51ab9fd1e658f451a'
         '33862041b6f8bbda9a2ebeddcbdafe91')
install=sympa.install

build() {
echo "installing all perl modules"
  cpan install HTML::StripScripts::Parser File::Copy::Recursive MIME::EncWords LWP LWP::UserAgent Net::Netmask Locale::Messages Text::LineFold HTML::TreeBuilder HTML::FormatText MIME::Lite::HTML Crypt::CipherSaber Regexp::Common XML::LibXML MIME::Base64 MIME::Charset MHonArc::CharEnt Mail::Mailer Mail::DKIM Net::DNS File::Temp DB_File DBI Class::HPLOO DBD DBD::Mysql IO::Stringy Term::ProgressBar XML::LibXML DBD::mysql Encode FCGI File::Spec Archive::Zip Net::LDAP SOAP::Lite Crypt::OpenSSL::RSA Crypt::OpenSSL::Random Test::Harness Crypt::OpenSSL::Bignum Digest::SHA Digest::MD5
# 
  cd "${srcdir}/${pkgname}-${pkgver}"
  export PATH=$PATH:/usr/lib/perl5/core_perl/bin
  ./configure --prefix=/srv/sympa \
              --sysconfdir=/srv/sympa/etc \
              --with-confdir=/srv/sympa/etc \
              --with-sendmail_aliases=/srv/sympa/etc/mail/aliases \
              --with-virtual_aliases=/srv/sympa/etc/mail/virtual \
	      --with-perl=`/usr/bin/which perl`
  make
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  make DESTDIR="${pkgdir}" install
  rm -rf "$pkgdir/etc/rc.d/init.d"
#  rm -rf "$pkgdir/sample"
  install -D -m755 "$srcdir/sympa.rc" "$pkgdir/etc/rc.d/sympa"
  install -d "$pkgdir/srv/sympa/var/lock/subsys"

  chown -R 52:52 "$pkgdir/srv/sympa"
}
