pkgname=gnumed-client
pkgver=0.9.0
pkgrel=1
pkgdesc="assist and improve longitudinal medical care"
arch=(i686 x86_64)
url="http://wiki.gnumed.de/bin/view/Gnumed"
license=('GPL')
# list of dependecies found in check-prerequisites.sh, some of them probably optional
# missing: 'python-support'
depends=('bash' 'tar' 'coreutils' 'mc' 'python' 'python-psycopg2' 'wxpython' 'openssl' 'wget' 'gzip' 'file')
optdepends=('python-pyenchant' 'python-egenix-mx-base' 'gnuplot-py' 'kdepim-console' 'aspell' 'xsane' 'texlive-latex' 'gtklp' )
makedepends=()
source=(http://www.gnumed.de/downloads/client/0.9/gnumed-client.$pkgver.tgz)
md5sums=('acee600ca30f4e29fc46fff1a9cbd2d4')

build() {
  cd "$srcdir/$pkgname.$pkgver/"

  mkdir -p $pkgdir/usr/share/doc/gnumed
  mkdir -p $pkgdir/etc/gnumed

  cp client/connectors/gm_ctl_client.conf $pkgdir/etc/gnumed/gm_ctl_client.conf
  cp client/doc/gnumed.conf.example $pkgdir/etc/gnumed/gnumed.conf
  cp client/etc/gnumed/gnumed-client.conf.example $pkgdir/etc/gnumed/gnumed-client.conf
#  cp %{SOURCE2} $pkgdir/etc/gnumed/

  mkdir -p $pkgdir/usr/bin
  cp client/gnumed $pkgdir/usr/bin/gnumed

  mkdir -p $pkgdir/usr/share/gnumed/bitmaps
  cp client/bitmaps/empty-face-in-bust.png $pkgdir/usr/share/gnumed/bitmaps/empty-face-in-bust.png
  cp client/bitmaps/gnumedlogo.png $pkgdir/usr/share/gnumed/bitmaps/gnumedlogo.png
  cp client/bitmaps/serpent.png $pkgdir/usr/share/gnumed/bitmaps/serpent.png

  mkdir -p $pkgdir/usr/share/po/fr/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/de/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/es/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/it/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/nb/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/nl/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/pl/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/pt_BR/LC_MESSAGES/
  mkdir -p $pkgdir/usr/share/po/ru/LC_MESSAGES/
  cp client/po/fr-gnumed.mo $pkgdir/usr/share/po/fr/LC_MESSAGES/gnumed.mo
  cp client/po/de-gnumed.mo $pkgdir/usr/share/po/de/LC_MESSAGES/gnumed.mo
  cp client/po/es-gnumed.mo $pkgdir/usr/share/po/es/LC_MESSAGES/gnumed.mo
  cp client/po/it-gnumed.mo $pkgdir/usr/share/po/it/LC_MESSAGES/gnumed.mo
  cp client/po/nb-gnumed.mo $pkgdir/usr/share/po/nb/LC_MESSAGES/gnumed.mo
  cp client/po/nl-gnumed.mo $pkgdir/usr/share/po/nl/LC_MESSAGES/gnumed.mo
  cp client/po/pl-gnumed.mo $pkgdir/usr/share/po/pl/LC_MESSAGES/gnumed.mo
  cp client/po/pt_BR-gnumed.mo $pkgdir/usr/share/po/pt_BR/LC_MESSAGES/gnumed.mo
  cp client/po/ru-gnumed.mo $pkgdir/usr/share/po/ru/LC_MESSAGES/gnumed.mo

  mkdir -p $pkgdir/usr/share/pixmaps
  cp client/bitmaps/gnumed.xpm $pkgdir/usr/share/pixmaps/gnumed.xpm

  mkdir -p -m 755  $pkgdir/usr/lib/python2.6/site-packages/Gnumed/business
  cp -r client/business $pkgdir/usr/lib/python2.6/site-packages/Gnumed

  mkdir -p -m755 $pkgdir/usr/lib/python2.6/site-packages/Gnumed/exporters
  cp -r client/exporters $pkgdir/usr/lib/python2.6/site-packages/Gnumed

  mkdir -p -m 755 $pkgdir/usr/lib/python2.6/site-packages/Gnumed/wxGladeWidgets
  cp -r client/wxGladeWidgets  $pkgdir/usr/lib/python2.6/site-packages/Gnumed

  mkdir -p -m 755 $pkgdir/usr/lib/python2.6/site-packages/Gnumed/wxpython/gui
  cp -r client/wxpython $pkgdir/usr/lib/python2.6/site-packages/Gnumed
  cp -r client/wxpython/gui $pkgdir/usr/lib/python2.6/site-packages/Gnumed/wxpython

  cp -r client/gnumed.py $pkgdir/usr/lib/python2.6/site-packages/Gnumed

  # TODO: this sed fix should not be here!
  sed -i -e 's@Exec=/usr/bin/gnumed@Exec=/usr/bin/gnumed --conf-file=/etc/gnumed/gnumed-client.conf@' client/gnumed-client.desktop
  mkdir -p $pkgdir/usr/share/applications/
  mkdir -p $pkgdir/usr/share/icons/
  cp client/gnumed-client.desktop $pkgdir/usr/share/applications/
  cp client/bitmaps/gnumedlogo.png $pkgdir/usr/share/icons/gnumed.png

  desktop-file-install \
    --vendor='' \
    --dir $pkgdir/usr/share/applications \
    $pkgdir/usr/share/applications/gnumed-client.desktop

  # Files for common package
  mkdir -p $pkgdir/usr/lib/python2.6/site-packages/Gnumed/pycommon
  cp -r client/pycommon $pkgdir/usr/lib/python2.6/site-packages/Gnumed
  cp -r client/__init__.py $pkgdir/usr/lib/python2.6/site-packages/Gnumed

  # Files for the doc package
  mkdir -p $pkgdir/usr/share/doc/gnumed/user-manual
  cp -r client/doc/user-manual/* $pkgdir/usr/share/doc/gnumed/user-manual
}

