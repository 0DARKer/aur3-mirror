# Maintainer: Gianfranco 'Gianfrix' Micoli <gianfrix.mg@gmail.com>

pkgname=gnome-session-ubuntu
realname=gnome-session
pkgver=2.32.1
pkgrel=2
pkgdesc="The GNOME Session Handler. Patches from Ubuntu 10.10"
arch=(i686 x86_64)
license=('GPL' 'LGPL')
depends=('upower>=0.9.5' 'gtk2>=2.22.0' 'gconf>=2.31.91' 'startup-notification>=0.10' 'hicolor-icon-theme' 'libxtst' 'polkit-gnome>=0.96')
makedepends=('pkg-config' 'intltool' 'xtrans')
conflicts=('gnome-session')
provides=('gnome-session=2.32.1')
options=('!emptydirs')
install=gnome-session.install
url="http://www.gnome.org"
groups=('gnome')
source=('http://ftp.gnome.org/pub/gnome/sources/${realname}/2.32/gnome-session-2.32.1.tar.bz2'
01_gnome-wm.patch
03_no_session_delay.patch
11_saved_session_name.patch
19_gnome-wm-tweaking.patch
21_up_start_on_demand.patch
22_support_autostart_delay.patch
95_dbus_request_shutdown.patch
96_no_catch_sigsegv.patch
97_fix_query_end_session_crash.patch
98_fix_xsmp_stop_crash.patch
99_screen_lock_on_suspend.patch)

sha256sums=('22d93ce433fcf9c7ce6b5f36dd81f64e692ea0e41faaa0f61159ddac28c3686a'
            '384cc00d73cb04ba6015485c11e2091020ab4d7b3d69c516ec0755385e573d7b'
            'ac5674858e4adbd6641c7fc5999cea33d561b9ebc43e4bcef16561e3037c89e4'
            '96948f0094190f39003d02e3cb1d990de3923e7df08a2a500e48e8f4a7553d6b'
            '85248b0e682976d53d8dad872f5f0f4b5acb10a367460b819fc459a5e628d4eb'
            '5e6a59812faae13d4e00eb2ab92b216cd0d700ffbfefa9ba4ad41d2c5e8e4cc2'
            '0578fb30feadbdc85bde00acc7ccce4a71e39cb5d8052d5807a1e4ef2692a891'
            '963592df6de16f91751a7db5b0a813aee0a5c4d172db3134f2e8e8861c69a113'
            'bc60bcf697dabeb65b37ce5c5839d663ea7b4393b3de772640ee9e6e429cc77a'
            '6772b9822395607d7c14008748f9d64b5589be912bc16e5104589d7a59e82bfc'
            '70c3ab7f9854d443827726b84edb5a8c9378db8dd36e64c821cedade8a67574f'
            '90af16902bc5873afa418f8ab980d56603a9bf18421b03c4a231436514519979')


build() {
  cd "${srcdir}/${realname}-${pkgver}"
ls -1 ../*.patch | xargs -iXXX patch -Np1 -i XXX
  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
      --libexecdir=/usr/lib # --with-default-wm=fusion-icon   
#Add --with-default-wm if you want another wm to start by default in GNOME
  make
  make DESTDIR="${pkgdir}" GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 install 

  install -d -m755 "${pkgdir}/usr/share/gconf/schemas"
  gconf-merge-schema "${pkgdir}/usr/share/gconf/schemas/${realname}.schemas" --domain gnome-session-2.0 ${pkgdir}/etc/gconf/schemas/*.schemas
  rm -f ${pkgdir}/etc/gconf/schemas/*.schemas
}
