# Maintainer: portals <portals at riseup.net> Base on work of: 2bluesc <2bluesc at gmail.com> and mazzolino <maze+aur at strahlungsfrei.de>
# Contributor: Pieter Kokx <pieter@kokx.nl>

pkgname=armory
_pkgname=BitcoinArmory
pkgver=0.92.3
_pkgver=0.92.3
pkgrel=1
pkgdesc="Python-Based Bitcoin Software"
arch=('i686' 'x86_64')
url="https://github.com/etotheipi/BitcoinArmory"
license=('AGPL3')
groups=()
depends=('crypto++' 'swig' 'python2' 'twisted' 'qt4' 'python2-pyqt' 'python2-bsddb' 'python2-psutil')
makedepends=('git' 'gcc' 'make')
provides=('armory')
conflicts=('armory')
replaces=()
backup=()
options=()
install=
source=("run-armory.sh" "build_detect_platform-01.patch" "http://github.com/etotheipi/BitcoinArmory/archive/v$_pkgver.tar.gz")
noextract=()
sha256sums=('baa1d335273af1f1f4d12dd68f066035e5b4485b215172690c307877ac62168c' 'b97d08e6704f47e4794187b0ab1fea77e4f75dd9cc3628685d3d4a62fec147a4' '349a734997527c34f66d53cdeb987aa6345907703a6d62dc48f7e5487933a13a')

build() {
    cd $srcdir/BitcoinArmory-$_pkgver/

    patch -p0 -i $srcdir//build_detect_platform-01.patch

    make PYVER=python2.7
}

package() {
  install -Dm 755 "$srcdir/run-armory.sh" "$pkgdir/usr/bin/armory"

  mkdir -p "$pkgdir/opt"
  cp -R "$srcdir/$_pkgname-$_pkgver/" "$pkgdir/opt/"
  mv "$pkgdir/opt/$_pkgname-$_pkgver" "$pkgdir/opt/$_pkgname"

  rm -rf "$pkgdir/opt/$_pkgname/cppForSwig/"
  rm -rf "$pkgdir/opt/$_pkgname/.git/"
  rm -rf "$pkgdir/opt/$_pkgname/.gitignore"
}
