# Maintainer: Pieter Kokx <pieter@kokx.nl>
pkgname=armory
_pkgname=BitcoinArmory
pkgver=0.88beta
_pkgver=0.88-beta
pkgrel=1
pkgdesc="Python-Based Bitcoin Software"
arch=('i686' 'x86_64')
url="https://github.com/etotheipi/BitcoinArmory"
license=('AGPL3')
groups=()
depends=('crypto++' 'swig' 'python2' 'twisted' 'qt4' 'python2-pyqt' 'python2-bsddb' 'python2-psutil')
makedepends=('git' 'gcc' 'make')
provides=('armory')
conflicts=('armory')
replaces=()
backup=()
options=()
install=
source=("run-armory.sh" "http://github.com/etotheipi/BitcoinArmory/archive/v$_pkgver.tar.gz")
#source[0]="http://github.com/etotheipi/BitcoinArmory/archive/v$_pkgver.tar.gz"
#source[1]="run-armory.sh"
noextract=()
sha256sums=('baa1d335273af1f1f4d12dd68f066035e5b4485b215172690c307877ac62168c' '755b9c6f42a743f39509b9a91be1a329cc26d43d4b10ebefb4972f0252c0671e')
#sha256sums[0]='9c08ebea52d2761863f974bcd27b05d14d0bfd4c616c1eb0aa79d20f3c3cfa52'
#sha256sums[1]='baa1d335273af1f1f4d12dd68f066035e5b4485b215172690c307877ac62168c'


build() {
    cd $srcdir/BitcoinArmory-$_pkgver/

    cd cppForSwig
    sed -ir 's#"$(DEPSDIR)/lib/libpython$(PYVER).a"#"/usr/lib/python2.7/config/libpython2.7.a"#' Makefile
    sed -ir "s#PYVER.*+=.*#PYVER\t+= 2.7#" Makefile

    make swig
}

package() {
  install -Dm 755 "$srcdir/run-armory.sh" "$pkgdir/usr/bin/armory"

  mkdir -p "$pkgdir/opt"
  cp -R "$srcdir/$_pkgname-$_pkgver/" "$pkgdir/opt/"
  mv "$pkgdir/opt/$_pkgname-$_pkgver" "$pkgdir/opt/$_pkgname"

  rm -rf "$pkgdir/opt/$_pkgname/cppForSwig/"
  rm -rf "$pkgdir/opt/$_pkgname/.git/"
  rm -rf "$pkgdir/opt/$_pkgname/.gitignore"
}
