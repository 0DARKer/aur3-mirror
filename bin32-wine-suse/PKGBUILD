# Maintainer: Det <nimetonmaili at gmail a-dot com>
# Contributor: Lee Jackson <tomoe AT lbjackson DOTCOM>
# Based on [extra]'s wine

pkgname=bin32-wine-suse
pkgver=1.3.36
pkgrel=4
_suserel=1.$pkgrel
_suserel=$pkgrel.1
_suserel=3.2
pkgdesc="A compatibility layer for running Windows programs - prebuilt openSUSE i586 build"
url="http://en.opensuse.org/Wine"
install=$pkgname.install
arch=('x86_64')
license=('LGPL')
depends=('lib32-fontconfig' 'lib32-mesa' 'lib32-libxcursor' 'lib32-libxrandr' 'lib32-libxdamage' 'lib32-libxi' 'lib32-gettext' 'desktop-file-utils')
makedepends=('libarchive' 'rpmextract')
optdepends=('lib32-giflib' 'lib32-libpng' 'lib32-libldap' 'lib32-lcms' 'lib32-libxml2' 'lib32-mpg123' 'lib32-openal' 'lib32-libcups' 'lib32-v4l-utils' 'lib32-libpulse' 'lib32-alsa-plugins' 'lib32-alsa-lib' 'wine_gecko')
provides=("wine=$pkgver" "bin32-wine=$pkgver" "bin32-winetricks=$pkgver")
conflicts=('wine' 'bin32-wine' 'bin32-winetricks')
source=(http://download.opensuse.org/repositories/Emulators:/Wine/openSUSE_Factory/i586/wine-$pkgver-$_suserel.i586.rpm
        http://download.opensuse.org/repositories/Emulators:/Wine/openSUSE_Factory/i586/wine-32bit-$pkgver-$_suserel.i586.rpm
        http://download.opensuse.org/repositories/Emulators:/Wine/openSUSE_Factory/i586/wine-devel-$pkgver-$_suserel.i586.rpm)
noextract=(${source[@]##*/})
md5sums=(`curl -s $source.md5 | cut -d " " -f1`
         `curl -s ${source[1]}.md5 | cut -d " " -f1`
         `curl -s ${source[2]}.md5 | cut -d " " -f1`)

package() {
  msg2 "Extracting the archives"
  rpmextract.sh wine-$pkgver-$_suserel.i586.rpm
  rpmextract.sh wine-32bit-$pkgver-$_suserel.i586.rpm
  rpmextract.sh wine-devel-$pkgver-$_suserel.i586.rpm

  msg2 "Cleaning up unnecessary desktop entries"
  rm -r usr/share/applications/wine-*

  msg2 "Re-arranging docs"
  mv usr/share/doc/{packages/wine,wine}
  rmdir usr/share/doc/packages

  msg2 "Moving everything in place"
  mv usr/ "$pkgdir"
}