# Contributor : Mark E. Lee <mark@markelee.com>
# Maintainer : Mark E. Lee <mark@markelee.com>

pkgname='libreoffice-git'
pkgdesc='LGPL licensed office suite'
pkgver=20130307
pkgrel=1
url='http://www.libreoffice.org/'
arch=('i686' 'x86_64')
license=('LGPL3')
makedepends=('sane'
             'perl-archive-zip'
             'zip'
             'unzip'
             'unixodbc'
             'boost'
             'apache-ant'
             'gperf'
             'kdelibs'
             'gconf'
             'cppunit'
             'beanshell'
             'vigra'
             'clucene'
             'junit'
             'libmythes'
             'libwpg'
             'imagemagick'
             'glu'
             'mesa'
             'gst-plugins-base-libs'
             'java-environment'
             'postgresql-libs'
             'doxygen'
             'clucene'
             'bluez')
depends=("curl>=7.20.0"
         "hunspell>=1.2.8"
         "python>=3.3"
         'libwpd>=0.9.2'
         'libwps'
         'libxaw'
         "neon>=0.28.6"
         'pango'
         'nspr'
         'libjpeg'
         'libxrandr'
         'libgl'
         'dbus-glib'
         'libxslt'
         'librsvg'
         "icu>=50.1-2"
         'redland'
         'hyphen'
         'lpsolve'
         'gcc-libs'
         'sh'
         'libtextcat'
         'graphite'
         'lcms2'
         'poppler>=0.20.5'
         'hicolor-icon-theme'
         'desktop-file-utils'
         'shared-mime-info'
         'gtk2'
         'orbit2'
         'translate-toolkit'
         'xdg-utils'
	 'ttf-dejavu'
	 'libpng12')
	         
_gitroot='git://anongit.freedesktop.org/libreoffice/core'
_gitname='core'


build() {  ## build libreoffice from git

   cd ${srcdir}/;  ## enter the source directory
   
   msg "Connecting to the GNOME GIT server...";
   if [[ -d ${srcdir}/${_gitname} ]] ; then  ## check if local git source directory is present
      cd ${srcdir}/${_gitname};  ## enter the local git source directory
      git pull origin;  ## update the local git source
      msg "The local files are updated..."
     else
      git clone ${_gitroot} ${gitname};  ## obtain the git source from git
   fi
   msg "GIT checkout done."

   git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build; ## clone the libreoffice git repo into a build directory
   cd ${srcdir}/${_gitname}-build;  ## enter the build directory
   
   msg2 "Starting make for: ${pkgname}";
   
   ## run the libreoffice autoconfigure script
   ./autogen.sh --with-vendor="Arch Linux" \
                --with-unix-wrapper="libreoffice" \
                --with-parallelism=${MAKEFLAGS/-j/} \
                --with-external-tar="${srcdir}/ext_sources" \
                --enable-split-app-modules \
                --prefix=/usr --exec-prefix=/usr --sysconfdir=/etc \
                --libdir=/usr/lib --mandir=/usr/share/man \
                --libexec=/usr/bin --bindir=/usr/bin --sbindir=/usr/sbin

   make clean &&  make;  ## clean up files before compiling
}

package() {  ## install files from libreoffice into the pkg directory
  cd ${srcdir}/${_gitname}-build;  ## enter the the build directory
  make DESTDIR=${pkgdir} distro-pack-install;  ## install the compiled files in package directory
}
