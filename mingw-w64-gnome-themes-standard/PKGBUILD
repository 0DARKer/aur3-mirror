pkgname=mingw-w64-gnome-themes-standard
pkgver=3.12.0
pkgrel=3
pkgdesc="Default themes for the GNOME desktop (mingw-w64)"
arch=(any)
url="http://www.gnome.org"
license=(GPL2)

depends=(mingw-w64-librsvg)
makedepends=('mingw-w64-gtk3>=3.10.0' librsvg gdk-pixbuf2 intltool)

source=(
  "http://ftp.gnome.org/pub/gnome/sources/gnome-themes-standard/${pkgver%.*}/gnome-themes-standard-${pkgver}.tar.xz")

sha256sums=(
  'a05d1b7ca872b944a69d0c0cc2369408ece32ff4355e37f8594a1b70d13c3217')

_architectures="i686-w64-mingw32 x86_64-w64-mingw32"


build() {
  cd "${srcdir}/gnome-themes-standard-${pkgver}"
  
  for _arch in ${_architectures}; do
    unset LDFLAGS
    export CFLAGS="-O2 -mms-bitfields"
    mkdir -p "${srcdir}/${pkgname}-${pkgver}-build-${_arch}"
    cd "${srcdir}/${pkgname}-${pkgver}-build-${_arch}"
    msg "Starting configure and make"
    ${srcdir}/gnome-themes-standard-${pkgver}/configure \
      --prefix=/usr/${_arch} \
      --build=$CHOST \
      --host=${_arch} \
      --disable-gtk2-engine
    make
  done
}


package() {
  for _arch in ${_architectures}; do
    cd "${srcdir}/${pkgname}-${pkgver}-build-${_arch}"
    make -j1 DESTDIR="$pkgdir" install
	
	${_arch}-strip -x "$pkgdir/usr/$_arch/lib/gtk-3.0/3.0.0/theming-engines/libadwaita.dll"
	
    rm -r  "$pkgdir/usr/$_arch/lib/locale" # what the hell are they even doing here?
    rm -r  "$pkgdir/usr/$_arch/share/gnome-background-properties"
	
	# stuff useless for MS Windows
    rm -r  "$pkgdir/usr/$_arch/share/icons/Adwaita"
    rm -r "$pkgdir/usr/$_arch/share/themes/Adwaita/backgrounds"
    rm -r "$pkgdir/usr/$_arch/share/themes/Adwaita/metacity-1"
    rm -r "$pkgdir/usr/$_arch/share/themes/HighContrast/metacity-1"
  done
}
