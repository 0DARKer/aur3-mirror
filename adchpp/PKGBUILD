# PKGBUILD for the Advanced Direct Connect Hub ++ 

pkgname="adchpp"
pkgver=2.7.0
pkgrel=1
pkgdesc="ADCH++ is a hub software for the ADC network."
url="http://adchpp.sourceforge.net/"
arch=('i686' 'x86_64')
license=("GPL")
md5sums=('e72127acc319ea04bfe57178a3b1197c'
         'a9f74423342d56268af2392b99a1ed38')
sha512sums=('19cd03527aca666edfd262e4d1a60d45028566c2175f56edc4aededff9049855f5707ee54ff371ba09e07dead6d062ab53f0c67ff35b56192536b86add3cebae'
            'cd93118ffed58912e6b0861034caf6b857e0a9b2ae769e9d8cd0f8befa3eb05d8b2827e30ad28b8f66d766e69b7fb2e958217d15e3c4c79fd242670797d51389')
source=("http://downloads.sourceforge.net/${pkgname}/${pkgname}_${pkgver}_source.tar.gz" 'adchpp')
depends=('lua' 'python' 'libstdc++5' 'readline' 'openssl')
makedepends=('lua' 'python' 'libstdc++5' 'scons' 'swig' 'readline' 'openssl')
optdepends=('ruby')
options=('!emptydirs')
install='adchpp.install'

build() {
    mkdir -p ${pkgdir}/opt/adchpp/logs
    mkdir -p ${pkgdir}/etc/rc.d
    
    cd ${srcdir}/${pkgname}_${pkgver}_source
    scons
    cp -r plugins/Script/examples/ ${pkgdir}/opt/adchpp/scripts 
    cp -r etc/ ${pkgdir}/opt/adchpp/etc
    cp -r build/debug-default/* ${pkgdir}/opt/adchpp/

    sed -i 's#<Log type="int">0</Log>#<Log type="int">0</Log>#' ${pkgdir}/opt/adchpp/etc/adchpp.xml
    sed -i 's#<LogFile type="string">.*</LogFile>#<LogFile type="string">/opt/adchpp/logs/adchpp%Y%m\.log</LogFile>#' ${pkgdir}/opt/adchpp/etc/adchpp.xml
    mv ${srcdir}/adchpp ${pkgdir}/etc/rc.d/
}

