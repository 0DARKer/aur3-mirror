# PKGBUILD for the Advanced Direct Connect Hub ++ 

pkgname="adchpp"
pkgver=2.7.0
pkgrel=3
pkgdesc="ADCH++ is a hub software for the ADC network."
url="http://adchpp.sourceforge.net/"
arch=('i686' 'x86_64')
license=("GPL")
source=("http://downloads.sourceforge.net/${pkgname}/${pkgname}_${pkgver}_source.tar.gz" 'adchppd.init' 'adchppd.confd' 'adchpp.install')
depends=('lua' 'python' 'libstdc++5' 'readline' 'openssl')
makedepends=('lua' 'python' 'libstdc++5' 'scons' 'swig' 'readline' 'openssl')
optdepends=('ruby')
options=('!emptydirs')
install='adchpp.install'

build() {
    mkdir -p ${pkgdir}/opt/adchpp/logs
    mkdir -p ${pkgdir}/etc/rc.d
    mkdir -p ${pkgdir}/etc/conf.d
    
    cd ${srcdir}/${pkgname}_${pkgver}_source
    scons mode=release
    cp -r plugins/Script/examples/ ${pkgdir}/opt/adchpp/scripts 
    cp -r etc/ ${pkgdir}/opt/adchpp/etc
    cp -r build/release-default/* ${pkgdir}/opt/adchpp/

    sed -i 's#<Log type="int">0</Log>#<Log type="int">0</Log>#' ${pkgdir}/opt/adchpp/etc/adchpp.xml
    sed -i 's#<LogFile type="string">.*</LogFile>#<LogFile type="string">/opt/adchpp/logs/adchpp%Y%m\.log</LogFile>#' ${pkgdir}/opt/adchpp/etc/adchpp.xml
    cp ${srcdir}/adchppd.init ${pkgdir}/etc/rc.d/adchppd
    chmod a+x ${pkgdir}/etc/rc.d/adchppd
    cp ${srcdir}/adchppd.confd ${pkgdir}/etc/conf.d/adchppd
}
md5sums=('e72127acc319ea04bfe57178a3b1197c'
         '124e95fa82e4dfdfca6264a7ebad6bcd'
         'dd048abe94b98b5d9a9dfcef48f4fb32'
         '38aac5c29702f827065764ee42f0747d')
