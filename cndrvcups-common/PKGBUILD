# Contributor: Steven She <mintcoffee@gmail.com>
pkgname=cndrvcups-common
pkgver=2.00
pkgrel=1
pkgdesc="Common printer driver modules for Canon printers"
arch=('i686' 'x86_64')
url="http://support-au.canon.com.au/contents/AU/EN/0100270808.html"
license=('GPL')
depends=('gtk2')
makedepends=('rpmextract' 'automake' 'autoconf')
source=('http://gdlp01.c-wss.com/gds/8/0100002708/01/UFR_II_Printer_Driver_for_Linux_V200_uk_EN.tar.gz')
options=('!emptydirs')
md5sums=('d83253ee5c3e719f9b1c8cac90f2cdef')
build() {
    unset LDFLAGS

    cd $srcdir/UFR_II_Printer_Driver_for_Linux_V200_uk_EN/Sources
    tar xf ${pkgname}-${pkgver}-2.tar.gz || return 1

    cd $pkgname-$pkgver

    (
    cd cngplp
    ./autogen.sh --prefix=/usr && \
    make && \
    make DESTDIR=${pkgdir} install
    ) || return 1

    (
    cd buftool
    ./autogen.sh --prefix=/usr && \
    make && \
    make DESTDIR=${pkgdir} LIBDIR=/usr/lib install
    ) || return 1

    (
    cd cpca
    ./autogen.sh --prefix=/usr && \
    make && \
    make DESTDIR=${pkgdir} LIBDIR=/usr/lib install
    ) || return 1

    (
    cd c3plmod_ipc
    make && \
    make DESTDIR=${pkgdir} LIBDIR=/usr/lib install
    ) || return 1


    #Taken debian install rules in package
    install -c -m 4755 libs/cnpkmodule $pkgdir/usr/bin
    install -c -m 4755 libs/c3pldrv    $pkgdir/usr/bin

    install -c -m 755 libs/libcaiowrap.so.1.0.0 $pkgdir/usr/lib
    install -c -m 755 libs/libcaiousb.so.1.0.0 $pkgdir/usr/lib
    install -c -m 755 libs/libc3pl.so.0.0.1 $pkgdir/usr/lib
    install -c -m 755 libs/libcnaccm.so.1.0 $pkgdir/usr/lib
    install -c -m 755 libs/libcaepcm.so.1.0 $pkgdir/usr/lib
    install -c -m 755 libs/libcnlbcm.so.1.0 $pkgdir/usr/lib
    install -c -m 755 c3plmod_ipc/libcanonc3pl.so.1.0.0 $pkgdir/usr/lib
	install -c -m 755 libs/libcanon_slim.so.1.0.0 $pkgdir/usr/lib

    (
    cd $pkgdir/usr/lib/
    ln -sf libc3pl.so.0.0.1 libc3pl.so.0
    ln -sf libc3pl.so.0.0.1 libc3pl.so
    ln -sf libcnaccm.so.1.0 libcnaccm.so.1
    ln -sf libcnaccm.so.1.0 libcnaccm.so
    ln -sf libcaepcm.so.1.0 libcaepcm.so.1
    ln -sf libcaepcm.so.1.0 libcaepcm.so
    ln -sf libcnlbcm.so.1.0 libcnlbcm.so.1
    ln -sf libcnlbcm.so.1.0 libcnlbcm.so
    ln -sf libcaiowrap.so.1.0.0 libcaiowrap.so.1
    ln -sf libcaiowrap.so.1.0.0 libcaiowrap.so
    ln -sf libcaiousb.so.1.0.0 libcaiousb.so.1
    ln -sf libcaiousb.so.1.0.0 libcaiousb.so
    ln -sf libcanonc3pl.so.1.0.0 libcanonc3pl.so.1
    ln -sf libcanonc3pl.so.1.0.0 libcanonc3pl.so
    ln -sf libcanon_slim.so.1.0.0 libcanon_slim.so.1
    ln -sf libcanon_slim.so.1.0.0 libcanon_slim.so
    ) || return 1

    mkdir -p $pkgdir/usr/share/caepcm
    install -c -m 644 data/CA*    $pkgdir/usr/share/caepcm
    install -c -m 644 data/CNZ0*  $pkgdir/usr/share/caepcm
}
