# Maintainer: Army
pkgname=surf-git
pkgver=20130320
pkgrel=1
pkgdesc="a WebKit based browser"
arch=('i686' 'x86_64')
url="http://surf.suckless.org/"
license=(custom:MIT/X)
depends=('webkitgtk2')
makedepends=('git')
provides=('surf' 'surf-hg')
conflicts=('surf' 'surf-hg')

_gitroot=git://git.suckless.org/surf
_gitname=surf

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"
  
  if ls $SRCDEST/*\.patch 2> /dev/null
  then
    for i in $SRCDEST/*\.patch
    do
      msg "patching with $i"
      patch -i $i
    done
  fi
  
  if test -e $SRCDEST/config.h
  then
    msg "use custom config.h"
    cp $SRCDEST/config.h .
  else
    msg "use default config.h"
  fi
}

package() {
  cd "$srcdir/$_gitname-build"

  make PREFIX=/usr DESTDIR=$pkgdir install
  install -Dm644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}

# vim:set ts=2 sw=2 et:
