# Maintainer: onny <onny@project-insanity.org>
# Contributor: onny <onny@project-insanity.org>

pkgname=osmocombb-git
pkgver=20110512
pkgrel=1
pkgdesc="An Free Software / Open Source GSM Baseband software implementation."
arch=('i686' 'x86_64')
url="http://bb.osmocom.org/"
license="GPL3"
depends=('libtool' 'autoconf' 'git' 'make' 'gcc' 'pkg-config')
#depends=('shtool' 'libtool' 'autoconf' 'git' 'make' 'gcc' 'pkg-config')
#cross-arm-elf-gcc-base
backup=()
source=("http://gnuarm.com/bu-2.15_gcc-3.4.3-c-c++-java_nl-1.12.0_gi-6.1.tar.bz2")
md5sums=('2c20a73c738f81a3fd7c377484a4055e')

_gitroot="http://cgit.osmocom.org/cgit/osmocom-bb"
_gitname="osmocom-bb"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
    cd osmocom-bb
    git pull --rebase
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."
  
  cd src
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat shared/libosmocore/Makefile.am) > Makefile_new
  mv Makefile_new shared/libosmocore/Makefile.am
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat shared/libosmocore/configure.in) > configurein_new
  mv configurein_new shared/libosmocore/configure.in
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat target/firmware/Makefile) > Makefile_new
  mv Makefile_new target/firmware/Makefile
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat Makefile) > Makefile_new
  mv Makefile_new Makefile
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat target/firmware/calypso/Makefile) > Makefile_new
  mv Makefile_new target/firmware/calypso/Makefile
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat target/firmware/layer1/Makefile) > Makefile_new
  mv Makefile_new target/firmware/layer1/Makefile
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat target/firmware/comm/Makefile) > Makefile_new
  mv Makefile_new target/firmware/comm/Makefile
  ( echo "PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH" ; cat target/firmware/lib/Makefile) > Makefile_new
  mv Makefile_new target/firmware/lib/Makefile
  make -e PATH=$srcdir/osmocombb/src/gnuarm-3.4.3/bin:$PATH
} 

