#Mantainer: Filippo Squillace <sqoox85@gmail.com>
pkgname=golpy
pkgver=0.2.0
pkgrel=3
pkgdesc="A Conway's Game of Life Simulator written in Python"
arch=(any)
url="https://github.com/fsquillace/golpy"
license=('GPLv2')
depends=('python2' 'python2-numpy' 'wxpython')
makedepends=('asciidoc' 'xmlto')
provides=()
options=()
source=(https://github.com/downloads/fsquillace/${pkgname}/${pkgname}-${pkgver}.tar.gz)

#To debug uncomment this:
#md5=$(md5sum ${pkgname}-${pkgver}.tar.gz )
#md5sums=(${md5:0:32})
md5sums=('97f35f33c1f66f653db648fde37ef894')
optdepends=('pycuda: For GPU support')

build() {
  cd ${srcdir}

  echo "Moving the licence into /usr/share/licenses/${pkgname} ..."
  mkdir -p "$pkgdir/usr/share/licenses/${pkgname}"
  mv -f "${pkgname}/LICENSE" $pkgdir/usr/share/licenses/${pkgname}/

  echo "Copying the $pkgname directory into the pkg directory ..."
  mkdir -p "$pkgdir/opt/${pkgname}"
  cp -rf ${pkgname}/* "$pkgdir/opt/$pkgname/"

  echo "Removing tests directory ..."
  rm -fr $pkgdir/opt/$pkgname/tests

	# Removes all .git directories
	echo "Removing all .git directories..."
	find $pkgdir/opt/$pkgname -name ".git" -type d -exec rm -fr {} +

  # Generate manual page
  echo "Generating manual page..."
  /usr/bin/asciidoc -d manpage -b docbook -o ${pkgname}.1.xml ${pkgname}/README
  /usr/bin/xmlto man ${pkgname}.1.xml # Add --skip-validation if it doesn't work
  /bin/gzip ${pkgname}.1
  mkdir -p "${pkgdir}/usr/share/man/man1/"
  cp ${pkgname}.1.gz ${pkgdir}/usr/share/man/man1/

  chmod +x $pkgdir/opt/$pkgname/$pkgname
  # Creating symlink
  echo "Creating symlink..."
  mkdir -p $pkgdir/usr/bin
  ln -s ../../opt/$pkgname/$pkgname $pkgdir/usr/bin/$pkgname

  
}

# vim:set ts=2 sw=2 et:
