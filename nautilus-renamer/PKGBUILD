# Contributor: Andru <dr.andru@gmail.com>

pkgname=nautilus-renamer
pkgver=2.3
pkgrel=3
pkgdesc='The nautilus-renamer is a python script for batch renaming files in nautilus, with a simple yet intuitive gtk+ interface and lots of options and features.'
arch=('i686' 'x86_64')
url="http://launchpad.net/nautilus-renamer/"
license=('GPL3')
depends=('python2' 'nautilus')
makedepends=('intltool')
source=(http://launchpad.net/nautilus-renamer/trunk/$pkgver/+download/nautilus-renamer-$pkgver.tar.gz)
md5sums=('d053c09d9f99c26ad35035248cd70779')

build() {
  cd "$srcdir"/$pkgname

  # patch renamer for python2
  sed 's|/usr/bin/python|/usr/bin/python2|g' -i nautilus-renamer.py
  # patch Makefile for python2
  sed 's|./scripts/genmo.py|python2 ./scripts/genmo.py|g' -i Makefile
  # patch install script for global installation
  sed 's|/usr/bin/env python|/usr/bin/env python2|g' -i ./scripts/install
  sed "s|NAUTILUS_SCRIPTS_GLOBAL_DIR = os.path.join (sys.prefix, 'share', 'nautilus-scripts')|NAUTILUS_SCRIPTS_GLOBAL_DIR = '$pkgdir/usr/share/nautilus-scripts'|g" -i scripts/install
  sed "s|LOCALE_DIR = os.path.join (sys.prefix, 'share', 'locale')|LOCALE_DIR = '$pkgdir/usr/share/locale'|g" -i scripts/install
  sed "s|doc_dir = os.path.join (sys.prefix, 'share', 'doc', 'nautilus-renamer')|doc_dir = '$pkgdir/usr/share/doc/nautilus-renamer'|g" -i scripts/install

  mkdir "$pkgdir"/usr
  mkdir "$pkgdir"/usr{/share,/share/nautilus-scripts}

  make DESTDIR="$pkgdir" globalinstall || return 1
}
