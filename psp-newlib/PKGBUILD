# Maintainer: xantares <xantares09 at hotmail dot com>

pkgname=psp-newlib
pkgver=1.20.0
pkgrel=1
pkgdesc="Newlib is a C library intended for use on embedded systems (psp)"
arch=(any)
url="http://sourceware.org/newlib/"
license=('GPL')
groups=('psp')
depends=('psp-gcc-base' 'psp-binutils')
options=('!buildflags' '!strip' 'staticlibs')
source=("ftp://sources.redhat.com/pub/newlib/newlib-$pkgver.tar.gz"
        "newlib-$pkgver-PSP.patch")
md5sums=('e5488f545c46287d360e68a801d470e8'
         '299d12b29bd492fe21bb27f72f1de548')

prepare ()
{
  cd "$srcdir/newlib-$pkgver"
  rm -f newlib/libc/sys/psp/aclocal.m4 newlib/libc/sys/psp/arpa/inet.h newlib/libc/sys/psp/confdefs.h newlib/libc/sys/psp/configure newlib/libc/sys/psp/configure.in newlib/libc/sys/psp/crt0.c newlib/libc/sys/psp/fdman.c newlib/libc/sys/psp/fdman.h newlib/libc/sys/psp/include/netdb.h newlib/libc/sys/psp/interrupt.S newlib/libc/sys/psp/libcglue.c newlib/libc/sys/psp/Makefile.am newlib/libc/sys/psp/Makefile.in newlib/libc/sys/psp/netdb.c newlib/libc/sys/psp/netinet/in.h newlib/libc/sys/psp/netinet/tcp.h newlib/libc/sys/psp/pipe.c newlib/libc/sys/psp/pspcwd.c newlib/libc/sys/psp/README newlib/libc/sys/psp/select.c newlib/libc/sys/psp/socket.c newlib/libc/sys/psp/sys/dirent.h newlib/libc/sys/psp/sys/errno.h newlib/libc/sys/psp/sys/fd_set.h newlib/libc/sys/psp/sys/ioctl.h newlib/libc/sys/psp/sys/select.h newlib/libc/sys/psp/sys/socket.h newlib/libc/sys/psp/syscalls.c newlib/libc/sys/psp/xprintf.c
  patch -p1 -i "$srcdir"/newlib-$pkgver-PSP.patch
}

build()
{
  cd "$srcdir/newlib-$pkgver"
  mkdir -p build-psp && pushd build-psp
  ../configure --prefix=/usr --target=psp --enable-newlib-iconv --enable-newlib-multithread --enable-newlib-mb 
  make 
}

package()
{
  cd "$srcdir/newlib-$pkgver/build-psp"
  make install DESTDIR="$pkgdir"
  rm -r "$pkgdir"/usr/share
}

