# Mantainer: Franco Tortoriello

pkgname=openglide-cvs
pkgver=20111104
pkgrel=1
pkgdesc="Glide wrapper, useful with DOSBox with Glide support"
arch=('i686' 'x86_64')
url="http://openglide.sourceforge.net "
license=('GPL')
depends=()
makedepends=('cvs')

_cvsroot="anonymous@openglide.cvs.sourceforge.net:/cvsroot/openglide"
_cvsmod="openglide"

build() {
  cd ${srcdir}

  if [ -d $_cvsmod/CVS ]; then
    (cd $_cvsmod && cvs -z3 update -d)
  else
    cvs -z3 -f -d:pserver:$_cvsroot co $_cvsmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting build..."

  rm -rf ${srcdir}/$_cvsmod-build
  cp -r ${srcdir}/$_cvsmod ${srcdir}/$_cvsmod-build
  cd ${srcdir}/$_cvsmod-build

  sed -e '/install-data-hook/d' -e '/ln/d' -i Makefile.am
  ./bootstrap
  ./configure --prefix=/usr
  make
}

package() {
  cd ${srcdir}/$_cvsmod-build
  make DESTDIR=${pkgdir} install
  ln -s ${pkgdir}/usr/include/openglide/sdk2_glide.h ${pkgdir}/usr/include/glide.h
}
