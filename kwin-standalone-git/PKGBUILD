# Maintainer: Jerome Leclanche <jerome.leclanche+arch@gmail.com>

pkgname=kwin-standalone-git
pkgver=20130121
pkgrel=1
pkgdesc="Standalone version of KWin which doesn't pull in the rest of kdebase-workspace."

arch=('i686' 'x86_64')
url='http://www.kde.org'
license=('GPL' 'LGPL' 'FDL')
# groups=('kde')
depends=('kdelibs' 'kdebase-runtime' 'xcb-util-renderutil' 'xcb-util-image')
makedepends=('cmake' 'automoc4')
conflicts="kde-workspace"

_gitroot="git://anongit.kde.org/clones/kde-workspace/graesslin/kde-workspace.git"
_gitname="kde-workspace"


build() {
	cd "$srcdir"
	msg "Connecting to GIT server..."
	if [ -d $_gitname ] ; then
		cd $_gitname && git pull origin
		msg "The local files are updated."
		cd ..
	else
		git clone --depth=1 --branch=kwin/standalone $_gitroot $_gitname
	fi
	msg "GIT checkout done or server timeout"

	mkdir -p build
	cd build
	cmake ../${_gitname}/kwin \
		-DKWIN_BUILD_OXYGEN=OFF \
		-DKWIN_BUILD_KAPPMENU=OFF \
		-DKWIN_BUILD_ACTIVITIES=OFF \
		-DKWIN_BUILD_KCMS=OFF \
		-DCMAKE_INSTALL_PREFIX=/usr
	make
	make install DESTDIR="${pkgdir}" || return 1
}
