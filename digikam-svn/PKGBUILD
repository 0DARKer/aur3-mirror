# Contributor: Jozef Korencik <joffko@gmail.com>
# Maintainer: Dany Martineau <dany.luc.martineau at gmail.com>

pkgname=digikam-svn
pkgver=1092274
pkgrel=1
pkgdesc="Digital photo management application for KDE, svn version"
arch=('i686' 'x86_64')
url="http://www.digikam.org/"
license=('GPL')
depends=('kdebase-runtime' 'kdegraphics-libs' 'kdepimlibs' 'lensfun' 'kdeedu-marble' 'liblqr' 'kipi-plugins-svn')
makedepends=('subversion' 'cmake' 'automoc4' 'pkgconfig')
conflicts=('kdemod-extragear-digikam' 'digikam')
provides=('digikam')
install=('digikam-svn.install')
_svntrunk=svn://anonsvn.kde.org/home/kde/trunk/extragear/graphics/digikam/
_svnmod=digikam-svn

build() {
  cd ${srcdir}

  if [ -d ${_svnmod}/.svn ]; then
    (cd ${_svnmod} && svn revert -R .)
    (cd ${_svnmod} && svn -r ${pkgver} up)
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}/${_svnmod} || return 1

   cmake -DCMAKE_INSTALL_PREFIX=/usr \
     -DENABLE_MARBLEWIDGET=yes \
     -DWITH_MarbleWidget=yes \
     -DCMAKE_SKIP_RPATH=ON

   make all|| return 1
  make DESTDIR=${pkgdir} install || return 1
}


