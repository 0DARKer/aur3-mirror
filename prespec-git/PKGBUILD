# Maintainer: L.G. Sarmiento (Pico) <Luis.Sarmientop-ala-nuclear.lu.se>

pkgname=prespec-git
pkgver=20130306
pkgrel=1
pkgdesc=""
url="http://www.ikp.tu-darmstadt.de"
arch=('x86_64')
license=('GPL3')
depends=('adflite-git')
makedepends=('git')
options=(!libtool)
_gitroot='agatagsi@lx-pool.gsi.de:git/prespec'
_gitname='prespec'

## If you plan to access the GSI machines you are supposed to know the password already.

build() {
  if [ -d ${srcdir}/$_gitname ]; then
    cd ${srcdir}/$_gitname && git pull origin
    msg "The local files are updated."
  else
    cd ${srcdir}
    git clone --depth 1 $_gitroot $_gitname
  fi
  msg "GIT checkout done or server timeout"

#### CMAKE ####
  msg "Starting building with cmake..."

  if [ -d ${srcdir}/$_gitname-build ]; then
I    rm -rf ${srcdir}/$_gitname-build
  fi

  mkdir ${srcdir}/$_gitname-build
  cd ${srcdir}/$_gitname-build
  cmake -DCMAKE_INSTALL_PREFIX=/usr \
    ${srcdir}/$_gitname
  make

#### AUTOTOOLS ####
#  msg "Starting building with make..."
#  if [ -d ${srcdir}/$_gitname-build2 ]; then
#    rm -rf ${srcdir}/$_gitname-build2
#  fi

#  cp -r ${srcdir}/$_gitname ${srcdir}/$_gitname-build2 || return 1

#  cd ${srcdir}/$_gitname-build2
#  ./autogen.sh #&> autogen_autotool.log
#  ./configure --prefix=/usr #&> configure_autotool.log
#  make #&> make_autotool.log
}

package() {
  msg  "Starting cmake install"
  cd ${srcdir}/$_gitname-build
  make DESTDIR="$pkgdir" install

#  msg "Starting autotools install"
#  cd ${srcdir}/$_gitname-build2
#  make DESTDIR="$pkgdir/" install &> install_autotool.log
}
