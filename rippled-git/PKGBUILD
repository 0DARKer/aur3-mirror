# Maintainer: Roberto Catini <roberto.catini@gmail.com> 

pkgname=rippled-git
_gitname=rippled
pkgrel=1
pkgver=0.23.0.r66.g7fed69f
pkgdesc="Ripple peer-to-peer network daemon"
arch=('i686' 'x86_64')
url="https://github.com/ripple/rippled"
license=('custom:ISC')
conflicts=('ripple')
depends=('protobuf' 'openssl' 'boost-libs')
makedepends=('git' 'scons' 'boost')
checkdepends=('nodejs')
source=("git://github.com/ripple/rippled.git")
sha512sums=('SKIP')

pkgver() {
	cd "$srcdir/$_gitname"
	git describe --long --tags | sed -r 's/([^-]*-g)/r\1/;s/-/./g'
}

build() {
	cd "$srcdir/$_gitname"
	scons build/rippled
}

check() {
	cd "$srcdir/$_gitname"
	npm install
	npm test
	build/rippled --unittest
}

package() {
	cd "$srcdir/$_gitname"
	install -D -m644 LICENSE "${pkgdir}/usr/share/licenses/${_gitname}/LICENSE"
	install -D build/rippled "${pkgdir}/usr/bin/rippled"
	install -D -m644 doc/rippled-example.cfg "${pkgdir}/etc/${_gitname}/rippled.cfg"
	mkdir -p ${pkgdir}/var/lib/ripple/db
	mkdir -p ${pkgdir}/var/log/rippled
}
