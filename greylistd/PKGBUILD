# Greylisting daemon from Debian project. Requires 'start-stop-daemon'.
# Contributor: Vladimir Koshelenko <koshelenko@rndavia.ru>
# Maintainer: Denis Yantarev <denis dot yantarev at gmail dot com>

pkgname=greylistd
pkgver=0.8.7+nmu2
pkgrel=3
pkgdesc="Simple greylisting system for mail transport agents"
url="http://packages.debian.org/unstable/mail/greylistd"
depends=('python2' 'start-stop-daemon')
source=(http://ftp.debian.org/debian/pool/main/g/greylistd/${pkgname}_${pkgver}.tar.gz
	greylistd.sh
	python2.patch)
md5sums=('8801255264729a20afcebcfbaf28d3f8'
         '2bc6867f956934876466ac89af8057d6'
         '278bd11eebf4faeff4847cbf76f75335')
backup=(etc/greylistd/config)
install=greylistd.install
arch=('x86_64' 'i686')
license=('GPL')

build() {
	cd $srcdir || return 1
	patch -p0 <python2.patch || return 1
}

package() {
	cd $srcdir

	mkdir -p $pkgdir/etc/greylistd || return 1
	install -D -m644 $srcdir/$pkgname/config/config $pkgdir/etc/greylistd || return 1
	install -D -m644 $srcdir/$pkgname/config/whitelist-hosts $pkgdir/etc/greylistd || return 1
	install -D -m644 $srcdir/$pkgname/doc/examples/exim4-acl-example.txt $pkgdir/etc/greylistd || return 1

	mkdir -p $pkgdir/pkg/etc/rc.d || return 1
	install -D -m755 $srcdir/greylistd.sh $pkgdir/etc/rc.d/greylistd || return 1

	mkdir -p $pkgdir/usr/man/man1 || return 1
	install -D -m644 $srcdir/$pkgname/doc/man1/greylist.1 $pkgdir/usr/man/man1/ || return 1
	gzip $pkgdir/usr/man/man1/greylist.1

	mkdir -p $pkgdir/usr/man/man8 || return 1
	install -D -m644 $srcdir/$pkgname/doc/man8/greylistd.8 $pkgdir/usr/man/man8/ || return 1
	gzip $pkgdir/usr/man/man8/greylistd.8

	mkdir -p $pkgdir/usr/bin || return 1
	install -D -m755 $srcdir/$pkgname/program/greylist $pkgdir/usr/bin/ || return 1

	mkdir -p $pkgdir/usr/sbin || return 1
	install -D -m755 $srcdir/$pkgname/program/greylistd $pkgdir/usr/sbin/ || return 1
}
