# Maintainer: Jaroslav Lichtblau <dragonlord@aur.archlinux.org>
# Contributor: Aaron Griffin <aaron@archlinux.org>
# Contributor: Tobias Kieslich <tobias_justdreams.de>

pkgname=muttng
pkgver=1.5.18
pkgrel=1
pkgdesc="A small but very powerful text-based mail client (well featured fork)"
arch=('i686' 'x86_64')
license=('GPL')
depends=('gpgme' 'gdbm')
makedepends=('gnupg' 'subversion' 'quilt')
url="http://mutt-ng.berlios.de/"
conflicts=('mutt')
provides=('mutt')
options=('!makeflags')
source=(ftp://ftp.mutt.org/mutt/devel/mutt-${pkgver}.tar.gz \
        http://codito.in/files/muttng/muttng-patchset.tar.bz2 \
        mutt_ImapCrashes.patch::"http://dev.mutt.org/trac/changeset/bba92e401440?format=diff&new=5401:bba92e401440")
md5sums=('27c30037120189b9f9c0d3e76361b8f8'
         'd59c5ee5181d308571a0ce3d926538bc'
         '86b7780410f787dc66ce8e6f7622eecc')

build() {
# prepare
#  cd ${srcdir}
#  svn co http://bereshit.synflood.at/svn/mutt-patches/trunk muttng-patchset
  cd ${srcdir}/mutt-$pkgver

  ln -s ../muttng-patchset/patches patches

#Thanks for the fix Tobias!
  sed -i "s/(expanded), cmd,/(expanded), 0, cmd,/" patches/debian.compressed.diff

  PATCH_GET="0"
  quilt push -a
  patch -p0 < ${srcdir}/mutt_ImapCrashes.patch || return 1

  ./prepare --prefix=/usr --sysconfdir=/etc \
    --enable-pop --enable-smtp --enable-imap --enable-pgp --enable-compressed \
    --enable-nntp --with-regex --with-ssl=/usr --enable-gpgme --with-gpgme-prefix=/usr \
    --enable-hcache --without-idn --with-sasl || return 1

  make || return 1
  make DESTDIR=${pkgdir} install
  rm -rf ${pkgdir}/etc/mime.types
}
