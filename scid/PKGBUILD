# Maintainer: Luis Sarmiento < Luis.Sarmiento-ala-nuclear.lu.se >

pkgname=scid
_pkgname=Scid
pkgver=4.4
pkgrel=1
pkgdesc="A Free Chess Database Application"
url="http://scid.sourceforge.net"
arch=('x86_64' 'i686')
license=('GPL')
depends=('tk' 'python') #tk depends on tcl
options=('!emptydirs')

source=("$pkgname-$pkgver.tar.bz2::http://prdownloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2?download"
  "http://a.fsdn.com/con/icons/sc/scid%40sf.net/scid.png")
md5sums=('be14e3f4317d6b8799ef32505499e79f'
         'd1994a0f57295c1d3857129de7ee0abb')
build() {
#  _TCL_VER=`pacman -Q tcl | cut -f2 -d" " | cut -f1-2 -d"."`
#  msg "Compiling ${pkgname} using Tcl version ${_TCL_VER}"
  cd ${srcdir}/${pkgname}-${pkgver}
#  patch -Np2 < ${srcdir}/configure_tclversion.patch
  ./configure BINDIR=${pkgdir}/usr/bin SHAREDIR=${pkgdir}/usr/share/${pkgname} #TCL_VERSION=${_TCL_VER}
  make
}

package () {
  cd ${srcdir}/${pkgname}-${pkgver}
  make install
  msg "Creating Desktop file"
  install -Dm644 ${srcdir}/scid.png ${pkgdir}/usr/share/scid/scid.png
  echo "
[Desktop Entry]
Version=1.0
Name=${_pkgname}
Comment=${pkgdesc}
Exec=${pkgname}
Icon=/usr/share/${pkgname}/scid.png
Categories=Game;BoardGame;
Type=Application
Terminal=false
StartupNotify=false
" > $srcdir/$pkgname.desktop

  install -Dm644 $srcdir/$pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop

  msg "Fixing some permission issues"
  chmod -R a-w ${pkgdir}/usr/share/scid/books
}
