# Maintainer: Daniel Wallace <danielwallace at gtmanfred dot com>
pkgname=openstack-guest-agents-unix-git
pkgver=470.f3d2b01
pkgrel=1
pkgdesc="This is the Unix Guest Agent for Openstack"
arch=('i686' 'x86_64')
url="https://github.com/rackerlabs/openstack-guest-agents-unix"
license=('GPL')
depends=('python2-simplejson' 'python2-crypto' 'patchelf')
#checkdepends=('python2-pyxenstore')
makedepends=('git' 'python2-pyxenstore')
source=("$pkgname::git://github.com/gtmanfred/${pkgname%-git}"
        "fix_format_error.patch")

pkgver(){
  echo $(git --git-dir=$srcdir/$pkgname/.git rev-list --count HEAD).$(git --git-dir=$srcdir/$pkgname/.git rev-parse --short HEAD)
}

prepare(){
  mkdir "$srcdir/$pkgname/m4"
  find "$srcdir/" -name \*.py -exec sed -i '1s/python$/&2/' {} +
  #patch -d "$srcdir/$pkgname" -Np1 -i "$srcdir/fix_format_error.patch"
}

build() {
  cd "$srcdir/$pkgname"
  sh autogen.sh
  ./configure CC=gcc
  make
}

#check(){
#  make -C "$srcdir/$pkgname" check || return 0
#}

package() {
  make -C "$srcdir/$pkgname" DESTDIR="$pkgdir/" install-data
  make -C "$srcdir/$pkgname/lib" DESTDIR="$pkgdir/" install
  make -C "$srcdir/$pkgname/src" DESTDIR="$pkgdir/" install
}

# vim:set ts=2 sw=2 et:
md5sums=('SKIP'
         'ddefa6df408de2d25a71d16f68449fa7')
