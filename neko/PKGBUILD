# Maintainer: Dwight Schauer <dschauer at gmail dot com>
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Michael 'manveru' Fellinger <m.fellinger@gmail.com>

pkgname=neko
pkgver=1.8.2
pkgrel=1
pkgdesc="A high-level language which can also be used as an embedded scripting language"
url="http://nekovm.org"
license=('LGPL')
arch=('x86_64' 'i686')
depends=('gc' 'gtk2' 'libmysqlclient' 'apr')
makedepends=('pkgconfig' 'apache')
options=('!strip')
source=(http://nekovm.org/_media/$pkgname-$pkgver.tar.gz neko_mod.patch)

build() {
  cd $pkgname-$pkgver

  sed 's|= -Wall -O3|+=|g;s|-mkdir|mkdir -p|g;/strip/d' -i Makefile
  mkdir -p bin

  [ "$CARCH" = "x86_64" ] && export CFLAGS+=" -D_64BITS"

  sed \
	-e s,apr.h,apr-1/apr.h, \
	-e s,httpd.h,httpd/httpd.h, \
	-e 's,fPIC,fPIC -I/usr/include/apr-1 -I/usr/include/httpd,' \
	-i src/tools/install.neko

  #patch -p0 -i $srcdir/neko_mod.patch

  make clean
  make libneko || return 1
  make neko std || return 1
  make || return 1

  install -d "$pkgdir"/usr/{bin,lib}
  make INSTALL_PREFIX="$pkgdir"/usr install

  find "$pkgdir"/usr/lib -type f -exec chmod 644 {} \;
}

sha256sums=('3cfcc73a665559df97126b172510ccff934325d6703d76c74fc8cc66f8112725'
            'e2f534602f2326433ff24c8cd3394d736fe01bec79142ae2ee3d65c302eba475')
