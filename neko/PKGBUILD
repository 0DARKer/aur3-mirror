# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Michael 'manveru' Fellinger <m.fellinger@gmail.com>

pkgname=neko
pkgver=1.8.1
pkgrel=1
pkgdesc="A high-level language which can also be used as an embedded scripting language"
url="http://nekovm.org"
license=('LGPL')
arch=('x86_64' 'i686')
depends=('gc' 'gtk2' 'libmysqlclient')
makedepends=('pkgconfig' 'apache')
options=('!strip')
source=(http://nekovm.org/_media/$pkgname-$pkgver.tar.gz neko_mod.patch)
md5sums=('0e2029465a49e1da929f0e254c017701' '8383f4dc6c3098f066c6db4df7d1e0e5')

build() {
  cd $pkgname-$pkgver

  sed 's|= -Wall -O3|+=|g;s|-mkdir|mkdir -p|g;/strip/d' -i Makefile
  mkdir -p bin

  [ "$CARCH" = "x86_64" ] && export CFLAGS+=" -D_64BITS"

  patch -p0 -i $srcdir/neko_mod.patch

  make clean
  make libneko || return 1
  make neko std || return 1
  make || return 1

  install -d "$pkgdir"/usr/{bin,lib}
  make INSTALL_PREFIX="$pkgdir"/usr install

  find "$pkgdir"/usr/lib -type f -exec chmod 644 {} \;
}

