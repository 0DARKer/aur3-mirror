# Maintainer: Dwight Schauer <dschauer at gmail dot com>
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Michael 'manveru' Fellinger <m.fellinger@gmail.com>

pkgname=neko
pkgver=1.8.2
pkgrel=2
pkgdesc="A high-level language which can also be used as an embedded scripting language"
url="http://nekovm.org"
license=('LGPL')
arch=('x86_64' 'i686')
depends=('gc' 'gtk2' 'libmysqlclient')
makedepends=('pkgconfig')
options=('!strip')
source=(http://nekovm.org/_media/$pkgname-$pkgver.tar.gz neko_mod.patch)

build() {
  cd $pkgname-$pkgver

  sed 's|= -Wall -O3|+=|g;s|-mkdir|mkdir -p|g;/strip/d' -i Makefile
  mkdir -p bin

  [ "$CARCH" = "x86_64" ] && export CFLAGS+=" -D_64BITS"

  patch -p0 -i $srcdir/neko_mod.patch --verbose

  make clean
  make libneko || return 1
  make neko std || return 1
  make || return 1

  install -d "$pkgdir"/usr/{bin,lib}
  make INSTALL_PREFIX="$pkgdir"/usr install

  find "$pkgdir"/usr/lib -type f -exec chmod 644 {} \;
}

sha256sums=('3cfcc73a665559df97126b172510ccff934325d6703d76c74fc8cc66f8112725'
            'b84765649668b3c719e71eba91aea0a7936edf9caf6c131b46bb6a441771a2c1')
