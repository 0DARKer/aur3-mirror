# Maintainer: Shanto <shanto@hotmail.com>

pkgname=groupvpn
pkgver=9.5.20
pkgrel=2
pkgdesc="GroupVPN is a group based implementation of the ACIS P2P stack. Much better than the currently broken Hamachi."
arch=('i686' 'x86_64')
url="https://www.grid-appliance.org/wiki/index.php/GroupVPN"
license=('GPL')
depends=('mono' 'uml_utilities' 'cronolog' 'python2')
#optdepends=()
makedepends=('unzip')
conflicts=()
provides=()
install=${pkgname}.install
source=(
	http://www.grid-appliance.org/files/ipop/acisp2p.${pkgver}.zip
	groupvpn.patch
)
build() {
	cd $srcdir/acisp2p
	
	patch -p1 -i ${srcdir}/groupvpn.patch
	
	mkdir -p ${pkgdir}/opt/${pkgname}/{bin,etc,lib,var}
	cp ./bin/*.exe ${pkgdir}/opt/${pkgname}/bin/
	cp ./bin/*.dll ${pkgdir}/opt/${pkgname}/lib/
	cp ./bin/*.py ${pkgdir}/opt/${pkgname}/bin/
	cp ./bin/*.sh ${pkgdir}/opt/${pkgname}/bin/
	cp ./config/ipop.vpn.config ${pkgdir}/opt/${pkgname}/etc/
	cp ./config/Log.config ${pkgdir}/opt/${pkgname}/bin/DhtIpopNode.exe.config
	
	mkdir -p ${pkgdir}/{etc/rc.d,usr/sbin}
	ln -sf /opt/${pkgname}/bin/groupvpn_prepare.sh ${pkgdir}/usr/sbin/groupvpn-prepare
	ln -sf /opt/${pkgname}/bin/groupvpn.sh ${pkgdir}/etc/rc.d/groupvpn
	ln -sf /opt/${pkgname}/bin/groupvpn_bootstrap.sh ${pkgdir}/etc/rc.d/groupvpn-bootstrap
	ln -sf /opt/${pkgname}/etc/ipop.vpn.config ${pkgdir}/etc/
}
md5sums=(
	'ccd8f835d72a24c5515c724e78463544'
        '06e51188dbc971201e6c7cbabe7557c5'
)
