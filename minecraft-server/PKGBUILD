# Maintainer: Isaac C. Aronson <isaac at pingas dot org>

pkgname=minecraft-server
pkgver=1.8
pkgrel=1
pkgdesc="Minecraft server unit files, script, and jar"
arch=(any)
url="http://minecraft.net/"
license=('custom')
depends=('java-runtime-headless' 'systemd' 'screen' 'expect')
conflicts=('minecraft-server-systemd' 'minecraft-canary')
options=(emptydirs)
install=minecraft-server.install
backup=('etc/conf.d/minecraft')
source=(https://s3.amazonaws.com/Minecraft.Download/versions/$pkgver/minecraft_server.$pkgver.jar
        minecraftd
        minecraftd-diag
        minecraftd.service
	minecraftctl
	conf.minecraft)
noextract=("minecraft_server.$pkgver.jar")  
sha256sums=('40e23f3823d6f0e3cbadc491cedb55b8ba53f8ab516b68182ddd1536babeb291'
            'c5b2f89457e72bef0fa2daa3a2ba0094047fd14852b756a2319f42ec7920d022'
            'de03317d02668bb71ec160fff497c7fbfe8b03ffff2950c6a0bcfb39f69cd214'
            '6a28d6a04feee4eb055b9d2d302645660f863291bd1f36e3a7986330131adb81'
            'a65bf7c1243569daa3c9297dcf35bafa884e1a209060c6afc9a544ba87dda476'
            '738e10185df160d190a5f4f0226de110d67ba023877e4999a6d3ef41c9918ed6')

package() {
  install -Dm755 "$srcdir/minecraftd" "$pkgdir/usr/bin/minecraftd"
  install -Dm755 "$srcdir/minecraftd-diag" "$pkgdir/usr/bin/minecraftd-diag"
  install -Dm755 "$srcdir/minecraftctl" "$pkgdir/usr/bin/minecraftctl"
  
  install -Dm644 "$srcdir/minecraft_server.$pkgver".jar "$pkgdir/srv/minecraft/minecraft_server.$pkgver".jar
  ln -s "minecraft_server.$pkgver.jar" "$pkgdir/srv/minecraft/minecraft_server.jar"
  install -Dm644 "$srcdir/minecraftd.service" "$pkgdir/usr/lib/systemd/system/minecraftd.service"
  install -Dm644 "$srcdir/conf.minecraft" "$pkgdir/etc/conf.d/minecraft"

  install -d "$pkgdir/srv/minecraft/backup"
}
