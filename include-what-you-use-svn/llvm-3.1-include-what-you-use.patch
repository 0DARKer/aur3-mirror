--- llvm-3.1.src/tools/clang/tools/Makefile	2012-10-22 21:10:01.186324001 +0300
+++ llvm-3.1.src/tools/clang/tools/Makefile	2012-10-22 21:10:16.522908700 +0300
@@ -9,7 +9,7 @@
 
 CLANG_LEVEL := ..
 DIRS := driver libclang c-index-test arcmt-test c-arcmt-test diagtool \
-        clang-check
+        clang-check include-what-you-use
 
 include $(CLANG_LEVEL)/../../Makefile.config
 
--- llvm-3.1.src/tools/clang/tools/CMakeLists.txt	2012-10-22 21:12:24.132235128 +0300
+++ llvm-3.1.src/tools/clang/tools/CMakeLists.txt	2012-10-22 21:12:44.365460121 +0300
@@ -5,3 +5,4 @@
 add_subdirectory(diagtool)
 add_subdirectory(driver)
 add_subdirectory(clang-check)
+add_subdirectory(include-what-you-use)
--- llvm-3.1.src/utils/llvm-build/llvm-build	2012-10-22 21:14:58.148087630 +0300
+++ llvm-3.1.src/utils/llvm-build/llvm-build	2012-10-22 21:15:01.888067419 +0300
@@ -1,4 +1,4 @@
-#!/usr/bin/env python
+#!/usr/bin/env python2
 
 import llvmbuild
 
Index: iwyu.cc
===================================================================
--- llvm-3.1.src/tools/clang/tools/include-what-you-use/iwyu.cc	(revision 374)
+++ llvm-3.1.src/tools/clang/tools/include-what-you-use/iwyu.cc	(working copy)
@@ -3659,7 +3659,7 @@ class IwyuAction : public ASTFrontendAct
         = new IwyuAstConsumer(visitor_state);
 
     compiler.getPreprocessor().addPPCallbacks(preprocessor_consumer);
-    compiler.getPreprocessor().addCommentHandler(preprocessor_consumer);
+    compiler.getPreprocessor().AddCommentHandler(preprocessor_consumer);
     return ast_consumer;
   }
 };
Index: iwyu_include_picker.cc
===================================================================
--- llvm-3.1.src/tools/clang/tools/include-what-you-use/iwyu_include_picker.cc	(revision 374)
+++ llvm-3.1.src/tools/clang/tools/include-what-you-use/iwyu_include_picker.cc	(working copy)
@@ -192,13 +192,12 @@ vector<string> GetSequenceValue(Node* no
 // infrastructure, for colored output, etc.
 string MappingDiag(const SourceMgr& source_manager,
     const string& filename, const Node& node, const char* message) {
-  pair<unsigned, unsigned> printable_loc
-    = source_manager.getLineAndColumn(node.getSourceRange().Start);
+  unsigned line = source_manager.FindLineNumber(node.getSourceRange().Start);
 
   string buf;
   llvm::raw_string_ostream os(buf);
   os << filename << ":"
-    << printable_loc.first << ":" << printable_loc.second << ": "
+    << line << ": "
     << message;
 
   return os.str();
