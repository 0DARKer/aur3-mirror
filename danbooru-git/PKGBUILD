# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname=danbooru-git
pkgver=20101025
pkgrel=1
pkgdesc="Application to access Danbooru-based image boards."
url="http://www.dennogumi.org/projects/danbooru-client"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('kdebase-lib' 'kdebindings-python' 'python2')
makedepends=('git')
conflicts=('danbooru-client')
_gitroot="git://gitorious.org/danbooru-client/danbooru-client.git"
_gitname="danbooru-client"


build() {
   cd $srcdir
   msg "Connecting to GIT server...."

   if [ -d $srcdir/$_gitname ] ; then
  	cd $_gitname && git pull origin
  	msg "The local files are updated."
   else
  	git clone $_gitroot
   fi

   msg "GIT checkout done or server timeout"
   msg "Starting make..."

   cp -r ${srcdir}/$_gitname ${srcdir}/$_gitname-build

   cd ./$_gitname-build

   # python2 fix
   for file in $(find . -name '*.py' -print); do
   sed -i 's_^#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
   done

   cmake -DCMAKE_INSTALL_PREFIX=`kde4-config --prefix`
   make
   make DESTDIR=$pkgdir install
}