# Mantainer: William Diaz <wdiaz [at] archlinux [dot] us>

pkgname=coreboot-git
pkgver=20100503
pkgrel=1
pkgdesc="The Funtoo Core Boot Framework provides a unified mechanism for configuring the GRUB 1.9x and GRUB 0.97 boot loaders."
arch=("i686" "x86_64")
url="http://funtoo.org/en/funtoo/core/boot/"
license=("GPL3")
depends=("python")
makedepends=("git")
install="${pkgname}.install"
source=(boot.conf.example
        http://www.funtoo.org/archive/grub/grub-unifont-1.0.tar.bz2)
md5sums=('c3550aefc8a826d4ce65b6f44f3e1ba2'
         '568d7d4a0938d950f6b3596b6c658b21')


_gitroot=http://github.com/funtoo/coreboot.git
_gitname=coreboot


build() {
  cd "${srcdir}"

  msg "Connecting to GIT server over HTTP..."
  if [[ -d "${_gitname}" ]]; then
      (cd "${_gitname}" && git pull origin)
      msg "The local repository was updated."
  else
      git clone "${_gitroot}" "${_gitname}"
      msg "The remote repository was cloned."
  fi
  msg "GIT sync done or server timeout."

  # Install Python Modules
  install -d "${pkgdir}"/usr/lib/python2.6/site-packages/
  cp -R "${_gitname}"/python/modules/funtoo "${pkgdir}"/usr/lib/python2.6/site-packages/ || return 1

  # Install bin
  install -d "${pkgdir}"/sbin
  install "${_gitname}"/sbin/boot-update "${pkgdir}"/sbin || return 1

  # Documentation
  install -d "${pkgdir}"/etc
  install -m644 "${srcdir}"/boot.conf.example "${pkgdir}"/etc || return 1

  install -d  "${pkgdir}"/usr/share/doc/"${_gitname}"
  install -m644 "${_gitname}"/doc/*.rst "${pkgdir}"/usr/share/doc/"${_gitname}" || return
  install -m644 "${srcdir}"/boot.conf.example "${pkgdir}"/usr/share/doc/"${_gitname}" || return 1

  install -d "${pkgdir}"/usr/share/man/{man8,man5} || return
  [ -e "${_gitname}"/doc/boot.conf.5 ] && gzip "${_gitname}"/doc/boot.conf.5
  [ -e "${_gitname}"/doc/boot-update.8 ] &&  gzip "${_gitname}"/doc/boot-update.8
  install -m644 "${_gitname}"/doc/boot.conf.5.gz "${pkgdir}"/usr/share/man/man5
  install -m644 "${_gitname}"/doc/boot-update.8.gz "${pkgdir}"/usr/share/man/man8

  # Install Unifont
  tar xf "${srcdir}"/grub-unifont-1.0.tar.bz2 || return 1
  cp -R "${srcdir}"/boot "${pkgdir}" || return 1
}
