# Maintainer: Semitsoglou-Tsiapos Dimitrios <madcatmk254 [at] gmail [dot] com>

pkgname=ptokax
pkgver=0.4.1.2
pkgrel=2
pkgdesc="A Direct Connect Hub; a multi-platform server application for Neo-Modus Direct Connect Peer-To-Peer sharing network. "
arch=('i686' 'x86_64')
url="http://www.ptokax.org"
license=('GPLv3')
depends=('tinyxml')
makedepends=('make' 'gcc' 'zlib' 'lua' 'patch')
install=ptokax.install
source=(http://www.czdc.org/PtokaX/$pkgver-nix-src.tgz http://downloads.sourceforge.net/project/tinyxml/tinyxml/2.6.1/tinyxml_2_6_1.tar.gz ptokax.patch ptokax64.patch tinyxml.patch)
md5sums=('d8d896a86c316aaf586315dd6bb134ec'
         'adb56a2a5cceb53141c5fb67f53a096d'
         'c9c66bada575022e633fee8892a85b9c'
         '2ee96c94d4450045c074e39edbc263fe'
         '2baa9bc24e50532fd49bb2656cd97336')

build() {
#copy and patch tinyxml files
  cp -rn $srcdir/tinyxml $srcdir/PtokaX
  cp $srcdir/tinyxml.patch $srcdir/PtokaX/tinyxml
  cd $srcdir/PtokaX/tinyxml
  patch -i tinyxml.patch

#make local tinyxml
  cd $srcdir/PtokaX/tinyxml
  make

#patch makefile of ptokax
cd $srcdir/PtokaX

if [ $CARCH = 'i686' ] ;
then
  cp $srcdir/ptokax.patch $srcdir/PtokaX
  patch -i ptokax.patch
else
  cp $srcdir/ptokax64.patch $srcdir/PtokaX
  patch -i ptokax64.patch
fi

#make ptokax
  cd $srcdir/PtokaX
  make || return 1
}

package() {
cd $srcdir/PtokaX

mkdir -p $pkgdir/opt/ptokax || return 1
  cp -r cfg.example $pkgdir/opt/ptokax/cfg.example || return 1
    chmod 666 $pkgdir/opt/ptokax/cfg.example/* || return 1
  cp -r language $pkgdir/opt/ptokax/language || return 1
    chmod 666 $pkgdir/opt/ptokax/language/* || return 1
  cp -r ico $pkgdir/opt/ptokax/ico || return 1
    chmod 666 $pkgdir/opt/ptokax/ico/* || return 1

mkdir -p $pkgdir/usr/share/doc/ptokax/scripting.docs/scripting-interface.html || return 1
  cp -r scripting.docs $pkgdir/usr/share/doc/ptokax/scripting.docs || return 1
   chmod 666 $pkgdir/usr/share/doc/ptokax/scripting.docs
   chmod 666 $pkgdir/usr/share/doc/ptokax/scripting.docs/* || return 1
   chmod 666 $pkgdir/usr/share/doc/ptokax/scripting.docs/*/* || return 1
  cp *.txt $pkgdir/usr/share/doc/ptokax || return 1
   chmod 666 $pkgdir/usr/share/doc/ptokax/*.txt || return 1

mkdir -p $pkgdir/usr/bin
  cp PtokaX $pkgdir/opt/ptokax/
  chmod 755 $pkgdir/opt/ptokax/PtokaX 
  ln -sv $pkgdir/opt/ptokax/PtokaX $pkgdir/usr/bin/ptokax
}