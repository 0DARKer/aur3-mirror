# Contributor: mickele
pkgname=parmetis3
pkgver=3.2.0
pkgrel=1
pkgdesc="A parallel graph partitioning library"
url="http://glaros.dtc.umn.edu/gkhome/metis/parmetis/overview"
arch=('i686' 'x86_64')
provides=('metis4')
conflicts=('metis4')
license="custom"
depends=(openmpi)
makedepends=()
source=("http://glaros.dtc.umn.edu/gkhome/fetch/sw/parmetis/ParMetis-${pkgver}.tar.gz"
	"cmake.tar.gz" )

build() {
  cd ${srcdir}

  msg "Copying CMake files..."
  tar -zxvf cmake.tar.gz
  cp ${srcdir}/cmake/CMakeLists.txt          ${srcdir}/ParMetis-${pkgver}/
  cp ${srcdir}/cmake/METISLib/CMakeLists.txt      ${srcdir}/ParMetis-${pkgver}/METISLib
  cp ${srcdir}/cmake/ParMETISLib/CMakeLists.txt      ${srcdir}/ParMetis-${pkgver}/ParMETISLib
  cp ${srcdir}/cmake/Programs/CMakeLists.txt ${srcdir}/ParMetis-${pkgver}/Programs

  cd "$srcdir/ParMetis-${pkgver}"

  msg "Running CMake..."
  mkdir -p build && cd build
  cmake -DCMAKE_INSTALL_PREFIX="/usr" ..

  msg "Compiling METIS..."
  make
}

package () {
  cd "$srcdir/ParMetis-${pkgver}/build"

  msg "Installing..."
  make install DESTDIR=${pkgdir}

  # Install license
  install -m644 -D "${srcdir}/ParMetis-${pkgver}/LICENSE.txt" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
md5sums=('d97fea8c8776e1f9340ff90d9992e929'
         '40fee35e3718a064948b355324bfb9a4')
