# Contributor: Stephane Travostino <stephane dot travostino at gmail>
pkgname=uwsgi-latest
_realname=uwsgi
pkgver=LATEST
pkgrel=1
pkgdesc="A fast (pure C), self-healing, developer-friendly WSGI server"
arch=('i686' 'x86_64')
url="http://projects.unbit.it/uwsgi/"
license=('GPL')
groups=()
depends=()
makedepends=('mercurial')
provides=("${_realname}")

_hgroot="http://projects.unbit.it/hg/uwsgi"
_hgname="uwsgi"

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [ -d $_hgname ] ; then
    cd $_hgname && hg pull && hg update
    msg "The local files are updated."
  else
    hg clone $_hgroot $_hgname
  fi

  msg "Mercurial checkout done or server timeout"
  cd $srcdir/$_hgname
  newpkgver=$(hg tip --template="{rev}")
  devel_update

  #
  # BUILD HERE
  #
  msg "Starting make..."
  make -f Makefile.Linux.Py26

  mkdir -p $pkgdir/usr/bin
  install -Dm755 uwsgi26 $pkgdir/usr/bin/uwsgi

} 
