--- Makefile.am_orig	2013-07-07 12:50:49.698886451 -0700
+++ Makefile.am	2013-07-07 12:57:30.271384925 -0700
@@ -1,19 +1,23 @@
 ACLOCAL_AMFLAGS = -I m4
 
+INCLUDES = $(MMDB_CFLAGS)
 lib_LTLIBRARIES = libssm.la
 libssm_la_SOURCES = ssm_superpose.cpp ssm_csia.cpp ssm_vxedge.cpp \
 		    ssm_align.cpp ssm_malign.cpp ssm_graph.cpp
-libssm_la_LIBADD = -lmmdb
+libssm_la_LIBADD = $(MMDB_LIBS)
 libssm_la_LDFLAGS = -no-undefined -version-info 1:0:0
 
 pkginclude_HEADERS = ssm_graph.h ssm_superpose.h ssm_csia.h ssm_vxedge.h \
                      ssm_align.h ssm_malign.h ssm_defs.h
 
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = ssm.pc
+
 bin_PROGRAMS = superpose
 superpose_SOURCES = superpose.cpp sup_pairwise.cpp sup_multiple.cpp \
                     sup_pairwise.h sup_multiple.h sup_defs.h
 superpose_LDADD = libssm.la -lmmdb
 if USE_LIBCCP4
-superpose_CPPFLAGS = -D_ccp4_
-superpose_LDADD += -lccp4c
+superpose_CPPFLAGS = -D_ccp4_ $(CCP4_CFLAGS)
+superpose_LDADD += $(CCP4_LIBS)
 endif
