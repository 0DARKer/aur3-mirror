# Maintainer: Vasily Ryabov <me@ryvasy.net>

pkgname=thunderbird-firetray
pkgver=0.2.6
pkgrel=1
pkgdesc="A system tray extension for linux. Installs globally for all users. Usefull as package when home mounted with noexec, because extension requires execute permission."
arch=('i686')
url="http://code.google.com/p/firetray/"
license=('GPL')
depends=('thunderbird')
source=(http://firetray.googlecode.com/files/firetray_$pkgver.xpi)
md5sums=('ff1d8c02ca78e60827dd16621db76900')
options=(!strip)

build() {
  THUNDERBIRD_FOLDERS=$(ls -la /usr/lib | awk '/thunderbird/' | wc -l)
  if [ $THUNDERBIRD_FOLDERS != "1" ];  then
    echo "Can't determine installation folder. Check /usr/lib to have one and only one folder with \"thunderbird\" in path."
    return 1
  else
    THUNDERBIRD_FOLDER=usr/lib/$(ls -la /usr/lib | awk '/thunderbird/ {print $9}')
    cd $srcdir
    EMID=$(sed -n '/.*<em:id>\(.*\)<\/em:id>.*/{s//\1/p;q}' install.rdf) || return 1
    ADDON_FOLDER=$pkgdir/$THUNDERBIRD_FOLDER/extensions/$EMID
    install -d $ADDON_FOLDER
    cp -a $srcdir/* $ADDON_FOLDER || return 1
    rm -f $ADDON_FOLDER/*.xpi || return 1
  fi
}