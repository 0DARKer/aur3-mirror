# Maintainer: Alexis Cassaigne <ordiclic@ordiclic.eu>

pkgname=kernel26-one-751h
_kernelname=-AAO751H
_basekernel=2.6.33-rc5
pkgver=2.6.33
pkgrel=2
pkgdesc="A customized kernel for the Acer Aspire One 751h netbook, that runs without init RAM Disk, with all necessary drivers built-in."
arch=(i686)
license=('GPL2')
url="http://www.kernel.org"
depends=('module-init-tools')
optdepends=('quick-init-751h: Activate KMS and faster boot')
provides=(kernel26)
install=kernel26.install
source=(.config ftp://ftp.kernel.org/pub/linux/kernel/v2.6/testing/linux-$_basekernel.tar.bz2)

md5sums=('647e34428a45b09de518226a5da17b04'
	'96e5a75f5bf6411fb0c7dbb587caec85')


build() {
  cd ${srcdir}/linux-$_basekernel
  cat ../.config >./.config

  if [ "${_kernelname}" != "" ]; then
    sed -i "s|CONFIG_LOCALVERSION=.*|CONFIG_LOCALVERSION=\"${_kernelname}\"|g" ./.config
  fi

#  make menuconfig -j3

  make -j3 || return 1
  mkdir -p $startdir/pkg/{lib/modules,boot}
  make -j3 INSTALL_MOD_PATH=$startdir/pkg modules_install || return 1
  rm -rf $startdir/pkg/lib/firmware
#  install -Dm644 "System.map-" "$startdir/pkg/boot/System.map26$LOCAL_VERSION"
  install -Dm644 "arch/x86/boot/bzImage" "$startdir/pkg/boot/${pkgname}"
  
  sed -i \
        -e "s/KERNEL_VERSION=.*/KERNEL_VERSION=\"$basekernel\"/" \
        -e "s/LOCAL_VERSION=.*/LOCAL_VERSION=\"$LOCAL_VERSION\"/" \
        $startdir/kernel26.install

}
