# Maintainer: shmilee <echo c2htaWxlZS56anVAZ21haWwuY29tCg==|base64 -d>

_pkgname=nbviewer
pkgname=python-nbviewer-git
pkgver=r813.c66d80f
pkgrel=1
pkgdesc="A webservice rendering ipynb to static HTML, the web application behind nbviewer.ipython.org"
arch=('any')
url="https://github.com/jupyter/nbviewer"
license=('BSD')
depends=('ipython>=3.0.0' 'python-tornado>=3.1.1' 'python-pycurl' 'python-markdown' 'python-elasticsearch' 'python-sphinx>=0.3' 'python-jsonschema' 'python-mistune')
# 'python-pygments' 'python-jinja' 'python2-futures'
makedepends=('invoke' 'nodejs-less' 'nodejs-bower')
optdepends=('python-pylibmc: improvement with memcache'
            'python-newrelic: New Relic performance monitoring')
options=(!emptydirs)
install=
source=("git+https://github.com/jupyter/${_pkgname}.git")
md5sums=('SKIP')

pkgver() {
  cd "$srcdir/${_pkgname}"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  cd "$srcdir/${_pkgname}"

  sed -i 's|^NPM_BIN.*$|NPM_BIN = "/usr/bin"|' tasks.py
  invoke bower

  cp -r /usr/lib/node_modules/less/ less
  cd less/
  npm install less-plugin-autoprefix less-plugin-clean-css --save-dev
  cd ..
  sed -i 's|^NPM_BIN.*$|NPM_BIN = os.path.join(APP_ROOT, "less", "bin")|' tasks.py
  invoke less
}

package() {
  cd "$srcdir/${_pkgname}"
  python setup.py install --root="$pkgdir/" --optimize=1
}

# vim:set ts=2 sw=2 et:
