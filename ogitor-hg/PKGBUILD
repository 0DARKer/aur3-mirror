# Maintainer: Sven-Hendrik Haase <sh@lutzhaase.com>
pkgname=ogitor-hg
pkgver=10
pkgrel=1
pkgdesc="scene editing framework for Ogre3D"
arch=('i686' 'x86_64')
url='http://www.ogitor.org'
license=('LGPL')
depends=('ogre' 'qt')
makedepends=('cmake' 'mercurial')
#optdepends=('cppunit: unit testing'
#            'doxygen: generate API docs')
conflicts=('ogitor')
provides=('ogitor')
source=()
md5sums=()

_hgtrunk="http://hg.ogitor.org/0.3"
_hgmod="ogitor"

build() {
  cd ${srcdir}

  if [ -d $_hgmod/.hg ]; then
    cd $_hgmod && hg pull -u || return 1
  else
    hg clone $_hgtrunk $_hgmod || return 1
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}
  if [ -d $_hgmod-build ]; then
	  rm -rf $_hgmod-build
  fi
  hg clone $_hgmod $_hgmod-build
  cd $_hgmod-build

  cd qtOgitor/qtpropertybrowser-2.5 && touch .licenseAccepted || return 1
  sh configure -library && qmake qtpropertybrowser.pro && make || return 1

  cd ${srcdir}/$_hgmod-build
  cmake . -DCMAKE_INSTALL_PREFIX=/usr
  make || return 1
  #make doc || return 1
  make DESTDIR=${pkgdir} install || return 1

  rm -rf ${srcdir}/$_hgmod-build
}
