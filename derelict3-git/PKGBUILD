pkgname=derelict3-git
pkgver=20120208
pkgrel=1
pkgdesc="Derelict3"
url=("https://github.com/aldacron/Derelict3")
arch=('i686' 'x86_64')
license=('Boost')
depends=('dmd')
makedepends=('git')
provides=('derelict')
conflicts=('derelict' 'derelict2-svn')

_gitroot="https://github.com/aldacron/Derelict3.git"
_gitname="Derelict3"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cd "$srcdir/$_gitname/build"

  dmd -ofderelict "derelict.d"
  ./derelict

  mkdir -p "$pkgdir/usr/"
  if [ -f "../lib/SAVEME.txt" ] ; then
    rm "../lib/SAVEME.txt"
  fi
  cp -r "../lib" "$pkgdir/usr/"

  mkdir -p "$pkgdir/usr/include/d2"
  cp -r "../import/derelict" "$pkgdir/usr/include/d2/"
}
