# Contributor: Loren <smallphrosty [a.t] gmail [t0d] com>

pkgname=chocolate-castle
pkgver=1.09
pkgrel=1
pkgdesc="Chocolate Castle is a tricky sliding block puzzle game."
arch=('i686' 'x86_64')
url='http://www.lexaloffle.com/choc.php'
groups=('humblebundles')
license=('custom: "commercial"')
source=(${pkgname}.bmp ${pkgname}.desktop ${pkgname}.launcher)
md5sums=('ce3b8bd4ab328405c10147e6bfeccc9b'
         '22498f99411e519c2239a52d28872e61'
         'a401a711742eb8501a52b793565b74d5')

if [[ $CARCH == x86_64 ]]; then
	depends=('lib32-libpulse' 'lib32-libgl' 'lib32-sdl')
else
	depends=('libpulse' 'libgl' 'sdl')
fi

_gamepkg="${pkgname}_${pkgver}_i386.tar.gz"

build() {
   cd ${srcdir}

   msg "You need a full copy of this game in order to install it"
   msg "Searching for ${_gamepkg} in dir: $(readlink -f `pwd`/..)"
   if [[ -f "../${_gamepkg}" ]]; then
       msg "Found game package, installing..."
	   ln -fs "../${_gamepkg}" .
   else
	   error "Game package not found, please type absolute path to ${_gamepkg} (/home/joe):"
       read pkgpath
       if [[ -f "${pkgpath}/${_gamepkg}" ]]; then
           msg "Found game package, installing..."
		   ln -fs "${pkgpath}/${_gamepkg}" .
	   else
		   error "Unable to find game package."
		   return 1
       fi
   fi

# Create Destination Directory
    install -d $pkgdir/opt/${pkgname}

# Extract Game 
    bsdtar -xf $srcdir/${_gamepkg}

# Install the data
    cp -r $srcdir/choc/* $pkgdir/opt/${pkgname}  

# Install Icon
    install -D -m 644 $srcdir/${pkgname}.bmp \
        $pkgdir/usr/share/pixmaps/${pkgname}.bmp 

# Install Launcher
    install -D -m 644 $srcdir/${pkgname}.desktop \
        $pkgdir/usr/share/applications/${pkgname}.desktop 

# Install Game Launcher
    install -D -m 755 $srcdir/${pkgname}.launcher \
    $pkgdir/usr/bin/choc 

# Set groupship to :games
    chown -R :games $pkgdir/opt/${pkgname} || return 1
    chmod -R g+rwX $pkgdir/opt/${pkgname} || return 1

}