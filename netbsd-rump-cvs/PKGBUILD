# Mantainer Jens Staal <staal1978@gmail.com>

pkgname=netbsd-rump-cvs
pkgver=20121125
pkgrel=1
pkgdesc="The NetBSD Anykernel"
arch=('i686' 'x86_64')
url="http://www.netbsd.org/docs/rump/"
license=('BSD')
depends=('zlib')
makedepends=('cvs')
provides=('rump')
source=('buildrump.sh-git20121125')
# from: https://github.com/anttikantee/buildrump.sh
md5sums=('856f2145086edb8b8fe210a20b1451ee')

_cvsroot=":pserver:anoncvs@anoncvs.netbsd.org:/cvsroot"
_cvsmod="src"

build() {
  cd "$srcdir"
  msg "Connecting to NetBSD CVS server...."
  if [ -d $_cvsmod/CVS ]; then
    cd $_cvsmod
    cvs -z3 update -d
  else
    cvs -z3 -d $_cvsroot co -P $_cvsmod
    cd $_cvsmod
  fi

  msg "CVS checkout done or server timeout"
  
  msg "Set up build directory to mantain pristine cvs"
  rm -rf "$srcdir/build"
  mkdir -p "$srcdir/build"
  cd "$srcdir/build"
  
  msg "Move latest build script into build directory"
  cp $startdir/buildrump.sh-git20121125 $srcdir/build/buildrump.sh
  chmod +x $srcdir/build/buildrump.sh
  
  cd $srcdir/build
  export NETBSDSRCDIR=$srcdir/$_cvsmod 
  ./buildrump.sh
}

package() {
  msg "make destination directories"
  mkdir -p $pkgdir/usr/{lib bin sbin include}
  
  msg "move to rump build OBJDIR"
  cd $srcdir/build

}
