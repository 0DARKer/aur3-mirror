# Maintainer: ava1ar <mail(at)ava1ar(dot)info>

pkgname=system76-driver
pkgver=14.04.0
pkgrel=1
pkgdesc="System76 Laptops Driver. Tested on System76 Galago UltraPro."
arch=('any')
url="https://www.system76.com/"
license=('GPL')
depends=('python>=3.4' 'python-gobject' 'dmidecode' 'python-dbus')
optdepends=(
	'pm-utils: To enable powersaving features'
	'pulseaudio: To apply microphone fix'
	'colord: To use ICC color profile for display'
)
makepdepends=('patch')
install="${pkgname}.install"
source=(
	"https://launchpad.net/~system76-dev/+archive/stable/+files/${pkgname}_${pkgver}.tar.gz"
	'arch_galu1.patch'
	'system76.service'
)
sha1sums=(
	'11f4cc8e43f5ea50105ef27ad2b5ae0819078777'
	'e68de1c31f6e9dbca6182c9088c3a63f72e206a5'
	'cf763432441c3da0563eee041145a02109f2bb3a'
)

package() {
	cd ${srcdir}/${pkgname}-${pkgver}
	# system76-daemon
	install -m644 -D system76-daemon ${pkgdir}/usr/lib/${pkgname}/system76-daemon
	# system76-driver-pkexec
	install -m755 -D system76-driver-pkexec ${pkgdir}/usr/bin/system76-driver-pkexec
	# systemd service
	install -m644 -D ${startdir}/system76.service ${pkgdir}/usr/lib/systemd/system/system76.service
	# python module
	python setup.py install --prefix=/usr --root=${pkgdir} --optimize=1
	cd ${pkgdir} &&	patch --no-backup-if-mismatch -Np1 -i ${srcdir}/arch_galu1.patch 
	# some cleanup
	rm -rf ${pkgdir}/usr/lib/python3.4/site-packages/system76driver/tests/
} 
