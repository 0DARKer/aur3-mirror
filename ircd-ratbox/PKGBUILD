# Contributor: Marcus Carlsson <carlsson.marcus@gmail.com>
# Updated and ported to a stable release by <prurigro@gmail.com>
pkgname=ircd-ratbox
pkgver=3.0.8
pkgrel=3
pkgdesc="ircd-ratbox irc daemon"
url="http://www.ircd-ratbox.org/"
license="GPL2"
depends=('openssl')
arch=('i686' 'x86_64')
install='ircd-ratbox.install'
backup=(etc/ircd-ratbox/ircd.motd)

source=("http://www.ratbox.org/download/${pkgname}-$pkgver.tar.bz2"
        "ircd-ratbox.service")
sha1sums=('544a94032ec700897204acd50ca176539f731b05'
          '2ae65a5d598db3def7d9ad4c6279baf3e7148c83')

build() {
    cd "$srcdir/${pkgname}-$pkgver"
    ./configure --prefix=/usr/share/ircd-ratbox \
    --with-confdir=/etc/ircd-ratbox \
    --with-logdir=/var/log/ircd-ratbox \
    --bindir=/usr/bin

    make
    pushd contrib/ && make && popd
}

package() {
    cd "$srcdir/${pkgname}-$pkgver"
    install -d "$pkgdir/etc/${pkgname}"
    make DESTDIR="$pkgdir" install

    install -d "$pkgdir/var/log/ircd-ratbox"
    install -d "$pkgdir/usr/share/${pkgname}/modules/contrib/"
    cp contrib/.libs/*.so $pkgdir/usr/share/${pkgname}/modules/contrib/
    install -D -m644 "$srcdir/ircd-ratbox.service" "$pkgdir"/usr/lib/systemd/system/ircd-ratbox.service
}
