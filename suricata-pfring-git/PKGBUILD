# Maintainer: Thomas Marchsteiner <tommy[0x2e]m86[0x40]gmail[0x2e]com>
pkgname=suricata-pfring-git
_pkgname=oisf
pkgver=20150208
pkgrel=1
pkgdesc="A NextGen multithreaded IDS/IPS with pf_ring, JSON Output and GeoIP support"
arch=('i686' 'x86_64')
url="http://openinfosecfoundation.org/index.php/download-suricata"
license=('GPL2')
depends=('libcap-ng' 'libnet' 'libpfring-svn' 'libyaml' 'pcre' 'jansson' 'geoip'  'libnfnetlink' 'python' 'libpcap-pfring-svn' 'libhtp-git') 
optdepends=('snort: suricata can use rulesets provided by snort' 'coccinelle')
makedepends=('autoconf' 'make' 'pkg-config' 'git')
backup=('etc/suricata/suricata.yaml')
conflicts=('suricata' 'suricata-dev')
provides=('suricata')
source=('git+git://phalanx.openinfosecfoundation.org/oisf.git')
sha1sums=('SKIP')

build() {

        cd "${srcdir}"/$_pkgname
        ./autogen.sh
        sed -i s/pfring_recv_chunk=\"no\"/pfring_recv_chunk=\"yes\"/ configure
        LIBS="-lrt -lnuma" ./configure --prefix=/usr \
        --sysconfdir=/etc --localstatedir=/var \
        --enable-pfring --enable-geoip --enable-non-bundled-htp \
#        --with-libpcap-includes=/usr/include/libpcap  --with-libpcap-libraries=/usr/lib/libpcap
        make
}

package() {
        cd "${srcdir}"/$_pkgname
        make DESTDIR="${pkgdir}" install

        install -d "${pkgdir}"/etc/suricata/rules
        install -d "${pkgdir}"/var/log/suricata
        install -d "${pkgdir}"/run/suricata
        install -Dm644 suricata.yaml "${pkgdir}"/etc/suricata/suricata.yaml
        install -Dm644 classification.config "${pkgdir}"/etc/suricata/classification.config
        install -Dm644 reference.config "${pkgdir}"/etc/suricata/reference.config
        
        install -d  ${pkgdir}/usr/share/licenses/${pkgname}
        install -d  ${pkgdir}/usr/share/doc/${pkgname}
        install -Dm644 ${srcdir}/${_pkgname}/LICENSE $pkgdir/usr/share/licenses/${pkgname}/LICENSE
        install -Dm644 ${srcdir}/${_pkgname}/ChangeLog $pkgdir/usr/share/doc/suricata/ChangeLog

}
