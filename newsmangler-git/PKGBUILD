# Maintainer: dryes <joswiseman@gmail>
pkgname=newsmangler-git
pkgver=20110117
pkgrel=1
pkgdesc="NNTP binary poster with mulitple connection support."
url="http://github.com/madcowfred"
arch=('any')
license=('Custom')
depends=('par2cmdline' 'python2' 'python-yenc')
optdepends=('mysql' 'postgresql' 'sqlite')
makedepends=('git')
install=('newsmangler.install')

_gitroot="git://github.com/madcowfred/newsmangler.git"
_gitname="newsmangler"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
}

package() {
  mkdir -p "$pkgdir/opt" && cp -r "$srcdir/newsmangler" "$pkgdir/opt"
  rm -rf "$pkgdir/opt/newsmangler/.git" "$pkgdir/opt/newsmangler/.gitignore"

  for _py in "$pkgdir/opt/newsmangler/leecher.py" "$pkgdir/opt/newsmangler/poster.py"; do
    sed -i 's/usr\/bin\/env python/usr\/bin\/python2/' "$_py"
  done

  find "$pkgdir/opt/newsmangler" -type d -exec chmod 755 {} \;
  find "$pkgdir/opt/newsmangler" -type f -exec chmod 644 {} \;
  chmod +x "$pkgdir/opt/newsmangler/leecher.py" "$pkgdir/opt/newsmangler/poster.py"
}