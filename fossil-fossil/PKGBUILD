# Maintainer: Daniel YC Lin <dlin.tw at gmail>
# vim:et sw=2 ts=2:

pkgname="fossil-fossil"
_pkgname=fossil
pkgver=20121220
pkgrel=2
pkgdesc="Simple, high-reliability, distributed software configuration management"
arch=('i686' 'x86_64')
license=('BSD')
url="http://www.fossil-scm.org"
depends=('openssl')
makedepends=('fossil')
conflicts=('fossil')
provides=('fossil')
source=("fossil-xinetd" "bash.completion")

_gitroot=GITURL
_gitname=MODENAME

build() {
  if [[ -f fossil.fsl ]]; then
    fossil pull http://www.fossil-scm.org -R fossil.fsl
  else
    fossil clone http://www.fossil-scm.org fossil.fsl
  fi

  rm -rf fossil-build
  mkdir fossil-build
  cd fossil-build
  fossil open ../fossil.fsl
  ./configure --prefix=/usr
  # headers and translate targets are problematic with parallel jobs
  make -j1 bld bld/headers
  make
}

package() {
  cd $srcdir/fossil-build
  install -Dm755 ${_pkgname} ${pkgdir}/usr/bin/${_pkgname}
  install -Dm644 COPYRIGHT-BSD2.txt \
          ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
  install -Dm644 $srcdir/fossil-xinetd $pkgdir/etc/xinetd.d/fossil
  install -Dm644 $srcdir/bash.completion $pkgdir/usr/share/bash-completion/completions/fossil
  # create symlink "/usr/bin/fsl" pointing to "/usr/bin/fossil"
  cd ${pkgdir}/usr/bin && ln -s ${_pkgname} fsl
}
md5sums=('62f6fb3739191b352c3e2995ced9be4e'
         '89117732cba1f34812feceb374ab9a5d')
