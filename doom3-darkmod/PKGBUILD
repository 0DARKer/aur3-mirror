# Maintainer: PedsXing <pedsxing at gmx dot net>
# Contributer: Hiroe <ashadocat at gmail dot com>

pkgname=doom3-darkmod
pkgver=1.03
pkgrel=1
pkgdesc="DOOM III mod based on the Thief series by Looking Glass Studios"
arch=('i686' 'x86_64')
url="http://www.thedarkmod.com/"
license=('CCPL')
depends=('doom3')
install=$pkgname.install
source=(http://www.bloodgate.com/mirrors/tdm/pub/pk4/tdm_update_linux.zip
        $pkgname.desktop
        $pkgname.png)
md5sums=('34ba2903fd77e4622dd6d6ff2b60e9a0'
         '28d7dfc73af7a215397a5eb0448297e4'
         '5309e528ce22f28ecc0e9781e43379e0')


build() {

  # Create destination directories
  install -d $pkgdir/opt/doom3/darkmod
  install -d $pkgdir/usr/bin
  install -d $pkgdir/usr/share/{applications,icons,licenses/$pkgname}

  # Download/Extract archive
  chmod +x tdm_update.linux
  ./tdm_update.linux || true

  # Install: game folder
  chmod +x tdmlauncher.linux
  cp -r * $pkgdir/opt/doom3/darkmod/

  # license(s)
  install -Dm644 LICENSE.txt $pkgdir/usr/share/licenses/$pkgname/

  # executable link
  ln -s /opt/doom3/darkmod/tdmlauncher.linux $pkgdir/usr/bin/$pkgname

  # desktop file, icon
  install -Dm644 $startdir/$pkgname.png $pkgdir/usr/share/icons
  install -Dm644 $startdir/$pkgname.desktop $pkgdir/usr/share/applications/
}
