# Maintainer: Sergei Lebedev <superbobry@gmail.com>
# Contributor: Sylvester Johansson <scj(at)archlinux(dot)us>
# Contributor: Nicolas Pouillard <nicolas(dot)pouillard(at)gmail(dot)com>
pkgname=ocaml-bin-prot
pkgver=2.0.5
pkgrel=3
pkgdesc="binary protocol generator for OCaml"
arch=('i686' 'x86_64')
url="https://forge.ocamlcore.org/projects/bin-prot"
license=('LGPL')
depends=('ocaml' 'ocaml-type-conv>=3.0.4')
makedepends=('ocaml-findlib')
source=(https://forge.ocamlcore.org/frs/download.php/693/bin-prot-$pkgver.tar.gz)
md5sums=('c9edda3416cf085bd1c569acaa669f02')
options=(!strip !makeflags)

build () {
  cd "$srcdir/bin-prot-$pkgver"

  ocaml setup.ml -configure --prefix /usr --destdir ${pkgdir} --disable-tests
  ocaml setup.ml -build || return 1
}

package () {
  cd "$srcdir/bin-prot-$pkgver"

  export OCAMLFIND_DESTDIR="${pkgdir}$(ocamlfind printconf destdir)"

  mkdir -p "$OCAMLFIND_DESTDIR/stublibs"
  ocaml setup.ml -install
  install -Dm 644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
