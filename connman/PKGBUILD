# Maintainer: Lucas De Marchi <lucas.de.marchi@gmail.com>

pkgname=connman
pkgver=0.76
pkgrel=3
pkgdesc="Wireless LAN network manager"
url="http://connman.net/"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('dbus-core' 'iptables' 'glib2')
conflicts=('openresolv')
optdepends=('bluez: Support for Bluetooth devices'
            'wpa_supplicant: For WiFi devices')
makedepends=('bluez' 'wpa_supplicant')
options=('!libtool')
source=("connmand-daemon"
	"0001-iptables-Work-around-API-breakage-introduced-in-ipta.patch"
	"0002-gsupplicant-set-the-cipher-even-if-security-is-WEP.patch"
	"0003-service-Fix-put-data-on-null-pointer.patch"
	"0004-network-Set-driver-pointer-to-NULL-back-if-not-ready.patch"
	"0005-ofono-Network-name-is-empty-when-operator-is-not-ava.patch"
	"http://www.kernel.org/pub/linux/network/${pkgname}/${pkgname}-${pkgver}.tar.bz2"
	"allow_group_network.diff"
	)

build() {
  cd ${srcdir}/${pkgname}-${pkgver}

  patch -Np1 -i ${srcdir}/allow_group_network.diff || return 1

  for i in $(seq 1 5); do
	  patch -Np1 -i ${srcdir}/000${i}-* || return 1
  done

  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	--enable-ethernet \
	--enable-wifi \
	--enable-bluetooth \
	--enable-openvpn \
	--enable-loopback \
	--enable-pacrunner \
	--enable-ntpd \
	--enable-polkit

  make  || return 1
  make DESTDIR=${pkgdir} install || return 1

  install -Dm755 $srcdir/connmand-daemon $pkgdir/etc/rc.d/connmand
}
md5sums=('88ece7cbf1d0d289545ce4f8553fdab8'
         '21f14212dd953f805e75f4b64fa45771'
         '25d32c85c9d5eb17f3d9007994295914'
         '737a5db9ccbb593c3239f1eee3926af5'
         '52d803129d7e4bceef733cd2afa46cbc'
         'b26051bbfffc96def2499eef6c72b3bc'
         'e68086507b552ca714934ce16c44a59b'
         'a8d22ee089fb0ed725130d16ad393047')
