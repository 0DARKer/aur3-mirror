# Maintainer: Lucas De Marchi <lucas.de.marchi@gmail.com>
# Contributor: Lucas De Marchi <lucas.de.marchi@gmail.com>

pkgname=connman
pkgver=0.80
pkgrel=3
pkgdesc="Wireless LAN network manager"
url="http://connman.net/"
arch=('i686' 'x86_64')
license=('GPL2')
depends=('dbus-core' 'iptables' 'glib2')
conflicts=('openresolv')
optdepends=('bluez: Support for Bluetooth devices'
            'wpa_supplicant: For WiFi devices')
makedepends=('bluez' 'wpa_supplicant')
options=('!libtool')
source=("connmand-daemon"
	"http://www.kernel.org/pub/linux/network/${pkgname}/${pkgname}-${pkgver}.tar.bz2"
	"allow_group_network.diff"
    0001-service-Send-Timeservers.Configuration-property-chan.patch
    0002-pacrunner-Memory-leak-in-dbus-container.patch
    0003-notifier-Change-__connman_notifier_count_connected-t.patch
    0004-notifier-Change-notifer_count_online-to-notifier_is_.patch
    0005-service-fix-glib-critical-messages-about-g_sequence_.patch
    0006-service-Changing-default-service-was-not-correctly-c.patch
    0007-main-Set-default-values-if-main.conf-is-not-found.patch
    0008-test-Cannot-set-both-name-and-passphrase.patch
    0009-agent-Memory-leak-in-passphrase-reply.patch
    0010-main-Mark-end-of-array-with-NULL-in-order-not-to-cra.patch
    0011-service-Save-new-service-data-only-after-successful-.patch    
	)

build() {
  cd ${srcdir}/${pkgname}-${pkgver}

  patch -Np1 -i ${srcdir}/allow_group_network.diff || return 1

  for i in ${srcdir}/000*.patch
  do
      patch -Np1 -i "$i" || return 1
  done

  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	--enable-threads \
	--enable-ethernet \
	--enable-wifi \
	--enable-bluetooth \
	--enable-ofono \
	--enable-openconnect \
	--enable-openvpn \
	--enable-loopback \
	--enable-pacrunner \
	--enable-polkit \
	--enable-client

  make  || return 1
  make DESTDIR=${pkgdir} install || return 1

  install -Dm755 $srcdir/connmand-daemon $pkgdir/etc/rc.d/connmand
}

md5sums=('88ece7cbf1d0d289545ce4f8553fdab8'
         'b98752778d30e0f44950ef881ac486ec'
         'a8d22ee089fb0ed725130d16ad393047'
         '23fb30f4bf1a91defa3b54b00b23824d'
         '9fab6923a66edfc1c314fffe1a4d8c07'
         '9cd2ef36160bb213eafd53d39eb2da58'
         '54c70841ec2fe500d19e2aca118c0bd5'
         '4ae811f9ab38c4660704496ecf202907'
         'fb9e71d0e31361ab4588c04aebf5de46'
         '2ae50bbfafea0e450160f5c922f66de8'
         'b17ac751127cce38ed7eddc8ac1f1662'
         '412927e1df8ccde940d2cef4ba6db7fa'
         'b8261b8bbe83fdafbbe2297ee602784b'
         'f029530f3cde3c28e3ecb6e5d8197305')
