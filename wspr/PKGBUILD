# Maintainer: WB2FKO <mph at sportscliche dot com>
pkgname=wspr
pkgver=2.00.r1714
pkgrel=1
pkgdesc="Weak Signal Propagation Reporter"
arch=("i686")
url="http://www.physics.princeton.edu/pulsar/K1JT/wspr.html"
license=("GPL")
depends=('python2' 'python-imaging' 'python2-numpy' 'libsamplerate' 'portaudio' 'fftw' 'g95')
source=(http://www.physics.princeton.edu/pulsar/K1JT/$pkgname-$pkgver.tgz
        $pkgname.png
        $pkgname.desktop)
md5sums=('89bb985d99e777de054a9c1642a941c5'
         'dd21318d4aa3423f1fbefc53061cc40d'
         '173b51cf8725a5dccc0ac83afd80d422')

build() {
# Set the build environment to python2
 export PYTHON="/usr/bin/python2"
 export F2PY="/usr/bin/python2 f2py.py"
 unset LDFLAGS
  
cd "$srcdir/$pkgname-$pkgver"

# Make problems can sometimes be fixed by replacing gfortran with g95 
./configure --prefix=/usr --enable-gfortran
make
}

package(){
# Place the entire package in /opt  
   rm -rf $pkgdir/opt/$pkgname
   mkdir -p $pkgdir/opt/$pkgname
   mv $srcdir/$pkgname-$pkgver $pkgdir/opt/$pkgname
   chown -R $USER:  $pkgdir/opt/$pkgname
   find "$pkgdir/opt/$pkgname/" -type f  | xargs chmod 644
   find "$pkgdir/opt/$pkgname/" -type d | xargs chmod 755

# Install a menu item with icon
  cd $srcdir
  mkdir -p $pkgdir/usr/share/pixmaps
  mkdir -p $pkgdir/usr/share/applications
  install -Dm644 $pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
  install -Dm644  $pkgname.png $pkgdir/usr/share/pixmaps/$pkgname.png

  echo -e "\n WSPR will be installed in the /opt directory of root \n"
}

