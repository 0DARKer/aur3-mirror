# Maintainer: Jack Allnutt <jack@allnutt.eu>
pkgname=kiwiirc
pkgver=0.8.1
pkgrel=1
pkgdesc="A hand-crafted web-based IRC client that you can enjoy"
arch=('any')
url="https://kiwiirc.com/"
license=('AGPL3')
depends=('nodejs>=0.10.0')
options=('emptydirs' '!strip')
source=(https://github.com/prawnsalad/KiwiIRC/archive/v$pkgver.tar.gz
    'kiwi.patch'
    'kiwiirc.service')
md5sums=('7626795179337b078dc46bbbed1ae271'
    '4c1e35ea8ad196266aa66368af69cda0'
    '811ce6e47f2cc7a2fbf28662d8f5f8ca')

build() {
    cp kiwiirc.service "$srcdir/KiwiIRC-$pkgver/"
    cd "$srcdir/KiwiIRC-$pkgver"
    patch <../kiwi.patch
    npm install
}

package() {
    cd "$srcdir"
    install -D -m644 KiwiIRC-$pkgver/config.example.js $pkgdir/etc/kiwiirc/config.example.js
    install -D -m755 KiwiIRC-$pkgver/kiwi $pkgdir/usr/bin/kiwi
    install -D -m644 KiwiIRC-$pkgver/kiwiirc.service $pkgdir/usr/lib/systemd/system/kiwiirc.service
    install -D -m644 KiwiIRC-$pkgver/package.json $pkgdir/usr/lib/kiwiirc/package.json

    install -d -m755 $pkgdir/usr/lib/kiwiirc/server
    install -d -m755 $pkgdir/usr/lib/kiwiirc/server_modules
    install -d -m755 $pkgdir/usr/lib/kiwiirc/server/node_modules
    cp -dr --preserve=mode KiwiIRC-$pkgver/server $pkgdir/usr/lib/kiwiirc
    cp -dr --preserve=mode KiwiIRC-$pkgver/server_modules $pkgdir/usr/lib/kiwiirc
    cp -dr --preserve=mode KiwiIRC-$pkgver/node_modules $pkgdir/usr/lib/kiwiirc
    cp -dr --preserve=mode KiwiIRC-$pkgver/client $pkgdir/usr/lib/kiwiirc
}
