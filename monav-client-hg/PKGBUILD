# Creator: Micael Dias <kam1kaz3@gmail.com>

pkgname=monav-client-hg
pkgver=471
pkgrel=1
pkgdesc="MoNav is a Desktop / Mobile application that offers state-of-the-art fast and exact routing with OpenStreetMap Data."
arch=('i686' 'x86_64')
url="http://code.google.com/p/monav/"
license=('GPLv3')
depends=('qt' 'qt-mobility')
makedepends=('subversion' 'gcc')
conflicts=('monav-client')
provides=("monav-client")

_hgroot=https://monav.googlecode.com/hg/
_hgrepo=monav-client

build()
{
	cd "${srcdir}"

	# get most recent data from mercurial
	if [ -d ${_hgrepo} ]; then
		(cd ${_hgrepo} && hg pull -u) || return 1
	else
		hg clone ${_hgroot} || return 1
	fi

	msg "Mercurial clone done or server timeout"
	msg "Starting qmake..."

	# remove previous build data
	if [ -d ${_hgrepo}-build ];then
		rm -rf ${_hgrepo}-build
	fi

	# copy files to build dir
	cp -r ${_hgrepo} ${_hgrepo}-build
	cd ${_hgrepo}-build

	# hack to force the client config to output to correct prefix
	echo "target.path=/usr/bin" >> ./client/client.pro

	# generate make files
	qmake CONFIG+=release monavclient.pro || return 1

	msg "Compiling..."

	# make
	make || return 1
}

package()
{
	cd "$srcdir"/${_hgrepo}-build
	make INSTALL_ROOT="${pkgdir}" install || return 1
}
