# Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

## OPTIONS: 0=off 1=on ##

_use_sdlmame=0
_use_sdlmess=0
_use_sdlume=0

[ "${_build}" = "" ] && [ "${_use_sdlmame}" = "0" ] && [ "${_use_sdlmess}" = "0" ] && [ "${_use_sdlume}" = "0" ] && echo "Need choice, at least, one Option, Please edit OPTIONS in the PKGBUILD. Exiting" && exit 0

pkgbase=qmc2-svn
pkgname=qmc2-svn

[ "$_use_sdlmame" = "1" ] && _use+="qmc2-sdlmame-svn "
[ "$_use_sdlmess" = "1" ] && _use+="qmc2-sdlmess-svn "
[ "$_use_sdlume" = "1" ] && _use+="qmc2-sdlume-svn "

true && pkgname=('qmc2-svn' 'qmc2-core-svn' $_use)
pkgver=4858
pkgrel=1
pkgdesc="Qt 4 based UNIX MAME frontend supporting SDLMAME, SDLMESS and SDLUME. (SVN version)"
url="http://qmc2.arcadehits.net/wordpress/"
license=("GPL")
arch=('i686' 'x86_64')
makedepends=('rsync' 'mesa' 'subversion' 'qtwebkit' 'phonon' 'sdl')
source=("qmc2::svn://svn.code.sf.net/p/qmc2/code/trunk")
md5sums=('SKIP')
_svnmod="qmc2"

pkgver() {
  cd "${SRCDEST}/${_svnmod}"
  svnversion
}

build() {
  cd "${srcdir}"

  rm -fr "${srcdir}/${_svnmod}"-{sdlmame,sdlmess,sdlume}-build

  if [ "$_use_sdlmame" = "1" ]; then
    cp -R "${srcdir}/${_svnmod}" "${srcdir}/${_svnmod}-sdlmame-build"
    cd  "${srcdir}/${_svnmod}-sdlmame-build"
    export CTIME=0
    make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLMAME
  fi
  if [ "$_use_sdlmess" = "1" ]; then
    cp -R "${srcdir}/${_svnmod}" "${srcdir}/${_svnmod}-sdlmess-build"
    cd  "${srcdir}/${_svnmod}-sdlmess-build"
    export CTIME=0
    make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLMESS
  fi
  if [ "$_use_sdlume" = "1" ]; then
    cp -R "${srcdir}/${_svnmod}" "${srcdir}/${_svnmod}-sdlume-build"
    cd  "${srcdir}/${_svnmod}-sdlume-build"
    export CTIME=0
    make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLUME
  fi
}

package_qmc2-svn() {
  packagedec=('Qt 4 based UNIX MAME frontend supporting SDLMAME, SDLMESS and SDLUME. (SVN version)')
  arch=('any')
}

package_qmc2-core-svn() {
  packagedec=('Qt 4 based UNIX MAME frontend. Core. (SVN version)')
  arch=('i686' 'x86_64')
  depends=('libxmu')
  conflicts=('qmc2')
  provides=('qmc2')
  install -d "${pkgdir}/usr/share/qmc2"
  install -d "${pkgdir}/etc/qmc2"
  cp -R "${srcdir}/${_svnmod}/data/"* "${pkgdir}/usr/share/qmc2"
  install "${srcdir}/${_svnmod}/inst/qmc2.ini.template" "${pkgdir}/etc/qmc2/qmc2.ini"
  sed 's|DATADIR|/usr/share|' -i "${pkgdir}/etc/qmc2/qmc2.ini"
  cd "${srcdir}/${_svnmod}/runonce/"
  qmake
  make -f Makefile.qmake
  install -Dm755 runonce "${pkgdir}/usr/bin/runonce"
  rm -fr runonce{,.o}
}

package_qmc2-sdlmame-svn() {
  packagedec=('Qt 4 based UNIX MAME frontend for SDLMAME. (SVN version)')
  depends=('qmc2-core-svn' 'qtwebkit' 'phonon' 'sdl' 'sdlmame')
  arch=('i686' 'x86_64')
  cd  "${srcdir}/${_svnmod}-sdlmame-build"
  make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLMAME DESTDIR="${pkgdir}" install
  rm -fr "${pkgdir}/usr/bin/"{qmc2,runonce}
  rm -fr "${pkgdir}/etc"
  rm -fr "${pkgdir}/usr/share/qmc2"
}

package_qmc2-sdlmess-svn() {
  packagedec=('Qt 4 based UNIX MAME frontend for SDLMESS. (SVN version)')
  depends=('qmc2-core-svn' 'qtwebkit' 'phonon' 'sdl' 'sdlmess')
  arch=('i686' 'x86_64')
  cd  "${srcdir}/${_svnmod}-sdlmess-build"
  make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLMESS DESTDIR="${pkgdir}" install
  rm -fr "${pkgdir}/usr/bin/"{qmc2,runonce}
  rm -fr "${pkgdir}/etc"
  rm -fr "${pkgdir}/usr/share/qmc2"
}

package_qmc2-sdlume-svn() {
  packagedec=('Qt 4 based UNIX MAME frontend for SDLUME. (SVN version)')
  depends=('qmc2-core-svn' 'qtwebkit' 'phonon' 'sdl' 'sdlume')
  arch=('i686' 'x86_64')
  cd  "${srcdir}/${_svnmod}-sdlume-build"
  make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr EMULATOR=SDLUME DESTDIR="${pkgdir}" install
  rm -fr "${pkgdir}/usr/bin/"{qmc2,runonce}
  rm -fr "${pkgdir}/etc"
  rm -fr "${pkgdir}/usr/share/qmc2"
}
