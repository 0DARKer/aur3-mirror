# Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=qmc2-svn
pkgver=4671
pkgrel=1
pkgdesc="Qt 4 based UNIX MAME frontend supporting SDLMAME. (SVN version)"
url="http://qmc2.arcadehits.net/wordpress/"
license=("GPL")
arch=('i686' 'x86_64')
depends=('qtwebkit' 'phonon' 'sdl')
makedepends=('rsync' 'mesa' 'subversion')
conflicts=('qmc2')
provides=('qmc2')

_svntrunk="svn://svn.code.sf.net/p/qmc2/code/trunk"
_svnmod="qmc2"

build() {
  cd "${srcdir}"

  msg "Connecting to SVN server...."

  if [ -d "${srcdir}/${_svnmod}" ] ; then
      cd "${_svnmod}" && svn update
  else
      svn co "${_svntrunk}" "${_svnmod}"
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -fr "${srcdir}/${_svnmod}-build"
  cp -R "${srcdir}/${_svnmod}" "${srcdir}/${_svnmod}-build"
  cd  "${srcdir}/${_svnmod}-build"

  export CTIME=0
  make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr
}

package() {
  cd "${srcdir}/${_svnmod}-build"
  make PREFIX=/usr DATADIR=/usr/share SYSCONFDIR=/etc QTDIR=/usr DESTDIR="${pkgdir}" install
  install -d "${pkgdir}/usr/share/"{applications,pixmaps}
  install -Dm644 "${srcdir}/qmc2/data/img/mame.png" "${pkgdir}/usr/share/pixmaps/mame.png"
}
