#!/bin/bash
#
# stripipv6 script v2.4
#
# by Bart Kos, bro at fast-stable-secure dot net
#
# http://www.fast-stable-secure.net
#

### devel
# uncomment the line below to see how the script works (e.g. for debugging)
#set -x

### variables declaration
var1="$1"	# <interface name>

### functions
## check for root privileges
function check_for_root()
{
if [ "$UID" != 0 ]
then
    echo "Error: You must be root to run this script."
    exit
fi
}

# check for 'ip' presence (iproute2 suite)
function check_for_iproute2()
{
if [ `which ip | wc -l` -gt 0 ]
then
    ip="`which ip`"
else
    echo "Error: You require the 'ip' binary from the iproute2 suite to run this script."
    echo "Install the suite and/or update your PATH setting."
    exit
fi
}

# see if the interface that is to be cleared exists
function check_for_interface()
{
if [ `grep -c "\<$var1\>" /proc/net/dev` = 0 ]
then
    echo "Error: No such device."
    exit
fi
}

# print brief info on how to use the script
function usage_help()
{
if [ "$var1" = "-h" ] || [ "$var1" = "--help" ] || [ "$var1" = "help" ] || [ "$var1" = "" ]
then
    echo "Usage: stripv6 <device name>."
    exit
fi
}
	
### main section

check_for_root
usage_help
check_for_iproute2
check_for_interface

# clear IPv6 all addresses from the interface
for ctr1 in `$ip addr show dev $var1 | grep "\<inet6\>" | awk '{print $2}'`
do
    sleep 1
    $ip addr del $ctr1 dev $var1
done

# EOF
