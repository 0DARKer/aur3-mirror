# Maintainer: WU Jun <quark at lihdd dot net>

pkgname=libpinyin
pkgver=0.2.99.20110420
branch=765a730
pkgrel=2
pkgdesc="Library to deal with pinyin."
arch=('i686' 'x86_64')
url="https://github.com/libpinyin/libpinyin"
license=('GPL')
depends=()
makedepends=('automake' 'libtool' 'autoconf')

source=(
	https://download.github.com/libpinyin-$pkgname-$branch.tar.gz
)

md5sums=(
	'36dd3588ca43c30f3e850fc0dd3ec4c9'
)

build() {
	cd ${srcdir}/libpinyin-${pkgname}-${branch}

	# patch src/Makefile.am, let it generate shared library and install headers
	sed -i 's/noinst_LTLIBRARIES\s*=\s*libpinyin\.la/lib_LTLIBRARIES = libpinyin.la/;s/^.*_LDFLAGS\s*=\s*-static//' src/Makefile.am || return 1 

	(aclocal && libtoolize --force && autoheader && automake -a && autoconf) || return 1
	(./configure --prefix=/usr && make) || return 1
}

package() {
	cd ${srcdir}/libpinyin-${pkgname}-${branch}
	make DESTDIR=${pkgdir} install || return 1

	# manually copy headers
	headers=`find src/ -name \*.h`
	header_dest="${pkgdir}/usr/include/libpinyin/"
	install -d $header_dest || return 1
	for i in $headers; do
		install -m 644  $i $header_dest || return 1
	done
}
