# Maintainer: WU Jun <quark at lihdd dot net>

pkgname=libpinyin
pkgver=0.2.99.20110428
branch=b7909ec
commit=b7909ecd1b39843c99b44118a8e0fe269da7f098
pkgrel=2
pkgdesc="Library to deal with pinyin."
arch=('i686' 'x86_64')
url="https://github.com/libpinyin/libpinyin"
license=('GPL')
depends=('db')
makedepends=('automake' 'libtool' 'autoconf')

source=(
	https://github.com/libpinyin/$pkgname/tarball/$commit
)

md5sums=(
	'7ec7a846dc05cbcb662be705247b2f61'
)

build() {
	cd ${srcdir}/libpinyin-${pkgname}-${branch}

	# patch src/Makefile.am, let it generate shared library and install headers
	sed -i 's/noinst_LTLIBRARIES\s*=\s*libpinyin\.la/lib_LTLIBRARIES = libpinyin.la/;s/^.*_LDFLAGS\s*=\s*-static//' src/Makefile.am || return 1 

	(aclocal && libtoolize --force && autoheader && automake -a && autoconf) || return 1
	(./configure --prefix=/usr && make) || return 1
}

package() {
	cd ${srcdir}/libpinyin-${pkgname}-${branch}
	make DESTDIR=${pkgdir} install || return 1

	# manually rm .la files
	rm ${pkgdir}/usr/lib/*.la

	# manually copy headers
	headers=`find src/ -name \*.h`
	header_dest="${pkgdir}/usr/include/libpinyin/"
	install -d $header_dest || return 1
	for i in $headers; do
		install -m 644  $i $header_dest || return 1
	done
}
