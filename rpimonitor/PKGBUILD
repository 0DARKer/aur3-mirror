pkgname=rpimonitor
pkgdesc="A self monitoring application designed to run on Raspberry Pi"
arch=(any)
license=('GPL')
pkgver=2.7
pkgrel=1
depends=(rrdtool perl-http-daemon perl-json perl-ipc-sharelite perl-file-which)
url=(https://github.com/XavierBerger/RPi-Monitor)
source=($pkgname-$pkgver.tar.gz::https://github.com/XavierBerger/RPi-Monitor/archive/v${pkgver}.tar.gz)
sha256sums=('5d7092457e80ed9ff2ea06b0b48360fe30c5106c411effb9f8385fc17e613a4c')

package() {
	mkdir -p ${pkgdir}/{usr/{bin,lib/systemd/system,share/${pkgname}},etc/{conf.d,$pkgname},var/lib/$pkgname/web}/
	cd RPi-Monitor-${pkgver}/${pkgname}
	install -Dm755 ${pkgname}d ${pkgdir}/usr/bin/
	cp -v *.conf ${pkgdir}/etc/$pkgname/
	cp -Rv template ${pkgdir}/etc/$pkgname/
	sed -e 's|$CONFFILE||;s|EnvironmentFile = /etc/conf.d/rpimonitord||' ../tools/systemd/${pkgname}d.service > ${pkgdir}/usr/lib/systemd/system/${pkgname}d.service
	cp -a web ${pkgdir}/usr/share/${pkgname}/
}
