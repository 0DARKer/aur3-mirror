# Maintainer: Daniel Albers <daniel@lbe.rs>
# bareos-fd.service by Christian Hesse <arch@eworm.de>

pkgbase=bareos
pkgname='bareos-fd'
pkgver=13.2.2
pkgrel=1
arch=(i686 x86_64)
pkgdesc='Bareos - A Network Backup Tool'
url="http://www.bareos.org"
license=('AGPL3')
depends=('qt4')
makedepends=('tcp_wrappers')
source=("https://github.com/${pkgbase}/${pkgbase}/archive/Release/${pkgver}.tar.gz"
        '00-qmake4.patch'
        'bareos-fd.service')

md5sums=('2721ae170d040fe2332b8f3bc1a1f9a2'
         '406fd4c0fe7d3cd843706f4ddb015e6f'
         '6a61bf9dbb9a74d10b57c90215d875b2')
sha1sums=('4fa68487bd1025555bb9bb21e8d490175b9e7cf9'
          '5fcf240ebb1b2e1ba221d9c53631d4ef14557298'
          '8b1b12d70862255f9b59f7a5a9b7e49965f3c7d9')

_instdir="$PWD/install"

build() {
    pushd "${srcdir}/${pkgbase}-Release-${pkgver}"

    patch -Np3 -i ${srcdir}/00-qmake4.patch || true

    ./configure                              \
    --enable-bat                             \
    --enable-client-only                     \
    --enable-smartalloc                      \
    --prefix=/usr                            \
    --sbindir=/usr/bin                       \
    --sysconfdir=/etc/${pkgbase}             \
    --with-openssl                           \
    --with-scriptdir=/etc/${pkgbase}/scripts \
    --with-systemd=/usr/lib/systemd/system   \
    --with-tcp-wrappers                      \
    --with-x
    
    make DESTDIR="$_instdir" install
}

package_bareos-fd() {
  pkgdesc='Bareos - A Network Backup Tool (file daemon)'
  backup=('etc/bareos/bareos-fd.conf')
  depends=('bareos-common' 'tcp_wrappers')

  install -D ${_instdir}/etc/bareos/bareos-fd.conf ${pkgdir}/etc/bareos/bareos-fd.conf
  install -D ${_instdir}/usr/bin/bareos-fd ${pkgdir}/usr/bin/bareos-fd
  install -D ${_instdir}/usr/share/man/man8/bareos-fd.8.gz ${pkgdir}/usr/share/man/man8/bareos-fd.8.gz
  install -D ${_instdir}/usr/lib/bpipe-fd.so ${pkgdir}/usr/lib/bpipe-fd.so
  install -D ${srcdir}/bareos-fd.service ${pkgdir}/usr/lib/systemd/system/bareos-fd.service
}

