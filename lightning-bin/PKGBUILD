# Maintainer: Joel Goguen <jgoguen (at-sign) jgoguen (period) ca>
# Maintainer: Hugo Osvaldo Barrera <hugo@osvaldobarrera.com.ar>
pkgname=lightning-bin
pkgver=1.1
pkgrel=2
_tb_min_ver=9.0
pkgdesc="A version of Mozilla Sunbird integrated with Thunderbird"
arch=('i686' 'x86_64')
url="http://www.mozilla.org/projects/calendar/lightning/"
license=('MPL' 'GPL' 'LGPL')
depends=('thunderbird>=${_tb_min_ver}' 'libnotify')
makedepends=()
options=(!strip)
provides=(lightning=${pkgver} lightning-bin=${pkgver})
_tb_version=$(pacman -Qi thunderbird|grep Version|cut -f 2 -d ":"|cut -f 2 -d " "|cut -f 1 -d -)

source=(https://ftp.mozilla.org/pub/mozilla.org/calendar/lightning/releases/${pkgver}/linux/lightning.xpi)
sha1sums=('b935279eff486afab28f95da08bf2038f3438084')

build() {
	mkdir -p ${pkgdir}/usr/lib/thunderbird-${_tb_version}/extensions/${pkgname}
	cd ${pkgdir}/usr/lib/thunderbird-${_tb_version}/extensions/${pkgname}
	bsdtar -x -f ${srcdir}/lightning.xpi

	_emid=$(grep em:id install.rdf | tail -n 1 | sed 's/.*>\(.*\)<.*/\1/')
	cd ../
	mv ${pkgname} ${_emid}
	cd ${_emid}

	# Fix permissions
	find -type d -exec chmod 0755 \{\} \+ || return 1
	find -type f -exec chmod 0644 \{\} \+ || return 1
	find -name '*.so' -exec chmod 0755 \{\} \+
}
