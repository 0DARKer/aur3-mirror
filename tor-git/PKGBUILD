# Maintainer: jwwolf <jwwolf+arch@gmail.com>
pkgname=tor-git
pkgver=20100307
pkgrel=1
pkgdesc="An anonymizing overlay network for TCP, development version)"
arch=('i686' 'x86_64')
url="http://www.torproject.org"
license=('GPL')
groups=()
depends=('openssl>=0.9.8l' 'zlib' 'libevent>=1.4')
makedepends=('make')
optdepends=('geoip' 'asciidoc')
provides=(tor)
conflicts=(tor tor-alpha tor-rc tor-svn)
replaces=()
backup=(etc/tor/torrc etc/tor/tor-tsocks.conf)
options=()
install=tor.install
source=(rc-tor tor.install torrc)
noextract=()
md5sums=('f820a2de49cc7930925127e86db03ada'
         '634844186a3a60c8c7c6be7b4e09a9e2'
         '55f22e2e1a4b232ee06015b8d88501cc')

_gitroot="git://git.torproject.org/git/tor"
_gitname=tor

build() {
  msg "Connecting to GIT server...."

  [ -d $_gitname ] && {
	cd $_gitname
	git pull origin
	msg "Local files have been updated."
	cd ..
  } || { 
	git clone $_gitroot
  }

  msg "GIT checkout done or server timeout"

  rm -rf $_gitname-build
  cp -rf $_gitname/ $_gitname-build/
  cd $_gitname-build

  msg "Starting make..."

  ./autogen.sh
  ./configure --prefix=/usr --sysconfdir=/etc --mandir=/usr/man --localstatedir=/var --enable-transparent --disable-asciidoc
  make || return 1
  make DESTDIR="$pkgdir/" install
  install -D -o43 -g43 -d -m0700 $pkgdir/var/lib/tor
  mv $pkgdir/etc/tor/torrc.sample $pkgdir/etc/tor/torrc-dist
  install -D -m644 $srcdir/torrc $pkgdir/etc/tor/torrc
  install -D -m755 $srcdir/rc-tor $pkgdir/etc/rc.d/tor
}
