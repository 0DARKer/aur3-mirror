# Contributor: N30N <archlinux@alunamation.com>

pkgname="csslint-git"
pkgver=20110623
pkgrel=1
pkgdesc="Automated linting of Cascading Stylesheets."
url="http://csslint.net/"
license=("MIT")
arch=("any")
provides=("csslint")
# depends=("nodejs")
# makedepends=("git" "apache-ant" "nodejs-npm")
depends=("rhino")
makedepends=("git" "apache-ant")

_gitroot="https://github.com/stubbornella/csslint.git"
_gitname="csslint"

build() {
	if [ -d "${_gitname}" ]; then
		cd "${_gitname}"
		git clean -dfx
		git reset --hard
		git pull origin
	else
		git clone "${_gitroot}"
		cd "${_gitname}"
	fi

	if [ "${depends[0]}" = "nodejs" ]; then
		/usr/share/java/apache-ant/bin/ant build.node
	elif [ "${depends[0]}" = "rhino" ]; then
		/usr/share/java/apache-ant/bin/ant build.rhino
		sed -r "s/(csslint)-rhino\.js/\1/" -i build/csslint-rhino.js
		cat <<-EOF > "${srcdir}/csslint.sh"
			#!/bin/sh
			exec java -jar /usr/share/java/js.jar "/usr/share/${_gitname}/csslint-rhino.js" \${@}
		EOF
	fi
}

package() {
	cd "${srcdir}/${_gitname}"

	if [ "${depends[0]}" = "nodejs" ]; then
		# TODO?
		return 1
	elif [ "${depends[0]}" = "rhino" ]; then
		install -Dm755 "${srcdir}/csslint.sh" "${pkgdir}/usr/bin/csslint"
		install -Dm644 build/csslint-rhino.js "${pkgdir}/usr/share/${_gitname}/csslint-rhino.js"
	fi

	install -Dm644 LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

# vim: set noet ff=unix:
