# Maintainer: Remy Marquis <remy dot marquis at gmail dot com>

pkgname=pacaur-git
pkgver=20130225
pkgrel=1
pkgdesc="A fast workflow AUR helper using cower as backend"
arch=('any')
url="https://github.com/Spyhawk/pacaur"
license=('GPL')
depends=('cower' 'expac' 'sudo')
optdepends=('pacman-color: colorized output')
makedepends=('git' 'perl')
provides=('pacaur')
conflicts=('pacaur')
backup=('etc/xdg/pacaur/config')
#source=("git://github.com/Spyhawk/pacaur.git#branch=master")
#md5sums=('SKIP')
_gitroot='http://github.com/Spyhawk/pacaur.git'
_gitname='pacaur'

#pkgver() {
#  cd "$srcdir/$_gitname"
#  echo $(git describe --always | sed 's/-/./g')
#}

build() {
  cd "$srcdir"
  msg "Connecting to github GIT server...."
  if [[ -d "$_gitname" ]] ; then
     cd $_gitname && git pull origin
     msg "The local files are updated."
  else
     git clone "$_gitroot" "$_gitname" 
     cd $_gitname
  fi
  msg "GIT checkout done or server timeout"

  pod2man --section=8 --center="Pacaur Manual" --name="PACAUR" --release="$pkgname $pkgver" README.pod > pacaur.8
}

package() {
  mkdir -p "$pkgdir/etc/xdg/pacaur"
  install -D -m644 $_gitname/config $pkgdir/etc/xdg/pacaur/config
  mkdir -p "$pkgdir/usr/bin"
  install -D -m755 $_gitname/pacaur $pkgdir/usr/bin/pacaur
  mkdir -p "$pkgdir/usr/share/bash-completion/completions"
  install -D -m755 $_gitname/bash.completion $pkgdir/usr/share/bash-completion/completions/pacaur
  mkdir -p "$pkgdir/usr/share/man/man8"
  install -m 644 $_gitname/pacaur.8 $pkgdir/usr/share/man/man8/pacaur.8 

  # use git version number
  cd "$srcdir/$_gitname"
  gitver=$(git describe --always | sed 's/-/./g')
  sed -i "s/version=\"[0-9].[0-9].[0-9]\"/version=\"$gitver\"/g" $pkgdir/usr/bin/pacaur
}
