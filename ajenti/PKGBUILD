# Maintainer: Shanto
# Contributor: vbPadre <vbpadre@gmail.com>

pkgname=ajenti
pkgver=0.5
pkgrel=7
holdver=$pkgver
pkgdesc="An easy server administration frontend like webmin."
arch=('any')
url="http://github.com/Eugeny/ajenti/"
license=('LGPL')
depends=('python>=2.6' 'python-lxml' 'pyopenssl' 'mysql-python' 'twisted' 'python-psycopg2' 'python2-pyopenssl')
makedepends=('git')
optdepends=()
provides=('ajenti')
install=('ajenti.install')
source=('ajenti.init.patch')
md5sums=('966a70b6ec659b63a359d266d459cebd')

gitroot=git://github.com/Eugeny/ajenti.git
gitname=ajenti

build() {
	cd ${srcdir}
	msg "Connecting to GIT server...."

	rm -rf ${gitname}
	git clone -n ${gitroot}
	cd ${gitname}
	git checkout $pkgver-$pkgrel

	msg "GIT checkout done or server timeout"
}

package() {
	install -d ${pkgdir}/usr/{bin,share/${gitname}}
	install -d ${pkgdir}/etc/{rc.d,${gitname}}
	install -d ${pkgdir}/var/lib/${gitname}/plugins
	for script in `grep -Rl '#!/usr/bin/env python' ${gitname}`; do sed -i 's/usr\/bin\/env python/usr\/bin\/python2/' $script; done
	cp -r ${gitname} ${pkgdir}/usr/share/
	ln -s ../share/${gitname}/ajenti-panel ${pkgdir}/usr/bin/
	ln -s ../share/${gitname}/ajenti-pkg ${pkgdir}/usr/bin/
	cd ${srcdir}/${gitname}/packaging/files
	install -m 0755 ajenti.conf ${pkgdir}/etc/${gitname}/
	install -m 0755 ajenti ${pkgdir}/etc/rc.d/
	patch -i ${srcdir}/ajenti.init.patch -d ${pkgdir}/etc/rc.d/
}