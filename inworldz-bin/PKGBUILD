# Maintainer: Zauber Paracelsus <zauber@gridmail.org>
# PKGBUILD was modified from firestorm-bin package created by chungy
pkgname=inworldz-bin


pkgver=2.0.1.31257
pkgrel=1
pkgdesc="The official viewer for InWorldz, an online virtual world."
url="https://inworldz.com/"
license=('GPL')
depends=('openal' 'gnome-vfs' 'gtk2' 'libpng' 'dbus-glib' 'libidn' 'sdl' 'mesa')
optdepends=('gstreamer0.10: For video support - may need good, bad and ugly plugins')
[ "$CARCH" = "x86_64" ] && depends=('lib32-gtk2' 'lib32-libpng' 'lib32-openal' 'lib32-dbus-glib' 'lib32-gnome-vfs' 'lib32-libidn' 'lib32-sdl' 'lib32-mesa')
[ "$CARCH" = "x86_64" ] && optdepends=('lib32-nvidia-utils: GL support for NVIDIA drivers')
arch=('i686' 'x86_64')
install=inworldz.install
source=("http://inworldz.com/Imprudence/test-builds/InWorldz_Beta_i686_${pkgver}.tar.bz2"
 'inworldz.install' 'inworldz.desktop' 'inworldz.launcher')
sha256sums=('dccc8904b03b8922d19d9197d44fa37ffa1b9ac324465181d70efd178be39321'
            '6115f3c1b7ac88db2b2af94fd9fde2605275eea50af104257928eb423a68ecfd'
            'f2155704ba49c961a64d693523306adf0e2f157fadb6155fac57c8d7d83c6428'
            '76bd0b992ee1110f93fafd115dcb6c3d447bc0855a34b2daf742c0d975bafca4')

package() {
    cd "${srcdir}"

    # Rename Data Directory
    mv InWorldz_Beta_i686_${pkgver}/ inworldz

    # Fix fontconfig >= 2.9.0 issue
    #ln -si libfontconfig.so.1.4.4 firestorm/lib/libfontconfig.so.1

    # Install Desktop File
    install -D -m644 "${srcdir}"/inworldz.desktop \
        "${pkgdir}"/usr/share/applications/inworldz.desktop

    # Install Icon File
    install -D -m644 "${srcdir}"/inworldz/inworldz_icon.png \
        "${pkgdir}"/usr/share/pixmaps/inworldz_icon.png

    # Install Launcher
    install -D -m755 "${srcdir}"/inworldz.launcher \
        "${pkgdir}"/usr/bin/inworldz

    # Move Data to Destination Directory
    install -d "${pkgdir}"/opt/
    mv inworldz/ "${pkgdir}"/opt/

    # Change Permissions of files to root:games
    chown -R root:games "${pkgdir}"/opt/inworldz
    chmod -R g+r "${pkgdir}"/opt/inworldz

    # Make Binary Group-Executable
    chmod g+x "${pkgdir}"/opt/inworldz/inworldz
}
