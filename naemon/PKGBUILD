# Maintainer: Jonathan Steel <jsteel at aur.archlinux.org>

pkgbase=naemon
pkgname=('naemon-core' 'naemon-livestatus' 'naemon-truk')
_pkgver=2014-06-20
pkgver=0.8.1_${_pkgver//-/}
pkgrel=2
pkgdesc="Network Application and Event Monitor"
arch=('i686' 'x86_64')
url="http://naemon.org"
license=('GPL')
depends=('sh')
makedepends=('gperf' 'perl-module-install' 'gd' 'libmariadbclient'
'perl-parent'
'perl-json-xs'
'perl-config-general'
'perl-config-any'
'perl-class-data-inheritable'
'perl-mro-compat'
'perl-lwp-useragent'
'perl-net-http'
'perl-class-c3-adopt-next'
'perl-class-c3-xs'
'perl-uri-escape'
'perl-moose'
'perl-socket'
'perl-gd'
'perl-template'
'perl-template-plugin-date'
'perl-date-calc'
'perl-date-calc-xs'
'perl-data-page'
'perl-file-slurp'
'perl-date-manip'
'perl-excel-template-plus'
'perl-class-accessor-fast'
'perl-catalyst'
'perl-catalyst-runtime'
'perl-catalyst-utils'
'perl-catalyst-controller'
'perl-catalyst-exception'
'perl-catalyst-scriptrunner'
'perl-catalyst-authentication-user-hash'
'perl-catalyst-view'
'perl-catalyst-view-tt'
'perl-catalyst-view-gd'
'perl-catalyst-view-json'
'perl-catalyst-view-excel-template-plus'
'perl-catalyst-plugin-configloader'
'perl-catalyst-plugin-static-simple'
'perl-catalyst-plugin-authorization-roles'
'perl-catalyst-plugin-customerrormessage'
'perl-catalyst-plugin-redirect'
'perl-catalyst-plugin-compress'
'perl-log-log4perl'
'perl-log-dispatch-file'
'perl-fcgi'
'perl-fcgi-procmanager'
'perl-fcgi-procmanager-maxrequests'
'perl-namespace-autoclean'
'perl-plack-handler-cgi'
'perl-storable'
'perl-threads'
'perl-thread-queue'
'perl-thread-semaphore'
)
backup=(
etc/logrotate.d/naemon
etc/naemon/conf.d/commands.cfg
etc/naemon/conf.d/contacts.cfg
etc/naemon/conf.d/localhost.cfg
etc/naemon/conf.d/printer.cfg
etc/naemon/conf.d/switch.cfg
etc/naemon/conf.d/templates/contacts.cfg
etc/naemon/conf.d/templates/hosts.cfg
etc/naemon/conf.d/templates/services.cfg
etc/naemon/conf.d/timeperiods.cfg
etc/naemon/conf.d/windows.cfg
etc/naemon/init.d/naemon
etc/naemon/naemon.cfg
etc/naemon/resource.cfg
)
source=(http://labs.consol.de/naemon/testing/$_pkgver/src/$pkgbase-$pkgver.tar.gz)
md5sums=('c21dd6ee03a1a3e2b427a9f2411ea4f4')

build() {
  cd "$srcdir"/$pkgbase-$pkgver

  ./configure --prefix=/usr \
              --bindir="/usr/bin" \
              --datadir="/usr/share/naemon" \
              --libdir="/usr/lib/naemon" \
              --localstatedir="/var/lib/naemon" \
              --sysconfdir="/etc/naemon" \
              --mandir="/usr/share/man" \
              --enable-event-broker \
              --with-pluginsdir="/usr/lib/naemon/plugins" \
              --with-tempdir="/var/cache/naemon" \
              --with-checkresultdir="/var/cache/naemon/checkresults" \
              --with-logdir="/var/log/naemon" \
              --with-logrotatedir="/etc/logrotate.d" \
              --with-naemon-user="naemon" \
              --with-naemon-group="naemon" \
              --with-lockfile="/var/run/naemon/naemon.pid" \
              --with-thruk-user="www-data" \
              --with-thruk-group="naemon" \
              --with-thruk-tempdir="/var/cache/naemon/thruk" \
              --with-thruk-vardir="/var/lib/naemon/thruk" \
              --without-thruk-libs
  make
}

package_naemon-core() {
  cd "$srcdir"/$pkgbase-$pkgver/$pkgname

  make DESTDIR="$pkgdir"/ install
}

package_naemon-livestatus() {
  cd "$srcdir"/$pkgbase-$pkgver/$pkgname

  make DESTDIR="$pkgdir"/ install
}

package_naemon-truk() {
  cd "$srcdir"/$pkgbase-$pkgver/$pkgname

  make DESTDIR="$pkgdir"/ install
}
