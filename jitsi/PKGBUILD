# Maintainer: Dan Serban
# Contributors: Keshav P R, atommix aka Aleks Lifey, Xavion, Ananda Samaddar

pkgname=jitsi
pkgver=1.x.latest
pkgrel=1
pkgdesc="An audio/video SIP VoIP phone and instant messenger written in Java (formerly SIP-Communicator)"
arch=(i686 x86_64)
url=http://jitsi.org/
license=(GPL)
depends=("java-runtime=6")
makedepends=("apache-ant" "java-environment=6" "lynx")
options=(!strip !emptydirs zipman !libtool docs)
source=("jitsi.desktop" "jitsi.sh")
md5sums=('aad7cf1fb18ff5d7c964834ecc38aed8'
         'c75c74f41e613a7d17bf2f1f310adee3')

build()
{
  rm jitsi.zip 2>/dev/null || true
  _url=$(lynx -dump "http://download.jitsi.org/jitsi/src/" | grep -o http.*zip | head -1)
  wget -O jitsi.zip "${_url}"
  bsdtar -xf jitsi.zip
  cd jitsi
  /usr/share/java/apache-ant/bin/ant rebuild
  mkdir -p "${pkgdir}"/usr/lib/jitsi/lib/installer-exclude
  mv lib/os-specific/linux/* "${pkgdir}"/usr/lib/jitsi/lib/
  mv lib/installer-exclude/* "${pkgdir}"/usr/lib/jitsi/lib/installer-exclude/
  mkdir -p "${pkgdir}"/usr/lib/jitsi/lib/native
  [ "${CARCH}" == "i686" ] && cd "${srcdir}"/jitsi/lib/native/linux
  [ "${CARCH}" == "x86_64" ] && cd "${srcdir}"/jitsi/lib/native/linux-64
  mv * "${pkgdir}"/usr/lib/jitsi/lib/native/
  cd "${srcdir}"/jitsi/lib
  rm -r installer-exclude native os-specific
  mv * "${pkgdir}"/usr/lib/jitsi/lib/
  mkdir -p "${pkgdir}"/usr/lib/jitsi/sc-bundles
  mv "${srcdir}"/jitsi/sc-bundles/os-specific/linux/* "${pkgdir}"/usr/lib/jitsi/sc-bundles/
  mv "${srcdir}"/jitsi/sc-bundles/* "${pkgdir}"/usr/lib/jitsi/sc-bundles/
  mkdir -p "${pkgdir}"/usr/share/pixmaps
  cd "${srcdir}"/jitsi/resources/install/debian
  install -Dm644 sip-communicator.svg "${pkgdir}"/usr/share/pixmaps/jitsi.svg
  install -Dm644 sip-communicator-16.xpm "${pkgdir}"/usr/share/pixmaps/jitsi-16.xpm
  install -Dm644 sip-communicator-32.xpm "${pkgdir}"/usr/share/pixmaps/jitsi-32.svg
  mkdir -p "${pkgdir}"/usr/share/applications
  install -Dm644 "${startdir}"/jitsi.desktop "${pkgdir}"/usr/share/applications/jitsi.desktop
  mkdir -p "${pkgdir}"/usr/bin
  install -Dm755 "${startdir}"/jitsi.sh "${pkgdir}"/usr/bin/jitsi
}

