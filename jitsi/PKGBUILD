# Jitsi (formerly SIP-Communicator): Installer: Arch
# Maintainer: Ananda Samaddar ananda@samaddar.co.uk
# Contributor: Xavion <Xavion (dot) 0 (at) Gmail (dot) com>
# Contributor: atommix aka Aleks Lifey <Aleks.Lifey@gmail.com>


oldname=sip-communicator
pkgname=jitsi
relver=1.0
devver=beta1
buildver=3533
pkgver=${relver}.${devver}.${buildver}
pkgrel=1
pkgdesc="An audio/video SIP VoIP phone and instant messenger written in Java"
arch=("i686" "x86_64")
url="http://www.jitsi.org"
license=("GPL")
provides=("${oldname}")
depends=("java-runtime")
makedepends=("apache-ant")
conflicts=("${oldname}-nightly" "${oldname}-svn")
options=(!emptydirs)
source=(http://download.jitsi.org/jitsi/src/${oldname}-src-${relver}-${devver}-nightly.build.${buildver}.zip jitsi.desktop jitsi.sh)
sha256sums=('b2fe465fee3dab76298ee92956c6fb05a1a77e790ff3526bc9a1223c38f1354f'
	    '61e3bec3470790fa067f87d978016ec4452a6fd3dfba2c9afa5245b58d3cb19d'
	    '3d95ab84527bf226301c9adb96dfd2a5792c8047e33b5ca4dadb5beaddd3a415 ')

build() {
	cd ${srcdir}/${oldname}

	# Build
	/usr/share/java/apache-ant/bin/ant rebuild || return 1

	install -Dd ${srcdir}/${oldname}/lib/bundle $pkgdir/usr/lib/jitsi/lib/bundle || return 1
	install -D ${srcdir}/${oldname}/lib/bundle/*.* $pkgdir/usr/lib/jitsi/lib/bundle/ || return 1
	install -D ${srcdir}/${oldname}/lib/*.* $pkgdir/usr/lib/jitsi/lib/ || return 1
	install -Dd ${srcdir}/${oldname}/lib/native $pkgdir/usr/lib/jitsi/lib/native || return 1

	if [[ `uname -m` = "x86_64" ]]; then
		install -D ${srcdir}/${oldname}/lib/native/linux-64/*.* $pkgdir/usr/lib/jitsi/lib/native/
	else
		install -D ${srcdir}/${oldname}/lib/native/linux/*.* $pkgdir/usr/lib/jitsi/lib/native/
	fi

	install -Dd ${srcdir}/${oldname}/sc-bundles $pkgdir/usr/lib/jitsi/sc-bundles || return 1
	install -D ${srcdir}/${oldname}/sc-bundles/*.* $pkgdir/usr/lib/jitsi/sc-bundles/ || return 1
	install -D ${srcdir}/${oldname}/lib/os-specific/linux/jdic_stub.jar $pkgdir/usr/lib/jitsi/lib/ || return 1
	cp ${srcdir}/${oldname}/sc-bundles/os-specific/linux/*.jar $pkgdir/usr/lib/jitsi/sc-bundles/ || return 1

	mkdir -p $pkgdir/usr/share/pixmaps
	cp ${srcdir}/${oldname}/resources/install/debian/${oldname}.svg $pkgdir/usr/share/pixmaps/jitsi.svg

	cp ${srcdir}/${oldname}/resources/install/debian/${oldname}-16.xpm $pkgdir/usr/share/pixmaps/jitsi-16.xpm

	cp ${srcdir}/${oldname}/resources/install/debian/${oldname}-32.xpm $pkgdir/usr/share/pixmaps/jitsi-32.svg

	mkdir -p $pkgdir/usr/share/applications
	cp ${startdir}/jitsi.desktop $pkgdir/usr/share/applications/
	mkdir -p $pkgdir/usr/bin
	cp ${startdir}/jitsi.sh $pkgdir/usr/bin/jitsi


}


