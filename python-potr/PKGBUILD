# Contributor: Konstantin Nikiforov <helllamer@gmail.com> 

pkgname=python-potr
pkgver="1.0.0beta1"
pkgrel=1
pkgdesc="A pure python implementation of the OTR protocol."
arch=('i686' 'x86_64')
url="http://python-otr.pentabarf.de/"
license=('LGPLv3')
depends=('python2>=2.6')
builddepends=('gnupg' 'wget')

filename="python-potr-$pkgver"
filename_tgz="$filename.tar.gz"
url_tgz="http://python-otr.pentabarf.de/releases/$filename_tgz"
source=($url_tgz)
md5sums=('a3819cd9e06f02e3d589f629bc344abc')

PYTHON=`which python2`

build() {
	cd $srcdir/$filename
	$PYTHON setup.py build
}

## check gpg signature of source tarball
check() {
	cd $srcdir
	msg "Checking GPG signature..."
	local keyid='BC74B598'
	gpg --list-keys 2>/dev/null | grep $keyid >/dev/null || {
		msg "No maintainers' GPG keys found. Looking for 0x$keyid..."
		gpg --keyserver 'hkp://pgp.mit.edu:11371' --recv-keys $keyid 2>&1 | tail -n1
	}
	wget --quiet -O - "$url_tgz.asc" 2>/dev/null | gpg --verify - $filename_tgz 2>/dev/null
	msg "Detached GPG signature is valid."
}

package() {
	cd $srcdir/$filename
	$PYTHON setup.py install --root=$pkgdir/
}
