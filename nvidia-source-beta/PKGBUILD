# Maintainer : Alucryd <alucryd at gmail dot com>

pkgname=nvidia-source-beta
pkgver=310.19
pkgrel=4
pkgdesc="NVIDIA kernel module source (DKMS)" 
arch=('i686' 'x86_64') 
[ "$CARCH" = x86_64 ] && ARCH=x86_64 && _srcname=NVIDIA-Linux-x86_64-${pkgver}-no-compat32
[ "$CARCH" = "i686" ] && ARCH=x86 && _srcname=NVIDIA-Linux-x86-${pkgver}
url="http://www.nvidia.com/"
license=('custom')
depends=('linux>=3.6' 'linux<3.7' "nvidia-utils-beta=${pkgver}" 'dkms')
provides=("nvidia=${pkgver}" "nvidia-source=${pkgver}")
conflicts=('nvidia' 'nvidia-source')
source=("http://us.download.nvidia.com/XFree86/Linux-$ARCH/${pkgver}/${_srcname}.run")
install=${pkgname}.install

[ "$CARCH" = "i686" ] && md5sums=('2adbdd38540b3a8955714760e05f575d')
[ "$CARCH" = "x86_64" ] && md5sums=('0ba08d32852e442ebba5ba22c7abed36')

package() {
  cd "${srcdir}"
  if [ -d ${_srcname} ]; then
    rm -rf ${_srcname}
  fi
  sh ${_srcname}.run --extract-only
  cd ${_srcname}
  mkdir -p "${pkgdir}/usr/src"
  cp -R kernel "${pkgdir}/usr/src/nvidia-${pkgver}"
  mkdir -p "${pkgdir}/usr/share/licenses"
  ln -s "/usr/share/licenses/nvidia" "${pkgdir}/usr/share/licenses/nvidia-source-beta"
  find "${pkgdir}" -type d | xargs chmod 755
  find "${pkgdir}" -type f | xargs chmod 644
}
