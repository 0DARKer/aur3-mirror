# Maintainer: leepesjee <lpeschier at xs4all dot nl>
pkgname=cn3d
pkgver=4.3
pkgrel=1
pkgdesc="A visualization tool for biomolecular structures, sequences, and sequence alignments."
arch=('i686' 'x86_64')
license=('custom')
url="http://www.ncbi.nlm.nih.gov/Structure/CN3D/cn3d.shtml"
depends=()
source=(ftp://ftp.ncbi.nlm.nih.gov/toolbox/ncbi_tools++/CURRENT/ncbi_cxx--9_0_0.tar.gz
        ncbi_9_0_0.src.patch
        cn3d.lst.patch
        cn3d.desktop
        ncbi.license)

md5sums=('46cbd232e024690ae617d1c44f3380b4'
         'd08e74a52d315494e86c382ed5a4ad75'
         '1a6419b391c8455aa28b9a7e73a9035a'
         'e8bf6ba0d335e27c312bc39ff7b485b9'
         '8cdf51908efacc8a8b055593fa063d09')

build() {
# make the C++ toolkit
  cd $startdir
  patch -Np0 -i ./ncbi_9_0_0.src.patch
  patch -Np0 -i ./cn3d.lst.patch
  cd $srcdir/ncbi_cxx*
  ./configure --prefix=/$pkgdir/usr --without-debug --with-wxwidgets=/opt/ncbi/wxwidgets-ncbi --with-projects=./scripts/projects/cn3d.lst
  make LDFLAGS="-lGL -lGLU -lX11 -ldl"

# install the package
  install -dv -m755 $pkgdir/usr/bin
  install -m755 $srcdir/ncbi_cxx*/GCC*-Release*/bin/$pkgname $pkgdir/usr/bin
  install -dv -m755 $pkgdir/usr/share/cn3d/data
  install -m644 $srcdir/ncbi_cxx*/src/app/$pkgname/data/* $pkgdir/usr/share/cn3d/data
  install -m644 $srcdir/ncbi_cxx*/src/app/$pkgname/HelpBlocks/Cn3D_Commands.htb $pkgdir/usr/share/cn3d/cn3d_commands.htb

# Install license
  install -dv -m755 $pkgdir/usr/share/licenses/$pkgname
  install -m644 $startdir/ncbi.license $pkgdir/usr/share/licenses/$pkgname

# install icon
  install -m755 -d ${pkgdir}/usr/share/pixmaps
  install -m644 $srcdir/ncbi_cxx*/src/app/${pkgname}/cn3d42App.xpm ${pkgdir}/usr/share/pixmaps
  install -m755 -d ${pkgdir}/usr/share/applications
  install -m644 $startdir/${pkgname}.desktop ${pkgdir}/usr/share/applications/
}
