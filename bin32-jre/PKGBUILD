pkgname=bin32-jre
pkgver=6u24
pkgrel=1
pkgdesc="32-bit Sun java with the new mozilla plugin for Arch x86_64"
arch=('x86_64')
license=('custom')
url="https://jdk6.dev.java.net"
depends=('lib32-glibc' 'lib32-libgl' 'lib32-libx11' 'lib32-libxtst' 'mozilla-common' 'lib32-libxi')
makedepends=('diffutils' 'fakeroot' 'pkgconfig')
install=bin32-jre.install
bin32name=jdk-${pkgver}-dlj-linux-i586
source=(http://download.java.net/dlj/binaries/${bin32name}.bin \
	'construct.sh' 'construct.patch')

md5sums=('3acbe2368cfb5149b04f980184331e33'
         '94065b612df0046d9ae758943f9f6a75'
         '88ad70c4ee77f58d761225a59ab3b7d9')

build() {
  cd ${startdir}/src

  patch -p0 <construct.patch || return 1

  chmod +x ${bin32name}.bin || return 1
  mkdir -p unbundle-jdk
  cd unbundle-jdk
  LD_PRELOAD="" sh ../${bin32name}.bin  --accept-license || return 1

  cd ${startdir}/src

  chmod +x construct.sh
  LD_PRELOAD="" sh construct.sh unbundle-jdk linux-jdk linux-jre || return 1
  mkdir -p ${startdir}/pkg/opt/${pkgname}
  cp -r linux-jdk/jre ${startdir}/pkg/opt/${pkgname} || return 1

  cd ${startdir}/pkg

  # New java plugin in /opt/mozilla/lib/plugins
  mkdir -p opt/mozilla/lib/plugins
  ln -s /opt/${pkgname}/jre/lib/i386/libnpjp2.so opt/mozilla/lib/plugins/libnpjp2.so
}
