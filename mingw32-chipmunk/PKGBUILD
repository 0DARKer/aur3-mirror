pkgname=mingw32-chipmunk
pkgver=6.1.5
pkgrel=1
pkgdesc="A high-performance 2D rigid body physics library (mingw32)"
arch=('any')
url="http://chipmunk-physics.net/"
license=('MIT')
depends=('mingw32-gcc')
source=(http://files.slembcke.net/chipmunk/release/Chipmunk-${pkgver%%.*}.x/Chipmunk-$pkgver.tgz)
md5sums=('843a0d1fd14058b814e14fedeef43407')

build() {
	cd "$srcdir/Chipmunk-$pkgver"
	unset LDFLAGS
	i486-mingw32-gcc \
		-std=gnu99 \
		-Iinclude/chipmunk \
		-O3 -DNDEBUG -ffast-math \
		src/*.c src/constraints/*.c \
		-shared \
		-o libchipmunk.dll
}

package() {
	cd "$pkgdir"
	mkdir "./usr/"
	mkdir "./usr/i486-mingw32"
	mkdir "./usr/i486-mingw32/bin"
	mkdir "./usr/i486-mingw32/lib"
	mkdir "./usr/i486-mingw32/share"
	mkdir "./usr/i486-mingw32/share/doc"
	mkdir "./usr/i486-mingw32/share/doc/chipmunk"
	
	cp -r "$srcdir/Chipmunk-$pkgver/include" "./usr/i486-mingw32/"
	cp -r "$srcdir/Chipmunk-$pkgver/doc" "./usr/i486-mingw32/share/doc/chipmunk/"
	mv "./usr/i486-mingw32/share/doc/chipmunk/doc" "./usr/i486-mingw32/share/doc/chipmunk/html/"
	cp "$srcdir/Chipmunk-$pkgver/libchipmunk.dll" "./usr/i486-mingw32/bin"
	ln -s "/usr/i486-mingw32/bin/libchipmunk.dll" "./usr/i486-mingw32/lib/libchipmunk.dll"
}
