# Contributor: Stas Bourakov <sbourakov(at)gmail.com>
pkgname=enigma2
pkgver=20110726
pkgrel=1
pkgdesc="Enigma2 - software for Linux-powered DVB satellite, terrestrial and cable digital television receivers (e.g. Dreambox). This is experimental version for PC."
arch=('i686' 'x86_64')
url="https://github.com/cougar-enigma/Enigma2PC"
license=('GPL2')
depends=('gettext' 'libdvdnav' 'freetype2' 'fribidi' 'giflib' 'gstreamer0.10' 'gstreamer0.10-base-plugins' 'libjpeg6' 'libpng' 'sdl' 'libsigc++' 'libxml2' 'libxslt' 'python2' 'swig' 'libdvbsi++' 'libxmlccwrap' 'libdreamdvd' 'libdvbcsa' 'xine-lib_for_enigma2')
makedepends=('autoconf' 'automake' 'bison' 'fakeroot' 'flex' 'gcc' 'libtool' 'm4' 'make' 'patch' 'pkg-config' 'git' 'gettext' 'libdvdnav' 'freetype2' 'fribidi' 'libnl-2' 'giflib' 'gstreamer0.10' 'gstreamer0.10-base-plugins' 'libjpeg6' 'libpng' 'sdl' 'libsigcpp1.2' 'libxml2' 'libxslt' 'python2' 'swig' 'libdvbsi++' 'libxmlccwrap' 'libdreamdvd' 'libdvbcsa' 'xine-lib_for_enigma2' 'kernel26-headers')
conflicts=()
_commit='new_xine_plugin'
_gitroot='git://github.com/cougar-enigma/Enigma2PC.git'
_gitname='Enigma2PC'

build() {
    cd "${srcdir}"
    msg "Connecting to GIT server...."

    if [ -d "${_gitname}" ] ; then
        cd "${_gitname}" && git checkout master && git pull origin 
        [[ "${_commit}" ]] && git checkout "${_commit}"
        msg "The local files are updated."
        #msg "Running make distclean"
        #make distclean || :
    else
        git clone "${_gitroot}" "${_gitname}" -b "${_commit}"
        cd "${_gitname}"
        [[ "${_commit}" ]] && git checkout "${_commit}"
	fi

    if [ -d "$srcdir/$_gitname-build" ]; then
      rm -r "$srcdir/$_gitname-build"
    fi
    cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"

    autoreconf -i || return 1
    ./configure --prefix=/usr --with-xlib --with-configdir=/etc || return 1

    make || return 1
    make install DESTDIR=$pkgdir || return 1
}
