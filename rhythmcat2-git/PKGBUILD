# Maintainer: Xtricman <xtricman@gmail.com>
pkgname=rhythmcat2-git
pkgver=20130323
pkgrel=1
pkgdesc="A music player which can be used under Linux"
arch=('i686' 'x86_64')
url="https://github.com/supercatexpert/RhythmCat2"
license=('GPL3')
depends=('gtk3'
'gstreamer'
'gst-plugins-base'
'gst-plugins-good'
'gtk-doc'
'glib2')
makedepends=('gtk3'
'gst-plugins-base-libs'
'gtk-doc'
'python')
optdepends=('gst-plugins-bad: play restricted audio format' 
'gst-plugins-ugly: play restricted audio format')
_gitroot="https://github.com/supercatexpert/RhythmCat2.git"
_gitname="RhythmCat2"
sources=("RhythmCat2.desktop")
md5sums=("7ee4cb341d3e5490b21fd40b2b801882")

build() {
	cd "${srcdir}"
	msg "Connecting to GIT server...."

	if [ -d ${_gitname} ] ; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot} ${_gitname}
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	rm -rf "${srcdir}/${_gitname}-build"
	git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
	cd "${srcdir}/${_gitname}-build"

        ./configure --prefix=/usr --with-native-plugins --with-python3-plugins
	make
	make DESTDIR="${pkgdir}/" install

        mkdir -p "${pkgdir}/usr/share/icons/hicolor/128x128/apps/"
        install -T "${pkgdir}/usr/share/RhythmCat2/images/RhythmCat2_128x128.PNG" "${pkgdir}/usr/share/icons/hicolor/128x128/apps/RhythmCat2.png"
        mkdir -p "${pkgdir}/usr/share/icons/hicolor/256x256/apps/"
        install -T "${pkgdir}/usr/share/RhythmCat2/images/RhythmCat2_256x256.PNG" "${pkgdir}/usr/share/icons/hicolor/256x256/apps/RhythmCat2.png"

        install -D "${pkgdir}/../RhythmCat2.desktop" "${pkgdir}/usr/share/applications"
}
