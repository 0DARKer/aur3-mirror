# Contributor: Marat "Morion" Talipov <morion.self@gmail.com>

pkgname=keepassx2
pkgver=alpha3
pkgrel=2
pkgdesc="Crossplatform port of Windows' application  ''KeePass Password Safe''"
arch=('i686' 'x86_64')
url="https://www.keepassx.org/dev/"
license=('GPLv2, GPLv3')
depends=('libgcrypt' 'libxtst' 'qt4')
makedepends=('intltool' 'cmake')
conflicts=('keepassx' 'keepassx2-git')
source=('https://www.keepassx.org/dev/attachments/download/22/keepassx-2.0-alpha3.tar.gz' 
	'keepassx2.desktop')
md5sums=('1d65a9f1720207b282e386b7c2a5e994'
	 'a5d473596a81a465d69292b8e7952b4a')

_cmake_keys="-DWITH_GUI_TESTS=ON
             -DCMAKE_VERBOSE_MAKEFILE=ON
             -DCMAKE_INSTALL_PREFIX=/usr"

build() {
 cd "$srcdir/keepassx-2.0-$pkgver"

 if [[ -d build ]]; then
    rm -rf build
  fi
 mkdir build && cd build
 msg "Building ..." 
 cmake $_cmake_keys ..
 make clean
 make
}

package() {
 cd "$srcdir/keepassx-2.0-$pkgver/build"

# Install
 make DESTDIR="${pkgdir}" install
 install -dm 755 "${pkgdir}"/usr/share/applications
 install -m 644 "${srcdir}"/keepassx2.desktop "${pkgdir}"/usr/share/applications/keepassx2.desktop
 
 msg "Removing build directory..."
 cd "$srcdir/keepassx-2.0-$pkgver"
 rm -rf build
 msg "Done"
}
