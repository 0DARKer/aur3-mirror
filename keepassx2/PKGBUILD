# Maintainer: Marat "Morion" Talipov <morion.self@gmail.com>

pkgname=keepassx2
pkgver=alpha5
pkgrel=1
pkgdesc="Crossplatform port of Windows' application  ''KeePass Password Safe''"
arch=('i686' 'x86_64')
url="https://www.keepassx.org/dev/"
license=('GPLv2, GPLv3')
depends=('libgcrypt' 'libxtst' 'qt4')
makedepends=('intltool' 'cmake')
conflicts=('keepassx' 'keepassx2-git')
install=.INSTALL
source=("https://www.keepassx.org/dev/attachments/download/56/keepassx-2.0-${pkgver}.tar.gz" 
		'keepassx2.desktop'
		'keepassx2.xml')
md5sums=('0d70aafb32504a639f536a2854236c01'
         'a5d473596a81a465d69292b8e7952b4a'
         '78aa65dc66f50386830299f0e30eaa17')

_cmake_keys="-DWITH_GUI_TESTS=ON
             -DCMAKE_VERBOSE_MAKEFILE=ON
             -DCMAKE_INSTALL_PREFIX=/usr"

build() {
	cd "$srcdir/keepassx-2.0-$pkgver"

	if [[ -d build ]]; then
		rm -rf build
	fi
	mkdir build && cd build
	msg "Building ..." 
	cmake $_cmake_keys ..
	make clean
	make
}

package() {
	cd "$srcdir/keepassx-2.0-$pkgver/build"	
	make DESTDIR="${pkgdir}" install
	
	#dirs
	install -dm 755 "${pkgdir}"/usr/share/applications
	install -dm 755 "${pkgdir}"/usr/share/mime/packages
	
	#files	
	install -m 644 "${srcdir}"/keepassx2.desktop "${pkgdir}"/usr/share/applications/
	install -m 644 "${srcdir}"/keepassx2.xml "${pkgdir}"/usr/share/mime/packages
		 
	msg "Removing build directory..."
	cd "$srcdir/keepassx-2.0-$pkgver"
	rm -rf build
	msg "Done"
}
