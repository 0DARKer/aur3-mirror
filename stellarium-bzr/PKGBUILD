# Contributor: ianux <ianux@free.fr>

pkgname=stellarium-bzr
pkgver=4782
pkgrel=1
pkgdesc="A 3D planetarium software which renders realistic skies in real time"
arch=('i686' 'x86_64')
url="http://stellarium.org/"
license=('GPL2')
conflicts=('stellarium' 'stellarium-svn')
provides=('stellarium')
replaces=('stellarium-svn')
depends=('gettext' 'qt>=4.6.0' 'libgl' 'mesa' 'zlib')
makedepends=('cmake>=2.8.0' 'bzr')
source=('stellarium.desktop' 'stellarium.png')
md5sums=('62523af1a8fb1c227f0356d4794fe48f' 'fa3ecce583a4301f292d1b6fb5822dc2')
sha1sums=('f2c76c4fd0d96358b5e21f8f331ab0ec95c57382' 'b3e48fc879388fe9b239f8483391c56776daa30a')
install=stellarium.install

_bzrtrunk=lp:stellarium
_bzrmod=stellarium

build() {
  cd ${srcdir}

  msg "Connecting to Bazaar server..."

  if [ ! -d ${_bzrmod} ]; then
    bzr co ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  else
    bzr up ${_bzrmod} -r ${pkgver}
  fi

  msg "Bazaar checkout done or server timeout"

  [ -d ${_bzrmod}-build ] && rm -rf ${_bzrmod}-build
  cp -a ${_bzrmod} ${_bzrmod}-build
  cd ${_bzrmod}-build

  msg "Starting make..."

  cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release
  make
}
package() {
  cd ${srcdir}/${_bzrmod}-build
  make DESTDIR=${pkgdir} install

  install -Dm644 ${startdir}/stellarium.desktop ${pkgdir}/usr/share/applications/stellarium.desktop
  install -Dm644 ${startdir}/stellarium.png ${pkgdir}/usr/share/pixmaps/stellarium.png
}
