# Maintainer: ianux <ianux@free.fr>

pkgname=stellarium-bzr
pkgver=5881
pkgrel=1
pkgdesc="A 3D planetarium software which renders realistic skies in real time"
arch=('i686' 'x86_64')
url="http://stellarium.org/"
license=('GPL2')
conflicts=('stellarium' 'stellarium-svn')
provides=('stellarium')
replaces=('stellarium-svn')
depends=('gettext' 'qt4' 'libgl' 'mesa' 'zlib')
makedepends=('cmake' 'bzr')
source=()
md5sums=()
install=stellarium.install

_bzrtrunk="http://bazaar.launchpad.net/~stellarium/stellarium/trunk"
_bzrmod=stellarium

build() {
  cd ${srcdir}

  msg "Connecting to Bazaar server..."
  if [ -d ${_bzrmod} ]; then
    cd ${_bzrmod} && bzr --no-plugins pull ${_bzrtrunk} -r ${pkgver}
    msg "The local files are updated."
  else
    bzr --no-plugins branch ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  fi

  msg "Baazar checkout done or server timeout"

  msg "Removing old build directory..."
  rm -rf ${srcdir}/${_bzrmod}-build

  msg "Creating build directory..."
  cp -r ${srcdir}/${_bzrmod} $srcdir/${_bzrmod}-build

  msg "Starting make..."
  cd ${srcdir}/${_bzrmod}-build
  cmake -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release
  make
}

package() {
  cd ${srcdir}/${_bzrmod}-build
  make DESTDIR=${pkgdir} install
}
