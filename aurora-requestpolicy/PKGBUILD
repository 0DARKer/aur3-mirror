# Maintainer: Army <uli armbruster google>

pkgname=aurora-requestpolicy
_pkgname=requestpolicy
pkgver=0.5.21
pkgrel=1
pkgdesc="an extension for Mozilla browsers that improves the privacy and security of your browsing by giving you control over when cross-site requests are allowed by webpages you visit"
arch=('any')
url="https://www.requestpolicy.com"
license=('GPL2')
depends=("aurora")
makedepends=('unzip' 'perl')
source=(https://www.requestpolicy.com/releases/${_pkgname}-${pkgver}.xpi)

#package() {
#  local _version_aurora="$(perl -e '`aurora -v` =~ /(\d+\.\d+[^\s.,;:]*)/; print $1')"
#  local _version_${_pkgname}="$(awk -F 'em:version="|"' '/em:version/ {print $2; exit}' $srcdir/$_hgrepo/${_pkgname}/install.rdf)"
#  local _extension_id="$(awk -F 'em:id="|"' '/em:id/ {print $2; exit}' $srcdir/${_pkgname}-${pkgver}/install.rdf)"
#  local _path_xpi="$srcdir/$_hgrepo/downloads/${_pkgname}-$_version_${_pkgname}.xpi"
#  local _path_install="$pkgdir/usr/lib/aurora-$_version_aurora/extensions/$_extension_id"
#
#  echo $_version_aurora
#  install -d "$_path_install"
#  unzip -od "$_path_install" "$_path_xpi"
#  }

package() {
	cd $srcdir
	local aurora_ver=$(perl -e '`aurora -v` =~ /(\d+\.\d+[^\s.,;:]*)/; print $1')
	local emid="requestpolicy@requestpolicy.com"
	local dstdir=${pkgdir}/usr/lib/aurora-${aurora_ver}/extensions/${emid}
	install -d $dstdir
	sed -i 's#<em:maxVersion>6.0a1</em:maxVersion>#<em:maxVersion>7.0a2</em:maxVersion>#' install.rdf
        #<em:maxVersion>6.0a1</em:maxVersion>
	cp -R * $dstdir
	rm $dstdir/${_pkgname}-$pkgver.xpi
}
md5sums=('617e5342c42e2bb1f771a143a42e63bc')
