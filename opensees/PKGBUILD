# Maintainer: mickele

pkgname=opensees
pkgver=2.2.2
pkgrel=1
pkgdesc="OpenSees, a software framework for developing applications to simulate the performance of structural and geotechnical systems subjected to earthquakes"
arch=("i686" "x86_64")
url="http://opensees.berkeley.edu/"
depends=('tk>=8.5')
options=('')
license=("custom")
install=(opensees.install)
source=("http://opensees.berkeley.edu/OpenSees/code/OpenSees${pkgver}.tar.gz" "Makefile.def")

build() {
  local _installdir=/usr

  cd "${srcdir}/OpenSees" || return 1

  cp "${srcdir}/Makefile.def" ./ || return 1

  sed -e "s|\$(INSTALLDIR)|${pkgdir}${_installdir}|" \
      -e "s|\$(SRCDIR)|${srcdir}|" \
      -i Makefile.def

  # SRC/tcl/tkMain.cpp - comments line 122
  sed -e "s|extern \"C\" char \*\tstrrchr \_ANSI\_ARGS\_((CONST char \*string, int c)) throw();|// extern \"C\" char \*strrchr \_ANSI\_ARGS\_((CONST char \*string, int c)) throw();|" -i  SRC/tcl/tkMain.cpp
    	  
  # SRC/material/nD/ContactMaterial2D.cpp - redundant ContactMaterial2D::
  sed -e "s|ContactMaterial2D::ContactMaterial2D (0, 0.0, 1.0, 0.0, 0.0);|ContactMaterial2D (0, 0.0, 1.0, 0.0, 0.0);|" \
      -i SRC/material/nD/ContactMaterial2D.cpp
  # SRC/material/nD/ContactMaterial3D.cpp - redundant ContactMaterial3D::
 sed -e "s|ContactMaterial3D::ContactMaterial3D (0, 0.0, 1.0, 0.0, 0.0);|ContactMaterial3D (0, 0.0, 1.0, 0.0, 0.0);|" \
     -i SRC/material/nD/ContactMaterial3D.cpp

  install -d -m 755 "${srcdir}/lib" || return 1
  install -d -m 755 "${pkgdir}${_installdir}/bin" || return 1
  make || return 1

  # install licence
  install -D -m644 "${srcdir}/OpenSees/COPYRIGHT" \
	"${pkgdir}/usr/share/licenses/${pkgname}/LICENSE" || return 1
}
md5sums=('46fd8b9d57c6b590a0c108aec1b29156'
         'da6850b60337a4b41386713ca9168fd2')
