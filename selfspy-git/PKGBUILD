# Maintainer: jakob <grandchild@gmx.net>

pkgname=selfspy-git
_pkgname=selfspy
pkgver=20141005
pkgrel=3
pkgdesc="Selfspy is a daemon for Unix/X11 that continuously monitors and stores what you are doing on your computer."
url="https://github.com/gurgeh/selfspy"
install=selfspy.install
license="GPL"
arch=('i686' 'x86_64')
provides=('selfspy')
conflicts=('selfspy')
depends=('python2' 'python2-daemon' 'python2-lockfile' 'python2-keyring' 'python2-xlib' 'python2-sqlalchemy' 'tk' 'pycrypto')
makedepends=('git')
options=(!libtool)
source=('git://github.com/gurgeh/selfspy.git')
md5sums=('SKIP')

prepare() {
	cd $srcdir/${_pkgname}
	sed -i 's/env python/env python2/g' selfspy/__init__.py
	sed -i 's:var/lib:usr/share:g' Makefile
	sed -i 's/keyring==1.2.2/keyring>=1.2.2/g' requirements.txt
	sed -i 's/pycrypto==2.5/pycrypto>=2.5/g' requirements.txt
	sed -i 's/SQLAlchemy==0.9.4/SQLAlchemy>=0.9.4/g' requirements.txt
	sed -i 's/lockfile==0.9.1/lockfile>=0.9.1/g' requirements.txt
}

package() {
	cd $srcdir/${_pkgname}/
	install -d $pkgdir/usr/{bin,share/selfspy}
	install -d $pkgdir/usr/lib/systemd/system
	python2 setup.py install --root="$pkgdir/" --optimize=1
	install -Dm644 $srcdir/../selfspy@.service $pkgdir/usr/lib/systemd/system/
	install -Dm644 $srcdir/../selfspy.conf $pkgdir/usr/share/selfspy/selfspy.conf.example
}
