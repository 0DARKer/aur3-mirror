# Contributor: Lukas Jirkovsky <l.jirkovsky@gmail.com>
pkgname=tau
pkgver=2.18.2p4
pkgrel=2
pkgdesc="Profiling and tracing toolkit for Fortran, C, C++, Java and Python programs"
arch=('i686' 'x86_64')
url="http://www.cs.uoregon.edu/research/tau/"
license=('custom')
depends=('gcc')
source=(tau_latest.tar.gz tau.sh)
md5sums=('20486a1cbe072b086adfa96c087f96bc'
         'c50a50dcbbbdf2c3194b96b1c7cb43e2')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  ./configure -prefix="$pkgdir"/opt/tau -exec-prefix="" \
    -PROFILE \
    -PROFILEMEMORY
  make install ||  return 1

  # fix paths
  find "$pkgdir"/opt/tau/{bin,include} -type f -exec sed -i "s|$pkgdir||g" '{}' ';'
  sed -i "s|$pkgdir||g" /opt/tau/lib/Makefile.tau-memory
  # move man pages to correct location
  install -d -m755 "$pkgdir"/usr/share
  mv "$pkgdir"/opt/tau/man "$pkgdir"/usr/share
  # install tau.sh to profile.d
  install -d -m755 "$pkgdir"/etc/profile.d
  install -m755 "$srcdir"/tau.sh "$pkgdir"/etc/profile.d
  # install license
  install -D -m644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}

# vim:set ts=2 sw=2 et:
