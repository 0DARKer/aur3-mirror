# Maintainer: Nilux <marko at paasila dot net>
pkgname=vertminer-gpu
pkgver=.
pkgver() {
  cd "$srcdir/$_gitname"
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}
pkgrel=1
pkgdesc="AMD GPU miner for scrypt-N-based coins, like vertcoin and pandacoin."
arch=("i686" "x86_64")
url=("http://vertcoin.org")
license=("GPL3")
depends=("ncurses" "curl" "libcl")
conflicts=("vertminer" "vertminer-gpu" "vertminer-git" "jansson")
makedepends=('opencl-headers' 'git' 'amdapp-sdk' 'unzip')
optdepends=()
provides=("vertminer-gpu")
source=("git+https://github.com/Bufius/vertminer-gpu.git"
                "ADL_SDK_6.0.zip"
)
sha512sums=('SKIP'
                '4af430f0a0eac347b0e3df39999abbf7a4281a1b01398845fd8e826b69c28b67fc062092eac0ef207ace943006ed4ccd8c6017049c2dfd3945914ea6153026f3'
)
noextract=('ADL_SDK_6.0.zip')
[ "$CARCH" == "x86_64" ] && makedepends+=('yasm')

prepare() {
  unzip -jod "$srcdir/$pkgname/ADL_SDK/" "$srcdir/ADL_SDK_6.0.zip" "include/*.h"
  unzip -od "$srcdir/AMD_ADL_SDK" "$srcdir/ADL_SDK_6.0.zip" "Public-Documents/ADL*"
}

#pkgver() {
#  cd "$srcdir/$pkgname"
#  # Use the tag of the last commit
#  git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
#}

build() {

    cd "$srcdir/$pkgname"

    ./autogen.sh

    ./configure \
    --prefix=/usr \
    --enable-scrypt \
    --enable-opencl \

    make
}

package() {
    cd "$srcdir/$pkgname"
    make DESTDIR="$pkgdir" install
}

