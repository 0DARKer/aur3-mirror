# Maintainer: balwierz
pkgbase=cura
pkgname=cura
pkgver=13.03
pkgrel=1
pkgdesc="A full software solution for 3D printing aimed at RepRaps and the Ultimaker."
depends=('python2' 'pypy' 'wxpython' 'python-opengl' 'python2-pyserial' 'python2-numpy' 'python-power-git')
# optdepends=('pypy: much faster slicing using pypy (strongly recommended)')
# makedepends=('')
provides=('cura')
url="http://daid.github.com/Cura/"
license=('AGPLv3')
arch=('any')
source=("Cura-${pkgver}-debian.deb::http://software.ultimaker.com/current/Cura-${pkgver}-debian.deb")
md5sums=('6ee37874f18651ae4e2f26c0c6098c27')

build()
{
	cd "${srcdir}"
	
	# unpack
	tar -xzf data.tar.gz
}

package()
{
	# remove python-power since we have it in the deps.
	rm -rf "${srcdir}"/usr/share/cura/power/
	
	# change python to python2
	sed -i 's|\/usr\/bin\/python|\/usr\/bin\/python2|' "${srcdir}"/usr/share/applications/cura.desktop "${srcdir}"/usr/share/cura/cura.py
	
	# Remove pypy. We will use the system pypy (if available, possibly 64 bit). If it's not, Cura will switch to python2.
	# rm -rf "${pkgdir}/pypy/"
	
	cp -r "${srcdir}"/usr "${pkgdir}"/usr
	
	# add a symbolic link for the executable
	install -d -m755 "${pkgdir}/usr/bin"
	ln -s /usr/share/cura/cura.py "${pkgdir}/usr/bin/cura.py"
}
