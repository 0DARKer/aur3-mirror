#pkgname=smack-util
#pkgver=0.1

pkgname=smack-util-git
pkgver=20120407
pkgrel=2
provides=('smack-util=0.1')
conflicts=('smack-util')
_gitroot='git://github.com/promovicz/smack-util.git'
_gitname='smack-util'

pkgdesc="Utilities for linux SMACK security model. Will soon be updatd with some basic configuration files in /etc/smack"
arch=('i686' 'x86_64')
license=('GPL')
url="https://github.com/promovicz/smack-util"
depends=('pam')
source=(
	etc-rc.d-smack
	smack.service
	etc-smack-netlabel
)
backup=(
	etc-smack-netlabel
)
md5sums=('4c6d136d356899ceac0b935aeb33120f'
         'b9063efdb549c89c5fcd8d3b408e716d'
         '505de7db895a01741c4f0b48e4ae1c3b')

install=install

build() {
	cd "$srcdir"
	msg "Connecting to GIT server..."

	if [[ -d "$_gitname" ]]; then
		cd "$_gitname" && git pull origin
		msg "The local files are updated."
	else
		git clone "$_gitroot" "$_gitname"
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting build..."

	rm -rf "$srcdir/$_gitname-build"
	git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
	cd "$srcdir/$_gitname-build"

	# Compensate for this error - I rather change the -W flag then 
	# removing the 2 lines in the .c file since it's a git package...
	sed -i -e 's/-Werror/& -Wno-unused-but-set-variable/' Makefile
	make
}

# TODO:
#check() {
#}

package() {
	cd "$srcdir/$_gitname-build"
	make PREFIX="$pkgdir" install

	install -d -m755 "$pkgdir/etc/smack"
	install -D -m644 "$srcdir/etc-smack-netlabel" "$pkgdir/etc/smack/netlabel"

	install -D -m755 "$srcdir/etc-rc.d-smack" "$pkgdir/etc/rc.d/smack"
	install -D -m644 "$srcdir/smack.service" "$pkgdir/usr/lib/systemd/system/smack.service"
}
