# Maintainer: serkho <sergey.khorev@gmail.com>
# adopted from reduce-algebra by quasi <quasi@aur.archlinux.org>

pkgname=reduce-algebra-svn
pkgver=20130629
pkgrel=1
pkgdesc="A portable general-purpose computer algebra system"
arch=('i686' 'x86_64')
url="http://reduce-algebra.sourceforge.net/"
license=('BSD')
groups=('science')
makedepends=('subversion' 'texlive-htmlxml' 'imagemagick') # for documentation
source=('reduce.desktop' 'reduce' 'csl')
md5sums=('fe457bdd9feec1bbc86b9128fce723ec' '62cf22ea23b900a28c344105cc6639ca' '6c1ad93314ba801b657b75db450eb324')
conflicts=('reduce-algebra')

_svntrunk="http://svn.code.sf.net/p/reduce-algebra/code/trunk"
_svnmod="reduce-algebra"

build() {
  cd "$srcdir"
  msg "Connecting to SVN server...."

  if [[ -d "$_svnmod/.svn" ]]; then
    (cd "$_svnmod" && svn up)
  else
    svn co "$_svntrunk" --config-dir ./ "$_svnmod"
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_svnmod-build"
  svn export "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"

  cd "$srcdir/$_svnmod-build"
  ./configure --with-csl && make
  msg "Making documentation"
  (cd doc/misc && make)
  (cd doc/manual && make)
}

package(){
  mkdir -p $pkgdir/opt/reduce-algebra $pkgdir/usr/share/applications $pkgdir/usr/share/icons
  mkdir -p $pkgdir/usr/bin

  cp $srcdir/$_svnmod-build/cslbuild/generated-c/reduce.img $pkgdir/opt/reduce-algebra/
  cp $srcdir/$_svnmod-build/cslbuild/generated-c/csl.img $pkgdir/opt/reduce-algebra/
  cp $srcdir/$_svnmod-build/cslbuild/$CARCH-unknown-linux-gnu/csl/reduce $pkgdir/opt/reduce-algebra/
  cp $srcdir/$_svnmod-build/cslbuild/$CARCH-unknown-linux-gnu/csl/csl $pkgdir/opt/reduce-algebra/
  cp -r $srcdir/$_svnmod-build/cslbuild/$CARCH-unknown-linux-gnu/csl/reduce.doc $pkgdir/opt/reduce-algebra/
  cp -r $srcdir/$_svnmod-build/cslbuild/$CARCH-unknown-linux-gnu/csl/reduce.fonts $pkgdir/opt/reduce-algebra/
  cp $srcdir/$_svnmod-build/doc/misc/sl.pdf $pkgdir/opt/reduce-algebra/reduce.doc/
  cp $srcdir/$_svnmod-build/doc/util/r38.pdf $pkgdir/opt/reduce-algebra/reduce.doc/
  cp $srcdir/$_svnmod-build/doc/manual/manual.pdf $pkgdir/opt/reduce-algebra/reduce.doc/
  cp $srcdir/$_svnmod-build/generic/qreduce/Bumblebee.png $pkgdir/usr/share/icons/reduce-algebra.png

  install reduce $pkgdir/usr/bin/reduce
  install csl $pkgdir/usr/bin/csl
  cp reduce.desktop $pkgdir/usr/share/applications
}

# vim:set ts=2 sw=2 et:
