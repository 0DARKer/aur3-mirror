# Maintainer: Jeremy Pope <jpope@jpope.org> PGP-Key: E00B4261
pkgname=choqok-yourls
pkgver=20131216
pkgrel=1
pkgdesc="GIT version of Choqok with patch for the yourls plugin: https://bugs.kde.org/show_bug.cgi?id=265219"
url="http://choqok.gnufolks.org"
license=("GPL")
arch=('i686' 'x86_64')
depends=('kdelibs' 'qjson' 'qoauth' 'qca-ossl')
makedepends=('git' 'cmake' 'automoc4' 'docbook-xsl')
conflicts=('choqok-svn' 'choqok' 'choqok-git')
provides=('choqok')
install="${pkgname}.install"
source=('yourls.diff')
md5sums=('ac03c9b5d2c471747e080c94ca47cbb7')

_gitroot="git://anongit.kde.org/choqok"
_gitname="choqok"

build() {
    cd ${srcdir}
    msg "Connecting to GIT server...."

    if [ -d "${srcdir}/${_gitname}" ] ; then
        cd ${_gitname} && git pull --rebase
    else
        git clone ${_gitroot} ${_gitname}
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    cd ${srcdir}/${_gitname}
    patch -p1 < ../../yourls.diff

    rm -rf ${srcdir}/build
    mkdir -p ${srcdir}/build
    cd ${srcdir}/build

    cmake -DCMAKE_INSTALL_PREFIX=$( kde4-config --prefix ) -DCMAKE_BUILD_TYPE=Release ../${_gitname}

    make
}

package() {
    cd ${srcdir}/build
    make DESTDIR=$pkgdir install
}
