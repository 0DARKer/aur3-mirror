# $Id: PKGBUILD 81490 2010-05-31 07:23:49Z jgc $
# Maintainer: Jan de Groot <jgc@archlinux.org>

pkgname=gtk2-appmenu
pkgver=2.22.1
pkgrel=1
pkgdesc="The GTK+ Toolkit (v2) with Ubuntu AppMenu Patch"
arch=('i686' 'x86_64')
url="http://www.gtk.org/"
install=gtk2.install
depends=('atk>=1.30.0' 'pango>=1.28.0' 'libxcursor' 'libxinerama' 'libxrandr>=1.3.0' 'libxi>=1.3' 'libxcomposite' 'libxdamage' 'heimdal>=1.3.2' 'gnutls>=2.8.6' 'shared-mime-info' 'cairo>=1.10.0' 'libtiff>=3.9.2-2' 'libcups>=1.4.2-3' 'gdk-pixbuf2>=2.21.7')
makedepends=('pkgconfig' 'gtk-doc' 'gobject-introspection')
replaces=('gtkprint-cups' 'gail')
conflicts=('gtkprint-cups' 'gail' 'gtk2')
provides=('gail=1.22.3' "gtk2=${pkgver}")
options=('!libtool' '!docs')
backup=(etc/gtk-2.0/gtkrc)
license=('LGPL')
source=(http://ftp.gnome.org/pub/gnome/sources/gtk+/2.22/gtk+-${pkgver}.tar.bz2
        xid-collision-debug.patch
	old-icon-symlinks.patch
	043_ubuntu_menu_proxy.patch
	064_gir_build_workaround.patch
	001_static-linking-dont-query-immodules.patch
	002_static-linking-dont-build-perf.patch
	011_immodule-cache-dir.patch
	003_gdk.pc_privates.patch
	004_gtk+-ximian-gtk2-filesel-navbutton-5.patch
	005_support_disabling_x11_extensions.patch
	009_gtk-export-filechooser.patch
	012_ubuntu-set-grab-add.patch
	041_ia32-libs.patch
	042_treeview_single-focus.patch
	062_dnd_menubar.patch
	070_mandatory-relibtoolize.patch)
sha256sums=('965bc124f0d25087c4cb2a64cbfd7e4f896e05be8d560fbba68dd8685ba24d07'
            'd758bb93e59df15a4ea7732cf984d1c3c19dff67c94b957575efea132b8fe558'
	    '1298e4103f71d0304378f1e7503011150f6f68398ae8ebae5522a48feaea7c0d'
	    'fbe57d1d0498960e6905e77245c8cca4f2777700374ba55b2433068e8784e98a'
	    'a1b784aa4060a1da2ef68f06082c3c50c0d7089e8f01df007f7398c5099a767e'
	    'ce0e6e097fd0c7260ffa16fd5cd44ba98b641a021ade134cc796cd8c283be4a9'
	    'd2343ed8f187a4d690a6546dc9c52c2a02beba0effa5fa35efabe10f7dd474e9'
	    '21032b68589ac1a2ac48b5464287152caef5eec8b8995b9c4d247fe4feb94029'
	    'f00bb984aa71a57ec41da919b72bd87da41d33f141263aadb672ccdf8069e5be'
	    '62cbd59c3fafe230ff20fa84f0790b27d335d539d6a4412988f5dbbdc86b02f5'
            'b434fa348305b6c700b5c0ec26603ae7ea3b785b702c82d1cf982d61f5f72409'
            '03171a4bb5ed321a5f5c3027f4c2bf2462d5af9114d5bc3ea592e9f3ed064911'
            '2f1b36c87a4a139339d49023718564a550d3820c3cc77b0bcfe10bbc130b9780'
            '5a6c3b1ca8d6d4d7cbcdf14bc43d282bc98a2959bb2d4c671ccdb5962fd12c5c'
            '318a75ddd3f8025bcb7b231ff77165690665eac0de85b3f000aa9a47ae4e9b75'
            '606e5e6365649a50e3b5736e3031c07edf56b7dfe7b4ac2788f6b8a59a4ad483'
	    'c2b08d31eedca274272351c88cc69fbb890147a1d71fbb49bfb90bd4977821a0')

build() {
  cd "${srcdir}/gtk+-${pkgver}"
  patch -Np1 -i "${srcdir}/xid-collision-debug.patch"
  patch -Np1 -i "${srcdir}/old-icon-symlinks.patch"

  patch -Np1 -i "${srcdir}/043_ubuntu_menu_proxy.patch"
  patch -Np1 -i "${srcdir}/064_gir_build_workaround.patch"
  patch -Np1 -i "${srcdir}/001_static-linking-dont-query-immodules.patch"
  patch -Np1 -i "${srcdir}/002_static-linking-dont-build-perf.patch"
  patch -Np1 -i "${srcdir}/011_immodule-cache-dir.patch"
  patch -Np1 -i "${srcdir}/003_gdk.pc_privates.patch"
  patch -Np1 -i "${srcdir}/004_gtk+-ximian-gtk2-filesel-navbutton-5.patch"
  patch -Np1 -i "${srcdir}/005_support_disabling_x11_extensions.patch"
#  patch -Np1 -i "${srcdir}/009_gtk-export-filechooser.patch"
  patch -Np1 -i "${srcdir}/012_ubuntu-set-grab-add.patch"
  patch -Np1 -i "${srcdir}/041_ia32-libs.patch"
  patch -Np1 -i "${srcdir}/042_treeview_single-focus.patch"
  patch -Np1 -i "${srcdir}/062_dnd_menubar.patch"
  patch -Np1 -i "${srcdir}/070_mandatory-relibtoolize.patch"

  CXX=/bin/false ./configure --prefix=/usr --sysconfdir=/etc \
      --localstatedir=/var --with-xinput=yes --disable-visibility
  make
  make DESTDIR="${pkgdir}" install

  sed -i "s#env python#env python2#" $pkgdir/usr/bin/gtk-builder-convert

  echo 'gtk-fallback-icon-theme = "gnome"' > "${pkgdir}/etc/gtk-2.0/gtkrc"
}
