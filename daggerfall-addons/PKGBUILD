# Maintainer: Andrzej Giniewicz <gginiu@gmail.com>
pkgname=daggerfall-addons
pkgver=20110711
pkgrel=1
pkgdesc="The Elder Scrolls II: Daggerfall, unofficial Add-Ons"
arch=('any')
url="http://www.uesp.net/wiki/Daggerfall:Files#Unofficial_Add-Ons"
license=('custom:daggerfall')
depends=(daggerfall)
makedepends=(unzip)
options=(!emptydirs)
install=addons.install
source=(http://www.uesp.net/dagger/files/xtraqst.zip
        http://www.uesp.net/dagger/files/xtraqst2.zip
        http://images.uesp.net//0/0d/Xtraqst3.zip
        http://www.uesp.net/dagger/files/xqse.zip
        http://www.uesp.net/dagger/files/xqpatch.zip
        http://images.uesp.net//3/34/Lbsword.zip
        http://www.uesp.net/dagger/files/addtext.zip
        http://www.uesp.net/dagger/files/brenrsc11.zip
        http://www.svatopluk.com/daggerfall/mods/BrenRSC2.zip
        http://images.uesp.net//5/5e/MountedGuards.zip
        http://images.uesp.net//0/04/WeaponsFall.zip
        http://images.uesp.net//9/9c/ArmorFall.zip
        http://images.uesp.net//c/c3/ClothesFall.zip
        http://images.uesp.net//f/f8/WomenFall.zip)
noextract=(xtraqst.zip xtraqst2.zip Xtraqst3.zip xqse.zip xqpatch.zip Lbsword.zip
           MountedGuards.zip WeaponsFall.zip ArmorFall.zip ClothesFall.zip WomenFall.zip
           addtext.zip brenrsc11.zip BrenRSC2.zip)
md5sums=('bfda6a00f48aec717a9811debb594050'
         '2e05d882d5d3750142e5dc513064e639'
         'd10f136d77d514c1ff932fea49c9739c'
         '85b487fbbd0999660391c9e796664626'
         'b802a0e83d4c7aa707f681540758ca54'
         'fd07e8b79ec015421bae0e4ddaeee002'
         '13d33aae6edc1abaf6e060e775873588'
         'b9b42b11ce2a9aa88f90705443abc26d'
         '8b585dc1c1ee47e348613dc60180720d'
         '9a27ce990dc32df5f92cb5a841b6ceaa'
         'ae5d7a13120754e3f1574767958977a7'
         '567f827b27536c740459269a02869c14'
         '3ceea5532385b3c77a5d38e971915c1e'
         '6fd1aa6fae821a86bf5f41fca20c52a7')

build() {
  cd "$srcdir"
  _target="${pkgdir}"/usr/share/games/daggerfall/mods
  install -d "$_target"

  cd "$_target"
  install -d extra_quests1/ARENA2
  cd extra_quests1/ARENA2
  unzip "$srcdir"/xtraqst.zip
  rm README.TXT
  cd "$_target"
  echo "extra_quests1" > addons.extends

  cd "$_target"
  install -d extra_quests2/ARENA2
  cd extra_quests2/ARENA2
  unzip "$srcdir"/xtraqst2.zip
  rm README.TXT
  cd "$_target"
  echo "extra_quests2" >> addons.extends

  cd "$_target"
  install -d extra_quests3/ARENA2
  cd extra_quests3/ARENA2
  unzip "$srcdir"/Xtraqst3.zip
  rm README.TXT
  cd "$_target"
  echo "extra_quests3" >> addons.extends

  cd "$_target"
  install -d extra_quests_se/ARENA2
  cd extra_quests_se/ARENA2
  unzip "$srcdir"/xqse.zip
  rm README.TXT
  cd "$_target"
  echo "extra_quests1" > extra_quests_se.extends
  echo "extra_quests_se" >> addons.extends

  cd "$_target"
  install -d extra_quests_patch/ARENA2
  cd extra_quests_patch/ARENA2
  unzip "$srcdir"/xqpatch.zip
  rm PATCH.TXT
  cd "$_target"
  echo "extra_quests2" > extra_quests_patch.extends
  echo "extra_quests_se" >> extra_quests_patch.extends
  echo "extra_quests_patch" >> addons.extends

  cd "$_target"
  install -d live_by_the_sword/ARENA2
  cd live_by_the_sword/ARENA2
  unzip "$srcdir"/Lbsword.zip
  mv quests ..
  rm -rf *
  mv ../quests/* .
  rm -rf ../quests
  ls | while read file; do mv $file `echo $file | sed 's/.*/\U&/'`; done
  cd "$_target"
  echo "live_by_the_sword" >> addons.extends
  
  cd "$_target"
  install -d added_text/ARENA2
  cd added_text/ARENA2
  unzip "$srcdir"/addtext.zip
  rm text.txt
  mv Text.rsc TEXT.RSC

  cd "$_target"
  install -d brendan_funny_text/ARENA2
  cd brendan_funny_text/ARENA2
  unzip "$srcdir"/brenrsc11.zip
  rm BrenRSC1.txt
  mv Brendan1.rsc TEXT.RSC

  cd "$_target"
  install -d brendan_straight_text/ARENA2
  cd brendan_straight_text/ARENA2
  unzip "$srcdir"/BrenRSC2.zip
  rm -rf __MACOSX
  mv BrenRSC2/Brendan2.rsc TEXT.RSC
  rm -rf BrenRSC2
  cd "$_target"
  echo "brendan_straight_text" >> addons.extends

  cd "$_target"
  install -d mounted_guards/ARENA2
  cd mounted_guards/ARENA2
  unzip "$srcdir"/MountedGuards.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "mounted_guards" >> addons.extends

  cd "$_target"
  install -d weapons_fall/ARENA2
  cd weapons_fall/ARENA2
  unzip "$srcdir"/WeaponsFall.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "weapons_fall" >> addons.extends

  cd "$_target"
  install -d armor_fall/ARENA2
  cd armor_fall/ARENA2
  unzip "$srcdir"/ArmorFall.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "armor_fall" >> addons.extends

  cd "$_target"
  install -d clothes_fall/ARENA2
  cd clothes_fall/ARENA2
  unzip "$srcdir"/ClothesFall.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "clothes_fall" >> addons.extends

  cd "$_target"
  install -d women_fall/ARENA2
  cd women_fall/ARENA2
  unzip "$srcdir"/WomenFall.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "women_fall" >> addons.extends

  chgrp -R games "$pkgdir"/usr/share/games/daggerfall
  chmod -R g+w "$pkgdir"/usr/share/games/daggerfall
}

