# Maintainer: Dylan Ferris <dylan@hashflo.net>

pkgname=scallion
pkgver=1.2
pkgrel=1
pkgdesc="Creates vanity GPG keys and .onion addresses (for Tor's hidden services) using OpenCL."
arch=('i686' 'x86_64')
url="https://github.com/lachesis/scallion"
license=('MIT')
makedepends=('git' 'mono')
depends=('mono')
source=('scallion.sh')
sha256sums=('5637b7c7da3f3e886c17cde8c07844fc0e453a2ddf973bb9675c15f83bfd43ee')

_gitroot="git://github.com/lachesis/scallion.git"
_gitname=scallion

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  xbuild scallion.sln
}

package() {
  install -Dm755 scallion.sh "$pkgdir/bin/$pkgname"
  cd "$srcdir/$_gitname-build"
  install -dm755 scallion/bin/Debug "$pkgdir/usr/share/$pkgname"
  cp scallion/bin/Debug/* "$pkgdir/usr/share/$pkgname"
}

# vim:set ts=2 sw=2 et:
