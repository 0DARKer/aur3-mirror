# Contributor: <grawity@gmail.com>
pkgname=netkit-bsd-finger-ipv6
pkgver=0.17
pkgrel=6
pkgdesc="bsd-finger ported to Linux, with IPv6 and other Debian patches"
arch=('i686' 'x86_64')
url="ftp://ftp.uk.linux.org/pub/linux/Networking/netkit"
license=('BSD')
depends=('glibc' 'xinetd')
provides=('netkit-bsd-finger')
backup=('etc/xinetd.d/finger')
source=(
	"ftp://ftp.uk.linux.org/pub/linux/Networking/netkit/bsd-finger-${pkgver}.tar.gz"
	"http://ftp.de.debian.org/debian/pool/main/b/bsd-finger/bsd-finger_0.17-14.debian.tar.bz2"
	"finger.xinetd"
	"LICENSE")
md5sums=('52bf281aac8814bf56cdc92f7661ee75'
         '21bf0e0d52d7e186cdc8edceafab99f0'
         'a8682004dc8dee356065162bde892b47'
         '5fc568418a0379fc3a358ed1c2523b44')

build() {
	cd ${srcdir}/bsd-finger-${pkgver}
	patch -p1 < ../debian/patches/01-legacy.patch
	patch -p1 < ../debian/patches/02-518559-nsswitch-sources.patch
	patch -p1 < ../debian/patches/03-468454-fingerd-ipv6.patch
	patch -p1 < ../debian/patches/04-468454-finger-ipv6.patch
	patch -p1 < ../debian/patches/05-547014-netgroup.patch
	#while read -r file; do
	#	 patch -p1 < "../debian/patches/$file"
	#done < "../debian/patches/series"
	install -d ${pkgdir}/usr/{bin,sbin} ${pkgdir}/usr/share/man/{man1,man8}
	./configure --prefix=/usr || return 1
	sed -i 's@include <sys/time.h>@include <time.h>@' finger/lprint.c || return 1
	sed -i 's@include <sys/time.h>@include <time.h>@' finger/sprint.c || return 1
	make || return 1
	make INSTALLROOT=${pkgdir} MANDIR=/usr/share/man install || return 1
	install -D -m644 ${srcdir}/finger.xinetd ${pkgdir}/etc/xinetd.d/finger || return 1
	install -D -m644 ../LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
