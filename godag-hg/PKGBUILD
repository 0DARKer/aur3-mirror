# Maintainer: RÃ©my Oudompheng <remy@archlinux.org>
pkgname=godag-hg
pkgver=339
pkgrel=1
pkgdesc="Automatic building tool for Go language"
arch=(i686 x86-64)
url="http://code.google.com/p/godag/"
license=('GPL3')
groups=()
depends=('go')
makedepends=('mercurial')
provides=('godag')
options=('!strip')
source=()
noextract=()
md5sums=() #generate with 'makepkg -g'

_hgroot="https://code.google.com/p/godag/"
_hgrepo="godag"

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [ -d $_hgrepo ] ; then
    cd $_hgrepo
    hg pull -u
    msg "The local files are updated."
  else
    hg clone $_hgroot $_hgrepo
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_hgrepo-build"
  cp -r "$srcdir/$_hgrepo" "$srcdir/$_hgrepo-build"
  cd "$srcdir/$_hgrepo-build"

  source /etc/profile.d/go.sh
  if [[ "$CARCH" == "i686" ]]; then
      export GOARCH=386
  else
      export GOARCH=amd64
  fi
  bash build.sh build
}

package() {
  cd "$srcdir/$_hgrepo-build"
  install -D -m 755 gd ${pkgdir}/usr/bin/gd
}

