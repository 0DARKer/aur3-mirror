# Contributor: Jens Staal <staal1978@gmail.com>

pkgname="the-incredible-machine-2"
pkgver="1.0"
pkgrel=3
pkgdesc="A classic puzzle game from Abandonia, played in DosBox."
url='http://www.abandonia.com/en/games/395/Incredible+Machine+2,+The.html'
arch=('any')
license=('custom-freeware' 'Abandonware')
install='tim2.install'
depends=('dosbox')
optdepends=('abandonia-menu')
source=('http://files.abandonia.com/download.php?game=Incredible+Machine+2%2C+The&secure=98ddb7b4cd755918180065de92319f8f&td=1297665430' 'TIM2.png')
md5sums=('b0e1b4e0f7000a49ef9bb2920ab288a4' 'cd42b0e995ef697377ef8e05fd7092b5')
_pkgabbrev="TIM2"
_exe="TIM2.EXE"
_icon="TIM2.png"

build() {
	mkdir -p -m755 "$pkgdir/opt/" || return 1
	mkdir -p -m755 "$pkgdir/opt/abandonia" || return 1
	mkdir -p -m755 "$pkgdir/opt/abandonia/$_pkgabbrev" || return 1
	rm -f $srcdir/download* || return 1
	cp -ar $srcdir/the\ incredible\ machine\ 2/* "$pkgdir/opt/abandonia/$_pkgabbrev" || return 1

	#ok, let's use a script to start the game

	mkdir -p -m755 /$pkgdir/usr/bin/ || return 1
	printf "#!${SHELL}
if whereis dosbox>/dev/null 2>&1;
	then
		dosbox /opt/abandonia/$_pkgabbrev/$_exe
	else
		echo '==> Please get sure to have dosbox installed and have it in your PATH array.'
fi
return \$?" >> /$pkgdir/usr/bin/$_pkgabbrev.sh || return 1
	chmod +x /$pkgdir/usr/bin/$_pkgabbrev.sh || return 1
	ln -s $_pkgabbrev.sh /$pkgdir/usr/bin/$_pkgabbrev || return 1

	# Automatic generation of a .desktop file

	mkdir -p -m644 "$pkgdir/usr/share/" || return 1
	mkdir -p -m644 "$pkgdir/usr/share/applications/" || return 1

	printf "[Desktop Entry]
Version=$pkgver
Type=Application
Name=$pkgname
Comment=$pkgdesc
Exec=/usr/bin/$_pkgabbrev
Icon=/opt/abandonia/$_pkgabbrev/$_icon
Categories=Game;Abandonia;
Terminal=false
StartupNotify=false" >> /$pkgdir/usr/share/applications/$_pkgabbrev.desktop
} 
