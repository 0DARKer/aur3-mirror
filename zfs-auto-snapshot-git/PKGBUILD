# Contributor: Milan Knížek <knizek@volny.cz>

_pkgbase=zfs-auto-snapshot
pkgname=${_pkgbase}-git
pkgver=20120304
pkgrel=1
pkgdesc="An alternative implementation of the zfs-auto-snapshot service for Linux that is compatible with zfs-linux and zfs-fuse."
arch=(i686 x86_64)
makedepends=('git')
url="https://github.com/dajhorn/zfs-auto-snapshot"
license=('GPL')
source=()
install=$pkgname.install

_gitroot="git://github.com/dajhorn/${_pkgbase}"
_gitname="${_pkgbase}"

build() {
  msg 'Connecting to github.com GIT server....'
  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
  else
    git clone ${_gitroot}
  fi
  msg 'GIT checkout done or server timeout'
  msg 'Starting make...'
  cd "${srcdir}"
  [[ -d ${_pkgbase}_build ]] && rm -rf ${_pkgbase}_build
  cp -R ${_pkgbase} ${_pkgbase}_build
  cd ${_pkgbase}_build
#  sed -i 's@ //@ pool@' etc/zfs-auto-snapshot.cron.*
  sed -i -e 's@/sbin@/usr/sbin@g' Makefile
  sed -i -e 's@PATH=@#PATH=@' -e 's@root zfs-@zfs-@' etc/zfs-auto-snapshot.cron.frequent
}

package() {
  cd "${srcdir}/${_pkgbase}_build"
  make DESTDIR="${pkgdir}" install
}

md5sums=()
