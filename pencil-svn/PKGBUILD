# Contributor: N3ON <archlinux@alunamation.com>

pkgname=pencil-svn
pkgver=116
pkgrel=2
pkgdesc="Animation/drawing software, that lets you create traditional hand-drawn animation using both bitmap and vector graphics"
url="http://pencil-animation.org/"
license=("GPL")
arch=("i686" "x86_64")
depends=("qt" "phonon")
makedepends=("subversion")
source=("pencil.desktop")
md5sums=("08badd4006029f5b017b9debbd20f2c5")

_svntrunk="https://pencil-planner.svn.sourceforge.net/svnroot/pencil-planner/trunk/"
_svnmod="pencil"

build() {
	# cd ${srcdir}
	msg "Connecting to Pencil SVN server......."
	if [ -d ${_svnmod}/.svn ]; then
		(cd ${_svnmod} && svn update -r ${pkgver})
		rm -rf ${_svnmod}-build
	else
		svn co ${_svntrunk} ${_svnmod} -r ${pkgver} --config-dir ./
	fi

	cp -rf ${_svnmod} ${_svnmod}-build
	cd ${_svnmod}-build/

	# temp compile fix
	sed -e "18d" -e "26d" -i src/main.cpp

	msg "Starting build process."
	qmake && make || return 1

	# msg "Now compiling the plug-ins"
	# msg2 "ffmpeg"
	# (cd src/plugins/ffmpegplugin && qmake && make)
	# msg2 "flash"
	# (cd src/plugins/flashplugin && qmake && make)
	# msg2 "image"
	# (cd src/plugins/imageplugin && qmake && make)
	# msg2 "xsheet"
	# (cd src/plugins/xsheetplugin && qmake && make)
}

package() {
	install -d ${pkgdir}/usr/bin
	install -d ${pkgdir}/usr/lib
	# install -d ${pkgdir}/usr/share/pencil/plugins
	install -D -m644 pencil.desktop ${pkgdir}/usr/share/applications/pencil.desktop
	install -m755 ${_svnmod}-build/release/Pencil ${pkgdir}/usr/share/pencil/Pencil
	# install -m644 ${_svnmod}-build/release/plugins/* ${pkgdir}/usr/share/pencil/plugins
	# install -m644 ${_svnmod}-build/release/libpencil_structure.so.1.0.0 ${pkgdir}/usr/lib
	install -D -m644 ${_svnmod}-build/icons/icon.png ${pkgdir}/usr/share/pixmaps/pencil.png
	ln -s /usr/share/pencil/Pencil ${pkgdir}/usr/bin/pencil
}

# vim: set noet ff=unix:
