# Maintainer: taylorchu

pkgname=fcitx-mini
pkgver="$(date +"%Y%m%d%H%M")"
pkgrel=1
pkgdesc="fcitx without any input method"
arch=("i686" "x86_64")
license=('GPL')
url="https://github.com/fcitx/fcitx"
makedepends=('git' 'intltool' 'cmake' 'iso-codes')
conflicts=('fcitx')
provides=('fcitx')

depends=('pango' 'libxinerama' 'gtk-update-icon-cache' 'shared-mime-info' \
    'hicolor-icon-theme' 'desktop-file-utils' 'libxkbfile' \
    'libxfixes' 'dbus-core' 'icu')

install=fcitx-gtk2.install

_gitname="fcitx"
_gitroot="https://github.com/fcitx/fcitx.git"

build() {
    cd "$srcdir"
    msg "Connecting to GIT server..."
    if [[ -d "$_gitname" ]] ; then
        cd "$_gitname" && git pull origin
        msg "The local files are updated."
    else
        git clone --depth 1 "$_gitroot" "$_gitname"
    fi
    msg "GIT checkout done or server timeout"

    msg "Creating make environment..."
    rm -rf $srcdir/$_gitname-build
    mkdir -p $srcdir/$_gitname-build

    msg "Starting make..."
    cd $srcdir/$_gitname-build
    cmake ../$_gitname -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release \
        -DENABLE_OPENCC=OFF -DENABLE_TABLE=OFF -DENABLE_QT_IM_MODULE=ON -DENABLE_SNOOPER=OFF -DENABLE_GIR=OFF -DENABLE_ENCHANT=OFF

    make
}

package(){
    cd $srcdir/$_gitname-build
    make DESTDIR=$pkgdir install


    # clean up
    rm -rf $pkgdir/usr/share/fcitx/{table,pinyin,inputmethod,imicon,py-enhance}
    rm -rf $pkgdir/usr/bin/{createPYMB,readPYBase,readPYMB}
    rm -rf $pkgdir/usr/share/man/man1/{createPYMB,readPYBase,readPYMB}.1.gz
    rm -rf $pkgdir/usr/include/fcitx/module/{pinyin,pinyin-enhanced}
    rm -rf $pkgdir/usr/share/fcitx/addon/{fcitx-pinyin.conf,fcitx-pinyin-enhance.conf,fcitx-qw.conf,fcitx-table.conf}
    rm -rf $pkgdir/usr/share/fcitx/configdesc/{fcitx-pinyin.desc,fcitx-pinyin-enhance.desc,fcitx-qw.desc,fcitx-table.desc}
    rm -rf $pkgdir/usr/lib/fcitx/{fcitx-pinyin.so,fcitx-pinyin-enhance.so,fcitx-qw.so,fcitx-table.so}
}
