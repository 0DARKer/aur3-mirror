diff --git a/npiet.c b/npiet.c
index 36b7857..2224a21 100644
--- a/npiet.c
+++ b/npiet.c
@@ -1203,6 +1203,18 @@ read_png (char *fname)
 
 #include <gif_lib.h>
 
+#if defined GIFLIB_MAJOR && GIFLIB_MAJOR >= 5
+static void PrintGifErrorStr(char *str)
+{
+  fprintf(stderr, "Error in GIF library: %s\n", str);
+}
+
+static void PrintGifError(int errorCode)
+{
+  PrintGifErrorStr(GifErrorString(errorCode));
+}
+#endif
+
 int
 read_gif (char *fname) 
 {
@@ -1217,13 +1229,24 @@ read_gif (char *fname)
     return -1;
   }
 
-  if (! (gif = DGifOpenFileName (fname))) {
+#if defined GIFLIB_MAJOR && GIFLIB_MAJOR >= 5
+  int errcode;
+  gif = DGifOpenFileName (fname, &errcode);
+#else
+  gif = DGifOpenFileName (fname);
+#endif
+
+  if (gif == NULL) {
     /* return error silently: */
     return -1;
   }
   
   if (DGifGetRecordType (gif, &rtype) == GIF_ERROR) {
+#if defined GIFLIB_MAJOR && GIFLIB_MAJOR >= 5
+    PrintGifError (gif->Error);
+#else
     PrintGifError ();
+#endif
     DGifCloseFile (gif);
     return -1;
   }
