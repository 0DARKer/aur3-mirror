# Maintainer: Jonathan Steel <jsteel at aur.archlinux.org>

_pkgname=Thruk
pkgname=thruk-git
pkgver=1.84.3.r34.g3d4fd29
pkgrel=1
pkgdesc="Multibackend monitoring webinterface for Naemon, Nagios, Icinga and Shinken"
arch=('any')
url="http://thruk.org"
license=('GPL2')
depends=('perl')
makedepends=('git')
backup=('etc/thruk/cgi.cfg' 'etc/thruk/htpasswd'
  'etc/thruk/log4perl.conf' 'etc/thruk/menu_local.conf'
  'etc/thruk/naglint.conf')
source=(git://github.com/sni/$_pkgname.git)
md5sums=('SKIP')

pkgver() {
  cd "$srcdir"/$_pkgname

  git describe --tags | sed -r 's/([^-]*-g)/r\1/;s/-/./g;s/^v//' 
}

build() {
  cd "$srcdir"/$_pkgname

  ./configure --prefix=/usr \
    --exec-prefix=/bin \
    --bindir=/usr/bin \
    --sysconfdir=/etc/$pkgname \
    --localstatedir=/var \
    --libdir=/var/lib \
    --datadir=/usr/share/$pkgname \
    --mandir=/usr/share/man \
    --with-initdir=/etc/thruk \
    --with-logdir=/var/log/thruk \
    --with-checkresultdir=/var/cache/naemon/checkresults \
    --with-tempdir=/var/lib/thruk \
    --with-logrotatedir=/etc/logrotate.d
#   --with-thruk-libs  # [PREFIX/lib/thruk/perl5]
  make
}

package() {
  cd "$srcdir"/$_pkgname

  make DESTDIR="$pkgdir"/ install
}
