# Maintainer: mutantmonkey <aur@mutantmonkey.in>
pkgname=parcimonie-git
pkgver=20121019
pkgrel=2
pkgdesc="A tool that incrementaly refreshes a GnuPG keyring"
arch=('any')
url="https://gaffer.ptitcanardnoir.org/intrigeri/code/parcimonie/"
license=('GPL' 'PerlArtistic')
depends=('perl' 'perl-any-moose' 'perl-namespace-autoclean'
         'perl-gnupg-interface' 'perl-clone' 'perl-config-general'
         'perl-file-homedir' 'perl-path-class' 'perl-net-dbus'
         'perl-tie-cache' 'perl-time-duration-parse'
         'perl-moosex-types-path-class' 'perl-moosex-getopt')
makedepends=('git')
provides=('parcimonie')

_gitroot=git://gaffer.ptitcanardnoir.org/App-Parcimonie.git
_gitname=parcimonie

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

}

package() {
  cd "$srcdir/$_gitname-build"
  
  install -Dm755 "bin/parcimonie" "$pkgdir/usr/bin/parcimonie"
  install -Dm755 "bin/parcimonie-applet" "$pkgdir/usr/bin/parcimonie-applet"
  install -Dm755 "bin/parcimonie-torified-gpg" "$pkgdir/usr/bin/parcimonie-torified-gpg"

  install -Dm644 "share/applications/parcimonie-applet.desktop" "$pkgdir/usr/share/applications/parcimonie-desktop.applet"
  install -Dm644 "share/applications/parcimonie.desktop" "$pkgdir/usr/share/applications/parcimonie.applet"

  mkdir -p $pkgdir/usr/lib/perl5/vendor_perl/App/Parcimonie
  install -Dm644 "lib/App/Parcimonie.pm" "$pkgdir/usr/lib/perl5/vendor_perl/App/Parcimonie.pm"
  cp -R "lib/App/Parcimonie" "$pkgdir/usr/lib/perl5/vendor_perl/App/"
}

# vim:set ts=2 sw=2 et:
