# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=tboot
pkgver=1.7.3
pkgrel=1
pkgdesc="A pre-kernel/VMM module that uses Intel(R) TXT to perform a measured and verified launch of an OS kernel/VMM."
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/tboot/"
license="BSD"
depends=('trousers')
source=("http://downloads.sourceforge.net/project/${pkgname}/${pkgname}/${pkgname}-${pkgver}.tar.gz"
        'disable_Werror.patch')
sha512sums=('68e0d1abee2dde5dae379b845a3a7bea1d7ae9af1e7d15f09171d996659cc9c251eb17a14a1a8a653f909d8215ab53f0ac2e34b3542a537f27ef24779fb0d9c0'
            '9a21a8d17b16c1f1604e470cb88b8a866867ea4b907777c9fda0be73c320433ea2420ab9f2683362fbe3ecfca034c84c4709639a9ce6534557edcb613466e37b')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  # Disable -Werror
  #patch -Np1 -i "${srcdir}/disable_Werror.patch"

  unset LDFLAGS
  make debug=y ${MAKEFLAGS}
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"

  make debug=y DISTDIR="${pkgdir}" install

  install -dm755 "${pkgdir}/usr/share/doc/${pkgname}"
  # Thanks to the Fedora packagers for this line!
  cp README COPYING docs/*.txt lcptools/lcptools2.txt lcptools/Linux_LCP_Tools_User_Manual.pdf "${pkgdir}/usr/share/doc/${pkgname}/"

  install -dm755 "${pkgdir}/usr/share/man/man8/"
  install -m644 docs/man/*.8 "${pkgdir}/usr/share/man/man8/"
}

# vim:set ts=2 sw=2 et:
