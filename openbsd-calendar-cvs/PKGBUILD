# Mantained by: Jens Staal <staal1978@gmail.com>

pkgname=openbsd-calendar-cvs
pkgver=20110304
pkgrel=1
pkgdesc="reminder service from OpenBSD"
arch=('i686' 'x86_64')
url="http://www.openbsd.org/cgi-bin/man.cgi?query=calendar"
license=('custom:BSD')
provides=('calendar')
depends=('libbsd-git' 'libnbcompat')
makedepends=('cvs' 'openssh' 'bmake')

source=('io.patch' 'calendar.patch' 'day.patch' 'ostern.patch' 'pesach.patch' 'paskha.patch' 'calendarh.patch' 'logincaph.patch')

md5sums=('b2951f4bc405e3304db169b28f92afd4' '786c38e27cc771ebaf7326beffb47da0' '650e0338f591c02e980a1727b6f2e067' \
'3f7b0145428c4afb3e86f0ceb0ea299e' 'fb746bcafba364d0fb9813f32544d755' '01b575aa611f5a136bb2a21abb239383' '06ddf744762a2bb1fa12777b64560604' \
'2c338a6b288ea116075dfe090784d673')

__cvsroot="anoncvs@anoncvs1.ca.openbsd.org:/cvs"
__cvsmod="calendar"

build() {
	cd $srcdir

	CVS_RSH=ssh cvs -d $__cvsroot get -P src/usr.bin/$__cvsmod
	CVS_RSH=ssh cvs -d $__cvsroot get -P src/include/login_cap.h
	CVS_RSH=ssh cvs -d $__cvsroot get -P src/include/tzfile.h

	rm -rf build
	cp -ar $srcdir/src/usr.bin/$__cvsmod build
# copy missing header files to temporary build directory, taken from openBSD libc
	cp $srcdir/src/include/*.h $srcdir/build/
	ln -s /usr/include/libbsd/bsd/sys $srcdir/build/sys

	cd build
	cp calendar.h calendar2.h
	patch -p0 io.c $srcdir/io.patch
	patch -p0 calendar.c $srcdir/calendar.patch
	patch -p0 day.c $srcdir/day.patch
	patch -p0 ostern.c $srcdir/ostern.patch
	patch -p0 pesach.c $srcdir/pesach.patch
	patch -p0 paskha.c $srcdir/paskha.patch
	patch -p0 calendar2.h $srcdir/calendarh.patch
	patch -p0 login_cap.h $srcdir/logincaph.patch

	export LDLIBS="-lbsd"
	bmake  
}

package() {
	cd $srcdir/build

	bmake install DESTDIR=$pkgdir
}
