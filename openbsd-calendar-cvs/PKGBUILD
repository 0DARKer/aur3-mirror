# Mantained by: Jens Staal <staal1978@gmail.com>

pkgname=openbsd-calendar-cvs
pkgver=280211
pkgrel=1
pkgdesc="reminder service from OpenBSD"
arch=('i686' 'x86_64')
url="http://www.openbsd.org/cgi-bin/man.cgi?query=calendar"
license=('custom:BSD')
provides=('calendar')
depends=('libbsd')
makedepends=('cvs' 'openssh' 'bmake')
source=('tzfile.h' 'login_cap.h' 'io.patch' 'calendar.patch' 'day.patch' 'ostern.patch' 'pesach.patch' 'paskha.patch' 'calendarh.patch')
md5sums=('ce9b64a74e4ab4889d997b063a12eb37' 'bab882f092fb08f4a0c82c3e5b4fabe6' 'b2951f4bc405e3304db169b28f92afd4' '786c38e27cc771ebaf7326beffb47da0'\
 '650e0338f591c02e980a1727b6f2e067' '058331f08b811cc4ebde9131e5d0c6c2' '1e8e387161324ae6fad2d1dd64c8c673' '567ec12055c9ad2e986534164305abbf' '7fb20c15a1e090d4bce5791dcbf01bef')

__cvsroot="anoncvs@anoncvs1.ca.openbsd.org:/cvs"
__cvsmod="calendar"

build() {
	cd $srcdir

	CVS_RSH=ssh cvs -d $__cvsroot get -P src/usr.bin/$__cvsmod

	rm -rf build
	cp -ar $srcdir/src/usr.bin/$__cvsmod build
# copy missing header files to temporary build directory, taken from openBSD libc
	cp $startdir/*.h $srcdir/build/

	cd build
	patch -p0 io.c $srcdir/io.patch
	patch -p0 calendar.c $srcdir/calendar.patch
	patch -p0 day.c $srcdir/day.patch
	patch -p0 ostern.c $srcdir/ostern.patch
	patch -p0 pesach.c $srcdir/pesach.patch
	patch -p0 paskha.c $srcdir/paskha.patch
#	patch -p0 calendar.h $srcdir/calendarh.patch

	bmake LDLIBS=-lbsd
}

package() {
	cd $srcdir/build

	bmake install DESTDIR=$pkgdir
}
