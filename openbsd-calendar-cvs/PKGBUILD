# Mantained by: Jens Staal <staal1978@gmail.com>

pkgname=openbsd-calendar-cvs
pkgver=280211
pkgrel=1
pkgdesc="reminder service from OpenBSD"
arch=('i686' 'x86_64')
url="http://www.openbsd.org/cgi-bin/man.cgi?query=calendar"
license=('custom:BSD')
provides=('calendar')
depends=('libbsd')
makedepends=('cvs' 'openssh' 'bmake')
sources=('tzfile.h' 'login_cap.h' 'io.patch' 'calendar.patch' 'day.patch' 'ostern.patch' 'pesach.patch')
md5sum=('828a1dd4b42152580c30394cf921bd20' '71bd40d2dfd92951b84eb77e5ee19328' 'b2951f4bc405e3304db169b28f92afd4' '786c38e27cc771ebaf7326beffb47da0' '650e0338f591c02e980a1727b6f2e067' '058331f08b811cc4ebde9131e5d0c6c2' '1603fb887d52b80f0e913b4c2f5476bb')

__cvsroot="anoncvs@anoncvs1.ca.openbsd.org:/cvs"
__cvsmod="calendar"

build() {
	cd $srcdir

	CVS_RSH=ssh cvs -d $__cvsroot get -P src/usr.bin/$__cvsmod

	rm -rf build
	cp -ar $srcdir/src/usr.bin/$__cvsmod build
# copy missing header files to temporary build directory, taken from Android's BSD libc 'bionic'
	cp $startdir/*.h $srcdir/build/

	cd build
	patch -p0 io.c $startdir/io.patch
	patch -p0 calendar.c $startdir/calendar.patch
	patch -p0 day.c $startdir/day.patch
	patch -p0 ostern.c $startdir/ostern.patch
	patch -p0 pesach.c $startdir/pesach.patch

	bmake LDLIBS=-lbsd
}

package() {
	cd $srcdir/build

	bmake install DESTDIR=$pkgdir
}