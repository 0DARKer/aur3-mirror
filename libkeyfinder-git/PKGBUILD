#Maintainer: Lubosz Sarnecki <lubosz@gmail.com> 

_realname=libkeyfinder
pkgname=$_realname-git
pkgver=20130213
pkgrel=1
pkgdesc="Musical key detection for digital audio."
arch=('i686' 'x86_64')
url="http://www.ibrahimshaath.co.uk/keyfinder/"
license=('GPL3')
depends=('qt' 'fftw' 'boost-libs') 
makedepends=('git')
provides=($_realname)
conflicts=($_realname)

_gitname=libKeyFinder
_gitroot=git://github.com/ibsh/libKeyFinder.git

source=("build.patch")
sha256sums=('600fe84fcd4762960a42b43bcfc66e2324b5f2453c53557f5bed0bb588451eb5')

build() {
  cd "${srcdir}"

  msg "Connecting to GIT server...."

  if [ -d ${srcdir}/$_gitname ] ; then
    cd $_gitname && git pull origin master
    msg "Local repository updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout."
  msg "Starting make..."

  rm -rf "${srcdir}/${_gitname}-build"
  cp -r "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
  cd "${srcdir}/${_gitname}-build"
  
  patch -p1 < ../../build.patch

  qmake PREFIX=/usr
  make
}

package() {
  cd "${srcdir}/${_gitname}-build"

  make INSTALL_ROOT="${pkgdir}" install
  
  mkdir -p ${pkgdir}/usr/include/keyfinder
  cp ${srcdir}/${_gitname}/*.h ${pkgdir}/usr/include/keyfinder
}
