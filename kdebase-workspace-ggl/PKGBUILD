# $Id: PKGBUILD 59826 2009-11-28 01:40:21Z andrea $
# Maintainer: Pierre Schmitz <pierre@archlinux.de>

pkgname=kdebase-workspace-ggl
pkgver=4.5.2
pkgrel=1
pkgdesc="Google Gadgets for KDE Base Workspace"
arch=('i686' 'x86_64')
url='http://www.kde.org'
license=('GPL' 'LGPL' 'FDL')
groups=('kde')
# note on libxdamage:
# 	not detected by namcap because libgl depends on it
#	but nvidia providing libgl does not depend on libxdamage
depends=('kdebase-workspace' 'google-gadgets-qt')
makedepends=('pkgconfig' 'cmake' 'automoc4' 'boost')
install='kdebase-workspace.install'
backup=('usr/share/config/kdm/kdmrc'
        'etc/pam.d/kde'
        'etc/pam.d/kde-np'
        'etc/pam.d/kscreensaver')
source=("http://download.kde.org/stable/${pkgver}/src/kdebase-workspace-${pkgver}.tar.bz2"
        'fixpath.patch')
install="kdebase-workspace-ggl.install"

build() {
echo $noextract
	cd "${srcdir}/kdebase-workspace-${pkgver}"
	patch -p0 -i "${srcdir}/fixpath.patch"

	cd "${srcdir}"
	[[ -d build ]] && rm -rf build
	mkdir build
	cd build
	cmake ../kdebase-workspace-${pkgver} \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DWITH_Xmms=OFF \
		-DWITH_Googlegadgets=ON \
		-DWITH_QEdje=OFF \
		-DWITH_PolkitQt=OFF

	make plasma_package_ggl plasma_scriptengine_ggl
}

package() {
	cd "$srcdir/build"
# 	make DESTDIR=${pkgdir} preinstall/fast
	export DESTDIR=${pkgdir}
	cmake -P plasma/generic/scriptengines/google_gadgets/cmake_install.cmake
}
md5sums=('0174c22b75e9a2b477ee166da2ca7319'
         '47a1f12673f66e62e2463efd7037a26a')
