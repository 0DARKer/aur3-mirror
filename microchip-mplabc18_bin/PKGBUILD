# Maintainer: BxS <bxsbxs@gmail.com>

pkgname=microchip-mplabc18_bin
pkgver=3.40
pkgrel=1
pkgdesc="C compiler for PIC18 MCUs"
arch=('i686' 'x86_64')
url="http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=1406&dDocName=en010014"
license=('custom')
depends=('xdg-utils' 'hicolor-icon-theme')
[ "$CARCH" = "x86_64" ] && depends=("${depends[@]}" 'lib32-glibc')
provides=(mplabc18)
conflicts=(mplabc18)
replaces=(mplabc18)
options=(!strip docs libtool emptydirs !zipman)
install=microchip-mplabc18_bin.install
_installer="mplabc18-v$pkgver-linux-full-installer.run"
source=("http://ww1.microchip.com/downloads/mplab/X_Beta/$_installer")
md5sums=('f29df9a4e5c9641a8909bd0a5452d4a9')

build() {
  cd $srcdir

  chmod 0755 $_installer
}

package() {
  cd $pkgdir

  _install_dir="$pkgdir/opt/microchip/mplabc18/v$pkgver"

  mkdir -p $_install_dir

  echo ""
  echo "-----------------------------------"
  echo "------------ Attention ------------"
  echo ""
  echo "When the installer ask for the installation directory put:"
  echo ""
  echo $_install_dir
  echo ""
  echo "------------ Attention ------------"
  echo "-----------------------------------"
  echo ""
  echo "Press [Enter] to continue"
  read a

  $srcdir/$_installer --prefix $_install_dir --mode text

  rm $_install_dir/Uninstall*
  mkdir -p $pkgdir/usr/share/licenses/$pkgname
  ln -s "/opt/microchip/mplabc18/v$pkgver/MPLABC18CompilerLicense.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
} 
