pkgname=samsung-unified-driver
pkgver=3.00.71
pkgrel=1

pkgdesc="Unified Linux Driver for Samsung printers and scanners."
arch=(i686 x86_64)
url="http://www.samsung.com"
license=('custom:samsung')
depends=('libstdc++5' 'libtiff' 'cups' 'ghostscript' 'sane')
optdepends=('hal-cups-utils: Allows scanner and printer functions with cups>=1.4 without blocking usblp')
install=${pkgname}.install

source=('http://downloadcenter.samsung.com/content/DR/201004/20100421110310031/UnifiedLinuxDriver_1.08.tar.gz'
	98_smfpautoconf.rules 99_smfpautoconf.rules)

md5sums=('0ae67f6f45e109feaf010ba2f13ae8bd' 'e793f2d7dc7013e019a3868e91ca8c5d' '7f18b55a24a04303cf8b42fbd6119a00')

if [ "$CARCH" = "x86_64" ]; then
	CARCHCUSTOM="x86_64"
	LIBDIRCUSTOM="lib64"
else
	CARCHCUSTOM="i386"
	LIBDIRCUSTOM="lib"
fi

build() {
# mpf
	mkdir -p "${pkgdir}/usr/lib"
	mkdir -p "${pkgdir}/etc/udev/rules.d/"

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/libmfp.so.1.0.1" \
	"${pkgdir}/usr/lib/libmfp.so.1.0.1"
	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/opt/smfp-common/${LIBDIRCUSTOM}/libnetsnmp.so.10.0.2" \
	"${pkgdir}/usr/lib/libnetsnmp.so.10.0.2"

	install -m 644 "${srcdir}/98_smfpautoconf.rules" "${pkgdir}/etc/udev/rules.d/98_smfpautoconf.rules"
	install -m 644 "${srcdir}/99_smfpautoconf.rules" "${pkgdir}/etc/udev/rules.d/99_smfpautoconf.rules"
# cups
	mkdir -p "${pkgdir}/usr/lib/cups/filter"
	mkdir -p "${pkgdir}/usr/lib/cups/backend/"
	mkdir -p "${pkgdir}/etc/cups/"
	mkdir -p "${pkgdir}/usr/share/cups/model/samsung/cms"

	install -m 444 -t "${pkgdir}/usr/share/cups/model/samsung/cms/" ${srcdir}/cdroot/Linux/noarch/at_opt/share/ppd/cms/*

	install -m 644 -t "${pkgdir}/usr/share/cups/model/" ${srcdir}/cdroot/Linux/noarch/at_opt/share/ppd/*.ppd
	

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/backend/mfp" \
	"${pkgdir}/usr/lib/cups/backend/mfp"
	install -m 755 -t "${pkgdir}/usr/lib/cups/filter/" ${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/filter/*

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/filter/smfpautoconf" \
	"${pkgdir}/usr/lib/cups/filter/smfpautoconf"


	install -m 644 -t "${pkgdir}/etc/cups/" ${srcdir}/cdroot/Linux/noarch/at_root/etc/cups/*

# sane
	mkdir -p "${pkgdir}/usr/lib/sane/"
	mkdir -p "${pkgdir}/etc/sane.d/"

	install -m 644 "${srcdir}/cdroot/Linux/noarch/at_root/etc/sane.d/smfp.conf" "${pkgdir}/etc/sane.d/smfp.conf"

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/sane/libsane-smfp.so.1.0.1" \
	"${pkgdir}/usr/lib/sane/libsane-smfp.so.1.0.1"
}
