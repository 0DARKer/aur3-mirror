pkgname=samsung-unified-driver
pkgver=3.00.90
pkgrel=2

pkgdesc="Unified Linux Driver for Samsung printers and scanners. The driver itself is downloaded from http://www.bchemnet.com/suldr/smfpv3.html The content is identical to the version from the samsung website."
arch=(i686 x86_64)
url="http://www.samsung.com"
license=('custom:samsung')
depends=('libstdc++5' 'libtiff' 'cups' 'ghostscript' 'sane')
install=${pkgname}.install

source=("http://www.bchemnet.com/suldr/UnifiedLinuxDriver-${pkgver}.tar.gz"
	'99_smfpautoconf.rules')

md5sums=('a0c3c978ae0d2ce9d125f7b2ad9fe6fb' 'd919992200ccfb376a0a532eeb65d77d')

if [ "$CARCH" = "x86_64" ]; then
	CARCHCUSTOM="x86_64"
	LIBDIRCUSTOM="lib64"
else
	CARCHCUSTOM="i386"
	LIBDIRCUSTOM="lib"
fi

build() {
# mpf
	install -d "${pkgdir}/usr/lib"
	install -d "${pkgdir}/etc/udev/rules.d/"

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/libmfp.so.1.0.1" \
	"${pkgdir}/usr/lib/libmfp.so.1.0.1"
	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/opt/smfp-common/${LIBDIRCUSTOM}/libnetsnmp.so.10.0.2" \
	"${pkgdir}/usr/lib/libnetsnmp.so.10.0.2"

	install -m 644 "${srcdir}/99_smfpautoconf.rules" "${pkgdir}/etc/udev/rules.d/99_smfpautoconf.rules"

# cups
	install -d "${pkgdir}/usr/lib/cups/filter"
	install -d "${pkgdir}/usr/lib/cups/backend/"
	install -d "${pkgdir}/etc/cups/"
	install -d "${pkgdir}/usr/share/cups/model/samsung/cms"

	install -m 444 -t "${pkgdir}/usr/share/cups/model/samsung/cms/" ${srcdir}/cdroot/Linux/noarch/at_opt/share/ppd/cms/*

	install -m 644 -t "${pkgdir}/usr/share/cups/model/" ${srcdir}/cdroot/Linux/noarch/at_opt/share/ppd/*.ppd
	

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/backend/mfp" \
	"${pkgdir}/usr/lib/cups/backend/mfp"
	install -m 755 -t "${pkgdir}/usr/lib/cups/filter/" ${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/filter/*

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/cups/filter/smfpautoconf" \
	"${pkgdir}/usr/lib/cups/filter/smfpautoconf"


	install -m 644 -t "${pkgdir}/etc/cups/" ${srcdir}/cdroot/Linux/noarch/at_root/etc/cups/*

# sane
	install -d "${pkgdir}/usr/lib/sane/"
	install -d "${pkgdir}/etc/sane.d/dll.d"

	install -m 644 "${srcdir}/cdroot/Linux/noarch/at_root/etc/sane.d/smfp.conf" "${pkgdir}/etc/sane.d/smfp.conf"

	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/${LIBDIRCUSTOM}/sane/libsane-smfp.so.1.0.1" \
	"${pkgdir}/usr/lib/sane/libsane-smfp.so.1.0.1"

	install -d "${pkgdir}/opt/Samsung/mfp/bin/"
	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_opt/bin/netdiscovery" "${pkgdir}/opt/Samsung/mfp/bin/netdiscovery"

	install -d "${pkgdir}/usr/sbin/"
	install -m 755 "${srcdir}/cdroot/Linux/${CARCHCUSTOM}/at_root/usr/sbin/smfpd" "${pkgdir}/usr/sbin/smfpd"

	install -d "${pkgdir}/opt/Samsung/mfp/share/"
	install -m 644 "${srcdir}/cdroot/Linux/OEM.ini" "${pkgdir}/opt/Samsung/mfp/share/OEM.ini"

#create symbolic links
# mpf
	cd "${pkgdir}/usr/lib"
	ln -s ./libmfp.so.1.0.1 ./libmfp.so.1

# 
	cd "${pkgdir}/usr/lib/sane"
	ln -s ./libsane-smfp.so.1.0.1 ./libsane-smfp.so.1
	ln -s ./libsane-smfp.so.1 ./libsane-smfp.so

	echo "smfp" >> "${pkgdir}/etc/sane.d/dll.d/smfp"
	chmod 644 "${pkgdir}/etc/sane.d/dll.d/smfp"
}

