# Contributor: Jozef Korencik <joffko@gmail.com>
# Maintainer: Dany Martineau <dany.luc.martineau at gmail.com>

pkgname=kipi-plugins2-svn
pkgver=1175195
pkgrel=1
pkgdesc="libkipi plugins for digikam2 and kde apps. Svn version"
arch=('i686' 'x86_64')
url="http://www.kipi-plugins.org/"
license=('GPL')
depends=('kdegraphics-libs-digikam2-svn' 'kdepimlibs' 'opencv' 'libgpod' 'libkface-svn')
makedepends=('subversion' 'cmake' 'automoc4' 'pkgconfig')
conflicts=('kipi-plugins' 'kipi-plugins-svn')    
provides=('kipi-plugins')
optdepends=('imagemagick: for picture manipulation')
install=('kipi-plugins-svn.install')
_svntrunk=svn://anonsvn.kde.org/home/kde/branches/extragear/graphics/kipi-plugins/
_svnmod=kipi-plugins-svn

build() {
  cd ${srcdir}

  if [ -d ${_svnmod}/.svn ]; then
    (cd ${_svnmod} && svn revert -R .)
    (cd ${_svnmod} && svn -r ${pkgver} up)
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}/${_svnmod} 

  cmake -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_SKIP_RPATH=ON
  make
  make DESTDIR=${pkgdir} install 
}
