# Maintainer: Zhengyu Xu <xzy3186@gmail.com>
#option to enable gnome-shell support
_if_gnome_shell="n"

pkgname=insync
pkgver=0.9.19
pkgrel=1
pkgdesc="An unofficial Google Drive client that runs on Linux, with support for cinnamon and gnome"
url="https://forums.insynchq.com/discussion/1437/insync-for-linux-beta-4-0-9-19"
license=('custom:insync')
if [ $_if_gnome_shell = "y" ]; then
depends=(
    'xdotool'
    'nautilus'
    'python2-nautilus'
    'gnome-shell')
elif [ $_if_gnome_shell = "n" ]; then
depends=(
    'xdotool'
    'nautilus'
    'python2-nautilus')
fi

options=(!strip !zipman)

arch=('i686' 'x86_64')
if [ "$CARCH" = 'i686' ]; then
   source=("${pkgname}-${pkgver}-common.deb::http://s.insynchq.com/builds/${pkgname}-beta-gnome-cinnamon-common_${pkgver}_i386.deb"
           "${pkgname}-${pkgver}-gnome.deb::http://s.insynchq.com/builds/${pkgname}-beta-gnome_${pkgver}_all.deb")
   sha256sums=('998785b1ff103d979f5d83e69ad0125b5261cfb15394c793bf6dc6ae2feabc77'
               'f8e5226d871fa8de2c4263561ad4213d65195fb2bb21e479cf14a19b20301753')
elif [ "$CARCH" = "x86_64" ]; then
   source=("${pkgname}-${pkgver}-common.deb::http://s.insynchq.com/builds/${pkgname}-beta-gnome-cinnamon-common_${pkgver}_amd64.deb"
           "${pkgname}-${pkgver}-gnome.deb::http://s.insynchq.com/builds/${pkgname}-beta-gnome_${pkgver}_all.deb")
   sha256sums=('e30177ff6b199882754e32fad91d67a16d4bc0450e2f46863ca0b2e4bc1dab1c'
               'f8e5226d871fa8de2c4263561ad4213d65195fb2bb21e479cf14a19b20301753')
fi

noextract=("${pkgname}-${pkgver}-common.deb"
          "${pkgname}-${pkgver}-gnome.deb")

package() {
   cd $srcdir
   [ -d ${pkgname}-${pkgver}-common ] || mkdir ${pkgname}-${pkgver}-common
   [ -d ${pkgname}-${pkgver}-gnome ] || mkdir ${pkgname}-${pkgver}-gnome
   mv ${pkgname}-${pkgver}-common.deb ${pkgname}-${pkgver}-common/
   cd $srcdir/${pkgname}-${pkgver}-common
   ar x ${pkgname}-${pkgver}-common.deb
   tar xvf data.tar.gz
   cp -rp usr $pkgdir
   if [ $_if_gnome_shell = "y" ]; then
      cd $srcdir
      mv ${pkgname}-${pkgver}-gnome.deb ${pkgname}-${pkgver}-gnome/
      cd $srcdir/${pkgname}-${pkgver}-gnome
      ar x ${pkgname}-${pkgver}-gnome.deb
      tar xvf data.tar.gz
      cp -rp usr $pkgdir
   fi
   sed -i "/^TryExec/ d" $pkgdir/usr/share/applications/insync.desktop
}

