# Maintainer: Robbo <robbo.clancy at gmail dot com>
# Forked from https://aur.archlinux.org/packages/komodo-ide

pkgname=komodo-ide-nightly
pkgver=9.0.0_alpha1_85998
pkgrel=1
pkgdesc="ActiveState Komodo IDE 9.0 Nightly"
arch=('i686' 'x86_64')
url="http://komodoide.com"
license=('MPL')
depends=('glibc>=2.4' 'libjpeg>=6.2' 'gcc-libs' 'gtk2')
[ "$CARCH" = "i686" ] && _arch="x86" && sha256sums=('de443d4b3942db5be6750e40e41d07d61a969d22f53f589b9b654890d13601c1')
[ "$CARCH" = "x86_64" ] && _arch="x86_64" && sha256sums=('8bbae7453c99588a048fd8807f1db6e4f04c3734a403014b8964010c5e1431e1')
source=("http://downloads.activestate.com/Komodo/nightly/komodoide/latest-trunk/Komodo-IDE-${pkgver//_/-}-linux-${_arch}.tar.gz")
options=(!strip)

package() {
  cd "${srcdir}/Komodo-IDE-${pkgver//_/-}-linux-${_arch}"
  ./install.sh -s -I "${pkgdir}/opt/${pkgname}" --dest-dir "/opt/${pkgname}"
  install -d "${pkgdir}"/usr/{bin,share/applications}
  ln -s "/opt/${pkgname}/share/desktop/komodo-ide-9.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"
  ln -sf "/opt/${pkgname}/lib/mozilla/komodo" "${pkgdir}/opt/${pkgname}/bin/komodo"
  ln -s "/opt/${pkgname}/lib/mozilla/komodo" "${pkgdir}/usr/bin/${pkgname}"
  grep -r -lZ "$pkgdir" "$pkgdir" 2>/dev/null | while read -rd '' file; do sed -i "s|$pkgdir||g" "$file"; done
}

post_install() {
	cat << EOF
*** Komodoe IDE License ***
==> Please place the license file named as ActiveState.lic into ${HOME}/.ActiveState/
==> or use the provided license file script to install it.
EOF
}
