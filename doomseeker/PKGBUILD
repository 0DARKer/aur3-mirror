# Contributor: MP2E <MP2E {AT] archlinux.us>
# Modified by [Database Error]

pkgname=doomseeker
pkgver=0.7b
pkgrel=2
pkgdesc="A cross-platform server browser for Chocolate Doom, Odamex, Skulltag, Vavoom, and ZDaemon."
arch=('i686' 'x86_64')
url="http://doomseeker.drdteam.org/"
conflicts=('doomseeker-svn')
depends=('qt' 'zlib')
makedepends=('cmake' 'make' 'gcc' 'mercurial')
optdepends=('chocolate-doom: to play on Chocolate Doom servers'
	'odamex: to play on Odamex servers'
	'skulltag: to play on Skulltag servers'	
	'vavoom: to play on Vavoom servers'
	'wine: to play on ZDaemon servers')
license=('GPL')
build() {
	hg clone https://bitbucket.org/Blzut3/doomseeker -u 78899a06602f
	cd doomseeker
	cmake .
	make || return 1
}

package() {
	install -d $startdir/pkg/opt/doomseeker
	install -d $startdir/pkg/usr/bin/
	cp $startdir/src/doomseeker/doomseeker $startdir/pkg/opt/doomseeker
	cp $startdir/src/doomseeker/libwadseeker.so $startdir/pkg/opt/doomseeker/
	cp -r $startdir/src/doomseeker/media $startdir/pkg/opt/doomseeker/
	cp -r $startdir/src/doomseeker/engines $startdir/pkg/opt/doomseeker/
	echo cd /opt/doomseeker >> $startdir/doomseeker
	echo ./doomseeker >> $startdir/doomseeker
	chmod +x $startdir/doomseeker
	install -D $startdir/doomseeker $startdir/pkg/usr/bin/doomseeker
	mkdir -p $startdir/pkg/usr/{local/share/doomseeker/,share/applications/}
	cp $startdir/src/doomseeker/media/icon.png $startdir/pkg/usr/local/share/doomseeker/icon.png
	cp $startdir/src/doomseeker/media/Doomseeker.desktop $startdir/pkg/usr/share/applications/doomseeker.desktop

	chmod -R 777 $startdir/pkg/opt/doomseeker
	chmod 777 $startdir/pkg/usr/bin/doomseeker
}
