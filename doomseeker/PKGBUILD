# Current Maintainer: Robert La Spina <rkidlaspina [at] gmail [dot] com>
# Contributor: MP2E <MP2E {AT] archlinux.us>

pkgname=doomseeker
pkgver=0.9b
pkgrel=2
pkgdesc="A cross-platform server browser for various multiplayer Doom source-ports."
arch=('i686' 'x86_64')
url="http://doomseeker.drdteam.org/"
conflicts=('doomseeker-svn doomseeker-hg')
depends=('qt4' 'zlib')
makedepends=('cmake' 'make' 'gcc' 'mercurial')
optdepends=('chocolate-doom'
	    'odamex'
	    'zandronum'	
	    'vavoom'
	    'wine')
license=('GPL')

build() {
	[ -d $pkgname ] || hg clone https://bitbucket.org/Blzut3/$pkgname
	cd $pkgname
	hg up -r $pkgver
	# compilation fails with clang
	cmake -DCMAKE_C_COMPILER=gcc -DCMAKE_CXX_COMPILER=g++ .
	make
}

package() {
	install -d $pkgdir/opt/doomseeker
	install -d $pkgdir/usr/bin/
	cp $srcdir/doomseeker/doomseeker $pkgdir/opt/doomseeker
	cp $srcdir/doomseeker/libwadseeker.so $pkgdir/opt/doomseeker/
	cp -r $srcdir/doomseeker/media $pkgdir/opt/doomseeker/
	cp -r $srcdir/doomseeker/engines $pkgdir/opt/doomseeker/
	mkdir -p $pkgdir/usr/bin/
	echo cd /opt/doomseeker >> $pkgdir/usr/bin/doomseeker
	echo ./doomseeker >> $pkgdir/usr/bin/doomseeker
	chmod +x $pkgdir/usr/bin/doomseeker
	mkdir -p $pkgdir/usr/{local/share/doomseeker/,share/applications/}
	cp $srcdir/doomseeker/media/icon.png $pkgdir/usr/local/share/doomseeker/icon.png
	cp $srcdir/doomseeker/media/Doomseeker.desktop $pkgdir/usr/share/applications/doomseeker.desktop

	chmod -R 777 $pkgdir/opt/doomseeker
	chmod 755 $pkgdir/usr/bin/doomseeker
}
