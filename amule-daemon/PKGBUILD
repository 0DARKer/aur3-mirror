# Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=amule-daemon
pkgver=10832
pkgrel=1
pkgdesc='An eMule-like client for the eD2k and Kademlia p2p networks (Daemon Function)'
url='http://www.amule.org'
arch=('i686' 'x86_64')
license=('GPL')
depends=('wxgtk' 'crypto++' 'libupnp')
provides=('amule')
conflicts=('amule')
optdepends=('kamule: AmuleGUI for KDE')
source=("http://amule.sourceforge.net/tarballs/aMule-SVN-r${pkgver}.tar.bz2"
        'amuled.service'
        'amuled@.service'
        'amuled.tmpfile')
sha1sums=('09a9b29505e7bfacdd1740d0e9a461bfdb67feea'
          '30dec63345793e904976f00ecc71da18f9b54f15'
          'db7e031c6af272ab01119e1330c4affc40d79c9f'
          'c1d0f14042d93d57f2f62906d476a3b3933dac82')
install="amule-daemon.install"

build() {
  rm -fr build
  mkdir build
  cd build

  ../aMule-SVN-r${pkgver}/configure \
      --prefix=/usr \
      --mandir=/usr/share/man \
      --disable-monolithic \
      --enable-alcc \
      --disable-debug \
      --enable-upnp \
      --enable-geoip \
      --enable-optimize \
      --enable-webserver \
      --enable-amule-daemon \
      --enable-fileview \
      --enable-amulecmd
    make
}

package() {
  cd build
  make DESTDIR="${pkgdir}" install

  install -Dm644 "${srcdir}/amuled.service" "${pkgdir}/usr/lib/systemd/system/amuled.service"
  install -Dm644 "${srcdir}/amuled@.service" "${pkgdir}/usr/lib/systemd/system/amuled@.service"
  install -Dm644 "${srcdir}/amuled.tmpfile" "${pkgdir}/usr/lib/tmpfiles.d/amuled.conf"

  install -dm750 -o129 -g129 "${pkgdir}/var/lib/amuled"
  rm -fr "${pkgdir}/usr/share"/{pixmaps,applications}
}
