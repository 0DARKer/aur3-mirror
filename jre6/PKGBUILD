# Maintainer: Ethan Hall
# Contributors: Guillaume ALAUX, Daniel J Griffiths, Jason Chu, Geoffroy Carrier, Thomas Dziedzic, Dan Serban
#jre-6u29-linux-x64

pkgname=jre6
pkgver=6u29
pkgrel=1
pkgdesc="Java 6 Runtime Environment"
url=http://www.oracle.com/technetwork/java/javase/downloads/index.html
arch=(i686 x86_64)
license=(custom)
depends=(glibc libxtst)
makedepends=(lynx)
provides=('java-runtime=6' j2re)
conflicts=('java-runtime=6' j2re)
replaces=(j2re)
install=jre.install
source=("http://download.oracle.com/otn-pub/java/jdk/6u29-b11/jdk-$pkgver-linux-i586.bin"
	'jre.profile'
        'jre.profile.csh'
        'javaws-launcher')
md5sums=('0aaabd639e50aaf9fc22153ff0cf76da'
				 '52750a050de01757ad4726c906fb0d44'
         'a1a56ff5c650f8416175bb2e5a5166c7'
         '45c15a6b4767288f2f745598455ea2bf')

         _arch=i586
[ "${CARCH}" == 'x86_64' ] && _arch=x64

[ "$CARCH" == 'x86_64' ] && source[0]="http://download.oracle.com/otn-pub/java/jdk/6u29-b11/jdk-$pkgver-linux-x64.bin" && md5sums[0]='ab2ddd0d83d7b8eab3876a37ed1deec5'

build()
{
  rm -rf unbundle-jdk

  cd $srcdir
  
  mkdir unbundle-jdk
  cd unbundle-jdk

  sh ../jdk-$pkgver-linux-$_arch.bin --accept-license

  cd ..

  wget -O construct.sh "http://java.net/projects/jdk-distros/sources/svn/content/trunk/utils/construct.sh?raw=true"

  echo ${linux-jdk}
  sh construct.sh unbundle-jdk linux-jdk linux-jre

  mkdir -p $pkgdir/opt/java6
  mv linux-jdk/jre $pkgdir/opt/java6

  install -D -m755 $srcdir/jre.profile $pkgdir/etc/profile.d/${pkgname}.sh

  #install -Dm644 "${startdir}"/jre.profile "${pkgdir}"/etc/profile.d/jre.sh
  #install -Dm644 "${startdir}"/jre.profile.csh "${pkgdir}"/etc/profile.d/jre.csh

  mkdir -p $pkgdir/usr/lib/mozilla/plugins

  mkdir -p $pkgdir/usr/share/licenses/jre6
  cp $pkgdir/opt/java6/jre/COPYRIGHT $pkgdir/usr/share/licenses/jre6
  cp $pkgdir/opt/java6/jre/LICENSE $pkgdir/usr/share/licenses/jre6
  cp $pkgdir/opt/java6/jre/THIRDPARTYLICENSEREADME.txt $pkgdir/usr/share/licenses/jre6

  install "${startdir}"/javaws-launcher "${pkgdir}"/opt/java6/jre/bin/javaws-launcher
}

