# Contributor: Marius Dransfeld <marius.dransfeld@googlemail.com>


pkgname=unity2d-bzr
pkgver=370
pkgrel=1
pkgdesc="unity-2d project is a 2d implementation of Unity"
arch=('i686' 'x86_64')
url="http://launchpad.net/unity-2d"
license=('Gpl')
depends=('glib2' 'qt' 'libwnck' 'libdbusmenu-qt' 'libindicator' 'libqtbamf-bzr' 'libqtdee-bzr' 'libqtgconf-bzr')
makedepends=('cmake' 'bzr')



source=("CMakeLists.patch")
md5sums=('fa8a9f55782a495e0ae84565acfb2780')

_bzrtrunk=lp:unity-2d
_bzrmod=unity-2d

build() {
  cd "$srcdir"
  msg "Connecting to Bazaar server...."

  if [ -d $_bzrmod ] ; then
    cd ${_bzrmod} && bzr  pull ${_bzrtrunk} -r ${pkgver}
    msg "The local files are updated."
  else
    bzr  branch ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  fi

  msg "Bazaar checkout done or server timeout"
  msg "Starting make..."
  cd ${srcdir}/
  rm -rf ${_bzrmod}-build
  cp -r ${_bzrmod} ${_bzrmod}-build
  cd ${_bzrmod}-build
  patch -Np0 -i "${srcdir}/CMakeLists.patch"
  rm -rf build
  mkdir build
  cd build
  cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr ..
  make
  make DESTDIR=${pkgdir} install
}


