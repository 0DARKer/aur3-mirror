# Maintainer: Denis Kobozev <d.v.kobozev at gmail dot com>
# Contributor: Hauptmech <hauptmech@gmail.com>

pkgname=openrave-git
pkgver=3484
pkgrel=1
url="http://openrave.org"
pkgdesc="An environment for testing, developing, and deploying motion planning algorithms in real-world robotics applications."
arch=('i686' 'x86_64')
depends=('boost' 'soqt' 'bullet' 'ffmpeg' 'python2-numpy' 'python2-sympy'
         'python2-h5py' 'ode' 'collada-dom' 'assimp' 'mpfr' 'openscenegraph')
makedepends=('git' 'cmake')
optdepends=('cmake: plugin compilation'
            'qhull')
license=('LGPL' 'Apache')

_gitroot=https://github.com/rdiankov/openrave.git
_gitname=openrave

build() {
  cd $srcdir
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  sed -i -e 's/BIND_PER_PRIMITIVE/BIND_OVERALL/' plugins/qtosgrave/Item.cpp 
  mkdir -p build; cd build
  cmake .. \
      -DCMAKE_BUILD_TYPE=Release \
      -DCMAKE_INSTALL_PREFIX=/usr \
      -DPYTHON_EXECUTABLE:FILEPATH=/usr/bin/python2 \
      -DCMAKE_CXX_FLAGS=-fpermissive \

  make
}
package() {

  cd "$srcdir/${_gitname}-build"
  make install DESTDIR=$pkgdir
}
# vim:set ts=2 sw=2 et:
