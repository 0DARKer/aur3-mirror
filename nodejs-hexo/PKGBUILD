# Maintainer: shmilee <shmilee.zju@gmail.com>

_npmname=hexo
pkgname=nodejs-hexo
pkgver=2.4.5
pkgrel=1
pkgdesc="A fast, simple & powerful blog framework, powered by Node.js."
arch=('any')
url="http://zespia.tw/hexo/"
license=('MIT')
depends=('nodejs')
source=('gitcafe.patch')
md5sums=('692007ab65ef6f5a36e75418fedfab84')
options=(!strip)

_gitcafe='y'

package() {
  local _npmdir="$pkgdir/usr/lib/node_modules/"
  install -dm755 "$_npmdir"
  cd "$_npmdir"
  npm install --user root -g --prefix "$pkgdir/usr" $_npmname@$pkgver

  # add gitcafe
  if [ $_gitcafe == 'y' ]; then
    cd hexo/lib/plugins/deployer/
    patch github.js < "$srcdir"/gitcafe.patch -o gitcafe.js
    chmod 644 gitcafe.js
    echo -e "\ndeployer.register('gitcafe', require('./gitcafe'));" >> index.js
  fi
}
