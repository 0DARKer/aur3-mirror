# Maintainer: Darshit Shah <darnir@gmail.com>
groups=()
pkgname=wget-git
pkgver=1.14.41
pkgrel=1
pkgdesc="A network utility to retrieve files from the Web"
arch=('i686' 'x86_64')
url="http://www.gnu.org/software/wget/wget.html"
license=('GPL3')
depends=('openssl' 'libidn' 'pcre' 'util-linux')
optdepends=("ca-certificates: HTTPS Downloads")
makedepends=('git' 'perl')
provides=('wget')
conflicts=('wget')
backup=('etc/wgetrc')
options=(!strip)
install=wget.install
CFLAGS=$CFLAGS" -g"

_gitroot=git://git.savannah.gnu.org/wget.git
_gitname=wget

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."
  
  cd $srcdir/$_gitname
  ./bootstrap

  rm -rf "$srcdir/$_gitname-build"
  cp -R "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  ./configure --prefix=/usr --without-included-regex --enable-threads=posix --enable-dependency-tracking --with-ssl=openssl --enable-nls --sysconfdir=/etc
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  make DESTDIR="$pkgdir/" install

  cat >> "$pkgdir/etc/wgetrc" <<EOF

# default root certs location
ca_certificate=/etc/ssl/certs/ca-certificates.crt
EOF
}

# vim:set ts=2 sw=2 et:
