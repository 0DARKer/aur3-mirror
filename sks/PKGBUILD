pkgname=sks
pkgver=1.1.1
pkgrel=1
arch=('i686' 'x86_64')
license=('GPL')
pkgdesc="Synchronizing OpenPGP Key Server"
depends=('glibc')
makedepends=('ocaml-cryptokit' 'db4.6')
url="https://code.google.com/p/sks-keyserver/"
install=sks.install
backup=(etc/conf.d/sks etc/sks/sksconf)
source=(http://sks-keyserver.googlecode.com/files/$pkgname-$pkgver.tgz sks.conf.d sks.init http://archive.ubuntu.com/ubuntu/pool/universe/s/sks/${pkgname}_$pkgver+dpkgv3-6.debian.tar.gz)
md5sums=('120361b88cf6820c108c6746ac464488'
         '04cf445e39de1446e604aca204832fc7'
         '08720f07d25512b0a26db7d60bb2774c'
         '9eac82d726d62043f5db3edf701f89d7')

build() {
  cd $srcdir/$pkgname-$pkgver

  cp Makefile.local.unused Makefile.local
  sed -i -e 's#/usr/include#/usr/include/db4.6#g' Makefile.local
  sed -i -e "s#/usr/local#$pkgdir/usr#g" Makefile.local
  sed -i -e "s#/usr/share/man#$pkgdir/usr/share/man#g" Makefile.local

  patch -p1 -i ../debian/patches/500_debian_fhs.patch

  make
  make PREFIX="$pkgdir/usr" MANDIR="$pkgdir/usr/share/man" install

  install -m755 -D $srcdir/${pkgname}.init $pkgdir/etc/rc.d/$pkgname || return 1
  install -m644 -D $srcdir/${pkgname}.conf.d $pkgdir/etc/conf.d/$pkgname || return 1

  mkdir -p $pkgdir/etc/sks
  cp $srcdir/debian/debcfg/* $pkgdir/etc/sks
  sed -i -e "s#/usr/lib/sendmail#/usr/sbin/sendmail#g" $pkgdir/etc/sks/sksconf
}

# end of file #
