# Maintainer: Paul Cox <pauldcox@gmail.com>
# Contributor: Matthew Bauer

pkgname=granola-connect
pkgver=4.0.1
pkgrel=1
pkgdesc="Daemon for Granola to provide policy support as you define at https://grano.la/dash/ and for statistic collection. Required by granola-gui."
arch=('i686' 'x86_64')
  [ $CARCH = i686 ] && _arch=i386
  [ $CARCH = x86_64 ] && _arch=$CARCH
url="http://grano.la/"
license=('custom')
depends=('granola' 'openssl>=1.0.0')
optdepends=('granola-gui: gui for granola-connect and for viewing statistics')
backup=('etc/granola-connect.conf')
install=$pkgname.install
changelog=$pkgname.changelog

source=("https://download.miserware.com/linux/tar/$_arch/$pkgname-$pkgver-$_arch.tar.gz"
        'granola-connect.confd'
        'rc_granola-connect.sh'
        'LICENSE-fromgranola.txt')

[ $_arch = i686 ] && md5sums=('39556eaa343d845883e4d3ebc48ef93b')
[ $_arch = x86_64 ] && md5sums=('28358b80e8659dabf6fde11a2c45f39b')
md5sums+=('0bff7d92d4857f21b5e21a1ba9b4d0f6'
          '4bad60fb5db074e5fd94385773573a98'
          '6802b65a2a8da58c187fa59bdc55fbc8')

package() {
  cd "$srcdir/$pkgname-$pkgver-$_arch"

  cp -r usr "$pkgdir"

  # install license from granola package
  install -Dm644 "$srcdir"/LICENSE-fromgranola.txt \
          "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.txt

  install -Dm600 etc/granola-connect.conf "$pkgdir"/etc/granola-connect.conf

  # rc.d files
  install -Dm644 "$srcdir"/granola-connect.confd "$pkgdir"/etc/conf.d/granola-connect.conf
  install -Dm755 "$srcdir"/rc_granola-connect.sh "$pkgdir"/etc/rc.d/granola-connect
  
  # nasty, dirty hack to make openssl work like on Fedora because that is
  # what granola-connect looks for
  mkdir -p "$pkgdir"/usr/lib
  ln -s libcrypto.so.1.0.0 "$pkgdir"/usr/lib/libcrypto.so.10
  ln -s libssl.so.1.0.0 "$pkgdir"/usr/lib/libssl.so.10
}

# vim:set ts=2 sw=2 et:
