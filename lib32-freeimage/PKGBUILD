# Contributor: Thomas Dziedzic < gostrc at gmail >
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
# Contributor: Mihai Militaru <mihai.militaru@gmx.com>
# Contributor: scippio <scippio@berounet.cz>
# Contributor: Jesse Jaara <jesse.jaara@gmail.com>
# Contributor: Dan Vratil <vratil@progdansoft.com>

pkgname=lib32-freeimage
pkgver=3.15.0
pkgrel=2
pkgdesc="Library project for developers who would like to support popular graphics image formats."
arch=('x86_64')
url="http://freeimage.sourceforge.net"
license=('GTL' 'custom:FIPL')
groups=('lib32')
depends=('lib32-gcc-libs')
source=("http://downloads.sourceforge.net/project/freeimage/Source%20Distribution/${pkgver}/FreeImage${pkgver//./}.zip"
        'gcc4.5_ln.patch')

build()
{
	export CC="gcc -m32"
	export CXX="g++ -m32"
	export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
      
	cp -r FreeImage FreeImagefip
        
	cd FreeImage
	patch -Np1 < ${srcdir}/gcc4.5_ln.patch
	make
              
	cd ${srcdir}/FreeImagefip
	patch -Np1 < ${srcdir}/gcc4.5_ln.patch
	make -f Makefile.fip 
}
package() 
{
	cd "${srcdir}"
 
	mkdir -p "${pkgdir}/usr/lib32"
	cp FreeImage/Dist/libfreeimage-${pkgver}.so "${pkgdir}/usr/lib32/"
	cp FreeImagefip/Dist/libfreeimageplus-${pkgver}.so "${pkgdir}/usr/lib32/"
	ln -s libfreeimage-${pkgver}.so ${pkgdir}/usr/lib32/libfreeimage.so
	ln -s libfreeimageplus-${pkgver}.so ${pkgdir}/usr/lib32/libfreeimageplus.so
}
md5sums=('3b4f08e4985b269beb29a2fced1ef888'
         'f85279b2572a0a9e03775909cd9cd759')
