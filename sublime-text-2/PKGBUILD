# Maintainer: Bartosz Chmura <chmurli at gmail dot com>

pkgname=sublime-text-2
pkgver=v2059
_pkgver=2059
pkgrel=2
pkgdesc="sophisticated text editor for code, html and prose"
arch=('any')
url="http://www.sublimetext.com/2"
license=('custom')
depends=(libpng12)
install=$pkgname.install
source=(sublime-text-2.desktop
	sublime-text-2-icon.png)
md5sums=('aafdfe84dd3b7c7ca1a7b7f0a6f26b46'
	'd08225e4b82a9de9a8fcbbf2b4aa6c23')


_LINK1=http://www.sublimetext.com/Sublime%20Text%202%20Build%20${_pkgver}.tar.bz2
_LINK1MD5=54e3d79e06d2c6cd0a33a1cf79aae3da

_LINK2=http://www.sublimetext.com/Sublime%20Text%202%20Build%20${_pkgver}%20x64.tar.bz2
_LINK2MD5=fbb857822bae034e23e6dacc5c3fd85a


build () {

	
	mkdir -p ${pkgdir}/usr/bin/${pkgname}
	
	# remove 
	cd ${srcdir}
	#yes | rm -Rf "Sublime Text 2" || return 1


	# cpu architecture
	if [ $(uname -m) = i686 ]
	then

		arch=('i686')
		wget ${_LINK1}
		
		MD5_CHECK=$(md5sum Sublime\ Text\ 2\ Build\ ${_pkgver}.tar.bz2 | awk '{print $1;}')
		#echo $MD5_CHECK
		if [ ${MD5_CHECK} == ${_LINK1MD5} ]
		then
			tar xvjf Sublime\ Text\ 2\ Build\ ${_pkgver}.tar.bz2 || return 1
		else
			return 1
		fi	

	else

		arch=('x86_64')
		wget ${_LINK2}	

		MD5_CHECK=$(md5sum Sublime\ Text\ 2\ Build\ ${_pkgver}\ x64.tar.bz2 | awk '{print $1;}')
		#echo $MD5_CHECK
		if [ ${MD5_CHECK} == ${_LINK2MD5} ]
		then
			tar xvjf Sublime\ Text\ 2\ Build\ ${_pkgver}\ x64.tar.bz2 || return 1
		else
			return 1
		fi	
		
	fi

	cp -R Sublime\ Text\ 2/* ${pkgdir}/usr/bin/${pkgname} || return 1
	chmod -R 755 ${pkgdir}/usr/bin/${pkgname} || return 1

	# icon
	install -m 644 ${srcdir}/sublime-text-2-icon.png ${pkgdir}/usr/bin/${pkgname} || return 1

	
	install -d -m 755 ${pkgdir}/usr/share/applications || return 1
	install -m 644 ${srcdir}/sublime-text-2.desktop ${pkgdir}/usr/share/applications || return 1

	

}



