# Maintainer: Ner0

pkgname=qbittorrent-bin
pkgver=2.9.7
pkgrel=1
pkgdesc="A bittorrent client written in C++ / Qt4 using the good libtorrent library (Ubuntu prebuilt)"
url="http://www.qbittorrent.org/"
arch=('i686' 'x86_64')
_arch='amd64'
[ $CARCH = 'i686' ] && _arch='i386'
license=('GPL')
depends=('qt' 'libtorrent-rasterbar' 'boost-libs' 'openssl>=1.0.0')
optdepends=('python: needed for search'
            'geoip: improves peer country resolution')
conflicts=('qbittorrent')
provides=('qbittorrent')
install=$pkgname.install
source=(https://launchpad.net/~hydr0g3n/+archive/ppa/+files/qbittorrent_${pkgver}-0ubuntu1~oneiric_${_arch}.deb)
md5sums=('2f3f07640c68f57a10ce1197edb4d30b')
[ $CARCH = 'i686' ] && md5sums=('79e379679199fcc604da4b379b7aaa76')

package() {
  bsdtar -xf data.tar.gz -C "$pkgdir/"

  cd "$pkgdir/usr/bin"

  b_ver=$(strings ./qbittorrent | grep libboost | head -n 1 | sed 's/.*\.so.//')
  my_ver=$(find /usr/lib -type f -name libboost_system.so\* | head -n1 | sed 's/.*\.so.//')

  if [[ $b_ver != $my_ver ]]; then
    sed -i "s/$b_ver/$my_ver/g" ./qbittorrent
  fi
}
