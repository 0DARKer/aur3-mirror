# Maintainer: Ner0

pkgname=qbittorrent-bin
pkgver=3.0.8
pkgrel=2
pkgdesc="A bittorrent client written in C++ / Qt4 using the good libtorrent library (Ubuntu prebuilt)"
url="http://www.qbittorrent.org/"
arch=('i686' 'x86_64')
[[ "$CARCH" = 'i686' ]] && _arch='i386' || _arch='amd64'
license=('GPL')
depends=('qt4' 'libtorrent-rasterbar' 'boost-libs' 'openssl>=1.0.0')
optdepends=('python: needed for search'
            'geoip: improves peer country resolution')
conflicts=('qbittorrent' 'qbittorrent-dev' 'qbittorrent-git' 'qbittorrent-git-nogui' 'qbittorrent-nogui')
provides=("qbittorrent=$pkgver")
install=$pkgname.install
source=("https://launchpad.net/~hydr0g3n/+archive/ppa/+files/qbittorrent_${pkgver}-0ubuntu1~quantal_${_arch}.deb")
md5sums=('8a972b332eb21fdda74acd4d92e078cf')
[[ "$CARCH" = 'i686' ]] && md5sums=('b4ec6a672946c210e82f2ff7c52843d4')

package() {
  tar -xf data.tar.gz -C "$pkgdir/"

  cd "$pkgdir/usr/bin"

  _boost=$(strings ./qbittorrent | grep libboost)
  _my_boost=$(pacman -Ql boost-libs | grep -o libboost_system.so.'[0-9].*')
  _raster=$(strings ./qbittorrent | grep libtorrent-rasterbar.so)
  _my_raster=$(pacman -Ql libtorrent-rasterbar | grep -o libtorrent-rasterbar.so.'[0-9]' | head -n1)

  if [[ "$_boost" != "$_my_boost" ]]; then
    sed -i "s/$_boost/$_my_boost/g" ./qbittorrent
  fi

  if [[ "$_raster" != "$_my_raster" ]]; then
    sed -i "s/$_raster/$_my_raster/g" ./qbittorrent
  fi
}
