# Maintainer: ian <ian at kremlin dot cc>
pkgname=bashstyle
pkgver=8.3
pkgrel=1
# new epoch as PKGBUILD was rewritten -- kremlin
epoch=1
pkgdesc="A PyGTK client for managing bash, readline, vim, and nano settings"
arch=('any')
url="http://freecode.com/projects/bsng"
license=('GPL3')
groups=('system')
depends=('gawk' 'sed' 'bc' 'gettext' 'less' 'libnewt' 'python2-configobj' 'python2-gobject' 'hicolor-icon-theme')
optdepends=("acpi: showbatteryload support" "lspci: systeminfos support" "lsusb: systeminfos support" "ps2pdf: man2pdf support" "tree: fs support" "dmidecode: dmi variables support")
install=".install"
provides=("bashstyle-git")
conflicts=("bashstyle-git")
source=("http://downloads.nanolx.org/BashStyle-NG/bashstyle-ng_8.3.tar.bz2" "base.patch" "checks.patch" "text2morse.patch" "adjust.patch")
md5sums=('84b5ba3b122966ce6beb3d6cc1ee5b58'
         'a91c940e60be16a2ea79b83daa0431c5'
         '8e28b621b11b58c4bb82370d13496c9c'
         'c509eace1c1d750bb40911749886c69f'
         '731855d8af5da63f6b23467ba8e05d3d')
sha256sums=('47e760dc90bc48d55df31372af6ca1880fc784c7d78655f4b9534ae29d02601b'
            'de5a0a8f4872683888f33849cc8446cb86c39322ef1049ae73bd8e9182fc1aea'
            '3f7549ba24685c8469cbfa011032375c7a989a78334efeb6d16fcf73b9253a10'
            'e33b06de38d46f469161e131cc59bc23442506f192dc16ac0d26e00e8b88acab'
            'f2f4bcb8596176e2815e31498910a7e57289163a9fdd93ce4d9b2d2add07dde9')
sha512sums=('629c27a16c3ed45651a597ae041cabdfd55f0d75e35b553b9348db72c967ba562d40469a9cae81ae5e6eb4f3153227f46ee38343a50336fe5c569e4d95e460fb'
            '50c8042117fdeb0d55863e9d1d06d39b7d5e9b6f0b89b4b878df9b7f2216ed9ce1a82086fbfad99a0484419079efdf14d234709ff786bc1941b0e38c0301ffac'
            '8f7854dde8f3d66690ea6478f01e5ee0251ca1e32ee691b4093f5d8abece70d8cb901d0b021e47e5d6c1413495d44d56cdde6c169f28fef145f3c3f4c0251d38'
            '88632bd889ab3153d1c6d211a03af007e00091add0c938d5d57d0a256ca276e591674e22da5610f7f6a22e9cc8756cb29015128b8367a1c47adb89764a86629a'
            '6fcd3ab9b20a8abdd5f45ee4305149a572e48bef7c5cc212b5d7e2b88f765eb129403ccf50c927461008781bfffb08bcf88557d7561b599aefffb79cf70d09cd')

prepare() {
	cd "$srcdir/bashstyle-ng_8.3/.configure"
	patch base < $srcdir/base.patch
	patch checks < $srcdir/checks.patch
	cd "$srcdir/bashstyle-ng_8.3/rc/functions"
	patch text2morse < $srcdir/text2morse.patch
	cd "$srcdir/bashstyle-ng_8.3/.make"
	patch adjust < $srcdir/adjust.patch
}

build() {
	cd "$srcdir/bashstyle-ng_8.3"
	./configure --python=/usr/bin/python2 --no-installdocs
	make
}

package() {
	cd "$srcdir/bashstyle-ng_8.3"
	make DESTDIR="$pkgdir/" install

	# get rid of locales if already present
	if [ -f /usr/share/locale/de/LC_MESSAGES/bs-ng-wizard.mo ]; then
		rm $pkgdir/usr/share/locale/de/LC_MESSAGES/bs-ng-wizard.mo
	fi
	if [ -f /usr/share/locale/de/LC_MESSAGES/bs-ng.mo ]; then
		rm $pkgdir/usr/share/locale/de/LC_MESSAGES/bs-ng.mo
	fi
	if [ -f /usr/share/locale/de/LC_MESSAGES/nx-rc.mo ]; then
		rm $pkgdir/usr/share/locale/de/LC_MESSAGES/nx-rc.mo
	fi
	if [ -f /usr/share/locale/es/LC_MESSAGES/bs-ng.mo ]; then
		rm $pkgdir/usr/share/locale/es/LC_MESSAGES/bs-ng.mo
	fi
	if [ -f /usr/share/locale/es/LC_MESSAGES/nx-rc.mo ]; then
		rm $pkgdir/usr/share/locale/es/LC_MESSAGES/nx-rc.mo
	fi
	if [ -f /usr/share/locale/it/LC_MESSAGES/bs-ng.mo ]; then
		rm $pkgdir/usr/share/locale/it/LC_MESSAGES/bs-ng.mo
	fi
	if [ -f /usr/share/locale/ru/LC_MESSAGES/bs-ng-wizard.mo ]; then
		rm $pkgdir/usr/share/locale/ru/LC_MESSAGES/bs-ng-wizard.mo
	fi
	if [ -f /usr/share/locale/ru/LC_MESSAGES/bs-ng.mo ]; then
		rm $pkgdir/usr/share/locale/ru/LC_MESSAGES/bs-ng.mo
	fi
	if [ -f /usr/share/locale/ru/LC_MESSAGES/nx-rc.mo ]; then
		rm $pkgdir/usr/share/locale/ru/LC_MESSAGES/nx-rc.mo
	fi

	# clean up empty dirs
	if [ "$(ls -A $pkgdir/usr/share/locale/ru/LC_MESSAGES 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/locale/ru/LC_MESSAGES
		rmdir $pkgdir/usr/share/locale/ru
	fi
	if [ "$(ls -A $pkgdir/usr/share/locale/de/LC_MESSAGES 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/locale/de/LC_MESSAGES
		rmdir $pkgdir/usr/share/locale/de
	fi
	if [ "$(ls -A $pkgdir/usr/share/locale/it/LC_MESSAGES 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/locale/it/LC_MESSAGES
		rmdir $pkgdir/usr/share/locale/it
	fi
	if [ "$(ls -A $pkgdir/usr/share/locale/es/LC_MESSAGES 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/locale/es/LC_MESSAGES
		rmdir $pkgdir/usr/share/locale/es
	fi
	if [ "$(ls -A $pkgdir/usr/share/doc/bashstyle-ng/img-style 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/doc/bashstyle-ng/img-style
	fi
	if [ "$(ls -A $pkgdir/usr/share/doc/bashstyle-ng/img 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/doc/bashstyle-ng/img
	fi
	if [ "$(ls -A $pkgdir/usr/share/locale 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/locale
	fi
	if [ "$(ls -A $pkgdir/usr/share/doc/bashstyle-ng 2> /dev/null)" == "" ]; then
		rmdir $pkgdir/usr/share/doc/bashstyle-ng
		rmdir $pkgdir/usr/share/doc
	fi
}
