# Maintainer: josephgbr <rafael.f.f1@gmail.com>

pkgname=lib32-gtk3
pkgver=3.2.2
pkgrel=1
pkgdesc="The GTK+ Toolkit (v3) (32-bit)"
arch=('x86_64')
license=('LGPL')
url="http://www.gtk.org/"
depends=('lib32-atk' 'lib32-gdk-pixbuf2' 'lib32-libxcomposite'
	 'lib32-libcups' 'lib32-libxcursor' 'lib32-libxdamage'
	 'lib32-libxi' 'lib32-libxinerama' 'lib32-libxrandr'
	 'lib32-pango' 'lib32-cairo' 'lib32-colord' 'gtk3')
makedepends=('gcc-multilib')
options=('!libtool' '!docs')
install=gtk3.install
source=("http://ftp.gnome.org/pub/gnome/sources/gtk+/3.2/gtk+-${pkgver}.tar.xz"
        'filechooserdefault_do_not_unref_value_twice.patch')
sha256sums=('f7ec82de393cd7ae2aa45022576400941704709d1f0f35fb0b17f3be1f2e7d84'
            '961af633d9f1a8e76249e9cd2d59cdeae07f280cf416cefc6ca470ece85f85f4')

build() {  
  export CC="gcc -m32"
  export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"
  
  cd "${srcdir}/gtk+-${pkgver}"  
  patch -Np1 -i "$srcdir/filechooserdefault_do_not_unref_value_twice.patch"
  CXX=/bin/false ./configure --prefix=/usr \
  	--sysconfdir=/etc \
  	--localstatedir=/var \
  	--enable-gtk2-dependency \
  	--disable-schemas-compile \
  	--libdir=/usr/lib32 \
  	--enable-introspection=no
  #https://bugzilla.gnome.org/show_bug.cgi?id=655517
  sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool  
  make
}

package() {
  cd "${srcdir}/gtk+-${pkgver}"
  make DESTDIR="${pkgdir}" install
  mv ${pkgdir}/usr/bin/gtk-query-immodules-3.0{,-32}
  rm -rf "${pkgdir}/usr"/{include,share,bin/gtk3-demo} "${pkgdir}/etc"
}
