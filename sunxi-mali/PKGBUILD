# Maintainer: 謝致邦 <Yeking@Red54.com>

pkgname=sunxi-mali
pkgver=20130224
pkgrel=1
pkgdesc="Mali implementation of OpenGL ES, OpenVG and EGL"
arch=('armv7h')
url="http://github.com/linux-sunxi/sunxi-mali"
license=('custom')
depends=('libgl')
makedepends=('git')
provides=('libump' 'khrplatform-devel' 'libegl' 'libgles' 'mali400' 'mali-libs')
conflicts=('libump' 'khrplatform-devel' 'libegl' 'libgles' 'mali400' 'mali-libs')
replaces=('libump' 'khrplatform-devel' 'libegl' 'libgles' 'mali400' 'mali-libs')

build() {
	cd $srcdir
	if [[ -d $pkgname ]]; then
		cd $pkgname && git pull origin
	else
		git clone $url --recursive --depth 1
	fi
	rm -rf $srcdir/build
	cp -r $srcdir/$pkgname $srcdir/build
	cd $srcdir/build
	sed -i 's/dri2 -ldrm -lXfixes/GL/g' lib/ump/Makefile
	make VERSION=r3p0 ABI=armhf EGL_TYPE=x11 all
}

package() {
	cd $srcdir/build
	mkdir -p $pkgdir/usr/{include,lib}
	make VERSION=r3p0 ABI=armhf EGL_TYPE=x11 install prefix=$pkgdir/usr/
}
