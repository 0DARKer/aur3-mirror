# Maintainer: ronnie
pkgname=mullvad
pkgver=46
pkgrel=1
pkgdesc="VPN Client for Mullvad.net, a bitcoin-friendly VPN for anonymity and privacy"
url="https://www.mullvad.net"
arch=('any')
license=('unknown')
depends=(openvpn resolvconf python2 gksu wxpython2.8)
makedepends=()
conflicts=()
replaces=()
backup=()
install=
source=(https://www.mullvad.net/static/download/${pkgname}_${pkgver}_all.deb
        up-down.patch
        mullvad-wxpython.patch
        )

sha256sums=('1753f34f58409df4dffa465d3cd56ec19314c744907907c1abd640912f03611a'
         '4ae94be89f6099c6b0d8b5c17239d90fe8bb141c9a30ac381e2a419d73d1173e'
         '8bb49702ccc5a8d4b6d7dabfd331254670d37d668532a4c7f5a0fa1cd15d71c6'
         )
package() {
  cd $startdir/src/
  tar xzvf data.tar.gz
  patch -p0 < up-down.patch
  patch -p0 < mullvad-wxpython.patch

  # From http://allanmcrae.com/2010/10/big-python-transition-in-arch-linux/
  sed -i -e "s|#![ ]*/usr/bin/python$|#!/usr/bin/python2|" \
    -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" \
    $(find usr/ -name '*.py')
  echo $pkgdir
  cp -r usr/ $pkgdir
  mkdir -p $pkgdir/etc/openvpn
  cp /usr/share/openvpn/contrib/pull-resolv-conf/client.up    $pkgdir/etc/openvpn/mullvad-up-resolv-conf
  cp /usr/share/openvpn/contrib/pull-resolv-conf/client.down  $pkgdir/etc/openvpn/mullvad-down-resolv-conf
  chmod +x $pkgdir/etc/openvpn/mullvad-{up,down}-resolv-conf
}
