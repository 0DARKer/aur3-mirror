# Maintainer: Gregor Robinson <gregor@fiatflux.co.uk>
# Contributor: Vitaliy Berdinskikh ur6lad[at]i.ua

pkgname=splat
pkgver=1.4.0
pkgrel=1
pkgdesc="A RF Signal Propagation, Loss, And Terrain analysis tool for the spectrum between 20 MHz and 20 GHz"
arch=('i686' 'x86_64')
url="http://www.qsl.net/kd2bd/splat.html"
depends=('gcc-libs' 'zlib' 'bzip2' 'gnuplot')
optdepends=('gimp')
source=("http://www.ibiblio.org/pub/linux/apps/ham/${pkgname}-${pkgver}.tar.bz2")
license=('GPL')

prepare() {
	mkdir -p $pkgdir/usr/bin
	mkdir -p $pkgdir/usr/share/man/man1
	mkdir -p $pkgdir/usr/share/splat/{data,docs}

	cd $srcdir/$pkgname-$pkgver
	
	sed -i -e s:' -march=$cpu':: build
	sed -i -e s:'-O3':"${CFLAGS}": build
	sed -i -e s:'-O3':"${CFLAGS}": utils/build
}
	
build() {
	cd $srcdir/$pkgname-$pkgver

	./build all
}

package() {
	cd $srcdir/$pkgname-$pkgver

    mkdir -p $pkgdir/usr/bin/
	install -m755 splat $pkgdir/usr/bin
	install -m755 utils/{citydecoder,usgs2sdf,srtm2sdf} -t $pkgdir/usr/bin/
	install -D -m644 docs/english/man/splat.1 $pkgdir/usr/share/man/man1/splat.1
    mkdir -p $pkgdir/usr/share/splat/data/
	install -m644 sample_data/* $pkgdir/usr/share/splat/data/
	install -D -m644 utils/README $pkgdir/usr/share/splat/docs/README
	install -D -m644 CHANGES $pkgdir/usr/share/splat/docs/CHANGES
}
md5sums=('9dd623513670b0f34b19815b202a5f8e')
sha512sums=('d2257135d0ca9d66aa047645c3ff598cf4d9f153916f3f398ed0c12cc2a46433ee44b6c91b57307c838176b5116e9cc6cb12817a4c35433aa068db036dc4d8e2')
