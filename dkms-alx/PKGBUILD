# Mantainer: Ivan de Jesús Pompa García <ivan.pompa@gmx.com>
# Contributor: kyak <bas@bmail.ru>

pkgname=('dkms-alx')
_vname='3.9-rc4-2-su'
_dkmsname='alx'
pkgver='3.9'
pkgrel=6
epoch=3
pkgdesc='Atheros alx Linux ethernet device driver'
arch=('i686' 'x86_64')
url='http://linuxwireless.org/'
license=('custom')
depends=('dkms')
makedepends=('linux-headers>=3.7')
options=('!strip')
conflicts=('dkms-alx', 'alx-driver', 'alx-driver-legacy')
provides=('dkms-alx', 'alx-driver', 'alx-driver-legacy')
install=alx-driver.install
source=(
	http://www.kernel.org/pub/linux/kernel/projects/backports/stable/v3.9-rc4/compat-drivers-${_vname}.tar.bz2
	dkms.conf
	alx.sh
	kdetect.sh
	patch_autoinstall.patch
)

sha256sums=(
	'f7e527d569ce03e454e466bdd51c0c8b3a054ac89c28011e075d18933631268c'
	'd33bb4568ab2efd49331d209a0bcd42999ae8570e9c240cd3332238f00d2620c'
	'797b1b61aa0bfdb5f7565fef70720f8c30e8c9d0bfd43effeae2b7f1078d2372'
	'0261038dd3f5c654a75f09ad8081608b4c0045b1b41ba5dd1bcc49c5579afaf8'
	'f2fee71099b4cda6e87bfeee1ee08282c97dc7ac608d39c04cb7da661ff8c0f0'
)

package() {
	mkdir -p ${pkgdir}/usr/lib/systemd/system-sleep
	cp -RL alx.sh ${pkgdir}/usr/lib/systemd/system-sleep
	chmod a+x ${pkgdir}/usr/lib/systemd/system-sleep/alx.sh

	cd ${srcdir}/compat-drivers-${_vname}
	rm -rf drivers/net/wireless
	./scripts/driver-select alx

	mkdir -p ${pkgdir}/usr/src/${_dkmsname}-${pkgver}
	cp -RL ${srcdir}/kdetect.sh ${pkgdir}/usr/src/${_dkmsname}-${pkgver}
	chmod a+x ${pkgdir}/usr/src/${_dkmsname}-${pkgver}/kdetect.sh
	cp -RL ${srcdir}/compat-drivers-${_vname}/* ${pkgdir}/usr/src/${_dkmsname}-${pkgver}
	cp -RL ${srcdir}/compat-drivers-${_vname}/.compat* ${pkgdir}/usr/src/${_dkmsname}-${pkgver}
	cp -RL ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_dkmsname}-${pkgver}

	patch ${pkgdir}/usr/src/alx-${pkgver}/Makefile < ${srcdir}/patch_autoinstall.patch
}
