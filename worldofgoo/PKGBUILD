# Maintainer: Todd Partridge <toddrpartridge@gmail.com>

pkgname=worldofgoo
_pkgname=WorldOfGoo
pkgver=1.41
pkgrel=2
pkgdesc="Physics based puzzle/construction game (Commercial)"
arch=('i686' 'x86_64')
url="http://www.2dboy.com"
license=('custom')
depends=('mesa' 'sdl_mixer')
optdepends=('worldofgoo-gootool: For creating and installing fan levels')
install="$pkgname.install"
source=('worldofgoo.desktop')
md5sums=('77a432d280a5199b45ee8bf835a0d223')


build() {

  # Check if installer is in build directory, than validate
  cd $startdir
  _instmd5=f5afa40893d0fbcc37885191404f6d8c
  if [ ! -f ${_pkgname}Setup.$pkgver.tar.gz ]; then
    msg "!! World of Goo is a commercial game."
    msg "!! The installer must be in:"
    msg "!! $(pwd)"
    msg "!! before World of Goo can be installed." && return 1
    else
    if [[ "$(md5sum ${_pkgname}Setup.$pkgver.tar.gz | awk '{print $1}')" == "$_instmd5" ]]; then
      msg "Check: Installer is the correct size."
      else
      msg "!! The installer size check did not match.  Exiting." && return 1
    fi
  fi

  # Extract installer
  if [ ! -d $srcdir/$pkgname-$pkgver ]; then
    mkdir -p $srcdir/$pkgname-$pkgver
  fi
  msg "Extracting archive..."
  tar xf "$_pkgname"Setup.$pkgver.tar.gz -C $srcdir/$pkgname-$pkgver

  # Create pkgdir folders
  install -d $pkgdir/usr/bin
  install -d $pkgdir/usr/share/{applications,worldofgoo,icons}
  install -d $pkgdir/usr/share/licenses/$pkgname

  cd $srcdir/$pkgname-$pkgver/$_pkgname

  # Install files
  msg "Copying files..."

  # game folder
  cp -r * $pkgdir/usr/share/$pkgname/

  # licenses
  install -m644 eula.txt $pkgdir/usr/share/licenses/$pkgname/

  # executable link
  ln -s /usr/share/$pkgname/$_pkgname $pkgdir/usr/bin/$pkgname

  # icon/.desktop
  install -m644 icons/scalable.svg $pkgdir/usr/share/icons/$pkgname.svg
  install -m644 $startdir/$pkgname.desktop $pkgdir/usr/share/applications/
}
