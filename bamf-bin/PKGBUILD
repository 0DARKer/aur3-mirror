# Maintainer: Dan Serban

pkgname=bamf-bin
pkgver=0.2.1xx.latest
pkgrel=1
pkgdesc="libbamf-dev and libbamf0 from archive.ubuntu.com"
arch=(i686 x86_64)
url=https://launchpad.net/bamf
makedepends=(lynx)
license=(GPL)
_filearch=i386 && _soarch=i386
[ "$CARCH" = "x86_64" ] && _filearch=amd64 && _soarch=x86_64

build()
{
  lynx -dump "http://archive.ubuntu.com/ubuntu/pool/main/b/bamf/" | grep -o http.*deb > tmp.txt

  # --- libbamf-dev ---
  cd "${srcdir}"
  rm libbamf-dev_*.deb 2>/dev/null || true
  _url=$(grep /libbamf-dev_0.*${_filearch}.deb tmp.txt | tail -1)
  wget ${_url}
  rm data.tar.gz 2>/dev/null || true
  bsdtar -xf $(basename ${_url}) data.tar.gz
  bsdtar -xf data.tar.gz -C "${pkgdir}" || true
  cd "${pkgdir}"/usr/lib
  mv ${_soarch}-linux-gnu/pkgconfig .
  rm -r ${_soarch}-linux-gnu
  cd "${pkgdir}"/usr/include/libbamf
  mv libbamf/*.h .
  rm -r libbamf

  # --- libbamf0 ---
  cd "${srcdir}"
  rm libbamf0_*.deb 2>/dev/null || true
  _url=$(grep /libbamf0_0.*${_filearch}.deb tmp.txt | tail -1)
  wget ${_url}
  rm data.tar.gz 2>/dev/null || true
  bsdtar -xf $(basename ${_url}) data.tar.gz
  rm -r usr 2>/dev/null || true
  bsdtar -xf data.tar.gz || true
  install -Dm755 $(find usr/lib -type f) "${pkgdir}"/usr/lib/libbamf.so.0.0.0
  cd "${pkgdir}"/usr/lib
  ln -s libbamf.so.0.0.0 libbamf.so.0
  ln -s libbamf.so.0.0.0 libbamf.so
}

