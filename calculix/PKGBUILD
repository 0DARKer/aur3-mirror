# Contributor: alberto penaforte <apenaforte@gmail.com>

pkgname=calculix
pkgver=2.3
pkgrel=1
pkgdesc="CalculiX: 3D finite element solver and post-processor"
depends=('spooles' 'arpack' 'lapack' 'blas' 'mesa' 'freeglut' 'gcc-fortran')
url=('http://www.calculix.de')
source=( http://www.dhondt.de/ccx_${pkgver}.src.tar.bz2
         ccxMakefile
         http://www.dhondt.de/cgx_${pkgver}.all.tar.bz2
         cgxMakefile32
         cgxMakefile64
         )
md5sums=('e09a0428df0031ca7066f7b087a8e538'
         '54d02a168797fd08cd96fc6bd5b0a95c'
         'f896869835c91123a397a6ace74984d9'
         '3b5adcd25614b50527fc08c7adf7f378'
         '7bef6089e2dd48f082a179f023102c04'
         )
arch=('i686' 'x86_64')
license=('GPL')

build(){
  mv -f ccxMakefile ${srcdir}/CalculiX/ccx_${pkgver}/src/Makefile
  [ "$CARC" = 'i686' ]   && mv -f cgxMakefile32 ${srcdir}/CalculiX/cgx_${pkgver}/src/Makefile
  [ "$CARC" = 'x86_64' ] && mv -f cgxMakefile64 ${srcdir}/CalculiX/cgx_${pkgver}/src/Makefile

  cd ${srcdir}/CalculiX/ccx_${pkgver}/src
  make -j 3 || return 1
  cd ${srcdir}/CalculiX/cgx_${pkgver}/src
  sed -i "s/<iostream.h>/<iostream>/" uselibSNL.cpp
  make -j 3 || return 1

  mkdir -p ${pkgdir}/usr/bin
  cp ${srcdir}/CalculiX/ccx_${pkgver}/src/ccx_${pkgver} ${pkgdir}/usr/bin/ccx
  cp ${srcdir}/CalculiX/cgx_${pkgver}/src/cgx           ${pkgdir}/usr/bin/cgx
}
