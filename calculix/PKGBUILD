# Contributor: alberto penaforte <apenaforte@alice.it>

pkgname=calculix
pkgver=2.2
pkgrel=1
pkgdesc="CalculiX: 3D finite element solver and post-processor"
depends=('spooles' 'arpack' 'lapack' 'blas' 'mesa' 'freeglut' 'gcc-fortran')
url=('http://www.calculix.de')
source=( http://www.dhondt.de/ccx_${pkgver}.src.tar.bz2
         ccxMakefile
         http://www.dhondt.de/cgx_${pkgver}.all.tar.bz2
         cgxMakefile32
         cgxMakefile64
         )
md5sums=('085da9e39fbc386f85e97ce8d8af2c71'
         '9fc194f229310aabbb1aa55b379f4241'
         '85470f0ef2957d7f94cadb82235775ca'
         '3b5adcd25614b50527fc08c7adf7f378'
         '7bef6089e2dd48f082a179f023102c04'
         )
arch=('i686' 'x86_64')
license=('GPL')

build(){
  mv -f ccxMakefile ${srcdir}/CalculiX/ccx_${pkgver}/src/Makefile
  [ "$CARC" = 'i686' ]   && mv -f cgxMakefile32 ${srcdir}/CalculiX/cgx_${pkgver}/src/Makefile
  [ "$CARC" = 'x86_64' ] && mv -f cgxMakefile64 ${srcdir}/CalculiX/cgx_${pkgver}/src/Makefile

  cd ${srcdir}/CalculiX/ccx_${pkgver}/src
  make -j 3 || return 1
  cd ${srcdir}/CalculiX/cgx_${pkgver}/src
  sed -i "s/<iostream.h>/<iostream>/" uselibSNL.cpp
  make -j 3 || return 1

  mkdir -p ${pkgdir}/usr/bin
  cp ${srcdir}/CalculiX/ccx_${pkgver}/src/ccx_${pkgver} ${pkgdir}/usr/bin/ccx
  cp ${srcdir}/CalculiX/cgx_${pkgver}/src/cgx           ${pkgdir}/usr/bin/cgx
}
