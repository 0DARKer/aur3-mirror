# Maintainer: Gaurish Sharma <contact@gaurishsharma.com>
# Contributor: Massimiliano Torromeo <massimiliano.torromeo@gmail.com>

pkgname=lighttable
pkgver=0.2.3
pkgrel=1
pkgdesc="Light Table is a new interactive IDE that lets you modify running programs and embed anything from websites to games."
url="http://www.lighttable.com/"
license=('custom')
depends=(nss libx11 libxrandr libpng)
arch=('i686' 'x86_64')
source=(http://temp2.kodowa.com.s3.amazonaws.com/playground/bins/LightTableLinux.tar.gz)
md5sums=('0f9db551d89972245c1948405c1cdb4c')

[ "$CARCH" = "x86_64" ] && {
  source=(http://temp2.kodowa.com.s3.amazonaws.com/playground/bins/LightTableLinux64.tar.gz)
  md5sums=('cd6e502e6507f6e9b2d82e3f2ca23eab')
}

package() {
  install -dm755 "$pkgdir/opt/lighttable" "$pkgdir/usr/bin"

  mv "$srcdir/LightTable/LightTable" "$pkgdir/opt/lighttable/"
  mv "$srcdir/LightTable/nw.pak" "$pkgdir/opt/lighttable/"
  mv "$srcdir/LightTable/libffmpegsumo.so" "$pkgdir/opt/lighttable/"

  #UnComment at your own risk. 
  #for more see, https://github.com/Kodowa/Light-Table-Playground/issues/161
  #ln -s /usr/lib/libudev.so "$pkgdir/opt/lighttable/libudev.so.0"

  cat <<EOF > "$pkgdir/usr/bin/lighttable"
#!/bin/sh
cd /opt/lighttable
#uncomment if you are using the libudev symlink hack
#export LD_LIBRARY_PATH="$PWD:$LD_LIBRARY_PATH"
exec ./LightTable
EOF
  chmod 755 "$pkgdir/usr/bin/lighttable"
}
