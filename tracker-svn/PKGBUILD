# Contributor: Manuel Mazzuola <origin.of@gmail.com>

pkgname=tracker-svn
pkgver=1236
pkgrel=2
pkgdesc="A first class object database, extensible tag/metadata database, search tool and indexer"
arch=(i686)
url="http://www.tracker-project.org/"
license=('GPL' 'LGPL')
depends=('sqlite3' 'dbus-glib' 'file' 'gmime' 'poppler' 'libexif' 'libgsf' 'gstreamer0.10')
makedepends=('pkgconfig' 'intltool' 'gnome-common')
options=('!LIBTOOL')
conflicts=('tracker')
provides=('tracker')
source=()
md5sums=()
sha1sums=()

_svnmod="tracker"
_svntrunk="svn://svn.gnome.org/svn/tracker/trunk"

build() {
    cd $startdir/src/
    mkdir -p ~/.subversion; touch ~/.subversion/servers

    msg "Connecting to the SVN server...."

    svn co $_svntrunk $_svnmod -r $pkgver 

    [ -d ./$_svnmod-build ] && rm -fr ./$_svnmod-build
    cp -r ./$_svnmod ./$_svnmod-build
    cd ./$_svnmod-build

    msg "SVN checkout done or server timeout"
    msg "Starting make..."
  
    export ACLOCAL=`which aclocal`
    export ACLOCAL_FLAGS="-I /usr/share/aclocal"
    export ACLOCAL_PATH="/usr/share/aclocal"

  ./autogen.sh --prefix=/usr --sysconfdir=/etc --enable-preferences \
               --enable-video-extractor=gstreamer \
               --enable-external-sqlite --enable-file-monitoring=inotify --enable-gui

  make || return 1
  make DESTDIR=$startdir/pkg install

  # Remove Deskbar handler
  rm -f $startdir/pkg/tracker-handler.py
}
