# Maintainer: Jake Tucker <jaketckr+arch@gmail.com>
### INSTALLATION NOTE ###
# After installation, you must ensure that you relogin to properly setup the CNETPATH environment variable. Alternatively, you can manually 'export CNETPATH=/usr/lib/cnet' in each terminal window as needed.

pkgname=cnet
pkgver=3.3.1
pkgrel=1
pkgdesc="Enables development of and experimentation with a variety of protocols in networks"
arch=('i686' 'x86_64')
url="http://www.csse.uwa.edu.au/cnet/"
license=('GPL2')
depends=('tk>=8.4' 'elfutils')
options=('staticlibs')
source=(Makefile.patch src.Makefile.linux.patch support.Makefile.common.patch cnet.sh)
md5sums=('c24a6296f95fdd02121cce557949eaee' '0b70b1ad53ed27a5aec71f2dc93d7125' '76282da17f289352657ab0dd927b9167' 'd1c2b8e09ee6b2a811ed79505dce6c70')

prepare() {
  if [ ! -r $srcdir/$pkgname-$pkgver.tgz ]; then
	  curl --data "email=&role=other&role-other=&location=&country=&os=linux&os-other=" https://secure.csse.uwa.edu.au/run/cnet-download > $pkgname-$pkgver.tgz
  fi
  tar -xf $pkgname-$pkgver.tgz
  patch "$pkgname-$pkgver/src/Makefile.linux" < src.Makefile.linux.patch
  patch "$pkgname-$pkgver/support/Makefile.common" < support.Makefile.common.patch
  patch "$pkgname-$pkgver/Makefile" < Makefile.patch
}

build() {
  cd "$srcdir/$pkgname-$pkgver"
  make PREFIX=$pkgdir/usr
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  make PREFIX=$pkgdir/usr install
  mkdir -p $pkgdir/etc/profile.d
  cp $srcdir/cnet.sh $pkgdir/etc/profile.d/cnet.sh
  echo -e "\e[7m### PLEASE NOTE ###\e[0m"
  echo "After installation, you must ensure that you relogin to properly setup the CNETPATH environment variable. Alternatively, you can manually 'export CNETPATH=/usr/lib/cnet' in each terminal window as needed."
echo -e "\e[7m###################\e[0m"
}
