commit faebd52f08f519b46ae5e6e9e12a96aa212f1a98
Author: ervandew <ervandew@gmail.com>
Date:   Mon Jan 23 14:35:33 2012 -0800

    update for sphinx 1.1.2

diff --git a/doc/extension/eclim/sphinx/builder.py b/doc/extension/eclim/sphinx/builder.py
index 0bdcc33..c3977fe 100644
--- a/src/doc/extension/eclim/sphinx/builder.py
+++ b/src/doc/extension/eclim/sphinx/builder.py
@@ -125,7 +125,8 @@ class EclimBuilder(StandaloneHTMLBuilder):
 # EV: end main toc
 
     # local TOC and global TOC tree
-    toc = self.render_partial(self.env.get_toc_for(docname))['fragment']
+    self_toc = self.env.get_toc_for(docname, self)
+    toc = self.render_partial(self_toc)['fragment']
 
     return dict(
       parents = parents,
diff --git a/doc/extension/eclim/sphinx/environment.py b/doc/extension/eclim/sphinx/environment.py
index 0031fec..5113c4d 100644
--- a/src/doc/extension/eclim/sphinx/environment.py
+++ b/src/doc/extension/eclim/sphinx/environment.py
@@ -82,6 +82,12 @@ class EclimHtmlBuildEnvironment(EclimBuildEnvironment):
         # find all toctree nodes in this section and add them
         # to the toc (just copying the toctree node which is then
         # resolved in self.get_and_resolve_doctree)
+        if isinstance(sectionnode, addnodes.only):
+          onlynode = addnodes.only(expr=sectionnode['expr'])
+          blist = build_toc(sectionnode, depth)
+          if blist:
+            onlynode += blist.children
+            entries.append(onlynode)
         if not isinstance(sectionnode, nodes.section) or (main and title_visited):
           for toctreenode in traverse_in_section(sectionnode,
                                                  addnodes.toctree):
