# Contributor: Christian Rapp <saedelaere.tv@googlemail.com>
pkgname=tv-viewer-bzr
pkgver=168
pkgrel=1
pkgdesc="TV-Viewer is a frontend to watch and record tv. It supports analog tv and devices with a build-in hardware MPEG-2 encoder. This package provides the latest source code."
arch=('i686' 'x86_64')
url="http://tv-viewer.sourceforge.net/"
license=('GPL')
depends=('tcl>=8.5' 'tk>=8.5' 'ivtv-utils' 'mplayer' 'xdg-utils' 'glibc' 'libxdmcp' 'libxau' 'libxcb' 'libx11')
makedepends=('bzr')
optdepends=(
'tkimg: provides png support for tk < 8.6'
)
#tkimg: If using tk < 8.6 this provides png support
provides=(tv-viewer)
conflicts=(tv-viewer)

_bzrtrunk=bzr://tv-viewer.bzr.sourceforge.net/bzrroot/tv-viewer/trunk
_bzrmod=trunk

build() {
  cd "$srcdir"
  msg "Connecting to tv-viewer bzr server..."

  if [ -d "$srcdir/$_bzrmod" ] ; then
    cd $_bzrmod
    bzr update
    msg "The local files are updated."
    msg "bzr checkout done or server timeout"
    msg "configuring build system..."
    chmod a+x ./configure.tcl
    ./configure.tcl --prefix="$pkgdir/usr" --bintarget="/usr/share/tv-viewer" --nodepcheck --quiet
    msg "starting make..."
	chmod a+x ./install.tcl
    ./install.tcl --quiet
  else
    bzr checkout $_bzrtrunk
    cd $_bzrmod
    msg "bzr checkout done or server timeout"
    msg "configuring build system..."
    chmod a+x ./configure.tcl
    ./configure.tcl --prefix="$pkgdir/usr" --bintarget="/usr/share/tv-viewer" --nodepcheck --quiet
    msg "starting make..."
	chmod a+x ./install.tcl
    ./install.tcl --quiet
  fi
}
