# Maintainer: kevku <kevku@gmx.com>
pkgname=esteidpkcs11loader
_browser=firefox
pkgver=3.7.0.833
pkgrel=2
pkgdesc="Loads PKCS11 module for web authentication with smart cards (Official version by AS Sertifitseerimiskeskus)"
arch=('any')
url="http://www.id.ee/"
license=('LGPL')
depends=('opensc012' 'esteidcerts' 'ccid')
makedepends=('cmake' 'unzip' 'zip')
conflicts=('esteid-browser-plugin-svn' 'sk-esteidpkcs11loader-svn')
source=("http://ftp.id.eesti.ee/pub/id/signed_repository/sources/$pkgname-$pkgver.tar.gz"
	"http://ftp.id.eesti.ee/pub/id/signed_repository/sources/$pkgname-$pkgver.tar.gz.asc"
	"esteidpkcs11loader-archlinux.patch" )
sha256sums=('bb079b8c114931463e391c3648b5d32c760911b1b4684487c078703062858754'
            '54023f48bce570b11719b64de67c594756b1cce110616501400ab33bb84546c5'
            'c00e7ac5c4eaa4d0ee2e7821e56051e95c5667a43e0bf4ccfcefa228fa0fe46b')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  #sed -i 's|(bits == 64) ? "/usr/lib64/" :||g' chrome/content/pkcs11-loader.js
  #sed -i 's|/usr/etc/digidocpp/certs/|/usr/share/esteid/certs/|g' chrome/content/pkcs11-loader.js
  #sed -i 's|onepin-opensc-pkcs11|opensc-pkcs11|g' chrome/content/pkcs11-loader.js
  patch -Np1 -i "$srcdir/esteidpkcs11loader-archlinux.patch"
  cmake . -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBDIR="lib" -DCMAKE_INSTALL_SYSCONFDIR="/etc"
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  mkdir -p "$pkgdir/usr/lib/$_browser/extensions"
  cp -r "{aa84ce40-4253-a00a-8cd6-0800200f9a66}" "$pkgdir/usr/lib/$_browser/extensions/"
}
