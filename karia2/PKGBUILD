# Maintainer: Adam Lloyd <lloyda2 (at) rpi (dot) edu>
# Contributor: Stefan Husmann <stefan-husmann@t-online.de>
pkgname=karia2
pkgver=37
pkgrel=1
pkgdesc="QT4 interface for aria2 download mananger"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/karia2"
license=('GPL3')
depends=('qt>=4' 'aria2' 'libxinerama' 'libxcursor')
makedepends=('subversion')
source=()
md5sums=()

_svntrunk=https://karia2.svn.sourceforge.net/svnroot/karia2
_svnmod=$pkgname

build() {
  cd $srcdir

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -r $_svnmod-build
  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build

  #
  # BUILD
  #
  qmake || return 1
  sed -i 's;/opt/karia2/resume;/usr/bin/karia2-resume;' karia2.cpp
  make PREFIX=/usr || return 1
  install -Dm755 $pkgname $pkgdir/usr/bin/$pkgname || return 1
  install -d $pkgdir/usr/share/$pkgname/ || return 1
  cp -R images $pkgdir/usr/share/$pkgname/ || return 1
  install -Dm755 bin/resume $pkgdir/usr/bin/karia2-resume || return 1
  rm -rf $pkgdir/usr/share/karia2/images/.svn || return 1 
}
