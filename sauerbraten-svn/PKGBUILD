# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname=sauerbraten-svn
pkgver=3562
pkgrel=1
pkgdesc="Free multiplayer/singleplayer FPS, built as a major redesign of the Cube FPS"
url="http://sauerbraten.org/"
depends=('libgl' 'mesa' 'sdl_image' 'sdl_mixer')
makedepends=('subversion')
arch=('i686' 'x86_64')
license=('ZLIB')

_svntrunk=https://sauerbraten.svn.sourceforge.net/svnroot/sauerbraten
_svnmod=sauerbraten

build() {
  cd $srcdir/sauerbraten

  svn checkout $_svntrunk --config-dir ./ -r $pkgver $_svnmod

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  mkdir -p $pkgdir/usr/share/sauerbraten
  cp sauerbraten_unix server-init.cfg $pkgdir/usr/share/sauerbraten
  cp -R bin_unix/ data/ packages/ $pkgdir/usr/share/sauerbraten

  # Start file
  install -Dm755 $startdir/sauerbraten $pkgdir/usr/bin/sauerbraten

  # Desktop icon
  install -Dm644 data/cube.png $pkgdir/usr/share/pixmaps/sauerbraten.png
  install -Dm644 $startdir/sauerbraten.desktop $pkgdir/usr/share/applications/sauerbraten.desktop

  # License
  install -Dm644 src/readme_source.txt $pkgdir/usr/share/licenses/sauerbraten/LICENSE

  # Remove unneeded files
  cd $pkgdir/usr/share/sauerbraten
  rm -rf bin_unix/.svn
  rm -rf data/.svn
  rm -rf packages/.svn

  cd bin_unix
  if [ "${CARCH}" = 'x86_64' ]; then
  rm linux_client linux_server
    elif  [ "${CARCH}" = 'i686' ]; then 
  rm linux_64_client linux_64_server
  fi
}