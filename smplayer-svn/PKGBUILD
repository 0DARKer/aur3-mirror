# Creator: Flamelab <panosfilip@gmail.com>
# Parts have been adopted by the previous contributor, AddictedToChaos and by the user "urandom"
# Fixes by: WAntilles <wantilles@adslgr.com>

pkgname=smplayer-svn
pkgver=3592
pkgrel=1
_latestver=0.6.9
pkgdesc="A complete front-end for MPlayer"
arch=('i686' 'x86_64')
url="http://smplayer.sourceforge.net/"
license=('GPL')
depends=('qt>=4.7.1' 'mplayer>=32663')
makedepends=('subversion')
conflicts=('smplayer')
provides=("smplayer=${_latestver}")

_svnmod="smplayer"
_svntrunk=https://smplayer.svn.sourceforge.net/svnroot/smplayer/smplayer/trunk/


build()

{
     cd "${srcdir}"

     if [ -d $_svnmod/.svn ]; then
          (cd $_svnmod && svn up -r $pkgver)
     else
          svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
     fi

     msg "SVN checkout done or server timeout"
     msg "Starting make..."

     if [ -d $_svnmod-build ];then
        rm -r $_svnmod-build
     fi
     cp -r $_svnmod $_svnmod-build
     cd $_svnmod-build


      # remove broken translation
     sed -i "s|translations/smplayer_gl.ts|#translations/smplayer_gl.ts|" src/smplayer.pro || return 1

     sed -i 's/PREFIX=.*/PREFIX=\/usr/' Makefile || return 1
     make PREFIX=/usr || return 1
     make DESTDIR=${pkgdir} PREFIX=/usr KDE_PREFIX=/usr install || return 1

     install -dm755 ${pkgdir}/usr/share/pixmaps
     ln -s ${pkgdir}/usr/share/icons/hicolor/64x64/apps/smplayer.png ${pkgdir}/usr/share/pixmaps/

     sed -i 's|Exec=smplayer %U|Exec=smplayer %F|' ${pkgdir}/usr/share/applications/smplayer.desktop || return 1
     sed -i 's|Exec=smplayer -add-to-playlist %U|Exec=smplayer -add-to-playlist %F|' ${pkgdir}/usr/share/applications/smplayer_enqueue.desktop || return 1

}
md5sums=('7da2927266bc73a69a4dac0fae54c750')
