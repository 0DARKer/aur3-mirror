# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname=calligra-git
pkgver=20110217
pkgrel=1
pkgdesc="A continuation of the KOffice project."
url="http://www.calligra-suite.org/"
arch=('i686' 'x86_64')
license=('FDL1.2' 'GPL2' 'LGPL')
depends=('kdelibs' 'kdepimlibs' 'qca' 'lcms' 'hicolor-icon-theme' 'sqlite3' 'gsl'\
	 'glew' 'qimageblitz' 'poppler-qt' 'shared-mime-info' 'openexr' 'opengtl' \
	 'libpqxx' 'freetds' 'fftw' 'libspnav')
makedepends=('automoc4' 'boost' 'cmake' 'eigen' 'git' 'pkgconfig' 'pstoedit' 'libwpd' \
	     'kdegraphics-libs' 'docbook-xml' 'docbook-xsl')
optdepends=('libwpd: WordPerfect document importer'
	    'libwpg: Corel WordPerfect Graphics image importer' 
	    'pstoedit: Karbon EPS import filter'
	    'kdegraphics-libs: support for raw images')
install=calligra.install
conflicts=('koffice')

_gitroot="git://anongit.kde.org/calligra"
_gitname="calligra"

build() {

cd $srcdir
  msg "Connecting to the GIT server...."
  
  if [[ -d $srcdir/$_gitname ]] ; then
    cd $_gitname
    git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi
  
  msg "GIT checkout done"
  msg "Starting make..."
  
  mkdir $srcdir/$_gitname-build
 
  cd $srcdir/$_gitname-build
  cmake $startdir/src/$_gitname -DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SKIP_RPATH=ON \
		-DBUILD_koabstraction:BOOL="0" \
		-DCMAKE_INSTALL_PREFIX=/usr
  make
}

package() {
  cd ${srcdir}/$_gitname-build
  make DESTDIR=${pkgdir} install
  find ${pkgdir} -name '*.py' | xargs sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|'
  rm -r $srcdir/$_gitname-build
}
