# Contributor: Arto Puranen <purcher@gmail.com>

pkgname=zeroc-ice-cpp
pkgver=3.3.1
pkgrel=1
pkgdesc="RPC Library much like CORBA except API is completely new and written entirely by zeroc"
arch=('i686' 'x86_64')
url="http://www.zeroc.com"
license=('gpl')
depends=('db' 'openssl' 'expat' 'bzip2' 'mcpp>=2.7')
makedepends=()
conflicts=('zeroc-ice')
backup=()
install=('Ice.install')
source=(http://www.zeroc.com/download/Ice/3.3/Ice-$pkgver.tar.gz
		Ice.profile
		Makefile.patch)

build() {
  cd $startdir/src/Ice-$pkgver

  patch -R Makefile ../Makefile.patch
  
  #find . -name "*.cpp" -exec sed -i "1i#include <cstring>\n#include <cstdlib>\n#include <limits.h>\n#include <memory>\n#include <db.h>" {} \;
  #sed -i "s/memcpy/std::memcpy/" cpp/src/Slice/MD5.cpp
  #sed -i "1i#include <memory>" cpp/include/Ice/Outgoing.h
  #sed -i "1i#define DB_LOG_AUTOREMOVE 0x00000004" cpp/src/Freeze/SharedDbEnv.cpp
  
  make || return 1
  mkdir -p $startdir/pkg/opt/Ice-$pkgver
  make prefix=$startdir/pkg/opt/Ice-$pkgver install
  
  install -D -m755 $startdir/Ice.profile $startdir/pkg/etc/profile.d/ice.sh
}
md5sums=('0500306d9cdbc0fbb553fbb529de557a'
         '8c987c73122b7079d8a5cdd2cc6afc0c'
         '04d478be63b34578740a2fbf86029aff')
md5sums=('1f37dfcec4662fcde030553fb447d064'
         '8c987c73122b7079d8a5cdd2cc6afc0c'
         '04d478be63b34578740a2fbf86029aff')
