# Puppetdb: Installer: Arch
# Maintainer: Niels Abspoel <aboe76 (at) Gmail (dot) com>

# RC style, reserved for later use
#pkgname=puppetdb-terminus
#_rc=8
#_pkgver=3.0.0
#pkgver=${_pkgver}_rc${_rc}

pkgname=puppetdb-terminus
pkgver=1.2.0
pkgrel=1
pkgdesc="Puppet data warehouse; it manages storage and retrieval of all platform-generated data"
arch=("any")
url="http://puppetlabs.com/projects/puppetdb/"
license=("APACHE")
depends=("puppetdb")
options=(emptydirs)
provides=("puppetdb-terminus")
conflicts=()
source=(http://apt.puppetlabs.com/pool/quantal/main/p/puppetdb/puppetdb-terminus_${pkgver//_/-}-${pkgrel}puppetlabs1_all.deb)
md5sums=('55cd38aa5cc6e89e1df58e68db842904')

build() {
  cd "$srcdir"

  bsdtar xf "$srcdir/data.tar.gz"

}
package () {
# find out which puppet:
puppetversion=`gem list | grep puppet | sed 's|[^(]*(\([^)]*\)).*|\1|'`

# move deb provided dirs to right place
  mkdir -p "$pkgdir/usr/lib/ruby/gems/2.0.0/gems/puppet-${puppetversion}/lib"
  mkdir -p "$pkgdir/usr/"
  cp -dpr --no-preserve=ownership "$srcdir/usr/lib/ruby/vendor_ruby/puppet/" "$pkgdir/usr/lib/ruby/gems/2.0.0/gems/puppet-${puppetversion}/lib"
  cp -dpr --no-preserve=ownership "$srcdir/usr/share" "$pkgdir/usr/"
}
