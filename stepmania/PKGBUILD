# Maintainer: Artefact2 <artefact2@gmail.com>
# Contributor: Lauri Niskanen <ape@ape3000.com>
# Contributor: Travis Nickles <ryoohki7@yahoo.com>
# Contributor: Stefan Lohmaier <noneuss at gmail dot com>
# Contributor: ZipFile <lin.aaa.lin@gmail.com>
# Contributor: Carlos Solis <csolisr at gmail dot com>

pkgname=stepmania
pkgver=5.0b3
pkgrel=1
pkgdesc="A free dance and rhythm game (was previously sm-ssc)"
url="http://www.stepmania.com/"
license="MIT"
arch=(i686 x86_64)
depends=('gtk2' 'libmad' 'mesa' 'glew' 'ffmpeg' 'libpng')
replaces=('sm-ssc')
makedepends=('pkgconfig')
install='stepmania.install'
source=(stepmania.sh
		stepmania.install
		https://github.com/stepmania/stepmania/archive/SM5-beta3.tar.gz
)

md5sums=('2bd765651419c12a5b678e62309ee3c5'
		 'ec1c607d718626996ead1927dae81c97'
		 '34c3ec3e0cdc9b37ab323cbf09cf8a5a')

_directory="stepmania-SM5-beta3"

build() {
	cd $srcdir
	ls
	cd $srcdir/$_directory

	./autogen.sh
	./configure --prefix=$pkgdir/opt || return 1
	make || return 1
}

package() {
	cd $srcdir/$_directory
	mkdir -p "$pkgdir/opt/stepmania 5"

	make install
	install -D -m755 $srcdir/$pkgname.sh $pkgdir/usr/bin/$pkgname
	install -D -m755 $pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
	install -D -m644 Docs/Licenses.txt $pkgdir/usr/share/licenses/$pkgname/Licenses.txt
	#chown -R root:games icons
	cp -ar icons $pkgdir/usr/share/

	cd $pkgdir/opt/
	mv "stepmania 5" stepmania
	#chown -R root:games stepmania $pkgdir

	# Allow users in the "games" group to copy songs, themes etc., and
	# set the sticky bit on these directories
	#chmod 2775 stepmania/{Songs,Themes,NoteSkins}
}
