# Maintainer: Sergei Lebedev <superbobry@gmail.com>
# Contributor: Magnus Therning <magnus@therning.org>

pkgname=ocaml-oasis
pkgver=0.2.0
pkgrel=5
pkgdesc='Architecture for building OCaml libraries and applications.'
arch=('i686' 'x86_64')
url=("http://oasis.forge.ocamlcore.org")
license=('LGPL')
depends=('glibc' 'pcre')
makedepends=('ocaml'
             'ocaml-extlib'
             'ocaml-fileutils>=0.4.2'
             'ocaml-findlib'
             'ocaml-ocamlgraph'
             'ocaml-ocamlify'
             'ocaml-odn>=0.0.3'
             'ocaml-ounit'
             'ocaml-pcre'
             'ocaml-expect')
source=(https://forge.ocamlcore.org/frs/download.php/501/oasis-$pkgver.tar.gz)
sha256sums=('085067782ad944e8650a4a5b70e7ef097687987cacd757f973de09daf4431345')
options=(!strip)
changelog=$pkgname.changelog

build() {
  cd "$srcdir/${pkgname/ocaml-/}-$pkgver"

  ocaml setup.ml -configure --prefix /usr --destdir $pkgdir
  ocaml setup.ml -build || return 1
}

package() {
  cd "$srcdir/${pkgname/ocaml-/}-$pkgver"

  export OCAMLFIND_DESTDIR="$pkgdir$(ocamlfind printconf destdir)"
  mkdir -p $OCAMLFIND_DESTDIR
  make install
}
