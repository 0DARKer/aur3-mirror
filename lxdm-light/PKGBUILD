# Maintainer: megadriver <megadriver at gmx dot com>
# Based on lxdm from [community]

pkgname=lxdm-light
_pkgname=lxdm
pkgver=0.4.1
pkgrel=1
pkgdesc="Lightweight Display Manager (*kit free!)"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/lxdm/"
license=('GPL')
depends=('gtk2' 'xorg-server')
makedepends=('intltool')
conflicts=('lxdm' 'consolekit' 'polkit')
provides=('lxdm')
install=${pkgname}.install
backup=('etc/lxdm/lxdm.conf' 'etc/pam.d/lxdm' 'etc/lxdm/Xsession'
        'etc/lxdm/PreLogin' 'etc/lxdm/LoginReady' 'etc/lxdm/PostLogin'
        'etc/lxdm/PostLogout' 'etc/lxdm/PreReboot' 'etc/lxdm/PreShutdown')
source=("http://downloads.sourceforge.net/lxde/$_pkgname-$pkgver.tar.gz"
        lxdm.patch lxdm-conf.patch lxdm-pam.patch Xsession.patch lxdm-daemon)
md5sums=('8da1cfc2be6dc9217c85a7cf51e1e821'
         'baed9055e8825a5511712bc095197519'
         '167a7d2017462e0260ef7d030763a72b'
         'b20fe3c8487a039050986d60e45233a9'
         'cdfb79089bb32d8ebea534bda269f837'
         '705f394052fdd0dec22e95321d170de0')

build() {
	cd "$srcdir/$_pkgname-$pkgver"
    ./configure --sysconfdir=/etc --prefix=/usr --libexecdir=/usr/lib/lxdm
	make
  	
	patch -Np0 < ../lxdm.patch
    patch -Np0 < ../lxdm-conf.patch
    patch -Np0 < ../Xsession.patch
}


package() {
	cd "$srcdir/$_pkgname-$pkgver"
  	make DESTDIR="$pkgdir" install

	install -m644 $srcdir/lxdm-pam.patch $pkgdir/etc/pam.d/lxdm
	install -Dm755 $srcdir/lxdm-daemon $pkgdir/etc/rc.d/lxdm
    install -d $pkgdir/var/{lib,run}/lxdm

	# fix the greeter location
	sed -i -e "s/local\/libexec/lib\/lxdm/" $pkgdir/etc/lxdm/lxdm.conf
}
