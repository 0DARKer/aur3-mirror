#Maintainer: Isaac Dupree <id@isaac.cedarswampstudios.org>
#Contributor: Sebastien Duquette <ekse.0x@gmail.com>
pkgname=smem
pkgver=0.9
pkgrel=1
pkgdesc="Generate reports on memory usage."
url="http://www.selenic.com/smem/"
license=("GPL")
depends=('python2')
optdepends=('python-matplotlib: for chart generation')
arch=('i686' 'x86_64')
source=("http://www.selenic.com/smem/download/${pkgname}-${pkgver}.tar.gz"
        "smem_python2.patch")
md5sums=('2c5a3b6cb40d24af73c403d2571c7916'
         '2ecdf4b26ebf4368129542ee92c80527')

#Too bad it doesn't provide a makefile.

build() {
	#There are a few changes in the hg repo that indicate
	#smemcap should be installed and capture is obsolete.
  	cd $srcdir/$pkgname-$pkgver
	patch smem < $srcdir/smem_python2.patch
	gcc -O2 smemcap.c -o smemcap
	gzip -f smem.8
}
package() {
  	cd $srcdir/$pkgname-$pkgver
	mkdir -p $pkgdir/usr/bin/
	install -m 755 smem $pkgdir/usr/bin/
	install -m 755 smemcap $pkgdir/usr/bin/
	mkdir -p $pkgdir/usr/share/man/man8/
	install -m 644 smem.8.gz $pkgdir/usr/share/man/man8/
}

