# Maintainer: Jesse Jaara <gmail.com: jesse.jaara>

pkgname=ohrrpgce
pkgver=20101108
pkgrel=2
pkgdesc="Official Hamster Republic Role Playing Game Construction Engine"
arch=(i686 x86_64)
url="http://hamsterrepublic.com/ohrrpgce/Main_Page.html"
license=('GPL')
if [ "$CARCH" = "x86_64" ]; then
depends=('lib32-sdl' 'lib32-sdl_mixer' 'lib32-libxpm' 'timidity++' 'euphoria3' )
makedepends=('gcc-multilib')
else
depends=('sdl' 'sdl_mixer' 'timidity++' 'euphoria3' 'libxpm')
fi
makedepends=('freebasic')
source=(http://huulivoide.pp.fi/Arch/$pkgname-$pkgver.tar.xz)

build() {
  cd "$srcdir/$pkgname-$pkgver"
  if [ "$CARCH" = "x86_64" ]; then
  sed 's|gcc|gcc -m32|g' -i makeedit.sh
  sed 's|gcc|gcc -m32|g' -i makegame.sh
  fi
  ./makeedit.sh
  ./makegame.sh
  ./makeutil.sh
  sed 's|hspeak.exw|/usr/share/ohrrpgce/hspeak.exw|g' -i hspeak.sh
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  mv ohrrpgce-custom ohrrpgce-custom.bin
  echo -e "#!/bin/sh\ncd /usr/share/ohrrpgce\nexec ./ohrrpgce-custom.bin \"\${@}\""\
	> ohrrpgce-custom && chmod +x ohrrpgce-custom
  mkdir -p "${pkgdir}/usr/bin/"
  mkdir -p "${pkgdir}/usr/share/ohrrpgce/"
  mkdir -p "${pkgdir}/usr/share/doc/ohrrpgce/"

  cp ohrrpgce-{game,custom} {re,un}lump "${pkgdir}/usr/bin/"
  cp hspeak.sh hsspiffy.e ohrrpgce-custom.bin "${pkgdir}/usr/share/ohrrpgce/"
  cp ohrrpgce.new plotscr.hsd scancode.hsi "${pkgdir}/usr/share/ohrrpgce/"
  cp -r import "${pkgdir}/usr/share/ohrrpgce/"
  cp -r docs "${pkgdir}/usr/share/doc/ohrrpgce/"
  cp -r ohrhelp "${pkgdir}/usr/share/doc/ohrrpgce/"
}

# vim:set ts=2 sw=2 et:
md5sums=('f0108392b015533939f2f946e2c17254')
