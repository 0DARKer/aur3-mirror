# Maintainer: Jesse Jaara <gmail.com: jesse.jaara>

pkgname=ohrrpgce
pkgver=20110506.1
pkgrel=1
pkgdesc="Official Hamster Republic Role Playing Game Construction Engine"
arch=(i686 x86_64)
url="http://hamsterrepublic.com/ohrrpgce/Main_Page.html"
license=('GPL')
if [ "$CARCH" = "x86_64" ]; then
depends=('lib32-sdl_mixer' 'lib32-libxpm' 'timidity++' 'euphoria3' )
makedepends=('gcc-multilib')
else
depends=('sdl_mixer' 'timidity++' 'euphoria3' 'libxpm')
fi
makedepends=('freebasic')
source=(http://huulivoide.pp.fi/Arch/$pkgname-$pkgver.tar.xz
	hsspiffy.e.revert.patch		makeutil.patch)

build() {
  cd "$srcdir/$pkgname-$pkgver"
  if [ "$CARCH" = "x86_64" ]; then
  sed 's|gcc|gcc -m32|g' -i makeedit.sh
  sed 's|gcc|gcc -m32|g' -i makegame.sh
  fi

  patch -p0 -i ../hsspiffy.e.revert.patch
  patch -p0 -i ../makeutil.patch

  ./makeedit.sh
  ./makegame.sh
  ./makeutil.sh
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  mv ohrrpgce-custom ohrrpgce-custom.bin
  echo -e "#!/bin/sh\ncd /usr/share/ohrrpgce\nexec ./ohrrpgce-custom.bin \"\${@}\""\
	> ohrrpgce-custom && chmod +x ohrrpgce-custom
  mkdir -p "${pkgdir}/usr/bin/"
  mkdir -p "${pkgdir}/usr/share/ohrrpgce/"
  mkdir -p "${pkgdir}/usr/share/doc/ohrrpgce/"

  cp hspeak ohrrpgce-{game,custom} {re,un}lump "${pkgdir}/usr/bin/"
  cp ohrrpgce-custom.bin "${pkgdir}/usr/share/ohrrpgce/"
  cp ohrrpgce.new plotscr.hsd scancode.hsi "${pkgdir}/usr/share/ohrrpgce/"
  cp -r import "${pkgdir}/usr/share/ohrrpgce/"
  cp -r docs "${pkgdir}/usr/share/doc/ohrrpgce/"
  cp -r ohrhelp "${pkgdir}/usr/share/doc/ohrrpgce/"
}

# vim:set ts=2 sw=2 et:
md5sums=('892b782b96b69b35250047b8780deab2'
         '3ab29a517a374e8bda261307d48d7efe'
         'ee94a19f18df9f6eaefff01a487275f5')
