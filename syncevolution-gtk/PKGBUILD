# Contributor: Tom Vincent <http://www.tlvince.com/>
# Maintainer:Max Kuchugura <maksvlad-at-ya-dot-ru>

pkgname=syncevolution-gtk
_pkgname=syncevolution
pkgver=1.1.1
_pkgver_suf=a
pkgrel=1
pkgdesc="Provides full two-way synchronization for Evolution via SyncML and \
         Bluetooth without the Evolution/Gnome dependencies."
arch=('i686' 'x86_64')
url="http://syncevolution.org/"
license=('GPL')
depends=('openobex' 'libsoup' 'libgnome-keyring' 'python2' 'intltool')
optdepends=('twisted: for built-in SyncML server support'
            'python2: for built-in SyncML server support'
            'libnotify: for built-in SyncML server support')
makedepends=('autoconf' 'boost' 'pkg-config')
provides=('syncevolution')
conflicts=('syncevolution' 'syncevolution-git' 'syncevolution-bin')
source=(http://downloads.syncevolution.org/syncevolution/sources/$_pkgname-$pkgver$_pkgver_suf.tar.gz)
md5sums=('78f73c51e5f16283eb5cf3ed306ccb1f')

build() {
    cd "$srcdir/$_pkgname-$pkgver"

    ./configure --prefix=/usr \
	--enable-gui \
	--enable-bluetooth \
        --disable-ebook \
        --disable-ecal \
        --disable-shared \
        --enable-dbus-service \
        || return 1
    make || return 1
    make DESTDIR="${pkgdir}" install || return 1
    ln -s "${pkgdir}/usr/libexec/syncevo-dbus-server" \
	  "${pkgdir}/usr/bin/syncevo-dbus-server"
    sed -i 's/\/usr\/bin\/python/\/usr\/bin\/python2/' ${pkgdir}/usr/bin/syncevo-phone-config
    sed -i 's/\/usr\/bin\/python/\/usr\/bin\/python2/' ${pkgdir}/usr/bin/syncevo-http-server
}