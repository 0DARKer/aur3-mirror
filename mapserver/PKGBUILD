# Maintainer: Samuel Mesa <samuelmesa@linuxmail.org>
# Contributor: Marcos Piccinini <x@nofxx.com>
pkgname=mapserver
pkgver=6.2.0
pkgrel=2
pkgdesc="Platform for publishing spatial data and interactive mapping applications to the web"
arch=(i686 x86_64)
license=('MIT')
url="http://www.mapserver.org"
depends=('libpng' 'freetype2' 'gd' 'zlib' 'gdal' 'proj' 'libjpeg' 'libxml2' 'libpqxx' 'pdflib-lite' 'geos' 'agg' 'apache' 'python2' 'php' )
makedepends=('cfitsio')
options=()
source=("http://download.osgeo.org/mapserver/mapserver-6.2.0.tar.gz")
md5sums=('247153e5f4a9d66366bcda70271d2a26')

build() {
  echo ${startdir}/src/${pkgname}-${pkgver} 
  cd ${startdir}/src/${pkgname}-${pkgver}

  ./configure  --enable-point-z-m \
               --with-freetype=/usr/ \
               --with-xpm \
               --with-libiconv \
               --with-gd \
               --with-agg-svg-symbols \
               --with-proj \
               --with-threads \
               --with-geos \
               --with-ogr \
               --with-gdal \
               --with-postgis \
               --with-wcs \
               --with-wfs \
               --with-wmsclient \
               --with-wfsclient \
               --with-curl-config \
               --with-cairo \
               --with-warnings \
               --with-kml \
               --with-httpd=/usr/sbin/httpd \
               --with-tiff \
               --with-jpeg \
               --with-png \
               --with-threads \
               --with-sos \
               --with-agg \
               --with-xml2-config=/usr/bin/xml2-config \
               --with-python=/usr/bin/python2 \
               --enable-python-mapscript \
               --with-php=yes \
               --enable-debug || return 1

  make || return 1
  mkdir -p ${startdir}/pkg/usr/local/bin || return 1
  mkdir -p ${startdir}/pkg/usr/lib || return 1
}

package() {
  cd ${startdir}/src/${pkgname}-${pkgver}
  install -m755 mapserv ${startdir}/pkg/usr/local/bin/mapserv || return 1
  install -m755 mapserver-config ${startdir}/pkg/usr/local/bin/mapserver-config || return 1
  install -m755 tile4ms ${startdir}/pkg/usr/local/bin/tile4ms || return 1
  install -m755 sortshp ${startdir}/pkg/usr/local/bin/sortshp || return 1
  install -m755 scalebar ${startdir}/pkg/usr/local/bin/scalebar || return 1
  install -m755 shptreevis ${startdir}/pkg/usr/local/bin/shptreevis || return 1
  install -m755 shptree ${startdir}/pkg/usr/local/bin/shptree || return 1
  install -m755 shp2img ${startdir}/pkg/usr/local/bin/shp2img || return 1
  install -m755 legend ${startdir}/pkg/usr/local/bin/legendlibmapserver.la || return 1 
  install -m755 libmapserver.la ${startdir}/pkg/usr/lib/libmapserver.la || return 1
  install -m755 .libs/libmapserver-6.2.0.so ${startdir}/pkg/usr/lib/libmapserver-6.2.0.so || return 1    
  cd ${startdir}/src/${pkgname}-${pkgver}/mapscript/python/
  python2 setup.py install --prefix=/usr/local --root=$startdir/pkg
} 

# To compile with Arcgis SDE Support:
#   --with-sde-version=90 \
#   --with-sde=/usr/sde/sdeexe90 \

