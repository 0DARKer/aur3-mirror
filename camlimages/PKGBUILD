pkgname=camlimages
pkgver=4.1.1
pkgrel=2
pkgdesc="Objective Caml image processing library"
arch=(i686 x86_64)
url="http://gallium.inria.fr/camlimages"
license=('GPL2')
optdepends=('libpng' 'libtiff' 'libxpm' 'giflib' 'freetype2' 'libjpeg')
makedepends=('ocaml' 'ocaml-findlib' 'omake')
options=('staticlibs')
#optdepends=('lablgtk' 'lablgtk2')
source=("https://bitbucket.org/camlspotter/camlimages/get/$pkgver.tar.gz"
        "giflib.patch")
sname=camlspotter-camlimages-e4e7c50d80c2
md5sums=('9564f75f0c5c95d321e6e3d5246d277c'
         '8585926e10f585f8dc257cd80b27b6b3')

build() {
  cd "$srcdir/$sname"
  omake || return 1
}

prepare () {
    patch -s -p0 < giflib.patch
}
package () {
        mkdir -p "$pkgdir/$(ocamlfind printconf destdir)"
        mkdir -p "$pkgdir/$(ocamlfind printconf destdir)/stublibs"
  cd $srcdir/$sname
        OCAMLFIND_DESTDIR="$pkgdir/$(ocamlfind printconf destdir)" \
        omake install
  install -Dm 644 License.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE

}


