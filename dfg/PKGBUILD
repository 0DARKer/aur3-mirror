# Contributor: Pnevma <Klavious@gmail.com>
# Contributor: djnm <nmihalich [at} gmail dott com>
# Contributor: ignus <m.a.lukasiewicz at gmail>
# Contributor: xnitropl <xnitropl at gmail dot com>

pkgname=dfg
pkgver=v21
pkgrel=2
pkgdesc="Mike Mayday's combined pack (DFG) is an unofficial semi-graphic version of Dwarf Fortress based on the work of the DF community."
arch=('i686' 'x86_64')
url="http://mayday.w.staszic.waw.pl/df.php"
license=('custom')
depends=('gtk2' 'sdl' 'sdl_image' 'libgl')
[ "$CARCH" = "x86_64" ] && depends=('lib32-glibc' 'lib32-gtk2' 'lib32-sdl_image' 'lib32-libgl' 'lib32-alsa-lib' 'lib32-mesa' 'lib32-libxdamage')
conflicts=('dwarffortress' 'bin32-dwarffortress')
provides=('dwarffortress' 'bin32-dwarffortress')
install=$pkgname.install
source=(http://www.bay12games.com/dwarves/df_28_181_40d16_linux.tar.bz2
        http://mayday.w.staszic.waw.pl/~mayday/upload/DFG21.zip
        dwarffortress
        dfg.desktop
        init.txt)
md5sums=('9af4261919293a8b5812a6db720b269a'
         '844c665b5c68f510e1b1081473368361'
         '8b081a0b081d5d204308de152420f24d'
         'e6bc3fedcfe87b7978efe688464969c0'
         'd7572d643c2cb1c8f47060333995b4ba')

build() {
  rm -r $srcdir/df_linux/raw
  cp -r $srcdir/raw $srcdir/df_linux/raw

  rm -r $srcdir/df_linux/data/art
  cp -r $srcdir/data/art $srcdir/df_linux/data/art

  cp $srcdir/data/init/embark_profiles.txt $srcdir/df_linux/data/init/embark_profiles.txt
  cp $startdir/init.txt $srcdir/df_linux/data/init/init.txt

  mkdir -p $pkgdir/opt/
  cp -r $srcdir/df_linux $pkgdir/opt/df_linux

  if [ "$CARCH" = "x86_64" ] ; then
    ln -s /opt/lib32/usr/lib/libjpeg.so.7.0.0 $pkgdir/opt/df_linux/libs/libjpeg.so.62
  fi
  
  chown -R root:games $pkgdir/opt/df_linux
  chmod -R 775 $pkgdir/opt/df_linux
  chmod 755 $pkgdir/opt/df_linux/df
  chmod 755 $pkgdir/opt/df_linux/dwarfort.exe
  
  install -D -m755 $startdir/dwarffortress $pkgdir/usr/bin/dwarffortress
  install -D -m644 $srcdir/df_linux/readme.txt $pkgdir/usr/share/licenses/dwarffortress/readme.txt
  install -D -m644 $startdir/dfg.desktop $pkgdir/usr/share/applications/dfg.desktop
  install -D -m644 $srcdir/icons/miner32.ico $pkgdir/usr/share/pixmaps/dfg/miner32.ico
}
# vim:set ts=2 sw=2 et:
