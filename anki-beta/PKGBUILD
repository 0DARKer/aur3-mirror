# Maintainer: Limao Luo <luolimao@gmail.com>

pkgname=anki-beta
pkgver=2.0
_pkgrel=rc2
pkgrel=${_pkgrel}_1
pkgdesc="Helps you remember facts (like words/phrases in a foreign language) efficiently. 2.0 beta version"
arch=(i686 x86_64)
url='http://ankisrs.net/'
license=(AGPL3)
depends=(python2-pyqt mplayer portaudio)
provides=(anki=$pkgver)
conflicts=(anki ankiqt-git)
install=anki.install
source=(http://ankisrs.net/download/mirror/beta/anki-$pkgver-$_pkgrel.tgz)
sha256sums=('acb76c5d5fb2255c175fb08abab4c768da87ce07c760c7e9fc9e44af2d70f1f6')
sha512sums=('5a5a7ea4c3f8d9db66d6238a7c64172aea63929f53a9d2a2e89f2b830dc4036f1f7099820c7d1904f89f007d2c90a0213daf7c1fddc96f852c62aefbf6985ea4')

build() {
    cd "$srcdir"/anki-$pkgver/

    # remove unneeded python libraries
    if [[ $(perl -e '($x,$y)=@ARGV; print $x cmp $y' $(python2 --version) "Python 2.7") == -1 ]]; then
        _not_python_version="2.7"
    else
        _not_python_version="2.6"
    fi
    if [[ $CARCH == "x86_64" ]]; then
        _not_arch="32"
    else
        _not_arch="64"
    fi
    rm -rf libanki/thirdparty/py{$_not_python_version*,*$_not_arch}/
}

package() {
    cd "$srcdir"/anki-$pkgver/
    sed -i 's:#!/usr/bin/env python:&2:' anki
    install -Dm755 anki "$pkgdir"/usr/bin/anki
    install -Dm644 anki.xpm "$pkgdir"/usr/share/pixmaps/anki.xpm
    install -Dm644 anki.png "$pkgdir"/usr/share/pixmaps/anki.png
    desktop-file-install anki.desktop --dir="$pkgdir"/usr/share/applications/
    install -Dm644 anki.1 "$pkgdir"/usr/share/man/man1/anki.1

    rm anki{,.xpm,.png,.desktop,.1}

    install -d "$pkgdir"/usr/share/anki/
    cp -a * "$pkgdir"/usr/share/anki/
}
