# Maintainer: Limao Luo <luolimao@gmail.com>

pkgname=anki-beta
pkgver=2.0
_pkgrel=beta18
pkgrel=${_pkgrel}_2
pkgdesc="Helps you remember facts (like words/phrases in a foreign language) efficiently. 2.0 beta version"
url='http://ankisrs.net/'
arch=(i686 x86_64)
license=(AGPL3)
depends=(python2-pyqt mplayer portaudio)
conflicts=(anki ankiqt-git)
provides=("anki=$pkgver")
source=(http://ankisrs.net/download/mirror/beta/anki-$pkgver-$_pkgrel.tgz)
sha256sums=('8c09969b795e74c7a7ae65a2a0407d8d406b597599303ef2bd1bbe4de43d4078')
sha512sums=('e7d64943e40ebd1b4528f5e78a81305236ac295bc8439cd0208252ac9460c2499f1e9bbfffb01c63c1af71bd484886cb50089d22f44602a3b6120c8f7a32da16') 

build() {
    cd $srcdir/anki-$pkgver/

    # remove unneeded python libraries
    if [ $(perl -e '($x,$y)=@ARGV; print $x cmp $y' $(python2 --version) "Python 2.7") == -1 ]; then
	_not_python_version="2.7"
    else
	_not_python_version="2.6"
    fi
    if [ $CARCH == "x86_64" ]; then
	_not_arch="32"
    else
	_not_arch="64"
    fi
    rm -rf libanki/thirdparty/py{$_not_python_version*,*$_not_arch}/
}

package() {
    cd $srcdir/anki-$pkgver/
    sed -i 's:#!/usr/bin/env python:&2:' anki
    install -Dm755 anki $pkgdir/usr/local/bin/anki;
    install -Dm644 anki.xpm $pkgdir/usr/share/pixmaps/anki.xpm;
    install -Dm644 anki.png $pkgdir/usr/share/pixmaps/anki.png;
    install -Dm644 anki.desktop $pkgdir/usr/share/applications/anki.desktop;
    install -Dm644 anki.1 $pkgdir/usr/share/man/man1/anki.1
    rm anki{,.xpm,.png,.desktop,.1}
    
    install -d $pkgdir/usr/share/anki/
    cp -a * $pkgdir/usr/share/anki/
}
