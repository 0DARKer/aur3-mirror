# Maintainer: Skydrome <irc.freenode.net>

pkgname=libtorrent-pyro-git
_pkgname='libtorrent'
pkgver=20120614
pkgrel=1
pkgdesc="BitTorrent library written in C++ (git version)"
url="http://libtorrent.rakshasa.no"
license=("GPL")
arch=("i686" "x86_64")
depends=('libsigc++' 'openssl')
makedepends=('git' 'gcc>=4.7.0' 'cppunit')
options=("!libtool")
conflicts=("${_pkgname}")
provides=("${_pkgname}")
source=()
md5sums=()

_gitname="${_pkgname}"
_gitroot="git://github.com/rakshasa/${_pkgname}.git"
#_gitrev=''_gitname="${_pkgname}"
_gitoptions="--depth 1"

build() {
    cd $srcdir

    msg "Connecting to GIT server..."
    if [ -d "${_gitname}/.git" ]; then
        cd $_gitname && git pull origin
        msg "The local repository was updated."
    else
        git clone ${_gitoptions} ${_gitroot} ${_gitname}
        cd $_gitname #&& git checkout $_gitrev
        msg "The remote repository was cloned."
    fi

    export CXXFLAGS="${CXXFLAGS} -fno-strict-aliasing -std=c++11"
    [[ $(stat -Lfc %T /home) = @(ext4|xfs|btrfs) ]] && _fsfa='--with-posix-fallocate'
    ./autogen.sh &&
    ./configure --prefix=/usr --enable-debug $_fsfa
    make
}

package() {
    cd ${srcdir}/${_pkgname}
    make DESTDIR="${pkgdir}" install
}
