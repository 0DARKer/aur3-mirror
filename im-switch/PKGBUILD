# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=im-switch
pkgver=1.20ubuntu5
pkgrel=2
pkgdesc="Input method switch framework"
arch=('i686' 'x86_64')
url="http://packages.debian.org/sid/im-switch"
license=('GPL')
depends=()
makedepends=()
optdepends=('zenity: GUI for im-switch')
source=("http://archive.ubuntu.com/ubuntu/pool/main/i/${pkgname}/${pkgname}_${pkgver}.tar.gz")
sha512sums=('1a21dd5a680088e529b4390a7401030415c961e4706469f92bf17a8e7fe707e87721267300f7bf0579f3eee794b98f4f7719667f3216ed6ffb2bd15f5bbe26d6')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  #Disable dependency support as Ubuntu/Debian package names are different
  #  from Arch Linux package names and other packages need to be patched to
  #  change those dependencies. Also, dpkg doesn't work on Arch Linux.
  sed -i -e '/^dependency().*$/ a #dpkg is only for Ubuntu/Debian, not Arch Linux\nreturn' im-switch.in
  #Disable information message that tells the user to read a Debian only
  #  documentation file.
  sed -i -e 's/Please.*README.Debian.gz.*\$/$/g' im-switch.in
  sed -i -e 's/Please.*README.Debian.gz//g' im-switch.in
  #Remove some other Debian specific stuff
  sed -i -e 's/using\ Debian.*mechanism.//g' im-switch.in
  #Disable setting system IM, which requires dpkg's update-alternatives
  sed -i -e '/When.*root/d' im-switch.in
  sed -i -e '/#!/ a if [ $(id -u) == 0 ]; then echo "Running as root disabled. Setting the system IM only works under Debian/Ubuntu."; exit 1; fi' im-switch.in
  sed -i -e 's/User choice.*default.//g' im-switch.in

  sed -e "s/@@VERSION@@/${pkgver}/" <im-switch.in >im-switch
}

check() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  msg "Nothing to check."
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  install -dm755 "${pkgdir}/usr/bin/"
  install -dm755 "${pkgdir}/usr/share/applications/"
  install -dm755 "${pkgdir}/etc/X11/xinit/xinitrc.d/"
  install -dm755 "${pkgdir}/etc/X11/xinit/xinput.d/"
  install -m755 'im-switch' "${pkgdir}/usr/bin/"
  install -m644 'im-switch.desktop' "${pkgdir}/usr/share/applications/"
  install -m755 '80im-switch' "${pkgdir}/etc/X11/xinit/xinitrc.d/"
  for i in xinput.d/*; do
    install -m644 "${i}" "${pkgdir}/etc/X11/xinit/xinput.d/"
  done
}

# vim:set ts=2 sw=2 et:
