# Contributors:
#   henning mueller <henning@orgizm.net>

pkgname=legend-of-grimrock
pkgdesc='A 3D grid-based dungeon crawler inspired by classic 1980s and 1990s action role-playing games Dungeon Master, Eye of the Beholder and Ultima Underworld.'
url='http://www.grimrock.net/'
_pkgdate=2012-12-18
pkgver=20121218
pkgrel=5
arch=(i686 x86_64)
license=(custom)
depends=(
  freeimage minizip sdl2-hg libvorbis freetype2 zlib openal libgl libx11
  gcc-libs-multilib libogg libxext
)
source=(
  LegendOfGrimrock-Linux-$_pkgdate.sh::
  $pkgname.desktop
)
sha256sums=(
  422327f3727b8087a92176f95bef9cd957d295b83c7738813431c1195a7b6e16
  a989d2d0d896ec4adaf3d66e19050c519d9e58efc8d588a51ab0185283bf21fb
)

[ "$CARCH" = "i686" ] && _arch=x86 || _arch=x86_64

package() {
  sh $(echo ${source[0]} | sed -e s/:://g) --tar xf

  _target=$pkgdir/usr/share/$pkgname

  mkdir -p $_target
  lzma -d < instarchive_linux_$_arch | tar xf - -C $_target
  lzma -d < instarchive_all | tar xf - -C $_target

  mkdir -p $pkgdir/usr/bin
  ln -s ../share/$pkgname/Grimrock.bin.$_arch $pkgdir/usr/bin/$pkgname
}
