From b22e6a5d0c55e6117a6e84624d4528c530656d54 Mon Sep 17 00:00:00 2001
From: Raimar <no@email.de>
Date: Tue, 10 Jun 2014 21:15:07 +0200
Subject: [PATCH] Show power calculated by voltage and current in battery
 tooltip

---
 src/plugins/batt/batt_sys.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/plugins/batt/batt_sys.c b/src/plugins/batt/batt_sys.c
index 37cde51..0b9011e 100644
--- a/src/plugins/batt/batt_sys.c
+++ b/src/plugins/batt/batt_sys.c
@@ -184,8 +184,6 @@ battery* battery_update(battery *b)
      * available. */
     if (b->current_now < -1)
 	    b->current_now = - b->current_now;
-    if (b->power_now < -1)
-	    b->power_now = - b->power_now;
 
     b->charge_full = get_gint_from_infofile(b, "charge_full");
     b->energy_full = get_gint_from_infofile(b, "energy_full");
@@ -240,6 +238,10 @@ battery* battery_update(battery *b)
 	}
     }
 
+    if (b->power_now < -1)
+        b->power_now = - b->power_now;
+    else if (b->power_now == -1 && b->voltage_now != -1 && b->current_now != -1)
+        b->power_now = b->voltage_now * b->current_now / 1000; // P = U*I
     if (b->power_now != -1 && b->current_now == -1) {
 	if (b->voltage_now != -1 && b->voltage_now != 0)
 	    b->current_now = b->power_now * 1000 / b->voltage_now;
-- 
2.0.0

