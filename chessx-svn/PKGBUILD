# Maintainer: yescalona <yescalona[at]ug[dot]uchile[dot]cl>

pkgname=chessx-svn
_pkgname=chessx
pkgver=1067
pkgrel=1
pkgdesc="free chess database"
arch=('i686' 'x86_64')
url="http://chessx.sourceforge.net/"
license=('GPL2')
groups=()
depends=('qt')
makedepends=()
optdepends=()
provides=('chessx')
conflicts=('chessx')

_svntrunk="http://chessx.svn.sourceforge.net/svnroot/chessx/trunk"
_svnmod="trunk"


build() {
  msg "Starting SVN checkout..."
  cd ${srcdir}
    if [ -d $_svnmod/.svn ]; then
      (cd $_svnmod && svn up -r $pkgver)
    else
      svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi
  msg "SVN checkout done or server timeout"

  msg "Starting make..."
  if [ -d ${srcdir}/$_svnmod-build ]; then
    rm -rf $_svnmod-build
  fi

  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build

  msg "Compiling"
  qmake
  make


}

package() {
  cd $_svnmod-build

  # Install program
  install -d $pkgdir/usr/$_pkgname
  cp -R bin/ data/ i18n/  $pkgdir/usr/$_pkgname
  
  install -d $pkgdir/usr/bin
  ln -s /usr/chessx/bin/chessx ${pkgdir}/usr/bin/
  
  # Desktop icon
  cd ./data/images
  install -Dm644 chessx_48.tiff $pkgdir/usr/share/pixmaps/chessx_48.tiff
  install -Dm644 $startdir/chessx.desktop $pkgdir/usr/share/applications/chessx.desktop
}
