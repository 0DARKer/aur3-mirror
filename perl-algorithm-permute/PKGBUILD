pkgname=perl-algorithm-permute                               
_realname=Algorithm-Permute                                  
pkgver=0.12                                                  
pkgrel=1                                                     
pkgdesc="CPAN Algorithm::Permute module"                           
arch=(i686 x86_64)                                           
license=('GPL')
url="http://search.cpan.org/~edpratomo/Algorithm-Permute"                                        
options=(!emptydirs)                                                                             
md5sums=('93c9e11af9511390379720fe046fb960')

depends=('perl')

#provides=('Algorithm-Permute')
provides=('perl-algorithm-permute=0.12')

source=(http://search.cpan.org/CPAN/authors/id/E/ED/EDPRATOMO/Algorithm-Permute-0.12.tar.gz)


build() {
  # This is ugly but it works most of the time.
  _expected_dir="${srcdir}/${_realname}-${pkgver}"
  if [ -d "$_expected_dir" ]; then                
    cd "$_expected_dir"                           
  else                                            
    _expected_dir="${srcdir}/$(bsdtar -t -f $(basename $source) | head -n1)"
    if [ -d "$_expected_dir" ]; then                                        
      cd "$_expected_dir"                                                   
    else                                                                    
      _makefile=$(find $srcdir -iname Makefile.PL)                          
      if [ ! -z "$_makefile" ]; then                                        
        _expected_dir=$(dirname $_makefile)                                 
        if [ -d "$_expected_dir" ]; then                                    
          cd "$_expected_dir"                                               
        else                                                                
          echo "ERROR unable to detect source directory"                    
          echo "--> this is often due to CPAN's lack of standard naming conventions"
          echo "--> it may be possible to fix this by adjusting the build function in the PKGBUILD"
        fi                                                                                         
      else                                                                                         
        _buildfile=$(find $srcdir -iname Build.PL)                                                 
        if [ ! -z "$_buildfile" ]; then                                                            
          _expected_dir=$(dirname $_buildfile)                                                     
          if [ -d "$_expected_dir" ]; then                                                         
            cd "$_expected_dir"                                                                    
          else                                                                                     
            echo "ERROR unable to detect source directory"                                         
            echo "--> this is often due to CPAN's lack of standard naming conventions"             
            echo "--> it may be possible to fix this by adjusting the build function in the PKGBUILD"
          fi                                                                                         
        fi                                                                                           
      fi                                                                                             
    fi                                                                                               
  fi                                                                                                 
  # install module in vendor directories.                                                            
  if [ -f Build.PL ] ; then                                                                          
    PERL_MM_USE_DEFAULT=1 perl Build.PL INSTALLDIRS=vendor || return 1
    ./Build  || return 1
    ./Build install destdir=${pkgdir} || return 1
  else
    PERL_MM_USE_DEFAULT=1 perl Makefile.PL INSTALLDIRS=vendor || return 1
    make  || return 1
    make install DESTDIR=${pkgdir} || return 1
  fi

  # remove perllocal.pod and .packlist
  find ${pkgdir} -name perllocal.pod -delete
  find ${pkgdir} -name .packlist -delete
}

# vim:set ts=2 sw=2 et:
