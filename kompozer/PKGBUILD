# Contributor: peace4all <markspost at rocketmail dot com>

pkgname=kompozer
pkgver=0.8b3
pkgrel=9
pkgdesc="A Dreamweaver style WYSIWYG web editor; Nvu unofficial bug-fix release"
arch=('x86_64' 'i686')
license=('GPL')
url="http://www.kompozer.net"
depends=('gtk2' 'glib2' 'pango' 'nss' 'libxt' 'libidl2' 'gnome-vfs')
makedepends=('zip' 'pkgconfig')
source=("http://downloads.sourceforge.net/kompozer/$pkgname-$pkgver-src.tar.bz2"
        "kompozer.desktop"
	"mozconfig.patch"
        "kompozer-libpng15.patch"
        "kompozer-libpng14.patch"
        "gcc46_default_ctors.patch"
	"gcc-47_.patch"
        "any_kernel_26_plus.patch")
md5sums=('cd4664ecda908666b19ef0607010c627'
         'ed8edf6817892a38b8b181fc9b2caaea'
	 '4778f967307cf569089daca843de1df9'
         '4852034f99e7943071946e7eedc6c2f5'
         'd5ba90f7fbaed76f77a6d9717e86f3a5'
         'ad3ec5cbc6677dd712b140148398f58f'
	 '3ba3685378e7fee1219483b1d004cd18'
         '58a294356b3e17ad070e4c93180bf0ad')

build() {
  cd "$srcdir/mozilla"
  
# Major patchfest due to old code
	
	patch -Np0 -i $srcdir/mozconfig.patch || return 1
	patch -Np0 -i $srcdir/kompozer-libpng14.patch || return 1
	patch -Np0 -i $srcdir/kompozer-libpng15.patch || return 1
	patch -Np0 -i $srcdir/gcc46_default_ctors.patch || return 1
	patch -Np0 -i $srcdir/gcc-47_.patch || return 1
	patch -Np0 -i $srcdir/any_kernel_26_plus.patch || return 1


  make -f client.mk build
}

package() {
  cd "$srcdir/obj-kompozer"

  make DESTDIR=$pkgdir install
  install -m755 -dD $pkgdir/usr/share/applications
  install -m644  $srcdir/kompozer.desktop $pkgdir/usr/share/applications/

# Fix icon when used with custom themes
	mkdir -p $pkgdir/usr/share/pixmaps/
	ln -s /usr/lib/kompozer/icons/mozicon50.xpm $pkgdir/usr/share/pixmaps/kompozer.png
}
