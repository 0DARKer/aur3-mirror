# Maintainer: Pietro Brenna <pietrobrenna@zoho.com>
pkgname=onedrive-d-git
pkgver=20140704.gf08492e
pkgdesc="Client daemon for Microsoft OneDrive service"
source=('git://github.com/xybu92/onedrive-d.git' 'onedrive-d.desktop')
md5sums=(SKIP '8077d9697c922e003b8addbf243b33a4')
arch=('i686' 'x86_64')
license=('LGPL')
url="https://github.com/xybu92/onedrive-d"
pkgrel=1
provides = 'onedrive-d'
depends=('pywebkitgtk' 'python2-dateutil' 'inotify-tools' 'rcs'\
 'python2-onedrive-git' 'python2-notify2' 'python2-urllib3')
makedepends=('git')

pkgver() {
  cd $srcdir/onedrive-d
  git log -1 --format="%cd.g%h" --date=short | sed 's/-//g'
}
build() {
  cd $srcdir/onedrive-d
  python2 setup.py build
}

package() {
  cd $srcdir/onedrive-d
  #onedrive-d has an install script which does not support arch linux
  #it contains APP_CLIENT_ID and APP_CLIENT_SECRET which I guess are 
  #needed for the program to work
  eval `cat inst | grep APP_CLIENT_ID`
  eval `cat inst | grep APP_CLIENT_SECRET`
  python2 setup.py install --root="$pkgdir/" --optimize=1
  install -D build/lib/onedrive_d/res/icon_256.png \
    $pkgdir/usr/share/pixmaps/onedrive-d.png
  install -D ../onedrive-d.desktop \
    $pkgdir/usr/share/applications/onedrive-d.desktop
  rm -r build 
  #cp "./onedrive-d" "/etc/init.d/onedrive-d"
  #chmod u+x "/etc/init.d/onedrive-d"
}
