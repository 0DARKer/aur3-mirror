# Maintainer: heaven <vo.zaeb at gmail.com>
# Contributor: Patrick Schwalm <patrick.schwalm@googlemail.com>

pkgname='libgcal-git'
pkgver=20110329
pkgrel=1
pkgdesc='ANSI C library that does allow communication with google calendar and contacts - Git Version'
url='http://code.google.com/p/libgcal/'
arch=('i686' 'x86_64')
license=('GPL')

depends=('libxml2' 'curl')
makedepends=('git' 'cmake')

conflicts=('libgcal')
provides=('libgcal')

source=()
md5sums=()

_gitroot='git://gitorious.org/libgcal/libgcal.git'
_gitname='libgcal'
_buildir=${_gitname}-build

build() {
	cd ${srcdir}

	msg 'Connecting to GIT server...'

	if [ -d ${_gitname} ]; then
		cd ${_gitname} && git pull origin
		cd ..
	else
		git clone ${_gitroot}
	fi

	msg 'GIT checkout done or server timeout.'

	if [ -d ${_buildir} ]; then
		msg 'Cleaning previous build...'
		rm -rf ${_buildir}
	fi

	git clone ${_gitname} ${_buildir}
	cd ${_buildir}

	msg 'Starting make...'

	cmake -DCMAKE_INSTALL_PREFIX=/usr -DENABLE_TESTS=Off -DCMAKE_BUILD_TYPE=Release || return 1
	make DESTDIR=${pkgdir} install || return 1

	rm -rf ${srcdir}/${_buildir}
}
