# Maintainer: Jason St. John <jstjohn .. purdue . edu>
# Contributor: Georg Grabler (STiAT) <ggrabler@gmail.com>

_perlmod=DBD-Oracle
pkgname=perl-dbd-oracle
pkgver=1.52
pkgrel=1
pkgdesc="DBD::Oracle - Oracle database driver for the DBI module"
arch=('any')
url="http://search.cpan.org/dist/$_perlmod"
license=('GPL' 'PerlArtistic')
depends=('oracle-instantclient-basic>=9.2' 'perl>=5.10.0' 'perl-dbi')
makedepends=('oracle-instantclient-sdk>=9.2' 'perl-extutils-makemaker')
options=('!emptydirs')
source=("http://cpan.perl.org/modules/by-module/DBD/$_perlmod-$pkgver.tar.gz")
sha512sums=('5488fa5f5bd79acb73242a4f69c6b2de71568c9ff035f4d60226a6aa5674461cdd2c18553611b200d9c621bba533c9c963e6d40f24dc2be97e54a5f1d0ea82fd')

build() {
	cd "$srcdir/$_perlmod-$pkgver"

	#
	# How much of this stuff is still necessary?
	#
	if [[ -z $ORACLE_HOME ]]; then
		if [[ $(pacman -Qq oracle &>/dev/null) ]]; then
			export ORACLE_HOME="$(ls -dr /home/oracle/app/oracle/product/*)/orarch"
			export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$ORACLE_HOME/lib"
			_version=$(pacman -Qq oracle 2>/dev/null)
		elif [[ -d /opt/instantclient ]]; then
			export ORACLE_HOME=/opt/instantclient
			_version=$(pacman -Q oracle-instantclient-basic{,lite} 2>/dev/null || true)
		else
			error "No Oracle / Instant Client installation found."
		fi
	fi
	# AUR workaround
	(( 1 )) && _version=${_version##* }
	# You may need to put your version of Oracle's Instant Client below.
	[[ -z $_version ]] && _version=11.2.0.3.0

	PERL_MM_USE_DEFAULT=1 perl Makefile.PL -V $_version INSTALLDIRS=vendor -l
	make
}

check() {
	cd "$srcdir/$_perlmod-$pkgver"
	make test
}

package() {
	cd "$srcdir/$_perlmod-$pkgver"
	make install DESTDIR="$pkgdir/"
}

# vim:set ts=4 sw=4:
