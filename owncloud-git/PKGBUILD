# Contributor: Alexander Ovsyannikov <ovsinc at ya.ru>
pkgname=owncloud-git
pkgver=20110121
pkgrel=1
pkgdesc="ownCloud is part of the Social Desktop, a project connecting you with your peers in the community"
arch=('i686' 'x86_64')
url="http://owncloud.org/index.php/Main_Page"
license=('GPL')
depends=('php-apache' 'php-sqlite')
install=owncloud.install
makedepends=()
optdepends=()
provides=()
source=(owncloud.conf)
md5sums=('b4c560bea4c9ebb10028f168b1b91900')
_gitroot="git://anongit.kde.org/owncloud"
_gitname="owncloud"

build() {
msg "Git checkout"
  if [ -d ${srcdir}/${_gitname} ]
  then
  msg "Updating local repository..."
  cd ${_gitname} 
  git pull origin master || return 1
  msg "The local files are updated."
  else
  git clone ${_gitroot}
  fi
msg "Git checkout done or server timeout"

msg "Building and installing..." 
 
# install README file 
  install -o root -g root -d ${pkgdir}/usr/share/doc/owncloud1.0
  mv ${srcdir}/${_gitname}/README  ${pkgdir}/usr/share/doc/owncloud1.0/

  # clean .git directory
  rm -rf ${srcdir}/${_gitname}/.git
 
# install project  
  install -d -o http -g http  ${pkgdir}/opt/html || return 1
  cp -a ${srcdir}/${_gitname}  ${pkgdir}/opt/html/ || return 1
  chown -R http:http ${pkgdir}/opt/html/* || return 1 
 
# install apache .conf file 
  install -d -o root -g root  ${pkgdir}/etc/httpd/conf/extra || return 1
  install -o root -g root -m 644 ${srcdir}/owncloud.conf  ${pkgdir}/etc/httpd/conf/extra/ || return 1

}
# vim:syntax=sh

