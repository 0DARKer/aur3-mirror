# Contributor: Alexander Ovsyannikov <ovsinc at ya.ru>
pkgname=owncloud-git
pkgver=20110504
pkgrel=2
pkgdesc="ownCloud is part of the Social Desktop, a project connecting you with your peers in the community"
arch=('i686' 'x86_64')
url="http://owncloud.org/index.php/Main_Page"
license=('GPL')
depends=('php-apache' 'php-sqlite')
install=owncloud.install
makedepends=()
optdepends=('php-pgsql: for use PostgreSQL as main database'
	    'php: you can use MySQL as main database')
provides=()
source=(owncloud.conf)
_gitroot="git://anongit.kde.org/owncloud"
_gitname="owncloud"

build() {
msg "Git checkout"
  if [ -d ${srcdir}/${_gitname} ]
  then
  msg "Updating local repository..."
  cd ${_gitname} 
  git pull origin master || return 1
  msg "The local files are updated."
  else
  git clone ${_gitroot}
  fi
msg "Git checkout done or server timeout"

msg "Building and installing..." 
 
# install README file 
  install -d ${pkgdir}/usr/share/doc/owncloud1.0
  mv ${srcdir}/${_gitname}/README  ${pkgdir}/usr/share/doc/owncloud1.0/

  # clean .git directory
  rm -rf ${srcdir}/${_gitname}/.git
 
# install project  
  install -d  ${pkgdir}/usr/share/webapps/ || return 1
  cp -a ${srcdir}/${_gitname}  ${pkgdir}/usr/share/webapps/ || return 1
  # 33 - is GID 'http' group and UID 'http' user 
  chown -R 33:33 ${pkgdir}/usr/share/webapps/owncloud || return 1 
 
# install apache .conf file 
  install -d ${pkgdir}/etc/httpd/conf/extra || return 1
  install -m 644 ${srcdir}/owncloud.conf  ${pkgdir}/etc/httpd/conf/extra/ || return 1

}
md5sums=('c0112de94a7d9bdb7b5d1705a344db81')
