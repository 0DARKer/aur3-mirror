# Maintainer: nem <nem at posteo dot net> 
# Submitter: ClemensFMN
pkgname=qucs-git
pkgver=20140607
pkgrel=1
pkgdesc="An integrated circuit simulator with a graphical user interface. (qt4 git version)"
arch=('x86_64' 'i686')
url="http://github.com/qucs/qucs"
license=('GPL')
depends=('qt4' 'adms-git')
makedepends=('git' 'autoconf' 'automake' 'perl-gd' 'perl-xml-libxml' 'gperf' 'libtool' 'flex' 'bison')
source=('bootstrap-adms-dep.patch')
md5sums=('47c9d6c2db1b146fa7101000fbc5274f')
optdepends=('freehdl: to permit digital circuit simulation'
	    'asco: to enable circuit optimization'
	    'perl')

_gitroot=https://github.com/qucs/qucs.git
_gitname=qucs

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"

  cd "$srcdir/$_gitname-build/$_gitname"
  sh autogen.sh
  ./configure --enable-maintainer-mode --prefix=/usr
  make

  cd "$srcdir/$_gitname-build/$_gitname-core"
  patch -p0<"$srcdir/bootstrap-adms-dep.patch"
  sh bootstrap.sh
  ./configure --enable-maintainer-mode --with-mkadms=/usr/bin/admsXml --prefix=/usr
  make -j1
}

package() {
  cd "$srcdir/$_gitname-build/$_gitname"
  make DESTDIR="$pkgdir" install

  cd "$srcdir/$_gitname-build/$_gitname-core"
  make DESTDIR="$pkgdir" install
}
