# Maintainer: Alessandro Pazzaglia <jackdroido at gmail dot com>

pkgname=pyinstaller
pkgver=1.5.1
pkgrel=1
pkgdesc="An application to convert python scripts into stand-alone binaries"
arch=('i686' 'x86_64')
url="http://www.pyinstaller.org"
license=('GPL2')
depends=('python2')
source=(
    "https://github.com/downloads/pyinstaller/pyinstaller/${pkgname}-${pkgver}.tar.bz2"
    "pyinstaller.sh"
)
md5sums=(
    '4bba9819321d42003f471fdfa32a5be1'
    '5d4cc2f1032908ceb4c7003977a88db7'
)
options=('!strip' '!emptydirs')

build() {
    cd "${srcdir}/${pkgname}-${pkgver}"

    msg "Removing unneeded stuff ..."

    rm -rf ".hgignore" "buildtests" "e2etests" "source" "examples" "doc/images" "doc/source" "doc/stylesheets" "doc/Manual.html" "doc/LICENSE.GPL"

    msg "Fixing python interpreter ..."

    grep -RIl '^#!.*python' . | xargs sed -i '/^#!/ s,.*,#! /usr/bin/env python2,'

    msg "Copying files ..."

    install -d -m 755 "${pkgdir}/usr/bin"
    install -d -m 755 "${pkgdir}/usr/share/doc/pyinstaller"
    install -d -m 755 "${pkgdir}/opt/pyinstaller"

    cp -ra doc/* "README.txt" "${pkgdir}/usr/share/doc/pyinstaller"
    cp -ra . "${pkgdir}/opt/pyinstaller"
    cp "${srcdir}/pyinstaller.sh" "${pkgdir}/usr/bin/pyinstaller"

    msg "Creating symlinks ..."

    #~ ln -s "/opt/pyinstaller/pyinstaller.py" "${pkgdir}/usr/bin/pyinstaller"
    ln -s "/tmp/useTK.py" "${pkgdir}/opt/pyinstaller/support/useTK.py"
    ln -s "/tmp/useUnicode.py" "${pkgdir}/opt/pyinstaller/support/useUnicode.py"
    ln -s "/tmp/config.dat" "${pkgdir}/opt/pyinstaller/config.dat"
}
