pkgname=compcache
pkgver=212
pkgrel=1
pkgdesc="Compressed virtual swap disc for Linux"
url="http://code.google.com/p/compcache/"
install=(${pkgname}.install)
license="GPL2"
arch=('i686' 'x86_64')
options=(zipman)
backup=(etc/conf.d/compcache)
makedepends=('kernel26-headers' 'mercurial')

source=(compcache.conf compcache.init)
md5sums=('0c19420ec23bd3402f3a6ccb4ed6f614'
         '39a9ad057d33670b60160fdce68e6526')

_hgroot=https://compcache.googlecode.com/hg/
_hgrepo=compcache

build() {
  TARGETDIR=$startdir/pkg/usr/share/compcache

  cd "${srcdir}/${_hgrepo}"
  hg update default

  make || return 1

  install -Dm 644 $srcdir/${_hgrepo}/zram.ko $pkgdir/lib/modules/`uname -r`/compcache/zram.ko || return 1
  install -Dm 644 $srcdir/${_hgrepo}/README $TARGETDIR/README || return 1
  install -D $startdir/compcache.conf $pkgdir/etc/conf.d/compcache || return 1 
  install -Dm 744 $startdir/compcache.init $pkgdir/etc/rc.d/compcache || return 1
}
