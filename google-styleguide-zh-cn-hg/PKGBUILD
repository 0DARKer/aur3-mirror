# Maintainer : Tianjiao Yin <ytj000@gmail.com>

_pkg=google-styleguide-zh-cn
pkgname=$_pkg-hg
pkgver=22
pkgrel=1
pkgdesc="Style guides for Google-originated open-source projects, Chinese (language) version."
arch=('any')
url="http://code.google.com/p/zh-google-styleguide/"
license=('GPL')
makedepends=('mercurial' 'python2-sphinx')
provides=("$_pkg")
conflicts=("$_pkg")

__hgroot="http://code.google.com/p/zh-google-styleguide/"
__hgrepo="$_pkg"

build() {
    cd "$srcdir"
    rm * -rf
    hg clone --insecure $__hgroot $__hgrepo
    cd $__hgrepo

    msg "Mercurial checkout done or server timeout"
    msg "Starting make..."

    python2 << EOF
import os, os.path, shutil
for i in os.listdir('.'):
    os.system('make html -C ' + i)
    htmldir = os.path.join(i, '_build', 'html')
    if os.path.isdir(htmldir):
	shutil.move(htmldir, i[:-5])
    shutil.rmtree(i)
EOF
}

package() {
    _insdir="${pkgdir}/usr/share/doc/google-styleguide/zh"
    mkdir -p $_insdir
    mv ${srcdir}/$__hgrepo/* $_insdir
}
