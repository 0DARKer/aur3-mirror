# Contributor: twa022 <twa022 at gmail dot com>

pkgname=dockbarx-bzr
_pkgname=dockbarx
pkgver=352
pkgrel=2
pkgdesc="GNOME TaskBar with groupping and group manipulation."
arch=('i686' 'x86_64')
url="https://code.launchpad.net/~dockbar-main/dockbar/experimental"
license=('GPL3')
depends=('python-gnomeapplet' 'python-wnck' 'gnome-panel-bonobo'
         'python2' 'pyxdg' 'dbus-python' 'python2-numpy' 
         'python2-bonobo' 'python2-gnomecanvas' 'python2-gconf'
         'python-imaging' 'python-keybinder' 'hicolor-icon-theme')
optdepends=('dockbarx-bzr-awn-plugin: AWN Dockbar Plugin'
            'zeitgeist: Recently used file list'
            'compiz-fusion-plugins-main: opacify plugin'
            'compiz-plugins-main-09: opacify plugin from rewritten compiz'
            'dockmanager-bzr: Dockmanager helpers')
makedepends=('bzr')
conflicts=('dockbarx')
provides=('dockbarx')
source=()
	
_bzrmod=$_pkgname
_bzrtrunk=https://code.launchpad.net/~dockbar-main/dockbar/experimental

build() {
  cd $startdir/src
  msg "Connecting to the server...."

  if [ -d ./$_bzrmod ]; then
    cd ./$_bzrmod && bzr up && cd ..
  else
    bzr co $_bzrtrunk $_bzrmod
  fi

  [ -d ./$_bzrmod-build ] && rm -fr ./$_bzrmod-build
  cp -r ./$_bzrmod ./$_bzrmod-build
  cd ./$_bzrmod-build

  cd ${srcdir}/${_pkgname}-build
  python2 setup.py install --root ${pkgdir}
  
  mkdir -p ${pkgdir}/usr/share/pixmaps
  install -Dm644 ${srcdir}/${_pkgname}-build/icons/hicolor/128x128/apps/dockbarx.png ${pkgdir}/usr/share/pixmaps/dockbarx.png

  sed -i 's:^Categories=.*:Categories=GTK;GNOME;Settings;X-GNOME-PersonalSettings;:' ${pkgdir}/usr/share/applications/dbx_preference.desktop
  sed -i 's:/usr/bin/python:&2:' ${pkgdir}/usr/bin/dockbarx_factory.py
  sed -i 's:/usr/bin/python:&2:' ${pkgdir}/usr/bin/dbx_preference.py
}

