# Maintainer: Aaron DeVore
# Contributor: Erol V. Aktay <e.aktay@gmail.com>
pkgname='mwlib'
pkgver='0.12.14'
pkgrel='1'
pkgdesc="Converts MediaWiki articles to pdf, odf, and docbook"
arch=('i686' 'x86_64')
url="http://code.pediapress.com/wiki/wiki"
license="BSD"
depends=('python2' 'perl' 'pil' 'python2-odfpy>=0.9' 'python-flup>=1.0'
         'python2-pyparsing>=1.4.11' 'twisted>=8.2' 'python-dateutil>=1.4.1' 'python-pypdf>=1.12' 'python2-webob>=0.9'
         'python-timelib>=0.2' 'python-lockfile>=0.8')
optdepends=('texvc'
 'imagemagick'
 'blahtex'
 'python-lxml'
 'qserve: WSGI server interface to mw-render and mw-zip/mw-post')
makedepends=('re2c' 'setuptools')
source=("http://pypi.python.org/packages/source/m/$pkgname/$pkgname-$pkgver.tar.gz")
md5sums=('e1967178f9c3e6668129fdfd7528ebe2')

build() {
  cd $srcdir/$pkgname-$pkgver
  patch setup.py < $startdir/setup.diff
  python2 setup.py build
}

package() {
  cd $srcdir/$pkgname-$pkgver
  python2 setup.py install --root=$pkgdir --optimize=1
  install -D -m644 README.txt \
                   "$pkgdir/usr/share/licenses/$pkgname/README.txt"
  # docs
  mkdir -p "$pkgdir/usr/share/docs/"
  cp -a "docs" "$pkgdir/usr/share/docs/$pkgname"
  chmod -R 644 "$pkgdir/usr/share/docs/$pkgname"
}

check() {
  cd $srcdir/$pkgname-$pkgver
  python2 setup.py test
}