# Maintainer: Valentin V. Bartenev <i@vbart.ru> http://vbart.info/

pkgname=ctpp2
pkgver=2.6.9
pkgrel=1
pkgdesc='CTPP (or CT++) is the fastest template engine which completely written in C++'
arch=('i686' 'x86_64')
url='http://ctpp.havoc.ru/en/'
optdepends=(
  'gettext: gettext support'
  'iconv: iconv support'
  'md5: md5 support'
)
makedepends=('cmake' 'make' 'patch')
source=(http://ctpp.havoc.ru/download/ctpp2-$pkgver.tar.gz 'ctpp2-tests.patch')
license=('custom:BSD-like')
md5sums=('49350c7f191c2b6dc5942ff39d72d020' '7ab863f5801f15b0ee1d4067b45d6706')

build() {
  cd $srcdir/$pkgname-$pkgver
  patch -Np1 -i ../ctpp2-tests.patch
  mkdir build
  cd build
  cmake -Wno-dev -DSKIP_RELINK_RPATH:BOOL=ON .. || return 1
  make VERBOSE=1 || return 1
  env LD_LIBRARY_PATH=.:$LD_LIBRARY_PATH make test || return 1
  make DESTDIR=$pkgdir install || return 1
  install -Dm 644 ../LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
} 

# Enjoy! ;)