# Contributor: aleksonik <imsnet@yandex.ru>
# Contributor: andre.vmatos <amdre.vmatos@gmail.com>
# Contributor: Valeriy Lyasotskiy <onestep@ukr.net>

_gitname=qtserialport
_gitroot='git://gitorious.org/qtplayground/qtserialport.git'

pkgname=qtserialport-git
pkgver=20121019
pkgrel=1
pkgdesc="Add-on for the Qt library, providing a single interface for both hardware and virtual serial ports"
arch=('i686' 'x86_64')
url="http://qt-project.org/wiki/QtSerialPort"
license=('LGPL')
depends=('qt')
makedepends=('git')
provides=('qtserialport')

build() {
  cd "$srcdir"

  msg "Connecting to GIT server...."

  if [[ -d "${_gitname}" ]]; then
    cd "${_gitname}" && git pull origin
    msg "The local files are updated."
  else
    git clone --depth=1 "${_gitroot}" "${_gitname}" && cd "${_gitname}"
    msg "GIT checkout done or server timeout"
  fi

  sed -i 's/ examples tests//' serialport.pro

  mkdir "$srcdir"/qtserialport-build && cd "$srcdir"/qtserialport-build
  qmake ../qtserialport/serialport.pro
  make
}

package() {
  cd "$srcdir"/qtserialport-build
  make INSTALL_ROOT="$pkgdir" install

  sed -i '1,1d' "$pkgdir"/usr/lib/libSerialPort.prl
}