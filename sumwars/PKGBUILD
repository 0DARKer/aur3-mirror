# Contributor: Kevin Whitaker <eyecreate at gmail dot com>
# Contributor: Adria Arrufat <swiftscythe at gmail dot com>

pkgname=sumwars
pkgver=0.5.4
pkgrel=1
pkgdesc="Summoning Wars is an open source role-playing game, featuring both a single-player and a multiplayer mode for about 2 to 8 players."
arch=('i686' 'x86_64')
url="http://sumwars.org/"
license=('GPL')
makedepends=('autoconf')
depends=('ogre' 'cegui-ogre' 'raknet2' 'freealut' 'enet' 'openal' 'libvorbis')
source=(sumwars.sh sumwars.desktop http://sourceforge.net/projects/sumwars/files/0.5.4/sumwars_0-5-4_src.tgz/download) 
md5sums=('dfa97acfeecd00240a7c34fbf6454b58'
         '6d63a38f2120fc154700317914514278'
         '98fe18a749614b5a640f2b36fa819f47')

build() {
  cd ${srcdir}/sumwars_0-5-4_src
#   rm CMakeCache.txt
  cmake -DCMAKE_INSTALL_PREFIX=/usr
  make ||return 1
#   make install is broken
#   make DESTDIR=$pkgdir install ||return 1
  mkdir -p $pkgdir/opt/sumwars/save
  chmod 777 $pkgdir/opt/sumwars/save
  mkdir -p $pkgdir/usr/{bin,share/{applications,pixmaps}}
  install -m755 sumwars $pkgdir/opt/sumwars/sumwars||return 1
  install -m644 plugins.cfg $pkgdir/opt/sumwars/plugins.cfg ||return 1
  install -m644 ogre.cfg $pkgdir/opt/sumwars/ogre.cfg||return 1
  install -m644 resources.cfg $pkgdir/opt/sumwars/resources.cfg||return 1
  install -m644 authors.txt $pkgdir/opt/sumwars/authors.txt||return 1
  install -m644 resources/itempictures/shield.png $pkgdir/usr/share/pixmaps/sumwars.png||return 1
  install -m644 $srcdir/../sumwars.desktop $pkgdir/usr/share/applications/sumwars.desktop||return 1
  install -m755 $srcdir/../sumwars.sh $pkgdir/usr/bin/sumwars||return 1
  cp -r data $pkgdir/opt/sumwars/
  cp -r resources $pkgdir/opt/sumwars
  touch $pkgdir/opt/sumwars/CEGUI.log
  touch $pkgdir/opt/sumwars/Ogre.log
  touch $pkgdir/opt/sumwars/sumwars.log
  chmod 777 $pkgdir/opt/sumwars/*.log
}
