# Maintainer : Alucryd <alucryd at gmail dot com>

pkgbase=bsnes-aio
pkgname=bsnes-aio
true && pkgname=('bsnes-common' 'bsnes-gtk' 'bsnes-qt' 'purify-gtk' 'purify-qt')
arch=('i686' 'x86_64')
makedepends=('mesa' 'gtk2' 'qt>=4.7.0' 'libpulse' 'libao' 'libgl' 'libxv' 'openal' 'sdl')
url="http://byuu.org/bsnes/"
license=('GPL3')
source=("http://bsnes.googlecode.com/files/bsnes_v091-source.tar.xz" "bsnes.desktop" "bsnes-gtk.sh" "bsnes-qt.sh" "purify.desktop" "purify-gtk.sh" "purify-qt.sh")
sha256sums=('8c85a18ff44195d23b54cad53549152f034ee338e590907e8c8cbc3eaa7daf9f'
            'f02ac8afd9482eced1e0a81b9c0963a7696b8089ba137f8ee68e1635300bcf38'
            '247c55ef2b245d0166ec4a40c649a39047864d97043c2ce4826bd41c5354c5a6'
            'c1d0cbf953dd8afc8f6a7be9527ce83cc1a16fa4ee3534004374d7891108b249'
            '2709c20ff58b14e53b664df0ea39fa2b5349918c14ffbbc79fc636b9adb369d9'
            '4809d182585012739469c25f8545e00100270b51e2e67b8faccadc75cd20befd'
            'b3f76fe882de0d30965c45e47ab1d905f8a31b969a6d88e85415fcd78be6efd0')

build() {
  cd "${srcdir}/bsnes_v$pkgver-source/bsnes"

# QT 4.8.0 fix
  moc -i -Iphoenix/qt/ -o phoenix/qt/platform.moc phoenix/qt/platform.moc.hpp

# Compile bsnes GTK GUI
  make compiler=gcc platform=x phoenix=gtk profile=accuracy target=ethos
  mv out/bsnes out/bsnes-gtk-accuracy
  make clean

  make compiler=gcc platform=x phoenix=gtk profile=compatibility target=ethos
  mv out/bsnes out/bsnes-gtk-compatibility
  make clean

  make compiler=gcc platform=x phoenix=gtk profile=performance target=ethos
  mv out/bsnes out/bsnes-gtk-performance
  make clean

# Compile bsnes QT GUI
  make compiler=gcc platform=x phoenix=qt profile=accuracy target=ethos
  mv out/bsnes out/bsnes-qt-accuracy
  make clean

  make compiler=gcc platform=x phoenix=qt profile=compatibility target=ethos
  mv out/bsnes out/bsnes-qt-compatibility
  make clean

  make compiler=gcc platform=x phoenix=qt profile=performance target=ethos
  mv out/bsnes out/bsnes-qt-performance
  make clean

# Compile laevateinn GTK GUI
#  make compiler=gcc platform=x phoenix=gtk profile=accuracy target=laevateinn
#  mv out/laevateinn out/laevateinn-gtk
#  make clean

# Compile laevateinn QT GUI
#  make compiler=gcc platform=x phoenix=qt profile=accuracy target=laevateinn
#  mv out/laevateinn out/laevateinn-qt
#  make clean

  cd "${srcdir}/bsnes_v$pkgver-source/purify"

# QT 4.8.0 fix
  moc -i -Iphoenix/qt/ -o phoenix/qt/platform.moc phoenix/qt/platform.moc.hpp

# Linker fix
  sed -i 's|gtk+-2.0|gtk+-2.0 x11|g' phoenix/Makefile
  sed -i 's|QtCore QtGui|QtCore QtGui x11|g' phoenix/Makefile

# Compile purify GTK GUI
  make compiler=gcc platform=x phoenix=gtk
  mv purify purify-gtk
  make clean

# Compile purify QT GUI
  make compiler=gcc platform=x phoenix=qt
  mv purify purify-qt
  make clean
}

package_bsnes-common() {
  pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code - Common files"
  arch=('any')
  
  cd "${srcdir}/bsnes_v$pkgver-source/bsnes"
  mkdir -p "${pkgdir}/usr/share/bsnes"
  cp -R profile/* "${pkgdir}/usr/share/bsnes/"
  cp data/cheats.xml "${pkgdir}/usr/share/bsnes/"

  mkdir "${pkgdir}/usr/share/pixmaps"
  cp data/bsnes.png "${pkgdir}/usr/share/pixmaps/"

  cd "${srcdir}/bsnes_v$pkgver-source/shaders"
  mkdir "${pkgdir}/usr/share/bsnes/Video Shaders"
  cp *.shader "${pkgdir}/usr/share/bsnes/Video Shaders/"
  
  find "${pkgdir}" -type d -print0 | xargs -0 chmod 755
  find "${pkgdir}" -type f -print0 | xargs -0 chmod 644
}

package_bsnes-gtk() {
  pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code - GTK GUI"
  depends=('bsnes-common' 'gtk2' 'libpulse' 'libao' 'libgl' 'libxv' 'openal' 'sdl')
  makedepends=('mesa')
  provides=('bsnes')
  
  cd "${srcdir}"
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/share/applications"
  cp bsnes-gtk.sh "${pkgdir}/usr/bin"
  for i in accuracy compatibility performance
  do
    cp bsnes.desktop "${pkgdir}/usr/share/applications/bsnes-gtk-$i.desktop"
    sed -i 's|_ui|gtk|g' "${pkgdir}/usr/share/applications/bsnes-gtk-$i.desktop"
    sed -i "s|_profile|$i|g" "${pkgdir}/usr/share/applications/bsnes-gtk-$i.desktop"
  done
  
  cd "bsnes_v$pkgver-source/bsnes"
  cp out/bsnes-gtk-* "${pkgdir}/usr/bin/"

  find "${pkgdir}" -type d | xargs chmod 755
  find "${pkgdir}" -type f | xargs chmod 644
  chmod -R 755 "${pkgdir}/usr/bin"
}

package_bsnes-qt() {
  pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code - QT GUI"
  depends=('bsnes-common' 'qt>=4.7.0' 'libpulse' 'libao' 'libgl' 'libxv' 'openal' 'sdl')
  makedepends=('mesa')
  provides=('bsnes')
  
  cd "${srcdir}"
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/share/applications"
  cp bsnes-qt.sh "${pkgdir}/usr/bin"
  for i in accuracy compatibility performance
  do
    cp bsnes.desktop "${pkgdir}/usr/share/applications/bsnes-qt-$i.desktop"
    sed -i 's|_ui|qt|g' "${pkgdir}/usr/share/applications/bsnes-qt-$i.desktop"
    sed -i "s|_profile|$i|g" "${pkgdir}/usr/share/applications/bsnes-qt-$i.desktop"
  done
  
  cd "bsnes_v$pkgver-source/bsnes"
  cp out/bsnes-qt-* "${pkgdir}/usr/bin/"

  find "${pkgdir}" -type d | xargs chmod 755
  find "${pkgdir}" -type f | xargs chmod 644
  chmod -R 755 "${pkgdir}/usr/bin"
}

#package_laevateinn-gtk() {
#  pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code - Debugger GTK GUI"
#  depends=('bsnes-common' 'gtk2' 'libpulse' 'libao' 'libgl' 'libxv' 'openal' 'sdl')
#  makedepends=('mesa')
#  provides=('laevateinn')
#  
#  cd "${srcdir}"
#  mkdir -p "${pkgdir}/usr/bin"
#  mkdir -p "${pkgdir}/usr/share/applications"
#  cp bsnes.desktop "${pkgdir}/usr/share/applications/laevateinn-gtk.desktop"
#  sed -i 's|bsnes-_ui-_profile|laevateinn-gtk|g' "${pkgdir}/usr/share/applications/laevateinn-gtk.desktop"
#  sed -i 's|bsnes-_ui.sh _profile|laevateinn-gtk|g' "${pkgdir}/usr/share/applications/laevateinn-gtk.desktop"
#  sed -i 's|emulator|debugger|g' "${pkgdir}/usr/share/applications/laevateinn-gtk.desktop"
#    
#  cd "bsnes_v$pkgver-source/bsnes"
#  cp out/laevateinn-gtk "${pkgdir}/usr/bin/"
#
#  find "${pkgdir}" -type d | xargs chmod 755
#  find "${pkgdir}" -type f | xargs chmod 644
#  chmod -R 755 "${pkgdir}/usr/bin"
#}

#package_laevateinn-qt() {
#  pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code - Debugger QT GUI"
#  depends=('bsnes-common' 'qt>=4.7.0' 'libpulse' 'libao' 'libgl' 'libxv' 'openal' 'sdl')
#  makedepends=('mesa')
#  provides=('laevateinn')
#  
#  cd "${srcdir}"
#  mkdir -p "${pkgdir}/usr/bin"
#  mkdir -p "${pkgdir}/usr/share/applications"
#  cp bsnes.desktop "${pkgdir}/usr/share/applications/laevateinn-qt.desktop"
#  sed -i 's|bsnes-_ui-_profile|laevateinn-qt|g' "${pkgdir}/usr/share/applications/laevateinn-qt.desktop"
#  sed -i 's|bsnes-_ui.sh _profile|laevateinn-qt|g' "${pkgdir}/usr/share/applications/laevateinn-qt.desktop"
#  sed -i 's|emulator|debugger|g' "${pkgdir}/usr/share/applications/laevateinn-qt.desktop"
#    
#  cd "bsnes_v$pkgver-source/bsnes"
#  cp out/laevateinn-qt "${pkgdir}/usr/bin/"
#
#  find "${pkgdir}" -type d | xargs chmod 755
#  find "${pkgdir}" -type f | xargs chmod 644
#  chmod -R 755 "${pkgdir}/usr/bin"
#}

package_purify-gtk() {
  pkgdesc="ROM purifier - GTK GUI"
  pkgver=01
  depends=('bsnes' 'gtk2')
  provides=('beat')

  cd "${srcdir}"
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/share/applications"
  cp purify.desktop "${pkgdir}/usr/share/applications/purify-gtk.desktop"
  sed -i 's|_ui|gtk|g' "${pkgdir}/usr/share/applications/purify-gtk.desktop"
  cp purify-gtk.sh "${pkgdir}/usr/bin/"

  cd "bsnes_v091-source/purify"
  cp purify-gtk "${pkgdir}/usr/bin/"

  find "${pkgdir}" -type d | xargs chmod 755
  find "${pkgdir}" -type f | xargs chmod 644
  chmod -R 755 "${pkgdir}/usr/bin"
}

package_purify-qt() {
  pkgdesc="ROM purifier - QT GUI"
  pkgver=01
  depends=('bsnes' 'qt>=4.7.0')
  provides=('purify')

  cd "${srcdir}"
  mkdir -p "${pkgdir}/usr/bin"
  mkdir -p "${pkgdir}/usr/share/applications"
  cp purify.desktop "${pkgdir}/usr/share/applications/purify-qt.desktop"
  sed -i 's|_ui|qt|g' "${pkgdir}/usr/share/applications/purify-qt.desktop"
  cp purify-qt.sh "${pkgdir}/usr/bin/"

  cd "bsnes_v091-source/purify"
  cp purify-qt "${pkgdir}/usr/bin/"

  find "${pkgdir}" -type d | xargs chmod 755
  find "${pkgdir}" -type f | xargs chmod 644
  chmod -R 755 "${pkgdir}/usr/bin"
}

pkgdesc="SNES emulator focused on accuracy, debugging functionality, and clean code"
pkgver=091
pkgrel=5
depends=()
optdepends=('beat: ROM patcher')
