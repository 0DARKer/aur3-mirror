pkgname="openvswitch"
pkgver="1.1.0pre2"
pkgrel=2
pkgdesc="A multilayer virtual switch"
arch=("i686" "x86_64")
url='http://openvswitch.org/'
license=('Apache')
groups=()
depends=('kernel26' 'dkms')
makedepends=('kernel26-headers')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install="$pkgname.install"
changelog=
source=(http://openvswitch.org/releases/$pkgname-$pkgver.tar.gz
        configure-python2.patch
        dkms.conf
        openvswitch.init)
noextract=()
sha256sums=('af9eea41405c8ae10297c393fad54ee0b70d12e737962e2022dddf530573970b'
            '8839340a1ecfa100c1dcd99b0e3e5ab4410836fb938c55a667eb2ab2e8a96566'
            'a6ac60a21f6e6ce11a6ff564bfbf362917603a0d97953f902ba9b4029295a6da'
            'fa9e5c00749a4466432bb856a605d860d58ab4f8d9a0d9dafe892166d1adc7fe')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  patch -p0 < "$startdir/configure-python2.patch"
  ./configure --prefix=/usr --localstatedir=/var

  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  make DESTDIR="$pkgdir/" install

  install -d "$pkgdir/usr/src" \
    "$pkgdir/etc/rc.d" "$pkgdir/etc/$pkgname" \
    "$pkgdir/var/run/$pkgname" "$pkgdir/usr/share/$pkgname"
  cp -a "$srcdir/$pkgname-$pkgver" "$pkgdir/usr/src/"
  install -t "$pkgdir/usr/src/$pkgname-$pkgver/" "$startdir/dkms.conf"
  install -m 744 "$srcdir/$pkgname.init" "$pkgdir/etc/rc.d/$pkgname"
  install -t "$pkgdir/usr/share/$pkgname" "$srcdir/$pkgname-$pkgver/vswitchd/vswitch.ovsschema"
}

# vim:set ts=2 sw=2 et:

