pkgname="openvswitch"
pkgver="1.4.1"
pkgrel=1
pkgdesc="A multilayer virtual switch"
arch=("i686" "x86_64")
url='http://openvswitch.org/'
license=('Apache')
options=('!upx' '!strip')
conflicts=( 'openvswitch-git')
groups=()
depends=('dkms')
install="$pkgname.install"
source=(http://openvswitch.org/releases/$pkgname-$pkgver.tar.gz
        dkms.conf
        openvswitch.init)
noextract=()
sha256sums=('6d62b1417161c4533f9253b46961a094cd14453b3761d0366501c4695a75e1cb'
            '504fe04c7827a880e614c3aaa5d57f6b472430d84bb2d9eca1c94a6041b218dc'
            'e4d7e95fdff2977a66eb94450fd8c32fe9e948034a733bc6e907d04f6569486e')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  ./configure --with-python=python2 --prefix=/usr --localstatedir=/var

  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  make DESTDIR="$pkgdir/" install

  install -d "$pkgdir/usr/src" \
    "$pkgdir/etc/rc.d" "$pkgdir/etc/$pkgname" \
    "$pkgdir/var/run/$pkgname" "$pkgdir/usr/share/$pkgname"
  cp -a "$srcdir/$pkgname-$pkgver" "$pkgdir/usr/src/"
  install -t "$pkgdir/usr/src/$pkgname-$pkgver/" "$startdir/dkms.conf"
  install -m 744 "$srcdir/$pkgname.init" "$pkgdir/etc/rc.d/$pkgname"
  install -t "$pkgdir/usr/share/$pkgname" "$srcdir/$pkgname-$pkgver/vswitchd/vswitch.ovsschema"

  # This line replaces references to $pkgdir with /usr/src/openvswitch
  sed -e "s;$srcdir/;/usr/src/openvswitch/;g" -i $(grep -riIs "$srcdir/" $pkgdir | awk -F':' '{print $1}' | sort | uniq)
}

# vim:set ts=2 sw=2 et:


