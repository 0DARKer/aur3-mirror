# Maintainer: josephgbr <rafael.f.f1@gmail.com>

pkgname=teeworlds-ddnet
pkgver=6.6.7
pkgrel=1
pkgdesc="A customized version by DDRaceNetwork of this 2D shooting game"
arch=('i686' 'x86_64')
url="http://ddnet.tw"
license=('custom')
depends=('alsa-lib' 'glu' 'sdl' 'freetype2')
makedepends=('gendesk')
provides=('teeworlds')
conflicts=('teeworlds')
source=(teeworlds-ddnet.png) # PNG converted from DDNet.ico from https://github.com/def-/ddnet
source_i686=("$url/downloads/DDNet-$pkgver-linux_x86.tar.gz")
source_x86_64=("$url/downloads/DDNet-$pkgver-linux_x86_64.tar.gz")
md5sums=('41465eb3a4ecf2e7f7afe5a5f0c84386')
md5sums_i686=('3fc8d2fe1f089409513254817a3bc394')
md5sums_x86_64=('748ec3f80a08e8f1344e969ba11fbe60')

# Check hashs manually (replace $pkgver):
# curl -sL http://ddnet.tw/downloads/md5sums | grep -E DDNet-$pkgver-linux

prepare() {
  gendesk -f -n --pkgname "$pkgname" --pkgdesc "$pkgdesc" \
    --name 'Teeworlds' --categories 'Game;ArcadeGame'
}

package() {
  cd DDNet-$pkgver-linux_*
  
    # Install binaries
  install -Dm755 DDNet "$pkgdir"/usr/bin/teeworlds-ddnet
  install -Dm755 DDNet-Server "$pkgdir"/usr/bin/teeworlds-ddnet_srv
  install -Dm755 dilate "$pkgdir"/usr/bin/dilate

    # Install data files
  mkdir -p "$pkgdir"/usr/share/teeworlds/data
  cp -r data/* "$pkgdir"/usr/share/teeworlds/data
  
    # Install desktop and icon files
  install -Dm644 ../$pkgname.desktop "$pkgdir"/usr/share/applications/$pkgname.desktop
  install -Dm644 ../$pkgname.png     "$pkgdir"/usr/share/pixmaps/$pkgname.png
  
    # Install license files
  install -Dm644 license.txt "$pkgdir"/usr/share/licenses/$pkgname/license.txt
  install -Dm644 license_DDRace.txt "$pkgdir"/usr/share/licenses/$pkgname/license_DDRace.txt
}
