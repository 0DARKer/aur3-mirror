# Maintainer: xerc <aur[at]xerc.de> 
# Contributor: milomouse <vincent[at]fea.st>
# Contributor: judd <jvinet[at]zeroflux.org>
# Contributor: falconindy <d[at]falconindy.com>

_basename=util-linux
pkgname=${_basename}-aes
_basever=2.20
pkgver=${_basever}.1
pkgrel=2
_loopaesdiff=${_basename}-${_basever}-20110905.diff

pkgdesc="Miscellaneous system utilities for Linux, with loop-AES support"
url="http://sourceforge.net/projects/loop-aes/"
license=('GPL2')
arch=('i686' 'x86_64')
groups=('base')
depends=('bash' 'ncurses>=5.7' 'zlib' 'filesystem')
makedepends=('autoconf' 'automake')
optdepends=('perl: for chkdupexe support')
provides=('linux32' "util-linux=${pkgver}" "util-linux-ng=${pkgver}")
conflicts=('linux32' 'util-linux' 'util-linux-ng' 'e2fsprogs<1.41.8-2')
replaces=('linux32' 'util-linux' 'util-linux-ng')
options=('!libtool')

install=${pkgname}.install
source=(http://ftp.kernel.org/pub/linux/utils/${_basename}/v${_basever}/${_basename}-${pkgver}.tar.bz2
        http://loop-aes.sourceforge.net/updates/${_loopaesdiff}.bz2
        ${pkgname}.install)

build() {
  cd "${srcdir}/${_basename}-${pkgver}"
  # hardware clock
  sed -e 's%etc/adjtime%var/lib/hwclock/adjtime%' -i hwclock/hwclock.c
  # provide loop-AES support
  msg "Patching with: ${_loopaesdiff}"
  patch -Np1 -i "${srcdir}/${_loopaesdiff}"
  msg "Starting autogen..."
  ./autogen.sh
  msg "Starting configure..."
  ./configure --enable-arch --enable-write --enable-raw --disable-wall --enable-partx
  msg "Starting make..."
  make
}

package() {
  cd "${srcdir}/${_basename}-${pkgver}"
  install -dm0755 "${pkgdir}/var/lib/hwclock"
  make DESTDIR="${pkgdir}" install
}

md5sums=('079b37517fd4e002a2e6e992e8b4e361'
         '3b1b5cbe6dd8c4220aafa59b109a19e9'
         '7bfa755b056a0c48a504153a3809cf1c')
