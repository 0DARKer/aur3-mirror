# Maintainer: Knut Franke - Knut.Franke*gmx.de
# Contributor: Olaf Leidinger <leidola@newcon.de>
# Contributor: Robal <nigrantis.tigris*.gmail.com>

pkgname=scidavis
pkgver=0.2.4
pkgrel=5
pkgdesc="Free application for Scientific Data Analysis and Visualization, started as a fork of QtiPlot"
arch=("i686" "x86_64")
depends=('qt>=4.3' 'qt-assistant-compat' 'qwt>=5.1' 'qwtplot3d>=0.2.6'
         'gsl>=1.8' 'muparser>=1.28' 'zlib>=1.2.3'
			'python2>=2.5' 'python2-qt>=4.2' 'python2-sip>=4.6'
			'desktop-file-utils')
license=("GPL")
url="http://scidavis.sourceforge.net/"
source=("http://prdownloads.sourceforge.net/sourceforge/scidavis/scidavis-$pkgver.tar.bz2"
        "scidavis.pro.patch"
        "scidavis.install"
        "qt-assistant-compat.patch"
        "scidavis-python2.patch"
       )
install="scidavis.install"
md5sums=('c5650475c5e0b22f9ee5dc49630a0e89'
         '5973f8d7e6af56bb3d50e6ac680ee3fb'
         '737bc185c599447d4eef7c215dabecc9'
         '450b7139f913210dd8a0ffbde03e86be'
         '09161556e00801f5fbdc938d031aec4c'
        )

build() {
  cd $startdir/src/scidavis-$pkgver/scidavis || return 1

  patch < $startdir/src/scidavis.pro.patch || return 1
  patch -p2 < $startdir/src/qt-assistant-compat.patch || return 1
  patch  < $startdir/src/scidavis-python2.patch || return 1

  # There appears to be a problem with qmake not generating the install target for translation files,
  # at least with Qt 4.4.3. Target is generated if .qm files exist at qmake run time, though.
  (lupdate scidavis.pro && lrelease scidavis.pro) || return 1

  qmake || return 1
  make  || return 1

  make INSTALL_ROOT=$startdir/pkg install || return 1

  _pydir=`python2 -c "from distutils import sysconfig; print sysconfig.get_python_lib()"`
  python2 `dirname $_pydir`/py_compile.py $pkgdir/etc/scidavisrc.py || return 1
  python2 `dirname $_pydir`/py_compile.py $pkgdir/usr/share/scidavis/scidavisUtil.py || return 1

}
