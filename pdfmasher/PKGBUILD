# Maintainer: Blake Dickie <gentro_silva@shaw.ca>
pkgname=pdfmasher
pkgver=0.7.2
pkgrel=1
pkgdesc="PDF to eBook Conversion Tool"
arch=(any)
url="http://www.hardcoded.net/pdfmasher/"
license=('GPL')
depends=('python' 'jobprogress' 'pdfminer3k' 'pyqt' 'python-cssutils' 'python-lxml' 'python-distribute' 'python-markdown' 'python-cssselect')
makedepends=('mercurial')
source=(cssutils.patch)
md5sums=('50d0795fc23e5987d1134cedf30dbd31')


build() {

  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [[ -d "$pkgname" ]]; then
    cd "$pkgname"
    hg pull -u
    msg "The local files are updated."
  else
    hg clone "https://bitbucket.org/hsoft/pdfmasher" "$pkgname"
  fi

  msg "Mercurial checkout done or server timeout"
  
  msg "Preparing Working Build Folder"
  rm -rf "$srcdir/$pkgname-build"
  cp -r "$srcdir/$pkgname" "$srcdir/$pkgname-build"
  cd "$srcdir/$pkgname-build"
  
  msg "Switching to Production Tag"
  hg checkout $pkgver
  
  msg "Starting build..."
  
  patch -p1 < $srcdir/cssutils.patch
  
  python configure.py
  python build.py
}

package() {
  cd "$srcdir/$pkgname-build"
  
  mkdir -p "$pkgdir/usr/share/pdfmasher"
  cp -a run.py ebooks hscommon core images qt qtlib "$pkgdir/usr/share/pdfmasher/"
  chmod a+x "$pkgdir/usr/share/pdfmasher/run.py"
  
  mkdir -p "$pkgdir/usr/bin"
  ln -s ../share/pdfmasher/run.py "$pkgdir/usr/bin/pdfmasher"
}

# vim:set ts=2 sw=2 et:
