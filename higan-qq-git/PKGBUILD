pkgname=higan-qq-git
pkgver=094.8d4b3cf
pkgrel=1
pkgdesc="A Nintendo multi-system emulator formerly known as bsnes"
arch=('i686' 'x86_64')
url=http://byuu.org/higan/
license=(GPL)
conflicts=('higan' 'bsnes')
provides=(higan{,-qq}{,-git})
makedepend=('libao')
depends=('openal' 'libgl')
optdepends=('alsa' 'pulseaudio' 'sdl')
source=('higan::git+git://gitorious.org/bsnes/higan-qq.git'
	'profilebatch')
install=higan.install
_profile="accuracyfast" 
md5sums=('SKIP'
         '1f6762965c9cd3ea367d03e8c2e51d11')
 
pkgver() {
        cd "higan"
        echo 094.$( git describe --always | sed 's#-#_#g;s#v##' )
}
 
prepare(){
        cd "${srcdir}/higan"
        #Append user's CXXFLAGS and LDFLAGS
        sed -i "/^flags   += -I. -O3 -fomit-frame-pointer/ s/$/ -std=gnu++11 $CXXFLAGS/" Makefile
        sed -i "/^link    +=/ s/$/ $LDFLAGS/" Makefile
}
 
build(){
# libananke
        cd "${srcdir}/higan"
        make compiler=g++ platform=linux flags="$CXXFLAGS -I.. -fomit-frame-pointer -std=gnu++11" -C ananke
 
# higan
        cd "${srcdir}/higan"
        make clean
        #for _profile in ${_profiles}; do
                make compiler=g++ platform=linux target=higan profile=${_profile} name=higan-${_profile}
                #mv out/higan{,-${_profile}}
        #done
        # Profile Guided Optimization: run all systems and special chip games
        # not updated for new nSide systems (Playchoice 10, VS System)
        #./profilebatch out/higan-${_profile} /path/to/your/rom/library/
}
 
package(){
# Install higan
        cd "${srcdir}/higan"
# Common files
        #install -dm 755 "${pkgdir}"/usr/{bin,lib,share/{applications,pixmaps,higan/Video\ Shaders}}
        #install -m 755 "${srcdir}"/Higan "${pkgdir}"/usr/bin/higan
        #install -m 644 "${srcdir}"/higan/data/higan.desktop "${pkgdir}"/usr/share/applications/higan.desktop
        #install -m 644 "${srcdir}"/higan/data/higan.png "${pkgdir}"/usr/share/pixmaps/higan.png
        #install -m 644 "${srcdir}"/higan/data/higan.ico "${pkgdir}"/usr/share/pixmaps/higan.ico
        #cp -dr --no-preserve=ownership profile/* data/cheats.bml "${pkgdir}"/usr/share/higan/
        #cp -dr --no-preserve=ownership shaders/*.shader "${pkgdir}"/usr/share/higan/Video\ Shaders/
 
# libananke

	#if [ ! -d ~/.config/ananke ]; then install -d ~/.config/ananke; fi

	echo ${pkgdir}
        make DESTDIR=${pkgdir} prefix=/usr/lib/ -C ananke install

        #install -m 644 "${srcdir}"/higan/ananke/libananke.so "${pkgdir}"/usr/lib/libananke.so.1
        #cd "${pkgdir}"/usr/lib/
        #ln -s libananke.so.1 libananke.so
 
# higan
	echo ${pkgdir}
        make DESTDIR=${pkgdir} prefix=/usr/ name=higan-${_profile} install
        #cd "${srcdir}/higan"
        #for _profile in ${_profiles}; do
        #        install -m 755 {out,"${pkgdir}"/usr/bin}/higan-${_profile}
        #done
 
# Fix permissions
        #find "${pkgdir}"/usr/share/higan/ -type d -exec chmod 755 {} +
        #find "${pkgdir}"/usr/share/higan/ -type f -exec chmod 644 {} +
}

