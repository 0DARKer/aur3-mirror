# Contributor: tuxspirit <tuxspiritATarchlinuxDOTfr>

_pkgname=swiftweasel
_pkgproc=nocona
_pkglang=es-AR
pkgname=swiftweasel-nocona-es
_pkgdate="07-16-08"
pkgver=3.0.1
pkgrel=1
pkgdesc="Mozilla Firefox optimized build for Core Duo/Celeron D (32 and 64bit) processors. (Spanish version)"
arch=('i686' 'x86_64')
url="http://swiftweasel.tuxfamily.org/"
license=('MPL' 'GPL' 'LGPL')
depends=('mozilla-common' 'desktop-file-utils' 'xulrunner>=1.9')
makedepends=('unzip')
provides=('firefox' 'swiftweasel')
conflicts=('swiftweasel' 'swiftweasel3')

if [ "$CARCH" = "x86_64" ]; then
	_nbits=64bit
md5sums=('89b0fb6224eccb63fe4a5032dd627bd7'
         'e02fc1051ff31e05e45ec99eb38e16f6'
         'eef46b6617fb0dab69037c122793c6fb'
         '5d04eec835044a3661bf1eceedfdaac7')
else 	_nbits=32bit
md5sums=('de33e991f0ed2ba4b3a7c868f5cfb1cd'
         'e02fc1051ff31e05e45ec99eb38e16f6'
         'eef46b6617fb0dab69037c122793c6fb'
         '961e7d88656a9c5571685e445c4fa5b1')
fi

source=(http://downloads.sourceforge.net/swiftweasel/swiftweasel-${pkgver}_${_pkgdate}_${_pkgproc}-${_nbits}.tar.gz
	swiftweasel.desktop
	swiftweasel-safe.desktop
	ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-i686/xpi/${_pkglang}.xpi)

build() {

  # Software
  cd ${srcdir}/

  mkdir ${pkgdir}/opt/
  cp -r ${_pkgname} ${pkgdir}/opt/${_pkgname}

  ## Fix error install.rdf
  chmod -R 755 ${pkgdir}/opt/${_pkgname}/extensions/*

  mkdir -p ${pkgdir}/usr/bin
  ln -s /opt/${_pkgname}/${_pkgname} ${pkgdir}/usr/bin/${_pkgname}

  install -d -m755 ${pkgdir}/usr/share/{applications,pixmaps}
  install -m644 -D ${srcdir}/swiftweasel/icons/mozicon128.png ${pkgdir}/usr/share/pixmaps/swiftweasel.png || return 1
  install -m644 ${srcdir}/swiftweasel.desktop ${pkgdir}/usr/share/applications/ || return 1
  install -m644 ${srcdir}/swiftweasel-safe.desktop ${pkgdir}/usr/share/applications/ || return 1 

  # Translate
  unzip -o ${_pkglang}.xpi
  sed -i "s|jar:chrome/${_pkglang}.jar|jar:${_pkglang}.jar|" chrome.manifest || return 1
  install -D -m 644 chrome/${_pkglang}.jar ${pkgdir}/opt/${_pkgname}/chrome/${_pkglang}.jar || return 1
  install -D -m 644 chrome.manifest ${pkgdir}/opt/${_pkgname}/chrome/${_pkglang}.manifest || return 1
  rm ${pkgdir}/opt/${_pkgname}/chrome/en-US.jar
  rm ${pkgdir}/opt/${_pkgname}/chrome/en-US.manifest
  sed -i "s|en-US|${_pkglang}|" ${pkgdir}/opt/swiftweasel/defaults/pref/firefox-l10n.js || return 1
}
