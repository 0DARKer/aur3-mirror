# Contributor: 3ED <kas1987@o2.pl>

pkgname=poc
pkgver=0.4.1
pkgrel=6
pkgdesc="poc includes mp3cue, a mp3 CUE cutter, and mp3cut, a mp3 command-line editing tool"
arch=('i686' 'x86_64')
license=('custom')
depends=('glibc')
makedepends=('flex' 'bison')
url="http://www.bl0rg.net/software/poc/"
install=poc.install
source=("http://www.bl0rg.net/software/poc/$pkgname-$pkgver.tar.gz"
        "patch-x64.diff")
md5sums=('f62f0fb5ed54796c5d60c11e92bae544'
         'dae24b94a2d0653425a04675e396edc8')

DLAGENTS=('http::/usr/bin/wget -c -t 3 --waitretry=3 --no-check-certificate -O %o %u')

build() {
	cd "$srcdir/$pkgname-$pkgver"

	if [ "$CARCH" = "x86_64" ]; then
		patch -Np0 < "$srcdir/patch-x64.diff"
	fi

	msg "Compiling.."
	make || return 1

	msg "Instaling files.."
#	---
	for i in \
		"$pkgdir/usr/bin" \
		"$pkgdir/usr/share/man/man1" \
		"$pkgdir/usr/share/licenses/poc"
	do
		install -d -m 755 "$i" || return 1
	done
#	---
	for i in \
		"mp3cue" \
		"mp3cut" \
		"mp3length" \
		"pob-2250" \
	 	"pob-3119" \
		"pob-fec" \
	 	"poc-2250" \
		"poc-3119" \
		"poc-fec" \
		"poc-http" \
		"pogg-http"
	do
		install -m 755 \
			"${i}" "$pkgdir/usr/bin" \
			|| return 1
		test -f "man/man1/${i}.1.gz" || gzip -9 "man/man1/${i}.1" || return 1
		install -m 644 \
			"man/man1/${i}.1.gz" "$pkgdir/usr/share/man/man1" \
			|| return 1
	done
#	---

	msg "Installing license.."
	install -m 444 \
		"LICENSE" "$pkgdir/usr/share/licenses/poc/LICENSE" \
		|| return 1
}
