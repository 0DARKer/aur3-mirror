# Contributor: Manuel Mazzuola <origin.of@gmail.com>
# Contributor: neuromante <lorenzo.nizzi.grifi@gmail.com>

pkgname=banshee-git
pkgver=20100914
pkgrel=2
pkgdesc="Music management and playback for GNOME - Development"
url="http://banshee-project.org/"
license="MIT"
depends=('mono>=2.2' 'google-gdata-sharp' 'gtk-sharp-beans-git' 'gio-sharp-git' 'gudev-sharp-git' 'gkeyfile-sharp-git' 'libgpod-sharp-git' 'gstreamer0.10' 'gtk-sharp-2>=2.12' 'musicbrainz' 'sqlite3>=3.4' 'gnome-sharp' 'mono-addins>=0.3.1' 'ndesk-dbus>=0.5' 'ndesk-dbus-glib>=0.3.1' 'taglib-sharp>=2.0.3.6' 'mono-zeroconf' 'libmtp' 'ipod-sharp>=0.8.5' 'boo>=0.8.1' 'podsleuth' 'webkit-sharp')
arch=('i686' 'x86_64')
provides=('banshee=1.7.4')
conflicts=('banshee' 'banshee-1-svn')
replaces=('banshee-1-svn')
makedepends=('git' 'intltool')
#source=('banshee_clutter_1.2.patch')
#md5sums=('d23c31d59660d4f4e701533188ec739f')
#install=banshee.install

_gitroot="git://git.gnome.org/banshee"
_gitname="banshee"

build() {
  export MONO_SHARED_DIR=${startdir}/src/.wabi
  mkdir -p "${MONO_SHARED_DIR}"
  cd ${srcdir}
  msg "Connecting to Gnome GIT server...."
  rm  -rf $startdir/src/$_gitname-build
  
  if [[ -d $_gitname ]]; then
   cd $_gitname || return 1
   git pull origin || return 1
   git submodule init || return 1
   git submodule update || return 1
    else
   git clone $_gitroot $_gitname || return 1
     fi
  msg " checkout done."
 
  cd $srcdir || return 1
  cp -r $_gitname $_gitname-build

  cd $_gitname-build || return 1
  
#  msg "Applying Clutter 1.2 patch"
  
 # patch -p0 -i ../banshee_clutter_1.2.patch

  ./autogen.sh --prefix=/usr --disable-clutter --disable-docs --disable-hal --enable-gdata --enable-webkit || return 1
  make hicolordir=/usr/share/icons/hicolor || return 1
  make DESTDIR=${startdir}/pkg install
  #rm $pkgdir/usr/share/applications/mimeinfo.cache

  rm -rf "${MONO_SHARED_DIR}"
}
