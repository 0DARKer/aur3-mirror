--- src/nxcomp/NXproto.h	2007-06-04 15:01:46.000000000 +0200
+++ src/nxcomp/NXproto.h.new	2009-11-23 14:56:00.000000000 +0100
@@ -27,6 +27,29 @@
 #include <X11/Xproto.h>
 
 /*
+  Copied from Xproto.h
+ */
+
+/* For the purpose of the structure definitions in this file,
+we must redefine the following types in terms of Xmd.h's types, which may
+include bit fields.  All of these are #undef'd at the end of this file,
+restoring the definitions in X.h.  */
+
+#define Window CARD32
+#define Font CARD32
+#define Pixmap CARD32
+#define Cursor CARD32
+#define Colormap CARD32
+#define Atom CARD32
+#define VisualID CARD32
+#define Time CARD32
+#define KeyCode CARD8
+#define KeySym CARD32
+
+/* End copied from Xproto.h */
+
+
+/*
  * Force the size to match the wire protocol.
  */
  
@@ -350,9 +373,9 @@
     CARD8    dstDepth;
     CARD32   srcLength B32;
     CARD32   dstLength B32;
-    INT16    srcX B16, srcY B16;
+    CARD16    srcX B16, srcY B16;
     CARD16   srcWidth B16, srcHeight B16;
-    INT16    dstX B16, dstY B16;
+    CARD16    dstX B16, dstY B16;
     CARD16   dstWidth B16, dstHeight B16;
 } xNXPutPackedImageReq;
 
@@ -436,4 +459,20 @@
 }
 #endif
 
+/* Copied from Xproto.h */
+
+/* restore these definitions back to the typedefs in X.h */
+#undef Window
+#undef Drawable
+#undef Font
+#undef Pixmap
+#undef Cursor
+#undef Colormap
+#undef GContext
+#undef Atom
+#undef VisualID
+#undef Time
+#undef KeyCode
+#undef KeySym
+
 #endif /* NXproto_H */
