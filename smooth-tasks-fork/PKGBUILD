# Maintainer: Sergey Malkin <adresatt@gmail.com>

pkgname=smooth-tasks-fork
pkgver=496
pkgrel=4

url="https://bitbucket.org/flupp/smooth-tasks-fork/overview"
pkgdesc="A fork of great KDE taskbar replacement plasmoid smooth-tasks aimed to improve on animation and
layouting."
license=('GPLv2')

arch=('x86_64' 'i686')

_hgroot="https://bitbucket.org/flupp"
_hgrepo="smooth-tasks-fork"

depends=('kdebase-workspace>=4.3')
makedepends=('automoc4' 'cmake' 'mercurial' 'coreutils' 'perl')

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [ -d $_hgrepo ] ; then
    cd $_hgrepo
    hg pull -u
    msg "The local files are updated."
  else
    hg clone $_hgroot $_hgrepo
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_hgrepo-build"
  cp -r "$srcdir/$_hgrepo" "$srcdir/$_hgrepo-build"
  cd "$srcdir/$_hgrepo-build"

  #
  # BUILD HERE
  #

  # Compile the plasmoid
  cmake . -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release || return 1
  make || return 1
}

package() {
  cd "$srcdir/$_hgrepo-build"
  make DESTDIR="${pkgdir}" install || return 1
}
