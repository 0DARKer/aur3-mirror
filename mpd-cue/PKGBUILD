pkgname=mpd-cue
pkgver=0.13.2
pkgrel=3
pkgdesc="Mpd with cue, ape, wavpack support"
arch=('i686' 'x86_64')
license=("GPL")
url="http://musicpd.org"
depends=('libid3tag' 'libmad' 'flac>=1.1.3' 'audiofile' 'faad2>=2.6.1' 'libmikmod' 'wavpack'
         'alsa-lib' 'libshout' 'libmpcdec>=1.2.5' 'libsamplerate' 'libao' 'ffmpeg' 'libtool')
install=mpd.install
provide=(mpd)
source=(http://musicpd.org/uploads/files/mpd-${pkgver}.tar.gz
        mpd mpd.conf.example cue_ape_wv.patch cue_trackdelete_fix.patch mpd_cue_stop_decoding_fix.patch)

md5sums=('33d0c7b08e2c9e2a6ad55703cb0d18d0'
         'b1fd15de359db08e4b9ae4b199640f0e'
         'b3e370377d39d17427c50f04a0cdea6e'
         '25144963a110204bf0b8e737f4290485'
         'a22f9868481a5bfaf78ff6936e0a7aa1'
         'bb699bdad7e43d6f3a5f061ca668fcab')


build() {
  cd ${startdir}/src/mpd-${pkgver}
  patch -p1 < $srcdir/cue_ape_wv.patch
  sed -i 's|ffmpeg/avcodec.h|libavcodec/avcodec.h|' src/inputPlugins/ffmpeg_plugin.c
  sed -i 's|ffmpeg/avformat.h|libavformat/avformat.h|' src/inputPlugins/ffmpeg_plugin.c
  patch -p0 < $srcdir/cue_trackdelete_fix.patch
  patch -p1 < $srcdir/mpd_cue_stop_decoding_fix.patch
  autoreconf
  ./configure --prefix=/usr --sysconfdir=/etc --disable-jack --enable-ao -with-zeroconf=no
  cp /usr/bin/libtool .
  make || return 1
  make DESTDIR=${startdir}/pkg install

  install -D ../mpd ${startdir}/pkg/etc/rc.d/mpd
  install -Dm644 ../mpd.conf.example ${startdir}/pkg/etc/mpd.conf.example
  mkdir -p ${startdir}/pkg/var/lib/mpd/playlists
  mkdir -p ${startdir}/pkg/var/log/mpd
  mkdir -p ${startdir}/pkg/var/run/mpd
}
