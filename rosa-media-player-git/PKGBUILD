# Maintainer: VÃ­tor Ferreira <vitor.dominor@gmail.com>
_pkgname=rosa-media-player
pkgname=$_pkgname-git
pkgver=20130302
pkgrel=3
pkgdesc="The new multimedia player(based on SMPlayer) with clean and elegant UI."
arch=(i686 x86_64)
url="https://abf.rosalinux.ru/uxteam/ROSA_Media_Player"
license=('GPL')
provides=($_pkgname)
conflicts=($_pkgname)
depends=('qt4' 'mplayer' 'wildmidi' 'timidity-freepats')
optdepends=('mencoder: video splitting support'
            'ffmpeg: audio cutting and video recording support'
            'rosa-media-player-plugin: mozilla plugin'
            'qjson')
makedepends=('git' 'qt4' 'wildmidi')
install="$_pkgname".install

_gitroot=https://abf.rosalinux.ru/uxteam/ROSA_Media_Player.git
_gitname=$_pkgname

_pkgver=1.5.1
_mandriva_rel=6

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  mkdir "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname" && ls -A | grep -v .git | xargs -d '\n' cp -r -t ../$_gitname-build # do not copy over the .git folder
  cd "$srcdir/$_gitname-build"
  cd $_gitname

  #
  # BUILD HERE
  #
  ./get_romp_version.sh $_pkgver $_mandriva_rel
  make PREFIX=/usr QMAKE=qmake-qt4
}

package() {
  cd "$srcdir/$_gitname-build"
  cd $_gitname
  make PREFIX=/usr DESTDIR="$pkgdir" QMAKE=qmake-qt4 install
  cd ..
  rm -rf $(find "$pkgdir" -type d -name ".git")
}

# vim:set ts=2 sw=2 et:
