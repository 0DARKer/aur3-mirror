# Maintainer: Dan Serban
# Contributor: CHEN, Xing

pkgname=freefilesync
pkgver=4.xx.latest
pkgrel=1
pkgdesc="A free file sync tool"
arch=(i686 x86_64)
url=http://sourceforge.net/projects/freefilesync/
license=(GPLv3)
depends=(boost gtkmm wxgtk)
makedepends=(lynx)

build ()
{
  rm freefilesync.tar.gz 2>/dev/null || true
  _url=$(lynx -dump "http://sourceforge.net/projects/freefilesync/files/freefilesync/" | grep -o http.*freefilesync/v.*/$ | head -1)
  _url=$(lynx -dump "${_url}" | grep -o http.*FreeFileSync_Sourcecode_v.*.zip/download$)
  wget -O freefilesync.tar.gz "${_url}"
  bsdtar -xf freefilesync.tar.gz
  make
  make DESTDIR="${pkgdir}" install
  mkdir -p "${pkgdir}"/usr/share/applications
  DESKTOPFILE="${pkgdir}"/usr/share/applications/FreeFileSync.desktop
  echo "[Desktop Entry]" > "${DESKTOPFILE}"
  echo "Name=FreeFileSync" >> "${DESKTOPFILE}"
  echo "GenericName=Folder Comparison and Synchronization" >> "${DESKTOPFILE}"
  echo "Exec=FreeFileSync" >> "${DESKTOPFILE}"
  echo "Icon=/usr/share/FreeFileSync/Help/html/ffsicon.png" >> "${DESKTOPFILE}"
  echo "NoDisplay=false" >> "${DESKTOPFILE}"
  echo "StartupNotify=true" >> "${DESKTOPFILE}"
  echo "Categories=GTK;Application;Utility;" >> "${DESKTOPFILE}"
  echo "Terminal=0" >> "${DESKTOPFILE}"
  echo "Type=Application" >> "${DESKTOPFILE}"
  echo "X-KDE-SubstituteUID=false" >> "${DESKTOPFILE}"
  echo "X-KDE-Username=" >> "${DESKTOPFILE}"
}

