# Maintainer: Philip Abernethy<chais.z3r0@gmail.com>
pkgname=strikesuitzero-hib
pkgver=1389211698
pkgrel=2
pkgdesc="A space flight combat game"
arch=('i686' 'x86_64')
url="http://strikesuitzero.com/"
license=('custom:commercial')

DLAGENTS+=('hib::/usr/bin/echo "Could not find %u. Manually download it to \"$(pwd)\", or set up a hib:// DLAGENT in /etc/makepkg.conf."; exit 1')

_gamepkg="StrikeSuitZero_linux_${pkgver}.zip"
options=("!strip")

source=("hib://$_gamepkg"
	"strikesuitzero.desktop"
	"strikesuitzero.png")

sha512sums=('9c18adeb0547eff9b88fbb4c5f93bf03713e06eea368d300acf69ee829076ee9213e97d6c52eb9e7ef1dc70b36ed044d2e2536639df73992a27fe491694ceb89'
            'f50bfba9b700fc9c8e13ddea66e26e741691ea56669e229796529920507f46d0a89a82823e29c202052932d9cc2c6d8aba3f9b088a05238f943abcb8aa7886e2'
            '25c636f99943133445966353f6cab11eaf36e4909505b53ba1087d72911e19e74efade0c7a8c3e3b43f0beca3d795b188f549434aed8e09b1c774f1fe7ee87e1')

PKGEXT='.pkg.tar'

package() {
	mkdir -p ${pkgdir}/{opt/strikesuitzero,usr/{bin,share/applications}}
	mv ${srcdir}/linux/main ${pkgdir}/opt/strikesuitzero/
	mv ${srcdir}/strikesuitzero.png ${pkgdir}/opt/strikesuitzero/
	mv ${srcdir}/strikesuitzero.desktop ${pkgdir}/usr/share/applications/
	ln -s /tmp/sszMain.sav ${pkgdir}/opt/strikesuitzero/main/binary/Main.sav
	ln -s /tmp/sszoutput.txt ${pkgdir}/opt/strikesuitzero/main/binary/output.txt
	ln -s /tmp/sszsettings.sav ${pkgdir}/opt/strikesuitzero/main/binary/settings.sav
	ln -s /tmp/sszbackground.sav ${pkgdir}/opt/strikesuitzero/main/binary/background.sav
	echo '#!/bin/bash
SAVEDIR=""
if [[ -n $XDG_DATA_HOME ]]; then
	SAVEDIR=$XDG_DATA_HOME
else
	SAVEDIR="$HOME/.local/share"
fi
if [[ -d ~/.strikesuitzero ]]; then
	mv ~/.strikesuitzero "$SAVEDIR"
fi
if [[ ! -d $SAVEDIR/strikesuitzero ]]; then
	mkdir $SAVEDIR/strikesuitzero
fi
ln -s $SAVEDIR/strikesuitzero/Main.sav /tmp/sszMain.sav
ln -s $SAVEDIR/strikesuitzero/settings.sav /tmp/sszsettings.sav
ln -s $SAVEDIR/strikesuitzero/background.sav /tmp/sszbackground.sav
cd /opt/strikesuitzero/main/binary/
./StrikeSuitZero
rm /tmp/sszMain.sav
rm /tmp/sszoutput.txt
rm /tmp/sszsettings.sav
rm /tmp/sszbackground.sav' > ${pkgdir}/usr/bin/strikesuitzero
	chmod a+x ${pkgdir}/usr/bin/strikesuitzero
	chmod a+x ${pkgdir}/opt/strikesuitzero/main/binary/StrikeSuitZero
}
