# Maintainer: Alfredo Ramos <alfredo dot ramos at yandex dot com>

pkgname=ultra-flat-icons
pkgver=1.2.9
pkgrel=1
pkgdesc="A simple flat icon theme, derived from Flattr icon theme."
arch=(
	"any"
)
url="http://gnome-look.org/content/show.php?content=167477"
license=(
	"CCPL:cc-by-nc-sa-4.0"
)

depends=()
optdepends=()
makedepends=(
	"xdg-utils"
)
provides=(
	"${pkgname}=${pkgver}"
)

install=${pkgname}.install

# Original sources
# https://www.dropbox.com/s/dktl70lh4lnhp0a/ultra-flat-icons.tar.gz
# https://www.dropbox.com/s/zn38tno7mzr2pr1/ultra-flat-icons-orange.tar.gz
source=(
	"https://www.dropbox.com/s/29odb2610xfhm46/${pkgname}-${pkgver}.tar.gz"
	"https://www.dropbox.com/s/tq6urdxjwfkf21h/${pkgname}-orange-${pkgver}.tar.gz"
	"${pkgname}.install"
	"dark.index.theme.patch"
	"orange.index.theme.patch"
	"orange.dark.index.theme.patch"
)
sha384sums=(
	"a2fbd796686fc6ed67597aad16360e9654f6fc36515ca7bbce7d73c610a5b3486b34e10332c4432373f776c2d772f890"
	"cd846799d9b1ae21106410f9e431cd6cf4a6a09d1420b92d0ac97be8a7f46d454a268f8a639e526e76810051227cf312"
	"4d2c95e7b5636883c6678e68924382ef6a3d2c5ef347f042f951102495e83a49c430de42d57b53e5738c6c6282c3a9e3"
	"326dd615e95108083f502bf1d88f0225d6f689515d35fe13ce5debd6701233ee78d204710d3457d29e730e45dabf743d"
	"26add72764f302a095e6db10a7b5b239eed98a1cf637b5a50740a4693b0cc76854597f1948aef2e774f52d1f2f65c99f"
	"6fcc927fa940bf943c2e6c62342fb18c200e4bade1add7382aaa3f125bc0f8f1180b1c7d1638ec304f5b8cf2bb8620cb"
)
sha512sums=(
	"92f42b7538e18bf8273ab018e5e6d0f86627531494c195ec971016114c968773d9f6faf0ff275776d7640b4cc5ed602dca8aa002d252bf611e01fa3d4972dc81"
	"9f5e36b74b0b195466f84c768523ae8f99b85ca86249e3cf46464f7878eda7364ccdd296136686a5d81a115d7b043c73e0e8f14564d40a11378a27827d77a692"
	"0967ff18e99bf99a7c2ecf17019c4ddccd3ac31292e4766f4e4de5338fe481f2561e7fbf1d4bd1e204476a72ba3c986df6081a94feea4efb2a739be067f3ea34"
	"1a2acad15c7834638bdb7ba32be9e162dd2ddd44d58fac26615dd1f119aa4ee9cd9a5d29b7a1eecb3f2a88679b836b9fb55f12b836cdcfaabb63e6731e1dc688"
	"fcc1ff27514c0d05b890b78bc1dec5a21b2a66b982be4838b8e42299c5793d8f2c856559b591eb875e756897bf0c26122d05f0744c8630c35498167c318740f6"
	"126fa07b657debf3b5cacc8da9f9bcbc956b85da2f49a74d6dba8edfa7edb0bf8b61a9b728621628ba6b447d7501d2cba914e32f5f814948bd11766f74d81fad"
)

_iconset=UltraFlatIcons

icon_fix() {
	# Check if dir exists
	if [[ ! -d ${1} ]]; then
		warning "${1} doesn't exist"
	else
		# Change current working directory
		cd ${1}
		
		# Categories icons fix
		if [[ -d ${1}/categories ]]; then
			# System tools category fix
			ln -fsr ./categories/scalable/preferences-other.svg ./categories/scalable/applications-system.svg
		fi
		
		# Status icons fix
		if [[ -d ${1}/status ]]; then
			# Volume icons fix
			ln -fsr ./status/scalable/audio-volume-muted-panel.svg ./status/scalable/audio-volume-muted.svg
			ln -fsr ./status/scalable/audio-output-none-panel.svg ./status/scalable/audio-output-none.svg
			ln -fsr ./status/scalable/audio-volume-low-panel.svg ./status/scalable/audio-volume-low.svg
			ln -fsr ./status/scalable/audio-volume-medium-panel.svg ./status/scalable/audio-volume-medium.svg
			ln -fsr ./status/scalable/audio-volume-high-panel.svg ./status/scalable/audio-volume-high.svg
		fi
		
		# App icons fix
		if [[ -d ${1}/apps ]]; then
			# AMD Catalyst icons fix
			ln -fsr ./apps/scalable/amd.svg ./apps/scalable/ccc_large.svg
			
			# Wicd icon fix
			mkdir -p ${1}/extras/pixmaps/wicd
			ln -fsr ./apps/scalable/wicd.svg ./extras/pixmaps/wicd/wicd.svg
			ln -fsr ./apps/scalable/wicd-qt.svg ./extras/pixmaps/wicd/wicd-qt.svg
			ln -fsr ./apps/scalable/wicd-gtk.svg ./extras/pixmaps/wicd/wicd-gtk.svg
		fi
		
		# Permissions fix
		find . -type f -exec chmod 0644 {} \;
		find . -type d -exec chmod 0755 {} \;
	fi
}

package() {
	# Base directory 
	mkdir -p ${pkgdir}/usr/share/icons
	cd ${pkgdir}/usr/share/icons
	
	msg2 "Installing icon theme..."
	mkdir ${_iconset}
	cp -a ${srcdir}/${pkgname}/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ./${_iconset}
	rm -fR ./${_iconset}/status/scalable\ white\ panel status
	
	msg2 "Installing dark icon theme..."
	mkdir ${_iconset}Dark
	cp -a ${srcdir}/${pkgname}/{status,index.theme} ./${_iconset}Dark
	rm -fR ./${_iconset}Dark/status/scalable
	mv ./${_iconset}Dark/status/scalable\ white\ panel ./${_iconset}Dark/status/scalable
	patch ./${_iconset}Dark/index.theme < ${srcdir}/dark.index.theme.patch
	
	msg2 "Installing icon theme orange folders..."
	mkdir ${_iconset}Orange
	cp -a ${srcdir}/${pkgname}-orange/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ./${_iconset}Orange
	rm -fR ./${_iconset}Orange/status/scalable\ white\ panel status
	patch ./${_iconset}Orange/index.theme < ${srcdir}/orange.index.theme.patch
	
	msg2 "Installing dark icon theme orange folders..."
	mkdir ${_iconset}OrangeDark
	cp -a ${srcdir}/${pkgname}-orange/{status,index.theme} ./${_iconset}OrangeDark
	rm -fR ./${_iconset}OrangeDark/status/scalable
	mv ./${_iconset}OrangeDark/status/scalable\ white\ panel ./${_iconset}OrangeDark/status/scalable
	patch ./${_iconset}OrangeDark/index.theme < ${srcdir}/orange.dark.index.theme.patch
	
	msg2 "Fixing icons..."
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}Dark
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}Orange
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}OrangeDark
	
	msg2 "Installing license..."
	mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
	cp ${srcdir}/${pkgname}/LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}