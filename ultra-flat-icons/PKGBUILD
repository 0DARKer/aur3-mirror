# Maintainer: Alfredo Ramos <alfredo dot ramos at yandex dot com>

pkgname=ultra-flat-icons
pkgver=1.2.7
pkgrel=1
pkgdesc="A simple flat icon theme, derived from Flattr icon theme."
arch=(
	"any"
)
url="http://gnome-look.org/content/show.php?content=167477"
license=(
	"CCPL:cc-by-nc-sa-4.0"
)

depends=()
optdepends=()
makedepends=(
	"xdg-utils"
)
provides=(
	"${pkgname}=${pkgver}"
)
conflicts=(
	"${pkgname}"
)
replaces=(
	"${pkgname}"
)

install=${pkgname}.install

# Original source <https://www.dropbox.com/s/dktl70lh4lnhp0a/ultra-flat-icons.tar.gz>
source=(
	"https://www.dropbox.com/s/v5v73dbefu6x9de/${pkgname}-${pkgver}.tar.gz"
	"${pkgname}.install"
	"index.theme.dark.patch"
)
sha384sums=(
	"78458b730cecc3380f65089792ae735b78e7652c4671c10f5db81de972bb95f548b27f1ad4f14f38281488c139031c90"
	"ca84acdcac970edf78980cf056f1a3e8cfa398dd16b722434f2fe57dec57b9a2b3e5915320fe1508282fea8fab5c8b3e"
	"460ddeb4d9dbf90f5cf4bded3bee8860a2b41758cad81b6d88df7f08fca89b3004b9090dcd6b74637260725e8178efad"
)
sha512sums=(
	"b5909d66d3ec72413a38605417488eaf71e01b066bfb5648825b1abbdbfb54978a69cbd771aeda2d71a2759845434a4ca0d8d237a71af418f1cc8a8c628b202c"
	"16186f510156fde6b7b0f9a832e2fed544b2698cc3034cb2cfd8543f067e5c47ff5c327b31bef80bb51a47f81e4e4d84d38b39991eb328f056b63b7d44a5f122"
	"05ed9881f1758c979f301e269819d4b4c78eab54ed39953704963704eec1b3a1f4f57f50c3667b7f4a98c495bc21846ebf010af2b046683b53e00bde1cb7f5ab"
)

_iconset=UltraFlatIcons

icon_fix() {
	if [[ ! -d ${1} ]]; then
		warning "${1} doesn't exist"
	else
		# Change current working directory
		cd ${1}
		
		# System tools category fix
		if [[ -d ${1}/categories ]]; then
			ln -fsr ./categories/scalable/preferences-other.svg ./categories/scalable/applications-system.svg
		fi
		
		# Volume icons fix
		ln -fsr ./status/scalable/audio-volume-muted-panel.svg ./status/scalable/audio-volume-muted.svg
		ln -fsr ./status/scalable/audio-output-none-panel.svg ./status/scalable/audio-output-none.svg
		ln -fsr ./status/scalable/audio-volume-low-panel.svg ./status/scalable/audio-volume-low.svg
		ln -fsr ./status/scalable/audio-volume-medium-panel.svg ./status/scalable/audio-volume-medium.svg
		ln -fsr ./status/scalable/audio-volume-high-panel.svg ./status/scalable/audio-volume-high.svg
	
		# Wicd icon fix
		if [[ -d ${1}/apps ]]; then
			mkdir -p ${1}/extras/pixmaps/wicd
			ln -fsr ./apps/scalable/wicd.svg ./extras/pixmaps/wicd/wicd.svg
			ln -fsr ./apps/scalable/wicd-qt.svg ./extras/pixmaps/wicd/wicd-qt.svg
			ln -fsr ./apps/scalable/wicd-gtk.svg ./extras/pixmaps/wicd/wicd-gtk.svg
		fi
	fi
}

package() {
	msg2 "Installing icon theme..."
	mkdir -p ${pkgdir}/usr/share/icons/${_iconset}
	cp -R ${srcdir}/${pkgname}/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ${pkgdir}/usr/share/icons/${_iconset}
	rm -fR ${pkgdir}/usr/share/icons/${_iconset}/status/scalable\ white\ panel status
	
	msg2 "Installing dark icon theme"
	mkdir -p ${pkgdir}/usr/share/icons/${_iconset}Dark
	cp -R ${srcdir}/${pkgname}/{status,index.theme} ${pkgdir}/usr/share/icons/${_iconset}Dark
	rm -fR ${pkgdir}/usr/share/icons/${_iconset}Dark/status/scalable
	mv ${pkgdir}/usr/share/icons/${_iconset}Dark/status/scalable\ white\ panel ${pkgdir}/usr/share/icons/${_iconset}Dark/status/scalable
	patch ${pkgdir}/usr/share/icons/${_iconset}Dark/index.theme < ${srcdir}/index.theme.dark.patch
	
	msg2 "Fixing icons..."
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}Dark
	
	msg2 "Installing license"
	mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
	cp ${srcdir}/${pkgname}/LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}