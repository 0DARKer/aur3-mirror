# Maintainer: Alfredo Ramos <alfredo dot ramos at yandex dot com>

pkgname=ultra-flat-icons
pkgver=1.3
pkgrel=2
pkgdesc="A simple flat icon theme, derived from Flattr icon theme."
arch=(
	"any"
)
url="http://gnome-look.org/content/show.php?content=167477"
license=(
	"CCPL:cc-by-nc-sa-4.0"
)

depends=(
	"xdg-utils"
)
optdepends=()
makedepends=()
provides=(
	"${pkgname}=${pkgver}"
)

install=${pkgname}.install

# Original sources
# https://www.dropbox.com/s/dktl70lh4lnhp0a/ultra-flat-icons.tar.gz
# https://www.dropbox.com/s/zn38tno7mzr2pr1/ultra-flat-icons-orange.tar.gz
# https://www.dropbox.com/s/8n0oft71fkjtmt6/ultra-flat-icons-orange-bright.tar.gz
source=(
	"https://www.dropbox.com/s/o2po6znyvqdrbt4/${pkgname}-${pkgver}.tar.gz"
	"https://www.dropbox.com/s/inik0ctob9ztz1u/${pkgname}-orange-${pkgver}.tar.gz"
	"https://www.dropbox.com/s/8zq7lh78vkxetrn/${pkgname}-orange-bright-${pkgver}.tar.gz"
	"${pkgname}.install"
	"index.theme.patch"
	"dark.index.theme.patch"
	"orange.index.theme.patch"
	"orange-dark.index.theme.patch"
	"orange-bright.index.theme.patch"
	"orange-bright-dark.index.theme.patch"
)
sha512sums=(
	"827965b16053ecc903289dd9aeb36f5590c6b914bcef94c6c4904082bcc54d7371dbf81f98951ee6749c69a4a0fd604a6148e619032d4a4d27d334da104c6934"
	"b182f8504ae2882d8036f7978f28144ea86fedb35082c8819c62ac15f2cded4e0e3cde44c9d221c805ec8186d64c73bcddab0712652675333140183cfe7aa947"
	"58373ff039ebc6021eaa8586625b6882a3833e869d0823c7df36d3de42a0843506d31a22a4014c439af591820be6760d2bc71adc866b24a90c803145b49efac6"
	"a0541e26d5f2ebac26a668faf3ba8ccdec0860aaebb14d0aa6b31d23fb9c08cc6719e6cef75f872866311ac0082a3f6dcc3921a26084da7fe5a1ebfa74a7a2f5"
	"7ddc033e356e8db98075d7e6043ceffb9399af1588ef0ac0db4131a0196ba1ac344abb30b8cc80fd08cbc7a65d50c1f3a80dbd92853ad04c914a5f157afc8467"
	"3a8c48e3255aef9c60ee24b3b0a17c6ec22eb2862b87036b68304c1b6106cd6f956d74d9f9bcc7a336cac602a565fd52d2cdb270cdb62d99b9b4b869ef722c8b"
	"177c1450088637ff5436f5c5825c14aa49a51aaa4cc7c6a884bd4fb21916d2a154cc48cdc8493d87d4be1babbf3b400c5f287331717ef704da19358d16095c46"
	"147a395229893925dc242aec34254e5c98658fca94ac081bf43b6a109abb48772b75f398ea993f16182b4e6a95b34d5f600c8b3b9f35ba14065c447fee58e2cc"
	"8e3280c0318cdb5869303f002ec7e826c637335d78cba1472f813e2b6d855720d4c5f920c913c021dc1082fad4266ad66e91325e13eff306f5cf7d3092cde16c"
	"07752287a774fcb96e3ef89758abea12553e6adae37c1d10fe4b4de9f85034c4de743974383164fb0cc5328305bae23dec8332f9229a0e962e35cbefbc36dfaa"
)

_iconset=UltraFlatIcons

icon_fix() {
	# Check if dir exists
	if [[ ! -d ${1} ]]; then
		warning "${1} doesn't exist"
	else
		# Change current working directory
		cd ${1}
		
		# App icons fix
		if [[ -d ${1}/apps ]]; then
			# AMD Catalyst icons fix
			ln -fsr ./apps/scalable/amd.svg ./apps/scalable/ccc_large.svg
			
			# Wicd icon fix
			mkdir -p ${1}/extras/pixmaps/wicd
			ln -fsr ./apps/scalable/wicd.svg ./extras/pixmaps/wicd/wicd.svg
			ln -fsr ./apps/scalable/wicd-qt.svg ./extras/pixmaps/wicd/wicd-qt.svg
			ln -fsr ./apps/scalable/wicd-gtk.svg ./extras/pixmaps/wicd/wicd-gtk.svg
		fi
		
		# Categories icons fix
		if [[ -d ${1}/categories ]]; then
			# System tools category fix
			ln -fsr ./categories/scalable/preferences-other.svg ./categories/scalable/applications-system.svg
		fi
		
		# Places icons fix
		if [[ -d ${1}/places ]]; then
			# Symbolic links fix
			ln -fsr ./places/scalable/folder-music.svg ./places/scalable/library-music.svg
			ln -fsr ./places/scalable/folder-favorites.svg ./places/scalable/folder-important.svg
		fi
		
		# Status icons fix
		if [[ -d ${1}/status ]]; then
			# Volume icons fix
			ln -fsr ./status/scalable/audio-volume-muted-panel.svg ./status/scalable/audio-volume-muted.svg
			ln -fsr ./status/scalable/audio-output-none-panel.svg ./status/scalable/audio-output-none.svg
			ln -fsr ./status/scalable/audio-volume-low-panel.svg ./status/scalable/audio-volume-low.svg
			ln -fsr ./status/scalable/audio-volume-medium-panel.svg ./status/scalable/audio-volume-medium.svg
			ln -fsr ./status/scalable/audio-volume-high-panel.svg ./status/scalable/audio-volume-high.svg
		fi
		
		# Permissions fix
		find . -type f -exec chmod 0644 {} \;
		find . -type d -exec chmod 0755 {} \;
	fi
}

package() {
	# Base directory 
	mkdir -p ${pkgdir}/usr/share/icons
	cd ${pkgdir}/usr/share/icons
	
	msg2 "Installing icon theme..."
	mkdir ${_iconset}
	cp -a ${srcdir}/${pkgname}/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ./${_iconset}
	rm -fR ./${_iconset}/status/scalable\ white\ panel status
	patch ./${_iconset}/index.theme < ${srcdir}/index.theme.patch
	
	msg2 "Installing dark icon theme..."
	mkdir ${_iconset}Dark
	cp -a ${srcdir}/${pkgname}/{status,index.theme} ./${_iconset}Dark
	rm -fR ./${_iconset}Dark/status/scalable
	mv ./${_iconset}Dark/status/scalable\ white\ panel ./${_iconset}Dark/status/scalable
	patch ./${_iconset}Dark/index.theme < ${srcdir}/dark.index.theme.patch
	
	msg2 "Installing icon theme orange folders..."
	mkdir ${_iconset}Orange
	cp -a ${srcdir}/${pkgname}-orange/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ./${_iconset}Orange
	rm -fR ./${_iconset}Orange/status/scalable\ white\ panel status
	patch ./${_iconset}Orange/index.theme < ${srcdir}/orange.index.theme.patch
	
	msg2 "Installing dark icon theme orange folders..."
	mkdir ${_iconset}OrangeDark
	cp -a ${srcdir}/${pkgname}-orange/{status,index.theme} ./${_iconset}OrangeDark
	rm -fR ./${_iconset}OrangeDark/status/scalable
	mv ./${_iconset}OrangeDark/status/scalable\ white\ panel ./${_iconset}OrangeDark/status/scalable
	patch ./${_iconset}OrangeDark/index.theme < ${srcdir}/orange-dark.index.theme.patch
	
	msg2 "Installing icon theme bright orange folders..."
	mkdir ${_iconset}OrangeBright
	cp -a ${srcdir}/${pkgname}-orange-bright/{actions,apps,categories,devices,emblems,mimetypes,places,status,index.theme} ./${_iconset}OrangeBright
	rm -fR ./${_iconset}Orange/status/scalable\ white\ panel status
	patch ./${_iconset}OrangeBright/index.theme < ${srcdir}/orange-bright.index.theme.patch
	
	msg2 "Installing dark icon theme bright orange folders..."
	mkdir ${_iconset}OrangeBrightDark
	cp -a ${srcdir}/${pkgname}-orange-bright/{status,index.theme} ./${_iconset}OrangeBrightDark
	rm -fR ./${_iconset}OrangeBrightDark/status/scalable
	mv ./${_iconset}OrangeBrightDark/status/scalable\ white\ panel ./${_iconset}OrangeBrightDark/status/scalable
	patch ./${_iconset}OrangeBrightDark/index.theme < ${srcdir}/orange-bright-dark.index.theme.patch
	
	msg2 "Fixing icons..."
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}Dark
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}Orange
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}OrangeDark
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}OrangeBright
	icon_fix ${pkgdir}/usr/share/icons/${_iconset}OrangeBrightDark
	
	msg2 "Installing license..."
	mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
	cp ${srcdir}/${pkgname}/LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}