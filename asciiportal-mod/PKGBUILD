# Maintainer: Baptiste Jonglez <zerstorer at free dot fr>
# Contributor: Serge Ziryukin <ftrvxmtrx@gmail.com>
pkgname=asciiportal-mod
pkgver=1.2c
pkgrel=1
pkgdesc="Text based puzzle game inspired by the popular video game. Modified version that fixes some bugs and adds new features (recursive drawing of portals, ...)."
arch=('i686' 'x86_64')
url="http://cymonsgames.com/forum/index.php?topic=7.msg2443#msg2443"
license=('MIT')
depends=('sdl' 'sdl_mixer' 'pdcurses')
makedepends=('unzip')
conflicts=('asciiportal')
source=("http://cymonsgames.com/games/asciiportal/asciiportal$pkgver-src.zip"
  "asciiportal"
  "asciiportal.patch"
  # This patch was built from the contribution of ivanq (see $url)
  "asciiportal-mod.patch"
  # This one is from me (it fixes resolution choice on command line)
  "asciiportal-res.patch"
  # This fixes the location of saved progress and custom maps
  "asciiportal-save.patch")
md5sums=('6b353a65ac4590bf2eabf5d06dde7473'
         'd6e8518f4b05e5d0cdc7f9b47fd96a83'
         '9fe6f628982e965d0ccc1e9580171dd6'
         '483795487e421986f35fcc4b55297cef'
         '5b9f38e7847b6de44fbe850e6792c435'
         '17c15e2af1e4ae7c0da12bab412c8538')

build() {
  cd $srcdir/

  patch -Np0 -i "$srcdir/asciiportal.patch"
  patch -Np1 -i "$srcdir/asciiportal-res.patch"
  patch -Np1 -i "$srcdir/asciiportal-mod.patch"
  patch -Np1 -i "$srcdir/asciiportal-save.patch"
  
  make -f ASCIIpOrtal-linux-Makefile.txt || return 1

  install -d $pkgdir/opt/asciiportal
  install -D ASCIIpOrtal $pkgdir/opt/asciiportal
  install -D readme.txt $pkgdir/usr/share/doc/asciiportal/README
  install -D $startdir/asciiportal $pkgdir/usr/bin/asciiportal
  cp -r challengeme evil maps masterlevels media raisonbran648 $pkgdir/opt/asciiportal
  chmod -x $pkgdir/opt/asciiportal/*/*
}
