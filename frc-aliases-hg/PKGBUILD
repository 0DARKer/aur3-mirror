# Maintainer: Alex Brinister <alex_brinister at yahoo dot com>
pkgname=frc-aliases-hg
pkgver=1.0
pkgrel=1
pkgdesc="Some aliases for the main VxWorks 6.3 GCC compiler"
arch=('any')
url="http://firstforge.wpi.edu/sf/wiki/do/viewPage/projects.c--11_toochain/wiki/HomePage"
license=('GPL')
makedepends=('mercurial')
provides=('frc-aliases')
conflicts=('frc-gcc-tools')
noextract=()

_hgroot='https://bitbucket.org/frc-cpp11/'
_hgrepo='frc-aliases'

pkgver() {
  cd "$srcdir"/"$pkgname"
  hg identify -ni | awk 'BEGIN{OFS=".";} {print $2,$1}'
}

build() {
  cd "$srcdir"
  msg "Connecting to Mercurial server...."

  if [[ -d "$_hgrepo" ]]; then
    cd "$_hgrepo"
    hg pull -u
    msg "The local files are updated."
  else
    hg clone "$_hgroot""$_hgrepo"
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_hgrepo-build"
  cp -r "$srcdir/$_hgrepo" "$srcdir/$_hgrepo-build"
}

package() {
  cd "$srcdir/$_hgrepo-build"
  make DESTDIR="$pkgdir" install
  find "$pkgdir" -type d -name ".git" -exec rm -r '{}' +
}

# vim:set ts=2 sw=2 et:
