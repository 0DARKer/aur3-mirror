# Maintainer: Andrew de Quincey <adq@lidskialf.net>
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: Allan Henriksen <allan.henriksen@gmail.com>

pkgname=ipsec-tools-checkpoint
pkgver=0.7.3
pkgrel=3
pkgdesc="KAME IPSec tools ported to Linux with support for Checkpoint VPN-1 Proprietary XAUTH authentication"
arch=('i686' 'x86_64')
url="http://ipsec-tools.sourceforge.net/"
depends=('readline' 'openssl')
license=('GPL')
options=('!makeflags' '!libtool')
source=(http://downloads.sourceforge.net/sourceforge/ipsec-tools/ipsec-tools-$pkgver.tar.bz2
	racoon.rc
	ipsec.rc
	ipsec-tools-0.7.3-checkpoint-v1.patch
	racoon-check_rtsock_sleep_workaround.patch)
md5sums=('821bd84e8d4ad5a93bf594b8b3d66e1e'
         'a9d89177f0eecd1df4fbe21c201ee046'
         '90d0810267cbd847383ae3101699b192'
	 'd2fc5beffff86a1215f55d528f8fff2c'
	 '5c253dd9618206d9e4a14d4eadb68b8b')

build() {
  cd $srcdir/ipsec-tools-$pkgver
  patch -p1 < $startdir/ipsec-tools-0.7.3-checkpoint-v1.patch
  patch -p1 < $startdir/racoon-check_rtsock_sleep_workaround.patch
  sed -i 's#-Werror##' configure
  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	--enable-security-context=no --enable-hybrid --enable-dpd --enable-natt \
	--enable-adminport
  make
  make DESTDIR=$pkgdir install
  install -Dm0755 $srcdir/racoon.rc $pkgdir/etc/rc.d/racoon
  install -Dm0755 $srcdir/ipsec.rc $pkgdir/etc/rc.d/ipsec
}
