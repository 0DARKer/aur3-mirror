# Contributor: marcus fritzsch <fritschy@googlemail.com>

pkgname=soxt
pkgver=1.2.2
pkgrel=2
pkgdesc="Coin3D is a high-level 3D graphics toolkit on top of OpenGL."
url="http://www.coin3d.org/"
license="GPL"
depends=('coin' 'libxi' 'libxmu' 'libxpm' 'lesstif')
makedepends=('gcc' 'doxygen' 'coin')
conflicts=()
provides=()
replaces=()
backup=()
install=
source=("http://ftp.coin3d.org/coin/src/all/SoXt-$pkgver.tar.gz" 00_linkage.patch)
md5sums=('25f7d18998e6cc1403e0f3ae0c235500' '7cd3792d0f38520a3add48263cb47f8c')

build() {
  cd $startdir/src

  # fix linkage errors
  cd SoXt-$pkgver && patch -p1 < $startdir/00_linkage.patch && cd .. || return 1

  export CXXFLAGS="-O3 -march=i686 -funroll-loops -fomit-frame-pointer -pipe"
  export CFLAGS="$CXXFLAGS"

  mkdir build
  cd build
  ../SoXt-$pkgver/configure --prefix=/usr --enable-optimization \
    --enable-threadsafe --enable-html --enable-man --enable-exceptions \
    --disable-debug --disable-maintainer-mode --disable-dependency-tracking \
    --enable-shared --disable-static

  make DESTDIR=$startdir/pkg install || return 1
  rm -f $startdir/pkg/usr/lib/libSoXt.la

  cd $startdir/pkg/usr/man/man3
  rm _*
  for i in *.3; do
    awk '{ if (NR==1) sub(" 3 ", " 3iv "); print }' < $i > ${i%3}3iv || return 1
    rm $i || return 1
  done

  unset CFLAGS CXXFLAGS
}
