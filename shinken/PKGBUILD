# Maintainer: Julien "Adyxax" Dessaux <judessaux@gmail.com>
pkgname='shinken'
pkgver='0.4.2'
pkgrel='3'
pkgdesc='Shinken is a new powerful monitoring tool compatible with NagiosÂ® and written in python that enables organizations to identify and resolve IT problems before they impact the business.'
arch=('any')
url='http://www.shinken-monitoring.org/'
license=('GPL3')
groups=()
depends=('python' 'python2')
makedepends=('setuptools')
optdepends=('python-pyro' 'nagios-plugins')
provides=('shinken')
conflicts=()
replaces=()
backup=()
options=()
install=('shinken.install')
changelog=
source=("http://shinken-monitoring.org/pub/$pkgname-$pkgver.tar.gz" 'shinken.install' 'shinken.setup_parameters')
noextract=()
md5sums=('e6763dc8552311dd3d1eb59e8076d4cc'
         '0146f36a0f579c873e5b7cac874906ae'
         '85d8cb4b28662f83df26a3da05e2f4ff')

build() {
  cp -f shinken.setup_parameters "$srcdir/$pkgname-$pkgver/setup_parameters"
  cd "$srcdir/$pkgname-$pkgver"

  find ./ -name '*.py' -exec sed -r 's/^#!\/usr\/bin\/env python2.6$/#!\/usr\/bin\/env python2.7/' -i {} \;
  find ./ -type f -exec sed -r 's/\/etc\/init.d/\/etc\/init.d/' -i {} \;
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  python2 setup.py install --root=$pkgdir/
  mv $pkgdir/etc/init.d $pkgdir/etc/rc.d
  rm $pkgdir/etc/shinken/{brokerd-windows.ini,nagios-windows.cfg,pollerd-windows.ini,schedulerd-windows.ini}
  rm $pkgdir/var/lib/shinken/void_for_git
  mkdir $pkgdir/var/lib/shinken/rw
}

# vim:set ts=2 sw=2 et:
