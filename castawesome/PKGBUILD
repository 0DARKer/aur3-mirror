# Maintainer: Alex Mason <alex@judgementstudios.com>
# Contributor: Andy Weidenbaum <archbaum@gmail.com>

pkgname=castawesome
pkgver=0.14.2
pkgrel=3
pkgdesc="A GUI frontend for ffmpeg livestreaming"
arch=('any')
url="http://sourceforge.net/projects/castawesome/"
license=('GPL3')
depends=('ffmpeg' 'gtk3' 'python2' 'python2-gobject')
source=(http://sourceforge.net/projects/castawesome/files/$pkgname-$pkgver.tar.gz)
sha256sums=('dd56b6a5fc4627b377d23e1d654b9e2a75936597199c16bcdb1ebc1e5099b67f')

prepare() {
  cd $srcdir/$pkgname

  msg 'Fixing Makefile...'
  sed -i 's#cp castawesome.py#install -Dm 755 castawesome.py#' Makefile
  sed -i 's#/usr/local#$(DESTDIR)/usr#g' Makefile
  sed -i 's#/usr/local#/usr#' castawesome.py
  sed -i 's#/usr/local#/usr#' uninstall_castawesome.sh
}

build() {
  cd $srcdir/$pkgname

  msg 'Building...'
  make
}

package() {
  cd $srcdir/$pkgname

  msg 'Installing...'
  install -dm 755 $pkgdir/usr/share/castawesome
  make DESTDIR="$pkgdir" install

  msg 'Cleaning up pkgdir...'
  rm -rf $pkgdir/usr/share/applications
  find "$pkgdir" -type d -name .git -exec rm -r '{}' +
}
