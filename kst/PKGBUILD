# Maintainer: Maximilian Stein <maxarchpkgbuild@hmamail.com>
# Contributor: Joshua N. <drmrshdw@gmail.com>
# Contributor: Vit <vitruss@gmail.com>
# Contributor: Giulio Guzzinati <skarn86junk@gmail.com>

pkgname=kst
pkgver=2.0.7
pkgrel=1
pkgdesc="Fast real-time large-dataset viewing and plotting tool for KDE"
arch=('i686' 'x86_64')
url="http://kst.kde.org"
license=('GPL')
depends=('gsl' 'qt4' 'muparser' 'python2-scipy' 'cfitsio')
makedepends=('cmake' 'optipng')
install=$pkgname.install
source=(http://downloads.sourceforge.net/project/kst/Kst%20${pkgver}/Kst-${pkgver}.tar.gz)
sha256sums=('0ef0e1e85fa90472447eb53ee560970635532d2013d200d99ebdd105bd2eecee')

build() {
  cd "$srcdir/$pkgname-$pkgver/src/images"
  optipng -quiet -force -fix hi32-mime-kst.png kst_error_1.png kst_error_2.png kst_eventnew.png kst_imagenew.png kst_pluginnew.png kst.png
  cd "$srcdir/$pkgname-$pkgver"
  sed -i "s/find_package\(PythonLibs REQUIRED\)/SET \(PythonLibs \"\/usr\/lib64\/libpython2.7.so\"\)/" \
  ./cmake/pyKst/CMakeLists.txt
  sed -i "s/python/python2/" \
  ./cmake/pyKst/finddistdir.py
  sed -i "s/\${NUMPY_VERSION_PATCH}/0/" \
  ./cmake/modules/FindNumPy.cmake
  cmake ./cmake \
  -Dkst_release=1 \
  -Dkst_version_string=1 \
  -Dkst_svnversion=0 \
  -Dkst_python=1 \
  -DBUILD_SCI_PY=0 \
  -DBUILD_NUM_PY=0 \
  -DPYTHON_EXECUTABLE=/usr/bin/python2.7 \
  -Dkst_python_prefix=/usr/lib/python2.7 \
  -Dkst_install_prefix=/usr/
}
package() {
  cd "$srcdir/$pkgname-$pkgver"
  make DESTDIR="${pkgdir}" install
}