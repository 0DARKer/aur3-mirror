# Maintainer: Chris Bolton <chris@pixelgen.co>

pkgname=rust
pkgver=0.1
pkgrel=1
arch=('i686' 'x86_64')
pkgdesc='A safe, concurrent, practical language from Mozilla.'
url='http://www.rust-lang.org/'
license=('MIT')
depends=('gcc-libs')
makedepends=('libffi' 'python2') # for llvm
source=("http://dl.rust-lang.org/dist/rust-${pkgver}.tar.gz")
md5sums=('80b655bcceaf2192c502a692c8c1eb20')

build() {
  cd rust-${pkgver}

  # needs llvm >= 3.0svn ...
  # --llvm-root=/usr \ 
  # use ${pkgdir} in --prefix because DESTDIR is unsupported in make install
  ./configure \
    --prefix=${pkgdir}/usr \
    --disable-docs

  msg 's/python$/python2/'
  find . -executable -exec grep -qe 'env python$' '{}' ';' -exec sed -i 's/env python$/env python2/' '{}' ';' -print

  make
}

package() {
  cd rust-${pkgver}

  make install

  install -d ${pkgdir}/usr/share/licenses/rust
  install -m644 LICENSE.txt \
    ${pkgdir}/usr/share/licenses/rust
}
