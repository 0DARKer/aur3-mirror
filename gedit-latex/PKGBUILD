# Maintainer: Gen Zhang <genneth@gmail.com>
pkgname=gedit-latex
pkgver=3.2.0
pkgrel=1
pkgdesc=""
arch=('i686' 'x86_64')
url="http://projects.gnome.org/gedit"
license=('GPL')
groups=()
depends=(gedit rubber texlive-core python-gobject)
makedepends=(cairo gettext atk intltool libpeas gtk3 glib2)
provides=()
conflicts=(gedit-latex-plugin)
replaces=(gedit-latex-plugin)
install=gschemas.install
source=(http://ftp.gnome.org/pub/gnome/sources/gedit-latex/3.2/$pkgname-$pkgver.tar.xz)
md5sums=('2d258d9c45e5876538d317b13c3cb1e5')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  
  # fixes taken from the fedora package
  sed -i -e 's|_CONFIG_FILENAME = "/etc/texmf/texmf.cnf"|_CONFIG_FILENAME = "/usr/share/texmf/web2c/texmf.cnf"|' latex/latex/environment.py
  sed -i -e 's|_DEFAULT_TEXMF_DIR = "/usr/share/texmf-texlive"|_DEFAULT_TEXMF_DIR = "/usr/share/texmf"|' latex/latex/environment.py
  
  # no gnome-open, use xdg-open instead
  sed -i -e 's:gnome-open:xdg-open:g' latex/latex/views.py
  sed -i -e 's:gnome-open:xdg-open:g' latex/latex/views.py
  sed -i -e 's:gnome-open:xdg-open:g' latex/latex/preview.py
  sed -i -e 's:gnome-open:xdg-open:g' data/tools.xml
    
  PYTHON=/usr/bin/python2 ./configure --prefix=/usr --disable-static
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  make DESTDIR="$pkgdir/" install
}

# vim:set ts=2 sw=2 et:
