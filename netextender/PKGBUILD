# Maintainer: Roman Pearah <roman.pearah@gmail.com>
# Adopted package from
# Contributor: Dan McGee <dan@archlinux.org>

pkgname=netextender
pkgver=7.0.741
pkgrel=1
pkgdesc="SonicWALL SSL VPN Client"
arch=('i686' 'x86_64')
url="http://www.sonicwall.com/us/en/products/324.html"
license=('custom')
depends=('jre7-openjdk' 'net-tools' 'openssl' 'ppp')
source=("https://dl.dropboxusercontent.com/u/32153964/NetExtender.Linux.$pkgver.zip")
install="netextender.install"
md5sums=('c01da4cc51572d86e81e440dad04c96b')
sha256sums=('0d10a946c78524ff21c85c6107bd10d9aba596c55b5c9004fc70c62cec484274')

prepare() {
  cd "$srcdir"

  msg "Using arch $CARCH"
  [[ $CARCH == 'i686' ]] && bsdtar xf NetExtender.Linux.$pkgver.i386.tgz
  [[ $CARCH == 'x86_64' ]] && bsdtar xf NetExtender.Linux.$pkgver.x86_64.tgz
}

package() {
  cd "$srcdir/netExtenderClient"

  msg "Installing..."
  
  mkdir -p "$pkgdir/usr/share/netExtender/icons"

  install -D -m 644 sslvpn "$pkgdir/etc/ppp/peers/sslvpn"
  install -D -m 755 netExtender "$pkgdir/usr/sbin/netExtender"
  install -D -m 755 netExtenderGui "$pkgdir/usr/bin/netExtenderGui"
  install -D -m 744 nxMonitor "$pkgdir/usr/sbin/nxMonitor"
  install -D -m 4755 uninstallNetExtender "$pkgdir/usr/sbin/uninstallNetExtender"

  install -D -m 757 sslvpnroute "$pkgdir/etc/ppp/ip-up.d/sslvpnroute"
  install -D -m 757 sslvpnroute6 "$pkgdir/etc/ppp/ipv6-up.d/sslvpnroute6"
  mkdir -p "$pkgdir/etc/ppp/ip-down.d"
  mkdir -p "$pkgdir/etc/ppp/ipv6-down.d"
  touch "$pkgdir/etc/ppp/ip-down.d/sslvpnroutecleanup"
  touch "$pkgdir/etc/ppp/ipv6-down.d/sslvpnroute6cleanup"
  chmod 757 "$pkgdir/etc/ppp/ip-down.d/sslvpnroutecleanup"
  chmod 757 "$pkgdir/etc/ppp/ipv6-down.d/sslvpnroute6cleanup"
  ln -s sslvpnroute "$pkgdir/etc/ppp/ip-up.d/sslvpnroute.sh"
  ln -s sslvpnroute6 "$pkgdir/etc/ppp/ipv6-up.d/sslvpnroute6.sh"
  ln -s sslvpnroutecleanup "$pkgdir/etc/ppp/ip-down.d/sslvpnroutecleanup.sh"
  ln -s sslvpnroutecleanup6 "$pkgdir/etc/ppp/ipv6-down.d/sslvpnroute6cleanup.sh"

  install -D -m 007 sslvpn.pid "$pkgdir/etc/ppp/sslvpn.pid"
  install -D -m 007 sslvpn.pid2 "$pkgdir/etc/ppp/sslvpn.pid2"
  install -D -m 644 netExtender.1 "$pkgdir/usr/share/man/man1/netExtender.1"
  install -D -m 755 libNetExtender.so "$pkgdir/usr/lib/libNetExtender.so"
  install -D -m 644 ca-bundle.crt "$pkgdir/usr/share/netExtender/ca-bundle.crt"

  install -D -m 644 NetExtender.jar "$pkgdir/usr/lib/NetExtender.jar"
  install -D -m 644 icons/* "$pkgdir/usr/share/netExtender/icons"
  install -D -m 664 NetExtender.desktop "$pkgdir/usr/share/netExtender/NetExtender.desktop"
  install -D -m 664 NetExtender.desktop "$pkgdir/usr/share/applications/sonicwall-netextender.desktop"

  chown -f root "$pkgdir/usr/share/applications/sonicwall-netextender.desktop"
  chgrp -f root "$pkgdir/usr/share/applications/sonicwall-netextender.desktop"
  chmod -f 644 "$pkgdir/usr/share/applications/sonicwall-netextender.desktop"
}
