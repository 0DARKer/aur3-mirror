# Maintainer: Chipster Julien <julien dot chipster @ archlinux dot fr>

pkgname=go-mailmotiond
pkgver=0.1
pkgrel=1
pkgdesc="Send mail when motion save a picture written in Go"
arch=('any')
url="https://github.com/Chipsterjulien/go-mailmotiond"
license=('WTFPL')
makedepends=('go' 'git')
options=('!strip' '!emptydirs')
conflit=('mailmotiond')
backup=('etc/mailmotiond/mailmotiond.conf')
source=("$pkgname-$pkgver.tar.gz")
install=go-mailmotiond.install
sha256sums=('e5ad3efd3206373c3b4480c9840546d3d7ffb39a22edb5be0e5024f0d08fe324')

build() {
  GOPATH_exist=1
  if [ -z $GOPATH ]; then
    # path don't exit
    GOPATH_exist=0

    # create gopath directory
    mkdir -p .gopath/{bin,src}
    # export var
    export GOPATH=~/.gopath
  fi

  # Getting some lib
  go get github.com/scorredoira/email
  go get bitbucket.org/zombiezen/cardcpx/natsort
  go get github.com/vaughan0/go-ini

  cd "$pkgname-$pkgver"

  go build

  if [ $GOPATH_exist == 0 ]; then
    rm -rf ~/.gopath
    export GOPATH=
  fi
}

package() {
  cd "$pkgname-$pkgver"

  # install -Dm755 "$pkgname-$pkgver" "$pkgdir/usr/bin/$pkgname"
  # install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -Dm755 "$pkgname-$pkgver" "$pkgdir/usr/bin/mailmotiond"
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/mailmotiond/LICENSE"
}

# vim:set ts=2 sw=2 et:
