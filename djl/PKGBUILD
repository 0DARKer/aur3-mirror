# Maintainer: Gadget3000 <gadget3000 at msn dot com>
# Contributor: Eric Forgeot < http://ifiction.free.fr >
# Contributor: Diablo150 < www.djl-linux.org >

pkgname=djl
pkgver=1.2.20
pkgrel=2
pkgdesc="A game manager, inspired by Steam, which can download, install and remove a large number of games"
arch=('any')
url="http://www.djl-linux.org/"
license=('GPL')
depends=('python2' 'python2-qt' 'python2-feedparser')
source=(http://www.djl-linux.org/maj_djl/Paquets-Arch/${pkgname}-${pkgver}-Arch.tar.gz)
md5sums=('51ae181e22f09bf91b20b0a1bde06b69')

build() {
        cd $srcdir/$pkgname
        mkdir -p $pkgdir/usr/share/djl
        mkdir -p $pkgdir/usr/bin/
        cp -fr $srcdir/$pkgname/* $pkgdir/usr/share/djl
        chmod +x $pkgdir/usr/share/djl/djl.sh
        echo "/usr/share/djl/djl.sh" > $pkgdir/usr/bin/djl
        chmod +x $pkgdir/usr/bin/djl

	#patch djl to work with python2
	for i in $(find $pkgdir | grep "\.py"); do
		sed "s/\#\!\/usr\/bin\/python/\#\!\/usr\/bin\/python2/" -i $i
		sed "s/\#\! \/usr\/bin\/env python/\#\! \/usr\/bin\/env python2/g" -i $i
		sed "s/\#\!\/usr\/bin\/env python/\#\!\/usr\/bin\/env python2/g" -i $i

		sed "s/\/usr\/bin\/python2.6/\/usr\/bin\/python2.7/g" -i $i
		sed "s/commande_python = \"python2.6\"/commande_python = \"python2.7\"/g" -i $i

		sed "s/os.system('python djl.py')/os.system('python2 djl.py')/g" -i $i
	done
	sed "s/python/python2/g" -i $pkgdir/usr/share/djl/djl.sh
}
