# Contributor: tocer <tocer.deng@gmail.com>

pkgname=blogpost-hg
pkgver=78
pkgrel=1
pkgdesc="a WordPress command-line weblog"
url="http://srackham.wordpress.com/blogpost1"
license=("MIT")
arch=("i686" "x86_64")
depends=('asciidoc' 'python')
makedepends=("mercurial")
conflicts=("blogpost")
install=blogpost.install
_hgroot="http://hg.sharesource.org"
_hgrepo="blogpost"
md5sums=()

build() {
  cd ${srcdir}
  
  if [ -d ${_hgrepo} ]; then
    cd ${_hgrepo}
    make clean
    hg pull -u
  else
    hg clone ${_hgroot}/${_hgrepo}
    cd ${_hgrepo}
  fi
  
  msg "Starting build process."
  DSTDIR=$pkgdir/usr/share/blogpost 
  install -Dm0755 blogpost.py $DSTDIR/blogpost.py
  install -Dm0644 asciidocapi.py $DSTDIR/asciidocapi.py
  install -Dm0644 wordpresslib.py $DSTDIR/wordpresslib.py
  install -Dm0644 conf/blogpost_example.conf $DSTDIR/blogpost_example.conf

  msg "Generating manpage."
  a2x -f manpage doc/blogpost.1.txt

  install -dm0755 $pkgdir/usr/bin
  ln -s /usr/share/blogpost/blogpost.py $pkgdir/usr/bin/blogpost
}
