# Maintainer: leepesjee <lpeschier at xs4all.nl>
pkgname=aqualung-svn
pkgver=1267
pkgrel=1
pkgdesc="Gapless audio player with jack, alsa and oss support"
arch=('i686' 'x86_64')
url="http://aqualung.factorial.hu/"
license=('GPL')
depends=('gtk2' 'libxml2')
makedepends=('subversion' 'gettext')
optdepends=('oss: support for the Open Sound System'
            'jack-audio-connection-kit: support for jack'
            'pulseaudio: support for pulseaudio')
conflicts=('aqualung')
provides=('aqualung')
source=(aqualung.desktop
        av_open_input.patch
        cdda.patch)
md5sums=('1c726a4936a3275e66eca26c95d821fa'
         '1f475b17da340744784b9bc44492cf27'
         'a59a90dad34fc8cbbee79da6297a7a80')

_svntrunk=https://aqualung.svn.sourceforge.net/svnroot/aqualung/trunk
_svnmod=aqualung

build() {
  cd ${srcdir}
  msg "Connecting to SVN server...."
 
  if [[ -d "$_svnmod/.svn" ]]; then
    (cd "$_svnmod" && svn up -r "$pkgver")
  else
    svn co "$_svntrunk" --config-dir ./ -r "$pkgver" "$_svnmod"
  fi
  
  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_svnmod-build"
  svn export "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
  cd "$srcdir/$_svnmod-build"
  
  patch -Np0 -i ../cdda.patch
  patch -Np0 -i ../av_open_input.patch
  
  # remove annoying "http://" preset at 'Add URL'
  sed -i 's|(url_entry), "http://"|(url_entry), ""|' ./src/playlist.c

  ./autogen.sh
  ./configure --enable-debug LDFLAGS="-lm" --prefix=/usr
  make
}
  
  package() {
  cd "$srcdir/$_svnmod-build"
  make DESTDIR="$pkgdir/" install
  install -D -m644 src/img/icon_64.png $startdir/pkg/usr/share/pixmaps/aqualung.png
  install -D -m644 ${startdir}/aqualung.desktop $startdir/pkg/usr/share/applications/aqualung.desktop
}

# vim:set ts=2 sw=2 et:
