# Contributor: twa022 <twa022 at gmail dot com>

pkgname=screenlets-bzr
pkgver=903
pkgrel=1
pkgdesc="Small owner-drawn applications (Actual screenlets only)"
arch=('i686' 'x86_64')
url="https://launchpad.net/indiv-screenlets"
license=('GPL')
depends=('screenlets-framework-bzr')
makedepends=('bzr' 'python2-distribute')
conflicts=('circleclock-screenlet' 'digitalclock-screenlet' 'diskspace-screenlet' 
          'folderview-screenlet' 'google-calendar-screenlet' 'pidgin-screenlet')
provides=('circleclock-screenlet' 'digitalclock-screenlet' 'diskspace-screenlet' 
          'folderview-screenlet' 'google-calendar-screenlet' 'pidgin-screenlet')
source=('setup.patch')
optdepends=('tomboy:              Tomboy Screenlet'
            'python-gdata:        Google Calendar Screenlet'
            'python2-gtkmozembed: Google Maps / Webframe Screenlet'
            'gnome-menus:         Main Menu Screenlet'
            'python-imaging:      Wallpaper Clock / Photo Wall / Slide Show Screenlets'
            'python2-feedparser:  Feed Reader Screenlet'
            'dropbox:             Dropbox Screenlet'
            'python2-pytz:        FreeMeteo Screenlet'
            'python2-numpy:       Lipik Screenlet'
            'nvidia-settings:     NVIDIA Screenlet'
            'pidgin:              Pidgin Screenlet'
            'mplayer:             Mplayer Screenlet'
            'orca:                Speech Screenlet'
            'python-twitter:      Twitter Screenlet'
            'python-evolution:    Evolution Contacts Screenlet'
            'alsa-utils:          Volume Control Screenlet')

_bzrtrunk=https://code.launchpad.net/~indiv-screenlets-dev/indiv-screenlets/trunk
_bzrmod=$pkgname

md5sums=()

build() {
  cd ${srcdir}
  msg "Connecting to the server...."
  if [ ! -d ./$_bzrmod ]; then
    bzr co $_bzrtrunk $_bzrmod -r $pkgver
  else
    bzr up $_bzrmod
  fi
  msg "BZR checkout done or server timeout"
  msg "Starting make..."
  [ -d ./$_bzrmod-build ] && rm -rf ./$_bzrmod-build
  cp -r ./$_bzrmod ./$_bzrmod-build
  cd ./$_bzrmod-build
  patch -Np1 -i ${srcdir}/setup.patch
  mv "$srcdir/$_bzrmod-build/src/Lyrics/Quodlibet plugin" "$srcdir/$_bzrmod-build/src/Lyrics/Quodlibet"
  python2 setup.py install --root=$pkgdir
  for _file in $( find ${pkgdir}/usr/share/screenlets -name "*.py" ) ; do 
    sed -i 's:exec python:&2:g' ${_file}
    sed -i 's:/usr/bin/env python:&2:g' ${_file}
    sed -i 's:/usr/bin/python:&2:g' ${_file}
  done
}

md5sums=('db26c665d65434f50b8a2b43559df77a')
