# Maintainer: Tianjiao Yin <ytj000+aur@gmail.com>

_plugin_name=bloomind-ft-deepdark
_plugin_version=2.6.3.1
_plugin_id=295337
pkgdesc="Smooth dark theme for Firefox."
license=('unknown')
_download_url=https://addons.mozilla.org/firefox/downloads/file/133243/bloomind_ft_deepdark_2-2.5-fx-linux.jar

pkgname=firefox-theme-$_plugin_name
pkgver=$_plugin_version
pkgrel=1
arch=('any')
url="https://addons.mozilla.org/firefox/addon/$_plugin_id"
depends=("firefox")

build() {
  _ffver=`pacman -Q firefox | cut -f2 -d\ | cut -f1-2 -d.`
  depends=("firefox>=${_ffver}" "firefox<=${_ffver/0/99}")

  cd $srcdir
  rm * -rf
  wget $_download_url -O addon-$_plugin_id-latest.jar
  bsdtar -xf addon-$_plugin_id-latest.jar
  emid=$(sed -n '/.*<em:id>\(.*\)<\/em:id>.*/{s//\1/p;q}' install.rdf) || return 1
  local dstdir=$pkgdir/usr/lib/firefox-$_ffver/extensions/${emid}
  install -d $dstdir
  sed -i 's#<em:maxVersion>.*</em:maxVersion>#<em:maxVersion>7.*</em:maxVersion>#' install.rdf
  rm addon-$_plugin_id-latest.jar
  cp -R * $dstdir
}
