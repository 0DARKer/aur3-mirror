# Maintainer: fxbru <frxbru[at]gmail>

pkgname=sqlmap-git
_gitname='sqlmap'
pkgver=0.9.3100.g8b64709
pkgrel=1
pkgdesc='Automatic SQL injection and database takeover tool'
arch=('any')
url=('http://sqlmap.org')
license=('GPLv2')
depends=('python2')
provides=('sqlmap')
conflicts=('sqlmap' 'sqlmap-svn')
makedepends=('git')
options=('!strip')
source=('git://github.com/sqlmapproject/sqlmap.git')
md5sums=('SKIP')

pkgver() {
  cd $_gitname
  git describe --always | sed 's|-|.|g'
}

package() {
  cd $_gitname
  # Delete VCS directories and files
  rm -fr .git .gitignore
  # Create an indirect launcher in /usr/bin
  mkdir -p $pkgdir/usr/bin
  cat > $pkgdir/usr/bin/sqlmap << EOF
#!/bin/bash
cd /opt/sqlmap
python2 sqlmap.py \$@
cd \$OLDPWD
EOF
  chmod 755 $pkgdir/usr/bin/sqlmap
  # Move files in /opt    
  mkdir -p $pkgdir/opt
  mv $srcdir/$_gitname $pkgdir/opt/sqlmap
}
