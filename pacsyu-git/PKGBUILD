# Maintainer: Alfonso Saavedra "Son Link" <sonlink.dourden@gmail.com>
pkgname=pacsyu-git
_pkgname=pacsyu
pkgver=20110902
pkgrel=1
pkgdesc="Update notifier based on python2 and GTK2"
arch=(any)
url="http://sonlinkblog.blogspot.com/p/pacsyu.html"
license=('GPL3')
groups=()
depends=('vte' 'python2' 'pygtk' 'python-notify' 'sudo')
makedepends=('git')

_gitroot="git://github.com/son-link/PacSyu.git"
_gitname="PacSyu"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"
	
  mkdir -p $pkgdir/usr/share/$_pkgname
  mkdir -p $pkgdir/usr/bin
  mkdir -p $pkgdir/usr/share/locale
	
  install -m755 $_pkgname.py $pkgdir/usr/bin/$_pkgname
  sed -i "s/lang/\/usr\/share\/locale/g" $pkgdir/usr/bin/$_pkgname
  sed -i "s/modules/\/usr\/share\/$_pkgname/g" $pkgdir/usr/bin/$_pkgname
  sed -i "s/self\.set_from_file('/self\.set_from_file('\/usr\/share\/$_pkgname\//g" $pkgdir/usr/bin/$_pkgname
  sed -i "s/COPYING/\/usr\/share\/$_pkgname\/COPYING/g" $pkgdir/usr/bin/$_pkgname

  cp modules/* *.svg COPYING CHANGELOG README $pkgdir/usr/share/$_pkgname/
  sed -i "s/statusicon('/statusicon('\/usr\/share\/$_pkgname\//g" $pkgdir/usr/share/$_pkgname/gui.py

  cp lang/* -r $pkgdir/usr/share/locale/
	
}
