# Maintainer: Alfonso Saavedra "Son Link" <sonlink.dourden@gmail.com
pkgname=pacsyu-git
_pkgname=pacsyu
pkgver=20110605
pkgrel=1
pkgdesc="Update notifier based on python2 and GTK2"
arch=(any)
url="http://sonlinkblog.blogspot.com/p/pacsyu.html"
license=('GPL')
groups=()
depends=('vte' 'python2' 'pygtk' 'dbus' 'dbus-python' 'python-notify' 'sudo')
source=()
md5sums=()

_gitroot="git://github.com/son-link/PacSyu.git"
_gitname="PacSyu"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"
	
  mkdir -p $pkgdir/usr/share/$_pkgname
  mkdir -p $pkgdir/usr/bin
  mkdir -p $pkgdir/usr/sbin
  mkdir -p $pkgdir/etc/rc.d
  mkdir -p $pkgdir/etc/dbus-1/system.d
	
  install -m755 $_pkgname-client.py $pkgdir/usr/bin/$_pkgname-client
  sed -i "s/self.set_from_file('/self.set_from_file('\/usr\/share\/$_pkgname\//g" $pkgdir/usr/bin/$_pkgname-client
  sed -i "s/COPYING/\/usr\/share\/pacsuy\/COPYING/g" $pkgdir/usr/bin/$_pkgname-client

  install -m755 pacsyud.py $pkgdir/usr/sbin/pacsyud

  cp *.svg COPYING $pkgdir/usr/share/$_pkgname/

  cp pacsyu_rcd $pkgdir/etc/rc.d/pacsyu

  cp $_pkgname.conf $pkgdir/etc/dbus-1/system.d/
	
}
