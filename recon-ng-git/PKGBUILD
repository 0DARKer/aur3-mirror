# Mantainer: Mauro Andreolini <mauro.andreolini@unimore.it>
pkgname=recon-ng-git
_pkgname=recon-ng
pkgver=20130309
pkgrel=1
pkgdesc="A full-featured Web Reconnaisance framework written in Python"
arch=('any')
url="https://bitbucket.org/LaNMaSteR53/recon-ng/overview"
license=('GPL3')
depends=('python2' 'python2-dnspython' 'python2-httplib2' 'python2-oauth2' 'sqlite')
makedepends=('git' 'patch')
conflicts=()
install=
source=("fix-python2-invocation.patch"
)
noextract=()
md5sums=('0099f5cffc7354bf1fd80f492d7bc09a')

_gitroot="https://bitbucket.org/LaNMaSteR53/recon-ng.git"
_gitname="recon-ng"
_libname="recon_ng"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."

  if [ -d ${_gitname}/.git ] ; then
    cd ${_gitname}

    # Change remote url to anongit
    if [ -z $( git branch -v | grep anongit ) ] ; then
      git remote set-url origin ${_gitroot}
    fi

    git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi

  cd ${srcdir}/${_pkgname}
  cat ../fix-python2-invocation.patch | patch -p1 || return 1
}

package(){
  mkdir -p ${pkgdir}/opt/${_pkgname}
  cd ${srcdir}
  cp -a ${_pkgname}/{core,data,libs,modules,README.md,recon-ng.py} ${pkgdir}/opt/${_pkgname}
  find ${pkgdir} -name .git -exec rm -rf '{}' \;
}

# vim:set ts=2 sw=2 et:
