# $Id$
# Maintainer: Sebastien Binet <binet@farnsworth>
pkgname=libkqueue-svn 
pkgver=347
pkgrel=1 
pkgdesc="libkqueue is a portable userspace implementation of the kqueue(2) kernel event notification mechanism"
url="http://mark.heily.com/libkqueue/"
arch=('i686' 'x86_64')
license=('BSD')
depends=('glibc' 'linux-api-headers')
makedepends=('gcc' 'subversion')
conflicts=('libkqueue')
provides=('libkqueue')
backup=()

source=(configure.patch
  libkqueue-license.txt)
md5sums=('36d8d690e40a68966500025898050e1e'
         'e1feaa147250b1581d021efaebd55252')


_svntrunk=svn://mark.heily.com/libkqueue/trunk
_svnmod=$pkgname

build() {
  cd $startdir/src
  /bin/rm -rf ${_svnmod}
  msg "fetching sources from SVN..."
  svn co ${_svntrunk} -r ${pkgver} ${_svnmod} || return 1
  
  cd $startdir/src

  msg "patching 'configure'..."
  patch -p0 < configure.patch || return 1
  cd $startdir/src/$pkgname
  CFLAGS='-fPIC -I./include -I./src/common -Wall -Werror' ./configure --prefix=/usr || return 1
  make || return 1
  make DESTDIR=$startdir/pkg install || return 1

  install -D -m644 $startdir/libkqueue-license.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE

  # remove libtool file
  /bin/rm $startdir/pkg/usr/lib/libkqueue.la

}