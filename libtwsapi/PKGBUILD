# Maintainer: Ben Alex <ben.alex@acegi.com.au>

# See https://github.com/benalexau/libtwsapi-aur for AUR PKGBUILD history

pkgname=libtwsapi
pkgver=9.71.1
pkgrel=1
pkgdesc='Interactive Brokers C++ POSIX library'
arch=('any')
url="http://interactivebrokers.github.io/"
license=('custom')
depends=('gcc-libs')
makedepends=('sed')

source=('Makefile'
        'libtwsapi.pc'
	'http://interactivebrokers.github.io/downloads/twsapi_macunix.971.01.jar')
md5sums=('8cd0cfb5536a10a1119a0233fb690f9e'
         'add2e5a9883eae35b5bcfd3cc72325eb'
         '6b8ed9a34a38d7bab329f2c533d478f3')

build() {
  cd ${srcdir}/IBJts
  cp ../Makefile .
  sed -i '38 i\
    #include <unistd.h>' source/PosixClient/src/EPosixClientSocketPlatform.h
  make
}

package() {
  cd ${srcdir}
  install -Dm644 libtwsapi.pc ${pkgdir}/usr/lib/pkgconfig/libtwsapi.pc
  mkdir -p ${pkgdir}/usr/include/libtwsapi
  cd ${srcdir}/IBJts/source/PosixClient/Shared
  install -m644 *.h ${pkgdir}/usr/include/libtwsapi
  cd ${srcdir}/IBJts/source/PosixClient/src
  install -Dm644 *.h ${pkgdir}/usr/include/libtwsapi
  cd ${srcdir}/IBJts
  install -Dm644 libtwsapi.so ${pkgdir}/usr/lib/libtwsapi.so
}
