pkgname=notion-git
pkgver=20101218
pkgrel=1
pkgdesc="Tabbed tiling, window manager. Fork of Ion3"
url="http://sourceforge.net/projects/notion/"
arch=('i686' 'x86_64')
license=('GPL')
depends=('glib2' 'gettext' 'lua' 'libxext' )
makedepends=('git' 'pkgconfig' )
conflicts=('ion3')
provides=('notion')
source=('system.mk')
md5sums=('d03b01b5437cb3d5a61f79e4372e9948')

_gitroot="git://notion.git.sourceforge.net/gitroot/notion/notion"
_gitname="notion"

_gitroot2="git://notion.git.sourceforge.net/gitroot/notion/libtu"
_gitname2="libtu"

_gitroot3="git://notion.git.sourceforge.net/gitroot/notion/libextl"
_gitname3="libextl"


build() {
    cd ${srcdir}

    msg "Connecting to the git repository..."
    if [ -d ${srcdir}/${_gitname} ]; then
        cd ${_gitname}
        git pull origin
    else
        git clone --depth 1 ${_gitroot}
        cd ${_gitname}
    fi
    
    if [ -d ${srcdir}/${_gitname}/${_gitname2} ]; then
    echo
        git pull origin
    else
        git clone --depth 1 ${_gitroot2}
    fi
    
    if [ -d ${srcdir}/${_gitname}/${_gitname3} ]; then
    echo
        git pull origin
    else
        git clone --depth 1 ${_gitroot3}
    fi
    
    msg "GIT checkout done or server timeout"

    rm -rf ${srcdir}/${_gitname}-build
    cp -r  ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
    
#    cd ${srcdir}/${_gitname}-build
    
    msg "Starting make..."
    cd ${_gitname2}
    cp -f $startdir/system.mk ./system.mk
    make PREFIX=${pkgdir}/usr || return 1
    make PREFIX=${pkgdir}/usr install || return 1
    cd ..

    cd ${_gitname3}
    cp -f $startdir/system.mk ./system.mk
    make PREFIX=${pkgdir}/usr EXTRA_INCLUDES="-I${pkgdir}/usr/include/notion" || return 1
    make PREFIX=${pkgdir}/usr install || return 1
    cd ..

    cp -f $startdir/system.mk ./system.mk
    make PREFIX=${pkgdir}/usr EXTRA_INCLUDES="-I${pkgdir}/usr/include/notion" EXTRA_LIBS="-L${pkgdir}/usr/lib -lrt" MKEXPORTS=${pkgdir}/usr/bin/libextl-mkexports || return 1
    make PREFIX=${pkgdir}/usr install || return 1
}

