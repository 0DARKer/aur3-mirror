# Contributor: Xemertix <arch88(at)katamail(dot)com>

pkgname=osiris-sps
pkgver=0.13
pkgrel=2
pkgdesc="an anonymous p2p serverless portal system"
arch=('i686' 'x86_64')
url="http://osiris.kodeware.net/index.php"
license=('custom')
depends=('libjpeg6' 'libpng12')
provides=('osiris-sps')
source=(http://osiris.kodeware.net/repository/osiris_${pkgver}_linux_i386.tar.gz
        'osiris-sps'
        'osiris-sps.desktop'
        'osiris-sps.png'
        'system.xml')
md5sums=('b02b7ddfc9b17ef570d8fabbc7549a06'
         'eb019a6e1f1a949d23a889a27c5e6d97'
         'ceddbf0fdf6213bb342994b980cb1ee8'
         '11970c1304efd8b2f956898b801b9e2f'
         'd3c7192a3dd32b8e3d4f5b4c7c866110')

[ "$CARCH" = "x86_64" ] && source=(http://osiris.kodeware.net/repository/osiris_${pkgver}_linux_x86_64.tar.gz 'osiris-sps' 'osiris-sps.desktop' 'osiris-sps.png' 'system.xml') && md5sums=('6b56ef8e563e672eaf8e7396a2e21024' 'eb019a6e1f1a949d23a889a27c5e6d97' 'ceddbf0fdf6213bb342994b980cb1ee8' '11970c1304efd8b2f956898b801b9e2f' 'd3c7192a3dd32b8e3d4f5b4c7c866110')

build() {
  cd $srcdir
  # Link to binary
  install -D -m 755 osiris-sps $pkgdir/usr/bin/osiris-sps

  # Program
  install -d -m 755 ${pkgdir}/opt/${pkgname}/
  cp -r osiris/*  ${pkgdir}/opt/${pkgname}/

  # Config file
  install system.xml ${pkgdir}/opt/${pkgname}/

  # Freedesktop compatibility
  install -D osiris-sps.png ${pkgdir}/usr/share/icons/osiris-sps.png
  install -D osiris-sps.png ${pkgdir}/usr/share/pixmaps/osiris-sps.png
  install -D osiris-sps.desktop ${pkgdir}/usr/share/applications/osiris-sps.desktop

  # Fix permissions
  find "$pkgdir"/opt/ -type f -exec chmod 664 {} +
  find "$pkgdir"/opt/ -type d -exec chmod 755 {} +
  find "$pkgdir"/usr/share -type f -exec chmod 664 {} +
  find "$pkgdir"/usr/share -type d -exec chmod 755 {} +
  chmod 775 $pkgdir/opt/${pkgname}/osiris
}
