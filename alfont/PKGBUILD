#Maintainer: Jonathan Fine
#Contributor: xx4h

pkgname=alfont
pkgver=2.0.9
pkgrel=5
pkgdesc="AllegroFont is an Allegro wrapper for the wonderful FreeType2 library that makes Allegro (amongst other things) able to load and render TTF and many other famous font..."
arch=('i686' 'x86_64')
url='http://chernsha.sitesled.com/'
license=('custom:FreeType2 License')
depends=('allegro' 'freetype2')
makedepends=('unrar')
source=('http://chernsha.sitesled.com/AlFont209.rar' 'http://opensnc.sourceforge.net/alfont/alfont.c')
md5sums=('92898c28788d42d0eaa53c607ff40974' '9259678a2598f11b00d83b525fdcefc0')
noextract=('AlFont209.rar')

build() {
#unrar is very verbose... lets shut it up
unrar x AlFont209.rar alfont/include alfont/src alfont/docs &> /dev/null || return 1
cd alfont || return 1

#lets build for linux, not windows
sed 's/#define ALFONT_WINDOWS//' -i include/alfont.h || return 1
sed 's/\/\/#define ALFONT_LINUX/#define ALFONT_LINUX/' -i include/alfont.h || return 1
#change a microsoft function to a GNU one
cp ../alfont.c src/
sed 's/_msize/malloc_usable_size/g' -i src/alfont.c || return 1

gcc -c src/alfont.c -o alfont.o -Iinclude -I/usr/include/freetype2 || return 1
ar rsc libalfont.a alfont.o || return 1

install -Dm644 libalfont.a $pkgdir/usr/lib/libalfont.a || return 1
install -Dm644 include/alfont.h $pkgdir/usr/include/alfont.h || return 1
install -Dm644 include/alfontdll.h $pkgdir/usr/include/alfontdll.h || return 1
install -Dm644 docs/FTL.txt $pkgdir/usr/share/licenses/alfont/FTL.txt || return 1
}

