# Maintainer: Andrzej Giniewicz <gginiu@gmail.com>
pkgname=daggerfall-fixes
pkgver=20110711
pkgrel=1
pkgdesc="The Elder Scrolls II: Daggerfall, unofficial fixes"
arch=('any')
url="http://www.uesp.net/wiki/Daggerfall:Files#Unofficial_Patches_and_Fixes"
license=('custom:daggerfall')
depends=(daggerfall)
makedepends=(unzip)
options=(!emptydirs)
install=fixes.install
source=(http://images.uesp.net//9/9d/Fixqs001.zip
        http://images.uesp.net//6/6f/SPELLS.zip
        http://images.uesp.net//0/0c/BIOG00T0.zip
        http://images.uesp.net//d/d6/FACTFIX.ZIP
        http://images.uesp.net//e/ed/DF-POLITIC.PAK.zip
        http://images.uesp.net//f/f2/DunmerFall.zip
        http://images.uesp.net/0/0f/DFQFIX.ZIP)
noextract=(Fixqs001.zip SPELLS.zip BIOG00T0.zip FACTFIX.ZIP DF_POLITIC.PAK.zip DunmerFall.zip DFQFIX.ZIP)
md5sums=('4b8d31d14f3ee8c7400bdf8c9768aa1c'
         '1e7d295e27b3da4be5484ae6e898eaf9'
         '74a724074bf48b5cc64477d99f88f005'
         '42f248b13255d905148d448c2372732c'
         '1696cbc71f33d9d884a4d2d71b53649a'
         '1d534a2c5326d5b65b40295c152064a2'
         '9895b19dd830692f54b155e6046efed7')

build() {
  cd "$srcdir"
  _target="${pkgdir}"/usr/share/games/daggerfall/mods
  install -d "$_target"

  cd "$_target"
  install -d fixqs001/ARENA2
  cd fixqs001/ARENA2
  unzip "$srcdir"/Fixqs001.zip
  rm readme.pqs
  ls | while read file; do mv $file `echo $file | sed 's/.*/\U&/'`; done
  cd "$_target"
  echo "fixqs001" > fixes.extends

  cd "$_target"
  install -d jumping_spell_fix/ARENA2
  cd jumping_spell_fix/ARENA2
  unzip "$srcdir"/SPELLS.zip
  cd "$_target"
  echo "jumping_spell_fix" >> fixes.extends
 
  cd "$_target"
  install -d mages_biography/ARENA2
  cd mages_biography/ARENA2
  unzip "$srcdir"/BIOG00T0.zip
  cd "$_target"
  echo "mages_biography" >> fixes.extends

  cd "$_target"
  install -d faction_fix/ARENA2
  cd faction_fix/ARENA2
  unzip "$srcdir"/FACTFIX.ZIP
  rm README.TXT
  cd "$_target"
  echo "faction_fix" >> fixes.extends

  cd "$_target"
  install -d wrothgarian_enclave_fix/ARENA2
  cd wrothgarian_enclave_fix/ARENA2
  unzip "$srcdir"/DF-POLITIC.PAK.zip
  cd "$_target"
  echo "wrothgarian_enclave_fix" >> fixes.extends

  cd "$_target"
  install -d dunmer_fall/ARENA2
  cd dunmer_fall/ARENA2
  unzip "$srcdir"/DunmerFall.zip
  rm readme.txt
  rm -rf BAK
  cd "$_target"
  echo "dunmer_fall" >> fixes.extends

  cd "$_target"
  install -d dfqfix/ARENA2
  cd dfqfix/ARENA2
  unzip "$srcdir"/DFQFIX.ZIP
  rm README.TXT
  cd "$_target"
  echo "fixqs001" > dfqfix.extends
  echo "dfqfix" >> fixes.extends
 
  chgrp -R games "$pkgdir"/usr/share/games/daggerfall
  chmod -R g+w "$pkgdir"/usr/share/games/daggerfall
}

