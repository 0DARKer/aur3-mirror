# Contributor: Garrett <http://floft.net/contact>
pkgname=openlp
pkgver=1.9.5
pkgrel=2
pkgdesc="Church presentation software."
arch=('any')
url='http://openlp.org/'
license=('GPLv2')
depends=('qt' 'python2' 'python2-qt' 'python2-distribute' 'phonon' 'python2-chardet' 'python-lxml' 'python-beautifulsoup' 'python2-sqlalchemy' 'python2-sip' 'python-pysqlite-legacy' 'python2-pyenchant')
optdepends=('libreoffice: display impress presentations')
install=openlp.install
source=(http://sourceforge.net/projects/openlp/files/openlp/${pkgver}/OpenLP-${pkgver}-src.tar.gz openlp.sh)
md5sums=('811d190fe759f0197ec124617765a1ea' '860b28d10f99ac6a1490b7f731ed949c')

build() {
  #translations
  tdestdir="$srcdir/OpenLP-$pkgver-src/openlp/i18n"
  tsrcdir="$srcdir/OpenLP-$pkgver-src/resources/i18n"
  mkdir -p $tdestdir
  cd $tsrcdir
  
  for f in *.ts; do
    lconvert -i $f -o $tdestdir/${f%%tm}qm
  done
  #openlp
  cd "$srcdir/OpenLP-$pkgver-src"
  python2 setup.py install --root=$pkgdir/ --optimize=1
  mv $pkgdir/usr/bin/openlp{.pyw,}
  #change version
  echo $pkgver > $pkgdir/usr/lib/python2.7/site-packages/openlp/.version
  #make impress work
  install -Dm755 $srcdir/openlp.sh $pkgdir/etc/profile.d/openlp.sh
  #desktop file
  install -D resources/openlp.desktop $pkgdir/usr/share/applications/openlp.desktop
}
