# Contributor: Garrett <http://floft.net/contact>
pkgname=openlp
pkgver=1.9.4
pkgrel=5
pkgdesc="Church presentation software."
arch=('i686' 'x86_64')
url='http://openlp.org/'
license=('GPLv2')
depends=('qt' 'python2' 'python2-qt' 'python2-distribute' 'phonon' 'python2-chardet' 'python-lxml' 'python-beautifulsoup' 'python2-sqlalchemy' 'python2-sip' 'python-pysqlite-legacy' 'python2-pyenchant')
optdepends=('openoffice-base: display impress presentations'
            'libreoffice: display impress presentations')
source=(http://sourceforge.net/projects/openlp/files/openlp/${pkgver}/OpenLP-${pkgver}-src.tar.gz openlp.sh)
md5sums=('4a1ab0dc3c144c333c905d337f4ed4ca' '4a65e01ff1a2e9379b0a36b38f45af79')

build() {
  #build translation stuff
  tdestdir="$srcdir/OpenLP-$pkgver-src/openlp/i18n"
  tsrcdir="$srcdir/OpenLP-$pkgver-src/resources/i18n"
  
  [ -d "$tdestdir" ] || mkdir -p $tdestdir
  cd $tsrcdir
  
  for f in *.ts; do
    lconvert -i $f -o $tdestdir/${f%%tm}qm
  done
  
  #build 
  cd "$srcdir/OpenLP-$pkgver-src"
  python2 setup.py install --root=$pkgdir/ --optimize=1
  
  #hack to make impress presentations work
  cp $srcdir/openlp.sh $pkgdir/usr/bin/openlp
  chmod +x $pkgdir/usr/bin/openlp
  
  #desktop file
  mkdir -p $pkgdir/usr/share/applications/
  cp resources/openlp.desktop $pkgdir/usr/share/applications/
}
