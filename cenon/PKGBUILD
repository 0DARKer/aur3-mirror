# Contributor: Kyle Keen <keenerd@gmail.com>
pkgname=cenon
pkgver=3.9.3
_libver=3.9.2  # why!?
pkgrel=1
pkgdesc="GNUstep based vector editor for EPS, DXF, Gerber, HPGL.  Includes docs and examples."
arch=('i686' 'x86_64')
url="http://www.cenon.info"
license=('vhfPL')
depends=('gnustep-base' 'gnustep-gui')
makedepends=('gnustep-make' 'gcc-objc')
source=(http://www.vhf-group.com/vhf-interservice/download/source/Cenon-$pkgver.tar.bz2\
  http://www.vhf-group.com/vhf-interservice/download/source/CenonLibrary-$_libver-1.tar.bz2\
  http://www.vhf-group.com/vhf-interservice/download/doc/Cenon_gb.pdf)
md5sums=('c778a6d241b88379b13113ddc69d51ad'
         'e216468bf28c84287bbd65cd2f9bee66'
         '6680bc8050eb81725b603823a50782a0')

build() {
  # Note to self: worst pkgbuild yet
  cd $srcdir/Cenon

  PATH="$PATH:/opt/GNUstep/System/Tools:/opt/GNUstep/Local/Tools"
  LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/opt/GNUstep/Local/Library/Libraries"
  
  make GNUSTEP_MAKEFILES="/opt/GNUstep/System/Library/Makefiles/"

  install -d "$pkgdir/opt/GNUstep/Local/Library/"
  install -d "$pkgdir/opt/GNUstep/Local/Applications/"
  sed -i "s/cp -R/#cp -R/" GNUmakefile.postamble
  sed -i "s/chmod -R/#chmod -R/" GNUmakefile.postamble

  make DESTDIR="$pkgdir" \
       GNUSTEP_MAKEFILES="/opt/GNUstep/System/Library/Makefiles/" \
       GNUSTEP_LOCAL_LIBRARY="/opt/GNUstep/Local/Library/" \
       GNUSTEP_LOCAL_APPS="/opt/GNUstep/Local/Applications/" \
       install

  cp -R Library/Cenon/ $pkgdir/opt/GNUstep/Local/Applications/
  chmod -R ugo+rX $pkgdir/opt/GNUstep/Local/Applications/Cenon.*

  # yeah, yeah.  use install
  cp -R Devices/ "$pkgdir/opt/GNUstep/Local/Library/Cenon/"
  cp -R Documentation/ "$pkgdir/opt/GNUstep/Local/Library/Cenon/"
  cp -R Examples/ "$pkgdir/opt/GNUstep/Local/Library/Cenon/"
  cp -R Projects/ "$pkgdir/opt/GNUstep/Local/Library/Cenon/"
  cp ../../Cenon_gb.pdf "$pkgdir/opt/GNUstep/Local/Library/Cenon/Documentation/"

  # figure out how to fix the library path for real
  install -d "$pkgdir/usr/bin/"
  touch "$pkgdir/usr/bin/cenon"
  chmod +x "$pkgdir/usr/bin/cenon"
  echo "#!/bin/sh" >> $pkgdir/usr/bin/cenon
  echo "export LD_LIBRARY_PATH=\"/opt/GNUstep/Local/Library/Libraries\"" >> $pkgdir/usr/bin/cenon
  echo "/opt/GNUstep/Local/Applications/Cenon.app/Cenon" >> $pkgdir/usr/bin/cenon
}


