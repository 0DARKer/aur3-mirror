# Maintainer: Spider.007 <aur@spider007.net>
# Don't forget updating the version @ *.service
pkgname=graylog2-web-interface
pkgver=0.92.1
pkgrel=1
pkgdesc="Web interface for Graylog2, an open source syslog implementation"
arch=(any)
url="http://graylog2.org"
license=('GPL')
depends=(java-runtime)
source=(
	http://packages.graylog2.org/releases/$pkgname/$pkgname-$pkgver.tgz
	graylog2-web-interface.service
	graylog2-web-interface.conf
)
backup=(etc/webapps/$pkgname/$pkgname.conf)
options=(!strip)
sha256sums=('152eefbf53cdda148175b960905c0b9b5095ebc5f2cf57c42289744a0903b2a0'
            '40c4afef37d853cb2d5e75a32a1e9c7f2bf5895f65f761979af406d6efc53636'
            'aa27f060410ffd47a675e95a1caaf37689a2b8201fb252d7c1d3b5096384be0c')

package() {
	cd "$srcdir/$pkgname-$pkgver"

	# verify classpath in service file
	lib=.$(grep ExecStart= $srcdir/graylog2-web-interface.service |cut -d' ' -f7|cut -d: -f1|cut -d\} -f2-)
	[[ ! -f $lib ]] && { echo "Incorrect classpath '$lib' in .service file" >&2; exit 2 ; }

	install -Dm644 "$srcdir/graylog2-web-interface.conf" "$pkgdir/etc/conf.d/graylog2-web-interface.conf"
	install -Dm644 "$srcdir/graylog2-web-interface.service" "$pkgdir/usr/lib/systemd/system/graylog2-web-interface.service"

	install -dm755 -o nobody "$pkgdir/etc/webapps/$pkgname/logs"
	cp conf/* "$pkgdir/etc/webapps/$pkgname/"

	install -dm755 "$pkgdir/usr/share/webapps/$pkgname"
	cp -R lib/ "$pkgdir/usr/share/webapps/$pkgname/"
	ln -s /etc/webapps/$pkgname/ $pkgdir/usr/share/webapps/$pkgname/conf
}
