# Maintainer: Ricardo Funke <ricardo [at] gmail [dot] com>
# Contributor: Attila Bukor <r1pp3rj4ck [at] w4it [dot] eu>
# Contributor: Iwan Timmer <irtimmer [at] gmail [dot] com>
# Contributor: Eric Engestrom <aur [at] engestrom [dot] ch>
# Contributor: Ricardo Band <me [at] xengi [dot] de>
# Contributor: Axilleas Pipinellis (aka axil42) <axilleas [at] archlinux [dot] info>
# Contributor: UshakovVasilii <UshakovVasilii [at] yahoo [dot] com>
# Contributor: Giulio Fidente <giulivo [dot] navigante [at] gmail [dot] com>

pkgname=popcorntime-bin
pkgver=0.3.1
pkgrel=4
pkgdesc="Stream movies from torrents. Skip the downloads. Launch, click, watch."
arch=('x86_64' 'i686')
url="http://get-popcorn.com/"
license=('GPL3')
makedepends=('zip')
depends=('ttf-liberation' 'gconf')
conflicts=('popcorntime' 'popcorntime-beta' 'popcorntime-git')
options=('!strip')
install="popcorntime.install"
md5sums=('SKIPPED'
         '5725b4c466ca3726e7a6df52730dacd2'
         'efe872f41ed74a706308b4015e4fd82f'
         '9608f35f4cc083a0c36b0f4ef275ab10')

if [ "$CARCH" = 'i686' ]; then
  _platform=Linux-32
  md5sums[0]='ae1f7c04f0000c7871548d02ac0fd3c9'
elif [ "$CARCH" = 'x86_64' ]; then
  _platform=Linux-64
  md5sums[0]='447b9d561d7c14da26bf5848bc515ff5'
fi

source=("http://cdn.get-popcorn.com/build/Popcorn-Time-${pkgver}-${_platform}.tar.gz"
        "https://raw.githubusercontent.com/popcorn-official/popcorn-app/master/src/app/images/icon.png"
        "popcorntime.install"
        "popcorntime.desktop")

prepare() {
  cd "${srcdir}"
  sed -i 's/\x75\x64\x65\x76\x2E\x73\x6F\x2E\x30/\x75\x64\x65\x76\x2E\x73\x6F\x2E\x31/g' "Popcorn-Time/Popcorn-Time"
}

package() {
  cd "${srcdir}"

  install -dm755 "${pkgdir}/opt/${pkgname}/"
  install -dm755 "${pkgdir}/usr/bin"
  install -dm755 "${pkgdir}/usr/share"

  # Program
  echo "${pkgdir}/opt/${pkgname}/"
  install -Dm755 ${srcdir}/Popcorn-Time/Popcorn-Time "${pkgdir}/opt/${pkgname}/"
  install -Dm644 ${srcdir}/Popcorn-Time/nw.pak "${pkgdir}/opt/${pkgname}/"
  install -Dm644 ${srcdir}/Popcorn-Time/libffmpegsumo.so "${pkgdir}/opt/${pkgname}/"
  install -Dm644 ${srcdir}/Popcorn-Time/package.nw "${pkgdir}/opt/${pkgname}/"

  # Link to program
  ln -s "/opt/${pkgname}/Popcorn-Time" "${pkgdir}/usr/bin/popcorntime"

  # Desktop file
  install -Dm644 "${srcdir}/popcorntime.desktop" "${pkgdir}/usr/share/applications/popcorntime.desktop"

  # Icon
  install -Dm644 "${srcdir}/icon.png" "${pkgdir}/usr/share/pixmaps/popcorntime.png"
}
