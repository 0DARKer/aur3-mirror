# Maintainer: Patryk Rzucidlo (@PTKDev) <ptkdev@gmail.com>

pkgname=youtube2mp3
pkgver=20120317
pkgrel=3
pkgdesc="A simple system to convert YouTube music videos to mp3"
arch=('any')
url="https://github.com/PTKDev/BashScript-YouTube2mp3"
license=('GPL3')
depends=('desktop-file-utils' 'ffmpeg' 'lame' 'youtube-dl' 'zenity')
makedepends=('git')
install=$pkgname.install

_gitroot="git://github.com/PTKDev/BashScript-YouTube2mp3.git"
_gitname="$pkgname"

package() {
  cd "$srcdir"

  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  # fix desktop file
  sed -i \
    -e '/^Icon/s:=.*$:=youtube:' \
    -e '/^Exec=/s:=.*$:=youtube2mp3:' \
    -e 's/ScreenCaster/YouTube\ Downloader/' \
    YouTube\ Downloader.desktop

  # override install.sh
  install -d -m 755 "$pkgdir"/usr/bin
  install -m 755 youtube2mp3.sh "$pkgdir"/usr/bin/youtube2mp3

  install -d -m 755 "$pkgdir"/usr/share/{applications,pixmaps}
  install -m 644 YouTube\ Downloader.desktop "$pkgdir"/usr/share/applications/
  install -m 644 img/youtube.png "$pkgdir"/usr/share/pixmaps/
}

# vim:set ts=2 sw=2 et: