pkgname='rubinius-git'
pkgver=20120510
pkgrel=1
pkgdesc="Rubinius, the Ruby VM"
arch=('i686' 'x86_64')
license=('BSD')
url="http://github.com/evanphx/rubinius"
depends=('openssl' 'readline' 'zlib')
makedepends=('git' 'bison' 'ruby')
conflicts=('rubinius')
replaces=('rubinius')

_gitroot="git://github.com/rubinius/rubinius.git"
_gitname="rubinius"

build(){
  cd $srcdir
  if [[ -d "$_gitname" ]]; then
    cd "$_gitname"
    git reset --hard && git clean -dxf
    git pull 
  else
    git clone "$_gitroot" "$_gitname"
    cd "$_gitname"
  fi

  ./configure --prefix=/opt/$pkgname --mandir=/usr/share/man --default-version=19
}

package() {
  cd "$srcdir/$_gitname"

  FAKEROOT="$pkgdir/" rake install

  install -vDm644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE

  install -d "$pkgdir/usr/bin"
  ln -s ../../opt/$pkgname/bin/rbx "$pkgdir/usr/bin"
}