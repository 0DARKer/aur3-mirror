# Contributor: Muhammad 'MJ' Jassim <UnbreakableMJ@gmail.com>
# Contributor: Samed Beyribey <ras0ir@eventualis.org>
# Thanks for Pardus GNU/Linux developers for Spellchecking patch
pkgname=icecat-zemberek
pkgver=3.0.1g1
_pkgver=3.0.1-g1
origin=icecat
pkgrel=2
pkgdesc="GNU version of the Firefox browser with Turkish spellchecking patch."
arch=('i686' 'x86_64')
url="http://www.gnu.org/software/gnuzilla/"
license=('GPL2' 'MPL' 'LGPL')
depends=('gtk2' 'libxt' 'libidl2' 'nss' 'zpspell' 'zemberek-server')
	##  no idea how much we need those above
	##+ or those: 'pango' 'libgnomeui' 'libgnome'
makedepends=('zip' 'tar')
provide=('iceweasel-bin' 'iceweasel' 'firefox' 'mozilla-firefox' \
	 'mozilla-firebird' 'phoenix' 'swiftweasel' 'swiftfox' \
	 'icecat-bin' 'icecat-cvs' 'icecat')
conflicts=('icecat-cvs' 'icecat-bin' 'iceweasel-bin' 'icecat')
replaces=()
install=(icecat.install)
source=(ftp://ftp.gnu.org/gnu/gnuzilla/${_pkgver}/icecat-${_pkgver}.tar.bz2 \
	${origin}.desktop \
	${origin}-safe.desktop \
	${origin}.sh \
	${origin}-launcher.sh \
	${origin}16.png \
	${origin}32.png \
	${origin}48.png \
	${origin}48.xpm \
	icecat_new_files.tar.bz2 \
	icecat_icons.tar.gz \
	zemberek-firefox3.patch)
md5sums=('c52f5ff97179fa8c5c12f1577e232f9c' \
         '2965d6561c4c4473e1e392a20f5e61cb' \
         '5c498b31bd52c1f1d92c8d7da27c5d6f' \
         '70d93e9755af53ad4d310966a7d55a55' \
         'c6ab71d3ed1ee3c767391cd981099a03' \
         'ddd0c466cced06ee9f7068a0fc5dda3a' \
         '2de250a85719545d3853ebc92240f42a' \
         'a04aec7bc8f760f95a3573c641c687e6' \
         'df60f7e4f3c6fe3d8b3540f338d4f7fd' \
         '1d3e97b290cd4b38a251bffcd10cc9bc' \
         '5b3b7e11439e4d3dee52c2f798284e75' \
	 '43f0783e6284afafbf08d9c1899dfa0a')

#options=('!makeflags')
ICECATDIR="/usr/lib/icecat-${_pkgver}" && export ICECATDIR

build() {
  ICECATDIR="/usr/lib/icecat-${_pkgver}" && export ICECATDIR
  cd ${startdir}/src/${origin}-${_pkgver}/
  #########################################################################
  patch -Np1 -i ${startdir}/src/zemberek-firefox3.patch

  
  ## Temp. solutions: -----------------------------------------------------
  tar -zxvf ${startdir}/src/icecat_icons.tar.gz
  
  tar -jxvf ${startdir}/src/icecat_new_files.tar.bz2 || return 1
  #unset CFLAGS
  #unset CXXFLAGS
  #export LDFLAGS="-Wl,-rpath,${ICECATDIR}"
  #########################################################################
  
  
  ## Changes in .mozconfig: -----------------------------------------------
  ## We can just replace whatever .mozconfig given and use our own:
  #rm -f ${startdir}/src/${pkgname}-${_pkgver}/.mozconfig &&
  #cp ${startdir}/src/mozconfig \
  #   ${startdir}/src/${pkgname}-${_pkgver}/.mozconfig
  if [ -f "${startdir}/src/${origin}-${_pkgver}/.mozconfig" ]
   then
    	sed -i 's|--prefix=/usr/local|--prefix=/usr|' \
    	   ${startdir}/src/${origin}-${_pkgver}/.mozconfig
  else
    	cp ${startdir}/src/mozconfig \
    	   ${startdir}/src/${origin}-${_pkgver}/.mozconfig
    	echo "ac_add_options --disable-official-branding" \
    	   >>${startdir}/src/${origin}-${_pkgver}/.mozconfig
  fi
  echo "ac_add_options --with-default-mozilla-five-home=\"${ICECATDIR}\"" \
     >>${startdir}/src/${origin}-${_pkgver}/.mozconfig || return 1
  ##change this to suite your optimization:
  if [ "$CARCH" == "i686" ]; then
    echo "ac_add_options --enable-optimize=\"${CFLAGS}\"" \
      >>${startdir}/src/${origin}-${_pkgver}/.mozconfig || return 1
  else
    echo "ac_add_options --enable-optimize" \
      >>${startdir}/src/${origin}-${_pkgver}/.mozconfig || return 1
  fi
  export MAKEFLAGS="-j1"
  #########################################################################
  
  
  ## configure && make && make install-------------------------------------
  ./configure --prefix=/usr || return 1
  make || return 1
  install --directory ${startdir}/pkg
  make DESTDIR=${startdir}/pkg install || return 1
  #########################################################################
  
  
  ## Final arrangements: --------------------------------------------------
  install --directory ${startdir}/pkg/usr/share/applications
  install -m644 ${startdir}/src/${origin}.desktop \
		${startdir}/pkg/usr/share/applications
  install -m644 ${startdir}/src/${origin}-safe.desktop \
		${startdir}/pkg/usr/share/applications
  install --directory ${startdir}/pkg/usr/share/pixmaps
  install -m644 ${startdir}/src/${origin}48.xpm \
		${startdir}/pkg/usr/share/pixmaps/${origin}.xpm
  install --directory ${startdir}/pkg${ICECATDIR}/chrome/icons/default
  rm -f ${startdir}/pkg${ICECATDIR}/chrome/icons/default/default*
  install -m644 ${startdir}/src/${origin}16.png \
  	  	${startdir}/pkg${ICECATDIR}/chrome/icons/default/default16.png
  install -m644 ${startdir}/src/${origin}32.png \
  	  	${startdir}/pkg${ICECATDIR}/chrome/icons/default/default32.png
  install -m644 ${startdir}/src/${origin}48.png \
  	  	${startdir}/pkg${ICECATDIR}/chrome/icons/default/default48.png
  install -m644 ${startdir}/src/${origin}48.xpm \
 	  	${startdir}/pkg${ICECATDIR}/chrome/icons/default/default.xpm
  install --directory ${startdir}/pkg${ICECATDIR}/icons
  install -m644 ${startdir}/src/${origin}48.xpm \
 	  	${startdir}/pkg${ICECATDIR}/icons/default.xpm
  install --directory ${startdir}/pkg/etc/profile.d/
  install -m755 ${startdir}/src/${origin}.sh \
		${startdir}/pkg/etc/profile.d/
  install --directory ${startdir}/pkg/usr/bin/
  install -m755 ${startdir}/src/${origin}-launcher.sh \
		${startdir}/pkg/usr/bin/${origin}-launcher
  cd ${startdir}/pkg${ICECATDIR}
  ln -s ${origin} firefox
  ln -s ${origin}-bin firefox-bin
# We need to touch tr-TR dictionary files for enabling Turkish dictionary.
touch ${startdir}/pkg${ICECATDIR}/dictionaries/{tr-TR.aff,tr-TR.dic}
}
