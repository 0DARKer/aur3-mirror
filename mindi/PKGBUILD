# Maintainer: M.Carreira <arch@carreira.com.pt>
# Contributor: M.Carreira <manuel@carreira.com.pt>
pkgname=mindi
pkgver=2.0.7.6
pkgrel=4
pkgdesc="Create bootable disks or CD image with your system files, to allow system maintenance"
arch=('i686' 'x86_64')
url="http://www.mondorescue.org/"
license=('GPLv2+')
changelog=('ChangeLog')
backup=('etc/mindi/mindi.conf' 'etc/mindi/deplist.txt')
depends=('bzip2>=0.9' 'cdrkit' 'ncurses' 'binutils' 'gawk' 'dosfstools' 'mindi-busybox>=1.7.3' 'parted' 'perl' 'mtools' 'which' 'grep>=2.5' 'cpio')
conflicts=(bonnie++)

# There are two official mirrors. If one is not working try the other. The muskokamug.org seems faster.
#source=(ftp://ftp.mondorescue.org/src/$pkgname-$pkgver.tar.gz
source=(http://mondorescue.muskokamug.org/src/$pkgname-$pkgver.tar.gz
        mindi-arch01.patch
        mindi-release.patch
        mindi-bootsize.patch
        mindi-modprobe.patch
        mindi-udevadm.patch)

md5sums=('4953a373415fb78e9e5a5872403b846e'
         'cfa14d7d8199d62cfc7242955cacca5e'
         '01f67e558975ce6d311e25d0b0c6c94e'
         'def9a563af7ad963a5e004acded4c85b'
         '3c5ca0d7e1b859d9e43dfe20d5a138ef'
         'effe13a85ee96450aeb37731944f4059')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  patch -p1 < ../mindi-arch01.patch
  patch -p1 < ../mindi-release.patch
  patch -p1 < ../mindi-bootsize.patch
  patch -p1 < ../mindi-modprobe.patch
  patch -p1 < ../mindi-udevadm.patch
  export DONT_RELINK=1
  export HEAD=$pkgdir
  export PREFIX=/usr
  export CONFDIR=/etc
  export DOCDIR=/usr/share/doc
  export LIBDIR=/usr/lib
  export CACHEDIR=/var/cache/$pkgname
  export PKGBUILDMINDI="true"  

 ./install.sh 
  DOCDIR_INST=${pkgdir}${DOCDIR}/${pkgname}-${pkgver}
  install -d $DOCDIR_INST
  install -m 644 ChangeLog AUTHORS COPYING README README.* TODO INSTALL NEWS $DOCDIR_INST
}

# vim:set ts=2 sw=2 et:
