# Contributor: Woody Gilk <woody@archlinux.org>
# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>
pkgname=xaralx
pkgver=0.7r1785
pkgrel=5
pkgdesc="An advanced vector graphics program, development release"
arch=('i686' 'x86_64')
url="http://www.xaraxtreme.org/"
license=('GPL')
depends=('wxgtk')
makedepends=('pkgconfig' 'zip')
optdepends=('imagemagick: needed for some conversions')
install=${pkgname}.install
source=(http://downloads2.xara.com/opensource/XaraLX-$pkgver.tar.bz2 \
 xaralx-wxGTK-2.8.patch.bz2)

build() {
  export LANG=C
  cd $srcdir/XaraLX-$pkgver
  sed -i "/info_ptr->trans/s:trans:trans_alpha:" wxOil/outptpng.cpp || return 1

  patch -p1 < $srcdir/xaralx-wxGTK-2.8.patch || return 1
  ./configure --prefix=/usr --enable-filters  \
    --enable-xarlib --disable-svnversion --with-gnu-ld || return 1
  make || return 1
  make DESTDIR=$pkgdir install || return 1

  # Desktop compatibility
  install -D -m644 $pkgname.png \
    $pkgdir/usr/share/pixmaps/$pkgname.png || return 1
  install -D -m644 $pkgname.desktop \
    $pkgdir/usr/share/applications/$pkgname.desktop || return 1
  install -D -m644 Mime/$pkgname.xml \
    $pkgdir/usr/share/mime/packages/$pkgname.xml || return 1

  cd $pkgdir/usr/bin && ln -s XaraLX $pkgname
}

md5sums=('5f2fd1f188f2c01c0b06e69d0fba2f4f'
         '6085d2ad262c66f3a9999f2c2840c1eb')
