pkgname=driveclient
pkgver=1.05
pkgrel=005848
pkgdesc="An agent for Rackspace Cloud Backup"
url="http://www.rackspace.com/knowledge_center/article/rackspace-cloud-backup-install-the-agent"
license=('Mixed')
arch=('any')
backup=('etc/driveclient/cacert.pem')
source=("http://agentrepo.drivesrvr.com/tar/driveclient-${pkgver}.${pkgrel}.tar.bz2")
sha1sums=('c0b5bb3e96977f426b5943c4eb22ee86959b7b27')

install=install

build() {

cat > "${srcdir}/${pkgname}-${pkgver}.${pkgrel}/driveclient.service"  <<+++SYSTEMD+++
[Unit]
Description=Rackspace backup agent
After=network.target

[Service]
Type=simple
Environment= ARGS=-d
EnvironmentFile=-/etc/conf.d/driveclient
ExecStart=/usr/local/bin/driveclient $ARGS

[Install]
WantedBy=multi-user.target

+++SYSTEMD+++

}

package() {
	install -d "${pkgdir}/usr/local/bin/"
	install -d "${pkgdir}/etc/driveclient/"
	install -d "${pkgdir}/etc/systemd/system/multi-user.target.wants/"
	install -d "${pkgdir}/etc/rc.d/"
	install "${srcdir}/${pkgname}-${pkgver}.${pkgrel}/driveclient" "${pkgdir}/usr/local/bin/"
	install "${srcdir}/${pkgname}-${pkgver}.${pkgrel}/cacert.pem" "${pkgdir}/etc/driveclient/"
	install "${srcdir}/${pkgname}-${pkgver}.${pkgrel}/driveclient.service" "${pkgdir}/etc/systemd/system/"
	install -m0555 "${srcdir}/${pkgname}-${pkgver}.${pkgrel}/driveclient.init.arch" "${pkgdir}/etc/rc.d/driveclient"
	ln -s "/etc/systemd/system/driveclient.service" "${pkgdir}/etc/systemd/system/multi-user.target.wants/driveclient.service"
}
