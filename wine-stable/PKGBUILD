# Contributor: Vamp898 <vamp898@web.de>

pkgname=wine-stable
pkgname_real=wine
pkgver=1.2.1
pkgrel=1

_pkgbasever=${pkgver/rc/-rc}

source=(http://ibiblio.org/pub/linux/system/emulators/$pkgname_real/$pkgname_real-$_pkgbasever.tar.bz2
        unbreak-wow64.patch)

pkgdesc="A compatibility layer for running Windows programs"
url="http://www.winehq.com"
arch=(i686)
license=(LGPL)
depends=(fontconfig mesa libxcursor libxrandr libxdamage libxxf86dga alsa-lib)
makedepends=(autoconf ncurses bison perl fontforge flex prelink libgphoto2 giflib libxpm libpng libxinerama libxcomposite libxmu libxxf86vm libxml2 libxslt libldap lcms mpg123 openal esound jack cups sane samba)
optdepends=(libgphoto2 giflib libpng libldap lcms libxml2 mpg123 openal esound jack cups sane samba)
provides=('wine')

build() {
  cd "$srcdir"

  # Allow ccache to work
  mv $pkgname_real-$_pkgbasever $pkgname_real

  # (Re)create build dirs
  rm -rf $pkgname_real-32-build
  mkdir $pkgname_real-32-build

msg2 "Building Wine..."

    cd "$srcdir/$pkgname_real-32-build"
    ../$pkgname_real/configure \
      --prefix=/usr \
      --sysconfdir=/etc \
      --with-x

    make
}

package() {

msg2 "Packaging Wine..."

  cd "$srcdir/$pkgname_real-32-build"
  make prefix="$pkgdir/usr" install
  mkdir -p "$pkgdir/etc/wine"
}
md5sums=('efea24c69d058b0954da3e538ca52ec8'
         'c3118b7df69ad4e93b5ce98f6a592620')
