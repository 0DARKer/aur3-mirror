# Maintainer: anergy <anergy.25110321@gmail.com>
pkgname=eman2
pkgver=2.03
pkgrel=1
epoch=1
pkgdesc="scientific image processing tools aimed at the transmission electron microscopy community"
arch=(x86_64 i686)
url="http://blake.bcm.edu/emanwiki/EMAN2"
license=('GPL')
groups=()
depends=(gsl freeglut libgl libjpeg qt libpng libtiff python2 python2-pyqt python-opengl python2-matplotlib fftw
         db python2-bsddb 'ipython2<0.11' hdf5)
makedepends=(cmake)
checkdepends=()
optdepends=()
provides=(sparx)
conflicts=()
replaces=()
backup=()
options=(strip makeflags)
source=(http://ncmi.bcm.edu/ncmi/software/counter_222/software_115/eman-source-$pkgver.tar.gz
        namespace.patch
        eman2.sh
        eman2.csh)
noextract=()
md5sums=('aaefea343bc8ed644c0dda084d269a42'
         '823de721d64f84b5737dbd598a5ad668'
         '7b413fef95b324b4e62487ae38b462af'
         '17633114d43bae2074056e801b281f5e')
if [ `arch` = 'x86_64' ]; then
  enable_x86_64="ON"
else
  enable_x86_64="OFF"
fi

cmake_options=(
    -D ENABLE_X86_64=${enable_x86_64} 
    -D EMAN_INSTALL_PREFIX=/opt/eman2
    -D PYTHON_ROOT=/usr/lib/python2.7
    )
build() {
  cd $srcdir
  patch -p1 < namespace.patch
  cd "$srcdir/EMAN2/src/build"
  cmake ${cmake_options[@]} ../eman2 || return 1
  make -j4 || return 1
  cd $srcdir/EMAN2/src/eman2/
  find ./ -name '*.py' -exec sed -i "1s/python$/python2/" {} \;
  sed -i "1s/python$/python2/" sparx/bin/sparx
}

package() {
  cd "$srcdir/EMAN2/src/build"
  make DESTDIR=${pkgdir} install
  cd "$srcdir"
  install -d $pkgdir/etc/profile.d
  install eman2.sh $pkgdir/etc/profile.d
  install eman2.csh $pkgdir/etc/profile.d
}

# vim:set ts=2 sw=2 et:
