#Maintainer: andy123 <ajs @ online.de>

pkgname=teeworlds-zcatch-server
pkgver=0.3
_bamver=0.2.0
_name=teeworlds
_ver=0.5.2
pkgrel=1
pkgdesc="A multiplayer 2D shooter's server mod"
arch=('i686' 'x86_64')
url="http://teeworlds.com"
license=('custom')
depends=('zlib')
makedepends=('python' 'patch')
replaces=('teewars')
source=(http://www.teeworlds.com/files/${_name}-${_ver}-src.tar.gz
        http://www.teeworlds.com/files/bam-${_bamver}.tar.gz
        fix_datadir_search.patch
	#lightcatch.map
	ctf_nephtys.map
	zcatch.patch)

md5sums=('f605f6df9f1714dcda4cba1d281cc757'
         'd4efe74591a73c1cec8b34d76ffd1049'
	 '673791ecb74274346456f0fae53b4428'
	 #'5d8166d7d96ddc30690db6e1df49143e'
	 '594dbfc5931eba09a115faf17488e1c7'
	 '24cebac2d2e741bd31a5d38b8a453b70')

build() {
        # Build bam (used to build teeworlds)
        cd ${srcdir}/bam-${_bamver} || return 1
        ./make_unix.sh || return 1

        # Build teeworlds-zcatch-server
	cd ${srcdir}/
	patch -p1 -i ./zcatch.patch
        cd ${srcdir}/${_name}-${_ver}-src/
	patch -p1 -i ../fix_datadir_search.patch || return 1
	../bam-${_bamver}/src/bam server_release || return 1
}

package() {
        mkdir -p ${pkgdir}/usr/share/${_name}/data/maps || return 1
	#cp -R ${srcdir}/${_name}-${_ver}-src/data ${pkgdir}/usr/share/${pkgname} || return 1
        cp ${srcdir}/ctf_nephtys.map ${pkgdir}/usr/share/${_name}/data/maps/ || return 1
	#cd ${pkgdir}/usr/share/${_name}/data/maps || return 1
	#wget http://download.tee-page.de/modifications/catching/2_0/junglecatch.map http://download.tee-page.de/modifications/catching/3_1/grasscatch.map http://download.tee-page.de/modifications/catching/2_0/dm1_catch.map

        install -Dm755 ${srcdir}/${_name}-${_ver}-src/zcatch ${pkgdir}/usr/bin/${pkgname} || return 1
        install -Dm644 ${srcdir}/${_name}-${_ver}-src/license.txt ${pkgdir}/usr/share/licenses/${pkgname}/license.txt || return 1
        #install -Dm644 ${srcdir}/autoexec.cfg ${pkgdir}/usr/share/${_name}/data/autoexec.cfg || return 1
}
