# Maintainer: Daniel Wallace <danielwallace at gtmanfred dot com>

pkgname=bastion
pkgver=1
_pkgver=2012-05-29-2
pkgrel=1
pkgdesc="an original action role-playing game set in a lush imaginative world, in which players must create and fight for civilizationâ€™s last refuge as a mysterious narrator marks their every move."
arch=('i686' 'x86_64')
url="http://supergiantgames.com/?page_id=242"
license=('custom')
makedepends=('xz')
depends=('libxft')
_sh=Bastion-HIB-$_pkgver.sh
source=($_sh)

build() {
  # Extract installer.
  if [ ! -d $srcdir/$pkgname-$pkgver ]; then
    mkdir -p $srcdir/$pkgname-$pkgver
  fi
  msg "Extracting archive..."
  sh $_sh --tar xf -C $srcdir/$pkgname-$pkgver 
  cd $srcdir/$pkgname-$pkgver

  case $CARCH in
    i686) _arch=x86 ;;
    x86_64) _arch=x86_64 ; _sfix=64 ;;
  esac
  lzcat subarch | tar xvf -
  tar --lzma -xf instarchive_all
  tar --lzma -xf instarchive_linux_$_arch

  # Create pkgdir folders.
  mkdir -p $pkgdir/usr/bin
  mkdir -p $pkgdir/usr/share/{applications,games/$pkgname,icons}
  mkdir -p $pkgdir/usr/share/licenses/$pkgname
}
package() {
  # Install files.
  msg "Copying files..."


  cd $srcdir/$pkgname-$pkgver

  # Move all libraries.
  #mv libs$_sfix/all/* libu$_sfix/
  #rmdir libs$_sfix/all

  # Copy the game folder.
  cp -r * $pkgdir/usr/share/games/$pkgname

  # Make executable links.
  ln -s /usr/share/games/$pkgname/Bastion.bin$_sfix $pkgdir/usr/bin/$pkgname

  # Install icons and .desktop files.
  install -m644 Bastion.png $pkgdir/usr/share/icons/$pkgname.png
}
md5sums=('30ba3e0a4993c3cb08f57496c400547f')
