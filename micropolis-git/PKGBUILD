arch=(i686 x86_64)
pkgname=micropolis-git
pkgver=20080404
pkgrel=4
pkgdesc="Micropolis Unix version (A.K.A. "S*mC*ty")"
url="http://wiki.laptop.org/go/Micropolis"
license="GPL"
depends=('sdl_mixer' 'libxpm')
makedepends=('git' 'bison')
conflicts=()
replaces=()
backup=()
source=('micropolis.desktop' 'micropolis.png')
md5sums=('27b3d182a1c88e8d3b3cdbfdf4f78a06'
         '74d7385d7dc65a70c757b1b1d0fdd40d')

_gitroot="git://git.zerfleddert.de/micropolis"
_gitname="micropolis"
build() {
  cd $startdir/src
  rm -r -f micropolis-build
  msg "Connecting to git.zerfleddert.de GIT server...."

  if [ -d $startdir/src/$_gitname ] ; then
  cd $_gitname && git-pull origin
  msg "The local files are updated."
  else
  git clone $_gitroot
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cp -r $startdir/src/$_gitname $startdir/src/$_gitname-build
  cd $startdir/src/$_gitname-build/src

  make || return 1
  mv sim/sim ../res 
  cd ..
  mkdir -p $startdir/pkg/usr/share/micropolis
  mkdir -p $startdir/pkg/usr/bin
  mv activity/ images/ micropolisactivity.py cities/ __init__.py Micropolis.png COPYING manual/ res/ README $startdir/pkg/usr/share/micropolis
  sed -i -e 's#SIMHOME=`pwd`#SIMHOME="/usr/share/micropolis"\ncd $SIMHOME#' Micropolis
  mv Micropolis $startdir/pkg/usr/bin/micropolis
  mkdir -p $startdir/pkg/usr/share/pixmaps
  mkdir -p $startdir/pkg/usr/share/applications
  install -m644 $startdir/micropolis.png $startdir/pkg/usr/share/pixmaps
  install -m644 $startdir/micropolis.desktop $startdir/pkg/usr/share/applications
  rm -r -f $startdir/src/$_gitname-build
} 

