# Contributor: Dragonlord <archlinux[at]dragonlord[.]cz>

pkgname=falf-svn
pkgver=239
pkgrel=1
pkgdesc="Development version of a music player for KDE (based on Xine)."
arch=('i686')
url="http://falf.sourceforge.net/"
license=('GPL')
depends=('kdelibs' 'xine-lib' 'qt3' 'taglib')
makedepends=('patch' 'findutils')
provides=('falf')
conflicts=('falf' 'falfplayer-svn')
makedepends=('subversion')

source=($pkgname-build.patch)
md5sums=('c8a715550b14277db8d2bee326f8b5c5')

_svntrunk=https://falf.svn.sourceforge.net/svnroot/falf
_svnmod=falf

build() {
# !!! if ERRORS or using KDEmod uncomment next 2 lines !!!
#  export QTDIR=/opt/qt
#  export QMAKESPEC=/opt/qt/mkspecs/linux-g++

  cd $srcdir

# get the sources
  msg "Connecting to $_svntrunk ..."
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver) || return 1
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod || return 1
  fi
  msg "SVN checkout done or server timeout"

  if [ -d ${_svnmod}-build ]; then
    msg "Deleting old build directory"
    rm -rf ${_svnmod}-build
  fi
  cp -r ${_svnmod} ${_svnmod}-build || return 1
  cd ${_svnmod}-build
  msg "Setting up build environment..."

# building
  msg "Starting build"
  install -d $pkgdir/opt/kde/bin \
    $startdir/pkg/opt/kde/share/locale/{cs,es,it,nl,pl,ru,uk,zh_CN}/LC_MESSAGES/ \
    $startdir/pkg/opt/kde/share/{applnk/Multimedia,apps/konqueror/servicemenus,icons/default.kde} || return 1

  patch -Np0 -i $srcdir/$pkgname-build.patch || return 1
  sh install.sh || return 1

# correcting file permissions
  find $pkgdir/opt/kde/share -type f -exec chmod 644 "{}" \; || return 1

# remove all svn related files installed
  rm -rf `find $pkgdir -type d -name .svn` || return 1

  rm -rf $srcdir/$_svnmod-build
}
