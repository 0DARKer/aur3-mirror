pkgname=gtkd
pkgver=1.5.1
pkgrel=2
pkgdesc="D binding and OO wrapper of GTK+."
arch=('i686' 'x86_64')
url="http://www.dsource.org/projects/gtkd"
license=('LGPL')
depends=('gtk2' 'gtkglext')
source=("http://www.dsource.org/projects/gtkd/browser/downloads/gtkD-${pkgver}.zip?format=raw" 
        'http://www.dsource.org/projects/gtkd/changeset/904?format=diff&new=904')
md5sums=('75e6812d85a3c1a05bd2ec8fcbdc6c6d'
         '0ce3a82e7fc0292cf6d4e9278f4744d7')
build() {
    cd ${srcdir}
    find . -name "*.d" -exec sed -i "s/typedef/alias/g" '{}' \;

    sed -i "s/\/trunk\//gtkD\//g" '904?format=diff&new=904'
    patch -p0 -i '904?format=diff&new=904'

	cd gtkD
	make prefix=${pkgdir}/usr DESTDIR=${pkgdir} install
}
package() {
    mv ${pkgdir}/${pkgdir}/usr ${pkgdir}
    if [[ `echo ${pkfdir} | awk '{split($0,a,"/"); print a[1]}'` != "" ]]; then
        rm -rf ${pkgdir}/`echo ${pkgdir} | awk '{split($0,a,"/"); print a[1]}'`
    else
        if [[ `echo ${pkgdir} | awk '{split($0,a,"/"); print a[2]}'` != "" ]]; then
            rm -rf ${pkgdir}/`echo ${pkgdir} | awk '{split($0,a,"/"); print a[2]}'`
        fi
    fi
}
