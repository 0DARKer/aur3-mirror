# HG changeset patch
# Parent 215eeefa6e73e59be9209c7cdec7d01d7caaa4d9

diff --git a/lib/rb/ext/extconf.rb b/lib/rb/ext/extconf.rb
--- a/lib/rb/ext/extconf.rb
+++ b/lib/rb/ext/extconf.rb
@@ -24,7 +24,12 @@
 
   $CFLAGS = "-g -O2 -Wall -Werror"
 
-  have_func("strlcpy", "string.h")
+  major, minor = RUBY_VERSION.split('.').map { |s| s.to_i }
+  if major == 1 and minor >= 9 then
+      $defs.push('-DHAVE_STRLCPY')
+  else
+      have_func('strlcpy', 'string.h')
+  end
 
   create_makefile 'thrift_native'
 end
