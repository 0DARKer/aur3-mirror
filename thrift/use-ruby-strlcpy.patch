# HG changeset patch
# Parent 4811830716911797268e7557bedeeb7ff14dd4e2

diff --git a/lib/rb/ext/extconf.rb b/lib/rb/ext/extconf.rb
--- a/lib/rb/ext/extconf.rb
+++ b/lib/rb/ext/extconf.rb
@@ -21,6 +21,11 @@
 
 $CFLAGS = "-g -O2 -Wall -Werror"
 
-have_func("strlcpy", "string.h")
+major, minor = RUBY_VERSION.split('.').map { |s| s.to_i }
+if major == 1 and minor >= 9 then
+    $defs.push('-DHAVE_STRLCPY')
+else
+    have_func('strlcpy', 'string.h')
+end
 
 create_makefile 'thrift_native'
