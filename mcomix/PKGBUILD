# Maintainer: Ray Powell <ray_al@xphoniexx.net>
# PKGBUILD Based off comix PKGBUILD with below contributors and maintainer
# comix Contributor: Geoffroy Carrier <geoffroy@archlinux.org>
# comix Contributor: Eric Belanger <eric@archlinux.org>
# comix Contributor: William Rea <sillywilly@gmail.com>
# comix Maintainer: Daniel J Griffiths <ghost1227@archlinux.us>


pkgname=mcomix
pkgver=0.91
pkgrel=1
pkgdesc="A comic book viewer forked from comix"
#arch=('i386' 'x86_64')
arch=('any')
url="http://sourceforge.net/projects/mcomix/"
license=('GPL')
depends=('pygtk' 'pil' 'unrar' 'xdg-utils' 'python2' 'desktop-file-utils' 'hicolor-icon-theme' 'python2-distribute')
makedepends=('gettext' 'intltool')
conflicts=('comix')
install=mcomix.install
source=(http://downloads.sourceforge.net/project/mcomix/MComix-${pkgver}/mcomix-${pkgver}.tar.bz2)
md5sums=('f4e1b3b09a97fa555cfa3b37049c75e3')

build() {
	cd ${srcdir}/${pkgname}-${pkgver}
	# python2 fix
	for file in $(grep -Rl "/usr/bin/env python" ./);
	do
		sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' $file
	done

        export PYTHONPATH=${pkgdir}/usr/lib/python2.7/site-packages/
        mkdir -p $PYTHONPATH
        python2 setup.py install --prefix ${pkgdir}/usr

}

package() {
	
	#Create needed directory structure
	mkdir -p ${pkgdir}/usr/share/icons/hicolor
	mkdir -p ${pkgdir}/usr/share/applications
	cd ${srcdir}/${pkgname}-${pkgver}

	cp -r ${pkgname}/images ${pkgdir}/usr/share/${pkgname}/
	cp -r mime/icons/* ${pkgdir}/usr/share/icons/hicolor/

	install -D -m644 mime/comicbook.schemas ${pkgdir}/usr/share/gconf/schemas/mcomix.schemas
	install -D -m644 mime/comicthumb.1.gz ${pkgdir}/usr/share/man/man1/comicthumb.1.gz
	install -D -m644 mime/${pkgname}.desktop ${pkgdir}/usr/share/applications/
	rm ${pkgdir}/usr/bin/easy_install-2.7 
	rm ${pkgdir}/usr/lib/python2.7/site-packages/*.p*
}
