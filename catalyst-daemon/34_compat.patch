--- compat.h	2012-05-21 09:29:36.000000000 +0200
+++ compat.h	2012-06-01 18:55:36.587441393 +0200
@@ -221,6 +221,7 @@
 	return (u32)(unsigned long)uptr;
 }
 
+#ifdef CONFIG_x86_64
 static inline void __user *arch_compat_alloc_user_space(long len)
 {
 	compat_uptr_t sp;
@@ -234,6 +235,15 @@
 
 	return (void __user *)round_down(sp - len, 16);
 }
+#else 
+ 
+static inline void __user *arch_compat_alloc_user_space(long len) 
+{ 
+ struct pt_regs *regs = task_pt_regs(current); 
+ return (void __user *)regs->sp -len; 
+} 
+ 
+#endif
 
 static inline bool is_x32_task(void)
 {
