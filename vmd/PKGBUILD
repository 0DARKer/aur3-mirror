#Contributor: Ricardo Honorato Z.
pkgname=vmd
pkgver=1.8.7
pkgrel=1
pkgdesc="Visual Molecular Dynamics"
url="http://www.ks.uiuc.edu/Research/vmd/"
license="VMD"
arch=('i686' 'x86_64')
depends=('libgl' 'xterm' 'mesa' 'libstdc++5' 'libxft' 'cuda-toolkit')
install=vmd.install

# You MUST download the package from the VMD url and put it in the PKGBUILD folder !
# I create this PKGBUILD only to manage this package with pacman.
[ "$CARCH" = "i686" ] && source=(vmd-1.8.7.bin.LINUX.opengl.tar.gz)
[ "$CARCH" = "x86_64" ] && source=(vmd-1.8.7.bin.LINUXAMD64.opengl.tar.gz)

[ "$CARCH" = "i686" ] && md5sums=('ba555cb31846ce5af9badf666fbdad08')
[ "$CARCH" = "x86_64" ] && md5sums=('3a2a3596381f3ed5590b12399ecaaea9')

source+=(vmd.bash LICENSE vmd.desktop vmd.png)
md5sums+=('dfc44c8b15263c5b6b831bc5c60fb3c7'
          'f96134804c5bd9ca4803b06c9836f68c'
          'c8c75b50d50ebac416c525f8dfda3ed6'
          'f67c6a6ee0c8687a5879389f66e278ba')

build() {
  cd $startdir/src/$pkgname-$pkgver
  mkdir -p $startdir/pkg/usr/bin $startdir/pkg/usr/lib
  export VMDINSTALLBINDIR="$startdir"/pkg/usr/bin
  export VMDINSTALLLIBRARYDIR="$startdir"/pkg/usr/lib/vmd
  ./configure
  cd src
  make install
  sed -e '/^#!\/bin\/csh/s/\/bin\/csh/\/usr\/bin\/csh -f/' -e '4d' $startdir/pkg/usr/bin/vmd >$startdir/pkg/usr/bin/vmd2
  sed -e '2c set defaultvmddir="/usr/lib/vmd"' $startdir/pkg/usr/bin/vmd2 >$startdir/pkg/usr/bin/vmd3
  install -D -m755 $startdir/pkg/usr/bin/vmd3 $startdir/pkg/usr/lib/vmd/vmd.csh
  install -D -m755 $startdir/src/vmd.bash $startdir/pkg/usr/lib/vmd/vmd.bash
  install -D -m644 $startdir/src/LICENSE $startdir/pkg/usr/lib/vmd/LICENSE
  install -D -m644 $startdir/src/vmd.desktop $startdir/pkg/usr/share/applications/vmd.desktop
  install -D -m644 $startdir/src/vmd.png $startdir/pkg/usr/share/pixmaps/vmd.png
  rm -f $startdir/pkg/usr/bin/*
  ln -sf /usr/lib/vmd/vmd.bash $startdir/pkg/usr/bin/vmd
}
