# Maintainer: Alucryd <alucryd at gmail dot com>

pkgname=editor-on-fire-svn
pkgver=1010
pkgrel=1
pkgdesc="A song editor for Frets On Fire"
arch=('i686' 'x86_64')
url="http://code.google.com/p/editor-on-fire/"
license=('custom')
depends=('allegro4' 'libpng' 'zlib')
optdepends=('lame: MP3 decoding'
            'vorbis-tools: OGG encoding')
source=('eof' 'eof.desktop')
md5sums=('7109c80973676c9d7c0aad485af05510' 'e755de376de04c36975c047b63061349')

_svntrunk=http://editor-on-fire.googlecode.com/svn/trunk/
_svnmod=editor-on-fire

build() {
    cd "${srcdir}"
    msg "Connecting to SVN server...."
    if [[ -d "${_svnmod}/.svn" ]]; then
        (cd "${_svnmod}" && svn up -r "${pkgver}")
    else
        svn co "${_svntrunk}" --config-dir ./ -r "${pkgver}" "${_svnmod}"
    fi
    msg "SVN checkout done or server timeout"
    cd "${srcdir}/${_svnmod}"
    make
}

package() {
  cd "${srcdir}/${_svnmod}"
  install -Ddm 755 "${pkgdir}/opt"
  cp -R bin "${pkgdir}/opt/editor-on-fire"
  chmod -R 777 "${pkgdir}/opt/editor-on-fire"
  install -Dm 755 "${srcdir}/eof" "${pkgdir}/usr/bin/eof"
  install -dm 755 "${pkgdir}/usr/share/applications"
  install -m 644 "${srcdir}/eof.desktop" "${pkgdir}/usr/share/applications/eof.desktop"
  install -dm 755 "${pkgdir}/usr/share/licenses/editor-on-fire-svn"
  install -m 644 license.txt "${pkgdir}/usr/share/licenses/editor-on-fire-svn/license.txt"
}
