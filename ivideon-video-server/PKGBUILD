# Maintainer: Valentin Elovsky evvsoft@gmail.com
pkgname=ivideon-video-server
pkgver=3.4.1.64
pkgrel=1
pkgdesc="Ivideon video server"
arch=(i686 x86_64)
url="http://ivideon.ru/"
license=('freeware')
depends=("portaudio" "gstreamer0.10" "gstreamer0.10-base-plugins" "gstreamer0.10-good-plugins" "qt4>4.8.1")
conflicts=('ivideon-video-server-nogui')
provides=("ivideon-video-server=$pkgver")
source=("videoserverd.service")
md5sums=('34600c5204956f089147ea5bac6a04ed')

if [[ "$CARCH" == "i686" ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-video-server/ivideon-video-server_${pkgver}_i386.deb")
  md5sums+=('1a40ff3b32054e387aed2a7134f116d2')
fi

if [[ "$CARCH" == "x86_64" ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-video-server/ivideon-video-server_${pkgver}_amd64.deb")
  md5sums+=('b6be3abb4c462959613cc578f9e5f3d8')
fi

build() {
  cd "$srcdir"
  bsdtar xf "$srcdir/data.tar.gz"
  mkdir -p "$srcdir/usr/lib/systemd/system"
  cp videoserverd.service "$srcdir/usr/lib/systemd/system"
}

package() {
  cp -dpr --no-preserve=ownership "$srcdir/opt" "$pkgdir"
  cp -dpr --no-preserve=ownership "$srcdir/usr" "$pkgdir"
}