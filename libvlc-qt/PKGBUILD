pkgname=libvlc-qt
pkgver=0.7.0
pkgrel=9
pkgdesc="A free library used to connect Qt and libvlc libraries"
arch=('i686' 'x86_64')
url="http://projects.tano.si/en/library"
license=('LGPL')
depends=('vlc>=2.0' 'qt>=4.8')
makedepends=('cmake>=2.8.6')
source=("https://github.com/downloads/ntadej/vlc-qt/${pkgname}_${pkgver}_src.tar.gz"
        "missing-git.patch")
md5sums=('df0cfb76e0dbf8c3c94d9d7b0940dfc4'
         '0b3fcd18015db9b5d7d97ce370423c5d')

_optimal_make_jobs() {
	if [ -r /proc/cpuinfo ]; then
		local core_count=$(grep -Fc processor /proc/cpuinfo)
	else
		local core_count=0
	fi

	if [ $core_count -gt 1 ]; then
		echo -n $[$core_count-1]
	else
		echo -n 1
	fi
}

build() {
        cd "$srcdir/${pkgname}-${pkgver}"

        msg 'Applying patches...'
        patch -p1 -i $srcdir/missing-git.patch

	msg 'Running cmake...'
        cmake . -DCMAKE_INSTALL_PREFIX=/usr

	msg 'Running make...'
	make -j$(_optimal_make_jobs)
}

package() {
        cd "$srcdir/${pkgname}-${pkgver}"

	make DESTDIR="$pkgdir" install
}
