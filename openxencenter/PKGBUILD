# Contributor: irgaly <irgaly@fird.net>

pkgname=openxencenter
pkgver=rev227_20100510
pkgrel=4
pkgdesc="An opensource multiplatform clone of XenCenter (Citrix)"
arch=('i686' 'x86_64')
depends=('python2' 'pygtk' 'libglade' 'gtk2' 'rrdtool' 'gtk-vnc')
license=('GPL2')
url="http://www.openxencenter.com/"
source=("http://downloads.sourceforge.net/project/$pkgname/${pkgname}_${pkgver}.tar.gz"
        "oxc"
        "home.patch")
md5sums=('e6e83c595d2a0ad72863953b54fa908c'
         '75306c652ef57904f29fc6e3baef7fca'
         'cae2abac7caea75b87ab5cb5f479e7fd')

build() {
  cd "$srcdir/$pkgname"

  # patch for user settings
  # this patch makes config files to be saved in $HOME/.openxencenter
  patch < $srcdir/home.patch

  # byte compile
  python2 -O -m py_compile *.py

  # copy libraries
  if [ "$CARCH" == "i686" ];then
      _arch="32"
  else
      _arch="64"
  fi
  cp $_arch/oxcgtkvnc.so ./oxcgtkvnc.so
  cp $_arch/liboxcgtk-vnc-1.0.so.0 ./liboxcgtk-vnc-1.0.so.0
  # delete directory
  rm -rf 32 64

  # install
  mkdir -p $pkgdir/usr/share/licenses/$pkgname || return 1
  mkdir -p $pkgdir/opt/$pkgname || return 1
  rm -f ChangeLog README TODO || return 1
  mv LICENSE $pkgdir/usr/share/licenses/$pkgname || return 1
  cp -a * $pkgdir/opt/$pkgname || return 1

  # install launcher
  install -Dm755 $srcdir/oxc $pkgdir/usr/bin/oxc || return 1
}
