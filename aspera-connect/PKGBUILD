# Contributor: Alpinweis <alpinweis@gmail.com>
pkgname=aspera-connect
pkgver=3.3.3
pkgrel=1
pkgdesc="Aspera high-performance transfer browser plug-in (binary only)"
arch=('i686' 'x86_64')
url="http://www.asperasoft.com"
license=('custom')
depends=('gtk2')
optdepends=('libmysqlclient_r.so.15')

if [ "$CARCH" == "i686" ]; then
    source=("http://d3gcli72yxqn2z.cloudfront.net/connect/bin/aspera-connect-3.3.3.81344-linux-32.tar.gz")
    sha512sums=('1ab559b09c75dde0bf043a4c96d3e18e9ca61ec3e988622f3642b39504b428015c4682c1735278a3886b5724e718efad0df3a01d94a91ecc6834ef2bf1e84f13')
elif [ "$CARCH" == "x86_64" ]; then
    source=("http://d3gcli72yxqn2z.cloudfront.net/connect/bin/aspera-connect-3.3.3.81344-linux-64.tar.gz")
    sha512sums=('bac34608e55f517e77c714a3c5bb7f72e26e5087cff577617aba3859d52a82092fe23d6502823b95cfd141187ccd33e56ede322b1c0e9449bfe77860fbc4d517')
fi

build() {
    INSTALL_DIR=/opt/aspera
    PLUGIN_DIR=/usr/lib/mozilla/plugins
    install_script=$srcdir/$(basename "${source[0]}" .tar.gz).sh
    SKIP=`awk '/^__ARCHIVE_FOLLOWS__/ { print NR + 1; exit 0; }' "$install_script"`
    mkdir -p "$pkgdir$INSTALL_DIR" "$pkgdir$PLUGIN_DIR"
    tail -n +$SKIP "$install_script" | tar zxo -C "$pkgdir$INSTALL_DIR"
    ln -s "$INSTALL_DIR/lib/libnpasperaweb.so" "$pkgdir$PLUGIN_DIR/"
}
