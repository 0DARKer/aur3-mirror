# Maintainer: Dalton Miller
pkgname=bittorrent-sync
pkgver=20130521
pkgrel=1
pkgdesc="BitTorrent Sync"
arch=('i686' 'x86_64' 'armv6h')
url="http://labs.bittorrent.com/experiments/sync.html"
license=('custom')
#depends=()
#makedepends=()
#optdepends=()
#conflicts=()
backup=("etc/btsync.conf")
install="${pkgname}.install"
source=("bittorrent-sync.install"
	"bittorrent-sync.service")
sha256sums=("bc9f28d5e12747f6d82b21ae4f1d867289022e453c50206fc501aeab4ec5f2a4"
	    "362d87862289c7dde09bb226b0452dfc33e663a21c45f805b9263ffc48bad14a")

if test "$CARCH" == x86_64; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_x64.tar.gz")
	sha256sums+=("c712d18e03ddac40c5827aa4fb55b4f7f7ae0680562305ec79fae1a5248eddcf")
elif test "$CARCH" == i686; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_i386.tar.gz")
	sha256sums+=("5349141fe78dc7799101e39a3cadacf991a0cff398259211083387c5f0458b0b")
elif test "$CARCH" == armv6h; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_arm.tar.gz")
	sha256sums+=("835455ac3ee79da98216d6833f87ce23de70710c469ada2d1f1251b83caaad46")
fi

build() {
	cd "${srcdir}"
	./btsync --dump-sample-config > btsync.conf
}

package() {
	cd "${srcdir}"
	mkdir -p "${pkgdir}/usr/bin"
	mv btsync "${pkgdir}/usr/bin"
	mkdir -p "${pkgdir}/etc"
	install -m 644 btsync.conf "${pkgdir}/etc"
	mkdir -p "${pkgdir}/usr/lib/systemd/system"
	install -m 644 bittorrent-sync.service "${pkgdir}/usr/lib/systemd/system"
}
