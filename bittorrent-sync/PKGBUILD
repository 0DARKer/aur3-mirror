# Maintainer: Dalton Miller
pkgname=bittorrent-sync
pkgver=20130510
pkgrel=1
pkgdesc="BitTorrent Sync"
arch=('i686' 'x86_64' 'armv6h')
url="http://labs.bittorrent.com/experiments/sync.html"
license=('custom')
#depends=()
#makedepends=()
#optdepends=()
#conflicts=()
backup=("etc/btsync.conf")
install="${pkgname}.install"
source=("bittorrent-sync.install"
	"bittorrent-sync.service")
sha256sums=("bc9f28d5e12747f6d82b21ae4f1d867289022e453c50206fc501aeab4ec5f2a4"
	    "362d87862289c7dde09bb226b0452dfc33e663a21c45f805b9263ffc48bad14a")

if test "$CARCH" == x86_64; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_x64.tar.gz")
	sha256sums+=("66b6f00cdbaef450d13bec754fcbca81addecf3b00c74fd0a0ebff15d7fdbc12")
elif test "$CARCH" == i686; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_i386.tar.gz")
	sha256sums+=("e007b4f08cc7aaef2a4cca66b488c3e370db1a1f4c62fa1915c1f417ccf1e17b")
elif test "$CARCH" == armv6h; then
	source+=("http://btsync.s3-website-us-east-1.amazonaws.com/btsync_arm.tar.gz")
	sha256sums+=("c626936c0c17dbce63d5f6ff5fd59eaa9af7519f9f457c906e888b63bbc9b252")
fi

build() {
	cd "${srcdir}"
	./btsync --dump-sample-config > btsync.conf
}

package() {
	cd "${srcdir}"
	mkdir -p "${pkgdir}/usr/bin"
	mv btsync "${pkgdir}/usr/bin"
	mkdir -p "${pkgdir}/etc"
	install -m 644 btsync.conf "${pkgdir}/etc"
	mkdir -p "${pkgdir}/usr/lib/systemd/system"
	install -m 644 bittorrent-sync.service "${pkgdir}/usr/lib/systemd/system"
}
