# Contributor: Alexandr Boiko <brdcom@ya.ru>
pkgname=accel-ppp
pkgver=1.7.3
pkgrel=1
pkgdesc="Kernel-mode PPTP/PPPoE/L2TP server"
arch=('i686' 'x86_64')
url="http://sourceforge.net/apps/trac/accel-ppp/"
license=('GPL')
depends=('linux>=3.0.1' 'linux-headers>=3.0.1' 'openssl>=0.9.8' 'pcre')
makedepends=('cmake>=2.6' 'gcc>=4.7.1')
optdepends=('net-snmp>=5.x: snmp module support'
	    'lua>=5.x: support lua script IPoE')
conflicts=(accel-ppp-git)
backup=(etc/accel-ppp.conf)
install='accel-ppp.install'
options=('docs')
source=(http://sourceforge.net/projects/${pkgname}/files/$pkgname-$pkgver.tar.bz2
	accel-ppp-default
	accel-pppd
	accel-pppd-pre
	accel-pppd.service
	accel-ppp.lua.example)

md5sums=('bf03f20d9df9a0694e5cd0be9b57d1b6'
         'e6922a52102c5d8562310bdfd17ba9ad'
         '51976b6da3ce81285d934c5aaab2252a'
         '4cb37368d852b70cf398f0557a42026e'
         'e56b4f41a94dfd6b275d831f67d765cc'
         '5690869556a7a543c078025bda2f9c1e')

build() {
	cd ${srcdir}
	mkdir ${pkgname}-build
	cd ${pkgname}-build
	cmake \
		-DBUILD_DRIVER=FALSE \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DLOG_PGSQL=FALSE \
		-DRADIUS=FALSE \
		-DNETSNMP=FALSE \
		-DSHAPER=FALSE \
		../${pkgname}-${pkgver}
	make || return 1
	make DESTDIR=${pkgdir} install || return 1
}
package() {
	install -d -m0755 ${pkgdir}/etc/conf.d
	install -d -m0755 ${pkgdir}/etc/rc.d
	install -d -m0755 ${pkgdir}/etc/snmp
	install -d -m0755 ${pkgdir}/usr/lib/systemd/system
	touch ${pkgdir}/etc/snmp/${pkgname}.conf
	chmod 0640 ${pkgdir}/etc/snmp/${pkgname}.conf 
	install -D -m0644 ${srcdir}/${pkgname}-default ${pkgdir}/etc/conf.d/accel-pppd
	install -D -m0644 ${srcdir}/${pkgname}.lua.example ${pkgdir}/etc/${pkgname}.lua
	install -d -m0755 ${pkgdir}/usr/share/doc/${pkgname}
	install -D -m0644 ${srcdir}/${pkgname}-${pkgver}/README ${pkgdir}/usr/share/doc/${pkgname}/README
	install -D -m0755 ${srcdir}/accel-pppd ${pkgdir}/etc/rc.d/accel-pppd
	install -D -m0600 ${pkgdir}/etc/accel-ppp.conf.dist ${pkgdir}/etc/${pkgname}.conf
	install -D -m0644 ${srcdir}/accel-pppd.service ${pkgdir}/usr/lib/systemd/system/accel-pppd.service
	install -D -m0755 ${srcdir}/accel-pppd-pre ${pkgdir}/usr/sbin/accel-pppd-pre
	rm ${pkgdir}/etc/${pkgname}.conf.dist
	rm -fr ${srcdir}/${pkgname}-build
}
