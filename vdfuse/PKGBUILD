# Maintainer: TDY <tdy@gmx.com>

pkgname=vdfuse
pkgver=82a
pkgrel=2
pkgdesc="A FUSE module for mounting VirtualBox disk images (VDI/VMDK/VHD) on the host"
arch=('i686' 'x86_64')
url="http://forums.virtualbox.org/viewtopic.php?f=26&t=33355"
license=('GPL3')
depends=('fuse' 'virtualbox')
makedepends=('pkgconfig' 'subversion')
optdepends=('python2: for vdautomount')
install=$pkgname.install
source=(http://downloads.sourceforge.net/project/xspect3d/gordstuff/$pkgname-v$pkgver.tgz
        vdautomount-0.1.py::"http://forums.virtualbox.org/download/file.php?id=2865")
#$pkgname-v$pkgver.c::"http://forums.virtualbox.org/download/file.php?id=3303"
#$pkgname-v$pkgver.sh::"http://forums.virtualbox.org/download/file.php?id=2864"
md5sums=('7561b2071cde3ac9e3411b5766406c53'
         'f7044bcbc724983eb7d8ff60bff4d6e9')

build() {
  cd "$srcdir/$pkgname-v$pkgver"
#  svn co -r 30000 http://www.virtualbox.org/svn/vbox/trunk/include/
  . /etc/vbox/vbox.cfg
  sh vdbuild_new ./include $pkgname-v$pkgver.c
}

package() {
  cd "$srcdir/$pkgname-v$pkgver"
  install -Dm755 $pkgname-v$pkgver "$pkgdir/usr/bin/$pkgname"
  sed -i '1s,python,&2,' ../vdautomount-0.1.py
  install -Dm755 ../vdautomount-0.1.py "$pkgdir/usr/bin/vdautomount"
}
