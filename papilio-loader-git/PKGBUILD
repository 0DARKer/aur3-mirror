# Maintainer: Peter Ivanov <ivanovp@gmail.com>
# $Id: PKGBUILD 84937 2010-07-05 17:46:04Z eric $
# Contributor: Tobias Powalowski <tpowa@archlinux.org>

pkgname=papilio-loader-git
pkgver=20111030
pkgrel=1
pkgdesc="Bitstream loader for Papilio One FPGA board."
arch=("i686" "x86_64")
url="https://github.com/GadgetFactory/Papilio-Loader"
license=("GPL2" "LGPL2.1")
depends=(libftd2xx)
makedepends=(git gcc libftd2xx)
#makedepends=(git gcc libftd2xx flex bison)
options=('!strip')
source=()
md5sums=()

_git=git://github.com/GadgetFactory/Papilio-Loader.git

build() {
  msg "Connecting to GIT server..."
  if [[ -d $srcdir/$pkgname-$pkgver ]]; then
    cd $srcdir/$pkgname-$pkgver/Papilio-Loader && git pull || return 1
  else
#    svn co -r 1956 $_svnroot $srcdir/$pkgname-$pkgver || return 1
    mkdir $srcdir/$pkgname-$pkgver
    cd $srcdir/$pkgname-$pkgver
    git clone $_git || return 1
  fi

  msg "GIT checkout done or server timeout"
  cd "$srcdir/$pkgname-$pkgver/Papilio-Loader/Program"
  if [ ! -f ./configure ]; then
    ./autogen.sh
  fi
# ./configure --prefix=/usr CFLAGS="-Wno-error=unused-but-set-variable"
  ./configure --prefix=/usr
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver/Papilio-Loader/Program"
  make DESTDIR="$pkgdir" install
}
