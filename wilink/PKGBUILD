# Maintainer: Spike29 <leguen.yannick@gmail.com>
# Contributor: SpepS <dreamspepser at yahoo dot it>

_pkg=wiLink
pkgname=wilink
pkgver=2.3.3
pkgrel=2
pkgdesc='A Wifirst application for Instant communications'
arch=('i686' 'x86_64')
url='http://opensource.wifirst.net/projects/wilink/'
license=('GPL3')
groups=
provides=
depends=('qt>=4.7.4' 'libmad' 'libvorbis' 'libxss' 'qxmpp-git' 'qdjango' 'libnotify' 'libgnome-keyring' 'libgphoto2')
optdepends=
makedepends=('cmake>=2.8.2')
conflicts=
replaces=
backup=
install="$pkgname.install"
source=('https://download.wifirst.net/public/wiLink-2.3.3.tar.bz2'
	'WILINK_IMPORTS_DIR.patch'
	'PLUGIN_INSTALL_DIR.patch')
md5sums=('535d52a2448d0c26149255d799ded91b'
	 '80500b14a0f82cb8b14f9f7976c03331'
	 '9a9e9b9c316e3a8f3bdeb53c4785a646')
 
build() {
	cd "$scrdir"

	# applying a patch for a correct WILINK_IMPORTS_DIR value on ArchLinux system
	patch -p0 -i WILINK_IMPORTS_DIR.patch

	# applying a patch for a correct PLUGIN_INSTALL_DIR value on ArchLinux system
	patch -p0 -i PLUGIN_INSTALL_DIR.patch

	# building
	cd "$_pkg-$pkgver/"
	mkdir build && cd "build/"
	cmake -DCMAKE_INSTALL_PREFIX=/usr ..
	make
}

package() {
	# installing
	cd "$srcdir/$_pkg-$pkgver/build/"
	make DESTDIR="$pkgdir/" install

 	# higher resolution icon
	install -Dm644 ../src/data/images/128x128/$_pkg.png \
    	"$pkgdir/usr/share/pixmaps/$_pkg.png"
}
