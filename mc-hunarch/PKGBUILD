# Contributor: Sergej Pupykin <ps@lx-ltd.ru>
# Modified: Charlos <hunarch@devall.hu>
pkgname=mc-hunarch
pkgver=4.6.1
pkgrel=12
pkgdesc="midnight commander with utf8 support for HUNArch Linux (charsets do not work)"
arch=('i686' 'x86_64')
url="http://www.ibiblio.org/mc/"
depends=('slang' 'glib2' 'gpm' 'w3m')
makedepends=('pkgconfig' 'patch')
conflicts=('mc' 'mc-colorer' 'mc-mp' 'mc-utf8')
provides=('mc')
source=(http://www.ibiblio.org/pub/Linux/utils/file/managers/mc/mc-$pkgver.tar.gz
00-60-utf8.patch
00-70-utf8-common.patch
00-73-utf8-bottom-buttons-width.patch
00-74-utf8-dialog-filename-truncate.patch
00-75-utf8-cmdline-help.patch
00-76-utf8-hotlist-highlight.patch
00-77-utf8-filename-search-highlight.patch
00-78-utf8-filename-search-input.patch
00-79-utf8-backward-word-off-by-one.patch
00-81-utf8-help-line-drawing-art.patch
00-82-utf8-shift-enter.patch
00-83-utf8-editor-8bit-code.patch
00-84-utf8-complete.patch
00-85-wrong-mode-display.patch
00-90-utf8-slang2.patch
00-91-utf8-slang2-fix.patch
00-92-case-sensitive-find-fix-4.6.1.patch
00-93-promptfix.patch
00-94-sambaconfpath.patch
00-95-delcheck.patch
01-po.patch
02-P.patch
03-up-dir.patch
04-remove-display-bits-settings.patch
05-bash32.patch
06-three-letter-monthname-hack.patch
07-no-x11-for-linux-console.patch
07-open-libx11-by-soname.patch
08-terminal-codes.patch
09-double-click-only-with-first-button.patch
10-amc-1.diff
11-amc-2.diff
12-amc-po.patch
25-large-device-numbers.patch
26-resize.patch
30-mc.ext.patch
31-default-colors-for-root.patch
32-view-iso-uses-extensions.patch
33-xterm-title-bar-fix.patch
34-pcx-info.patch
35-gimp-xcf.patch
36-totem-enqueue.patch
37-dif.patch
38-extfs_deb_fix.patch
39-symcrash.patch
40-cd-try_to_select.patch
41-subshell-dont-swallow-output.patch
42-rpm-obsolete-tags.patch
43-tar-update-from-cvs.patch
44-extfs-iso9660-fixes.patch
45-7zip_extf.patch
46-use_o3tohtml.patch
47-fpm_fdb_vfs.patch
48-extfs-iso9660-charset-fixes.patch
49-extfs-iso9660-dont-use-joliet-if-rockridge-is-present.patch
50-extfs-iso9660-isoinfo-has-one-more-column.patch
60-php.syntax-4.6.0.patch
61-hh-hpp.patch
62-arj.patch
63-pkgbuild-syntax.patch
64-uhu-pkg-add.patch
65-assembly.patch
66-mc.menu.patch
mc.ini
mc.desktop
mcedit.desktop
mc48x28.png
mc16x9.png)

license="GPL2"

md5sums=('18b20db6e40480a53bac2870c56fc3c4'
         'dc7593c02f3dbbd70b54bdac60c616c9'
         '1a6ce1099ff60201e94ce79fa259d49a'
         '200b5cbf44677bf223c7b27b6049af47'
         'a69e5c58be76d3bc3bfc77ec033cb8ac'
         '2653dcef24e8785bad6361159bc2d8ad'
         '833ff8925341dec393dec96524db4188'
         'b9016f03a64d1ddb084e065187f8a7ef'
         'c85b17a3f19dd90fb2bdc44df1e3e548'
         '137453fa58331897815b23288b5b78e2'
         'c3bf07cdaa35329f7fc3ee640349a1cf'
         '78e8f8e02ff747202b213f5bab81ce50'
         '6f53ef05cf711fae856562e48394b274'
         '30d9c2bb857d5df46ee3af934ae5fd9c'
         '39d41637d4ff2f3885b24ba1c5ff8df0'
         'ada2d1eb89d5b1d5f7d5866600a0ea2b'
         'ead3745c6ff83af22ee452a4148d6a2b'
         'f30ab52b7dfc3b35b1bb88cd41e4f5f8'
         '679cf294b8edc535fd3ff96133de2f98'
         'eb67c5639b1d0d0b0b4e7ff25a948667'
         'df9cec5dcd46af42e2084fe7535f6585'
         '62a76ea4d34c2eb9c3f32e345378a26f'
         '72840a398a0d78d1f0829370a22b3736'
         'e74d83e045ce8b0b055417eb9a746aa5'
         '535e4ab0c35ccfb07761a5af31929301'
         '39199f6d276982afe8c8e94a2c79df55'
         '1e16a3901adba33c303ca045a2071dc8'
         '7a005802ea70600be59ed194f5a87877'
         'db341936f25f3e550cd47d880b5a9715'
         'ffd38fb0749c159294eb83046be9cb76'
         'db17922eaf187b4976b9ce263fabd898'
         'a1e1b8ede90829b9adf46435a718198c'
         '54cd6c99d4bfaa1a064b8177009e0540'
         'ad7d38b41b892298a9f6dde38015abb9'
         'c4731083ab4cff12681825dac1cbf43b'
         '021c0a4a0497a6c8747944c6d2091ef3'
         'c64bbd112bff12369f7ecbfdeca259bd'
         'ce17851bc1cf88de534ec56ce1df0d85'
         '81aa378bdc861e302d52900bf3cf85ca'
         '47e2c64d348d99d3753377160bf3b9e0'
         '9d2029f155d0ac1552eaab0d4bf8a70f'
         '9e55066bbf6be1fb66eeea2d84dd437a'
         '1d59b80a2bc3023ada0ab22e1df825c7'
         '9640936b51bc6a71204709071d40ac32'
         '5a4c89ed39f274aa4a40ce0dda911a0f'
         'c1edcf577aadf0af29a3487266e8ef03'
         'a43a1bab52101a06a8c399dce3d886c9'
         'a10283cfcf4a479b546b99637a471937'
         '7bc6a2f92e9e721e736420ea505f2639'
         'e86ac7085d939c397ec22bdcbba04979'
         'd663dbcc6140a8b97775b18ca045a329'
         '506343695bd64925c14225822470579e'
         '729d3c5ab1ce1bde280892436ffa76fd'
         '2d2109aff23e8dc9e686d12e6c36ce32'
         '268fa7cc77447a1f0b1eaaf710e99fe4'
         'a3c73c9675c4f49f2f169652e5a966e0'
         '67b168b44407d28c64019fabb9ed0f6d'
         'd4073e786e16a99484779b1d46e30028'
         'ebee9bccff4fb42413c065d0bab0dd75'
         'd9bb740df2c7e9608c7429b1d6dbeb56'
         '0066d8ee220aea244baaf8248e3e16f2'
         'cc1a2bc1b4a6b3fd87bb5ddcbf78bf5e'
         'bdd93a024a14894b63aead06f0b8fc3b'
         'a34c52f626563c7cec98f255bd242002'
         '999798494115cc21f3a40c54dda1af79'
         '7e9b9ed0c1a2e9cc4791caa8869b9818'
         '27dc318070d5b4b2ac099eb6d31ceb2c'
         'ca292a5db39004a731649b1954e7d204'
         '2082b23def3e16af36ae795ae5844e6b')
sha1sums=('92be0802143245e0fb7e3847d70da614cad7d5fb'
          '2ca4bf20383136208eaaebd080b759f32e9e5235'
          '0f08abd11002e2d8d9634ed09b87e67b2bab4353'
          '961f36d8b2f13ab1accc6db92b5471b81bda73cd'
          'f8b2c38cd1c2a338e23afde3227a6a50c6da6656'
          'c44133df4a5ab604a53dd3beba478ef76bd4da1a'
          'ad206dfe5140525a76880cb884a4a02f91f71d79'
          '6249256f8a620c548234c98185dc83c1be86d761'
          '261add7ac6d39b149641381df9afe18841c6f614'
          'd22b82011b107cafc97d13e3caba71a93a5a7ad7'
          'd3ef5c66f84ce5ab3ac6c94cf8dc0a509675d895'
          '41a8783006bfd8f64477230237ef98c82e1a1888'
          '5a86a0946d4984bcc2e49120957c95b4ee5c4ad6'
          'b4f72239c7b013aeb6357ed8244ee622d9fab229'
          'a4178d74e1820f8069891361cc8135a4aa726c6e'
          '3da302153b8a268a302a76fef121e9f86cfa771e'
          '7ccc43f676059409c5177a327004b72ac082c3ab'
          '4e2f61d5a071ed111c3034891ff4c60798d69530'
          '84e29af1fcb8b95efd9e0ac31bd1aa7fecb9cef4'
          '87c4eaa1769c7ca1bebb76d97dbb7280dca3f10a'
          'f89fe79cff655ee48274a0a90d24663789c5775f'
          'd4b67b5a92c08591bfec3a55b8cbafb71c2a1212'
          'e4ffaf5c66a726598756f3d892837a44c7b95e9d'
          '02ebe5ef98e390f8d0814a8cfd5d1d2709c72972'
          'a33c3ae42c9a8e73bda200a99b599b9e5962e96a'
          'c90f98c84d92e8be629aaa5ef56d4057777ef15a'
          'd2c6c2bdb6a4b416ad0d61a96458f9a0ff8b2a52'
          '29dae7749e063ae755b49e1f9ac04484a8c2d7e9'
          '2085edc9f7f52446c8b2fffbe1a7d289ee77b046'
          '705073b88189e844099f1bd28b0ec9afe71490fd'
          '63c1f56a77165c4e705e57e20731c9415151530a'
          'e3119b8b9f542d28112a7bad4e1c32bc4ab383e0'
          'b1e63612446ffe99657809530c358bb28ec239e3'
          'f7b8ea6048adc43f56b7ca726c4fccad1e8cf8b8'
          '01e369d9daaec140f9b011ea3974166a14953728'
          '4381896b4b0732c6e62484231ad2bf9cf2755c64'
          'd0fd0ea9ff73b168f446c5907d57df6223b8021d'
          '4f322bbb88ab948326dd972940faca8b0c945671'
          '01de1dba142cf925c3af67aa4e5df78c7a81279e'
          '4e5771fc2812c313a71aa570c4ed151dd362541a'
          'b6f126858fb7e01518bf435c696e51600eb1b9e6'
          '27eb3678b811b1aceb600501315e861cde132583'
          '5f0088db4b5deb906acf7ec7ee92fc7b664de34b'
          '5d513db2e7b7e4e80c9214c2a76c027364bc8b2c'
          'dbfeddcf0d4d6fd522ea193b5f6f6f2072f3f57b'
          '1c51d4804e9ae25136d7a329075d666d38ff5b74'
          'b5d9bda2473000b1819dcfba7b7854269bd29f64'
          '195e57d0ba55ff5f4809196694a81fd82ae2b199'
          '4b9320b55cbfbad0ad590b271d5dccd9697097e2'
          '5e1f7679269f93839e9785ace36d8e05aa0bc5b1'
          '264792cba7efc38b7f84790bd57dbe3b09c5b779'
          'd20b67a91fb25d8c7b7aa15819e489446c5fc2a7'
          'd5926db25758a24244b1cf6a21486eebd37383a0'
          'a461d7128a3063849f35713b3bbb30b0711c7ebb'
          '13273d6e98a50777cf9ca7935bcb56f5d6d22135'
          '5e89a5f5e430f5fb6a762b6b6a7d2d4d6e08fbcf'
          'b7a2f2a97f6a357ccb6493873b1e18e95ad1ed8f'
          '53d8484774356d476a2680464fe77a16413aad6e'
          '08a1dc5d328f7d61c540d715748777812e10fd14'
          'd78a390b95f26fd64926fdcb1ad9bec3563048c3'
          '72d513955668dfe773fb1146e3071c533c1e1b8a'
          '59fd3c0551ca2bbb9c599ac05beded4114ed242a'
          'f5d703f0b9cba8597c06187e2c2d2ec89dac3325'
          'f9d91464c2ab9bc322ca53f6f164ef31908d3176'
          'e9e15eeebd755881ea8d863f713cc3af3a1e8a38'
          '03f6865ac9807cfd6def88f79d42b9c389d49b40'
          '465870518a487f04ef651b73e3ebff4c6130b306'
          'f74b319b192211230c1bff42de094f5a40d3efdb'
          '5ce860e70624f478930e5886f19ecf8a80a66022')

build() {
  cd ${startdir}/src/mc-$pkgver
  patch -p1 -i ../00-60-utf8.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-70-utf8-common.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-73-utf8-bottom-buttons-width.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-74-utf8-dialog-filename-truncate.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-75-utf8-cmdline-help.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-76-utf8-hotlist-highlight.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-77-utf8-filename-search-highlight.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-78-utf8-filename-search-input.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-79-utf8-backward-word-off-by-one.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-81-utf8-help-line-drawing-art.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-82-utf8-shift-enter.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-83-utf8-editor-8bit-code.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-84-utf8-complete.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-85-wrong-mode-display.patch || return 1 # From UHU-Linux
  patch -p0 -i ../00-90-utf8-slang2.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-91-utf8-slang2-fix.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-92-case-sensitive-find-fix-4.6.1.patch || return 1 # From Frugalware
  patch -p1 -i ../00-93-promptfix.patch || return 1 # From UHU-Linux
  patch -p1 -i ../00-94-sambaconfpath.patch || return 1 # From Debian (NEW!)
  patch -p1 -i ../00-95-delcheck.patch || return 1 # From Debian (NEW!)
  patch -p1 -i ../01-po.patch || return 1 # From UHU-Linux
  patch -p1 -i ../02-P.patch || return 1 # From UHU-Linux
  patch -p1 -i ../03-up-dir.patch || return 1 # From UHU-Linux
  patch -p1 -i ../04-remove-display-bits-settings.patch || return 1 # From UHU-Linux
  patch -p1 -i ../05-bash32.patch || return 1 # From UHU-Linux
  patch -p1 -i ../06-three-letter-monthname-hack.patch || return 1 # From UHU-Linux
  patch -p1 -i ../07-no-x11-for-linux-console.patch || return 1 # From UHU-Linux
  patch -p1 -i ../07-open-libx11-by-soname.patch || return 1 # From UHU-Linux
  patch -p1 -i ../08-terminal-codes.patch || return 1 # From UHU-Linux
  patch -p1 -i ../09-double-click-only-with-first-button.patch || return 1 # From UHU-Linux
  patch -p1 -i ../10-amc-1.diff || return 1 # From UHU-Linux
  patch -p1 -i ../11-amc-2.diff || return 1 # From UHU-Linux
  patch -p1 -i ../12-amc-po.patch || return 1 # From UHU-Linux
  patch -p1 -i ../25-large-device-numbers.patch || return 1 # From UHU-Linux
  patch -p1 -i ../26-resize.patch || return 1 # From UHU-Linux
  patch -p1 -i ../30-mc.ext.patch || return 1 # From UHU-Linux
  patch -p1 -i ../31-default-colors-for-root.patch || return 1
  patch -p1 -i ../32-view-iso-uses-extensions.patch || return 1
  patch -p1 -i ../33-xterm-title-bar-fix.patch || return 1 # From Frugalware
  patch -p1 -i ../34-pcx-info.patch || return 1 # From UHU-Linux
  patch -p1 -i ../35-gimp-xcf.patch || return 1 # From UHU-Linux
  patch -p1 -i ../36-totem-enqueue.patch || return 1 # From HUNArch-Linux
  patch -p1 -i ../37-dif.patch || return 1 # From UHU-Linux
  patch -p1 -i ../38-extfs_deb_fix.patch || return 1  # From UHU-Linux
  patch -p1 -i ../39-symcrash.patch || return 1 # From UHU-Linux
  patch -p1 -i ../40-cd-try_to_select.patch || return 1 # From UHU-Linux
  patch -p1 -i ../41-subshell-dont-swallow-output.patch || return 1 # From UHU-Linux
  patch -p1 -i ../42-rpm-obsolete-tags.patch || return 1 # From UHU-Linux
  patch -p1 -i ../43-tar-update-from-cvs.patch || return 1 # From UHU-Linux
  patch -p1 -i ../44-extfs-iso9660-fixes.patch # From UHU-Linux
  patch -p1 -i ../45-7zip_extf.patch || return 1 # From UHU-Linux
  patch -p1 -i ../46-use_o3tohtml.patch || return 1 # From UHU-Linux
  patch -p1 -i ../47-fpm_fdb_vfs.patch || return 1 # From UHU-Linux
  patch -p1 -i ../48-extfs-iso9660-charset-fixes.patch || return 1 # From UHU-Linux
  patch -p1 -i ../49-extfs-iso9660-dont-use-joliet-if-rockridge-is-present.patch || return 1 # From UHU-Linux
  patch -p1 -i ../50-extfs-iso9660-isoinfo-has-one-more-column.patch || return 1 # From UHU-Linux
  patch -p1 -i ../60-php.syntax-4.6.0.patch || return 1 # From UHU-Linux
  patch -p1 -i ../61-hh-hpp.patch || return 1 # From UHU-Linux
  patch -p1 -i ../62-arj.patch || return 1 # From UHU-Linux
  patch -p1 -i ../63-pkgbuild-syntax.patch || return 1 # From HUNArch Linux
  patch -p1 -i ../64-uhu-pkg-add.patch || return 1
  patch -p1 -i ../65-assembly.patch || return 1 # From Frugalware
  patch -p1 -i ../66-mc.menu.patch || return 1 # From Debian (NEW!)

  ./configure --prefix=/usr --with-gpm-mouse --with-vfs --with-ext2undel --with-x --with-screen=slang
  make -j2 || return 1
  make DESTDIR=$startdir/pkg install || return 1
  install -m 644 -D $startdir/src/mc.ini $startdir/pkg/usr/share/mc/mc.ini
  # Desktop files
  install -m 644 -D $startdir/src/mc.desktop $startdir/pkg/usr/share/applications/mc.desktop
  install -m 644 -D $startdir/src/mcedit.desktop $startdir/pkg/usr/share/applications/mcedit.desktop
  # --
  
  # Pixmaps files
  install -m 644 -D $startdir/src/mc48x28.png $startdir/pkg/usr/share/pixmaps/mc48x28.png
  install -m 644 -D $startdir/src/mc16x9.png $startdir/pkg/usr/share/pixmaps/mc16x9.png
  # --
  rm $startdir/pkg/usr/share/mc/mc.menu.*
  for i in $startdir/pkg/usr/share/mc/mc.*.{es,it,nl}; do
     iconv -f ISO-8859-1 -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done

  for i in $startdir/pkg/usr/share/mc/mc.*.{cs,hu,pl}; do
     iconv -f ISO-8859-2 -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done

  for i in $startdir/pkg/usr/share/mc/mc.*.sr; do
     iconv -f ISO-8859-5 -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done

  for i in $startdir/pkg/usr/share/mc/mc.*.ru; do
     iconv -f KOI8-R -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done

  for i in $startdir/pkg/usr/share/mc/mc.*.uk; do
     iconv -f KOI8-U -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done

  for i in $startdir/pkg/usr/share/mc/mc.*.zh; do
     iconv -f BIG5 -t UTF-8 < "$i" > "$i".tmp
     mv "$i".tmp "$i"
  done
  
  for i in $startdir/pkg/usr/share/mc/*; do
     if [ -f "$i" ]; then
        iconv -f UTF-8 -t UTF-8 < "$i" > /dev/null
     fi
  done
  
}

