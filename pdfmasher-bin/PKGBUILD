# Maintainer: Dan Serban

pkgname=pdfmasher-bin
pkgver=0.1.1
pkgrel=1
pkgdesc="Convert PDF files containing text into ready-for-ebook HTML files"
arch=(i686 x86_64)
url=http://www.hardcoded.net/pdfmasher/
license=(custom:Fairware)
depends=(python pyqt sip) # Python 3 !!!
makedepends=(mercurial)
_filearch="i386"
md5sums="a4432b80560f8889353e950d8c616299"
[ "${CARCH}" == "x86_64" ] && _filearch="amd64" && md5sums="6dce54cf420983220da69e7f01a84094"
source=("http://download.hardcoded.net/pdfmasher_${pkgver}_${_filearch}.deb")

build()
{
  bsdtar -xf "pdfmasher_${pkgver}_${_filearch}.deb" data.tar.gz
  bsdtar -xf data.tar.gz
  rm data.tar.gz
  rm usr/local/share/pdfmasher/sip.so
  cd usr/local/share/pdfmasher
  rm -r PyQt4 pdfminer
  hg clone https://bitbucket.org/hsoft/pdfminer3k
  mv pdfminer3k/pdfminer .
  rm -r pdfminer3k
  mkdir -p "${pkgdir}"/usr/bin
  cd "${srcdir}"/usr
  mv share "${pkgdir}"/usr/
  cd local/share
  mv pdfmasher "${pkgdir}"/usr/share/
  sed -i 's|#!/usr/bin/env python3.1|#!/usr/bin/python|' "${pkgdir}"/usr/share/pdfmasher/run.py
  USRBINFILE="${pkgdir}"/usr/bin/pdfmasher
  echo "#!/bin/bash" > "${USRBINFILE}"
  echo "cd /usr/share/pdfmasher" >> "${USRBINFILE}"
  echo "python run.py" >> "${USRBINFILE}"
  chmod +x "${USRBINFILE}"
}

