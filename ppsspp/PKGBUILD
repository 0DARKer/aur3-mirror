# Maintainer: Clement Guerin <geecko.dev@free.fr>
# Contributor: Thiago Kenji Okada <thiago DOT mast3r AT gmail DOT com>
pkgname=ppsspp
pkgver=0.8.1
pkgrel=1
pkgdesc="A PSP emulator for Android, Windows, Mac, and Linux, written in C++."
arch=('i686' 'x86_64')
url='http://www.ppsspp.org/'
license=('GPL2')
depends=('zlib' 'sdl')
makedepends=('git' 'cmake' 'gcc')
optdepends=()
provides=()
source=('ppsspp::git://github.com/hrydgard/ppsspp.git#tag=v0.8.1')
md5sums=('SKIP')

build() {
	cd $srcdir/ppsspp

	git submodule update --init

	export LDFLAGS="-lavutil -lavformat -lavcodec -lswscale -lswresample"

	mkdir build
	pushd build
	cmake ..
	make
	popd
}

package() {
	cd $pkgdir

	mkdir -p usr/bin
	mkdir -p usr/share/ppsspp

	cp $srcdir/ppsspp/build/PPSSPPHeadless ./usr/share/ppsspp
	cp $srcdir/ppsspp/build/PPSSPPSDL ./usr/share/ppsspp
	cp -r $srcdir/ppsspp/build/assets/ ./usr/share/ppsspp

	cd ./usr/bin/

	echo '#!/bin/bash' > PPSSPPSDL
	echo 'cd /usr/share/ppsspp' >> PPSSPPSDL
	echo './PPSSPPSDL' >> PPSSPPSDL
	chmod +x PPSSPPSDL

	echo '#!/bin/bash' > PPSSPPHeadless
	echo 'cd /usr/share/ppsspp' >> PPSSPPHeadless
	echo './PPSSPPHeadless' >> PPSSPPHeadless
	chmod +x PPSSPPHeadless
}
