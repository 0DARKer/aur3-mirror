# Maintainer: Lukas Jirkovsky <l.jirkovsky@gmail.com>
pkgname=gdebugger
pkgver=6.2.438
pkgrel=3
pkgdesc="An advanced OpenGL and OpenCL debugger, profiler and memory analyzer"
arch=('i686' 'x86_64')
url="http://developer.amd.com/tools/heterogeneous-computing/amd-gdebugger/"
license=('custom')
depends=('libpng12' 'libgl' 'libcl')
options=(!strip)

# the sources must be manually downloaded from:
#   http://developer.amd.com/tools/heterogeneous-computing/amd-gdebugger/

if [ "$CARCH" = "i686" ]; then
  _arch=x86
  source=(gDEBugger_LNX_6.2_32.tar.gz \
          gDEBugger.sh gdebugger.png gdebugger.desktop)
  md5sums=('61542aa500d93f4389ab1eaaeb0cb3de'
           '1a95288feca80f2cc4ab03c312d5d0c4'
           '7236dccfd1dc47aec9812fb449b243d2'
           'e0f9de6f04a29be8ff8b5deae6bb964f')
else
  _arch=x86_64
  source=(gDEBugger_LNX6.2_64.tar.gz \
          gDEBugger.sh gdebugger.png gdebugger.desktop)
  md5sums=('9c2e9f7ee425cc9279b7f99d19e80be6'
           '1a95288feca80f2cc4ab03c312d5d0c4'
           '7236dccfd1dc47aec9812fb449b243d2'
           'e0f9de6f04a29be8ff8b5deae6bb964f')
fi

package() {
  install -d -m755 "$pkgdir/opt"
  cp -a gDEBugger$pkgver-$_arch  "$pkgdir/opt/gDEBugger"

  install -D -m755 "gDEBugger.sh" "$pkgdir/usr/bin/gDEBugger"
  install -D -m755 "gdebugger.png" "$pkgdir/usr/share/pixmaps/gdebugger.png"
  install -D -m755 "gdebugger.desktop" "$pkgdir/usr/share/applications/gdebugger.desktop"
  install -D -m644 "gDEBugger$pkgver-$_arch/Legal/EndUserLicenseAgreement.htm" "$pkgdir/usr/share/licenses/$pkgname/EULA.htm"

  # add symlink to libOpenCL.so.1 and libGL.so  on 64bit, otherwise gDEBugger won't work
  # WARNING: if you build any OpenGL or OpenCL applications while this package is installed, 
  # be aware that you may run into problems with them after uninstalling this package,
  # because the package may be linked to libraries in /usr/lib64 instead of /usr/lib
  if [ "$CARCH" = "x86_64" ]; then
    install -d -m755 "$pkgdir/usr/lib64"
    ln -sf /usr/lib/libOpenCL.so.1 "$pkgdir"/usr/lib64/libOpenCL.so.1
    ln -sf /usr/lib/libGL.so.1 "$pkgdir"/usr/lib64/libGL.so.1
  fi
}

# vim:set ts=2 sw=2 et:
