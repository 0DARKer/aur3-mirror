# Maintainer: carstene1ns <carsten.1 gmx net>

_pkgbase=opendune
pkgname=$_pkgbase-git
_gitname=OpenDUNE
pkgver=0.7.06e478c
pkgrel=1
pkgdesc="Open source re-creation of the popular game Dune II"
arch=('i686' 'x86_64')
url="https://github.com/OpenDUNE/OpenDUNE"
license=('GPL2')
depends=('sdl' 'alsa-lib')
makedepends=('git')
optdepends=('timidity++: midi music support')
conflicts=('opendune')
provides=('opendune')
install="$_pkgbase.install"
source=("git://github.com/OpenDUNE/OpenDUNE.git"
	"$_pkgbase.sh"
	"$_pkgbase.desktop"
	"$_pkgbase.png")
md5sums=('SKIP'
	'acaaaca7340f9b5d8c1d7ccc001ddf57'
	'2ff96b1efe864b1426f950005625af35'
	'4a6fef6e5bdde8ee7f038554bc5ed93b')

pkgver() {
  cd $_gitname

  # get last annotated tag from packed refs
  echo $(tail -n 2 .git/packed-refs | head -n 1 | cut -d "/" -f 3).$(git rev-parse --short master)
}

build() {
  cd $_gitname

  ./configure --prefix-dir=/opt/opendune

  make
}

package() {
  cd $_gitname

  make INSTALL_ICON_DIR="$pkgdir/opt/$_pkgbase" INSTALL_BINARY_DIR="$pkgdir/opt/$_pkgbase" INSTALL_DOC_DIR="$pkgdir/opt/$_pkgbase/doc" install

  # install binary, icon and desktop files
  install -d "$pkgdir/usr/bin"
  install -m755 "$srcdir/$_pkgbase.sh" "$pkgdir/usr/bin/$_pkgbase"
  install -d "$pkgdir/opt/$_pkgbase/data"
  install -m644 "$srcdir/$_gitname/bin/data/put_dune2_here.txt" "$pkgdir/opt/$_pkgbase/data"
  install -Dm644 "$srcdir/$_pkgbase.png" "$pkgdir/usr/share/pixmaps/$_pkgbase.png"
  install -Dm644 "$srcdir/$_pkgbase.desktop" "$pkgdir/usr/share/applications/$_pkgbase.desktop"
}
