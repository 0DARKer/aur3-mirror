# Contributor: Joeny Ang <ang(dot)joeny(at)gmail(dot)com>

pkgname=shotwell-git
_pkgname=shotwell
pkgver=20110801
pkgrel=1
pkgdesc="A digital photo organizer designed for the GNOME desktop environment"
arch=('i686' 'x86_64')
url="http://yorba.org/shotwell/"
license=('LGPL2.1')
depends=('gconf' 'libgexiv2-git' 'json-glib' 'libgee' 'libgphoto2' 'librsvg' 'libunique' 'libwebkit')
makedepends=('intltool' 'libraw' 'pkgconfig' 'git' 'vala>=0.11.7')
provides=('shotwell')
conflicts=('shotwell')
install=${_pkgname}.install
         
_gitroot="git://git.yorba.org/${_pkgname}"
_gitname="${_pkgname}"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."
  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi
  msg "GIT checkout done or server timeout"

  msg "Starting make..."
  rm -rf ${srcdir}/${_gitname}-build
  git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
  cd ${srcdir}/${_gitname}-build
  
  ./configure --prefix=/usr \
    --with-gconf-schema-file-dir=/usr/share/gconf/schemas \
    --disable-schemas-install \
    --disable-desktop-update \
    --disable-icon-update \
    --disable-schemas-compile
  make
}

package() {
  cd ${srcdir}/${_pkgname}-build
  make DESTDIR=${pkgdir} install

  # Remove gschemas.compiled file
  rm ${pkgdir}/usr/share/glib-2.0/schemas/gschemas.compiled
}
