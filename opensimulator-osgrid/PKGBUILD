# Contributor: Anton Bazhenov <anton.bazhenov at gmail>
# Contributor: LTSmash <lord.ltsmash@gmail.com>
# Maintainer: Zauber Exonar <zauberexonar at gmail>

pkgname=opensimulator-osgrid
pkgver=01122010.v0.6.9.482dcb7
pkgrel=0
pkgdesc="OSGrid's distribution of OpenSimulator, preconfigured to connect with OSGrid"
arch=('i686' 'x86_64')
url="http://www.osgrid.org/elgg/"
license=('BSD')
depends=('mono' 'sqlite3' 'mysql')
optdepends=('mono-old')
makedepends=('nant' 'unzip')
install=$pkgname.install
source=(http://osgrid.org/download/osgrid.opensim-$pkgver.zip \
  osgrid.sh OpenSim.ini-$pkgver)
md5sums=('2fe5e654777a03b61c7a7167ebd14414'
		         '8ad5aab5c434aef00d12b08343a5da5a'
		         '253bb36cd7635a5b48300060c649bbf8')

build() {
  cd "$srcdir"/bin

  cp $startdir/OpenSim.ini-$pkgver OpenSim.ini || return 1
  cp OpenSim.ini OpenSim.ini.example || return 1

  #copying Mono.Posix.dll so that OpenSimulator can use sockets, and by extension MySQL
  cp /usr/lib/mono/1.0/Mono.Posix.dll Mono.Posix.dll || return 1
  # install
  install -d "$pkgdir"/opt/$pkgname/bin
  cp -r ./* "$pkgdir"/opt/$pkgname/bin/
  # set permissions
  find "$pkgdir"/opt/$pkgname/bin -type d -exec chmod 755 {} +
  find "$pkgdir"/opt/$pkgname/bin -type f -exec chmod 644 {} +
  find "$pkgdir"/opt/$pkgname/bin -name "*.exe" -exec chmod 755 {} +
  find "$pkgdir"/opt/$pkgname/bin -name "*.ini" -exec chmod 666 {} +
  find "$pkgdir"/opt/$pkgname/bin -name "*.xml" -exec chmod 666 {} +
  chmod 777 "$pkgdir"/opt/$pkgname/bin/{,*/}
  chmod 755 "$pkgdir"/opt/$pkgname/bin/opensim-ode.sh
  # chmod 666 "$pkgdir"/opt/$pkgname/bin/OpenSim.log
  # install launch script
  install -m755 -D ../osgrid.sh "$pkgdir"/usr/bin/osgrid
}
