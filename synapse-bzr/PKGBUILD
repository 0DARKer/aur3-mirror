# Maintainer: ValHue <vhuelamo at gmail dot com>
# https://github.com/ValHue/AUR-PKGBUILDs
#
# Contributor: Ignacio Losiggio <naquo at geneu dot co dot cc>
# Contributor: Ner0 <darkelfdarkelf666 at yahoo dot co dot uk>

_pkgname="synapse"
pkgname="${_pkgname}-bzr"
pkgver=507
pkgrel=1
pkgdesc="A semantic file launcher"
arch=('i686' 'x86_64')
url="http://launchpad.net/synapse-project"
license=('GPL3')
depends=('gtkhotkey' 'hicolor-icon-theme' 'json-glib' 'libgee06' 'libnotify' 'libunique' 'libzeitgeist' 'rest' 'xdg-utils')
makedepends=('bzr' 'gnome-common' 'intltool' 'vala')
optdepends=('banshee: banshee plugin'
			'bc: calculator plugin'
			'devhelp: documentation plugin'
			'gnome-screensaver: screensaver plugin'
			'gnome-dictionary: dictionary plugin'
			'openssh: ssh plugin'
			'pastebinit: pastebin plugin'
			'rhythmbox: rhythmbox plugin'
			'xnoise: xnoise plugin'
			'zeitgeist-extensions: For best integration [AUR]')
conflicts=('synapse')
provides=('synapse')
install="${pkgname}.install"

_bzrtrunk="lp:synapse-project"
_bzrmod="trunk"

pkgver() {
	cd "${srcdir}/${_bzrmod}"
	bzr revno
}

build() {
	cd "${srcdir}"
	msg "Connecting to Bazaar server...."

	if [ -d ${_bzrmod} ]; then
		cd ${_bzrmod} && bzr merge
		msg "The local files are updated."
	else
		bzr branch ${_bzrtrunk}/${_bzrmod}
	fi

	msg "BZR checkout done or server timeout"
	msg "Starting make..."

	rm -rf "{$srcdir}/${_bzrmod}-build"
	cp -r "${srcdir}/${_bzrmod}" "${srcdir}/${_bzrmod}-build"

	cd "${srcdir}/${_bzrmod}-build"
	CFLAGS="$CFLAGS -lm"

	./autogen.sh \
	--prefix=/usr \
	--enable-zeitgeist=yes

	make ${MAKEFLAGS}
}

package() {
	cd "${srcdir}/${_bzrmod}-build"
	make DESTDIR="${pkgdir}" install
}
