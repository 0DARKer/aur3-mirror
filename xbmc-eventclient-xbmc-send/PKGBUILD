# Contributor: Nicolas Qui√©not < niQo at aur > 

pkgname=xbmc-eventclient-xbmc-send
pkgver=20110102
pkgrel=1
pkgdesc='XBMC Event server'
arch=('any')
url='https://xbmc.svn.sourceforge.net/svnroot/xbmc/trunk/tools/EventClients/'
license=('GPL')
makedepends=('subversion')
depends=('python2' 'xbmc') 

_svnroot="http://xbmc.svn.sourceforge.net/svnroot/xbmc/trunk/tools/EventClients/"
_svnname="EventClients"

build() {
  cd "$srcdir"
  msg "Connecting to SVN server...."

  if [ -d $_svnname ] ; then
    cd $_svnname && svn up
    msg "The local files are updated."
  else
    svn co $_svnroot $_svnname
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_svnname-build"
  cp -r "$srcdir/$_svnname" "$srcdir/$_svnname-build"

  cd "$srcdir/$_svnname-build"
  find ./ -name '.svn' -type d | xargs rm -rf

}

package() {
  cd "$srcdir/$_svnname-build"

  mkdir -p {$pkgdir/usr/lib/python2.7/site-packages/xbmc/,$pkgdir/usr/share/pixmaps/xbmc/,$pkgdir/usr/bin/}
  cp -r lib/python/* ${pkgdir}/usr/lib/python2.7/site-packages/xbmc/
  cp -r icons/ ${pkgdir}/usr/share/pixmaps/xbmc/
  echo "ICON_PATH="/usr/share/pixmaps/xbmc/"" >> ${pkgdir}/usr/lib/python2.7/site-packages/xbmc/defs.py
  sed -i -e 's|#!/usr/bin/python$|#!/usr/bin/python2|' Clients/XBMC\ Send/xbmc-send.py 
  install -Dm755 Clients/XBMC\ Send/xbmc-send.py ${pkgdir}/usr/bin/xbmc-send || return 1
}

