# Maintainer: Pavle Simovic <xpio at tesla.rcub.bg.ac dot rs>

pkgname=footbrawl
pkgver=1.0
pkgrel=2
pkgdesc="Footbrawl Quest is a turn based football game featuring the Knights vs the Undead."
url="http://forums.tigsource.com/index.php?topic=29644.0"
arch=('i686' 'x86_64')
license=('unknown')
depends=('java-runtime')
makedepends=('gendesk')
changelog=ChangeLog
source=($pkgname-$pkgver.zip::https://dl.dropbox.com/s/958sry0iz2qesse/$pkgname-$pkgver.zip?dl=1
	$pkgname.sh)
md5sums=('e859eff35fbc6432c9fa5046a5b5b806'
         '64913f9a63336447306cd4dc309799c8')
_name='Footbrawl Quest'

build() {
  # generate desktop file
  cd "$srcdir"
  gendesk 
}

package() {
  cd "$srcdir/$pkgname"

  # copy desktop file and icon
  install -D -m 664 ../footbrawl.desktop $pkgdir/usr/share/applications/footbrawl.desktop
  install -D -m 664 res/images/appIcon32x32.png $pkgdir/usr/share/pixmaps/footbrawl.png

  # cleanup, then move jar and resources to /usr/share
  rm -rf lib/natives-{macosx,windows}
  if test "$CARCH" == x86_64; then
    rm -rf lib/natives-linux/lib*{x,l}.so
  else # important for stripping
    rm -rf lib/natives-linux/lib*64.so
  fi
  install -d $pkgdir/usr/share/$pkgname
  mv *.jar lib res $pkgdir/usr/share/$pkgname

  # create and copy empty configuration file to var, then link it to usr
  echo '{}' > game.cfg
  install -d -m775 -o root -g games $pkgdir/var/games
  install -d -m775 -o root -g games $pkgdir/var/games/$pkgname
  install -m 664 -o root -g games game.cfg $pkgdir/var/games/$pkgname/game.cfg
  ln -s $pkgdir/var/games/$pkgname/game.cfg $pkgdir/usr/share/$pkgname

  # copy run script
  install -D $srcdir/$pkgname.sh $pkgdir/usr/bin/$pkgname

  # copy documentation
  install -d $pkgdir/usr/share/doc/$pkgname
  mv *.txt $pkgdir/usr/share/doc/$pkgname
}
