# Maintainer: Nathan Owe <ndowens.aur at gmail dot com>
pkgname=dradis
pkgver=2.7.0
pkgrel=2
pkgdesc="Open source framework to enable effective information sharing"
arch=('i686' 'x86_64')
url="http://dradisframework.org/"
license=('GPL2')
options=('!emptydirs')
depends=('sqlite3' 'sqlite3-ruby' 'ruby-bundler' 'ruby-redcloth' 'ruby-rails')
install='install'
source=("http://downloads.sourceforge.net/$pkgname/$pkgname-v$pkgver.tar.bz2")
md5sums=('94df3099cadc044569718a7bdeecec5e')

build() {
	cd "$srcdir/$pkgname-2.7"
	/bin/true;
}
package() {
	cd "$srcdir/$pkgname-2.7"
	install -d $pkgdir/{usr/bin,opt/$pkgname}
	cp -aR {readme.txt,*.sh} $pkgdir/opt/$pkgname/
	cp -R server/ $pkgdir/opt/$pkgname/
	
	#Fix Gemfile to require rails 3.0.7 instead of 3.0.6 since it doesn't find 3.0.6 even though 3.0.7 is installed
	sed -i 's|3.0.6|3.0.7|g' server/Gemfile

	#Fix location of "server" dir
	sed -i 's|cd server|cd /opt/dradis/server|g' start.sh reset.sh
	install -Dm755 start.sh \
		$pkgdir/usr/bin/$pkgname-start

	install -Dm755 reset.sh \
		$pkgdir/usr/bin/$pkgname-reset
}
