# Maintainer: Pierre Bourdon <delroth@gmail.com>
# Contributor: Ondrej Jirman <megous@megous.com>

pkgname=mingw32-openssl
pkgver=1.0.0e
upstream_pkgver=1.0.0e
pkgrel=2
arch=('any')
pkgdesc="Toolkit implementing the Secure Sockets Layer (SSL v2/v3) and Transport Layer Security (TLS v1) protocols. Mingw32 build."
depends=('mingw32-runtime' 'mingw32-zlib')
options=(!strip)
license=('BSD')
url="http://www.openssl.org"
source=(http://www.openssl.org/source/openssl-$upstream_pkgver.tar.gz)
md5sums=('7040b89c4c58c7a1016c0dfa6e821c86')

build()
{
  cd $srcdir/openssl-$upstream_pkgver

  ./Configure --cross-compile-prefix=i486-mingw32- \
              -DOPENSSL_NO_CAPIENG \
              --prefix=/usr/i486-mingw32 mingw shared zlib-dynamic

  make
  make INSTALL_PREFIX=$pkgdir install
  install -m755 -o 0 -g 0 libeay32.dll ssleay32.dll \
    $pkgdir/usr/i486-mingw32/bin/

  cd $pkgdir
  find . -name '*.a' -o -name '*.dll' -o -name '*.exe' | xargs -rtl1 i486-mingw32-strip -g
  rm -rf usr/i486-mingw32/{bin/c_rehash,ssl/misc,ssl/man}
}
