# Maintainer: Iwan Timmer <irtimmer at gmail dot com>

pkgname=rtklib-git
pkgver=20131209
pkgrel=1
pkgdesc="An open-source program for GNSS positioning"
url="http://rtklib.com/"
license=("GPL")
arch=('i686' 'x86_64' 'armv7h')
makedepends=('git')

_gitroot="https://github.com/tomojitakasu/RTKLIB.git"
_gitname="RTKLIB"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."

  if [ -d "${srcdir}/${_gitname}" ] ; then
    cd ${_gitname} && git pull --rebase
  else
    git clone ${_gitroot}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}/${_gitname}/app

  cd pos2kml/gcc
  make
  cd ../..

  cd str2str/gcc
  make
  cd ../..

  cd rnx2rtkp/gcc
  make
  cd ../..

  cd convbin/gcc
  make
  cd ../..

  cd rtkrcv/gcc
  make
  cd ../..

}

package() {
  mkdir -p $pkgdir/usr/local/bin
 
  cd ${srcdir}/${_gitname}

  mkdir -p $pkgdir/usr/share/rtklib
  cp -R data $pkgdir/usr/share/rtklib/data

  cd app

  cd pos2kml/gcc
  make BINDIR=$pkgdir/usr/local/bin install 
  cd ../..

  cd str2str/gcc
  make BINDIR=$pkgdir/usr/local/bin install 
  cd ../..

  cd rnx2rtkp/gcc
  make BINDIR=$pkgdir/usr/local/bin install 
  cd ../..

  cd convbin/gcc
  make BINDIR=$pkgdir/usr/local/bin install 
  cd ../..

  cd rtkrcv/gcc
  make BINDIR=$pkgdir/usr/local/bin install 
  cd ../..

}
