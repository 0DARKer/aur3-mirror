# Maintainer: mareex <marcus.behrendt.86[at]gmail[dot]com>

pkgname=sumo
pkgver=0.20.0
pkgrel=7
pkgdesc="SUMO is an open source, highly portable, microscopic and continuous road traffic simulation package designed to handle large road networks"
arch=('any')
url="http://sumo-sim.org"
license=('GPL')
depends=('gcc-libs' 'glibc' 'fox' 'xerces-c' 'glu' 'libgl')
makedepends=('make' 'gcc' 'help2man')
source=("http://sourceforge.net/projects/sumo/files/sumo/version%200.20.0/${pkgname}-all-0.20.0.tar.gz" 
        "${pkgname}.desktop"
        "${pkgname}.install")
sha256sums=('901585d603b7e5b506e0487136a07c8c452a73cf759a3cc9bdc95944761066be'
            '2f2e549d3cf724e7d90bc97fbe03ece9c37c35045f49979478511381471929de'
            'a6c0cb518976570f8e49ad787c80a455d70409661d7730a11851e9ddc514faa9')
install=${pkgname}.install


build() {
    cd ${srcdir}/${pkgname}-${pkgver}
    ./configure --prefix=/usr
    make
    make man
}

package() {
    mkdir -p ${pkgdir}/usr/bin
    mkdir -p ${pkgdir}/usr/lib/${pkgname}/data
    mkdir -p ${pkgdir}/usr/lib/${pkgname}/tools
    mkdir -p ${pkgdir}/usr/share/applications
    mkdir -p ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}
    mkdir -p ${pkgdir}/usr/share/man/man1
    mkdir -p ${pkgdir}/usr/share/pixmaps

    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/activitygen ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/dfrouter ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/duarouter ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/emissionsDrivingCycle ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/emissionsMap ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/jtrrouter ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/netconvert ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/netgenerate ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/od2trips ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/polyconvert ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/sumo ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/sumo-gui ${pkgdir}/usr/bin/
    install -m0755 ${srcdir}/${pkgname}-${pkgver}/bin/TraCITestClient ${pkgdir}/usr/bin/


    SAVEIFS=$IFS
    IFS=$(echo -en "\n\b")

    ln -s ${pkgdir}/usr/bin ${pkgdir}/usr/lib/${pkgname}/bin

    cd ${srcdir}/${pkgname}-${pkgver}/data
    for d in $(find . -type d)
    do
        mkdir -p ${pkgdir}/usr/lib/${pkgname}/data/$d
    done
    for f in $(find . -type f)
    do
        install -m0644 $f ${pkgdir}/usr/lib/${pkgname}/data/$f
    done

    cd ${srcdir}/${pkgname}-${pkgver}/tools
    for d in $(find . -type d)
    do
        mkdir -p ${pkgdir}/usr/lib/${pkgname}/tools/$d
    done
    for f in $(find . -type f)
    do
        install -m0644 $f ${pkgdir}/usr/lib/${pkgname}/tools/$f
    done

    # install .desktop file
    install -m0644 ${srcdir}/sumo.desktop ${pkgdir}/usr/share/applications

    # instal pixmap
    install -m0644 ${srcdir}/${pkgname}-${pkgver}/docs/userdoc/logo.png ${pkgdir}/usr/share/pixmaps/sumo.png


    cd ${srcdir}/${pkgname}-${pkgver}/docs
    for d in $(find . -type d)
    do
        mkdir -p ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}/$d
    done
    for f in $(find . -type f)
    do
        install -m0644 $f ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}/$f
    done
    install -m0644 ${srcdir}/${pkgname}-${pkgver}/AUTHORS ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}
    install -m0644 ${srcdir}/${pkgname}-${pkgver}/ChangeLog ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}
    install -m0644 ${srcdir}/${pkgname}-${pkgver}/COPYING ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}
    install -m0644 ${srcdir}/${pkgname}-${pkgver}/README ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}

    rm -rf ${pkgdir}/usr/share/doc/${pkgname}-${pkgver}/man

    cd ${srcdir}/${pkgname}-${pkgver}/docs/man
    for d in $(find . -type d)
    do
        mkdir -p ${pkgdir}/usr/share/man/man1/$d
    done
    for f in $(find . -type f)
    do
        install -m0644 $f ${pkgdir}/usr/share/man/man1/$f
    done
}
