pkgname=softethervpn-git
pkgver=20140108
pkgrel=2
pkgdesc="Multi-protocol VPN Program from University of Tsukuba"
arch=('i686' 'x86_64')
source=('git+https://github.com/SoftEtherVPN/SoftEtherVPN.git')
md5sums=('SKIP')
license=('GPL')
url="http://www.softether.org/"

pkgver(){
  date -I|tr -d '-'
}

build(){
  cd "${srcdir}"/SoftEtherVPN
  if [ "${CARCH}" == "i686" ]; then
    cp src/makefiles/linux_32bit.mak Makefile
  elif [ "${CARCH}" == "x86_64" ]; then
    cp src/makefiles/linux_64bit.mak Makefile
  fi
  make
}

package(){
  cd "${srcdir}"/SoftEtherVPN
  install -d "${pkgdir}"/usr/{bin,vpnbridge,vpncmd,vpnclient,vpnserver}
  for inst in vpnclient vpnserver vpnbridge vpncmd
  do
    cp bin/${inst}/${inst} "${pkgdir}"/usr/${inst}/${inst}
    cp bin/${inst}/hamcore.se2 "${pkgdir}"/usr/${inst}/hamcore.se2
    echo "#!/bin/sh" > "${pkgdir}"/usr/bin/${inst}
    echo /usr/${inst}/${inst} '"$$@"' >> "${pkgdir}"/usr/bin/${inst}
    echo 'exit $?' >> "${pkgdir}"/usr/bin/${inst}
    chmod 755 "${pkgdir}"/usr/bin/${inst}
  done
}
