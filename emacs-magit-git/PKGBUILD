# Maintainer: Peter Simons <simons@cryp.to>
# Contributor: Just Lest <just.lest@gmail.com>
# Contributor: Daniel White <daniel@whitehouse.id.au>
pkgname=emacs-magit-git
pkgver=20110325
pkgrel=1
pkgdesc="It's Magit! A Emacs mode for Git."
arch=("i686" "x86_64")
url="http://github.com/philjackson/magit"
license=("GPL3")
groups=()
depends=('emacs' 'git')
makedepends=('automake' 'autoconf')
provides=(emacs-magit)
conflicts=()
replaces=()
backup=()
options=()
install=${pkgname}.install
source=()
noextract=()
md5sums=()

_gitroot="git://github.com/philjackson/magit.git"

build()
{
  cd "${srcdir}"

  if [ -d magit ] ; then
    cd magit || return 1
    git pull origin || return 1
  else
    git clone "${_gitroot}" || return 1
  fi

  rm -rf "${srcdir}/magit-build"
  cp -r "${srcdir}/magit" "${srcdir}/magit-build" || return 1
  cd "${srcdir}/magit-build" || return 1

  make || return 1
  make PREFIX="/usr" DESTDIR="$pkgdir" install || return 1

  rm -rf "${pkgdir}/usr/etc"
  rm "${pkgdir}/usr/share/info/dir"
}
