# Maintainer: Linus Sj√∂gren <thelinx@unreliablepollution.net>
# Contributor: Eric Forgeot < http://anamnese.online.fr >, dreeze
pkgname=love-jit
pkgver=0.7.1
pkgrel=2
pkgdesc="An open-source 2D game engine which uses the versatile Lua scripting language to create dynamic gaming experiences. This package uses LuaJIT as a backend."
arch=(i686 x86_64)
url="http://love2d.org/"
license=('zlib')
depends=('luajit2' 'physfs' 'freetype2' 'devil' 'mpg123' 'openal' 'libvorbis' 'libmodplug')
makedepends=('wget')
install=('love.install')
conflicts=('love')
provides=('love')
source=("https://bitbucket.org/rude/love/downloads/love-$pkgver-linux-src.tar.gz"
        "https://bitbucket.org/rude/love/raw/$pkgver/platform/unix/app.svg"
        "https://bitbucket.org/rude/love/raw/$pkgver/platform/unix/game.svg"
        "https://bitbucket.org/rude/love/raw/ac5db845cd6b/platform/unix/love.desktop"
        "https://bitbucket.org/rude/love/raw/$pkgver/platform/unix/love.xml")
md5sums=('c0a4a621f4c26fd17589447d7d24639f'
         'a1e19f91420cc519a683af360f5b1120'
         '16f2ecc899c9ffc8b7b7c807f8967861'
         '971bec1bffe4f424972eef2a26d27bec'
         'b4f00fb1cb80057a0a371a994100d418')

build() {
	cd `find $srcdir/love-*`
	./configure --prefix=/usr LDFLAGS="" CXXFLAGS="$CXXFLAGS" --enable-luajit || return 1
	make DESTDIR=$pkgdir install || return 1

	mkdir -p $pkgdir/usr/share/icons/hicolor/scalable/mimetypes
	mkdir -p $pkgdir/usr/share/icons/hicolor/scalable/apps
	mkdir -p $pkgdir/usr/share/applications
	mkdir -p $pkgdir/usr/share/mime/packages

	install -Dm0644 $srcdir/app.svg \
		$pkgdir/usr/share/icons/hicolor/scalable/apps/love.svg
	install -Dm0644 $srcdir/game.svg \
		$pkgdir/usr/share/icons/hicolor/scalable/mimetypes/gnome-mime-application-x-love-game.svg
	install -Dm0644 $srcdir/love.desktop \
		$pkgdir/usr/share/applications/$pkgname.desktop
	install -Dm0644 $srcdir/love.xml \
		$pkgdir/usr/share/mime/packages/love.xml
	install -Dm0644 license.txt \
		$pkgdir/usr/share/licenses/$pkgname/license.txt
}
