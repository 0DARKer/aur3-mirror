16a17,18
>     this->restoreWindowState();
> 
113a116,118
>     if (this->isVisible()) {
>        this->saveWindowState();
>     }
117a123,130
> void MainWindow::closeEvent(QCloseEvent *event)
>  {
>     if (this->isVisible()) {
>        this->saveWindowState();
>     }
>     event->accept();
>  }
> 
121a135,149
>     this->restoreWindowState();
> }
> 
> void MainWindow::saveWindowState()
> {
>     QSettings settings;
>     settings.setValue("mainWindowGeometry", saveGeometry());
>     settings.setValue("mainWindowState", saveState());
> }
> 
> void MainWindow::restoreWindowState()
> {
>     QSettings settings;
>     restoreGeometry(settings.value("mainWindowGeometry").toByteArray());
>     restoreState(settings.value("mainWindowState").toByteArray());
126,127c154,161
<     if (QSystemTrayIcon::Trigger == reason)
<         this->showAndRaise();
---
>      if (QSystemTrayIcon::Trigger == reason) {
>         if (this->isVisible()) {
>            this->saveWindowState();
>            this->hide();
>         } else {
>            this->showAndRaise();
>         }
>      }
