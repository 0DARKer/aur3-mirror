# Contributor: and <and@ebrilo.jp>

pkgname=tvoeradio-desktop-hg
pkgver=2.0a
pkgrel=1
pkgdesc="Multiplatform client to listen music from VK.com (VKontakte.ru) and Last.fm services. Mercurial version with hide/show mainwindow patch."
arch=('i686' 'x86_64')
url="http://tvoeradio.org/desktop/"
license=('GPL')
depends=('qt' 'qtwebkit')
makedepends=('gcc' 'make' 'pkgconfig' 'mercurial' 'patch')
conflicts=('tvoeradio-desktop-svn' 'tvoeradio-desktop')
provides=('tvoeradio-desktop')
replaces=('tvoeradio-desktop-svn' 'tvoeradio-desktop')
source=('mainwindow.cpp.patch' 'mainwindow.h.patch')
md5sums=('bbc8786cc317db02eff70caa66ab0d18' '7c52373c35428f77f0fc680f7617a113')

build() {
  hg clone https://bitbucket.org/eXtractor/tvoeradio-desktop || return 1
  patch $startdir/src/tvoeradio-desktop/src/mainwindow.cpp $startdir/mainwindow.cpp.patch || return 1
  patch $startdir/src/tvoeradio-desktop/src/mainwindow.h $startdir/mainwindow.h.patch || return 1
  cd $startdir/src/tvoeradio-desktop/src

  qmake || return 1

  make || return 1
  make INSTALL_ROOT="${pkgdir}" install || return 1

# Add freedesktop compatibility
  install -D -m 664 $srcdir/tvoeradio-desktop/src/img/tvoeradio-desktop.png $pkgdir/usr/share/pixmaps/tvoeradio-desktop.png || return 1
  install -D -m 664 $srcdir/tvoeradio-desktop/src/tvoeradio-desktop.desktop $pkgdir/usr/share/applications/tvoeradio-desktop.desktop || return 1
}
