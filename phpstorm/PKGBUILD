# Maintainer: D. Can Celasun <dcelasun[at]gmail[dot]com>
# Contributor: Slava Volkov <sv99sv[at]gmail[dot]com>

pkgname=phpstorm
_pkgname=PhpStorm  # Directory name in the tar file
pkgver=2.1.5
pkgrel=1
pkgdesc="Lightweight and Smart PHP IDE. 30-day free trial."
arch=('i686' 'x86_64')
url="http://www.jetbrains.com/phpstorm/"
license=('custom')
depends=('jdk')
source=(http://download.jetbrains.com/webide/PhpStorm-${pkgver}.tar.gz)
md5sums=('8075fca30a7b56fdf189631db82dfb1f')

build() {
  cd ${srcdir}
  mkdir -p ${pkgdir}/opt/${pkgname}
  cp -R ${srcdir}/${_pkgname}-107.658/* ${pkgdir}/opt/${pkgname}
  if [[ $CARCH = 'i686' ]]; then
     rm -f ${pkgdir}/opt/${pkgname}/bin/libyjpagent64.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/libbreakgen64.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/fsnotifier64
  fi
  if [[ $CARCH = 'x86_64' ]]; then
     rm -f ${pkgdir}/opt/${pkgname}/bin/libyjpagent.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/libbreakgen.so
     rm -f ${pkgdir}/opt/${pkgname}/bin/fsnotifier
  fi

(
cat <<EOF
[Desktop Entry]
Version=${pkgver}
Name=PhpStorm
Icon=phpstorm
GenericName=Lightweight and Smart PHP IDE
Comment=Lightweight and Smart PHP IDE
Exec=/opt/${pkgname}/bin/PhpStorm.sh
Terminal=false
Type=Application
Categories=Development
EOF
) > ${startdir}/phpstorm.desktop

  mkdir -p ${pkgdir}/usr/share/pixmaps/
  mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}/
  mkdir -p ${pkgdir}/usr/share/applications/
  install -m 644 ${startdir}/phpstorm.desktop ${pkgdir}/usr/share/applications/
  install -m 644 ${pkgdir}/opt/${pkgname}/bin/webide.png ${pkgdir}/usr/share/pixmaps/phpstorm.png
  install -m 644 ${srcdir}/${_pkgname}-107.658/license/PhpStorm_license.txt ${pkgdir}/usr/share/licenses/${pkgname}/PhpStorm_license.txt
}

