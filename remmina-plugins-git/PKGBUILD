# Maintainer: Christian Hesse <mail@eworm.de>

pkgname=remmina-plugins-git
pkgver=20111230
pkgrel=1
pkgdesc="Remmina remote desktop client plugins - git checkout "
arch=(i686 x86_64)
url="http://remmina.sourceforge.net/"
license=('GPL')
provides=(remmina-plugins)
conflicts=(remmina-plugins)
depends=(remmina-git freerdp-git zlib libjpeg avahi vte libssh libgcrypt libunique)
makedepends=(git cmake intltool pkgconfig gettext libxdmcp)
install=remmina-plugins.install
source=(include.patch)

_gitroot="https://github.com/FreeRDP/Remmina"
_gitname="remmina"

build() {
	cd "${srcdir}"
	msg "Connecting to GIT server...."

	if [ -d ${_gitname} ]; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot} ${_gitname}
	fi
	msg "GIT checkout done or server timeout"

	msg "Cloning to build directory"
	rm -rf "${srcdir}/${_gitname}-build"
	git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"

	msg "Starting make..."

	cd "${srcdir}/${_gitname}-build/"

	# fix include
	# pull request is open, but not yet merged
	patch -Np1 < ${srcdir}/include.patch

	cmake ./ -DCMAKE_INSTALL_PREFIX=/usr

	cd "remmina-plugins/"
	make
	make DESTDIR=${pkgdir} install
}
md5sums=('cdd46677ee293a376a0d11e02ae6b236')
