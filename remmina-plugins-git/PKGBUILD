# Maintainer: Christian Hesse <mail@eworm.de>

pkgname=remmina-plugins-git
pkgver=20111109
pkgrel=1
pkgdesc="Remmina remote desktop client plugins - git checkout "
arch=(i686 x86_64)
url="http://remmina.sourceforge.net/"
license=('GPL')
provides=(remmina-plugins)
conflicts=(remmina-plugins)
depends=(remmina-git freerdp-git zlib libjpeg avahi vte libssh libgcrypt libunique)
makedepends=(git intltool pkgconfig gettext libxdmcp)
install=remmina-plugins.install

_gitroot="https://github.com/FreeRDP/Remmina"
_gitname="remmina"

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server...."

  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${srcdir}/${_gitname}-build"
  git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"
  cd "${srcdir}/${_gitname}-build"
    
  cd "${srcdir}/${_gitname}-build/remmina-plugins/"
  ./autogen.sh
  # Disable RDP for now... FreeRDP had a complete ABI rewrite and the remmina
  # plugin is not yet updated.
  ./configure --prefix=/usr \
	--enable-nls \
	--enable-ssh \
	--enable-rdp \
	--enable-vnc \
	--enable-xdmcp \
	--enable-nx \
	--enable-telepathy || return 1
  make || return 1
  make DESTDIR=${pkgdir} install
}
md5sums=()
