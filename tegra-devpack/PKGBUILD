# Contributor: giniu <gginiu@gmail.com>
pkgname=tegra-devpack
pkgver=1.0r4
_pkgver=1.0
_pkgdate=2011-12-22
_pkgbuild=11617556
pkgrel=2
pkgdesc="The Tegra Android Developer Pack, eclipse tools and documentation"
license=('custom')
arch=('i686' 'x86_64')
url="http://developer.nvidia.com/category/zone/mobile-development"

depends=('eclipse>=3.7.1' 'eclipse-cdt>=8.0.0' 'eclipse-android>=15.0.1'
         'apache-ant>=1.8.2' 'android-sdk>=r16' 'android-ndk>=r7'
         'android-sdk-platform-tools>=r9' 'tegra-toolkit')

[ "$CARCH" = "i686"   ] && _pkgarch="linux"
[ "$CARCH" = "x86_64" ] && _pkgarch="linux-x64"
source=("http://developer.nvidia.com/sites/default/files/akamai/tools/files/Tegra/$pkgname-$_pkgver-$_pkgarch-$_pkgdate-$_pkgbuild.run"
        "license")
[ "$CARCH" = "i686"   ] && md5sums=('625948ff13c8a087fdc0362c180fd8fc')
[ "$CARCH" = "x86_64" ] && md5sums=('3fd0e350626c4ef124bc9718db05192f')
md5sums+=('8e7f961bc6688fdbf8cc241fe247f21d')

options=(!strip)

build() {
  cd "${srcdir}"
  if [ -e ~/NVPACK ]
  then
    echo "Sorry, Tegra Toolkit installer is broken"
    echo "it needs to extract to ~/NVPACK and the file is already present"
    echo "rename or delete the file and try again"
    return 1
  fi
  msg "Downloading components of Tegra Developer Pack..."
  rm -rf instinfo
  for i in {1..12}
  do
    echo >> instinfo
  done
  echo "y" >> instinfo # accept license
  echo "n" >> instinfo # we install SDK and NDK from packages
  echo "n" >> instinfo # samples are in tegra-toolkit
  echo "n" >> instinfo # samples are in tegra-toolkit
  echo "n" >> instinfo # we install Eclipse, CDT and ADT from packages
  echo "y" >> instinfo #  (debuger)
  echo "n" >> instinfo # we install apache-ant from packages
  echo "y" >> instinfo #  (documentation)
  chmod a+x ./$pkgname-$_pkgver-$_pkgarch-$_pkgdate-$_pkgbuild.run
  cat instinfo | ./$pkgname-$_pkgver-$_pkgarch-$_pkgdate-$_pkgbuild.run --mode text > /dev/null
  rm -rf "$srcdir/NVPACK"
  mv ~/NVPACK "$srcdir/NVPACK"
  msg "Finished downloading Tegra Developer Pack"
  cd "$srcdir/NVPACK"
  install -m 644 -D "docs/NVIDIA Debug Manager for Android NDK.pdf" "$pkgdir/usr/share/tegra/docs/NVIDIA Debug Manager for Android NDK.pdf"
  install -d "$pkgdir/usr/share/eclipse/dropins/tegra-devkit/eclipse"
  unzip -o "NVDebugMgrForAndroidNDK_14.0.0.zip" -d "$pkgdir/usr/share/eclipse/dropins/tegra-devkit/eclipse"
  cd "$srcdir"
  install -m 644 -D license "$pkgdir/usr/share/licenses/$pkgname/license"
}

