# Contributor: Clement Siuchung Cheung <clement.cheung@umich.edu>

pkgname=lib-compat
pkgver=1.4.1
pkgrel=1
pkgdesc="Gentoo lib compat for old programs only available in binary"
arch=('i686')
url="http://www.gentoo.org/"
source=(http://distfiles.gentoo.org/distfiles/${pkgname}-${pkgver}.tar.bz2)
md5sums=('ec4a4528295b5879ad055e44c4a6d463')
license=('GPL2')

build() {
  cd $startdir/src/${pkgname}-${pkgver}/x86

  # Install /lib files
  mkdir -p $startdir/pkg/lib
  mv ld-linux.so.1* $startdir/pkg/lib

  # Install /usr/lib files
  mkdir -p $startdir/pkg/usr/lib
  mv *.so* $startdir/pkg/usr/lib

  # Fix files
  cd $startdir/pkg/usr/lib
  mv -f libstdc++-libc6.2-2.so.3 libstdc++-3-libc6.2-2-2.10.0.so
  ln -s libstdc++-3-libc6.2-2-2.10.0.so libstdc++-libc6.2-2.so.3
  mv -f libstdc++-libc6.1-1.so.2 libstdc++-2-libc6.1-1-2.9.0.so
  ln -s libstdc++-2-libc6.1-1-2.9.0.so libstdc++-libc6.1-1.so.2
  ln -s libstdc++.so.2.8.0 libstdc++.so.2.8
  ln -s libstdc++.so.2.7.2.8 libstdc++.so.2.7.2
  ln -s libg++.so.2.7.2.8 libg++.so.2.7.2
  rm -f libstdc++.so.2.9.dummy libstdc++.so.2.9.0
  rm -f libsmpeg-0.4.so.0.dummy
}