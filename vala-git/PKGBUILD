# $Id: PKGBUILD 3145 2009-09-28 10:00:46Z ibiru $
# Previous Contributor: Timm Preetz <timm@preetz.us>
# Previous Contributor: Alexander Fehr <pizzapunk gmail com>
# Previous Contributor: Thijs Vermeir <thijsvermeir@gmail.com>
# Contributor: Flamelab <panosfilip@gmail.com>

pkgname=vala-git
pkgver=20110223
pkgrel=1
pkgdesc="Compiler for the GObject type system"
arch=('i686' 'x86_64')
url="http://live.gnome.org/Vala"
license=('LGPL')
depends=('glib2')
makedepends=('libxslt' 'vala' 'git')
options=('!libtool')
conflicts=('vala' 'vala-devel')
provides=('vala')

_gitroot="git://git.gnome.org/vala"
_gitname="vala"


build() {
  cd ${srcdir}/

    msg "Connecting to the GIT server...."
    if [[ -d ${srcdir}/${_gitname} ]] ; then
    	cd ${_gitname}
    	git pull origin
    	msg "The local files are updated..."
    else
    	git clone ${_gitroot}
    fi
    
    msg "GIT checkout done."

    msg "Starting make for: ${pkgname}"
    
    if [[ -d ${srcdir}/${_gitname}-build ]]; then
       msg "Cleaning the previous build directory..." 
       rm -rf ${srcdir}/${_gitname}-build
    fi

    git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
    
    cd ${srcdir}/${_gitname}-build

     ./autogen.sh \
           --prefix=/usr \
           --enable-vapigen
    make

}

package() {

  cd ${srcdir}/${_gitname}-build

  make DESTDIR="$pkgdir" install

}