# Maintainer: OS Hazard <oshazard+aur@gmail.com>
pkgname=gtkdialog-svn
pkgver=503
pkgrel=5
pkgdesc="Gtkdialog is a small utility for fast and easy GUI building (SVN)"
arch=('i686' 'x86_64' 'arm')
url="https://code.google.com/p/gtkdialog"
license=('GPL')
depends=('gtk' 'libglade' 'vte')
makedepends=('svn' 'automake')
provides=('gtkdialog')
conflicts=('gtkdialog')
source=('missing.automake-1.13')
md5sums=('ba67d589a17b479cb3f568cd7b52b0c3')
install=gtkdialog.install

_svntrunk=http://gtkdialog.googlecode.com/svn/trunk
_svnmod=gtkdialog

build() {
  cd "$srcdir"
  svn checkout $_svntrunk --config-dir ./ $_svnmod
  msg "SVN checkout done or server timeout"
  cd $_svnmod

  msg "Patching..."
  # Doc here: http://www.flameeyes.eu/autotools-mythbuster/forwardporting/automake.html
  cp "$srcdir/missing.automake-1.13" missing
  mv configure.in configure.ac
  sed -i 's/AM_CONFIG_HEADER(\[config.h\])/AC_CONFIG_HEADERS(\[config.h\])/g' configure.ac
  sed -i 's/AM_PROG_CC_STDC/AC_PROG_CC/g' configure.ac
  sed -i 's/configure\.in/configure\.ac/g' autogen.sh

  msg "Starting configure..."
  ./autogen.sh --prefix=/usr --mandir=/usr/share/man --infodir=/usr/share/info

  msg "Running make..."
  make
}

package() {
  cd $_svnmod
  make DESTDIR=$pkgdir UPDATE_ICON_CACHE=true install
  rm -f $pkgdir/usr/share/info/dir
  mkdir -p $pkgdir/usr/share/doc/$pkgname
  cp -a examples $pkgdir/usr/share/doc/$pkgname/examples
}

