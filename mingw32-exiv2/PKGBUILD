# Contributor: Alexander 'hatred' Drozdov <adrozdoff@gmail.com>

pkgname=mingw32-exiv2
_pkgname=exiv2
pkgver=0.20
pkgrel=2
pkgdesc="Exif and Iptc metadata manipulation library and tools."
arch=('i686' 'x86_64')
url="http://exiv2.org"
license=('GPL2')
depends=('mingw32-gcc' 'mingw32-zlib' 'mingw32-expat' 'mingw32-libltdl')
options=('!libtool')
source=("http://www.exiv2.org/${_pkgname}-${pkgver}.tar.gz")
md5sums=('3173d08a4313dc94b7bd1b7cdbda2093')

build() {
  unset LDFLAGS
  cd ${srcdir}/${_pkgname}-${pkgver}
  ./configure --prefix=/usr/i486-mingw32 --build=$CHOST --host=i486-mingw32
  
  # Fix executables extensions
  sed -i 's|BINARY = $(BINSRC:.cpp=)|BINARY = $(BINSRC:.cpp=$(EXEEXT))|;
          s|EXIV2BIN = $(EXIV2MAIN:.cpp=)|EXIV2BIN = $(EXIV2MAIN:.cpp=$(EXEEXT))|;
          s|MCBIN = $(MCMAIN:.cpp=)|MCBIN = $(MCMAIN:.cpp=$(EXEEXT))|;
          s|-o $@ $(LIBRARY) $@.o|-o $@ $(LIBRARY) $(BINOBJ)|
          s|$(BINARY): %: %.o lib|$(BINARY): lib $(BINOBJ)|' src/Makefile
  
  make
}

package() {
  cd ${srcdir}/${_pkgname}-${pkgver}
  make DESTDIR=${pkgdir} install
  find ${pkgdir} -name '*.exe' | xargs rm
}
