# Maintainer: Mariano Street <mstreet@kde.org.ar>

pkgname=sapphire-desktop-git
_basename=sapphire
pkgver=20110516
pkgrel=1
pkgdesc='Innovative and usability-oriented desktop environment'
arch=(i686 x86_64)
url="http://gitorious.org/delphos/$basename"
license=('GPL')
groups=('sapphire')
depends=('qt' 'libdelta' 'libxtst' 'openbox' 'wmctrl' 'xbindkeys')
makedepends=('qt' 'libdelta' 'git' 'cmake' 'patch')
optdepends=('xterm: default terminal emulator'
            'scope-git: Sapphire file manager'
            'lcl-git: Live Command Line')
provides=('sapphire-desktop')
source=(frontendcontainer.patch radialmenuhelper.patch)
md5sums=('6928f1d876b6967eb836465999d9075b'
         'bf4323af62abcb69a74143f6a1391707')

_gitroot="git://gitorious.org/delphos/$_basename.git"
_gitname="$_basename"

build ()
{
    cd "$srcdir"
    msg 'Connecting to GIT server....'
    
    if [ -d $_gitname ]; then
        cd $_gitname && git pull origin
        msg 'The local files are updated.'
    else
        git clone $_gitroot $_gitname
    fi
    
    msg 'GIT checkout done or server timeout.'
    msg 'Starting make...'
    
    rm -rf "$srcdir/$_gitname-build"
    git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"
    
    patch -Nup0 <"$startdir/frontendcontainer.patch"
    patch -Nup0 <"$startdir/radialmenuhelper.patch"
    echo '' >common/envvar_check.cmake
    sed -i "s|\$ENV{DELPHOSPREFIX}|$pkgdir/usr|g" common/common_dirs.cmake
    sed -i "s|\$ENV{DELPHOSPREFIX}|/usr|g" common/find_libdelta.cmake
    DELPHOSPREFIX="$pkgdir/usr" ./compile_and_install.sh
}
