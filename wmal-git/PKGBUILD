# Maintainer: Joost Bremmer < toost dot b at gmail dot com>

pkgname=wmal-git
pkgver=20130322
pkgrel=3
pkgdesc="A lightweight and simple updater for MyAnimeList, Melative or VNDB."
arch=('x86_64' 'i686')
url="http://z411.github.io/wmal-python/"
license=('GPLv3')
depends=('python2'
)
makedepends=('python2'
'desktop-file-utils'
'git')
optdepends=('pygtk'
'python2-urwid'
)
source=('wmal-gtk.desktop'
'wmal.install')
sha256sums=('4f875379349658c1f0156d1cb8063617e385c9fe394782412274a602fdd88a03'
            'afaba0235e36839e7a19ed29dd76b4b5f5d823690413f360a713f0019da27cbc')


_gitroot=https://github.com/z411/wmal-python.git
_gitname=wmal

pkgver() {
  cd "${srcdir}/${_gitname}"
  git log -1 --format="%cd" --date=short | sed 's|-||g'
}


build() {
   cd $srcdir/
   msg "Connecting to GIT server...."

   if [[ -d ${_gitname} ]]; then
     cd ${_gitname} && git pull origin
     msg "The local files are updated."
   else
     git clone ${_gitroot} ${_gitname}
   fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "${srcdir}/${_gitname}-build"



}

package() {
   cd $srcdir/${_gitname}-build
   python2 setup.py install --prefix=/usr --root=${pkgdir} --optimize=1
   install -Dm644 ${srcdir}/wmal-gtk.desktop $pkgdir/usr/share/applications/wmal-gtk.desktop
}
