# Maintainer: old_bay

pkgname=dnc-kassa
pkgver=1.2.6
pkgrel=5
pkgdesc="Densi-kassa: API for Russian buisness hardvare platform and POS for linux"
url="http://dnc-soft.ru"
arch=(i686 x86_64)
license=(GK DENSI)
conflicts=()
depends=('postgresql' 'postgresql-libs' 'qt')
makedepends=()
source=("ftp://ftp.dnc.ru/DNC_KASSA_${pkgver}.patch${pkgrel}.iso" dnc.confd dnc-server.rc dnc.desktop dnc_createdb)
install=dnc.install

build()
{
  chmod +w -R ${srcdir}
  cd ${srcdir}/dnc_kassa
  
  # installation  script -  from the original script
  
  if [[ $CARCH == i686 ]]; then
   BIN='./bin'
   LIBS='./libs'
  else
   BIN='./bin_64'
   LIBS='./libs_64'
  fi

  mkdir ${pkgdir}/etc/{rc.d,conf.d} -p
  mkdir ${pkgdir}/usr/{bin,lib,share} -p
  mkdir ${pkgdir}/var
  mkdir -m 777 ${pkgdir}/var/Exchange
  # installing configuration files
  mkdir -m 777 ${pkgdir}/etc/dancy
  cp ./etc/dancy/* ${pkgdir}/etc/dancy
  chmod 666 ${pkgdir}/etc/dancy/*
  mkdir -m 777 ${pkgdir}/etc/hwsrv
  cp ./etc/hwsrv/* ${pkgdir}/etc/hwsrv
  chmod 666 ${pkgdir}/etc/hwsrv/*
  
  mkdir ${pkgdir}/usr/share/dnc
  mkdir -m 777 ${pkgdir}/usr/share/dnc/movie
  cp ./movie/* ${pkgdir}/usr/share/dnc/movie
  mkdir -m 777 ${pkgdir}/usr/share/dnc/print_doc
  cp ./Example_print_document/* ${pkgdir}/usr/share/dnc/print_doc
  chmod 666 ${pkgdir}/usr/share/dnc/print_doc/*
  mkdir -m 777 ${pkgdir}/usr/share/dnc/icons_for_icewm_menu
  cp ./addon_conf/icons_for_icewm_menu/* ${pkgdir}/usr/share/dnc/icons_for_icewm_menu
  chmod 777 ${pkgdir}/usr/share/dnc/icons_for_icewm_menu/*
  mkdir -m 777 ${pkgdir}/usr/share/dnc/db
  mkdir -m 777 ${pkgdir}/usr/share/dnc/db/LinCash
  cp ./db/LinCash/* ${pkgdir}/usr/share/dnc/db/LinCash
  chmod 666 ${pkgdir}/usr/share/dnc/db/LinCash/*
  mkdir -m 777 ${pkgdir}/usr/share/dnc/db/Transaction
  cp ./db/Transaction/* ${pkgdir}/usr/share/dnc/db/Transaction
  chmod 666 ${pkgdir}/usr/share/dnc/db/Transaction/*
  mkdir -m 777 ${pkgdir}/usr/share/dnc/db/DiscountMobile
  cp ./db/DiscountMobile/* ${pkgdir}/usr/share/dnc/db/DiscountMobile
  chmod 666 ${pkgdir}/usr/share/dnc/db/DiscountMobile/*
  
  cp ./addon_conf/Export_Import_bd/* ${pkgdir}/usr/bin
  chmod 777 ${pkgdir}/usr/bin/*

  # installing binary programs and scripts
  cp $BIN/Display ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/Display
  cp $BIN/RMK ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/RMK
  cp $BIN/SetupLoadUnload ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/SetupLoadUnload
  cp $BIN/WareProject ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/WareProject
  cp $BIN/AccessRights ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/AccessRights
  cp $BIN/confGUI ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/confGUI
  cp $BIN/daemon_unload ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/daemon_unload
  cp $BIN/reshka ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/reshka
  cp $BIN/upload ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/upload
  cp $BIN/run_reshka ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/run_reshka
  cp $BIN/FindHardPath ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/FindHardPath
  cp $BIN/dnc_update ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/dnc_update
  cp $BIN/update_from_cd ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/update_from_cd
  cp $BIN/reshkaver ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/reshkaver
  cp $BIN/SectionSetup ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/SectionSetup
  cp $BIN/dnc_taxinspector ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/dnc_taxinspector
  cp $BIN/dnc_screen_scrot ${pkgdir}/usr/bin
  chmod 755 ${pkgdir}/usr/bin/dnc_screen_scrot
  cp $BIN/dnc_edsd ${pkgdir}/usr/bin/
  chmod 755 ${pkgdir}/usr/bin/dnc_edsd
  cp $BIN/dnc_configtool ${pkgdir}/usr/bin/
  chmod 755 ${pkgdir}/usr/bin/dnc_configtool
  # Install createdb file
  install -D -m 755 ${srcdir}/dnc_createdb ${pkgdir}/usr/bin/dnc_createdb

  # installing share loaded libraries
  cp $LIBS/* ${pkgdir}/usr/lib
  chmod 755 ${pkgdir}/usr/lib/libdnc*
  chmod 755 ${pkgdir}/usr/lib/libhwsrv.so
  cd ${pkgdir}/usr/lib
  ln -s libdncdecoder_qt4.so.1.0.0 libdncdecoder_qt4.so.1
  ln -s libpq.so.5 libpq.so.4
  cd ${srcdir}/dnc_kassa

  # making update system for DNC project
  mkdir -m 777 ${pkgdir}/dnc_update
  mkdir -m 777 ${pkgdir}/dnc_update/bin
  mkdir -m 777 ${pkgdir}/dnc_update/libs
  mkdir -m 777 ${pkgdir}/dnc_update/libs64

  # making archdb system for DNC project
  mkdir -m 777 ${pkgdir}/dnc_arch

  # dnc_iso_update
  cp ./addon_conf/scripts_for_iso-update/* ${pkgdir}/usr/bin
  chmod 777 ${pkgdir}/usr/bin/dnc_gksu_iso
  chmod 777 ${pkgdir}/usr/bin/dnc_iso-update

  #installing daemon script and confd
  install -Dm 755 ${srcdir}/dnc-server.rc ${pkgdir}/etc/rc.d/dnc-server
  install -Dm 644 ${srcdir}/dnc.confd ${pkgdir}/etc/conf.d/dnc-server

  # Install the icon file
  install -D -m 644 ${pkgdir}/usr/share/dnc/icons_for_icewm_menu/dnc3.png ${pkgdir}/usr/share/pixmaps/dnc.png

  # Install desktop file
  install -D -m 644 ${srcdir}/dnc.desktop ${pkgdir}/usr/share/applications/dnc.desktop

}
md5sums=('ce93123b42f11ecb98da6885d0385a41'
         'b5d6218f4d2426701e022c315a54d6b5'
         '8e65a6f22ccfffd0453537e13f711607'
         '8cca6ce9e6b38c2bd7205cb65cb1f98a'
         'b24ec74f1f597131dc3393873dc59cd6')
