pkgname=python2-tlslite
pkgver=0.4.4
pkgrel=1
pkgdesc="SSL/TLS support for Python, with numerous options."
arch=(any)
url="http://trevp.net/tlslite"
license=("custom:public domain" "BSD")
depends=(python2-distribute)
makedepends=(python2)
conflicts=(python-tlslite)
provides=(python-tlslite)
replaces=(python-tlslite)
optdepends=("pycrypto: fast ciphers and fast RSA operations"
"gmpy: fast RSA and SRP operations")
source=("https://pypi.python.org/packages/source/t/tlslite/tlslite-$pkgver.tar.gz")
md5sums=('1f8c4d37ed911b0b8d42703be0374618')

build() {
  cd "${srcdir}/tlslite-${pkgver}"
  python2 setup.py build
}

package() {
  cd "${srcdir}/tlslite-${pkgver}"
  python2 setup.py install --root=${pkgdir}
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -m644 README "$pkgdir/usr/share/licenses/$pkgname/"
  
  # Patch to use python2
  find $pkgdir -type f \( -name '*.py' -or -executable \) -exec \
    sed -i -e "s|#![ ]*/usr/bin/python$|#!/usr/bin/python2|" \
           -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" \
    \{\} +
}
