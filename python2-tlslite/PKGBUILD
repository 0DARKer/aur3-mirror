pkgname=python2-tlslite
pkgver=0.4.3
pkgrel=1
pkgdesc="SSL/TLS support for Python, with numerous options."
arch=(any)
url="http://trevp.net/tlslite"
license=("custom:public domain" "BSD")
depends=(python2-distribute)
makedepends=(python2)
conflicts=(python-tlslite)
provides=(python-tlslite)
replaces=(python-tlslite)
optdepends=("pycrypto: fast ciphers and fast RSA operations"
"gmpy: fast RSA and SRP operations")
source=("https://github.com/downloads/trevp/tlslite/tlslite-$pkgver.tar.gz")
md5sums=('7a8305dcb66aef4f7a5180e3dcd5eaf3')

build() {
  cd "${srcdir}/tlslite-${pkgver}"
  python2 setup.py build
}

package() {
  cd "${srcdir}/tlslite-${pkgver}"
  python2 setup.py install --root=${pkgdir}
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
  install -m644 README "$pkgdir/usr/share/licenses/$pkgname/"
  
  # Patch to use python2
  find $pkgdir -type f \( -name '*.py' -or -executable \) -exec \
    sed -i -e "s|#![ ]*/usr/bin/python$|#!/usr/bin/python2|" \
           -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" \
    \{\} +
}
