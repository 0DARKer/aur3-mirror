--- jpegoptim.c	2014-05-13 06:12:59.000000000 +0200
+++ jpegoptim.c.1	2014-05-22 11:03:20.500633825 +0200
@@ -6,7 +6,7 @@
  * requires libjpeg (Independent JPEG Group's JPEG software 
  *                     release 6a or later...)
  *
- * $Id: 3294c746daf62ea2022151031d1499ac9fe3c4a1 $
+ * $Id$
  */
 
 #ifdef HAVE_CONFIG_H
@@ -58,7 +58,7 @@
 };
 typedef struct my_error_mgr * my_error_ptr;
 
-const char *rcsid = "$Id: 3294c746daf62ea2022151031d1499ac9fe3c4a1 $";
+const char *rcsid = "$Id$";
 
 
 int verbose_mode = 0;
@@ -187,18 +187,16 @@
 {
   struct jpeg_error_mgr jcerr;
   struct jpeg_compress_struct cinfo;
-  char jmsg_buf[JMSG_LENGTH_MAX];
+
   
   printf(PROGRAMNAME " v%s  %s\n",VERSIO,HOST_TYPE);
   printf("Copyright (c) 1996-2014  Timo Kokkonen.\n");
 
   cinfo.err = jpeg_std_error(&jcerr);
-  cinfo.err->msg_code=JMSG_VERSION;
-  COPY_JPEG_ERRSTR(&cinfo,jmsg_buf);
-  printf("\nlibjpeg version: %s\n",jmsg_buf);
-  cinfo.err->msg_code=JMSG_COPYRIGHT;
-  COPY_JPEG_ERRSTR(&cinfo,jmsg_buf);
-  printf("%s\n",jmsg_buf);
+
+  printf("\nlibjpeg version: %s\n%s\n",
+	 cinfo.err->jpeg_message_table[JMSG_VERSION],
+	 cinfo.err->jpeg_message_table[JMSG_COPYRIGHT]);
 }
 
 
@@ -576,7 +574,7 @@
 	     (dinfo.progressive_mode?'P':'N'));
 
      if (!csv) {
-       fprintf(LOG_FH,marker_str);
+       fprintf(LOG_FH,"%s",marker_str);
        if (dinfo.saw_Adobe_marker) fprintf(LOG_FH,"Adobe ");
        if (dinfo.saw_JFIF_marker) fprintf(LOG_FH,"JFIF ");
      }
