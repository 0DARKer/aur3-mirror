# Maintainer: Marti Raudsepp <marti@juffo.org>
# Contributor: kevku <kevku@msn.com>
# Contributor: William Rea <sillywilly@gmail.com>
# Contributor: Lorenzo Nizzi Grifi Gargiolli <lorenzo.nizzi.grifi@gmail.com>
pkgname=openct
pkgver=0.6.20
pkgrel=3
pkgdesc="Implements drivers for several smart card readers"
arch=('i686' 'x86_64')
url="http://www.opensc-project.org/openct"
options=('!libtool')
license="LGPL"
backup=('etc/openct.conf')
depends=('pcsclite' 'libusb' 'libtool')
source=("http://www.opensc-project.org/files/openct/openct-$pkgver.tar.gz"
        'openct'
        'udev-sleep.patch')

build() {
        cd "$srcdir/$pkgname-$pkgver"
        patch -p1 < $srcdir/udev-sleep.patch
        ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --with-udev=/usr/lib/udev --enable-usb --enable-pcsc --disable-static
        make
}

package() {
	cd "$srcdir/$pkgname-$pkgver"
        make DESTDIR="$pkgdir" install

        install -D etc/openct.udev $pkgdir/etc/udev/rules.d/95-openct.rules
        install -D etc/openct_usb $pkgdir/lib/udev/openct_usb
        install -D etc/openct_pcmcia $pkgdir/lib/udev/openct_pcmcia
        install -D etc/openct_serial $pkgdir/lib/udev/openct_serial
        install -D etc/openct.conf $pkgdir/etc/openct.conf
        install -D -m755 $srcdir/openct $pkgdir/etc/rc.d/openct

        install -D -m 644 etc/openct.fdi $pkgdir/etc/hal/fdi/information/10-usb-openct.fdi 
        install -D -m 644 etc/openct-policy.fdi $pkgdir/etc/hal/fdi/policy/10-usb-openct.fdi
        install -D -m 755 etc/openct.hald $pkgdir/usr/lib/hal/hald-addon-openct

        mkdir -p $pkgdir/var/run/openct
}
md5sums=('a1da3358ab798f1cb9232f1dbababc21'
         'a1878066a177db21366d50c9a37b2dd9'
         '1c8484195d3b8445ebdb9fdc2ee87736')
