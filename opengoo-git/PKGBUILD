# opengoo-git

# Maintainer: Tybo thibaultporteboeuf_@t_gmail_dot_com

pkgname=opengoo-git
pkgver=0.1
pkgrel=1
pkgdesc="A free and open clone of World Of Goo."
arch=('i686' 'x86_64')
url="http://http://mandarancio.github.com/OpenGOO/"
license=('GPL3')
groups=()
depends=('box2d' 'libgl')
makedepends=('git' 'qt' 'gcc')
provides=()
conflicts=()
replaces=()
backup=()
options=()
destdir="$pkgdir/opt/$pkgname"
install=
source=(LICENSE)
noextract=()
md5sums=('608bed987af1b677f1378e29e4878154')

_gitroot=git://github.com/Mandarancio/OpenGOO
_gitname=OpenGOO

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  qmake ./OpenGOO.pro
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  mkdir -p "$destdir"
  install -m555     OpenGOO   "$destdir"
  install -m444     *.svg     "$destdir"
  install -m444     *.level   "$destdir"
  install -m444     *.index   "$destdir"
  install -m755  -d           "$destdir/Artwork"
  install -m444     Artwork/* "$destdir/Artwork/"

  mkdir -p "$pkgdir/usr/bin"
  # Creating launch script
  cat > "$pkgdir/usr/bin/OpenGOO" << EOF
#!/bin/bash
cd /opt/$pkgname
./OpenGOO
EOF

  chmod 555 "$pkgdir/usr/bin/OpenGOO"
}

# vim:set ts=2 sw=2 et:
