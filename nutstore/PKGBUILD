# Maintainer: Bhoppi Chaw <bhoppi hotmail com>

pkgname=nutstore
pkgver=1.3.0
pkgrel=1
pkgdesc='a cloud service that lets you sync and share files anywhere.'
arch=('i686' 'x86_64')
url='https://jianguoyun.com/'
license=('custom')
depends=('glib2'
         'gtk2'
         'java-runtime'
         'python2')
optdepends=('nautilus-nutstore: Nautilus plugin')
install='nutstore.install'

_arch='x86'
md5sums=('894a144c07360156c72411e004fd5338'
         '3d2b5207cb2f8faeb22625976953151d')
if [ $CARCH == "x86_64" ]; then
    _arch='x64'
    md5sums=('bd7dbc59c67b3c0fb8862bf0ced92824'
             '3d2b5207cb2f8faeb22625976953151d')
fi
source=("https://jianguoyun.com/static/exe/installer/nutstore_linux_dist_${_arch}.tar.gz"
        "license")

build()
{
    cd $srcdir
    sed -i -e '1s/python/python2/' bin/nutstore-pydaemon.py
    cd gnome-config
    sed -i -e '/Exec=/s,~/\.nutstore/dist,/opt/nutstore,' -e '/OnlyShowIn=/d'\
        menu/nutstore-menu.desktop autostart/nutstore-daemon.desktop
}

package()
{
    cd $srcdir
    install -D -m 644 license $pkgdir/usr/share/licenses/nutstore/license
    rm license *.tar.gz
    mkdir -p $pkgdir/opt/nutstore && cp -aR ./ $pkgdir/opt/nutstore
    install -D -m 644 gnome-config/menu/nutstore-menu.desktop\
        $pkgdir/usr/share/applications/nutstore-menu.desktop
}
