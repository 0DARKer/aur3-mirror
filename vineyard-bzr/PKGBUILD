# Maintainer: # Maintainer: crazyelf5

pkgname=vineyard-bzr
pkgver=latest
pkgrel=1
pkgdesc="Easy to use Wine configuration programs and libraries"
arch=('i686' 'x86_64')
url="https://launchpad.net/vineyard"
license=('GPLv3' 'LGPLv2.1')
depends=('python2' 'wine')
makedepends=('bzr')
provides=('vineyard' 'python-wine')
conflicts=('vineyard' 'python-wine')
install=${pkgname}.install

_bzrtrunk=lp:vineyard
_bzrmod=vineyard

build() {
  cd "${srcdir}"
  msg "Connecting to the server...."

  if [ ! -d ./${_bzrmod} ]; then
    bzr co ${_bzrtrunk} ${_bzrmod} 
  else
    bzr up ${_bzrmod}
  fi

  msg "BZR checkout done or server timeout"
  msg "Starting make..."

  [ -d ${_bzrmod}-build ] && rm -rf ${_bzrmod}-build
  cp -r ${_bzrmod} ${_bzrmod}-build
  cd ${_bzrmod}-build
  
  # Sed for Python2
  grep -lr '/usr/bin/env python' * | xargs sed -i 's|#!/usr/bin/env python|#!/usr/bin/env python2|'
  grep -lr '/usr/bin/python' * | xargs sed -i 's|#!/usr/bin/python|#!/usr/bin/python2|'
}

package() {
  cd "${srcdir}"/${_bzrmod}-build
  python2 ./setup.py install --root="${pkgdir}"
}
