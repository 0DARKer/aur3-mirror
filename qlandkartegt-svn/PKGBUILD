# Contributor: Matthias Maennich <arch@maennich.net>
pkgname=qlandkartegt-svn
pkgver=1109
pkgrel=1
pkgdesc="Use your Garmin GPS with Linux (SVN Version)"
arch=('i686' 'x86_64')
url="http://www.qlandkarte.org"
license=('GPL')
depends=('proj>=4.4' 'libusb>=0.1' 'gdal' 'qt>=4.3' 'xerces-c')
makedepends=('subversion' 'cmake')
source=()
md5sums=()
provides=('qlandkartegt')
replaces=('qlandkarte')
conflicts=('qlandkartegt')

_svntrunk="https://qlandkartegt.svn.sourceforge.net/svnroot/qlandkartegt/QLandkarteGT/trunk"
_svnmod="QLandkarteGT"

build() {
	cd $startdir/src

	# get the sources
	msg "Connecting to $_svntrunk ..."
	if [ -d $_svnmod/.svn ]; then
		(cd $_svnmod && svn up) || return 1
	else
		svn co $_svntrunk $_svnmod || return 1
	fi
	msg "SVN checkout done or server timeout"

        mkdir -p $startdir/build

	cd $startdir/build

	cmake -DCMAKE_INSTALL_PREFIX=/usr ../src/$_svnmod || return 1
	make || return 1
	make DESTDIR=$startdir/pkg install || return 1

	install -D -m 755 $startdir/src/$_svnmod/src/icons/orig.backGlobe128x128.png $startdir/pkg/usr/share/pixmaps/qlandkartegt.png
	install -D -m 755 $startdir/qlandkartegt.desktop $startdir/pkg/usr/share/applications/qlandkartegt.desktop
	install -D -m 755 $startdir/qlandkartegt.menu $startdir/pkg/usr/share/menu/qlandkartegt.menu
}
