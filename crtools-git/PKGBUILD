#Maintainer:Kwrazi<kwrazi@gmail.com>

_pkgname="crtools"

pkgname=${_pkgname}-git
pkgver=20131122
pkgrel=1
pkgdesc="Utility to do checkpoint and restore tasks/processes."
arch=('i686' 'x86_64')
url='https://github.com/cyrillos/crtools#readme'
license=('GPL2')
depends=(protobuf-c)
makedepends=('git' 'xmlto' 'asciidoc')
backup=()
install="${_pkgname}.install"
provides=(${_pkgname} criu)
source=('git+https://github.com/cyrillos/crtools.git'
        'patch.diff')
md5sums=('SKIP'
         'b7956894242f75c8b0812a0e0771ddb6')

pkgver() {
  cd ${srcdir}/${_pkgname}
  git log -1 --format='%cd' --date=short | tr -d -- '-'
}

build() {
  cd ${srcdir}/${_pkgname}
  patch -p1 < ${srcdir}/../patch.diff
  unset CFLAGS LDFLAGS
  make all
}

package() {
  cd ${srcdir}/${_pkgname}
  cp Makefile.inc Makefile.inc.orig
  cat Makefile.inc.orig | sed -e "s|/usr/local|${pkgdir}/usr|" > Makefile.inc
  make install
  ln -s criu ${pkgdir}/usr/sbin/crtools
}
