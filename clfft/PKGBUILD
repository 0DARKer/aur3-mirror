# Maintainer: jdarch <jda -dot- cloud -plus- archlinux -at- gmail -dot- com>

pkgname=clfft
pkgver=2.2
pkgrel=1
pkgdesc="A software library containing FFT functions written in OpenCL"
arch=("i686" "x86_64")
url="https://github.com/clMathLibraries/clFFT"
license=('APACHE')
depends=("amdapp-sdk")

source=("https://github.com/clMathLibraries/clFFT/archive/v${pkgver}.zip")
md5sums=('d949892121d3c436c8e5d357a2ea237b')
sha512sums=('d130b9ea90452e5a2095ff4acfdc482432b4c87f878adf6324b0d6c8dd7089c748cbaf808111e5f1c1b5b9f8a2481e1dca1050e5a2d97ff3c2aca061fab1c630')

if [ "$CARCH" == "x86_64" ]; then
    _bits=64
elif [ "$CARCH" == "i686" ]; then
    _bits=32
fi

#prepare() {
#	cd "${srcdir}/clFFT-${pkgver}/src"
#	patch <"${srcdir}/compiler_detection.patch"
#}

build() {
	export DESTDIR="${pkgdir}"
	cd "${srcdir}/clFFT-${pkgver}/src"
	cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr ./
	make clFFT
}

package() {
	cd "${srcdir}/clFFT-${pkgver}/src"
	make install
	rm -rf "${pkgdir}/usr/bin${_bits}"
	mv "${pkgdir}/usr/lib${_bits}" "${pkgdir}/usr/lib"
	rm "${pkgdir}/usr/lib/libStatTimer.so"*
	mkdir "${pkgdir}/usr/include/clFFT"
	mv -t "${pkgdir}/usr/include/clFFT/" "${pkgdir}"/usr/include/*.h
}
