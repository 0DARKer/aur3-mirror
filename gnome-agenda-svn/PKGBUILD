# Maintainer: Limao Luo <luolimao+AUR@gmail.com>
# Contributor: Maxime de Roucy <maxime.deroucy@gmail.com>

_pkgname=gnome-agenda
pkgname=$_pkgname-svn
pkgver=212
pkgrel=1
pkgdesc="Display calendars on the GNOME desktop tray. Supports Google Calendar, Novell Groupwise, Evolution and iCanlendar"
arch=(i686 x86_64)
url=http://code.google.com/p/$_pkgname/
license=(GPL2)
depends=(python-sexy python2-configobj python2-dateutil python2-dbus python2-gdata python2-libgnome python2-lxml python2-pysqlite python2-vobject)
makedepends=(python2-distutils-extra python2-distribute subversion)
provides=($_pkgname)

_svntrunk=http://$_pkgname.googlecode.com/svn/trunk/
_svnmod=$_pkgname-read-only

package() {
    install -d "$srcdir"/$_pkgname/
    cd "$srcdir"/$_pkgname/

    msg "Starting SVN checkout..."
    if [[ -d $_svnmod/.svn ]]; then
        pushd $_svnmod && svn up -r $pkgver
        msg2 "The local files have been updated."
        popd
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi
    msg2 "SVN checkout done or server timeout"

    rm -rf $_svnmod-build
    cp -r $_svnmod $_svnmod-build
    cd $_svnmod-build

    msg "Compiling..."
    for i in $(find ../ -name '*.py') agenda-gtk; do
        sed -ri 's:^#!/usr/bin/(env )?python$:&2:' "$i"
    done
    python2 setup.py install --root="$pkgdir"
}
