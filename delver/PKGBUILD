# Maintainer: fmoralesc

pkgname=delver
pkgver=latest
pkgrel=0
pkgdesc="A first-person action roguelike"
url=http://www.delvergame.com/
arch=(i686 x86_64)
license=(MPL GPL LGPL)
depends=(java-runtime)
source=(delver.desktop
		delver.png
        delver)
md5sums=('acda0b3597b43f64fd34667d9e1c8002'
         'dd8d454ce3f5323ba41a8c84b1bd7ec0'
         '9fcaf92075a75f37a18bf0fdac23f3cb')

_url_prefix="http://www.intrrpt.com/downloads/delver"

package()
{
  msg "Determining latest version..."
  _file=`wget "${_url_prefix}" -O - 2>/dev/null |awk 'BEGIN{ RS="<a *href *= *\""} NR>2 {sub(/".*/,"");print; }'  | grep -v .jar | sort | tail -n 1`
  msg "Latest version is ${_file}"
  pkgver=`echo ${_file} | awk -F. '{print $1;}' | awk -F- '{print $2}'` 
  pkgrel=`echo ${_file} | awk -F. '{print $1;}' | awk -F- '{print $5"_"$3"_"$4}'`
  msg "Downloading..."
  wget ""${_url_prefix}/${_file}""
  msg "Extracting..."
  unzip ${_file}
  mkdir -p "${pkgdir}"/{usr/{bin,share/applications},opt/delver/}
  mv Delver/*.jar "${pkgdir}"/opt/delver/delver.jar  
  install -m755 "${startdir}"/delver "${pkgdir}"/usr/bin/delver
  install -m644 "${startdir}"/delver.png "${pkgdir}"/opt/delver/delver.png
  install -m644 "${startdir}"/delver.desktop "${pkgdir}"/usr/share/applications/
}
