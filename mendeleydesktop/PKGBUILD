# Maintainer: Dan Serban
# Contributor: Alexandre Guimaraes --- <alexandre.cortes yahoo.fr>
# Contributor: Peter Lewis --- <pete muddygoat.org>
# Contributor: Christopher Schwaab --- <christopher.schwaab gmail>

pkgname=mendeleydesktop
pkgver=1.0.1
pkgrel=1
pkgdesc="Academic software for managing and sharing research papers (desktop client)"
url=http://www.mendeley.com/release-notes/
arch=(i686 x86_64)
#depends=(libpng12 openssl-compatibility qt sqlite3)
depends=(qt sqlite3)
license=(custom:mendeley_eula)
_filearch=i486
md5sums=('b4f6bd0e234d5d9e15d3354b99cb1473')
[ "${CARCH}" == "x86_64" ] && _filearch=x86_64 && md5sums=('dd9e485e2bb393b06c89ec85abb9a1b2')
source=("http://www.mendeley.com/downloads/linux/${pkgname}-${pkgver}-linux-${_filearch}.tar.bz2")

build()
{
  cd mendeleydesktop-1.0-linux-${_filearch}
  mv lib/qt/libpng.so.3 lib/
  rm -r lib/qt
  mv share/mendeleydesktop .
  mv share/doc .
  mkdir -p "${pkgdir}"/usr
  mv share "${pkgdir}"/usr/
  mkdir -p "${pkgdir}"/usr/share/mendeleydesktop/share
  mv lib "${pkgdir}"/usr/share/mendeleydesktop/
  mv doc mendeleydesktop "${pkgdir}"/usr/share/mendeleydesktop/share/
  mkdir -p "${pkgdir}"/usr/bin
  USRBINFILE="${pkgdir}"/usr/bin/mendeleydesktop
  echo '#!/bin/bash' > "${USRBINFILE}"
  echo 'export LD_LIBRARY_PATH="/usr/share/mendeleydesktop/lib:${LD_LIBRARY_PATH}"' >> "${USRBINFILE}"
  echo "/usr/share/mendeleydesktop/lib/mendeleydesktop/libexec/mendeleydesktop.${_filearch}" >> "${USRBINFILE}"
  chmod +x "${USRBINFILE}"
}

