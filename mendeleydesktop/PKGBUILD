# Maintainer: Dan Serban
# Contributor: Alexandre Guimaraes --- <alexandre.cortes yahoo.fr>
# Contributor: Peter Lewis --- <pete muddygoat.org>
# Contributor: Christopher Schwaab --- <christopher.schwaab gmail>

pkgname=mendeleydesktop
pkgver=1.0.1
pkgrel=2
pkgdesc="Academic software for managing and sharing research papers (desktop client)"
url=http://www.mendeley.com/release-notes/
arch=(i686 x86_64)
#depends=(libpng12 openssl-compatibility qt sqlite3)
depends=(qt sqlite3)
license=(custom:mendeley_eula)
_filearch=i486
md5sums=('e797daa7c50778d5439431824f1e385d')
[ "${CARCH}" == "x86_64" ] && _filearch=x86_64 && md5sums=('48dc6d77831d9976a6bd5809b4d47458')
source=("http://s3.amazonaws.com/mendeley-desktop-download/linux/${pkgname}-${pkgver}-linux-${_filearch}.tar.bz2")

build()
{
  cd mendeleydesktop-${pkgver}-linux-${_filearch}
  [ "${CARCH}" == "i686" ] && mv lib/qt/libpng.so.3 lib/
  rm -r lib/qt
  mv share/mendeleydesktop .
  mv share/doc .
  mkdir -p "${pkgdir}"/usr
  mv share "${pkgdir}"/usr/
  mkdir -p "${pkgdir}"/usr/share/mendeleydesktop/share
  mv lib "${pkgdir}"/usr/share/mendeleydesktop/
  mv doc mendeleydesktop "${pkgdir}"/usr/share/mendeleydesktop/share/
  mkdir -p "${pkgdir}"/usr/bin
  USRBINFILE="${pkgdir}"/usr/bin/mendeleydesktop
  echo '#!/bin/bash' > "${USRBINFILE}"
  echo 'export LD_LIBRARY_PATH="/usr/share/mendeleydesktop/lib:${LD_LIBRARY_PATH}"' >> "${USRBINFILE}"
  echo "/usr/share/mendeleydesktop/lib/mendeleydesktop/libexec/mendeleydesktop.${_filearch}" >> "${USRBINFILE}"
  chmod +x "${USRBINFILE}"
}

