#! /bin/bash
# Maintainer: Jorge Barroso <jorge.barroso.11 at gmail dot com>
# Contributor: Michael Krauss <hippodriver@gmx.net>

pkgname=adabooch
pkgver=20071212
pkgrel=2
arch=('any')
pkgdesc="The Ada 95 Booch Components"
url="http://www.adapower.net/booch/"
license=('GPL' 'custom:Modified_GPL')
install=$pkgname.install
depends=('gcc-ada')
source=(http://downloads.sourceforge.net/booch95/bc-${pkgver}.tgz
	test_makefile.patch
	demo_makefile.patch)
sha512sums=('a9aba192b1764abc861ad4cd9706b7421937735061d45ad4927619edc8107f34d1c0e917eeabdd3233d1bd8c0e8bd8451aa0a448d03ffc31a31b82f6513c8082'
            '88a93b0186e37c69369d477d9c312e5fcf88637805e632d48c0ca740ef5bf986cad2beacf23021b94fea04c381b26d9f26a930bbc2fb580f83247c17a880c2f5'
            '35bc3eaaf7f2b9d958a543bf512783e6017616129392f02413c16f7e51ed45a84476658ea699d894e530e6afcff7f5a4f4abb0ab14161950f352c47114276639')

build() {
  cd $startdir/src
  tar zxf bc-${pkgver}.tgz
  cd bc-${pkgver} || return 1
  mkdir -p $startdir/pkg/usr/lib/adabooch || return 1
  mkdir -p $startdir/pkg/usr/share/adabooch/test || return 1
  mkdir -p $startdir/pkg/usr/share/adabooch/demo || return 1

  # install libs
  for i in "*.ads"; do
    install --mode=644 $i $startdir/pkg/usr/lib/adabooch
  done
  for i in "*.adb"; do
    install --mode=644 $i $startdir/pkg/usr/lib/adabooch
  done

  # install testsq
  cd test
  patch -p0 < $startdir/test_makefile.patch
  for i in "*"; do
    install --mode=644 $i $startdir/pkg/usr/share/adabooch/test
  done
  cd ..

  # install demos
  cd demo
  patch -p0 < $startdir/demo_makefile.patch
  for i in "*"; do
    install --mode=644 $i $startdir/pkg/usr/share/adabooch/demo
  done
  cd ..

  # install GANT stuff for completeness
  cp -r GNAT $startdir/pkg/usr/share/adabooch
  chmod 755 $startdir/pkg/usr/share/adabooch/GNAT

  # install the license.
  install -D -m644 $startdir/Modified_GPL \
    "$pkgdir"/usr/share/licenses/$pkgname/Modified_GPL || return 1
}

