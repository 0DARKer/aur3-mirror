# Maintainer: M0Rf30

pkgname=rbdoom3-bfg-git
pkgver=20130403
pkgrel=1
pkgdesc="Doom 3 BFG source code (Robert Beckebans repo)."
arch=(i686 x86_64)
url="https://github.com/RobertBeckebans/RBDOOM-3-BFG"
license=('GPL')
groups=(games)
depends=('libgl' 'alsa-lib' 'openal' 'libxxf86vm' 'libstdc++5' 'sdl')
makedepends=('git' 'cmake' 'zip')
optdepends=('alsa-plugins: pulseaudio-support'
	    'libpulse: pulseaudio support')

install=rbdoom3-bfg-git.install
source=('rbdoom3.launcher' 'rbdoom3.desktop' 'rbdoom3.png')
_gitroot="git://github.com/RobertBeckebans/RBDOOM-3-BFG.git"
_gitname="rbdoom3"

build() {
  msg "Connecting to GIT server...."

  if [ -d $startdir/src/$_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone --depth=1 $_gitroot $_gitname
  fi
  msg "GIT checkout done or server timeout"

  msg "Creating build directory"
  rm -rf "$srcdir/$_gitname-build"
  cp -rH "$srcdir/$_gitname" "$srcdir/$_gitname-build"

 msg "Starting configure & make..."
  cd "$srcdir/$_gitname-build/neo"
  sh  cmake-eclipse-linux-profile.sh
  cd ../build
  make
}

package() {
  install -m 755 -d "$pkgdir"/opt/rbdoom3/base
  install -m 755 "$_gitname"-build/build/RBDoom3BFG "$pkgdir"/opt/rbdoom3
  install -m 755 "$_gitname"-build/base/default.cfg "$pkgdir"/opt/rbdoom3/base/
  install -D -m 755 $srcdir/rbdoom3.launcher $pkgdir/usr/bin/rbdoom3
  install -D -m 644 "$srcdir"/rbdoom3.png "$pkgdir"/usr/share/pixmaps/rbdoom3.png
  install -D -m 644 "$srcdir"/rbdoom3.desktop "$pkgdir"/usr/share/applications/rbdoom3.desktop
}


md5sums=('89792b386443a456a9e756ec9c2f2e96'
         'fe745e7f4a56a99f5cf4cfbf1e1fdf43'
         'aad66f68d95f9f40eb6ebe71c89f6bab')
