# Maintainer: Dmitrij D. Czarkoff <czarkoff@gmail.com>
# Contributor: zoulnix <http://goo.gl/HQaP>

pkgname=lordsawar-svn
pkgver=trunk
pkgrel=1
pkgdesc="A free, turn-based strategy game in spirit of Warlords II"
arch=('i686' 'x86_64')
url="http://www.nongnu.org/lordsawar/"
license=('GPL3')
depends=('gtkmm' 'sdl_mixer')
makedepends=('pkgconfig' 'gettext' 'intltool' 'libtar' 'boost' 'subversion')
conflicts=('lordsawar')
changelog="ChangeLog"
source=("${pkgname}.desktop")
md5sums=('aba11d9a2244b44c60cb31293fc09cbf')

_svntrunk="svn://svn.sv.gnu.org/${pkgname}/${pkgname}/${pkgver}"

build() {
  cd "$srcdir"

  msg "Getting sources..."
  if [ -d ${pkgname}/.svn ]
  then
    cd ${pkgname}
    svn up || return 1
  else
    svn co ${_svntrunk} --config-dir ./ ${pkgname} || return 1
    cd ${pkgname}
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  ./autogen.sh
  aclocal -I m4
  autoconf

  ./configure \
    --prefix=/usr \
    --disable-static \
    --disable-sdltest || return 1
  make || return 1
}

package() {
  cd "${srcdir}/${pkgname}"
  make DESTDIR="${pkgdir}/" install || return 1

  install -D -m 0644 "${srcdir}/${pkgname}.desktop" \
			"${pkgdir}/usr/share/applications/${pkgname}.desktop"
  install -D -m 0644 "${srcdir}/${pkgname}/dat/various/castle_icon.png" \
			"${pkgdir}/usr/share/pixmaps/${pkgname}.png"
}

post_install() {
  update-desktop-database -q
}

post_remove() {
  update-desktop-database -q
}
