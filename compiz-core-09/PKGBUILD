
# Put the desired install prefix HERE
_iprefix=/opt/compiz-09

pkgname=compiz-core-09
pkgver=0.9.2.1
pkgrel=2
pkgdesc="Compiz is an extensible window manager utilizing opengl for effects and usability"
url="http://www.compiz.org/"
license=('GPL' 'LGPL' 'MIT')
arch=('i686' 'x86_64')
depends=('startup-notification' 'librsvg' 'libgl' 'dbus'
         'mesa' 'libxslt' 'fuse' 'boost' 'libstdc++5')
makedepends=('intltool' 'cmake')
conflicts=('compiz-core++')
options=(!libtool !emptydirs)
source=("http://releases.compiz.org/$pkgver/compiz-core-${pkgver}.tar.gz")
sha1sums=('c16f784a528f4406d93af591c52ab43fd5ea930d')
MAKEFLAGS="-j1"

# This is a developement version
OPTIONS=(!strip)

build()
{
	cd "compiz-core-$pkgver"
	[[ -d build ]] || mkdir build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX="${_iprefix}" -DCMAKE_BUILD_TYPE=Debug -DCOMPIZ_DESTDIR="${pkgdir}"
	make
	make install
	if [[ -d "${pkgdir}/usr" ]]; then
		msg "Removing potentially conflicting files..."
		find "${pkgdir}/usr" -type f | sed "s:^${pkgdir}::"
		rm -rf "${pkgdir}/usr"
	fi
	_cmake_root=$(sed -n 's/CMAKE_ROOT:INTERNAL=//p' CMakeCache.txt)
	mkdir -p "${pkgdir}${_cmake_root}/Modules"
	make findcompiz_install
	mkdir -p "$pkgdir/usr/bin"
	msg "Making /usr/bin symlinks..."
	ln -s "${_iprefix}/bin/compiz" "$pkgdir/usr/bin/compiz-09"
	[[ -f "${pkgdir}${_iprefix}/bin/gtk-window-decorator" ]] && \
		ln -s "${_iprefix}/bin/gtk-window-decorator" "$pkgdir/usr/bin/gtk-window-decorator-09" || true
	[[ -f "${pkgdir}${_iprefix}/bin/kde4-window-decorator" ]] && \
		ln -s "${_iprefix}/bin/kde4-window-decorator" "$pkgdir/usr/bin/kde4-window-decorator-09" || true
}
