# Maintainer: archtux <antonio dot arias99999 at gmail dot com>

pkgname=scidb
_realpkgname=scidb-beta
pkgver=1.0beta.rev701
_realpkgver=2013-04-01--rev701
pkgrel=1
pkgdesc="Scidb is a Chess Information Data Base"
url="http://scidb.sourceforge.net/"
arch=('x86_64' 'i686')
license=('GPL2')
depends=('tk' 'zziplib')
install=$pkgname.install
options=('!buildflags' '!makeflags')
source=(http://sourceforge.net/projects/$pkgname/files/$_realpkgname--$_realpkgver.tar.gz
        $pkgname.desktop
        $pkgname.install)
md5sums=('4a244aa78ef319e6685a531684141e9b'
         '16ebfb8498c2806cfbb7e53e8c631a71'
         '01ed711fe79b466ca3ee181e89c07cb5')

prepare() {
   cd $srcdir/$_realpkgname--$_realpkgver

   ./configure --bindir=$pkgdir/usr/bin/ --datadir=/usr/share/
}

build() {
   cd $srcdir/$_realpkgname--$_realpkgver
   
   make
}

package () {
   cd $srcdir/$_realpkgname--$_realpkgver
   
   # Create directories
   install -dm777 $pkgdir/usr/share/scidb-beta/engines/sjeng-scidb
   install -dm644 $pkgdir/usr/share/man/man1
   install -dm644 $pkgdir/usr/share/fonts/truetype/Scidb
   install -dm644 $pkgdir/usr/share/scidb-beta/{cursor,help,hyphen,photos}

   # Desktop icon
   install -Dm644 scidb.ico $pkgdir/usr/share/pixmaps/scidb.ico
   install -Dm644 ../scidb.desktop $pkgdir/usr/share/applications/scidb.desktop

   # Update photo files
   install -Dm755 tcl/update-scidb-photo-files $pkgdir/usr/bin/update-scidb-photo-files
   
   # Executables
   cd src/
   cp cbh2si4 cdb2sci $srcdir/$_realpkgname--$_realpkgver/tcl/scidb-beta tclscidb-beta tkscidb-beta $pkgdir/usr/bin
 
   # Data directory
   cp -r data/ $pkgdir/usr/share/scidb-beta
 
   # Hyphen
   cp -r util/libhyphenate/{dict,pattern} $pkgdir/usr/share/scidb-beta/hyphen
   
   # Opening books
   cd ..
   install -Dm666  engines/Sjeng/books/* $pkgdir/usr/share/scidb-beta/engines/sjeng-scidb
   cp tcl/engines/* $pkgdir/usr/share/scidb-beta/engines

   # Man pages
   cp man/*.gz $pkgdir/usr/share/man/man1

   # Chess engines
   cd engines/
   install -Dm755 Sjeng/sjeng-scidb $pkgdir/usr/local/games/sjeng-scidb
   cp stockfish/stockfish-scidb $pkgdir/usr/local/games

   # Data
   cd $srcdir/$_realpkgname--$_realpkgver/tcl
   cp -r flags/ images/ lang/ pdf/ pieces/ scripts/ textures/ themes/ $pkgdir/usr/share/scidb-beta
   
   # Cursor directory
   cp cursor/*.x{cur,bm} $pkgdir/usr/share/scidb-beta/cursor
   
   # Help directory
   cp -r help/{de,en,es,hu,images,it,styles} $pkgdir/usr/share/scidb-beta/help   
   
   # Fonts
   cp fonts/*.ttf $pkgdir/usr/share/fonts/truetype/Scidb
}