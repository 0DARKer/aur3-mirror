# Maintainer: ktalog <thektalog@gmail.com>

pkgname=cinnamon-applet-weather
pkgver=1.4.3
pkgrel=1
pkgdesc="Cinnamon applet"
arch=('any')
url="http://cinnamon-spices.linuxmint.com/applets/view/17"
license=('GPL')
depends=('cinnamon' 'gtk3' 'dconf')
install=$pkgname.install
source=('http://cinnamon-spices.linuxmint.com/uploads/applets/9IQR-GGAK-253L.zip')
md5sums=('7ef0860aa95c0deab402c728f96bb80e')

build() {
	cd ${srcdir}/cinnamon-weather-${pkgver}/
	
	cinnamon_dir="$pkgdir/usr/share/cinnamon/applets/weather@mockturtl"
	bin_dir="$pkgdir/usr/bin"
	gschema_dir="$pkgdir/usr/share/glib-2.0/schemas"
	language_dir="$pkgdir/usr/share/locale"

	mkdir -p $cinnamon_dir
	mkdir -p $bin_dir
	mkdir -p $gschema_dir
	
	#active global locale and disable user locale for this applet
	sed -i 's|//Gettext.bindtextdomain("weather@mockturtl", "/usr/share/locale");|Gettext.bindtextdomain("weather@mockturtl", "/usr/share/locale");|' "applet.js"
	sed -i 's|Gettext.bindtextdomain("weather@mockturtl", GLib.get_home_dir()|//Gettext.bindtextdomain("weather@mockturtl", GLib.get_home_dir()|' "applet.js"
	
	install -m0644 metadata.json applet.js icon.png stylesheet.css $cinnamon_dir
	install -m0644 org.cinnamon.applets.weather@mockturtl.gschema.xml $gschema_dir
	install -m0755 cinnamon-weather-settings $bin_dir
	
	cd po
	for file in *.po ;do {
     folder=${file%.*}
	 mkdir -p "$language_dir/${folder}/LC_MESSAGES"
	 msgfmt "${file}" -o "$language_dir/${folder}/LC_MESSAGES/weather@mockturtl.mo"
	}
	done
}
