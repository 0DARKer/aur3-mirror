# Maintainer: ktalog <thektalog@gmail.com>
# Maintainer: skunkos <rotter@archlinux.info>

pkgname=cinnamon-applet-weather
pkgver=1.9.14
pkgrel=1
pkgdesc="An applet for displaying local weather conditions in Cinnamon."
arch=('any')
url="https://github.com/mockturtl/cinnamon-weather/"
license=('GPL')
depends=('cinnamon' 'dconf' 'gettext' 'glib2')
install=$pkgname.install
#source=("./cinnamon-applet-weather.tar.gz")
source=("$pkgname.tar.gz::https://github.com/mockturtl/cinnamon-weather/archive/v$pkgver.tar.gz")
md5sums=('SKIP')

build() {
  cd ${srcdir}/cinnamon-weather-$pkgver*
	
  uuid="weather@mockturtl"
  cinnamon_dir="${pkgdir}/usr/share/cinnamon/applets/${uuid}"
  bin_dir="${pkgdir}/usr/bin"
  #gschema_dir="${pkgdir}/usr/share/glib-2.0/schemas"
  language_dir="${pkgdir}/usr/share/locale"

  mkdir -p ${cinnamon_dir}
  #mkdir -p ${bin_dir}
  #mkdir -p ${gschema_dir}
  mkdir -p ${cinnamon_dir}/po
	
  # Patch for global locale for this applet.
  sed -i 's|(UUID, GLib.get_home_dir() +"/.local/share/locale");|(UUID, "/usr/share/locale");|' "applet.js"
	
  install -m0644 ./*.* ${cinnamon_dir}
  #install -m0644 ./po/*.* ${cinnamon_dir}/po
  #install -m0644 metadata.json applet.js icon.png stylesheet.css ${cinnamon_dir}
  #install -m0644 org.cinnamon.applets.weather@mockturtl.gschema.xml ${gschema_dir}
  #install -m0755 cinnamon-weather-settings ${bin_dir}
	
  cd po

  # I get errors for those two files, not sure why.
  rm {ro,zh_CN}.po

  for file in *.po ;do {
    folder=${file%.*}
    mkdir -p "$language_dir/${folder}/LC_MESSAGES"
    msgfmt "${file}" -o "$language_dir/${folder}/LC_MESSAGES/${uuid}.mo"
  }
  done
}
