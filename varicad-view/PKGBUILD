# Maintainer: Matjaž Mozetič <rationalperseus at gmail dot com>
# Contributor: Piotr Rogoża <rogoza dot piotr at gmail dot com>
# vim:set ts=2 sw=2 et tw=100: expandtab

pkgname=varicad-view
_pkgname=varicad2014-view
pkgver=2014.1.04
pkglang=en
_pkglang=en
_pkgver=${pkgver#*.}
pkgrel=1
pkgdesc='Viewer VariCAD files. It can also open STEP (3D), DWG (2D), DXF (2D) and IGES (2D) files.'
arch=('i686' 'x86_64')
url='http://www.varicad.com'
#http://www.varicad.com/userdata/files/release/en
license=('custom')
depends=(hicolor-icon-theme gtk2 desktop-file-utils glu libsm)
install='varicad-view.install'
options=(!strip)

[ "${CARCH}" = "i686" ] && _deb_arch='i386'
[ "${CARCH}" = "x86_64" ] && _deb_arch='amd64'

source=("varicadview.xml"
			"varicadview.patch"
			"http://www.varicad.com/userdata/files/release/${_pkglang}/${_pkgname}-${_pkglang}_${_pkgver}_${_deb_arch}.deb"
		 )
		 	
md5sums+=(
         '0fb9488c57185041c77805a06d9f301e'	#varicadview.xml
         'bbb6573648c21d6a4ff2c2a3b1772f78'	#varicadview.patch
         )	


#CARCH=x86_64
if [ "$CARCH" == i686 ]; then
	_pkgname1=${_pkgname}-${_pkglang}_${_pkgver}_${_deb_arch}.deb
    md5sums+=(
         '347774ea8f9c90ccd004904fe3ec232c')
elif [ "$CARCH" == x86_64 ]; then
	_pkgname1=${_pkgname}-${_pkglang}_${_pkgver}_${_deb_arch}.deb
    md5sums+=(
         '84dedfa78415f7bfdfcf5b72d0aeb2eb')
fi		
			
#pkglang sums
#         '092396b5eb984b62b98a62fb65c4969b'	#de-i386
#         '8260b1232692857a0e7bf5c164c1ca0b'	#de-amd64
#         'c01e283c8e027480ea25aeb4399a4872'	#cz-i386
#         '73fdb28512978b05bd013dd3b8286ab7'	#cz-amd64
#         'e3a7817a4e9a4cd082d1e9ed0656306f'	#pt-i386
#         'de1c8039d69661085dc867fe5d35fbee'	#pt-amd64



package(){
  cd "$srcdir"
  ar p ${_pkgname1} data.tar.gz | tar zx

  tar -c opt | tar -x -C ${pkgdir}
  tar -c usr | tar -x -C ${pkgdir}
  rm -f $pkgdir/usr/share/doc/varicad2010-view-${_pkglang}/{changelog.gz,copyright,README.Debian}

  cd $srcdir/opt/VariCAD-View/desktop
  install -Dm644 varicadview.desktop \
    $pkgdir/usr/share/applications/varicadview.desktop
  install -Dm644 x-varicadview.desktop \
    $pkgdir/usr/share/mimelnk/application/x-varicadview.desktop
  for i in 16x16 22x22 32x32 48x48; do
    install -Dm 644 varicadview_$i.png \
      $pkgdir/usr/share/icons/hicolor/$i/apps/varicadview.png
  done
  install -Dm 664 varicadview.xpm $pkgdir/usr/share/pixmaps/varicadview.xpm
  install -Dm 664 varicadview.xpm $pkgdir/usr/share/icons/varicadview.xpm

  cd $pkgdir
  ##thx lgomes
  patch -p1 < $srcdir/varicadview.patch
  install -Dm644 $srcdir/varicadview.xml \
    $pkgdir/usr/share/mime/packages/varicadview.xml 
  #
}