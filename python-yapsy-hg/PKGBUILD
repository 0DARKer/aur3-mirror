# Maintainer: Kwpolska <kwpolska@kwpolska.tk>
pkgname=python-yapsy-hg
_pyname=Yapsy
pkgver=218
pkgrel=1
pkgdesc='Yet another plugin system  (hg version)'
arch=('any')
url='http://packages.python.org/Yapsy/'
license=('BSD')
depends=('python')
makedepends=('mercurial')
options=(!emptydirs)
provides=('python-yapsy')
conflicts=('python-yapsy')

_hgroot=http://hg.code.sf.net/p/
_hgrepo=yapsy/code # cheat for dumb makepkg
_hgrepo2=yapsy-code

package() {
  cd "${srcdir}"
  msg "Connecting to Mercurial server...."

  if [[ -d "${_hgrepo}" ]]; then
    cd "${_hgrepo}"
    hg pull -u
    msg "The local files are updated."
  else
    hg clone "${_hgroot}" "${_hgrepo}"
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting build..."

  rm -rf "${srcdir}/${_hgrepo2}-build"
  cp -r "${srcdir}/${_hgrepo}/package" "${srcdir}/${_hgrepo2}-build"
  cd "${srcdir}/${_hgrepo2}-build"

  python3 setup.py install --root="${pkgdir}/" --optimize=1
  install -D -m644 ./LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}

# vim:set ts=2 sw=2 et:
