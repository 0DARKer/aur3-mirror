# Contributor: Chris Griffith <codelicious.griffith at gmail dot com>
# Maintainer: Sergey Tereschenko <serg.partizan at gmail dot com>
pkgname=psb-kmod
_origname=psb-kernel-source
pkgver=4.42.0
pkgrel=2
ubuntu=0ubuntu2~1104um4
pkgdesc="Kernel module for Poulsbo(GMA500) graphics chipsets"
arch=('i686')
url="https://launchpad.net/~gma500/"
license=('GPL2')
groups=()
depends=('kernel26>=2.6.30' 'psb-firmware>=0.30')
makedepends=('kernel26-headers' 'rpmextract')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=ChangeLog
source=("http://ppa.launchpad.net/gma500/ppa/ubuntu/pool/main/p/psb-kernel-source/${_origname}_${pkgver}-${ubuntu}.tar.gz")
noextract=()

build() {
    cd ${srcdir}/${_origname}

    #apply patches
    for p in `grep -v "^#" debian/patches/00list`
    do
        [ ${p} == "06_i2c-intelfb.dpatch" ] && continue
        patch -Np1 -i debian/patches/${p} || return 1
    done

    #compile
    make DRM_MODULES="psb" || return 1
}

package () {
    cd ${srcdir}/${_origname}

    install -dm 755 ${pkgdir}/lib/modules/$(uname -r)/extra/psb
    install -m 755 drm-psb.ko ${pkgdir}/lib/modules/$(uname -r)/extra/psb
    install -m 755 psb.ko ${pkgdir}/lib/modules/$(uname -r)/extra/psb
}

md5sums=('7d2b680a9cb64bba56079fbfd7070321')
