# Maintainer: Daniel Albers <daniel@lbe.rs>
# bacula-fd.service by Christian Hesse <arch@eworm.de>

pkgbase=bacula
pkgname=('bacula-bat')
pkgver=5.2.13
pkgrel=3
arch=(i686 x86_64)
pkgdesc='Bacula - A Network Backup Tool'
url="http://www.bacula.org"
license=('AGPL3')
depends=('qt4')
makedepends=('tcp_wrappers')
source=("http://downloads.sourceforge.net/sourceforge/bacula/bacula-${pkgver}.tar.gz"
        '00-qmake4.patch'
        'bacula-fd.service')

md5sums=('43417bae0c221afb1f30a581c9e0f2fe'
         '9ac88867a9ad3a4fe0486a26d0cdb542'
         '230754737aefdfb57973457acd3f0697')
sha1sums=('30b1eb2efb515138807163d046f675eaa29fad1c'
          '58a60e8af9b4735c564c7223c2bf0c25803927f3'
          'e1f038e7feca1042858ae9b4d27b84b36ae96aab')

_instdir="$PWD/install"

build() {
    pushd "${srcdir}/bacula-${pkgver}"

    patch -Np3 -i ${srcdir}/00-qmake4.patch || true

    ./configure                              \
    --enable-bat                             \
    --enable-client-only                     \
    --enable-smartalloc                      \
    --prefix=/usr                            \
    --sbindir=/usr/bin                       \
    --sysconfdir=/etc/bacula                 \
    --with-openssl                           \
    --with-scriptdir=/etc/bacula/scripts     \
    --with-systemd=/usr/lib/systemd/system/  \
    --with-tcp-wrappers                      \
    --with-x
    
    make DESTDIR="$_instdir" install
}

package_bacula-bat() {
  pkgdesc='Bacula - A Network Backup Tool (management GUI)'
  backup=('etc/bacula/bat.conf')
  depends=('bacula-common')

  install -D ${_instdir}/usr/bin/bat ${pkgdir}/usr/bin/bat
  install -D ${_instdir}/etc/bacula/bat.conf ${pkgdir}/etc/bacula/bat.conf
  install -D ${_instdir}/usr/share/man/man1/bat.1.gz ${pkgdir}/usr/share/man/man1/bat.1.gz

  install -D ${srcdir}/${pkgbase}-${pkgver}/scripts/bat.desktop ${pkgdir}/usr/share/applications/bat.desktop
  install -D ${srcdir}/${pkgbase}-${pkgver}/src/qt-console/images/bat_icon.png ${pkgdir}/usr/share/pixmaps/bat_icon.png
}

