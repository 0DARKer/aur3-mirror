# Maintainer: Sascha Weaver <wzyboies@gmail.com>

pkgname=openvpn-obfs
_pkgname=openvpn
pkgver=2.3.0
pkgrel=1
pkgdesc="OpenVPN binary with obfs patch"
arch=(i686 x86_64)
url="http://openvpn.net/index.php/open-source.html"
depends=('openssl' 'lzo2' 'iproute2' 'openvpn>=2.3.0')
license=('custom')
source=(http://swupdate.openvpn.net/community/releases/openvpn-${pkgver}.tar.gz
        OpenVPN-2.3.0-obfs.patch)
md5sums=('56cffde5d5320e0b1ec364d3e486aca9'
         '4f57dd4cd140f1cce5fbbe2d92893ca0')
options=(!libtool)

build() {
  cd $srcdir/$_pkgname-$pkgver
  patch -p0 -i $srcdir/OpenVPN-2.3.0-obfs.patch
  CFLAGS="$CFLAGS -DPLUGIN_LIBDIR=\\\"/usr/lib/openvpn\\\"" ./configure \
    --prefix=/usr \
    --enable-password-save \
    --mandir=/usr/share/man \
    --enable-iproute2
  make
}

package() {
  cd $srcdir/$_pkgname-$pkgver
  make DESTDIR=$pkgdir install
  mv $pkgdir/usr/sbin/openvpn{,-obfs}
  rm -r $pkgdir/usr/{share,lib,include}
}
