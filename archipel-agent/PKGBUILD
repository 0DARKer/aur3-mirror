# Maintainer: Shanto <shanto@hotmail.com>

pkgname=archipel-agent
_pkgver=beta4
pkgver=0.4.0.beta
pkgrel=1
pkgdesc="A solution to manage and supervise virtual machines. (Agent)"
arch=(any)
url="http://archipelproject.org/"
license=('AGPL')
depends=(
  python2 python2-{apscheduler,sqlalchemy,numpy,magic,ctypes}
  libvirt qemu-kvm python-imaging xmpppy
)
#makedepends=()
#checkdepends=()
#optdepends=()
#provides=()
#conflicts=()
#replaces=()
#backup=()
options=(!strip !emptydirs)
install=install.sh
#changelog=
source=(
  "$pkgname-$_pkgver.zip::https://github.com/primalmotion/Archipel/zipball/@$_pkgver"
  "initscript.patch"
)
#noextract=()
md5sums=('8d26accd4325f7a90e1fa4d05e44c8f2'
         '23a695033736bfb474024fc4c614ca31')

package() {
  cd `find $srcdir -type d -name ArchipelAgent -print -quit`
  patch -p1 --input $srcdir/initscript.patch
  for mod in archipel-core archipel-agent-* archipel-agent; do
    pushd $mod 1>/dev/null
    python2 setup.py install --root="$pkgdir/" --optimize=1
    popd 1>/dev/null
  done;
  _datadir=$pkgdir/usr/share/archipel
  mkdir -p $_datadir
  mv $pkgdir/usr/install $_datadir/
}

# vim:set ts=2 sw=2 et:
