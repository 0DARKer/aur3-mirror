# Contributor: Hideaki <hideaki at gmail dot com>
# Contributor:  hnrch <heinrichmen at gmail dot com>
# Maintainer: Zbynek Novotny <znovotny at gmail dot com>

pkgname=electricsheep-svn
pkgver=160
pkgrel=1
pkgdesc="A screensaver that realize the collective dream of sleeping computers from all over the Internet"
url="http://www.electricsheep.org/"
arch=('i686' 'x86_64')
license=('GPLv2')

depends=('boost' 'curl' 'expat' 'flam3-svn' 'glee' 'gtk2' 'ffmpeg' 'libglade' 'libgtop' 'libpng' 'lua' 'tinyxml' 'wxgtk2.9')
makedepends=('subversion')
provides=('electricsheep-svn')
conflicts=()
replaces=()

source=('wx_cxx_c++11.patch')
sha1sums=('3a51adf7509973c9b058eb0461f21155cf8416ea')

_svntrunk="http://electricsheep.googlecode.com/svn/trunk"
_svnmod="electricsheep"

build() {
    cd "$srcdir"

    msg "Starting SVN checkout..."
    if [[ -d "$pkgname/.svn" ]]; then
        msg2 "Found checked out repository"
        (cd "$pkgname" && svn up -r $pkgver)
    else
        msg2 "Checking out new repository"
        svn co $_svntrunk --config-dir ./ -r $pkgver "$pkgname"
    fi

    cd "${pkgname}"
    patch -p0 < "${startdir}/wx_cxx_c++11.patch"
    cd ..

    msg2 "Setting up build directory..."
    if [[ -d "$srcdir/$pkgname-build" ]]; then
        (rm -rf "$srcdir/$pkgname-build")
    fi
    cp -r "$srcdir/$pkgname" "$srcdir/$pkgname-build"
    cd "$srcdir/$pkgname-build/client_generic"

    msg2 "Configuring..."
    ./autogen.sh
    ./configure --prefix=/usr
    make || return 1

    #
    # Hack to get ElectricSheep to show up and work with gnome-shell
    #
    #mkdir -p "$pkgdir/usr/share/applications/screensavers" "$pkgdir/usr/lib/gnome-screensaver/gnome-screensaver/"
    #cp "$srcdir/$pkgname/electricsheep.desktop" "$pkgdir/usr/share/applications/screensavers/electricsheep.desktop"
    #cp "$srcdir/$pkgname/electricsheep-saver" "$pkgdir/usr/lib/gnome-screensaver/gnome-screensaver/electricsheep-saver"
}


package() {
    cd "${srcdir}/${pkgname}-build/client_generic"
    msg "${pwd}"
    make DESTDIR=$pkgdir install 
}
