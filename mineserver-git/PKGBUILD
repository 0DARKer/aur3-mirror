# Maintainer: Mikkel Kroman <mk@maero.dk>

pkgname=mineserver-git
pkgver=20110122
pkgrel=2
url=('http://mineserver.be/')
pkgdesc="An alternative server to Minecraft"
depends=('libnoise' 'libevent' 'zlib' 'python')
makedepends=('git')
arch=('i686' 'x86_64')
license=("3-clause BSD License")
provides=('mineserver-git')

source=()

_gitname="mineserver"
_gitroot="git://github.com/fador/mineserver.git"

build() {
  msg "Connecting to GIT ($_gitroot)..."

  if [ -d $_gitname ]; then
    cd $_gitname && git pull origin
    msg "The local files of $_gitname were updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"

  cd ${srcdir}/mineserver
  msg "Starting to compile..."

  cmake . && LDFLAGS="${LDFLAGS//-Wl,--as-needed}" make

  msg "Creating pkg..."

  mkdir -p ${pkgdir}/usr/bin
  mkdir -p ${pkgdir}/usr/share/mineserver

  cp -f ${srcdir}/mineserver/bin/mineserver ${pkgdir}/usr/bin
  cp -f ${srcdir}/mineserver/bin/{admin.txt,banned.txt,config.cfg,item_alias.cfg,motd.txt,rules.txt,whitelist.txt} ${pkgdir}/usr/share/mineserver/
}
