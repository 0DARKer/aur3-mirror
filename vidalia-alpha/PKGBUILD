# Maintainer: cornholio <vigo.the.unholy.carpathian@gmail.com>

pkgname=vidalia-alpha
pkgver=0.3.1
pkgrel=1
pkgdesc="Controller GUI for Tor (alpha version)"
arch=("any")
url="https://www.torproject.org/vidalia"
provides="vidalia"
license=(custom)
depends=("tor" "qt>=4.3.0")
makedepends=("cmake")
source=("https://www.torproject.org/dist/vidalia/vidalia-${pkgver}.tar.gz")
sha1sums=('724fa169bf29c309cb96b16d47b66701ed2751f2')
install=".install"

build() {

	rm -rf ${srcdir}/build
	mkdir ${srcdir}/build

	cd ${srcdir}/build
	cmake ../vidalia-${pkgver} \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_SKIP_RPATH=ON

	# This is not a legitimate fix, but it does allow it to compile!
	sed -i 's^!::sleep(s);^//!::sleep(s);^g' ${srcdir}/vidalia-${pkgver}/src/vidalia/plugin/PluginEngine.cpp

	make

}
package() {

	install -D -m644 \
		${srcdir}/build/src/vidalia/vidalia \
		${pkgdir}/usr/bin/vidalia

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/vidalia.desktop \
		${pkgdir}/usr/share/applications/vidalia.desktop

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/16x16/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/16x16/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/22x22/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/22x22/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/32x32/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/32x32/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/48x48/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/48x48/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/64x64/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/64x64/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/src/vidalia/res/128x128/tor-logo.png \
		${pkgdir}/usr/share/icons/hicolor/128x128/apps/vidalia.png

	install -D -m644 \
		${srcdir}/vidalia-${pkgver}/LICENSE \
		${pkgdir}/usr/share/licenses/vidalia/LICENSE

	find "${pkgdir}/usr/" -type f -exec chmod 644 {} \;
        find "${pkgdir}/usr/" -type d -exec chmod 755 {} \;
	chmod 755 ${pkgdir}/usr/bin/vidalia
}
