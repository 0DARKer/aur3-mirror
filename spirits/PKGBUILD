# Maintainer: Zachary A. Jones <JazzplayerL9@gmail.com>
pkgname=spirits
pkgver=1.0.0_120719_1344640830
pkgrel=1
pkgdesc="Lemmings-like 2-D Puzzle Game.  Requires purchase or Humble Bundle Key."
arch=('i686' 'x86_64')
url="http://spacesofplay.com/spirits.html"
license=('custom')
depends=(openal mesa gtk2)
makedepends=()
source=('Spirits.desktop')
md5sums=('6e81e27e79cd3dee98f683f68cbfe03f')

if test "${CARCH}" == "x86_64"; then
  _arch="i686"
  _archnum="32"
else
  _arch="x86_64"
  _archnum="64"
fi
_archive_name="Spirits"
_archive="${pkgname}-linux-${pkgver//_/-}.zip"
_archive_md5="900b03f85cdeb5a898b82fbbdc9fecb1"

build() {
  cd ${srcdir}

  if [ ! -f ${_spiritsarchivelocation}${_archive} ]; then
	  if [ ! -f ${_archive} ] && [ -n "${_humbleand3bundlekey}" ]; then
		rm -f ${_archive}* downloads\?key\=${_humbleand3bundlekey}*
		wget http://www.humblebundle.com/downloads?key=${_humbleand3bundlekey}
		wget $(cat downloads\?key\=${_humbleand3bundlekey} | grep -m 1 "${_archive}" | cut -d "'" -f 10)
		mv ${_archive}* ${_archive}
	  elif [ -z "${_humbleand3bundlekey}" ]; then
		echo You can automate the download of the archive using the _humbleand3bundlekey bash variable.
		echo Just add \'export _humbleand3bundlekey\=\<Your key here\>\' to \.bashrc
		echo
		echo Otherwise please just place ${_archive} into $(pwd)/
		echo Press Enter to continue
		read -a _unused
	  fi
  fi

  if [ ! -f ${_spiritsarchivelocation}${_archive} ]; then
    echo "${_spiritsarchivelocation}${_archive} not found!"
    return 1
  fi

  if ! echo "${_archive_md5}  ${_spiritsarchivelocation}${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_spiritsarchivelocation}${_archive}"
    return 1
  fi

  bsdtar -xf ${_spiritsarchivelocation}${_archive}
  rm -rf ${srcdir}/${_archive_name}/${_arch}
  rm ${srcdir}/${_archive_name}/${_archive_name}-${_archnum}
  mkdir -p ${pkgdir}/opt/ ${pkgdir}/usr/bin/ ${pkgdir}/usr/share/applications/ ${pkgdir}/usr/share/licenses/spirits/
  cp -r ${srcdir}/${_archive_name}/ ${pkgdir}/opt/
  cp ${srcdir}/${_archive_name}.desktop ${pkgdir}/usr/share/applications/
  cp ${srcdir}/${_archive_name}/LICENSES.TXT ${pkgdir}/usr/share/licenses/spirits/LICENSE
  ln -s /opt/${_archive_name}/${_archive_name} ${pkgdir}/usr/bin/${pkgname}
  chmod a+rx ${pkgdir}/opt/${_archive_name}/${_archive_name}
  chmod a+r ${pkgdir}/usr/share/applications/${_archive_name}.desktop
}

# vim: et ts=2 sw=2 sts=2
