# Contributor: Dan Zwell <dzwell@zwell.net>
pkgname=btrfs-progs
pkgver=0.19
pkgrel=6
pkgdesc="Btrfs filesystem utilities"
arch=("i686" "x86_64")
url="http://btrfs.wiki.kernel.org/index.php/Main_Page"
license=('GPL2')
depends=(util-linux-ng)
makedepends=(e2fsprogs)
source=(http://www.kernel.org/pub/linux/kernel/people/mason/btrfs/$pkgname-$pkgver.tar.bz2)
md5sums=('5854728d080cc76f21a83bdc99b6ddaa')

build() {
  cd "$startdir/src/$pkgname-$pkgver"

  # Allow a separate prefix for the binaries:
  sed -i 's/bindir =/bindir ?=/' Makefile || return 1
  # add an include:
  sed -i '1i#include <sys/stat.h>' btrfsck.c

  make all || return 1
  make convert || return 1 # btrfs-convert, which isn't part of the main target
  make prefix=/usr bindir=/sbin mandir=/usr/share/man DESTDIR="$startdir/pkg" install
  # So "fsck" can find "btrfsck":
  cd "$startdir/pkg/sbin" && ln -sf btrfsck fsck.btrfs
}

# vim:set ts=2 sw=2 et:
