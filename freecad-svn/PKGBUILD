# Maintainer : Omar Lakhdar <omar_lakhdar@hotmail.com>
# Contributor: Thomas Dziedzic < gostrc at gmail >
# Contributor: Joaquim Coimbra <joaca_rj@yahoo.com.br>
# Contributor: Michele Mocciola <mickele>
# Contributor : FoolEcho <Archlinux.fr>
# Thanks to Werner Mayer for his support

pkgname=freecad-svn
pkgver=4257
pkgrel=1
pkgdesc='A general purpose 3D CAD modeler, aimed directly at mechanical engineering and product design but also architecture or other engineering specialties.'
arch=('i686' 'x86_64')
url='http://sourceforge.net/apps/mediawiki/free-cad/'
license=('GPL')
depends=('xerces-c' 'gts' 'opencascade' 'soqt' 'qt' 'opencv' 'boost'=1.45.0 'python2' 'curl' 'eigen' 'swig' 'python-qt' 'pivy-hg' 'gcc-fortran')
makedepends=('subversion' 'desktop-file-utils')
provides=('freecad')
options=('!makeflags')
source=("${pkgname}.desktop" "freecad.diff")
md5sums=('68651e7273e692b52ae78da474e97ba9'
'18cba9e1c599c4f2a6031d19e64fe50f')

_svnmod='freecad'
_svntrunk='https://free-cad.svn.sourceforge.net/svnroot/free-cad/trunk'

build() {
  msg 'Getting sources...'
  if [ -d ${_svnmod} ]; then
    cd ${_svnmod}
    svn up -r ${pkgver}
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
    cd ${_svnmod}
  fi
  msg 'SVN checkout done or server timeout'

  cd ${srcdir}
  patch -p0 < ${srcdir}/freecad.diff || return 1
  cd ${_svnmod}


  ./autogen.sh

  ./configure \
    --prefix=/opt/freecad-svn \
    --with-qt4-dir=/usr/lib/qt/ \
    --with-qt4-bin=/usr/bin/ \
    --with-qt4-include=/usr/include/ \
    --with-qt4-lib=/usr/lib/qt/ \
    PYTHON=/usr/bin/python2 \
   --with-python-include=/usr/include/python2.7/ \
    --with-python-lib=/usr/lib/python2.7/ \
    --with-boost-include=/usr/include/boost \
    --with-boost-lib=/usr/lib \
    --with-occ-lib=/opt/opencascade/lib \
    --with-occ-include=/opt/opencascade/include  \

  make
}

package() {
  cd ${_svnmod}

  make DESTDIR=${pkgdir} install

  desktop-file-install --dir=${pkgdir}/usr/share/applications ${srcdir}/${pkgname}.desktop
}
