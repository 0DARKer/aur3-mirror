# Maintainer: BxS <bxsbxs@gmail.com>

pkgname=microchip-mplabc30_bin
pkgver=3.30c
pkgrel=1
pkgdesc="C compiler for PIC24 MCUs and dsPIC DSCs"
arch=('i686' 'x86_64')
url="http://www.microchip.com/stellent/idcplg?IdcService=SS_GET_PAGE&nodeId=1406&dDocName=en010065"
license=('custom')
[ "$CARCH" = "x86_64" ] && depends=('lib32-glibc')
provides=(mplabc30)
conflicts=(mplabc30)
options=(!strip docs libtool emptydirs !zipman)
install=microchip-mplabc30_bin.install
_installer="mplabc30-v$pkgver-linux-installer.run"
source=("http://ww1.microchip.com/downloads/mplab/X_Beta/$_installer")
md5sums=('f50954d415a7bef3abf190d9c4f8f6e2')

build() {
  cd $srcdir

  chmod 0755 $_installer
}

package() {
  cd $pkgdir

  _install_dir="$pkgdir/opt/microchip/mplabc30"

  mkdir -p $_install_dir

  cat > install_input << "EOF"













y
EOF
  echo "$_install_dir" >> install_input
  echo "y" >> install_input

  $srcdir/$_installer --edition lite --mode text < install_input &> '/dev/null'
  rm install_input

  rm $_install_dir/Uninstall*

  mkdir -p $pkgdir/usr/share/licenses/$pkgname
  ln -s "/opt/microchip/mplabc30/License.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
