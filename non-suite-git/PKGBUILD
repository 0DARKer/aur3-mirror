# Maintainer: Anshul Sirur <vixus0@gmail.com>

_pkgname=non-suite
pkgname=$_pkgname-git
pkgver=20130324
pkgrel=1
_realver=1.1
pkgdesc="NON suite of music production tools, including Timeline, Sequencer, Mixer and Session Manager."
arch=('i686' 'x86_64')
url="http://non.tuxfamily.org"
license=('GPL' 'LGPL')
depends=('libsndfile' 'liblo' 'libsigc++' 'liblrdf' 'jack' 'ntk')
makedepends=('python')
replaces=('non-daw' 'non-mixer' 'non-sequencer' 'non-sessionmanager')
provides=('non-suite' 'non-daw' 'non-mixer' 'non-sequencer' 'non-sessionmanager')

_gitroot="git://git.tuxfamily.org/gitroot/non/non.git"
_gitname="non"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $srcdir/$_gitname ] ; then
    cd $_gitname && git pull origin
    git submodule update --init
    msg "The local files are updated."
  else
    git clone $_gitroot
    cd $_gitname
    git submodule update --init
    cd ..
  fi

  msg "GIT checkout done or server timeout"
  msg "Building..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  sed -i "s/-O3/-O2/g" wscript

  ./waf configure
  ./waf 

}

package() {
  cd "$srcdir/$_gitname-build"
  DESTDIR="${pkgdir}" ./waf install  
  rm -rf "${srcdir}/${_gitname}-build"
}
