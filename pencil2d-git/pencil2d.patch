From fac600482a514248bec871ce55efb56088458a82 Mon Sep 17 00:00:00 2001
From: Benjamin Robin <benjarobin@gmail.com>
Date: Mon, 10 Mar 2014 22:15:52 +0100
Subject: [PATCH 1/1] Fix build for Qt5

---
 pencil.pro                         | 6 ++++--
 src/external/linux/linux.cpp       | 9 +++++----
 src/external/quazip/qioapi.cpp     | 2 +-
 src/external/quazip/quaadler32.cpp | 2 +-
 src/external/quazip/quacrc32.cpp   | 2 +-
 src/external/quazip/unzip.c        | 2 +-
 src/external/quazip/unzip.h        | 2 +-
 src/external/quazip/zip.c          | 2 +-
 src/external/quazip/zip.h          | 2 +-
 src/interface/mainwindow2.cpp      | 2 +-
 10 files changed, 17 insertions(+), 14 deletions(-)

diff --git a/pencil.pro b/pencil.pro
index 42dabe0..ed3e256 100644
--- a/pencil.pro
+++ b/pencil.pro
@@ -9,7 +9,9 @@ MOC_DIR = .moc
 OBJECTS_DIR = .obj
 DEPENDPATH += . src
 
-QT += core gui xml xmlpatterns svg multimedia
+QT += core widgets gui xml xmlpatterns multimedia svg
+
+QMAKE_CXXFLAGS += -std=c++11
 
 include(src/pencil.pri)
 
@@ -31,5 +33,5 @@ updateqm.input = TRANSLATIONS
 updateqm.output = ${QMAKE_FILE_PATH}/${QMAKE_FILE_BASE}.qm
 updateqm.commands = $$QMAKE_LRELEASE ${QMAKE_FILE_IN} -qm ${QMAKE_FILE_PATH}/${QMAKE_FILE_BASE}.qm
 updateqm.CONFIG += no_link
-# QMAKE_EXTRA_COMPILERS += updateqm
+QMAKE_EXTRA_COMPILERS += updateqm
 PRE_TARGETDEPS += compiler_updateqm_make_all
diff --git a/src/external/linux/linux.cpp b/src/external/linux/linux.cpp
index d8d994d..7367fe4 100644
--- a/src/external/linux/linux.cpp
+++ b/src/external/linux/linux.cpp
@@ -18,7 +18,7 @@ GNU General Public License for more details.
 #include <QProcess>
 #include <QDir>
 #include <QString>
-#include <phonon/BackendCapabilities>
+#include <QProgressDialog>
 #include "object.h"
 #include "editor.h"
 #include "mainwindow2.h"
@@ -38,14 +38,16 @@ qint16 safeSum ( qint16 a, qint16 b)
     return a+b;
 }
 
+
 void initialise()
 {
     qDebug() << "Initialize linux: <nothing, for now>";
+#if 0
     // Phonon capabilities
     QStringList mimeTypes = Phonon::BackendCapabilities::availableMimeTypes();
     foreach (QString mimeType, mimeTypes)
     {if (mimeType.contains("audio")) qDebug() << "Phonon capability: " << mimeType;}
-
+#endif
     // QImageReader capabilities
     QList<QByteArray> formats = QImageReader::supportedImageFormats();
     foreach (QString format, formats)
@@ -58,7 +60,6 @@ void initialise()
 }
 
 
-
 // added parameter exportFps -> frame rate of exported video
 // added parameter exportFormat -> to set ffmpeg parameters
 bool Object::exportMovie(int startFrame, int endFrame, QMatrix view, Layer* currentLayer, QSize exportSize, QString filePath, int fps, int exportFps, QString exportFormat)
@@ -87,7 +88,7 @@ bool Object::exportMovie(int startFrame, int endFrame, QMatrix view, Layer* curr
 
     QDir dir2(filePath);
     if (QFile::exists(filePath) == true) { dir2.remove(filePath); }
-    exportFrames1(startFrame, endFrame, view, currentLayer, exportSize, tempPath+"tmp", "png", 100, true, true, 2,&progress,50,fps,exportFps);
+    exportFrames1(startFrame, endFrame, view, currentLayer, exportSize, tempPath+"tmp", "png", 100, true, true,&progress,50,fps,exportFps);
     // --------- Quicktime assemble call ----------
     QDir sampledir;
     qDebug() << "testmic:" << sampledir.filePath(filePath);
diff --git a/src/external/quazip/qioapi.cpp b/src/external/quazip/qioapi.cpp
index 6ca74de..9163aef 100644
--- a/src/external/quazip/qioapi.cpp
+++ b/src/external/quazip/qioapi.cpp
@@ -12,7 +12,7 @@
 #include <stdlib.h>
 #include <string.h>
 
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 #include "ioapi.h"
 #include "quazip_global.h"
 #include <QIODevice>
diff --git a/src/external/quazip/quaadler32.cpp b/src/external/quazip/quaadler32.cpp
index 5f620c1..97ba353 100644
--- a/src/external/quazip/quaadler32.cpp
+++ b/src/external/quazip/quaadler32.cpp
@@ -1,6 +1,6 @@
 #include "quaadler32.h"
 
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 
 QuaAdler32::QuaAdler32()
 {
diff --git a/src/external/quazip/quacrc32.cpp b/src/external/quazip/quacrc32.cpp
index 20272b1..67a2e77 100644
--- a/src/external/quazip/quacrc32.cpp
+++ b/src/external/quazip/quacrc32.cpp
@@ -1,6 +1,6 @@
 #include "quacrc32.h"
 
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 
 QuaCrc32::QuaCrc32()
 {
diff --git a/src/external/quazip/unzip.c b/src/external/quazip/unzip.c
index 6ba5d7c..bc3db81 100644
--- a/src/external/quazip/unzip.c
+++ b/src/external/quazip/unzip.c
@@ -40,7 +40,7 @@ woven in by Terry Thorsen 1/2003.
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 #include "unzip.h"
 
 #ifdef STDC
diff --git a/src/external/quazip/unzip.h b/src/external/quazip/unzip.h
index c3b0eb3..bbfda5a 100644
--- a/src/external/quazip/unzip.h
+++ b/src/external/quazip/unzip.h
@@ -52,7 +52,7 @@ extern "C" {
 #endif
 
 #ifndef _ZLIB_H
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 #endif
 
 #ifndef _ZLIBIOAPI_H
diff --git a/src/external/quazip/zip.c b/src/external/quazip/zip.c
index 44ff454..e63a57b 100644
--- a/src/external/quazip/zip.c
+++ b/src/external/quazip/zip.c
@@ -16,7 +16,7 @@
 #include <stdlib.h>
 #include <string.h>
 #include <time.h>
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 #include "zip.h"
 #include "quazip_global.h"
 
diff --git a/src/external/quazip/zip.h b/src/external/quazip/zip.h
index 04074dc..81b7460 100644
--- a/src/external/quazip/zip.h
+++ b/src/external/quazip/zip.h
@@ -53,7 +53,7 @@ extern "C" {
 #endif
 
 #ifndef _ZLIB_H
-#include <QtZlib/zlib.h>
+#include <zlib.h>
 #endif
 
 #ifndef _ZLIBIOAPI_H
diff --git a/src/interface/mainwindow2.cpp b/src/interface/mainwindow2.cpp
index ec4848f..6769553 100644
--- a/src/interface/mainwindow2.cpp
+++ b/src/interface/mainwindow2.cpp
@@ -1210,6 +1210,6 @@ void MainWindow2::helpBox()
 {
     qDebug() << "Open help manual.";
 
-    QUrl url = QUrl::fromLocalFile( QDir::currentPath() + "/Help/User Manual.pdf" );
+    QUrl url = QUrl::fromLocalFile("/usr/share/pencil2d/UserManual.pdf");
     QDesktopServices::openUrl( url );
 }
\ No newline at end of file
-- 
1.9.0

