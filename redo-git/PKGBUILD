# Maintainer: Samuel Tardieu <sam@rfc1149.net>

pkgname=redo-git
pkgver=20101228
pkgrel=1
pkgdesc="Smaller, easier, more powerful, and more reliable than make."
url="https://github.com/apenwarr/redo/"
license=("LGPL")
arch=('any')
depends=('python2' 'sqlite3')
makedepends=('git')
conflicts=('redo')
provides=('redo')
_gitroot='http://github.com/apenwarr/redo.git'
_gitname='redo'
source=()
md5sums=()

build() {
  cd "$srcdir"
  msg "Connecting to GIT server..."

  if [ -d $startdir/src/$_gitname ] ; then
    cd $_gitname && git fetch && git reset --hard origin/master
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi
  msg "GIT checkout done or server timeout"

  cd "$srcdir/$_gitname"
  git ls-files -z | xargs -0 sed -i -e 's,/usr/bin/python$,/usr/bin/python2,' -e 's,python -mcompileall,python2 -mcompileall,'
  export PREFIX=/usr
  export DESTDIR="$pkgdir"
  rm -f install
  if [ -x /usr/bin/redo ]; then
    redo install || return 1
  else
    minimal/do install || return 1
  fi
}

