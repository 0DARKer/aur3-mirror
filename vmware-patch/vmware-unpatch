#!/bin/bash

KERNEL=`uname -r | sed 's/-.*//'`

timestamp=`date +%Y%m%d-%H%M%S`
if [ `whoami` != "root" ]
then
  echo "This need to be run as root"
  exit 1
fi

SRC="/usr/lib/vmware/modules/source/"
for mod in `ls $SRC*.tar-* | sed "s/.*\/\(.*\).tar-.*/\1/" | sort | uniq`
do
  echo "Reverting ${mod} ..."
  LAST=`ls $SRC$mod.tar-* | sort | head -n 1`
  cp $LAST $SRC$mod.tar
  res=$?
  if [ $res -ne 0 ]
  then
    echo "[${mod}-only] Failed to revert"
    rm -rf ${mod}-only
    exit 1
  else
    echo "[${mod}-only] Reverted successfully"
  fi

done
