# Maintainer: ssf <punx69 at gmx dot net>
pkgname=qt5-style-kvantum-svn
pkgver=r134
pkgrel=2
pkgdesc="An SVG theme engine for qt5"
arch=('i686' 'x86_64')
url="https://github.com/tsujan/Kvantum"
license=("GPL")
depends=('qt5-base' 'qt5-svg' 'qt5-x11extras' 'libxext')
makedepends=('subversion' 'gawk' 'coreutils' 'make')
optdepends=('qt4-style-kvantum-svn: An SVG theme engine for qt4'
            'kvantum-tools-qt4-svn: Kvantum config tools for Qt4'
            'kvantum-tools-qt5-svn: Kvantum config tools for Qt5'
            'kvantum-kde4-colorscheme-svn: Kvantum colorscheme for KDE4')
conflicts=('kdestyle-kvantum-kde4' 'kdestyle-kvantum-kde4-git')
provides=("qt5-style-kvantum=${pkgver}")
replaces=()
source=()
sha384sums=()
sha512sums=()

_svntrunk=https://github.com/tsujan/Kvantum/trunk/Kvantum/style
_svnmod="$pkgname"

pkgver() {
    printf "$(svn log $_svntrunk | awk 'NR==2' | awk '{print $1}')"
}

build() {
  cd "$srcdir"
  msg "Connecting to SVN server...."

  if [[ -d "$_svnmod/.svn" ]]; then
    (cd "$_svnmod" && svn up .)
  else
    svn co "$_svntrunk" --config-dir ./ "$_svnmod"
  fi
  msg "SVN checkout done or server timeout"
  
  cd ${srcdir}/${_svnmod}
  qmake-qt5
  make -j$(nproc)
}

package() {
  install -Dm0644 $srcdir/$pkgname/libkvantum.so $pkgdir/usr/lib/qt5/plugins/styles/libkvantum.so
}
