# Contributor: Krzysztof Raczkowski <raczkow@gnu-tech.pl>

pkgname=xe-guest-utilities
pkgver=5.6.0.578
pkgrel=2
pkgdesc="Citrix XenServer Tools"
arch=('i686' 'x86_64')
url="http://citrix.com/English/ps2/products/product.asp?contentID=683148&ntref=hp_nav_US"
license=('GPL' 'LGPL')
depends=('kernel26-xen')
makedepends=('rpmextract')
source=(ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-5.6.0-578.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-5.6.0-578.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-5.6.0-578.x86_64.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-5.6.0-578.x86_64.rpm
	xe-guest-utilities-archlinux.patch)

md5sums=('1ca43af208802ce1cb156b32f78bff18'
	 '034e92d24f5727bce2f852897b9beb09'
	 '760aa26eb07177c9c1c316506ac40fee'
	 '057b86b3b5a296b3aaae3c96a8cb8581'
	 '7763df2e42eea3f6d7f16ea1565ca596')

build() {
  cd $startdir/src
  [ $CARCH == "i686" ] && ( 
    rpmextract.sh xe-guest-utilities-*.i386.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.i386.rpm || return 1
  )
  [ $CARCH == "x86_64" ] && ( 
    rpmextract.sh xe-guest-utilities-*.x86_64.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.x86_64.rpm || return 1
  )

  patch -Np1 -i ${srcdir}/xe-guest-utilities-archlinux.patch || return 1

  cp -ra ${srcdir}/{etc,usr} ${pkgdir}/ || return 1
  mv ${pkgdir}/etc/init.d ${pkgdir}/etc/rc.d
}
