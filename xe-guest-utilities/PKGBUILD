# Contributor: Krzysztof Raczkowski <raczkow@gnu-tech.pl>

pkgname=xe-guest-utilities
pkgver=6.0.0
pkgrel=4
pkgdesc="Citrix XenServer Tools"
arch=('i686' 'x86_64')
url="http://citrix.com/English/ps2/products/product.asp?contentID=683148&ntref=hp_nav_US"
license=('GPL' 'LGPL')
optdepends=('linux: DomU kernel for x86_64'
	    'linux-xen: DomU kernel for i686'
	    'kernel-lts-xen: DomU kernel for i686 (long time supported)')
makedepends=('rpmextract')
source=(ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-${pkgver}-743.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-${pkgver}-743.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-${pkgver}-743.x86_64.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-${pkgver}-743.x86_64.rpm
	xe-guest-utilities-archlinux.patch
	ip_address.patch)

md5sums=('894d33028b2712650be324b7ba01c6c4'
         'e100f97421ff522cb228aa749881a082'
         'ffaf02afa2105d32e011a32c80921256'
         '9b9570b5cc27832df303c8ef9cd11d36'
         'cf3dda772c4a91b1231391dced964851'
         'd41d8cd98f00b204e9800998ecf8427e')

build() {
  cd $startdir/src
  [ $CARCH == "i686" ] && ( 
    rpmextract.sh xe-guest-utilities-*.i386.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.i386.rpm || return 1
  )
  [ $CARCH == "x86_64" ] && ( 
    rpmextract.sh xe-guest-utilities-*.x86_64.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.x86_64.rpm || return 1
  )

  patch -Np1 -i ${srcdir}/xe-guest-utilities-archlinux.patch || return 1
  patch -Np1 -i ${srcdir}/ip_address.patch || return 1

  cp -ra ${srcdir}/{etc,usr} ${pkgdir}/ || return 1
  mv ${pkgdir}/etc/init.d ${pkgdir}/etc/rc.d
}
