# Contributor: Krzysztof Raczkowski <raczkow@gnu-tech.pl>

pkgname=xe-guest-utilities
pkgver=5.6.100.651
pkgrel=1
pkgdesc="Citrix XenServer Tools"
arch=('i686' 'x86_64')
url="http://citrix.com/English/ps2/products/product.asp?contentID=683148&ntref=hp_nav_US"
license=('GPL' 'LGPL')
depends=('linux-xen')
makedepends=('rpmextract')
source=(ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-5.6.100-651.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-5.6.100-651.i386.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-5.6.100-651.x86_64.rpm
	ftp://ftp.prz.edu.pl/pub/archlinux/archrak/src/xe-guest-utilities-xenstore-5.6.100-651.x86_64.rpm
	xe-guest-utilities-archlinux.patch)

md5sums=('784d57d644be0cd755b610c5db9248cd'
         'df059930f5dc9876105421473aebb41f'
         '197a5ccdb48bab8e92ccbc82e9c4f26b'
         '4114e00461bc07df44c3ef9e5a9c8603'
         '7763df2e42eea3f6d7f16ea1565ca596')

build() {
  cd $startdir/src
  [ $CARCH == "i686" ] && ( 
    rpmextract.sh xe-guest-utilities-*.i386.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.i386.rpm || return 1
  )
  [ $CARCH == "x86_64" ] && ( 
    rpmextract.sh xe-guest-utilities-*.x86_64.rpm && \
    rpmextract.sh xe-guest-utilities-xenstore-*.x86_64.rpm || return 1
  )

  patch -Np1 -i ${srcdir}/xe-guest-utilities-archlinux.patch || return 1

  cp -ra ${srcdir}/{etc,usr} ${pkgdir}/ || return 1
  mv ${pkgdir}/etc/init.d ${pkgdir}/etc/rc.d
}
