# Maintainer : dobo <dobo90_at_gmail.com>

pkgname=vim-clang-complete-git
pkgver=20111115
pkgrel=1
pkgdesc='Plugin which uses clang for accurately completing C and C++ code. Git version.'
arch=(any)
url='https://github.com/Rip-Rip/clang_complete'
license=(custom)
depends=(vim clang python2)
makedepends=(git)
conflicts=(vim-clang-complete)

__gitroot="https://github.com/Rip-Rip/clang_complete"
__gitname="clang_complete"

build() {
	cd ${srcdir}

	# Git checkout
	if [ -d ${srcdir}/${__gitname} ] ; then
		msg "Git checkout:  Updating existing tree"
		cd ${__gitname} && git checkout
		msg "Git checkout:  Tree has been updated"
	else
		msg "Git checkout:  Retrieving sources"
		git clone ${__gitroot} && cd ${__gitname} && git checkout
	fi
	msg "Checkout completed"

	# apparently script uses python2
	sed -i 's@#!/usr/bin/env python@#!/usr/bin/env python2@' bin/cc_args.py

	# copying files
	install -d -m 755 ${pkgdir}/usr/share/vim/vimfiles
	cp -a autoload bin doc plugin ${pkgdir}/usr/share/vim/vimfiles
	install -D -m 644 doc/clang_complete.txt ${pkgdir}/usr/share/licenses/${pkgname}/clang_complete.txt
}
