# Contributor/Maintainer: ilikenwf/Matt Parnell <parwok@gmail.com>

pkgname=lkeyholetv
pkgver=1.23
pkgrel=1
pkgdesc="Live TV Viewer (Mostly Japanese Streams)...Server only works on windows version"
arch=('i686' 'x86_64')
provides=('keyholetv')
url="http://www.v2p.jp/video/english/" 
depends=('alsa-lib' 'gtk2' 'cairo' 'pango' 'libx11' 'libpng')
license=('custom')
install=('lkeyholetv.install')
source=('http://www.v2p.jp/video/Viewer/Linux/32bits/LKeyHoleTV1.23-32bits.tar.gz'
	'lkeyholetv.desktop'
	'lkeyholetv')
md5sums=('1b213ca8a62729260239d550a86c2f1a'
         '905a8951b107054187d7228cb390ce62'
         'ae00db79eb19f3f1515f873852c903d2')
         
[ "$CARCH" = "x86_64" ] && source=('http://www.v2p.jp/video/Viewer/Linux/64bits/LKeyHoleTV1.23-64bits.tar.gz'
				   'lkeyholetv.desktop'
				   'lkeyholetv') \
			&& md5sums=('1689b56bb95cfc87e99b76686b453e95'
				    '905a8951b107054187d7228cb390ce62'
				    'ae00db79eb19f3f1515f873852c903d2')

build()
{
	cd ${srcdir}/KeyHoleTV
	
	# Fix Paths
	sed -i 's/\/usr\/bin\/install/\/bin\/install/' ${srcdir}/KeyHoleTV/ALSA/Makefile || return 1
	sed -i 's/\/usr\/bin\/install/\/bin\/install/' ${srcdir}/KeyHoleTV/en_US/Makefile || return 1
	sed -i 's/\/usr\/bin\/install/\/bin\/install/' ${srcdir}/KeyHoleTV/DSP/Makefile || return 1
	sed -i 's/\/usr\/bin\/install/\/bin\/install/' ${srcdir}/KeyHoleTV/ESD/Makefile || return 1
	sed -i 's/\/usr\/bin\/install/\/bin\/install/' ${srcdir}/KeyHoleTV/ja_JP/Makefile || return 1
	
	mkdir -p ${pkgdir}/{usr/{bin,share/{applications,pixmaps}},opt/LKeyHoleTV} || return 1

	# Audio Interface: ALSA should work
	# ...try DSP or ESD if it doesn't by replacing ALSA appropriately below
	
	cd ${srcdir}/KeyHoleTV/ALSA

	make || return 1
	make install || return 1  # Weird, but correct

	# Language: unless you want Japanese
	# ...don't replace en_US with ja_JP

	cd ${srcdir}/KeyHoleTV/en_US

	make || return 1
	make install || #Weird, but correct

	# Time to install the program itself

	/bin/install -c ${srcdir}/KeyHoleTV/.KeyHoleTV ${pkgdir}/opt/LKeyHoleTV/
	/bin/install -c ${srcdir}/KeyHoleTV/lkeyholetv ${pkgdir}/opt/LKeyHoleTV/
	cp -r ${srcdir}/KeyHoleTV/.KeyHoleTV ${pkgdir}/opt/LKeyHoleTV/
	/bin/install -c ${srcdir}/lkeyholetv ${pkgdir}/usr/bin/

	
	install -m644 ${srcdir}/lkeyholetv.desktop ${pkgdir}/usr/share/applications/ || return 1
	install -m644 ${srcdir}/KeyHoleTV/keyholetv.xpm ${pkgdir}/usr/share/pixmaps/keyholetv.xpm || return 1
	
}
