# Maintainer: Yaohan Chen <yaohan.chen@gmail.com>
# Based on community/frogatto{,-data} PKGBUILD

pkgname='frogatto-git'
arch=('i686' 'x86_64')
pkgver=20130119
pkgrel=1
pkgdesc="An old-school 2d platformer game, starring a certain quixotic frog"
url="http://www.frogatto.com"
license=('GPL' 'custom')
depends=('libgl' 'mesa' 'glew' 'sdl' 'sdl_image' 'sdl_ttf' 'sdl_mixer' 'libpng' 'boost-libs')
makedepends=('boost' 'git')
provides=()
replaces=('frogatto-svn')
backup=()
options=()
install=
source=()
noextract=()
source=(frogatto-git.sh
        frogatto-git.desktop)
md5sums=('4068267dca132fdbdd14ed25867adf16'
         '2f2587ff6b4f25ab3214f35c7843d513')

_gitroot=git://github.com/frogatto/frogatto.git
_gitname=frogatto

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot $_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  sed -i 's/ccache //g' Makefile
  sed -i 's/-lprofiler//g' Makefile
  sed -i 's/-lboost_\(regex\|system\|thread\|iostreams\)-mt/-lboost_\1/g' Makefile
  make game
  #make server
}

package() {
  cd "$srcdir/$_gitname-build"

  _install_dir=$pkgdir/opt/$pkgname
  install -D -m755 game $_install_dir/game
  #install -D -m755 server $_install_dir/server
  cp -r data $_install_dir
  cp -r images $_install_dir
  mkdir $_install_dir/modules
  cp -r modules/frogatto $_install_dir/modules

  install -D -m644 LICENSE $pkgdir/usr/share/licenses/frogatto-git/LICENSE

  cd $srcdir
  install -DT -m755 frogatto-git.sh $pkgdir/usr/bin/$pkgname
  install -D -m644 frogatto-git.desktop $pkgdir/usr/share/applications/$pkgname.desktop
}

# vim:set ts=2 sw=2 et:
