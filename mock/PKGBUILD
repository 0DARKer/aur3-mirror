# Maintainer: David Roheim < david dot roheim at gmail dot com >
# Contributor: Thomas Dziedzic < gostrc at gmail >

pkgname=mock
pkgver=1.2.6
pkgrel=1
pkgdesc='A simple chroot build environment manager for building RPMs.'
url='http://fedoraproject.org/wiki/Projects/Mock'
arch=('i686' 'x86_64')
license=('GPL')
install=mock.install
depends=('python2' 'usermode' 'yum-utils' 'python2-decoratortools')

source=("https://git.fedorahosted.org/cgit/mock.git/snapshot/${pkgname}-${pkgver}.tar.xz")
sha256sums=('b88cfb9928b52a6bbf4bb25bf5645e01b7702df0a0d4bf10c67f36e2bc2e3e4a')

build() {
	cd ${pkgname}-${pkgver}
	./autogen.sh
	sed -i '/for ac_prog in/ s/python //' configure
	./configure --prefix=/usr --sysconfdir=/etc
	make
}

#check() {
#	cd ${pkgname}-${pkgver}
#	make check
#}

package() {
	cd ${pkgname}-${pkgver}
	make DESTDIR=${pkgdir} install

	#install -d ${pkgdir}/usr/bin
	ln -s /usr/bin/consolehelper ${pkgdir}/usr/bin/mock

	mkdir -p ${pkgdir}/var/{lib,cache}/mock
	chown -R root:mock ${pkgdir}/var/{lib,cache}/mock
	chmod -R 02755 ${pkgdir}/var/{lib,cache}/mock

	# fix incorrect shebang
	for i in ${pkgdir}/usr/bin/mockchain ${pkgdir}/usr/sbin/mock; do
		sed -i 's_#!/usr/bin/python_&2_' $i
	done
}
