# Maintainer: Daichi Shinozaki <dsdseg@gmail.com>
pkgname=rebol-git
pkgver=20130122
pkgrel=2
pkgdesc="A cross-platform data exchange language and a multi-paradigm dynamic programming language"
arch=('i686' 'x86_64')
url=http://www.rebol.com/r3/alpha-intro.html
license=('Apache')
groups=('devel')
makedepends=('git' 'wget')
provides=('rebol')
_gitroot=https://github.com/rebol/r3.git
_gitname=r3
_r3_i686_binary_url=http://www.rebol.com/r3/downloads/r3-a111-4-4.tar.gz
if [ "$CARCH" = "x86_64" ]; then
  # lib32-glibc for running the (i686) r3 binary
  makedepends=(${makedepends[@]} 'clang' 'lib32-glibc')
  source=('x86_64.patch')
  md5sums=('6b6957f0edbbe8bbeeb11562c9da9a88')
fi

build() {
  cd "$startdir"
  [ ! -f r3 ] && wget $_r3_i686_binary_url -O r3.tgz && tar xvfz r3.tgz

  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  [ "$CARCH" = "x86_64" ] && patch --verbose -p1 <"$srcdir/x86_64.patch"
  cd make
  [ ! -x r3-make ] && install -m755 $startdir/r3 r3-make
  #make make
  make prep 
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  install -Dm755 make/r3 "$pkgdir/usr/bin/r3"
}

# vim:set ts=2 sw=2 et:

