# Maintainer: Daichi Shinozaki <dsdseg@gmail.com>
pkgname=rebol-git
pkgver=20130122
pkgrel=1
pkgdesc="A cross-platform data exchange language and a multi-paradigm dynamic programming language"
arch=('i686' 'x86_64')
url="http://www.rebol.com/r3/alpha-intro.html"
license=('Apache')
groups=('devel')
makedepends=('git' 'wget')
provides=('rebol')
_gitroot=https://github.com/rebol/r3.git
_gitname=r3
_r3_i686_binary_url=http://www.rebol.com/r3/downloads/r3-a111-4-4.tar.gz
if [ "$CARCH" = "x86_64" ]; then
  makedepends=(${makedepends[@]} 'gcc-multilib' 'clang')
  source=('x86_64.patch')
  md5sums=('d1ee291859447b7e62fa45790b75ad68')
fi

build() {
  cd "$startdir"
  if [ ! -f r3 ]; then 
      wget $_r3_i686_binary_url -O r3.tgz
      tar xvfz r3.tgz
  fi
  
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  [ "$CARCH" = "x86_64" ] && patch --verbose -p1 < "$srcdir"/x86_64.patch
  cd make
  if [ ! -x r3-make ]; then
    cp $startdir/r3 r3-make
  fi
  #make make
  make prep 
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  install -m755 -D make/r3 $pkgdir/usr/bin/r3
}

# vim:set ts=2 sw=2 et:

