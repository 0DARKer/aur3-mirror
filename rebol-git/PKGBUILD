# Maintainer: Daichi Shinozaki <dsdseg@gmail.com>
pkgname=rebol-git
pkgver=20121222
pkgrel=3
pkgdesc="A cross-platform data exchange language and a multi-paradigm dynamic programming language"
arch=('i686' 'x86_64')
url="http://www.rebol.com/r3/alpha-intro.html"
license=('Apache')
groups=('devel')
makedepends=('git' 'wget')
provides=('rebol')
conflicts=('rebol')
md5sums=() #generate with 'makepkg -g'

_gitroot=https://github.com/rebol/r3.git
_gitname=r3
_r3_binary_url=http://www.rebol.com/r3/downloads/r3-a111-4-4.tar.gz
_r3_binary=$(basename $_r3_binary_url)

build() {
  cd "$startdir"
  if [ ! -x r3 ]; then  
    if [ ! -f $_r3_binary ]; then 
      wget $_r3_binary_url
    fi
    tar xvfz $(basename $_r3_binary_url)
  fi

  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  #cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  cd "$srcdir/$_gitname"-build/make
  if [ ! -x r3-make ]; then
    cp $startdir/r3 r3-make
  fi
  #make make
  make prep 
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  install -m755 -D make/r3 $pkgdir/usr/bin/r3
}

# vim:set ts=2 sw=2 et:
