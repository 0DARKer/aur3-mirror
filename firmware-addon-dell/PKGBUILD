pkgname=("firmware-addon-dell")
pkgver=("2.2.9")

#Auto updater :D
temp=("$(wget -q -O - 'http://linux.dell.com/libsmbios/download/firmware-addon-dell/' | grep 'firmware-addon-dell-.\..\.' | sed -e 's/^.*-dell-//g' -e 's/\/.*$//g' | tr '\n' ';' | sed -e 's/;$/\n/g' -e 's/^.*;//g')")
#Fixes AUR syntax problems
pkgver=("${temp}")

pkgrel=1
pkgdesc="A firmware-tools plugin to handle BIOS/Firmware for Dell systems."
arch=(i686 x86_64)
url="http://linux.dell.com/repo/firmware/"
license=('GPL' 'OSL')
depends=('python2')
makedepends=('make' 'gawk')
optdepends=()
source=(http://linux.dell.com/libsmbios/download/firmware-addon-dell/firmware-addon-dell-${pkgver}/firmware-addon-dell-${pkgver}.tar.bz2)
md5sums=("dd7298c9dd2807893d1c01e4e473c098")
conflicts=()
provides=('firmware-addon-dell')

#grep '\..-' will work with any locale
PYTHON3VER=$(pacman -Qi python | grep '\..-' | sed -e 's/^.*: //' -e 's/-.*$//g' | awk -F '.' '{print $1"."$2}')
PYTHON2VER=$(pacman -Qi python2 | grep '\..-' | sed -e 's/^.*: //' -e 's/-.*$//g' | awk -F '.' '{print $1"."$2}')

build() {

  cd "$srcdir/${pkgname}-${pkgver}"
  ./configure --prefix=/usr --sysconfdir=/etc
  #UGLY HACK - Python 3 to Python 2
  sed -i -e 's/^PYTHON.=.*$/PYTHON = \/usr\/bin\/python2/' -e "s/${PYTHON3VER}/${PYTHON2VER}/g" Makefile
}

package() {

  cd "$srcdir/${pkgname}-${pkgver}"
  make DESTDIR="$pkgdir/" install
}
