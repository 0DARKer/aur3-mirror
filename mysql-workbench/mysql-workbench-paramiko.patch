diff --git a/plugins/wb.admin/backend/wb_admin_ssh.py b/plugins/wb.admin/backend/wb_admin_ssh.py
index 8c2802e..d158cbf 100644
--- a/plugins/wb.admin/backend/wb_admin_ssh.py
+++ b/plugins/wb.admin/backend/wb_admin_ssh.py
@@ -85,8 +85,12 @@ if paramiko and server_version_str2tuple(paramiko.__version__) >= (1, 7, 4):
             m.add_byte(chr(MSG_CHANNEL_OPEN))
             m.add_string(kind)
             m.add_int(chanid)
-            m.add_int(self.window_size)
-            m.add_int(self.max_packet_size)
+            if server_version_str2tuple(paramiko.__version__) < (1, 15, 0):
+                m.add_int(self.window_size)
+                m.add_int(self.max_packet_size)
+            else:
+                m.add_int(self.default_window_size)
+                m.add_int(self.default_max_packet_size)
             if (kind == 'forwarded-tcpip') or (kind == 'direct-tcpip'):
                 m.add_string(dest_addr[0])
                 m.add_int(dest_addr[1])
@@ -100,7 +104,10 @@ if paramiko and server_version_str2tuple(paramiko.__version__) >= (1, 7, 4):
             self.channel_events[chanid] = event = threading.Event()
             self.channels_seen[chanid] = True
             chan._set_transport(self)
-            chan._set_window(self.window_size, self.max_packet_size)
+            if server_version_str2tuple(paramiko.__version__) < (1, 15, 0):
+                chan._set_window(self.window_size, self.max_packet_size)
+            else:
+                chan._set_window(self.default_window_size, self.default_max_packet_size)
         finally:
             self.lock.release()
         self._send_user_message(m)
@@ -670,6 +677,7 @@ class WbAdminSSH(object):
         read_timeout = 10
 
         if self.client is not None:
+            chan = None
             transport = self.client.get_transport()
             try:
                 spawn_process = False
