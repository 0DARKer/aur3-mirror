# Maintainer: Illarion Kovalchuk <illarion.kovalchuk@gmail.com>
# Contributor: totoloco <totoloco at gmail _dot_com>
# Contributor: Ionut Biru <ibiru@archlinux.org>

pkgname=mysql-workbench
pkgver=5.2.39
pkgrel=6
pkgdesc="A cross-platform, visual database design tool developed by MySQL"
arch=('i686' 'x86_64')
url="https://www.mysql.com/products/workbench/"
license=('GPL2')
depends=('python' 'libzip' 'libmysqlclient' 'lua' 'gtkmm' 'ctemplate'
	 'libgnome-keyring' 'libgl' 'python-paramiko' 'python-pexpect'
	 'pcre' 'tinyxml' 'libxml2' 'mysql-python' 'python-pysqlite' 'cairo'
         'python-cairo' 'hicolor-icon-theme' 'desktop-file-utils')

makedepends=('boost' 'curl' 'mesa')
options=('!libtool !distcc !ccache')

source=(http://ftp.gwdg.de/pub/misc/mysql/Downloads/MySQLGUITools/${pkgname}-gpl-${pkgver}-src.tar.gz
        python2.patch
        glib2-2.32.patch)

md5sums=('35472b00d48a82d1d13954aef4f916fa'
         'a188c9c09e0422faf4d8521999bcc670'
         '49b430ececbbfbd60586c267a148ad76')

build() {
  cd "${srcdir}/${pkgname}-gpl-${pkgver}-src"

  # remove when http://bugs.mysql.com/bug.php?id=63898 gets fixed
  fgrep -rlZ pkglib_DATA --include Makefile.am . | xargs -0 sed -i 's/pkglib_DATA/pkgdata_DATA/g'

  patch -Np1 -i ${srcdir}/python2.patch
  patch -Np1 -i ${srcdir}/glib2-2.32.patch

  ./autogen.sh
  ./configure --prefix=/usr

  make || return 1
}

package() {
  cd "${srcdir}/${pkgname}-gpl-${pkgver}-src"

  make DESTDIR="${pkgdir}" install

  cd ${pkgdir}/usr/share/mysql-workbench/
  for i in *.py *.lua *.glade
  do
     ln -s /usr/share/mysql-workbench/$i ${pkgdir}/usr/lib/mysql-workbench/modules/
  done
 

}
