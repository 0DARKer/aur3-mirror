
pkgname=doublecmd-gtk2-bin-nightly
pkgver=3296
pkgrel=5
pkgdesc="Double Commander is a cross platform open source file manager with two panels side by side. It is inspired by Total Commander and features some new ideas."
arch=('i686' 'x86_64')
url='http://doublecmd.sourceforge.net'
depends=('gtk2')
optdepends=('lua: scripting')
provides=('doublecmd')
conflicts=('doublecmd-svn')
replaces=('doublecmd' 'doublecmd-svn')
license=('GPL2')
install=doublecmd-gtk2-bin-nightly.install
source=('doublecmd.desktop' 'doublecmd.xml' 'pixmaps.txt' 'multiarc.ini' 'default.bar')
md5sums=('da7d4b1403dcb2ee52c83d32c82caf7a'
         '20260b2b721837a3b0f141f689911cac')
md5sums=('da7d4b1403dcb2ee52c83d32c82caf7a'
         '20260b2b721837a3b0f141f689911cac'
         'cdc99eb1199303904cffd8eede86656b'
         '670241b3ab0729d598afe102394ff933'
         '880848c0ea1878df78f22e7b8d97b4fd')

case ${CARCH} in
  i686)
    source=(${source[@]} "http://downloads.sourceforge.net/project/doublecmd/DC%20for%20Linux%2032%20bit/Double%20Commander%200.4.5.2%20beta/doublecmd-0.4.5.2-1.gtk2.i386.tar.bz2")
    md5sums=(${md5sums[@]} 'c29effb4ab065737afab04801004f763')
    ;;
  x86_64)
    source=(${source[@]} "http://downloads.sourceforge.net/project/doublecmd/DC%20for%20Linux%2064%20bit/Double%20Commander%200.4.5.2%20beta/doublecmd-0.4.5.2-1.gtk2.x86_64.tar.bz2")
    md5sums=(${md5sums[@]} '9333467b40c7edc2950270965388d123')
    ;;
esac


build() {
    cd $srcdir

    case ${CARCH} in
       i686)
          FX_SRC="doublecmd.0.4.6.r${pkgver}.gtk2.i386.tar.bz2"
          ;;
       x86_64)
          FX_SRC="doublecmd.0.4.6.r${pkgver}.gtk2.x86_64.tar.bz2"
          ;;
       esac

    FX_SRC_URI="http://www.firebirdsql.su/dc/${FX_SRC}"

    prefix=/opt/doublecmd

    install -d -m755 "${pkgdir}/${prefix}"

    cp -r doublecmd "${pkgdir}/opt"
    rm $pkgdir/$prefix/doublecmd.ini
    install -m644 $srcdir/doublecmd.xml $pkgdir/$prefix/
    install -m644 $srcdir/pixmaps.txt $pkgdir/$prefix/
    install -m644 $srcdir/multiarc.ini $pkgdir/$prefix/
    install -m644 $srcdir/default.bar $pkgdir/$prefix/

    install -D $srcdir/doublecmd/libunrar.so $pkgdir/usr/lib/libunrar.so
    rm $pkgdir/$prefix/libunrar.so

 
    # create doublecmd link to /usr/bin
    mkdir -p $pkgdir/usr/bin
    ln -s $prefix/doublecmd $pkgdir/usr/bin/doublecmd

    # install desktop file and icon
    install -Dm644 $srcdir/doublecmd.desktop $pkgdir/usr/share/applications/doublecmd.desktop
    install -Dm644 $srcdir/doublecmd/doublecmd.png $pkgdir/usr/share/pixmaps/doublecmd.png

    # install nightly
    msg "Downloading..."
    cd "${startdir}"
    wget -N ${FX_SRC_URI}
    msg "Extracting..."
    cd "${pkgdir}/${prefix}"
    tar -xjf "${startdir}/${FX_SRC}"


    # Fix owner:group (???)
    chown -R root:root $pkgdir/$prefix

    msg "Packaging..."
}
