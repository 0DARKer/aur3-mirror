 # Contributor: Lawrence Lee <valheru@facticius.net>
 # Maintainer: Dany Martineau <dany.luc.martineau at gmail.com>

pkgname=kdegraphics-libs-digikam2-svn
pkgver=1178842
pkgrel=1
pkgdesc="Stable KDE4 Graphics Programs with trunk libkexiv and libkdcraw"
arch=('i686' 'x86_64')
url="http://www.kde.org"
license=('GPL')
makedepends=('pkgconfig' 'cmake' 'automoc4' 'subversion')
depends=('pkgconfig' 'cmake' 'automoc4' 'kdebase-runtime' 'poppler-qt'
	'libspectre' 'sane' 'chmlib' 'libdjvu' 'lcms' 'qimageblitz' 'ebook-tools'
	'libxxf86vm' 'docbook-xsl')
install='kdegraphics.install'
provides=(kdegraphics-libs kdegraphics-gwenview kdegraphics-kamera kdegraphics-kcolorchooser \
          kdegraphics-kgamma kdegraphics-kolourpaint kdegraphics-kruler kdegraphics-ksnapshot kdegraphics-okular)
conflicts=(kdegraphics-libs kdegraphics-gwenview kdegraphics-kamera kdegraphics-kcolorchooser \
          kdegraphics-kgamma kdegraphics-kolourpaint kdegraphics-kruler kdegraphics-ksnapshot kdegraphics-okular)

_svntrunk=svn://anonsvn.kde.org/home/kde/branches/KDE/4.5/kdegraphics/
_svnmod=kdegraphics
_svntrunk2=svn://anonsvn.kde.org/home/kde/trunk/KDE/kdegraphics/libs/libkdcraw/
_svnmod2=libkdcraw
_svntrunk3=svn://anonsvn.kde.org/home/kde/trunk/KDE/kdegraphics/libs/libkexiv2/
_svnmod3=libkexiv2

build() {
  cd ${srcdir}

  if [ -d ${_svnmod}/.svn ]; then
    (cd ${_svnmod} && svn revert -R .)
    (cd ${_svnmod} && svn -r ${pkgver} up)
    (cd ${_svnmod2} && svn revert -R .)
    (cd ${_svnmod2} && svn -r ${pkgver} up)
    (cd ${_svnmod3} && svn revert -R .)
    (cd ${_svnmod3} && svn -r ${pkgver} up)
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
    svn co ${_svntrunk2} --config-dir ./ -r ${pkgver} ${_svnmod2}
    svn co ${_svntrunk3} --config-dir ./ -r ${pkgver} ${_svnmod3}
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}/${_svnmod}
  rm -Rf libs/{libkexiv2,libkdcraw}
  cp -fR ../${_svnmod2} libs/
  cp -fR ../${_svnmod3} libs/
  cmake 	-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_INSTALL_PREFIX=/usr  
	make
	make DESTDIR=$pkgdir install
	install -D -m644 $srcdir/${_svnmod}/cmake/modules/FindKSane.cmake \
		$pkgdir/usr/share/apps/cmake/modules/FindKSane.cmake	
	install -D -m644 $srcdir/${_svnmod}/cmake/modules/FindOkular.cmake \
		$pkgdir/usr/share/apps/cmake/modules/FindOkular.cmake
}
