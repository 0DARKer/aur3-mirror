# Maintainer: Nick Hu <nickhu00@gmail.com>
pkgname=cataclysm-dda
pkgver=0.6
pkgrel=1
pkgdesc="Cataclysm: Dark Days Ahead is an actively maintained roguelike set in a post-apocalyptic world, forked from the original."
arch=('i686' 'x86_64')
url="http://www.cataclysmdda.com/"
license=('CCPL:by-sa')
depends=('gcc-libs' 'glibc' 'ncurses')
install='cataclysm-dda.install'
source=('http://assets.cataclysmdda.com/downloads/linux_binaries/cddacurses-current.tar.gz'
        'keymap.txt')
md5sums=('af8584f13445fbd46944d163e536b9f6'
         'c8029f9edbff686645fb731e5820f6d2')

build() {
	cd "$srcdir/cataclysmdda-${pkgver}"
  # Ugly hack to compensate for libtinfo.so.5 (Unnecessary with Arch's libncurses)
  sed -i 's/\x6C\x69\x62\x74\x69\x6E\x66\x6F\x2E\x73\x6F\x2E\x35/\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00/' cataclysm

  sed -i 's|DIR=.*|DIR=/usr/share/cataclysm-dda|' cataclysm-launcher
}

package() {
	cd "$srcdir/cataclysmdda-${pkgver}"
	install -Dm755 cataclysm-launcher "$pkgdir/usr/bin/cataclysm-dda"
	install -Dm755 cataclysm "$pkgdir/usr/share/cataclysm-dda/cataclysm"
	install -dm755  "$pkgdir/usr/share/cataclysm-dda/data"
	cp -r data/* "$pkgdir/usr/share/cataclysm-dda/data"
	install -dm777 -g games "$pkgdir/var/games/cataclysm-dda/save"
  ln -s "/var/games/cataclysm-dda/save" "$pkgdir/usr/share/cataclysm-dda/save"
  install -Dm764 -g games "$srcdir/keymap.txt" "$pkgdir/usr/share/cataclysm-dda/data"
}
