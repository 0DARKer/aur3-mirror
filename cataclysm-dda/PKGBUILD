# Maintainer: Nick Hu <nickhu00@gmail.com>
pkgname=cataclysm-dda
pkgver=0.5
pkgrel=1
pkgdesc="Cataclysm: Dark Days Ahead is an actively maintained roguelike set in a post-apocalyptic world, forked from the original."
arch=('i686' 'x86_64')
url="http://www.cataclysmdda.com/"
license=('CCPL:by-sa')
depends=('gcc-libs' 'glibc' 'ncurses')
makedepends=('gcc')
install='cataclysm-dda.install'
source=('https://github.com/TheDarklingWolf/Cataclysm-DDA/archive/master.zip'
        'keymap.txt')
md5sums=('645dbb9147977aa536c08fdf8ebfde3e'
         '9e902c046fb224109eaa488f0255f665')

build() {
	cd "$srcdir/Cataclysm-DDA-master"

	# Hard coded data/save directories
	# Fix from keenerd's cataclysm-git package
	sed -i 's|"data/|"/usr/share/cataclysm-dda/data/|g' *.cpp
	sed -i 's|"./data/|"/usr/share/cataclysm-dda/data/|g' *.cpp
	sed -i 's|"data"|"/usr/share/cataclysm-dda/data"|g' *.cpp
	sed -i 's|"save"|"/var/games/cataclysm-dda/save"|g' {game,map,overmap}.cpp
	sed -i 's|"save/|"/var/games/cataclysm-dda/save/|g' {game,map,overmap}.cpp
	
	# someday...
	#sed -i '1i #include <stdio.h>' {game,map,overmap}.cpp
	#sed -i 's|"save/|getenv("HOME") << "/.cataclysm-dda/save/|g' *.cpp

	make
}

package() {
	cd "$srcdir/Cataclysm-DDA-master"
	install -Dm755 cataclysm "$pkgdir/usr/bin/cataclysm-dda"
	install -dm755  "$pkgdir/usr/share/cataclysm-dda/data"
	cp -r data/* "$pkgdir/usr/share/cataclysm-dda/data"
	install -dm777 -g games "$pkgdir/var/games/cataclysm-dda/save"
  install -Dm764 -g games "$srcdir/keymap.txt" "$pkgdir/usr/share/cataclysm-dda/data"
}
