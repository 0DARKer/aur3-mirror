# Maintainer: Cravix < dr dot neemous at gmail dot org >
# Contributor: Ronald van Haren <ronald.archlinux.org>

# That's only what I select. Change it as you want.
# the order is the same as the module sets order in ./DOC.
defset=(alarm deskshow exebuf mail news places winselector forecasts 
  engage 
  empris 
  eenvader.fractal photo slideshow 
  eektool execwatch 
  everything-mpris everything-pidgin everything-tracker everything-websearch
)

pkgname=e-modules-extra-git
_pkgname=E-MODULES-EXTRA
pkgver=0.17.4155.92a8841
pkgrel=1
pkgdesc="Extra gadgets for e17"
arch=('i686' 'x86_64')
groups=('e17-extra-svn')
url="http://www.enlightenment.org"
license=('GPLv2' 'LGPLv2' 'MIT')
depends=('enlightenment17-git')
makedepends=('git')
optdepends=('eweather-git: nice weather forecast module')
conflicts=('e-modules-extra')
provides=('e-modules-extra')
options=('!libtool')
source=('REST' 'DOC'
        "git://git.enlightenment.fr/vcs/svn/E-MODULES-EXTRA.git")
md5sums=('044ac283e4265f5578e3437fc0d85521'
         '85443d725a3aebe1a7680cad505b0630'
         'SKIP')

#those in git repo.
gitrepo=(comp-scale eenvader.fractal elev8 elfe empris engage everything-places
 everything-websearch eweather forecasts mail moon mpdule net news penguins
 photo places tclock)
declare -A gitflag
for i in ${gitrepo[@]}; do
  gitflag["$i"]=1
done
for i in ${defset[@]}; do
  [[ ${gitflag[$i]} = 1 ]] &&
  {
		source+=("git://git.enlightenment.org/enlightenment/modules/${i}.git")
		md5sums+=('SKIP')
	} 
done


echo -e "$(tput bold)You can customize the module set (defset) on your own in PKGBUILD.
Also, read ./DOC for more info about the functions of modules.$(tput sgr0)"
sleep 1
pkgver() {
  cd "$srcdir/$_pkgname"
  echo 0.17.$(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
	cd "$srcdir"
	
	# move into one dir to make it easier to build
	for i in *; do
	  [[ -d $i ]] && [[ $i != $_pkgname ]]  && mv $i $_pkgname
	done

  cd "$srcdir/$_pkgname"
    
  for i in ${defset[@]}; do
    cd $i
    ./autogen.sh --prefix=/usr
    make
    cd ..
  done
} 

package() {
  cd $srcdir/$_pkgname

  for i in ${defset[@]}; do
    cd $i
    make DESTDIR=$pkgdir install
    # install license files
    if [ -e $srcdir/$_svnmod-build/$i/COPYING ]; then
      install -Dm644 $srcdir/$_svnmod-build/$i/COPYING \
          $pkgdir/usr/share/licenses/$pkgname/$i/COPYING
    fi
    if [ -e $srcdir/$_svnmod-build/$i/COPYING-PLAIN ]; then
      install -Dm644 $srcdir/$_svnmod-build/$i/COPYING-PLAIN \
          $pkgdir/usr/share/licenses/$pkgname/$i/COPYING-PLAIN
    fi
    cd ..
 done
}
