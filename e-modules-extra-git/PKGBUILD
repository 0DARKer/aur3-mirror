# Contributor: Doug Newgard <scimmia22 at outlook dot com>
# Contributor: Cravix < dr dot neemous at gmail dot org >
# Contributor: Ronald van Haren <ronald.archlinux.org>

# IMPORTANT!!! Modify this list for your specific installation
_module_list=(
  'alarm'
  'cpu'
  'diskio'
  'eenvader.fractal'
# 'elev8'                # adds dep on v8
# 'elfe'                 # not compatible with Enlightenment 0.18+
# 'empris'               # not compatible with EFL 1.8
  'everything-places'
  'everything-websearch'
  'forecasts'
  'mail'
  'moon'
  'mpdule'               # adds dep on libmpd
  'net'
  'news'                 # not compatible with Enlightenment 0.17
  'packagekit'           # not compatible with Enlightenment 0.17
  'penguins'
# 'photo'                # not compatible with Enlightenment 0.18+
  'tclock'
)

containsElement () {
  local e
  for e in "${@:2}"; do [[ "$e" == "$1" ]] && return 0; done
  return 1
}

pkgname=e-modules-extra-git
pkgver=20131121
pkgrel=1
pkgdesc="Enlightenment modules: Extra unsupported modules in Git not already packaged elsewhere"
arch=('i686' 'x86_64')
url="http://www.enlightenment.org"
license=('GPL' 'MIT')
depends=('enlightenment17')
  containsElement "elev8" "${_module_list[@]}" && depends+=('v8')
  containsElement "mpdule" "${_module_list[@]}" && depends+=('libmpd')
makedepends=('git')
provides=("${pkgname%-*}")
for _module in ${_module_list[@]}; do
  source+=("git://git.enlightenment.org/enlightenment/modules/$_module.git")
  sha256sums+=('SKIP')
done

pkgver() {
  date +%Y%m%d
}

build() {
  for _module in ${_module_list[@]}; do
    cd "$srcdir/$_module"

    msg2 "Building $_module"

    ./autogen.sh --prefix=/usr

    make
  done
}

package() {
  for _module in ${_module_list[@]}; do
    cd "$srcdir/$_module"

    msg2 "Installing $_module"

    make DESTDIR=$pkgdir install

#   install text files
    [[ -e ChangeLog ]] && install -Dm644 ChangeLog "$pkgdir/usr/share/doc/${pkgname%-*}/$_module/ChangeLog"
    [[ -e NEWS ]] && install -Dm644 NEWS "$pkgdir/usr/share/doc/${pkgname%-*}/$_module/NEWS"
    [[ -e README ]] && install -Dm644 README "$pkgdir/usr/share/doc/${pkgname%-*}/$_module/README"

#   install license files
    [[ -e AUTHORS ]] && install -Dm644 AUTHORS "$pkgdir/usr/share/licenses/$pkgname/$_module/AUTHORS"
    [[ -e COPYING ]] && install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/$_module/COPYING"
    [[ -e COPYING-PLAIN ]] && install -Dm644 COPYING-PLAIN "$pkgdir/usr/share/licenses/$pkgname/$_module/COPYING-PLAIN"
 done
}
