# Maintainer: Eric Renfro <erenfroatgmaildotcom>

pkgname=ha-pacemaker-crmsh
pkgver=1.2.1
pkgrel=2
pkgdesc="Pacemaker Configuration Shell - The original shell from SUSE"
arch=('i686' 'x86_64')
url="https://savannah.nongnu.org/projects/crmsh/"
license=('GPL')
makedepends=('ha-pacemaker' 'python2')
depends=('ha-heartbeat' 'libxslt' 'ha-pacemaker' 'python2')
#source=("http://hg.clusterlabs.org/pacemaker/1.1-buildbot/archive/1dbbee9bc278.tar.bz2")
source=("http://hg.savannah.gnu.org/hgweb/crmsh/archive/b6bb311c7bd3.tar.bz2")
md5sums=('f4d0a4d30498c3b5ee73ff8b70eb3005')

options=('!libtool' 'docs' 'strip')

build() {
	unset LDFLAGS
	_CLUSTER_USER=hacluster
	_CLUSTER_GROUP=haclient
	_PREFIX=/usr
	_PREFIXETC=/etc
	_PREFIXINIT=${_PREFIXETC}/rc.d
	_PREFIXVAR=/var
	_LCRSODIR=${_PREFIX}/lib/lcrso
	cd "${srcdir}/crmsh-b6bb311c7bd3"
	./autogen.sh
	PYTHON="/usr/bin/python2" ./configure \
		--prefix=${_PREFIX} \
		--localstatedir=${_PREFIXVAR} \
		--sysconfdir=${_PREFIXETC}
	make || return 1
	make DESTDIR="${pkgdir}" install || return 1
	
	#fix python
	sed -i 's:/usr/bin/python$:/usr/bin/python2:g' ${pkgdir}/usr/sbin/crm
	#cp ${srcdir}/crm2 ${pkgdir}/usr/sbin/crm2
	#chmod 755 ${pkgdir}/usr/sbin/crm2
	#chown root:root ${pkgdir}/usr/sbin/crm2
}
