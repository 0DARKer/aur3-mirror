# Contributor: Andrej Gelenberg <andrej.gelenberg@udo.edu>
# Contributor: Kirill "reflexing" Churin <reflexing@reflexing.ru>

pkgname=keepass
pkgver=2.14
pkgrel=2
pkgdesc="KeePass Password Safe, the free, open source, light-weight and easy-to-use password manager."
arch=('any')
url="http://keepass.info/"
license=('GPL2')
depends=('mono>=2.6' 'desktop-file-utils' 'xdg-utils')
optdepends=('xdotool: if you want to use auto-type.')
install=keepass.install
source=(http://downloads.sourceforge.net/project/keepass/KeePass%202.x/${pkgver}/KeePass-${pkgver}.zip
        http://keepass.info/filepool/ColHdrWorkaround-1.0.zip
        keepass
        keepass.desktop
        application-x-keepass.xml
        KeePass_6_256x256x32.png
        KeePass_7_48x48x32.png
        KeePass_8_32x32x32.png
        KeePass_9_16x16x32.png)

md5sums=('4c54f135e3ca10445a97ae02db7a527c'
         '32d5621feffc0ef9dc158dcbaae051ac'
         '125310561857cf8dd91832c905d57c1b'
         '1dd67cae10f359a2bf2c19141442f9e6'
         '361a445fb519ef51019ea77e041981df'
         '490859f348e492b5e33739262ff07f00'
         '5b060d5376e94f6743e787a46f53e9a3'
         '17044c8d69ad5275a2a57843b19ad89d'
         '4dfb6d0d6535c6d57ee88a4de7119095')
sha512sums=('57a62d774cb4d767e68dca0831f2725b724c41b2573201615e4143d6b06b490d1a37323f1c401f684fbc39e9afbb6bcdb6d85dee80d7aab4eb93c29faeee4b69'
            'ec6bfc3eca256f3e8f95dac765a2e52d7ee2ad4e76d414a0a2d59eefc5616f211725e8607ddeeb657a46d0f02d5287135ad719b302f540dcce47d313735ff7cb'
            'ab0db4bbef5dfdc428b6ac69675b0cc7b1dbf77145f73b91b3e5a38bede5979e97263f07afeb8293c8d1b54e5ad17fa7f348d5a979c8a7da81211eeb28b9481a'
            '79fe2a4f29cec3c2c5256d68cfeb022b11f25efacce8fb063524c036123822a3db9aa85bad8921f340702f95acb28b31a116c4c73c33214f9967b2cf951b6702'
            'bbe0560c7d5b0d1d0b59161f6bd7b808863aa30638e159eb5cc16234fb4b04dadea8c12c8ba15ba8688a4f266e66f08727a6e8fec785a43b485e1d8e859cb4b8'
            '060d1f82107dda7f32261cbe036b6931844625e4f1c8d745fad6f1dee40c575d48334b3fc9218779efac0b295f6a71915bd55fd7e1a8677bd053159342338f48'
            '9657fc09c0ab271c7c835eaba3d37ebc7664276edecb3d2b2221c4e75c2d3d7d5d3091e0cd93906cfb8ddf8e9d8665a743dbf51e54d876766d0e675f75e2d3b5'
            'a10a06934320289ce2516d4d9800c72459654efea026903a9bb3dfa8aa147da553c3da04cbaf65a4885091623a58133466ba5d58c154615d8110fccf936cc38d'
            '26d1c5e2d8f92e15200bd344915e0e3373b84ac426655c0b1ecf311b5f5d8a105e66b085d38c44753669aaabf4aaeba29f856f0a76e90b09028d08a5965a59f8')

package() {
  cd ${srcdir}
  
  install -dm755 ${pkgdir}/usr/bin
  install -dm755 ${pkgdir}/usr/share/keepass/XSL  
  
  install -Dm755 keepass ${pkgdir}/usr/bin/keepass  
  install -Dm755 KeePass.exe ${pkgdir}/usr/share/keepass/KeePass.exe
  install -Dm755 KeePass.chm ${pkgdir}/usr/share/keepass/KeePass.chm

  # See http://sourceforge.net/projects/keepass/forums/forum/329221/topic/3766200
  install -Dm755 ColHdrWorkaround.dll ${pkgdir}/usr/share/keepass/ColHdrWorkaround.dll

  install -m644 XSL/* ${pkgdir}/usr/share/keepass/XSL
  
  # Proper installation of .desktop file
  desktop-file-install -m 0644 --dir ${pkgdir}/usr/share/applications/ keepass.desktop
  
  # Install Icons (got from source package with "icotool -x KeePass.ico")
  for size in 16 32 48 256; do
    install -m644 -D \
    KeePass_*_${size}x${size}x32.png \
    ${pkgdir}/usr/share/icons/hicolor/${size}x${size}/apps/keepass.png
  done
  
  # Needed for postinst with xdg-utils
  install -Dm644 application-x-keepass.xml ${pkgdir}/usr/share/keepass/mime/application-x-keepass.xml
}