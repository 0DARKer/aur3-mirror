# Contributor : zico <zicodxx@yahoo.de>

pkgname=d1x-rebirth
pkgver=0.56
pkgrel=1
pkgdesc="An enhanced engine to play with Descent1 datas"
arch=('i686' 'x86_64')
url="http://www.dxx-rebirth.com/"
license=('custom:D1x' 'LGPL' 'custom:as-is')
depends=('sdl' 'sdl_mixer' 'mesa' 'physfs')
makedepends=('scons' 'unzip')
install=($pkgname.install)
source=(http://downloads.sourceforge.net/dxx-rebirth/${pkgname}_v${pkgver}-src.tar.gz $pkgname.desktop $pkgname.install http://www.dxx-rebirth.com/download/dxx/res/d1xr-hires.zip http://www.dxx-rebirth.com/download/dxx/res/d1xr-sc55-music.zip)
noextract=(d1xr-hires.zip)
md5sums=('725c24e9c9c47faa90e3543fcfa2539a' 'e566999da62790c21c7782f6ab65a5bf' 'ae8c38750b8bc3986ec24ee58367b6c7' '204e378106e729adc5f908bebebc3fe1' 'f94a8c4a5bbed54facf466de67fdda3d') 

build() {
  cd $startdir/src/${pkgname}_v${pkgver}-src
  sed -ie "/^PREFIX =/s|/usr/local/|/usr/|" SConstruct
  scons sdlmixer=1 sharepath="/usr/share/$pkgname" || return 1
  
  mkdir -p $startdir/pkg/usr/bin/
  mkdir -p $startdir/pkg/usr/share/$pkgname/
  mkdir -p $startdir/pkg/usr/share/pixmaps/
  mkdir -p $startdir/pkg/usr/share/applications/
  mkdir -p $startdir/pkg/usr/share/licenses/$pkgname/

  install -m755 $pkgname-gl $startdir/pkg/usr/bin/
  cd $startdir/src/
  install -m644 $startdir/src/${pkgname}_v${pkgver}-src/$pkgname.xpm $startdir/pkg/usr/share/pixmaps/
  install -m644 $startdir/src/$pkgname.desktop $startdir/pkg/usr/share/applications/
  install -m644 $startdir/src/${pkgname}_v${pkgver}-src/COPYING.txt $startdir/pkg/usr/share/licenses/$pkgname/
  install -m644 d1xr-hires.zip $startdir/pkg/usr/share/$pkgname/
  install -m644 d1xr-sc55-music.zip $startdir/pkg/usr/share/$pkgname/
} 
