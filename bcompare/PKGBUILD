# Contributor: Musikolo <musikolo {at} hotmail [dot] com>

pkgname=bcompare
pkgver=3.2.4.13298
pkgdesc="Beyond Compare 3: Compare, sync, and merge files and folders"
pkgrel=1
# Only i686 architecture supported so far :-(
#arch=(i686 x86_64)
arch=(i686)
url="http://www.scootersoftware.com/index.php"
license=(GPL3)
groups=('utility')
makedepends=()
depends=()
options=()
source=(http://www.scootersoftware.com/${pkgname}-${pkgver}.tar.gz)
sha256sums=('97ac7d410a376193f95112c41b070fce9244cf8e42b1fb2812d9ff823b7d523c')

build() {
  # Prepare the installation prefix and directories
  cd "${srcdir}/${pkgname}-${pkgver}"
  _prefixdir=../../pkg/usr
  sed -i 's|/usr/share/|${PREFIX}/share/|g' install.sh
  mkdir -p "${_prefixdir}/share/applications"
  mkdir -p "${_prefixdir}/share/pixmaps"

  # Lanuch installation script
  ./install.sh --prefix="${_prefixdir}" > /dev/null || return 1

  # Clean up unneded files
  cd "${_prefixdir}/lib/beyondcompare"
  rm -f RPM-GPG-KEY-scootersoftware scootersoftware.repo uninstall.sh

  # Adjust all scripts variables directory pathes
  cd ../..
  sed -i 's|../../pkg||g' bin/${pkgname} || return 1
  find -name '*.sh' -type f -exec sed -i 's|../../pkg||g' {} \; || return 1
}
