# Contributor: Musikolo <musikolo {at} hotmail [dot] com>

pkgname=bcompare
pkgver=3.3.1.13971
pkgdesc="Beyond Compare 3: Compare, sync, and merge files and folders"
pkgrel=1
# Only i686 architecture supported so far :-(
#arch=(i686 x86_64)
arch=(i686)
url="http://www.scootersoftware.com/index.php"
license=(GPL3)
groups=('utility')
makedepends=()
depends=()
options=()
source=(http://www.scootersoftware.com/${pkgname}-${pkgver}.tar.gz)
sha256sums=('6243016e888dca46fd8195f90c45d106b0ce5f8b0490ffc3e178890ac60b92fb')

build() {
  # Prepare the installation prefix and directories
  cd "${srcdir}/${pkgname}-${pkgver}"
  _prefixdir=../../pkg/usr
  sed -i 's|/usr|${NEW_PREFIX}|g' install.sh
  mkdir -p "${_prefixdir}/share/applications"
  mkdir -p "${_prefixdir}/share/pixmaps"
  mkdir -p "${_prefixdir}/share/mime/packages"

  # Lanuch installation script
  NEW_PREFIX="${_prefixdir}" ./install.sh --prefix="${_prefixdir}" > /dev/null || return 1

  # Clean up unneded files
  cd "${_prefixdir}/lib/beyondcompare"
  rm -f RPM-GPG-KEY-scootersoftware scootersoftware.repo uninstall.sh
  rm -f ext/*.amd64.so

  # Adjust all scripts variables directory pathes
  cd ../..
  sed -i 's|../../pkg||g' bin/${pkgname} || return 1
  find -name '*.sh' -type f -exec sed -i 's|../../pkg||g' {} \; || return 1
}
