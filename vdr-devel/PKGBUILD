# Contributor: M0Rf30
pkgname=vdr-devel
pkgver=1.7.16
pkgrel=8
arch=(i686 x86_64)
pkgdesc="A video disk recorder"
url="http://www.tvdr.de/"
provides='vdr'
license=('GPL')
depends=('fontconfig' 'gettext' 'libjpeg' 'perl')
optdepends=('lirc: To use a remote control'
            'runvdr-extreme: An alternative runvdr script'
            'vdrsymbols-ttf: Symbols that some VDR plugins and patches use')
backup=('etc/vdr/channels.conf'
        'etc/vdr/diseqc.conf'
        'etc/vdr/keymacros.conf'
        'etc/vdr/sources.conf'
        'etc/vdr/svdrphosts.conf')
options=(!emptydirs)
install=('vdr.install')
source=(ftp://ftp.tvdr.de/vdr/Developer/vdr-$pkgver.tar.bz2 
        http://copperhead.htpc-forum.de/downloads/extensionpatch/extpngvdr1.7.16v7.1incl_community_and_kls_fixes.diff.gz
        rc-runvdr
        vdr-shutdown.sh
	Make.config)
md5sums=('d5cc4bf87e73385a843f5de4763639f0'
         'a78dd2f07b158620fa3e76c86a6cb0da'
         'dc40bfb16e2ecd9c69043d754b401bfa'
         '6426eac608143bacbf7233c15af86193'
	 'e1b132e62353788e10b2ab482e8f3523')

build() {

    cd $srcdir/vdr-$pkgver
    zcat ../extpngvdr1.7.16v7.1incl_community_and_kls_fixes.diff.gz > ../patch
    patch -p1 -i ../patch
   # Update lirc socket location in man page
  sed -i "s|/dev/lircd|/var/run/lirc/lircd|g" vdr.1

  # Don't install runvdr
  sed -i "s|runvdr ||g" Makefile

  # VDR directory environment (Make.config):
  # MANDIR       = /usr/share/man
  # BINDIR       = /usr/bin
  # LOCDIR       = /usr/share/locale
  # PLUGINLIBDIR = /usr/lib/vdr
  # VIDEODIR     = /var/spool/video
  # CONFDIR      = /etc/vdr
  # Also:
  # VDR_USER = vdr

  install -d -m755 "${pkgdir}/etc/rc.d"
  install -d -m755 "${pkgdir}/usr/bin"
  install -d -m755 "${pkgdir}/usr/include/vdr/include"
  install -d -m755 "${pkgdir}/usr/include/vdr/libsi"
  install -d -m755 "${pkgdir}/usr/share/doc/${pkgname}"

  cp ${srcdir}/Make.config Make.config

  make
  make DESTDIR="${pkgdir}" install



  # Install vdr header files
  install -m644 *.h "${pkgdir}/usr/include/vdr"
  install -m644 libsi/*.h "${pkgdir}/usr/include/vdr/libsi"
  ln -sf .. "${pkgdir}/usr/include/vdr/include/vdr"
  ln -sf ../libsi "${pkgdir}/usr/include/vdr/include/libsi"

  # Install daemon and shutdown scripts
  install -m755 "${srcdir}/rc-runvdr" "${pkgdir}/etc/rc.d/runvdr"
  install -m755 "${srcdir}/vdr-shutdown.sh" "${pkgdir}/usr/bin/vdr-shutdown.sh"
    
}

