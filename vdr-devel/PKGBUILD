# Contributor: M0Rf30
pkgname=vdr-devel
pkgver=1.7.16
pkgrel=7
arch=(i686 x86_64)
pkgdesc="A video disk recorder"
url="http://www.tvdr.de/"
provides='vdr'
license=('GPL')
depends=('xorg-font-utils' 'fontconfig' 'freetype2' 'gettext' 'libjpeg' 'libcap')
backup=('etc/vdr/channels.conf'
	'etc/vdr/diseqc.conf'
	'etc/vdr/keymacros.conf'
	'etc/vdr/sources.conf'
	'etc/vdr/svdrphosts.conf'
	'etc/rc.vdr')
install=('vdr.install')
source=(ftp://ftp.tvdr.de/vdr/Developer/vdr-$pkgver.tar.bz2 
        http://copperhead.htpc-forum.de/downloads/extensionpatch/extpngvdr1.7.16v7.1incl_community_and_kls_fixes.diff.gz
        vdr
	rc.vdr
	vdrshutdown.sh
        runvdr
        Make.config
        )
md5sums=('d5cc4bf87e73385a843f5de4763639f0'
         'a78dd2f07b158620fa3e76c86a6cb0da'
         '929dd88ad15f4bb8835b095429dfd044'
         '7ac069e4f8a0a74a9236e2557c7f3ee1'
         '6202e41b03a55e51575dfb278a2ac0fc'
         '07dac5b5f9c693727aabd8ffe1d36be5'
         '32e501c14330ee216d58a9eaa2b2fea4')

build() {

    cd $srcdir/vdr-$pkgver
    zcat ../extpngvdr1.7.16v7.1incl_community_and_kls_fixes.diff.gz > ../patch
    patch -p1 -i ../patch
    cp $srcdir/Make.config $srcdir/vdr-$pkgdirver 
    
    #This version need to be compiled without fi_FI.po cause this file is broken
   # rm $srcdir/vdr-$pkgver/po/fi_FI.po
    
    make CONFDIR=/etc/vdr \
         LOCDIR=/usr/src/VDR/locale \
         PLUGINDIR=/usr/lib/vdr \
         PLUGINLIBDIR=/usr/lib/vdr || return 1

    make MANDIR=$pkgdir/usr/man \
         BINDIR=$pkgdir/usr/bin \
         CONFDIR=$pkgdir/etc/vdr \
         LOCDIR=$pkgdir/usr/src/vdr-$pkgver/locale \
         PLUGINLIBDIR=$pkgdir/usr/lib/vdr \
         VIDEODIR=$pkgdir/video install || return 1
    make clean
    make clean-plugins
    make include-dir || return 1

    cp $srcdir/vdr-$pkgver/*.pl $pkgdir/usr/bin/

    mkdir -p $pkgdir/video/epgimages

    mkdir -p $pkgdir/usr/src

    cp -r $srcdir/vdr-$pkgver $pkgdir/usr/src/
    cd $pkgdir/usr/src
    ln -s vdr-$pkgver VDR

    mkdir -p $pkgdir/etc/rc.d
    install -D $srcdir/vdr $pkgdir/etc/rc.d/

    cp $srcdir/rc.vdr $pkgdir/etc/

    install -D $srcdir/vdrshutdown.sh $pkgdir/usr/bin/

    install -D $srcdir/runvdr $pkgdir/usr/bin
    
}

