# Contributor: M0Rf30
pkgname=vdr-devel
pkgver=1.7.18
pkgrel=1
arch=(i686 x86_64)
pkgdesc="A video disk recorder"
url="http://www.tvdr.de/"
provides='vdr'
license=('GPL')
depends=('fontconfig' 'gettext' 'libjpeg' 'perl')
optdepends=('lirc: To use a remote control'
            'runvdr-extreme: An alternative runvdr script'
            'vdrsymbols-ttf: Symbols that some VDR plugins and patches use')
backup=('etc/vdr/channels.conf'
        'etc/vdr/diseqc.conf'
        'etc/vdr/keymacros.conf'
        'etc/vdr/sources.conf'
        'etc/vdr/svdrphosts.conf')
options=(!emptydirs)
install=('vdr.install')
source=(ftp://ftp.tvdr.de/vdr/Developer/vdr-$pkgver.tar.bz2 
        http://copperhead.htpc-forum.de/downloads/extensionpatch/extpngvdr1.7.17v1b9.diff.gz
        rc-runvdr
        vdr-shutdown.sh
	Make.config)


build() {

    cd $srcdir/vdr-$pkgver
    zcat ../extpngvdr1.7.17v1b9.diff.gz > ../patch
    patch -p1 -i ../patch
   # Update lirc socket location in man page
  sed -i "s|/dev/lircd|/var/run/lirc/lircd|g" vdr.1

  # Don't install runvdr
  sed -i "s|runvdr ||g" Makefile

  # VDR directory environment (Make.config):
  # MANDIR       = /usr/share/man
  # BINDIR       = /usr/bin
  # LOCDIR       = /usr/share/locale
  # PLUGINLIBDIR = /usr/lib/vdr
  # VIDEODIR     = /var/spool/video
  # CONFDIR      = /etc/vdr
  # Also:
  # VDR_USER = vdr

  install -d -m755 "${pkgdir}/etc/rc.d"
  install -d -m755 "${pkgdir}/usr/bin"
  install -d -m755 "${pkgdir}/usr/include/vdr/include"
  install -d -m755 "${pkgdir}/usr/include/vdr/libsi"
  install -d -m755 "${pkgdir}/usr/share/doc/${pkgname}"

 # cp ${srcdir}/Make.config Make.config

  make
  make DESTDIR="${pkgdir}" install



  # Install vdr header files
  install -m644 *.h "${pkgdir}/usr/include/vdr"
  install -m644 libsi/*.h "${pkgdir}/usr/include/vdr/libsi"
  ln -sf .. "${pkgdir}/usr/include/vdr/include/vdr"
  ln -sf ../libsi "${pkgdir}/usr/include/vdr/include/libsi"

  # Install daemon and shutdown scripts
  install -m755 "${srcdir}/rc-runvdr" "${pkgdir}/etc/rc.d/runvdr"
  install -m755 "${srcdir}/vdr-shutdown.sh" "${pkgdir}/usr/bin/vdr-shutdown.sh"
  install -m755 "${srcdir}/vdr-$pkgver/vdr"  "${pkgdir}/usr/bin/runvdr"
# Install documents
  cp runvdr.template runvdr
  for _document in channels.conf* *.template CONTRIBUTORS HISTORY INSTALL MANUAL PLUGINS.html README* runvdr UPDATE*; do
    install -m644 ${_document} "${pkgdir}/usr/share/doc/${pkgname}"
  done
    
}


md5sums=('33dabd25c3eb829dc8c6c4109d27834f'
         '62c20e6b55c2d1d2d9fe046574c493c7'
         'dc40bfb16e2ecd9c69043d754b401bfa'
         '6426eac608143bacbf7233c15af86193'
         '986eeed40bd76d9d0f07b4157a60ac50')
