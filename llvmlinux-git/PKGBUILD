# Mantainer Jens Staal <staal1978@gmail.com>

pkgname=llvmlinux-git

pkgdesc="The Linux Kernel built with LLVM/Clang"
depends=('coreutils' 'linux-firmware' 'mkinitcpio')

pkgver=906.5dd1ca1
pkgrel=1
url="http://llvm.linuxfoundation.org/index.php/Main_Page"
arch=('i686' 'x86_64')
license=('GPL2')
makedepends=('git' 'quilt' 'python2' 'cmake' 'llvm' 'clang') 
#todo: we want to build with stock clang and skip that part of the building
options=(!strip)

source=('llvmlinux'::'git://git.linuxfoundation.org/llvmlinux.git')
md5sums=('SKIP')

pkgver() {
	cd llvmlinux
	echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

#32-bit build assume i586, so we need a variable for that
if [ ${CARCH} == i686 ]; then
	_lll_target=i586
else
	_lll_target=x86_64
fi

#strangely, on the wiki it is mentioned that building llvm/clang
#can be skipped by modifying
#llvmlinux/config/make-kernel.sh
#but there is no such directory/file

prepare() {
	cd ${srcdir}/llvmlinux/targets/${_lll_target}
	make kernel-fetch
	rm -rf ${srcdir}/bin
	mkdir -p ${srcdir}/bin
	ln -s /usr/bin/python2 ${srcdir}/bin/python
	export PATH=${srcdir}/bin:${PATH}
}

build() {
	cd ${srcdir}/llvmlinux/targets/${_lll_target}
	make kernel-build
}

package() {
	msg "we will do something here..."
}