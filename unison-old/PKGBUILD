# Maintainer: Thomas Jost <schnouki@schnouki.net>
# Contributor: Tim Besard <tim.besard@gmail.com>
pkgname=unison-old
_pkgname=unison
pkgver=2.27.57
_pkgver=2.2
pkgrel=2
pkgdesc="File-synchronization tool (legacy 2.2x version)"
arch=(i686 x86_64)
license=('GPL2')
url="http://www.cis.upenn.edu/~bcpierce/unison"
depends=()
optdepends=('gtk: for the GTK1 frontend'
            'gtk2: for the GTK2 frontend')
makedepends=('ocaml' 'lablgtk' 'lablgtk2' 'imagemagick')
source=(http://www.cis.upenn.edu/~bcpierce/unison/download/releases/$_pkgname-$pkgver/$_pkgname-$pkgver.tar.gz
  unison-ssh-ocaml.patch)
md5sums=('4ba0a3e4bf4b4ad0c063f86391371f78'
         '81a28349471434c75a4206d07ad21eb1')
options=(!makeflags)
install=unison.install

build() {
  cd $srcdir/$_pkgname-$pkgver
  CFLAGS=""

  patch -Np1 -i ../unison-ssh-ocaml.patch

  make clean
  make UISTYLE=text DEBUGGING=false THREADS=true
  install -Dm755 unison $pkgdir/usr/bin/unison-$_pkgver

  make clean
  make UISTYLE=gtk DEBUGGING=false THREADS=true
  install -Dm755 unison $pkgdir/usr/bin/unison-gtk-$_pkgver

  make clean
  make UISTYLE=gtk2 DEBUGGING=false THREADS=true
  install -Dm755 unison $pkgdir/usr/bin/unison-gtk2-$_pkgver

  ln -s unison-gtk2-$_pkgver $pkgdir/usr/bin/unison-x11-$_pkgver
}
