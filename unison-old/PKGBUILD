#Maintainer: Tim Besard <tim.besard@gmail.com>

pkgname=unison-old
realname=unison
pkgver=2.27.57
pkgrel=1
pkgdesc="File-synchronization tool (legacy 2.2x version)"
arch=(i686 x86_64)
license=('GPL2')
url="http://www.cis.upenn.edu/~bcpierce/unison"
conflicts=('unison')
depends=('glibc')
makedepends=('ocaml' 'lablgtk' 'lablgtk2' 'imagemagick')
source=(http://www.cis.upenn.edu/~bcpierce/unison/download/releases/$realname-$pkgver/$realname-$pkgver.tar.gz \
        $realname.desktop)
options=(!makeflags)
install=unison.install

build() {
  cd $startdir/src/$realname-$pkgver
  CFLAGS=""
  make clean
  make UISTYLE=text DEBUGGING=false THREADS=true || return 1
  mkdir -p $startdir/pkg/usr/bin 
  install -Dm755 unison $startdir/pkg/usr/bin/unison
 # clean the builddir and rebuild with gtk support
  make clean
  make UISTYLE=gtk DEBUGGING=false THREADS=true || return 1
  install -Dm755 unison $startdir/pkg/usr/bin/unison-gtk
 # clean the builddir and rebuild with gtk2 support
  make clean
  make UISTYLE=gtk2 DEBUGGING=false THREADS=true || return 1
  install -Dm755 unison $startdir/pkg/usr/bin/unison-gtk2
 # install a .desktop file; create a compliant icon from ico file and install the png
  install -Dm644 ../$realname.desktop $startdir/pkg/usr/share/applications/$realname.desktop
  convert win32rc/U.ico unison.png
  install -Dm644 ${realname}-1.png  $startdir/pkg/usr/share/pixmaps/$realname.png
 # make symlink for .desktop file
  cd $startdir/pkg//usr/bin
  ln -s unison-gtk2 unison-x11
}
md5sums=('4ba0a3e4bf4b4ad0c063f86391371f78'
         '2daecba7705455a8e4b769e48b059872')
