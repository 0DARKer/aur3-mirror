# Maintainer: Tetsumaki <http://goo.gl/YMBdA>

pkgname=ultracopier
pkgver=1.0.0.2
pkgrel=1
pkgdesc="Advanced file copying tool, new version with qt5"
arch=('i686' 'x86_64')
url="http://ultracopier.first-world.info/"
license=('GPL3')
depends=('qt5-base')
makedepends=('qt5-base' 'qt5-tools' 'qt5-qtsystems-git')
conflicts=('ultracopier3')
source=("http://ompldr.org/vaTFkcA/${pkgname}-src-${pkgver}.tar.xz")
sha1sums=('376df37a609582ba5a1acb3a020cfb5301dc8f49')

build() {
	cd "${srcdir}/ultracopier-src"

	find -name "Variable.h" -exec sed -i "s/#define ULTRACOPIER_VERSION_PORTABLE/\/\/#define ULTRACOPIER_VERSION_PORTABLE/g" {} \;
	find -name "Variable.h" -exec sed -i "s/#define ULTRACOPIER_DEBUG/\/\/#define ULTRACOPIER_DEBUG/g" {} \;
	find -name "Variable.h" -exec sed -i "s/#define ULTRACOPIER_PLUGIN_DEBUG_WINDOW/\/\/#define ULTRACOPIER_PLUGIN_DEBUG_WINDOW/g" {} \;

	case ${CARCH} in
		i686)
			find -name "informations.xml" -exec sed -i -r "s/<architecture>.*<\/architecture>/<architecture>linux-x86-pc<\/architecture>/g" {} \;
			;;
		x86_64)
			find -name "informations.xml" -exec sed -i -r "s/<architecture>.*<\/architecture>/<architecture>linux-x86_64-pc<\/architecture>/g" {} \;
			;;
	esac

	qmake "ultracopier-core.pro"
	lrelease -nounfinished -compress -removeidentical -silent "ultracopier.pro"
	make

	cd "plugins/CopyEngine/Ultracopier"
	qmake "CopyEngine.pro"
	lrelease -nounfinished -compress -removeidentical -silent "CopyEngine.pro"
	make

	cd "${srcdir}/ultracopier-src/plugins/Listener/catchcopy-v0002"
	qmake "listener.pro"
	lrelease -nounfinished -compress -removeidentical -silent "listener.pro"
	make

	cd "${srcdir}/ultracopier-src/plugins/SessionLoader/KDE4"
	qmake "sessionLoader.pro"
	lrelease -nounfinished -compress -removeidentical -silent "sessionLoader.pro"
	make

	cd "${srcdir}/ultracopier-src/plugins/Themes/Oxygen"
	qmake "interface.pro"
	lrelease -nounfinished -compress -removeidentical -silent "interface.pro"
	make

	cd "${srcdir}/ultracopier-src"
	find -iname "*.ts" -exec rm {} \;
}

package(){
	cd "${srcdir}/ultracopier-src"

	install -Dm644 "resources/ultracopier.desktop" "${pkgdir}/usr/share/applications/ultracopier.desktop"
	install -Dm644 "resources/ultracopier-128x128.png" "${pkgdir}/usr/share/pixmaps/ultracopier.png"
	install -Dm755 "ultracopier" "${pkgdir}/usr/bin/ultracopier"

	install -Dm644 "plugins/CopyEngine/Ultracopier/informations.xml" "${pkgdir}/usr/share/ultracopier/CopyEngine/Ultracopier/informations.xml"
	install -Dm755 "plugins/CopyEngine/Ultracopier/libcopyEngine.so" "${pkgdir}/usr/share/ultracopier/CopyEngine/Ultracopier/libcopyEngine.so"

	install -Dm644 "plugins/Listener/catchcopy-v0002/informations.xml" "${pkgdir}/usr/share/ultracopier/Listener/catchcopy-v0002/informations.xml"
	install -Dm755 "plugins/Listener/catchcopy-v0002/liblistener.so" "${pkgdir}/usr/share/ultracopier/Listener/catchcopy-v0002/liblistener.so"

	install -Dm644 "plugins/SessionLoader/KDE4/informations.xml" "${pkgdir}/usr/share/ultracopier/SessionLoader/KDE4/informations.xml"
	install -Dm755 "plugins/SessionLoader/KDE4/libsessionLoader.so" "${pkgdir}/usr/share/ultracopier/SessionLoader/KDE4/libsessionLoader.so"

	install -Dm644 "plugins/Themes/Oxygen/informations.xml" "${pkgdir}/usr/share/ultracopier/Themes/Oxygen/informations.xml"
	install -Dm755 "plugins/Themes/Oxygen/libinterface.so" "${pkgdir}/usr/share/ultracopier/Themes/Oxygen/libinterface.so"

	for Z in ar de el es fr hi id it ja ko nl no pl pt ru th tr zh; do
		install -Dm644 "plugins/Languages/${Z}/flag.png" "${pkgdir}/usr/share/ultracopier/Languages/${Z}/flag.png"
		install -Dm644 "plugins/Languages/${Z}/informations.xml" "${pkgdir}/usr/share/ultracopier/Languages/${Z}/informations.xml"
		install -Dm644 "plugins/Languages/${Z}/translation.qm" "${pkgdir}/usr/share/ultracopier/Languages/${Z}/translation.qm"
		install -Dm644 "plugins/CopyEngine/Ultracopier/Languages/${Z}/translation.qm" "${pkgdir}/usr/share/ultracopier/CopyEngine/Ultracopier/Languages/${Z}/translation.qm"
		install -Dm644 "plugins/Themes/Oxygen/Languages/${Z}/translation.qm" "${pkgdir}/usr/share/ultracopier/Themes/Oxygen/Languages/${Z}/translation.qm"
	done
}