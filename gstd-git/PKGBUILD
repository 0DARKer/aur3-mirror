# Maintainer: Da_Coynul xtragb[at]gmail[dot]com>

pkgname=gstd-git
pkgver=20111124
pkgrel=3
pkgdesc="GStreamer Daemon (gstd) is a GStreamer framework for controlling audio and video streaming using D-Bus messages"
url="https://github.com/RidgeRun/gstd/wiki"
depends=(
    'dbus' 'dbus-core' 'dbus-glib' 'readline' 'gstreamer0.10' 'gstreamer0.10-base' 'gstreamer0.10-base-plugins')
makedepends=('autoconf' 'automake' 'git' 'libtool' 'pkgconfig')
optdepends=(
    'vala: if you plan to modify the source code'
)
install='gstd.install'
backup=(etc/conf.d/gstd)
source=('gstd.conf' 'gstd.rc')
md5sums=('3fd66720c78cc46b69d6bd5866e3cc2e'
         '8143ed7629aadca752c9a9a81e653e35')
license=('GPL2')
arch=('i686' 'x86_64')
provides=('gstd')

_gitroot="git://github.com/RidgeRun/gstd.git"
_gitname="gstd"

build() {
    cd $srcdir

    msg "Connecting to Git server..."

    if [ -d $srcdir/$_gitname ] ; then
        cd $_gitname && git pull origin
        msg "The local files are updated."
    else
        git clone $_gitroot
    fi

    msg "Git checkout done or server timeout."
    msg "Starting make..."

    # Copy Latest files to Build Directory
    cp -r $srcdir/$_gitname $srcdir/$_gitname-build
    cd $srcdir/$_gitname-build

    # Configure Source
    ./configure \
        --prefix=/usr \
        --sysconfdir=/etc

    # Build Source
    make || return 1

    install -Dm755 $srcdir/gstd.rc $pkgdir/etc/rc.d/gstd
    install -Dm644 $srcdir/gstd.conf $pkgdir/etc/conf.d/gstd
}

package() {
    cd $srcdir/$_gitname-build

    # Install Source
    make DESTDIR=$pkgdir install

    # Remove Build Directory
    rm -r $srcdir/$_gitname-build/

    install -Dm755 $srcdir/gstd.rc $pkgdir/etc/rc.d/gstd
    install -Dm644 $srcdir/gstd.conf $pkgdir/etc/conf.d/gstd 
}
