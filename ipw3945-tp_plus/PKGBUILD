# Maintainer: Michael Klimczak <comm@schattensaiten.net>
# This PKGBUILD is based upon the ipw3945-suspend2 package,
# which was contributed by Giovanni Scafora.

_kernver=2.6.23-tp_plus
pkgname=ipw3945-tp_plus
pkgver=1.2.2
pkgrel=1
pkgdesc="Intel PRO/Wireless 3945ABG driver for tp_plus kernel"
arch=(i686 x86_64)
url="http://ipw3945.sourceforge.net"
license=("GPL2")
depends=('wireless_tools' 'kernel26tp_plus' 'ipw3945-ucode' 'ipw3945d')
install=ipw3945-tp_plus.install
source=(http://heanet.dl.sourceforge.net/sourceforge/ipw3945/ipw3945-$pkgver.tgz)
md5sums=('9e5ca2f3ffbb84270ede45d5572df4c9')


build() {
  cd $startdir/src/ipw3945-$pkgver
  sed -i -e "s:^#\(CONFIG_IPW3945_QOS\)=.*:\1=y:" \
           -e "s:^# \(CONFIG_IPW3945_MONITOR\)=.*:\1=y:" \
           -e "s:^# \(CONFIG_IEEE80211_RADIOTAP\)=.*:\1=y:" \
           -e "s:^# \(CONFIG_IPW3945_PROMISCUOUS\)=.*:\1=y:" \
           Makefile
  make  KVER=${_kernver}
  #Install kernel module
  install -D -m 644 ipw3945.ko  $startdir/pkg/lib/modules/${_kernver}/kernel/drivers/net/wireless/ipw3945/ipw3945.ko
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install
}

