# Contributor: Piotr Beling <qwak@stud.ics.p.lodz.pl>
# based on krystaldrop-0.7.2.ebuild (gentoo)

pkgname=krystaldrop
pkgver=0.7.2
pkgrel=1
pkgdesc="Free clone of an excellent NeoGeo puzzle game, Magical Drop"
arch=("i686" "x86_64")
license=(GPL)
url="http://krystaldrop.sourceforge.net/"
depends=('sdl>=1.2.5' sdl_image 'sdl_mixer>=1.2.3'
	 'sdl_ttf>=1.2.5' 'libxml2>=2.5.7' zlib)
source=(http://switch.dl.sourceforge.net/sourceforge/krystaldrop/src_${pkgver}.tgz
	http://switch.dl.sourceforge.net/sourceforge/krystaldrop/art_${pkgver}.tgz
	krystaldrop-assert.patch
	krystaldrop-${pkgver}-gcc41.patch
	krystaldrop-${pkgver}-deps.patch
	krystaldrop.desktop)
md5sums=('68af5fccb41bb22bb583da8139dd3bc0'
         '2a0a8049fc5525f1c2cd8ed6656572c4'
	 'e357d37949c20a3547715fa8eb3d6105'
	 '53a26432544a07c94b0855d70e315fef'
	 '2f8888ebfa635ef9dd07d6e5c0ccd3ea'
	 '43be062d82a0c5049fc9bf8e0273f304')
					     	
backup=('etc/kdrop.xml')
	
build() {
    local D=$startdir/pkg
    local S=$startdir/src
    
    cd $S/${pkgname}		|| return 1
    mv $S/art .			|| return 1
    
    patch -p1 < "${S}/krystaldrop-assert.patch"	|| return 1
    patch -p1 < "${S}/krystaldrop-${pkgver}-gcc41.patch" || return 1
    patch -p1 < "${S}/krystaldrop-${pkgver}-deps.patch"	|| return 1
    
    sed -i \
	-e "/^EXEDIR:=/ s|games$|bin|" \
	-e "/^INSTALL_PREFIX:=/ s|$|${D}|" Makefile \
	    || return 1
	    
    make				|| return 1
    make DESTDIR="${D}" install		|| return 1
    
    install -D -m644 $S/krystaldrop.desktop \
                $D/usr/share/applications/krystaldrop.desktop

}

