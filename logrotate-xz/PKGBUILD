# $Id$
# Contributor: Balwinder S "bsd" Dheeman (bdheeman AT gmail.com)
# Credits: Aaron Griffin <aaron@archlinux.org>, Judd Vinet <jvinet@zeroflux.org>
# Maintainer: Balwinder S "bsd" Dheeman (bdheeman AT gmail.com)

pkgname=logrotate-xz
_realname=logrotate
pkgver=3.7.8
pkgrel=4
pkgdesc="Rotates system logs automatically"
url=http://cvs.fedora.redhat.com
arch=('i686' 'x86_64')
license=('GPL')
groups=('base')
depends=('cron' 'popt' 'sh' 'xz-utils')
optdepends=('logwatch: for reporting log analysis')
conflicts=(${_realname})
provides=(${_realname} ${_realname})
backup=('etc/logrotate.conf')
source=(http://archive.ubuntu.com/ubuntu/pool/main/l/logrotate/logrotate_$pkgver.orig.tar.gz
	http://anu.homelinux.net/pub/Linux/ports/distfiles/logrotate-xz.seq
	http://anu.homelinux.net/pub/Linux/ports/distfiles/logrotate-xz.tar.gz
	'etc_cron.daily_logrotate' 'etc_logrotate.conf')

build() {
    cd $srcdir/${_realname}-${pkgver}
    msg "Patching sources..."
    cat $srcdir/logrotate-xz.seq |while read p; do
	msg2 "Applying patch src/$p ..."
	patch -sp1 < $srcdir/$p
    done
    sed -i "s|CFLAGS = -Wall|CFLAGS = -Wall $CFLAGS|" Makefile
    sed -i 's|$(BASEDIR)/man|$(BASEDIR)/share/man|' Makefile

    msg "Running make; make install..."
    make || return 1
    make PREFIX=$pkgdir install

    msg "Making it nice..."
    install -Dm644 $srcdir/etc_logrotate.conf $pkgdir/etc/logrotate.conf
    install -Dm744 $srcdir/etc_cron.daily_logrotate $pkgdir/etc/cron.daily/logrotate
}

# vim:set ts=4 sw=4 et:
md5sums=('b3589bea6d8d5afc8a84134fddaae973'
         'e3efd13488421e95ebdaa6c1382f7747'
         '84ac11ce1cf2202ca45b4b648b920745'
         'd2281ecb6f898b446ac8a5984ab5a243'
         '7124c2ed09e186de19aa243e8768e485')
