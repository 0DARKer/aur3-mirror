# Maintainer: Mikael Eriksson <mikael_eriksson@miffe.org>
# Contributor: Thomas Dziedzic < gostrc at gmail >
# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Curtis Smith <kman922002@gmail.com>

pkgname=odamex
pkgver=0.5.6
pkgrel=2
pkgdesc='A free client/server multiplayer engine for the classic FPS Doom.'
arch=('i686' 'x86_64')
url='http://odamex.net/'
license=('GPL')
depends=('sdl_mixer>=1.2.6')
optdepends=('timidity++: Required for music')
source=("http://downloads.sourceforge.net/odamex/odamex-src-${pkgver}.tar.bz2"
        0001-Archlinux-timidity.cfg-path-fix.patch)
md5sums=('acc6aeac1ae9e4cd3504400a3a17178f'
         'edff0a056f17581ab532f267017ba967')

build() {
	cd odamex-src-${pkgver}
  
  patch -p1 -i "$srcdir/0001-Archlinux-timidity.cfg-path-fix.patch"

	sed 's|getenv("DOOMWADPATH")|"/usr/share/doom"|g' -i {client,server}/src/d_main.cpp

	make CFLAGS="${CXXFLAGS} -DUNIX -DLINUX -DNOASM -Icommon" odamex odasrv

  install -Dm755 odamex "$pkgdir/usr/bin/odamex"
  install -Dm755 odasrv "$pkgdir/usr/bin/odasrv"
  install -Dm644 odamex.wad "$pkgdir/usr/share/doom/odamex.wad"
  install -Dm644 media/icon_odamex_96.png "$pkgdir/usr/share/pixmaps/odamex.png"
  install -Dm644 media/icon_odasrv_96.png "$pkgdir/usr/share/pixmaps/odasrv.png"
  install -Dm644 installer/arch/odamex.desktop "$pkgdir/usr/share/applications/odamex.desktop"
  install -Dm644 installer/arch/odasrv.desktop "$pkgdir/usr/share/applications/odasrv.desktop"
}

# vim:set ts=2 sw=2 et:
