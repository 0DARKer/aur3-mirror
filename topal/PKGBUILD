# -*- shell-script -*-
#
# Contributor: Adrian C. (anrxc) <anrxc..sysphere.org>

pkgname=topal
pkgver=73
pkgrel=1
pkgdesc="Topal is a glue program that links GnuPG and Alpine"
arch=("i686" "x86_64")
url="http://homepage.ntlworld.com/phil.brooke/topal"
license=("GPL3")
makedepends=("gcc-ada" "make" "lynx")
optdepends=("alpine: for which topal was mainly written for"
            "gnupg: to encrypt, decrypt, sign and verify e-mail"
            "metamail: to display and process MIME messages"
            "mime-support: its run-mailcap tool as alternative to metamail"
            "openssh: for remote and server mode of operation")
install="${pkgname}.install"
source=("${url}/rel-${pkgver}/${pkgname}-package-${pkgver}.tgz")
md5sums=("ae5028dc71e2b1173cde0012e3271549")


build() {
  cd "${srcdir}/${pkgname}-${pkgver}"

# Remove PDF build crap
  sed -i 's/binary topal.pdf/binary/' Makefile

# Build Topal and MIME-tool
  make -j1 || return 1

# Install Topal binary, manual page and documentation
  install -D -m755 "${pkgname}" "${pkgdir}/usr/bin/${pkgname}" || return 1
  install -D -m644 "${pkgname}.man" "${pkgdir}/usr/share/man/man1/${pkgname}.1" || return 1
# Replaced by some PDF crap which we will not build
  #install -D -m644 README.txt "${pkgdir}/usr/share/doc/${pkgname}/README" || return 1

# Install Topal's version of MIME-tool and manual page
  install -D -m755 MIME-tool/mime-tool "${pkgdir}/usr/bin/mime-tool" || return 1
  install -D -m644 MIME-tool/mime-tool.man "${pkgdir}/usr/share/man/man1/mime-tool.1" || return 1
}
