# Maintainer: Marti Raudsepp <marti@juffo.org>
# Contributor: Lucas De Marchi <lucas.de.marchi@gmail.com>

pkgname=perf-util
pkgver=2.6.36rc8
_dist_pkgver=v${pkgver/rc/-rc}
pkgrel=2
pkgdesc="Performance monitoring tools using the Linux performance events infrastructure"
arch=(i686 x86_64)
license=('GPL')
url="http://www.kernel.org/"
depends=('elfutils' 'zlib' 'perl' 'python2')
# NB! This is detected build-time only
optdepends=(
  'libnewt: enable interactive console UI'
)
# necessary for building man pages -- 'perf help' relies on these
makedepends=('asciidoc' 'xmlto' 'libdwarf')
source=(http://www.politreco.com/files/$pkgname-$_dist_pkgver.tar.bz2)

build() {
  cd $srcdir/$pkgname-$_dist_pkgver/tools/perf

  export LDFLAGS="-L/usr/lib/perl5/core_perl/CORE"
  sed -i s/python-config/python2-config/ Makefile

  make prefix=/usr perfexecdir=lib/perf-core all man || return 1

  make prefix=/usr perfexecdir=lib/perf-core \
	  DESTDIR=$pkgdir/ install install-man || return 1

  install -dm 755 $pkgdir/usr/share/doc/$pkgname
  cp *.txt Documentation/*.txt $pkgdir/usr/share/doc/$pkgname
}
md5sums=('5a0d3ba65632545ea061c4b55c7132f9')
