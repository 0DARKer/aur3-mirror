# Maintainer: Bastian LÃ¶her <b.loeher@gsi.de>
pkgname=fairsoft
pkgver=dec14
pkgrel=1
pkgdesc="Software collection provided by GSI/FAIR for analysis."
arch=('x86_64')
url="http://fairroot.gsi.de"
license=('LGPL3')
groups=()
makedepends=('cmake'
	'clang'
	'bison'
	'flex'
	'gcc-fortran'
	'subversion'
	'git'
	'curl')
depends=(
	'libiodbc'
	'fcgi'
	'sqlite'
	'java-environment'
	'glu'
	'fftw'
	'cfitsio'
	'postgresql-libs'
	'python'
	'libjpeg-turbo'
	'graphviz'
	'libx11'
	'libxft'
	'libxext'
	'libxpm'
	'libxmu'
	)
provides=()
conflicts=()
replaces=()
backup=()
options=('!emptydirs' '!strip' 'staticlibs' 'libtool')
install='fairsoft.install'
changelog=
source=("https://github.com/FairRootGroup/FairSoft/archive/${pkgver}.tar.gz"
	'arch.conf'
	'fairsoft.install')
noextract=()
md5sums=('77e407f713c580c9ced5e525804cd098'
         '06566b9df18bc719a0255a80e7cd6059'
         '9e4ebe1631c116fe04ba29720a0802d2')

# Do not compress the package for installation
# PKGEXT='.pkg.tar'
# Compress using lightweight gzip
PKGEXT='.pkg.tar.gz'

prepare() {
	mv FairSoft-$pkgver FairSoft
	cd "FairSoft"

	# Disable vc for the root package (needed for gcc 4.9.2)
	echo "Disabling vc for package root"
	sed -i "s/--enable-vc/--disable-vc/" tools/rootconfig.sh
	
	# Enable optimizations for zeromq (needed from gcc 4.8)
	# to suppress warning about FORTIFY_SOURCE=2 needing optimization
	echo "Enabling optimizations for zeromq"
	sed -i '/\.\/configure.*$/a echo "Patching src/Makefile" \
		sed -i "s/-O0/-O2/" src/Makefile' \
		scripts/install_zeromq.sh
}

build() {
	:
}

package() {
	installdir=${pkgdir}/opt/fairsoft/current/src
	
	cd "FairSoft"

	mkdir -p ${installdir}

	# Install files
	cp -r ${srcdir}/* ${installdir}
}
