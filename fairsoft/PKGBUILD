# Maintainer: Bastian LÃ¶her <b.loeher@gsi.de>
pkgname=fairsoft
pkgver=dec14
pkgrel=1
pkgdesc="Software collection provided by GSI/FAIR for analysis."
arch=('x86_64')
url="http://fairroot.gsi.de"
license=('LGPL3')
groups=()
makedepends=('cmake'
	'clang'
	'bison'
	'flex'
	'gcc-fortran'
	'subversion'
	'git'
	'curl')
depends=(
	'libiodbc'
	'fcgi'
	'sqlite'
	'java-environment'
	'glu'
	'fftw'
	'cfitsio'
	'postgresql-libs'
	'python'
	'libjpeg-turbo'
	'graphviz'
	'libx11'
	'libxft'
	'libxext'
	'libxpm'
	'libxmu'
	)
provides=()
conflicts=()
replaces=()
backup=()
options=('!emptydirs' '!strip' 'staticlibs' 'libtool')
install='fairsoft.install'
changelog=
source=("https://github.com/FairRootGroup/FairSoft/archive/${pkgver}.tar.gz"
	'arch.conf'
	'fairsoft.install')
noextract=()
md5sums=('77e407f713c580c9ced5e525804cd098'
         'a3c15b12aed50be801340cf05a533f61'
         '0836028042a943a32fccd50f9ff88a05')

# Do not compress the package for installation
# PKGEXT='.pkg.tar'
# Compress using lightweight gzip
PKGEXT='.pkg.tar.gz'

prepare() {
	cd "FairSoft-$pkgver"
	# Disable vc for the root package (needed for gcc 4.9.2)
	echo "Disabling vc for package root"
	sed -i "s/--enable-vc/--disable-vc/" tools/rootconfig.sh
	# Enable optimizations for zeromq (needed from gcc 4.8)
	# to suppress warning about FORTIFY_SOURCE=2 needing optimization
	echo "Enabling optimizations for zeromq"
	sed -i '/\.\/configure.*$/a echo "Patching src/Makefile" && sed -i "s/-O0/-O2/" src/Makefile' scripts/install_zeromq.sh
}

build() {
	cd "FairSoft-$pkgver"
	./configure.sh ../arch.conf
}

package() {
	cd "fairsoft_install"

	installdir=${pkgdir}/opt/fairsoft/current
	mkdir -p ${installdir}

	cp -r bin ${installdir}
	cp -r include ${installdir}
	cp -r lib ${installdir}
	ln -s lib ${installdir}/lib64
	cp -r share ${installdir}
}
