# Contributor: Martin Corley <Martin.Corley@ed.ac.uk>

pkgname=opensesame
pkgver=2.8.3
pkgrel=2
pkgdesc="A graphical, open-source experiment builder for the social sciences, with ability to deploy on Android"
arch=(any)
url="http://www.cogsci.nl/software/opensesame"
license=(GPL)
makedepends='git'
# This is a fairly minimal set of dependencies
depends=('python2' 'python2-pygame' 'python2-numpy' 'python2-pyqt4'
'python2-qscintilla' 'python2-qprogedit' 'python2-imaging' 'python2-markdown' 'faenza-icon-theme')
optdepends=('psychopy: PsychoPy backend'
'python2-expyriment: Expyriment backend'
'python2-pyserial: Serial/Parallel port communication')

options=(!emptydirs)
#source=(http://files.cogsci.nl/software/opensesame/opensesame_${pkgver}-1.tar.g
#python2.patch)
source=("$pkgname-$pkgver"::'git://github.com/smathot/OpenSesame.git#tag=release/2.8.3'
python2.patch
render.patch)
md5sums=('SKIP'
         '6910d3fe92b98d5f27d0a412322de600'
         '5b19de6bcd511ae3898b31bbd4db96d3')

fix_links() {
  cd  "$pkgdir/usr/share/opensesame/resources/theme/gnome/os-custom-icons/"
  ln -s ../../default/os-custom-icons/16x16/ .
  ln -s ../../default/os-custom-icons/24x24/ .
  ln -s ../../default/os-custom-icons/32x32/ .	
}

build() {
  cd "${srcdir}"/${pkgname}-${pkgver}
  patch -Np1 -i ../python2.patch
  patch -Np1 -i ../render.patch
}
	 

package() {
  cd "$srcdir/$pkgname-$pkgver"
  python2 setup.py install --root="$pkgdir/" --optimize=1
  fix_links
}

