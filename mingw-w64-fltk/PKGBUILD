# Maintainer: Daniel Kirchner <daniel at ekpyron dot org>

pkgname=mingw-w64-fltk
pkgver=1.3.0
pkgrel=1
pkgdesc="A cross-platform C++ GUI toolkit. (mingw-w64)"
arch=('any')
license=('BSD')
depends=()
makedepends=('cmake' 'mingw-w64-gcc')
url=('http://fltk.org/')
source=("http://ftp.easysw.com/pub/fltk/1.3.0/fltk-1.3.0-source.tar.gz")
options=(!strip !buildflags)
sha1sums=('720f2804be6132ebae9909d4e74dedcc00b39d25')

_basename=fltk
_targetarch32=i686-w64-mingw32
_targetarch64=x86_64-w64-mingw32

build() 
{
	cd ${srcdir}

	# build 32-bit shared library
	rm -rf build
	mkdir build
	cd build

    echo "SET(CMAKE_SYSTEM_NAME Windows)" > win32.cmake
    echo "SET(CMAKE_C_COMPILER ${_targetarch32}-gcc)" >> win32.cmake
    echo "SET(CMAKE_CXX_COMPILER ${_targetarch32}-g++)" >> win32.cmake
    echo "SET(CMAKE_RC_COMPILER ${_targetarch32}-windres)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH /usr/${_targetarch32})" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)" >> win32.cmake	
	
	cmake ../${_basename}-${pkgver} \
		-DCMAKE_TOOLCHAIN_FILE=win32.cmake \
		-DCMAKE_INSTALL_PREFIX="/usr/${_targetarch32}" \
		-DOPTION_BUILD_EXAMPLES=NO -DTHREADS_PTHREAD_ARG=0
	make 
	make DESTDIR=$pkgdir install
	
	# build 64-bit shared
	cd ..
	rm -rf build
	mkdir build
	cd build	

    echo "SET(CMAKE_SYSTEM_NAME Windows)" > win32.cmake
    echo "SET(CMAKE_C_COMPILER ${_targetarch64}-gcc)" >> win32.cmake
    echo "SET(CMAKE_CXX_COMPILER ${_targetarch64}-g++)" >> win32.cmake
    echo "SET(CMAKE_RC_COMPILER ${_targetarch64}-windres)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH /usr/${_targetarch64})" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)" >> win32.cmake
    echo "SET(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)" >> win32.cmake	
	
	cmake ../${_basename}-${pkgver} \
		-DCMAKE_TOOLCHAIN_FILE=win32.cmake \
		-DCMAKE_INSTALL_PREFIX="/usr/${_targetarch64}" \
		-DOPTION_BUILD_EXAMPLES=NO -DTHREADS_PTHREAD_ARG=0
	make 
	make DESTDIR=$pkgdir install
}
