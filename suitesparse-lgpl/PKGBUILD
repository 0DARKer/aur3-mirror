# Contributor: Ilya Mezhirov <mezhirov@gmail.com>

pkgname=suitesparse-lgpl
pkgver=3.4.0
pkgrel=1
pkgdesc="A collection of sparse matrix libraries (LGPL-compatible only)"
url="http://www.cise.ufl.edu/research/sparse/SuiteSparse/"
arch=('i686' 'x86_64')
conflicts=('suitesparse' 'umfpack')
depends=()
makedepends=('gcc-fortran')
license=('LGPL')
source=(http://www.cise.ufl.edu/research/sparse/SuiteSparse/SuiteSparse-$pkgver.tar.gz UFconfig.patch Makefile.patch)
md5sums=('e59dcabc9173b1ba1b3659ae147006b8'
         'dcea18c628fe68a718e0c177fe76b275'
         'b0ba5d0b7dfc870bca8177bf58afde2b')

build() {
    cd "$srcdir/SuiteSparse"
    patch -p1 <"${srcdir}/UFconfig.patch" || return 1
    patch -p1 <"${srcdir}/Makefile.patch" || return 1
    make || return 1

    install -m 755 -d ${pkgdir}/usr/include/suitesparse || return 1
    install -m 755 -d ${pkgdir}/usr/lib || return 1


    for i in \
        AMD/Lib/libamd.a \
        BTF/Lib/libbtf.a \
        CAMD/Lib/libcamd.a \
        CCOLAMD/Lib/libccolamd.a \
        CHOLMOD/Lib/libcholmod.a \
        COLAMD/Lib/libcolamd.a \
        CSparse/Lib/libcsparse.a \
        CXSparse/Lib/libcxsparse.a \
        KLU/Lib/libklu.a \
        LDL/Lib/libldl.a
    do
        install -m644 $i "${pkgdir}/usr/lib/`basename $i`" || return 1
    done

    for i in \
        AMD/Include/*.h \
        BTF/Include/*.h \
        CAMD/Include/*.h \
        CCOLAMD/Include/*.h \
        CHOLMOD/Include/*.h \
        COLAMD/Include/*.h \
        CSparse/Include/*.h \
        CXSparse/Include/*.h \
        KLU/Include/*.h \
        LDL/Include/*.h \
        UFconfig/UFconfig.h
    do
        install -m644 $i "${pkgdir}/usr/include/suitesparse/`basename $i`" || return 1
    done
}
