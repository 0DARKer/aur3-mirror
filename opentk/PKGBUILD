pkgname=opentk
pkgver=2012.03.15
pkgrel=4
pkgdesc="An advanced, cross-platform, C-sharp OpenGL, OpenAL and OpenCL wrapper for Mono/.Net."
arch=(i686 x86_64)
license=("MIT")
depends=(mono)
makedepends=(mono dos2unix)
url="http://www.opentk.com"
conflicts=(opentk-svn)
source=("http://downloads.sourceforge.net/opentk/opentk-${pkgver//./-}.zip")
md5sums=('6d72ba716bd161e8975b463d29c2d219')

build() {
  cd "${srcdir}/opentk"
  find . -type f -exec dos2unix {} \;
  xbuild OpenTK.sln
}

package() {
  cd "${srcdir}/opentk/Binaries/OpenTK/Debug"
  find . -name '*.config' -o -name '*.mdb' -o -name '*.dll' -o -name '*.xml' |
    xargs -rtl1 -I {} install -Dm644 {} "$pkgdir/usr/lib/opentk/"{}
  cp -r Data "$pkgdir/usr/lib/opentk/"
  rm "$pkgdir/usr/lib/opentk/"{Bind,Convert}.exe.mdb
  rm "$pkgdir/usr/lib/opentk/Build.UpdateVersion.exe.mdb"
  install -m755 Examples.exe "$pkgdir/usr/lib/opentk/"
  install -Dm644 "$srcdir/opentk/Documentation/License.txt" "$pkgdir/usr/share/licenses/$pkgname/License.txt"
  find . -name '*.dll' | xargs -rtl1 -I {} gacutil -i {} -root "$pkgdir/usr/lib"
  find "$pkgdir/usr/lib/opentk/" -name '*.dll' -o -name '*.exe' | xargs -rtl1 mono --aot
}
