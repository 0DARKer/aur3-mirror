pkgname=opentk
epoch=1
pkgver=1.1_b4
pkgrel=4
arch=(any)
license=("MIT")
makedepends=(doxygen texlive-core ghostscript)
options=(!emptydirs)
url="http://www.opentk.com"
source=("https://github.com/opentk/opentk/archive/${pkgver//_/-}.tar.gz"
"opentk.pc.in"
"opentk.glcontrol.pc.in"
"opentk.compatibility.pc.in")
sha1sums=('467aee6641b2e17bfcd5a3ad414a7077d59f9e3e'
          '3582cb9e1b339ab7ee7ee5ca06a00c125bf37fce'
          '6d0318f77d2f8cbe4bee1b76de8df6df6a1da715'
          '7abcd193622390a16dcc771a7ac9a50e3a9cd4e2')

prepare() {
	cd "${srcdir}/opentk-${pkgver//_/-}/Source/Examples"
	sed -i "s,debug.log,/tmp/opentk_debug.log," ExampleBrowser.cs
	sed -i -e "s,debug.log,/tmp/opentk_debug.log,g" -e "s,trace.log,/tmp/opentk_trace.log,g" Main.cs
}

build() {
	cd "${srcdir}/opentk-${pkgver//_/-}/Source/Build.UpdateVersion"
	xbuild Build.UpdateVersion.csproj
	cd ../..
	xbuild OpenTK.sln
	cd Documentation
	doxygen
}

package() {
	pkgdesc="Open source game development toolkit for .Net/Mono."
	depends=(mono sdl2 openal)
	
	cd "${srcdir}/opentk-${pkgver//_/-}/Binaries/OpenTK/Debug"
	rm *.xml
	find . -type f -exec install -Dm644 {} "$pkgdir/usr/lib/opentk/"{} \;
	find "$pkgdir" -name 'OpenTK*.dll' -exec gacutil -i {} -root "$pkgdir/usr/lib" \;
	cd ../../../Documentation
	install -Dm644 "License.txt" "$pkgdir/usr/share/licenses/$pkgname/License.txt"
	install -Dm644 "$srcdir/opentk.pc.in" "$pkgdir/usr/lib/pkgconfig/opentk.pc"
	install -m644 "$srcdir/opentk.glcontrol.pc.in" "$pkgdir/usr/lib/pkgconfig/opentk.glcontrol.pc"
	install -m644 "$srcdir/opentk.compatibility.pc.in" "$pkgdir/usr/lib/pkgconfig/opentk.compatibility.pc"
	find "$pkgdir/usr/lib/pkgconfig" -type f -exec sed -i "s|@VERSION@|$pkgver|" {} \;
	
	cd Source
	find . -type f -exec install -Dm644 {} "$pkgdir/usr/share/doc/opentk/"{} \;
}

# package_opentk-docs() {
# 	pkgdesc="OpenTK API reference"
# 	
# 	cd "${srcdir}/opentk-${pkgver//_/-}/Documentation/Source"
# 	find . -type f -exec install -Dm644 {} "$pkgdir/usr/share/doc/opentk/"{} \;
# }
