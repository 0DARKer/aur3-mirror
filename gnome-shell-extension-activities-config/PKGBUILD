# Maintainer: XZS <d.f.fischer at web dot de>

pkgname="gnome-shell-extension-activities-config"
pkgdesc="Configure the Activities Button with the Activities Configurator Extension and the Gnome Shell Extension Preferences Tool."
pkgver=31
pkgrel=1
arch=(any)
url="https://extensions.gnome.org/extension/358/activities-configurator/"
license=(GPLv2)
depends=('gnome-shell>=3.8')
install=gschemas.install
source=("https://extensions.gnome.org/review/download/4354.shell-extension.zip"
        'archlinux-logo-gray-scalable.svg')
noextract=('4354.shell-extension.zip')
md5sums=('75ca0a43f39541b644e23190a7d3bf80'
         '69063bc3433d20d9de0f9dce2269186b')

prepare() {
  unzip ${noextract[0]}
}

build() {
  rm *.zip face-smile-3.svg
  chmod 644 metadata.json
  sed -i '/^const ICON_FILE =.*$/{
    s|face-smile-3.svg|archlinux-logo-gray-scalable.svg|;
    s|//.*|// Arch Linux Icon.|}' keys.js
  cp --remove-destination $(readlink archlinux-logo-gray-scalable.svg) archlinux-logo-gray-scalable.svg
  rm schemas/gschemas.compiled
}

package() {
  destdir="$pkgdir/usr/share/gnome-shell/extensions/activities-config@nls1729"
  schemadir="$pkgdir/usr/share/glib-2.0"
  install -d "$destdir" "$schemadir"
  mv schemas "$schemadir"
  mv * "$destdir"
}
