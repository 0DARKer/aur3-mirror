# Maintainer: Alastair Pharo  asppsa at gmail dot com

pkgname=pure-reduce-hg
pkgver=20130217
pkgrel=1
pkgdesc="Computer Algebra with Pure: A Reduce Interface"
arch=("i686" "x86_64")
license=('BSD' 'LGPL')
url="http://purelang.bitbucket.org/"
depends=('pure>=0.56')
makedepends=('gcc' 'make' 'mercurial' 'subversion')
source=()
md5sums=()

_pure_hgtrunk=https://bitbucket.org/purelang/pure-lang
_reduce_svntrunk=https://reduce-algebra.svn.sourceforge.net/svnroot/reduce-algebra/trunk/

build() {
  cd ${srcdir}

  msg "Connecting to Pure Mercurial server ..."
  if [ -d pure-lang ]; then
    (cd pure-lang && hg pull -u; cd $srcdir)
    msg "The local files are updated."
  else
    hg clone $_pure_hgtrunk pure-lang
  fi
  msg "Mercurial checkout done or server timeout"

  msg "Connecting to Reduce Subversion server.  This will take a while ..."
  if [ -d reduce-algebra ]; then
    (cd reduce-algebra && svn cleanup && svn update; cd $srcdir)
    msg "The local files are updated."
  else
    svn co $_reduce_svntrunk reduce-algebra
  fi
  msg "Subversion checkout done or server timeout"

  msg "Copying to build directory ..."
  rm -rf $srcdir/pure-reduce
  cp -r $srcdir/pure-lang/pure-reduce $srcdir/pure-reduce
  cp -r $srcdir/reduce-algebra $srcdir/pure-reduce/reduce-algebra
  cd pure-reduce

  msg "Starting build..."
  make -j1 || return 1
}

licensedir="$pkgdir/usr/share/licenses/pure-reduce-hg"

package() {
  cd "$srcdir/pure-reduce"
  make DESTDIR=$pkgdir install || return 1
  mkdir -p "$licensedir"
  cp "$srcdir/pure-reduce/COPYING" "$licensedir"
  cp "$srcdir/reduce-algebra/README" "$licensedir"
}

# vim:set ts=2 sw=2 et:
