diff -ur tigervnc.orig/unix/xserver/hw/vnc/xorg-version.h tigervnc/unix/xserver/hw/vnc/xorg-version.h
--- tigervnc.orig/unix/xserver/hw/vnc/xorg-version.h	2015-02-14 16:05:38.000000000 +0100
+++ tigervnc/unix/xserver/hw/vnc/xorg-version.h	2015-02-14 16:05:57.244898194 +0100
@@ -48,8 +48,10 @@
 #define XORG 115
 #elif XORG_VERSION_CURRENT < ((1 * 10000000) + (16 * 100000) + (99 * 1000))
 #define XORG 116
+#elif XORG_VERSION_CURRENT < ((1 * 10000000) + (17 * 100000) + (99 * 1000))
+#define XORG 117
 #else
-#error "X.Org newer than 1.16 is not supported"
+#error "X.Org newer than 1.17 is not supported"
 #endif
 
 #endif
diff -ur tigervnc.orig/unix/xserver/hw/vnc/xvnc.c tigervnc/unix/xserver/hw/vnc/xvnc.c
--- tigervnc.orig/unix/xserver/hw/vnc/xvnc.c	2015-02-14 16:05:38.000000000 +0100
+++ tigervnc/unix/xserver/hw/vnc/xvnc.c	2015-02-14 16:06:02.612898413 +0100
@@ -679,9 +679,9 @@
 	entries = pmap->pVisual->ColormapEntries;
 	pVisual = pmap->pVisual;
 
-	ppix = (Pixel *)xalloc(entries * sizeof(Pixel));
-	prgb = (xrgb *)xalloc(entries * sizeof(xrgb));
-	defs = (xColorItem *)xalloc(entries * sizeof(xColorItem));
+	ppix = (Pixel *)malloc(entries * sizeof(Pixel));
+	prgb = (xrgb *)malloc(entries * sizeof(xrgb));
+	defs = (xColorItem *)malloc(entries * sizeof(xColorItem));
 
 	for (i = 0; i < entries; i++)  ppix[i] = i;
 	/* XXX truecolor */
@@ -700,9 +700,9 @@
 	}
 	(*pmap->pScreen->StoreColors)(pmap, entries, defs);
 	
-	xfree(ppix);
-	xfree(prgb);
-	xfree(defs);
+	free(ppix);
+	free(prgb);
+	free(defs);
     }
 }
 
