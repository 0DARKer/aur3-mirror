# Maintainer: Manos S. Pappas <gmail.com: frontier314>

pkgname=openeuphoria
pkgver=4.1.0
pkgrel=1
pkgdesc="Fast interpreted or compiled general purpose programming language."
url="http://openeuphoria.org"
license=('custom:"OpenEuphoria License"')
conflicts=('euphoria')
arch=('i686' 'x86_64')
options=('staticlibs')

if [ "$CARCH" = "x86_64" ]; then
source=(http://sourceforge.net/projects/rapideuphoria/files/Euphoria/4.1.0/euphoria-${pkgver}-Linux-ix86-64.tar.gz/download)

md5sums=('dfc90304391f7c3a96d7b776380823e4')
fi

if [ "$CARCH" = "i686" ]; then
source=(http://sourceforge.net/projects/rapideuphoria/files/Euphoria/4.1.0/euphoria-${pkgver}-Linux-ix86.tar.gz/download)
md5sums=('6ebd8bb45e5281c391ee928b52999ade')
fi

build() {
  cd ${srcdir}/euphoria-$pkgver*/
}

package() {
  cd ${srcdir}/euphoria-${pkgver}*

  mkdir -p "${pkgdir}/usr/share/${pkgname}/"
  cp -r bin demo docs include source tests "${pkgdir}/usr/share/${pkgname}/"

  # Make an initial eu.cfg
if [ "$CARCH" = "x86_64" ]; then
  cat > eu.cfg <<EOF
[all]
-d E64
-eudir /usr/share/${pkgname}
-i /usr/share/${pkgname}/include
[translate]
-arch ix86_64
-gcc 
-con 
-com /usr/share/${pkgname}
-lib-pic /usr/share/${pkgname}/bin/euso.a
-lib /usr/share/${pkgname}/bin/eu.a
[bind]
-eub /usr/share/${pkgname}/bin/eub
EOF
fi

if [ "$CARCH" = "i686" ]; then
  cat > eu.cfg <<EOF
[all]
-d E32
-eudir /usr/share/${pkgname}
-i /usr/share/${pkgname}/include
[translate]
-arch ix86
-gcc 
-con 
-com /usr/share/${pkgname}
-lib-pic /usr/share/${pkgname}/bin/euso.a
-lib /usr/share/${pkgname}/bin/eu.a
[bind]
-eub /usr/share/${pkgname}/bin/eub
EOF
fi

  install -D -m644 eu.cfg "${pkgdir}/usr/share/${pkgname}/bin/eu.cfg"
  install -D -m644 License.txt "${pkgdir}/usr/share/licenses/${pkgname}/License.txt"
  
  echo "NOTE: Remember to add /usr/share/${pkgname}/bin/ to your PATH"
}

