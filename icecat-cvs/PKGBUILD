## Contributor: Jan Jezek <honzin.jezek@gmail.com>

pkgname=icecat-cvs
pkgver=20080628
pkgrel=2
pkgdesc="GNU version of the Mozilla Firefox browser"
arch=('i686')
url="http://www.gnu.org/software/gnuzilla/"
license=('GPL2' 'MPL' 'LGPL')
depends=('gtk2>=2.10.11' 'pango>=1.16.1' 'gcc' 'libxt' 'libidl2' \
	 'nss>=3.11.7' 'desktop-file-utils' 'cairo>=0.3.0')
makedepends=('cvs')
provide=('iceweasel-bin' 'iceweasel' 'firefox' 'mozilla-firefox' 'mozilla-firebird' \
	 'phoenix' 'swiftweasel' 'swiftfox')
conflicts=('iceweasel-bin')

## change download version in link:

source=(ftp://ftp.mozilla.org/pub/mozilla.org/firefox/releases/2.0.0.13/source/firefox-2.0.0.13-source.tar.bz2)
md5sums=('2c778aa46525e0f63efbedad0654ed47')

_cvsroot=":pserver:anonymous@cvs.sv.gnu.org:/sources/gnuzilla"
_cvsmod="gnuzilla"

######

build() {

  mkdir -p $startdir/pkg/usr
  cd $startdir/src

## Now we connect to CVS server

  msg "Connecting to $_cvsmod.sourceforge.net CVS server...."
  if [ -d $_cvsmod/CVS ]; then
    cd $_cvsmod
    cvs -z3 update -d
  else
    cvs -z3 -d $_cvsroot co -D $pkgver -f $_cvsmod
  fi

  msg "CVS checkout done or server timeout"
  
## we must overwrite files inside mozilla dir with gnuzilla files and run remove.nonfree script

  cp -r $startdir/src/$_cvsmod/* $startdir/src/mozilla
  cp -r $startdir/src/gnuzilla/.mozconfig $startdir/src/mozilla
  cd $startdir/src/mozilla
  ./remove.nonfree

######

## start build
  msg "Start building..."
  
  ./configure --prefix=/usr
  make || return 1
  make prefix=$startdir/pkg/usr install 

######

## desktop integration
  msg "Desktop integration..."
  
  mkdir -pv ${startdir}/pkg/usr/share/applications
  install -m644 ${startdir}/icecat.desktop \
		${startdir}/pkg/usr/share/applications

  mkdir -pv ${startdir}/pkg/usr/share/pixmaps
  install -m644 ${startdir}/pkg/usr/lib/icecat-2.0.0.13-g1/icons/default.xpm \
		${startdir}/pkg/usr/share/pixmaps/icecat.xpm
}
