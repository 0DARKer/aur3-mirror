pkgname=scuolabook
pkgver=3.1
pkgrel=1
pkgdesc="ScuolaBook reader for Linux"
arch=('i686' 'x86_64')
url="http://www.scuolabook.it/applicazioni"
license=('unknown')
depends=("alsa-lib>=1.0.23" "glibc>=2.14" "fontconfig>=2.8.0" "freetype2>=2.3.5" "gcc-libs>=4.1.1" "mesa-libgl" "glib2>=2.24.0" "gstreamer0.10>=0.10.33" "gstreamer0.10-base-plugins>=0.10.32" "gtk2>=2.24.0" "libice>=1.0.0" "pango>=1.14.0" "libpulse>=0.99.1" "libsm" "openssl>=1.0.0" "libstdc++5" "libx11" "libxcb" "libpng" "libxcomposite>=0.3" "libxi>=1.2.99.4" "libxml2>=2.7.4" "libxrender" "libxslt>=1.1.25" "zlib>=1.2.0" "orc" "libffi" "libdrm" "libxxf86vm" "libxfixes" "libxext" "libxdmcp" "libxdamage" "libxau" "gstreamer0.10-ugly-plugins" "gstreamer0.10-ffmpeg")
makedepends=('binutils' 'tar')
#source=(http://s3.amazonaws.com/scuolabook_support/"$pkgname"_"$pkgver"_amd64.deb http://s3.amazonaws.com/scuolabook_support/"$pkgname"_"$pkgver"_i386.deb)
if test "$CARCH" == x86_64; then
  source=(http://s3.amazonaws.com/scuolabook_support/"$pkgname"_"$pkgver"_amd64.deb)
  md5sums=('b6db6055f4abd09ce0f0546402f91e89')
fi
if test "$CARCH" == i686; then
  source=(http://s3.amazonaws.com/scuolabook_support/"$pkgname"_"$pkgver"_i386.deb)
  md5sums=('94a2864189a6e4039cfc66cf30a908da')
fi
noextract=("$pkgname"_"$pkgver"_amd64.deb "$pkgname"_"$pkgver"_i386.deb)

prepare() {
  cd $srcdir
  msg2 "Decompressing Debian package..."
  ar xv "$pkgname"_"$pkgver"_*.deb > /dev/null
  tar -xf data.tar.gz > /dev/null
  tar -xf control.tar.gz > /dev/null
  msg2 "Checking archive integrity..."
  md5sum -c md5sums > /dev/null
}

package() {
  cd $srcdir
  cp -R usr opt $pkgdir
  mkdir -p $pkgdir/usr/bin
  cd $pkgdir/usr/bin
  ln -s ../../opt/scuolabook/Scuolabook scuolabook
  find $pkgdir/opt -type d -exec chmod 755 {} \;
  chmod +x $pkgdir/opt/scuolabook/Scuolabook
}
