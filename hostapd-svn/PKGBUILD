_hostapdver=0.6.7
_hostapd=hostapd
pkgname=hostapd-svn
pkgver=3952
pkgrel=1
pkgdesc="daemon for wireless software access points"
arch=('i686' 'x86_64')
url="http://hostap.epitest.fi/hostapd/"
license=('custom')
depends=('openssl' 'madwifi-svn')
makedepends=('svn')
install=hostapd.install
source=(http://hostap.epitest.fi/releases/$_hostapd-$_hostapdver.tar.gz
	config.bz2
	hostapd
	hostapd.install)
md5sums=('0ce66cd5768235b5d2299f9efb9225d8'
         '4f213da55660b2a5cfbea5f4c6877b67'
         'cbc54751c16a53221f2c8ab7170aad78'
         'e58377211412b0bf10a33798633dd52f')

_svntrunk=http://svn.madwifi-project.org/madwifi/branches/madwifi-free
_svnmod=madwifi-free

build() {
	cd $srcdir
	if [ -d $_svnmod/.svn ]; then
		(cd $_svnmod && svn up) || return 1
	else
		svn co $_svntrunk -r $pkgver $_svnmod || return 1
	fi
	msg "SVN checkout done or server timeout"
	msg "Starting make..."

	cd $srcdir/$_hostapd-$_hostapdver/hostapd || return 1
	cp ../../config ./.config || return 1
	sed -i "s|/usr|$srcdir/$_svnmod|" .config || return 1
	sed -i "s|/usr/local/bin|$pkgdir/usr/bin|" Makefile || return 1
	mkdir -p $pkgdir/usr/bin $pkgdir/etc/hostapd \
	$pkgdir/usr/man/man1 $pkgdir/usr/man/man8 \
	$pkgdir/usr/share/licenses/$_hostapd $pkgdir/etc/rc.d || return 1
	make || return 1
	make DESTDIR=$pkg install || return 1
	cp ../src/hlr_auc_gw/hlr_auc_gw.milenage_db $pkgdir/etc/hostapd || return 1
	cp hostapd.accept $pkgdir/etc/hostapd || return 1
	cp hostapd.conf $pkgdir/etc/hostapd || return 1
	cp hostapd.deny $pkgdir/etc/hostapd || return 1
	cp hostapd.eap_user $pkgdir/etc/hostapd || return 1
	cp hostapd.radius_clients $pkgdir/etc/hostapd || return 1 
	cp hostapd.sim_db $pkgdir/etc/hostapd || return 1
	cp hostapd.vlan $pkgdir/etc/hostapd || return 1
	cp hostapd.wpa_psk $pkgdir/etc/hostapd || return 1
	# cp madwifi.conf $pkgdir/etc/hostapd || return 1
	cp wired.conf $pkgdir/etc/hostapd || return 1
	cp hostapd.8 $pkgdir/usr/man/man8 || return 1
	cp hostapd_cli.1 $pkgdir/usr/man/man1 || return 1
	cp ../COPYING $pkgdir/usr/share/licenses/hostapd || return 1
	cp ../../hostapd $pkgdir/etc/rc.d || return 1
}
