# Contributor: Daenyth <Daenyth+Arch AT gmail DOT com>
pkgname=dfhack
pkgver=0.5.15
pkgrel=1
pkgdesc="A cross-platform library for accessing Dwarf Fortress memory"
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/dfhack/"
license=('custom:zlib')
depends=(gcc-libs libx11)
makedepends=(cmake git gcc-multilib)
conflicts=(dfhack-git)
provides=(dfhack)
replaces=(dfhack)
source=()
md5sums=()

my_gitroot="git://github.com/peterix/dfhack.git"
my_gitname="dfhack"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $my_gitname ] ; then
    cd $my_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $my_gitroot $my_gitname
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$my_gitname-build"
  git clone "$srcdir/$my_gitname" "$srcdir/$my_gitname-build"
  cd "$srcdir/$my_gitname-build"
  git checkout -b "v${pkgver}" "${pkgver}"

  #
  # BUILD
  #

  cd build
  cmake .. \
    -DCMAKE_BUILD_TYPE:string=Release \
    -DCMAKE_INSTALL_PREFIX=$pkgdir/usr \
    -DMEMXML_DATA_PATH:path=/usr/share/dfhack || return 1
  make || return 1
  make install

  cd ..
  install -Dm644 LICENSE "$pkgdir/usr/share/licenses/dfhack/LICENCE"
}

# vim:set ts=2 sw=2 et:
