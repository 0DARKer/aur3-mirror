# Contributor: Prurigro
# Maintainer: Prurigro

pkgname=cjdnsify
pkgver=1
pkgrel=1
pkgdesc="A script that allows you to run programs bound exclusively to your cjdns connection"
url="https://github.com/cjdelisle/cjdns"
license="GPLv2"
depends=('cjdns-git')
makedepends=('gcc')
arch=('i686' 'x86_64')

source=('cjdnsify'
        'cjdnsify.conf'
        'http://www.ryde.net/code/bind.c.txt')
md5sums=('bfd2497cfdf696e46078c51008a01990'
         '82a75aa9dac5f584addc6b511006207b'
         'f998b0776f4fe9b2f5f039ba2681477c')

build() {
  pushd "$srcdir"
    ln -s bind.c.txt bind.c
    gcc -nostartfiles -fpic -shared bind.c -o bind.so -ldl -D_GNU_SOURCE
    install -d "$pkgdir"/usr/lib
    install -D -m755 bind.so "$pkgdir"/usr/lib/
    install -d "$pkgdir"/usr/bin
    install -D -m755 cjdnsify "$pkgdir"/usr/bin/
    install -d "$pkgdir"/etc
    install -D -m644 cjdnsify.conf "$pkgdir"/etc/
  popd
}
