# Maintainer: Gadget3000 <gadget3000 at msn dot com>
# Contributor: Otto Allmendinger <otto.allmendinger@gmail.com>

pkgname=crayonphysicsdeluxe
pkgver=55_3
pkgrel=3
pkgdesc="A 2D physics puzzle / sandbox game, in which your drawings are transformed into objects"
arch=('i686' 'x86_64')
url="http://www.crayonphysics.com/"
license=('custom')
groups=('humblebundle3' 'humblebundles')
if [ "$CARCH" = "x86_64" ]; then
	depends=('lib32-qt' 'lib32-sdl_image' 'lib32-sdl_mixer' 'lib32-glew1.5')
else
	depends=('qt' 'sdl_image' 'sdl_mixer' 'glew1.5')
fi
makedepends=("imagemagick")
install=("CrayonPhysicsDeluxe.install")
source=("CrayonPhysicsDeluxe.desktop" "crayon.sh")
md5sums=('77b35434d5d3d52f7f6071caf306f1d1'
         '600607a7c5dfeed25a894b9c31125859')

_archive="crayon_release${pkgver}.tar.gz"
_archive_md5="dc4127266c6f0e402b5f2ba380665502"

build() {
  cd $srcdir

  if [ ! -f ${_archive} ]; then
    echo "Please place ${_archive} into $(pwd)"
    echo Press Enter to continue
    read -a _unused
  fi

  if ! echo "${_archive_md5}  ${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_archive}"
    return 1
  fi

  install -d ${pkgdir}/opt/
  tar xzf ${_archive} -C ${pkgdir}/opt/
  rm -rf ${pkgdir}/opt/CrayonPhysicsDeluxe/lib32

  chmod +x ${pkgdir}/opt/CrayonPhysicsDeluxe/launcher
  install -d ${pkgdir}/usr/bin

  for i in 16x16 22x22 32x32 48x48 64x64 128x128; do
    mkdir -p ${pkgdir}/usr/share/icons/hicolor/${i}/apps
    convert -resize ${i} \
	${pkgdir}/opt/CrayonPhysicsDeluxe/icon.png \
	${pkgdir}/usr/share/icons/hicolor/${i}/apps/CrayonPhysicsDeluxe.png
  done
  
  install -Dm644 ${srcdir}/CrayonPhysicsDeluxe.desktop \
		 ${pkgdir}/usr/share/applications/CrayonPhysicsDeluxe.desktop

  install -D -m644 ${pkgdir}/opt/CrayonPhysicsDeluxe/LICENSE.txt \
	${pkgdir}/usr/share/licenses/${pkgname}/LICENSE

  install -Dm755 ${srcdir}/crayon.sh	${pkgdir}/usr/bin/crayon

  chown -Rh root:root ${pkgdir}/opt/CrayonPhysicsDeluxe
}
