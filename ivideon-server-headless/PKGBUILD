# Maintainer: Elovsky Valentin (evvsoft@gmail.com)
# Contributor: Shalygin Konstantin (kostya@opentech.ru)

pkgname='ivideon-server-headless'
pkgver='3.5.0.95'
pkgrel='0'
pkgdesc='Ivideon Video Server Headless'
arch=(i686 x86_64)
url=('http://ivideon.com/')
license=('freeware')
depends=('portaudio' 'gstreamer0.10' 'gstreamer0.10-base-plugins' 'gstreamer0.10-good-plugins')
conflicts=('ivideon-video-server' 'ivideon-video-server-nogui')
source=('videoserverd.service' 'videoserverd.config')
sha256sums=('5f14f1fd02aaedd33714e93113f3a65c8f3c927bd0a6b3efe8627b87eeb824a0' '5c61a4769b3837b960a0b053c6bbe950072762192fe86b4f8eefdeb03938b2f0')

if [[ "$CARCH" == 'i686' ]]; then
  source+=('http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-server-headless/ivideon-server-headles_3.5.0-95~10317fab6461_i386.deb')
  sha256sums+=('d963bf75bf711de37e99c76876d710b4486196978a2860977a6f84525a118e14')
fi

if [[ "$CARCH" == 'x86_64' ]]; then
  source+=('http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-server-headless/ivideon-server-headless_3.5.0-95~10317fab6461_amd64.deb')
  sha256sums+=('3ee127c0698721ae36e8e6a82904ab5fc7440b640cfb09a5d7335d54ad9c1c3f')
fi

build() {
  cd "$srcdir"
  bsdtar xf "$srcdir/data.tar.gz"
  mkdir -p "$srcdir/usr/lib/systemd/system"
  mkdir -p "$srcdir/root/.IvideonServer"
  cp "videoserverd.service" "$srcdir/usr/lib/systemd/system"
  cp "videoserverd.config" "$srcdir/root/.IvideonServer"
  rm "$srcdir/opt/ivideon/ivideon-server/init_ctl.sh"
  rm "$srcdir/opt/ivideon/ivideon-server/initd.sh"
  rm "$srcdir/opt/ivideon/ivideon-server/serverctl.sh"
  rm -r "$srcdir/etc"
}

package() {
  cp -dpr --no-preserve=ownership "$srcdir/opt" "$pkgdir"
  cp -dpr --no-preserve=ownership "$srcdir/usr" "$pkgdir"
  cp -dpr --no-preserve=ownership "$srcdir/root" "$pkgdir"
}
