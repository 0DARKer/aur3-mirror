# Maintainer: Elovsky Valentin (evvsoft@gmail.com)
# Contributor: Shalygin Konstantin (kostya@opentech.ru)

pkgname=ivideon-server-headless
pkgver=3.4.6.30
pkgrel=0
pkgdesc="Ivideon Video Server Headless"
arch=(i686 x86_64)
url="http://ivideon.com/"
license=('freeware')
depends=("portaudio" "gstreamer0.10" "gstreamer0.10-base-plugins" "gstreamer0.10-good-plugins")
conflicts=('ivideon-video-server' 'ivideon-video-server-nogui')
source=('videoserverd.service' 'videoserverd.config')
md5sums=('34600c5204956f089147ea5bac6a04ed' '43b3ffe9d143f555743f9f2f5edd2b7a')

if [[ "$CARCH" == "i686" ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-server-headless/ivideon-server-headless_3.4.6-30%7e8af4d94f033a_i386.deb")
  md5sums+=('0127becf38ba86c6d1f2da5b64f382bb')
fi

if [[ "$CARCH" == "x86_64" ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/ivideon-server-headless/ivideon-server-headless_3.4.6-30%7e8af4d94f033a_amd64.deb")
  md5sums+=('e83bee611c959b3d8bf46642579f6d20')
fi

build() {
  cd "$srcdir"
  bsdtar xf "$srcdir/data.tar.gz"
  mkdir -p "$srcdir/usr/lib/systemd/system"
  mkdir -p "$srcdir/root/.IvideonServer"
  cp "videoserverd.service" "$srcdir/usr/lib/systemd/system"
  cp "videoserverd.config" "$srcdir/root/.IvideonServer"
  rm "$srcdir/opt/ivideon/ivideon-server/init_ctl.sh"
  rm "$srcdir/opt/ivideon/ivideon-server/initd.sh"
  rm "$srcdir/opt/ivideon/ivideon-server/serverctl.sh"
  rm -r "$srcdir/etc"
}

package() {
  cp -dpr --no-preserve=ownership "$srcdir/opt" "$pkgdir"
  cp -dpr --no-preserve=ownership "$srcdir/usr" "$pkgdir"
  cp -dpr --no-preserve=ownership "$srcdir/root" "$pkgdir"
}
