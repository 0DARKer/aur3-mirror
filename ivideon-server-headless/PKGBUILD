# Maintainer: Elovsky Valentin (evvsoft@gmail.com)
# Contributor: Shalygin Konstantin (kostya@opentech.ru)

pkgname='ivideon-server-headless'
pkgver='3.5.2'
pkgrel='337'
pkgdesc='Ivideon-server daemon'
arch=('i686' 'x86_64')
url=('http://ivideon.com/')
license=('freeware')
depends=('portaudio' 'gstreamer0.10' 'gstreamer0.10-base-plugins' 'gstreamer0.10-good-plugins')
conflicts=('ivideon-video-server-nogui')
source=('videoserverd.service' 'videoserverd.config')
sha256sums=('5f14f1fd02aaedd33714e93113f3a65c8f3c927bd0a6b3efe8627b87eeb824a0' 'fa21a6aa4411ecaf0d98d9299a3d8289c7b04e994320ae2a0a63ece735cf81ad')
backup=('root/.IvideonServer/videoserverd.config')
rel='9740db6b144d'

if [[ "$CARCH" == 'i686' ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/${pkgname}/${pkgname}_${pkgver}-${pkgrel}~${rel}_i386.deb")
  sha256sums+=('776836e9928c1f0000a9ff808bc2be43963f73ec69e2704419bfb1554d50842e')
fi

if [[ "$CARCH" == 'x86_64' ]]; then
  source+=("http://packages.ivideon.com/ubuntu/pool/non-free/i/${pkgname}/${pkgname}_${pkgver}-${pkgrel}~${rel}_amd64.deb")
  sha256sums+=('0d5f8e6e8a912880d9afdeedf20c709a47fb45878f3858a7ed3056a5f3cdf61e')
fi

build() {
	cd "$srcdir"
	bsdtar xf "$srcdir/data.tar.gz"
	rm "$srcdir/opt/ivideon/ivideon-server/init_ctl.sh"
	rm "$srcdir/opt/ivideon/ivideon-server/initd.sh"
	rm "$srcdir/opt/ivideon/ivideon-server/serverctl.sh"
}

package() {
	cp -dpr --no-preserve=ownership "$srcdir/opt" "$pkgdir"
	install -Dm 644 "$srcdir/videoserverd.service" "$pkgdir/usr/lib/systemd/system/videoserverd.service"
	install -Dm 644 "$srcdir/videoserverd.config" "$pkgdir/root/.IvideonServer/videoserverd.config"
}
