# Maintainer: Andre Bartke <dev@bartke.cc>

_gitroot="git://cmake.org/cmake.git"
_gitname="cmake"

pkgname=cmake-git
pkgver=20130417
pkgrel=1
pkgdesc="A cross-platform open-source make system"
arch=('i686' 'x86_64')
url="http://www.cmake.org/"
license=('custom')
depends=('curl' 'libarchive' 'shared-mime-info')
makedepends=('qt5-base' 'git')
optdepends=('qt5-base: cmake-gui')
provides=(cmake)
conflicts=(cmake)

build() {
  cd $srcdir

  if [ -d $_gitname ]; then
    msg2 "Updating git repository"
    (cd $_gitname && git pull origin)                                 
  else
    msg2 "Cloning git repository"
    git clone $_gitroot
  fi
  
  msg2 "Removing previous build tree"
  rm -rf $srcdir/${_gitname}-build
  msg2 "Creating fresh build tree"
  git clone $_gitname $_gitname-build
  cd $srcdir/${_gitname}-build

  msg2 "Starting make..."

  ./bootstrap --prefix=/usr \
    --mandir=/share/man \
    --docdir=/share/doc/cmake \
    --system-libs \
    --qt-gui

  make || return 1
}

package() {
  cd $srcdir/${_gitname}-build
  make DESTDIR=$pkgdir install

  install -Dm644 Docs/cmake-indent.vim $pkgdir/usr/share/vim/indent/cmake-indent.vim
  install -Dm644 Docs/cmake-syntax.vim $pkgdir/usr/share/vim/syntax/cmake-syntax.vim
  install -Dm644 Docs/cmake-mode.el $pkgdir/usr/share/emacs/site-lisp/cmake-mode.el
  install -Dm644 Copyright.txt $pkgdir/usr/share/licenses/$pkgname/Copyright.txt
}

# vim: set ts=2 sw=2 ft=sh noet:
