# Maintainer: hauptmech 
# Contriutors: figo.zhang
# 

pkgname=pcl-svn
_pkgname=pcl
pkgver=3797
pkgrel=1
pkgdesc="Point Cloud Library:a comprehensive open source library for n-D Point Clouds and 3D geometry processing"
arch=('any')
url='http://www.ros.org/wiki/pcl/'
license=('BSD')
conflicts=('pcl')
depends=('vtk' 'libflann')
optdepends=('cuda-toolkit')
makedepends=('cmake' 'eigen3' 'cminpack' 'boost')

_svntrunk="http://svn.pointclouds.org/pcl/trunk"
_svnmod="$_pkgname"

build() {

	cd $srcdir

	if [ -d $_svnmod/.svn ]; then
    	  (cd $_svnmod && svn up -r $pkgver)
  	else
    	  svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
 	fi

	msg "SVN checkout done or server timeout"
  	msg "Starting make..."


  	cd $srcdir/$_svnmod
        rm -rf build
	mkdir -p build || return 1
	cd build || return 1

	export CUDA_BIN_PATH=/opt/cuda-toolkit
	cmake .. \
		-DCMAKE_BUILD_TYPE=Release \
		-DANN_PREFIX=/usr           \
		-DCMINPACK_PREFIX=/usr \
 		-DBUILD_CUDA=ON \
		-DBUILD_global_tests=OFF \
		-DBUILD_simulation=OFF \
		-DBUILD_cuda_apps=OFF \
		-DBUILD_cuda_common=OFF \
		-DBUILD_cuda_features=OFF \
		-DBUILD_cuda_io=OFF \
		-DBUILD_cuda_sample_consensus=OFF \
		-DBUILD_cuda_segmentation=OFF \
		-DBUILD_cuda_features=OFF


	make || return 1

}

package() {
  cd $srcdir/$_svnmod/build
  make DESTDIR=$pkgdir install
}

