# Original Author: Henner Zeller <h.zeller at acm dot org>
# Maintainer: Drew DeVore <w.drew.devore at gmail dot com>

pkgname=gmrender-resurrect-git
pkgver=20130402
pkgrel=1
pkgdesc="Application to stream music from a UPnP server using gstreamer."
arch=('any')
url="https://github.com/hzeller/gmrender-resurrect"
license=('GPL2')
conflicts=('gmediarender')
depends=('gnome-icon-theme' 'gstreamer0.10-ffmpeg' 'gstreamer0.10-base-plugins' 'gstreamer0.10-good-plugins' 'gstreamer0.10-bad-plugins' 'gstreamer0.10-ugly-plugins')
makedepends=('git' 'autoconf' 'automake' 'libtool' 'libxml2' 'libupnp')
install='gmrender-resurrect.install'
source=('gmediarender.service'
	'gmediarender')
md5sums=('cff2c939ff9fbe0a3d378a0f73d3fecd'
	 'ad13cb236cb59696d0b0aafc20ecb2cf')

_gitroot=https://github.com/hzeller/gmrender-resurrect.git
_gitname=gmrender-resurrect


build() {
   cd $srcdir
   msg "Connecting to GIT server...."

   if [[ -d "$_gitname" ]]; then
     cd "$_gitname" && git pull
     msg "The local files are updated."
   else
     git clone $_gitroot $_gitname
   fi

   msg "GIT checkout done or server timeout"
   msg "Starting build..."

   mkdir -p "$pkgdir/usr/lib/systemd/system/"
   mkdir -p "$pkgdir/etc/conf.d/"

   rm -rf $srcdir/$_gitname-build
   cp -r $srcdir/$_gitname $srcdir/$_gitname-build
   cd $srcdir/$_gitname-build
   ./autogen.sh
   ./configure
   make

   install -v -m 644 -t "$pkgdir/usr/lib/systemd/system/" $srcdir/gmediarender.service
   install -v -m 644 -t "$pkgdir/etc/conf.d/" $srcdir/gmediarender
}

package() {
   cd $srcdir/$_gitname-build
   make DESTDIR="$pkgdir/" install
}
