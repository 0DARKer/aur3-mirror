# Original Author: Henner Zeller <h.zeller at acm dot org>
# Maintainer: Drew DeVore <w.drew.devore at gmail dot com>

pkgname=gmrender-resurrect-git
pkgver=20130402
pkgrel=1
pkgdesc="Application to stream music from a UPnP server using gstreamer."
arch=('any')
url="https://github.com/drewofdoom/gmrender-resurrect"
license=('GPL2')
conflicts=('gmediarender')
depends=('gnome-icon-theme' 'gst-libav' 'gst-plugins-base' 'gst-plugins-base-libs' 'gst-plugins-good' 'gst-plugins-bad' 'gst-plugins-ugly')
makedepends=('git' 'autoconf' 'automake' 'libtool' 'libxml2')
install='gmrender-resurrect.install'

_gitroot=https://github.com/drewofdoom/gmrender-resurrect.git
_gitname=gmrender-resurrect


build() {
   cd $srcdir
   msg "Connecting to GIT server...."

   if [[ -d "$_gitname" ]]; then
     cd "$_gitname" && git pull origin
     msg "The local files are updated."
   else
     git clone $_gitroot $_gitname
   fi

   msg "GIT checkout done or server timeout"
   msg "Starting build..."

   mkdir -p "$pkgdir/usr/lib/systemd/system/"
   mkdir -p "$pkgdir/etc/conf.d/"

   rm -rf $srcdir/$_gitname-build
   git clone $srcdir/$_gitname $srcdir/$_gitname-build
   cd $srcdir/$_gitname-build
   ./autogen.sh
   ./configure
   make

   install -v -m 644 -t "$pkgdir/usr/lib/systemd/system/" $srcdir/gmrender-resurrect/systemd/gmediarender.service
   install -v -m 644 -t "$pkgdir/etc/conf.d/" $srcdir/gmrender-resurrect/systemd/gmediarender
}

package() {
   cd $srcdir/$_gitname-build
   make DESTDIR="$pkgdir/" install
}
