# Contributor: Borislav Gerassimov (slimmer) <borislavba (at) gmail.com>

pkgname=qutim-plugin-kde-integration-svn
pkgver=31
pkgrel=1
pkgdesc="KDE integration for Qutim. SVN version"
arch=('i686' 'x86_64')
url="http://qutim.org"
license=('GPL')
depends=('qutim-svn' 'kdelibs>=4.2.0')
makedepends=('subversion' 'gcc' 'make' 'cmake' 'automoc4')

_svnmod=kde-integration
_svntrunk=http://qutim.org/svn/${_svnmod}

build() {
msg "Downloading from ${_svntrunk} ..."
  cd ${srcdir}
  if [ -d ${_svnmod}/.svn ]; then
    (cd ${_svnmod} && svn up -r ${pkgver})
  else
    svn co ${_svntrunk} --config-dir ./ -r ${pkgver} ${_svnmod}
  fi
  msg2 "SVN checkout done or server timeout"

msg "Creating temporary build directory..."
  rm -rf ${_svnmod}-build
  cp -r ${_svnmod}/trunk ${_svnmod}-build
  cd ${_svnmod}-build

msg "Building and installing..."  
  cmake . -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=Release || return 1
  make || return 1
  make DESTDIR=${pkgdir} install || return 1
  
  # Temporary fix for conflicting files
  rm -f ${pkgdir}/usr/share/icons/hicolor/64x64/apps/qutim.png

msg "Removing temporary files..."
  cd ${srcdir}
  rm -rf ${_svnmod}-build
}
