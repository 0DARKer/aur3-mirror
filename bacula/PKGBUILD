# Maintainers: Steven Haigh <netwiz@crc.id.au>
#              goll <adrian.goll+aur[at]gmail>

pkgname=bacula
pkgver=5.2.13
pkgrel=2
arch=(i686 x86_64)
pkgdesc='Bacula - common support files and libs (sqlite support)'
url="http://www.bacula.org"
license=('AGPL3')
depends=('bacula-common')
makedepends=('openssl' 'sqlite')
source=("http://downloads.sourceforge.net/sourceforge/bacula/bacula-${pkgver}.tar.gz")

sha1sums=('30b1eb2efb515138807163d046f675eaa29fad1c')

_instdir="$PWD/install"

build() {
    cd "${srcdir}/bacula-${pkgver}"

    ./configure                              \
    --enable-smartalloc                      \
    --prefix=/usr                            \
    --sbindir=/usr/bin                       \
    --sysconfdir=/etc/bacula                 \
    --with-sqlite3                           \
    --with-openssl                           \
    --with-scriptdir=/etc/bacula/scripts     \
    --with-working-dir=/opt/bacula/working   \
    --with-pid-dir=/run                      \
    --with-systemd=/usr/lib/systemd/system
    
    make DESTDIR="$_instdir" install
}

package() {
  
  install -D ${_instdir}/etc/bacula/scripts/create_sqlite3_database ${pkgdir}/etc/bacula/scripts/create_sqlite3_database
  install -D ${_instdir}/etc/bacula/scripts/drop_sqlite3_database ${pkgdir}/etc/bacula/scripts/drop_sqlite3_database
  install -D ${_instdir}/etc/bacula/scripts/drop_sqlite3_tables ${pkgdir}/etc/bacula/scripts/drop_sqlite3_tables
  install -D ${_instdir}/etc/bacula/scripts/grant_sqlite3_privileges ${pkgdir}/etc/bacula/scripts/grant_sqlite3_privileges
  install -D ${_instdir}/etc/bacula/scripts/make_sqlite3_tables ${pkgdir}/etc/bacula/scripts/make_sqlite3_tables
  install -D ${_instdir}/etc/bacula/scripts/update_sqlite3_tables ${pkgdir}/etc/bacula/scripts/update_sqlite3_tables
  install -D ${_instdir}/etc/bacula/scripts/create_bacula_database ${pkgdir}/etc/bacula/scripts/create_bacula_database
  install -D ${_instdir}/etc/bacula/scripts/delete_catalog_backup ${pkgdir}/etc/bacula/scripts/delete_catalog_backup
  install -D ${_instdir}/etc/bacula/scripts/drop_bacula_database ${pkgdir}/etc/bacula/scripts/drop_bacula_database
  install -D ${_instdir}/etc/bacula/scripts/drop_bacula_tables ${pkgdir}/etc/bacula/scripts/drop_bacula_tables
  install -D ${_instdir}/etc/bacula/scripts/grant_bacula_privileges ${pkgdir}/etc/bacula/scripts/grant_bacula_privileges
  install -D ${_instdir}/etc/bacula/scripts/make_bacula_tables ${pkgdir}/etc/bacula/scripts/make_bacula_tables
  install -D ${_instdir}/etc/bacula/scripts/make_catalog_backup.pl ${pkgdir}/etc/bacula/scripts/make_catalog_backup.pl
  install -D ${_instdir}/etc/bacula/scripts/update_bacula_tables ${pkgdir}/etc/bacula/scripts/update_bacula_tables
  install -D ${_instdir}/usr/lib/libbaccats-sqlite3-${pkgver}.so ${pkgdir}/usr/lib/libbaccats-sqlite3-${pkgver}.so
  install -D ${_instdir}/usr/lib/libbacsql-${pkgver}.so ${pkgdir}/usr/lib/libbacsql-${pkgver}.so
  install -D ${_instdir}/etc/bacula/scripts/create_sqlite3_database ${pkgdir}/etc/bacula/scripts/create_sqlite3_database
  install -D ${_instdir}/etc/bacula/scripts/drop_sqlite3_database ${pkgdir}/etc/bacula/scripts/drop_sqlite3_database
  install -D ${_instdir}/etc/bacula/scripts/drop_sqlite3_tables ${pkgdir}/etc/bacula/scripts/drop_sqlite3_tables
  install -D ${_instdir}/etc/bacula/scripts/grant_sqlite3_privileges ${pkgdir}/etc/bacula/scripts/grant_sqlite3_privileges
  install -D ${_instdir}/etc/bacula/scripts/make_sqlite3_tables ${pkgdir}/etc/bacula/scripts/make_sqlite3_tables
  install -D ${_instdir}/etc/bacula/scripts/update_sqlite3_tables ${pkgdir}/etc/bacula/scripts/update_sqlite3_tables
  install -D ${_instdir}/usr/bin/bsmtp ${pkgdir}/usr/bin/bsmtp
  install -D ${_instdir}/usr/share/man/man1/bsmtp.1.gz ${pkgdir}/usr/share/man/man1/bsmtp.1.gz
  rm -rf ${_instdir}

}
