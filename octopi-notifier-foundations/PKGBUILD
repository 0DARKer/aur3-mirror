# Maintainer: Jameson Pugh <imntreal@gmail.com>
# Contributor: Filip Brcic <brcha@gna.org>

pkgname=octopi-notifier-foundations
pkgver=0.4.2
pkgrel=1
pkgdesc="Notifier for Octopi"
arch=('i686' 'x86_64')
url="https://github.com/aarnt/octopi"
license=('GPL2')
install=$pkgname.install
makedepends=('automoc4')
depends=('octopi' 'libnotify' 'knotifications' 'qt5-base')
optdepends=('xfce4-notifyd: for notifications in XFCE')
conflicts=('octopi-notifier')
replaces=('octopi-notifier')
provides=('octopi-notifier')
source=("https://github.com/aarnt/octopi/archive/v${pkgver}.tar.gz"
        "kf5.patch"
        "kf5-1.patch")

build() {
  _cpucount=$(grep -c processor /proc/cpuinfo 2>/dev/null)
  _jc=$((${_cpucount:-1}))

  cd "$srcdir/octopi-$pkgver"
  patch -Np1 -i ${srcdir}/kf5-1.patch
   
  cd "$srcdir/octopi-$pkgver/notifier/octopi-notifier"
  qmake-qt5 octopi-notifier.pro
  make -j $jc
}

package() {
  cd "$srcdir/octopi-$pkgver"
 
   install -D -m755 notifier/bin/octopi-notifier ${pkgdir}/usr/bin/octopi-notifier
   install -D -m644 octopi-notifier.desktop ${pkgdir}/etc/xdg/autostart/octopi-notifier.desktop
}

# vim: set ts=2 sw=2 ft=sh noet:
md5sums=('0bd15311ab1c2ede1a0a76dea9c29b8d'
         'bd48e004f01137b67929b01954793aad'
         '107faeb422dd8989b358c57899ae74a2')
