# Maintainer: Alexander RÃ¸dseth <rodseth@gmail.com>
# Contributor: Sven-Hendrik Haase <sh@lutzhaase.com>
# Contributor: fana-m <geminin@gmx.net>
# Contributor: Andrzej Giniewicz <gginiu@gmail.com>
# Contributor: Manuel Gaul <inkaine@hotmail.com>
pkgname=gigi
pkgver=0.8.0
pkgrel=1
pkgdesc="Small, efficient and feature rich GUI for C++ and OpenGL"
url="http://gigi.sourceforge.net"
arch=('x86_64' 'i686')
license=('LGPL')
depends=('boost' 'mesa' 'libpng' 'libjpeg' 'libtiff' 'freetype2' 'ogre' 'sdl' 'ois' 'python')
makedepends=('subversion' 'cmake' 'setconf')
conflicts=('gigi-svn')

build() {
  cd "$srcdir"

  if [ -d gigi/.svn ]; then
    (cd gigi && svn up -r 1072)
  else
    svn co https://gigi.svn.sourceforge.net/svnroot/gigi/trunk/GG/ \
      --config-dir ./ -r 1072 gigi
  fi

  rm -rf gigi-build
  svn export gigi gigi-build
  cd gigi-build

  msg "SVN checkout done or server timeout"

  setconf cmake/GiGiOgre.pc.in prefix /usr
  setconf cmake/GiGi.pc.in prefix /usr
  setconf cmake/GiGiSDL.pc.in prefix /usr

  cmake \
    -D CMAKE_INSTALL_PREFIX="$pkgdir"/usr \
    -D BUILD_TUTORIALS=OFF \
    -D CPACK_GENERATOR=GiGiDevel \
    -D CMAKE_C_FLAGS_RELEASE="-DNDEBUG" \
    .

  cd doc
  doxygen
  cd ..

  make -j1
}

package() {
  cd "$srcdir/gigi-build"

  make install

  # For now:
  rm  "$pkgdir"/usr/doc/GG/dir_*.html
  #for f in "$pkgdir"/usr/doc/GG/dir_*.html; do
  #  sed -i "s:$srcdir:$pkgdir:" "$f";
  #done

  install -Dm 644 COPYING \
    "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}

# vim:set ts=2 sw=2 et:
