pkgname=rhythmbox-git
pkgver=20090605
pkgrel=1
pkgdesc="An iTunes-like music player/libary"
arch=(i686 x86_64)
url="http://www.rhythmbox.org"
depends=('gnome-media' 'pygtk' 'desktop-file-utils' \
	'gstreamer0.10-base-plugins' 'gstreamer0.10-ugly-plugins' \
	'gstreamer0.10-python' 'gstreamer0.10-good-plugins' \
	'musicbrainz' 'libnotify' 'brasero')
makedepends=('gnome-common>=2.26.0-2' 'gtk-doc' 'intltool>=0.40.0' 'pkgconfig' \
	'git' 'xulrunner>=1.9')
license=('GPL')
options=(!libtool !strip)
replaces=(rhythmbox rhythmbox-svn)
conflicts=(rhythmbox rhythmbox-svn)
provides=(rhythmbox)
source=()
md5sums=()
_gitname=rhythmbox
_gitroot=git://git.gnome.org/${_gitname}
install=rhythmbox-git.install
build() {
  cd $startdir/src
  msg "Connecting to gnome.org git server...."
  rm  -rf $startdir/src/$_gitname-build
  
  if [[ -d $_gitname ]]; then
   cd $_gitname || return 1
   git pull origin || return 1
    else
   git clone $_gitroot $_gitname || return 1
     fi
  msg " checkout done."
 
  cd $srcdir || return 1
  cp -r $_gitname $_gitname-build

  unset CFLAGS
  unset CXXFLAGS

   cd $_gitname-build || return 1
  ./autogen.sh
  ./autogen.sh
 ./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/lib/rhythmbox \
        --localstatedir=/var --disable-scrollkeeper --enable-libnotify \
	--disable-static --disable-fm-radio || return 1

  make || return 1
  make DESTDIR=${startdir}/pkg install || return 1

# remove plugins that are buggy or I don't need
 rm -rf $startdir/pkg/usr/lib/rhythmbox/plugins/upnp_coherence

## Install the schemas file
 mkdir -p ${startdir}/pkg/usr/share/gconf/schemas
 /usr/bin/gconf-merge-schema \
	${startdir}/pkg/usr/share/gconf/schemas/${pkgname}.schemas \
	${startdir}/pkg/etc/gconf/schemas/rhythmbox.schemas || return 1 

 rm -rf $startdir/pkg/etc/
  rm -rf ${srcdir}/$_gitname-build
}
