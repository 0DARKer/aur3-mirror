# Maintainer: fs4000 <matthias_dienstbier[at]yahoo[dot]de>
# Maintainer: trapanator <trap[at]trapanator[dot]com>
# Maintainer: tomprogrammer <Thomas-Bahn[at]gmx[dot]net>

pkgname=phc-intel
pkgver=0.3.2.12.2
_realver=pack-rev2
pkgrel=1
pkgdesc="frequency driver for Intel CPUs with undervolting feature"
url="http://www.linux-phc.org"
arch=('any')
license=('GPL')
provides=('linux-phc')
backup=(etc/conf.d/phc-intel)
install=phc-intel.install
source=(phc-intel-$_realver.tar.bz2::$url/forum/download/file.php?id=127
phc-intel.{conf,rc,sleep})
md5sums=('65dd21411aa7d3bdb40ff75c16cdf073'
         'bc8b26dc2966cc9210c5631aceee025a'
         'f651d35ed1e5ba5f327cfd2510a56e4c'
         '65f4702ccb5fa1e2f3bf9e5b5ac8ca83')

build() {
	cd phc-intel-$_realver
	sed -i 's,^\tinstall -m 644 -o root -g root phc-intel.modprobe,#\tinstall -m 644 -o root -g root phc-intel.modprobe,' Makefile
	sed -i 's,/sbin/modprobe phc-intel |,/sbin/modprobe phc-intel \&\& /etc/rc.d/phc-intel set |,' phc-intel.modprobe
}

package() {
	install -Dm644 phc-intel.conf "$pkgdir/etc/conf.d/phc-intel"
	install -Dm644 phc-intel-$_realver/phc-intel.modprobe "$pkgdir/etc/modprobe.d/phc-intel.conf"
	install -Dm755 phc-intel.rc "$pkgdir/etc/rc.d/phc-intel"
	install -Dm755 phc-intel.sleep "$pkgdir/usr/lib/pm-utils/sleep.d/00phc-intel"

	install -d "$pkgdir/usr/src/phc-intel"
	cp -R phc-intel-$_realver/{inc,Makefile} "$pkgdir/usr/src/phc-intel/"
}
