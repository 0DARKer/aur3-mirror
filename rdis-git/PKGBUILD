##This is a basic PKGBUILD for rdis to ease building RDIS in my Arch boxes
##Maintainer : TDKPS
##Implemented fixes by ackalker. Kudos to him.
pkgname=rdis-git
pkgrel=1
pkgver=20130119
pkgdesc="A great graphic binary analysis tool that's in-development and constantly being improved.
Check rdis-lua for some scripts that improve it's functionality. "
arch=(x86_64)
url="https://github.com/TDKPS/rdis"
license=('GPL3')
depends=(gtk3 luajit jansson udis86)
makedeps=(git)
optdepends=(lua51-socket)
_gitroot="https://github.com/TDKPS/rdis.git"
_gitname="rdis"


build() {
  cd "$srcdir"

  msg "Connecting to GIT server..."
  if [[ -d "${_gitname}" ]]; then
    (cd "${_gitname}" && git pull origin)
  else
    git clone "${_gitroot}" "${_gitname}"
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${_gitname}-build"
  git clone "${_gitname}" "${_gitname}-build"

  cd "${srcdir}/${_gitname}-build/"
  
  sed -i 's,/usr/bin,$(DESTDIR)&,g' Makefile

make
}

package() {
  cd "${srcdir}/${_gitname}-build"
  install -m 0755 -d "${pkgdir}"/usr/bin
  make DESTDIR="${pkgdir}" install

	install -d -m755 "${pkgdir}"/usr/share/rdis
	install -d -m755 "${pkgdir}"/usr/share/applications/rdis
	install "${srcdir}/${_gitname}-build"/src/share/* "${pkgdir}"/usr/share/rdis/
	install "${srcdir}/${_gitname}-build"/src/share/rdis-root.desktop "${pkgdir}"/usr/share/applications/rdis
}