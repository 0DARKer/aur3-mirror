# Maintainer: Mantas M. <grawity@gmail.com>
pkgname=sssd
pkgver=1.5.11
pkgrel=1
pkgdesc="System Security Services Daemon"
arch=('i686' 'x86_64')
url="https://fedorahosted.org/sssd/"
license=('GPL3')
depends=(
  'c-ares'
  'dbus-core'
	'ding-libs'
  'krb5'
	'ldb'
  'libldap'
  'libnl'
  'libsasl'
  'libunistring'
  'libxml2'
  'nspr'
  'pcre'
	'talloc'
	'tdb'
	'tevent'
)
makedepends=('doxygen')
source=("https://fedorahosted.org/released/$pkgname/$pkgname-$pkgver.tar.gz"
        'sssd.service')
sha1sums=('83ac2da45aa2a3e4a808356bdcfb5e0bdc56fe00'
          '10945fa294c5ace62f2dcc7db6091710b46d6ffe')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  ./configure \
    --prefix=/usr \
    --sysconfdir=/etc \
    --enable-pammoddir=/lib/security \
    --with-os=fedora \
    --with-pid-path=/run \
    --without-python-bindings \
    --without-selinux \
    --without-semanage \
    --with-initscript=systemd \
    --with-systemdunitdir=/lib/systemd/system
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  make DESTDIR="$pkgdir/" install
  rm -rf "$pkgdir/etc/rc.d"
  rm -f "$pkgdir/usr/modules/ldb/memberof.la"
  find "$pkgdir/usr/share/man" -depth -type d -exec rmdir --ignore-fail-on-non-empty {} \;
  # The included unit requires way too much sed'ing.
  install -Dm0644 "$srcdir/sssd.service" "$pkgdir/lib/systemd/system/sssd.service"
} 

# vim: ts=2:sw=2:et
