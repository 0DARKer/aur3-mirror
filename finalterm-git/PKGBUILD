
# Maintainer: kens <arch forums>
pkgname=finalterm-git
pkgver=67d874d
pkgrel=1
pkgdesc="A new breed of terminal emulator"
arch=('any')
url="https://github.com/p-e-w/finalterm"
license=('GPL3')
depends=('libgee' 'libtool' 'mx' 'gtk3' 'clutter' 'clutter-gtk' 'libkeybinder3')
makedepends=('vala' 'git')
provides=('finalterm')
conflicts=('finalterm')
source=('git://github.com/p-e-w/finalterm.git'
        'https://github.com/engla/keybinder/raw/master/examples/keybinder.vapi')
md5sums=('SKIP' 'SKIP')

pkgver() {
    cd finalterm
    git describe --always | sed 's#-#_#g;s#v##'
}

build() {
    cd ${srcdir}/finalterm
    sed 's/$(VALA_OPTIONS)/$(VALA_CONFIG) $(VALA_OPTIONS)/g' Makefile >Makefile_amended
    VALA_CONFIG="--vapidir='${srcdir}' --Xcc=-I/usr/include/keybinder-3.0 --Xcc=-I/usr/include/mx-2.0 --Xcc=-lmx-2.0" make -f Makefile_amended
}

package() {
    mkdir -p "$pkgdir/usr/bin"
    mkdir -p "$pkgdir/usr/share/finalterm"

    cp -R finalterm/{ColorSchemes,Icons,KeyBindings,Settings,Startup,Termlets,TextMenus,Themes} "$pkgdir/usr/share/finalterm"

    echo '
CMDDIR=/usr/share/finalterm

(cd $CMDDIR; ./finalterm $@)' >"$pkgdir/usr/bin/finalterm"

    chmod +x "$pkgdir/usr/bin/finalterm"

    cp finalterm/finalterm "$pkgdir/usr/share/finalterm"
}
