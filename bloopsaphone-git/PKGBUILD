pkgname=bloopsaphone-git
pkgver=20090828
pkgrel=2
pkgdesc="A small program and library  for writing chiptune-style
songs in C or Ruby."
arch=('i686' 'x86_64')
url="http://github.com/lloyd/bloopsaphone/tree/master"
depends=('portaudio' 'ruby')
makedepends=('ragel')
license=('custom')
_gitroot="git://github.com/lloyd/bloopsaphone.git"
_gitname="bloopsaphone"

build() {
 cd "$srcdir"
 msg "Connecting to the bloopsaphone git repository..."

 if [ -d "$srcdir/$_gitname" ] ; then
   cd $_gitname && git pull origin
   msg "The local files are updated."
 else
   git clone $_gitroot
 fi

 msg "GIT checkout done or server timeout"
 msg "Starting make..."

 cd "$srcdir"

 rm -rf $_gitname-build
 git clone $_gitname $_gitname-build
 cd $_gitname-build

 arch=$(arch)
 make || return 1
 make ruby || return 1
 install -D ext/ruby/bloops.so \
   "$pkgdir/usr/lib/ruby/site_ruby/1.8/$arch-linux/bloops.so" ||
return 1
 install -D ext/ruby/bloops.so \
   "$pkgdir/usr/lib/ruby/site_ruby/1.9.1/$arch-linux/bloops.so" ||
return 1
 install -D bloopsawhat "$pkgdir/usr/bin/bloopsawhat" || return 1
}

# vim:set ts=2 sw=2 et:
