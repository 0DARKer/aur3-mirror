# Maintainer: Philippe DUCRETTET <ecolinux@gmx.fr>

pkgname=fvwm-cvs
pkgver=20130502
pkgrel=1
pkgdesc="A powerful ICCCM2 compliant multiple virtual desktop window manager for X11"
arch=('i686' 'x86_64')
url="http://fvwm.org"
license=('GPL')
depends=('imlib' 'fribidi' 'perl' 'libstroke' 'libxpm' 'libxinerama' 'readline' 'libxft' 'librsvg' 'libxcursor' 'libpng')
makedepends=('cvs' 'gcc' 'make' 'autoconf' 'automake' 'libxslt')
provides=('fvwm-devel')
conflicts=('fvwm-devel')
replaces=('fvwm-devel')
options=('!emptydirs' '!makeflags')
cvsroot=":pserver:anonymous:guest@cvs.fvwm.org:/home/cvs/fvwm"
cvsmod="fvwm"
source=(fvwm.desktop )

build() {
#  sudo pacman -U  --asdeps http://arm.konnichi.com/2012/07/01/extra/os/x86_64/pyxdg-0.19-3-any.pkg.tar.xz
  cd $startdir/src
  msg "Connecting to fvwm.org CVS server....please enter 'guest'"
  cvs -d $cvsroot login
  msg "Checking out fvwm"
  cvs -d $cvsroot co -r branch-2_6 $cvsmod
  cd $startdir/src/fvwm
sed -i "s/AM_CONFIG_HEADER/AC_CONFIG_HEADER/g" configure.ac
sed -i "s/^INCLUDES/AM_CPPFLAGS/g" */Makefile.am
sed -i "s/^INCLUDES/AM_CPPFLAGS/g" */*/Makefile.am
sed -i "s/^INCLUDES/AM_CPPFLAGS/g" */*/*/Makefile.am
sed -i "s/^%.html : /*.html :/g" doc/commands/Makefile.am
  utils/configure_dev.sh
./configure --prefix=/usr --sysconfdir=/etc --libexecdir=/usr/lib \
    --with-stroke-library  \
    --enable-perllib \
    --enable-xinerama \
    --enable-bidi \
    --enable-nls --enable-iconv \
    --enable-xft
  make
}

package() {
  cd "$srcdir/fvwm"
  make DESTDIR="${pkgdir}" install
install -d "${pkgdir}/usr/share/doc/fvwm"
  install -D -m644 sample.fvwmrc/{decor_examples,DecorMwm,DecorWin95,new-features,system.*} "${pkgdir}/usr/share/doc/fvwm"
  install -D -m644 ../fvwm.desktop "${pkgdir}/usr/share/xsessions/fvwm.desktop"
  install -D -m644 COPYING "${pkgdir}/usr/share/licenses/fvwm/COPYING"
}

md5sums=('a12c52729a74355838404ee2f5716e0c')
