# Maintainer: Kazuki Przyborowski <kazukiprzyborowski[at]gmail[dot]com>
pkgname=python2-upcean
pkgver=2.3.7
pkgrel=1
pkgdesc="A barcode library/moudle for python2."
url="https://github.com/GameMaker2k/PyUPC-EAN/"
arch=('any' 'i686' 'x86_64')
license=('BSD')
depends=('python2' 'python2-imaging' 'readline')
makedepends=('curl')
conflicts=()
replaces=()
backup=()
install=''
_gitrevision='377d5fe65b116cd4078821f7e92a4bfc63781727'
source=("https://github.com/GameMaker2k/PyUPC-EAN/archive/${_gitrevision}.tar.gz")
md5sums=('3399107efe8217ee7e1853e5e10be142')
md5sums=('c0015ca971b52025d40116ce891433c3')
sha256sums=('bb369a335be61b05903cbbe29abf03eefac25579795de5eb58b41821054dc524')
sha384sums=('45a6e2d20c7c8b8d42a4fd276727ae0cdecf1e9ff32050a1d9b929baa1314d040a8e1a6de9b2dcefdfaa6e2cca2cf96b')
sha512sums=('2dfa475888d35abcffc1cad5e0d59e3392e472ff433615d1bf01d38856f2ceff6f186bc0bda777222e8a9c9f24556fe660a1eb7ca887c06cfb273a712a46cd9b')

build() {
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upctest-pil"
  find . -iname "*.py"  | xargs sed -i.bak -e '1s"^#!.\+$"#!/usr/bin/python2"'
  rm -rfv *.py.bak
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upctest-pil/upcean"
  find . -iname "*.py"  | xargs sed -i.bak -e '1s"^#!.\+$"#!/usr/bin/python2"'
  rm -rfv *.py.bak
}

package() {
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upctest-pil"
  test -z "$pkgdir/usr/share/licenses/python2-upcean" || /usr/bin/mkdir -p "$pkgdir/usr/share/licenses/python2-upcean"
  mkdir -p "$pkgdir/usr/share/icons/hicolor/32x32/apps"
  curl --user-agent "Mozilla/5.0 (X11; Linux i686;19.0) Gecko/20100101 Firefox/19.0" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/32x32/diagram-60.png" > "$pkgdir/usr/share/icons/hicolor/32x32/apps/upcean.png"
  mkdir -p "$pkgdir/usr/share/icons/hicolor/48x48/apps"
  curl --user-agent "Mozilla/5.0 (X11; Linux i686;19.0) Gecko/20100101 Firefox/19.0" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/48x48/diagram-60.png" > "$pkgdir/usr/share/icons/hicolor/48x48/apps/upcean.png"
  mkdir -p "$pkgdir/usr/share/icons/hicolor/64x64/apps"
  curl --user-agent "Mozilla/5.0 (X11; Linux i686;19.0) Gecko/20100101 Firefox/19.0" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/64x64/diagram-60.png" > "$pkgdir/usr/share/icons/hicolor/64x64/apps/upcean.png"
  mkdir -p "$pkgdir/usr/share/icons/hicolor/96x96/apps"
  curl --user-agent "Mozilla/5.0 (X11; Linux i686;19.0) Gecko/20100101 Firefox/19.0" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/96x96/diagram-60.png" > "$pkgdir/usr/share/icons/hicolor/96x96/apps/upcean.png"
  mkdir -p "$pkgdir/usr/share/applications"
  echo -e "[Desktop Entry]\nName=PyUPC GUI\nName[en_US]=PyUPC GUI\nComment=Create UPC/EAN barcodes and save as image.\nComment[en_US]=Create UPC/EAN barcodes and save as image.\nGenericName=Barcode Generator\nGenericName[en_US]=Barcode Generator\nExec=upc-ui-py2\nTryExec=upc-ui-py2\nTerminal=false\nType=Application\nIcon=/usr/share/icons/hicolor/64x64/apps/upcean.png\nCategories=Graphics;Graphics;2DGraphics;Graphics;RasterGraphics;\n" > "$pkgdir/usr/share/applications/upcean.desktop"
  mkdir -p "$pkgdir/usr/share/upcean"
  /usr/bin/install -c "./upc-ui.py" "$pkgdir/usr/share/upcean/upc-ui-py2.py"
  mkdir -p "$pkgdir/usr/bin"
  touch "$pkgdir/usr/bin/upc-ui-py2"
  echo -e '#!/bin/sh\n\n/usr/bin/python2 "/usr/share/upcean/upc-ui-py2.py"\n' > "$pkgdir/usr/bin/upc-ui-py2"
  chmod +x "$pkgdir/usr/bin/upc-ui-py2"
  /usr/bin/install -c "./LICENSE" "$pkgdir/usr/share/licenses/python2-upcean/LICENSE"
  PREFIX="$pkgdir$(/usr/bin/python2 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib());")"
  export PREFIX
  PYTHON="/usr/bin/python2" ./setup
  EggFile="$pkgdir$(/usr/bin/python2 -c "from distutils.sysconfig import get_python_lib; print(get_python_lib());")/$(/usr/bin/python2 -c "import sys; print 'upcean-2.3.7.1-py'+str(sys.version_info[0])+'.'+str(sys.version_info[1])+'.egg-info';")"
  export EggFile
  touch $EggFile
  echo -e "Metadata-Version: 1.0\nName: python2-upcean\nVersion: 2.3.7.1\nSummary: A test upc/ean moudle package.\nHome-page: https://github.com/GameMaker2k/Python-Scripts/tree/master/upctest\nAuthor: Kazuki Przyborowski\nAuthor-email: kazukiprzyborowski[at]gmail[dot]com\nLicense: BSD\nDownload-URL: https://github.com/GameMaker2k/Python-Scripts/archive/master.tar.gz\nDescription: A test upc/ean moudle package.\nPlatform: UNKNOWN" > "$EggFile"
}

# vim:set ts=2 sw=2 et:
