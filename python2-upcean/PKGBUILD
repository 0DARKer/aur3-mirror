# Maintainer: Kazuki Przyborowski <kazukiprzyborowski[at]gmail[dot]com>
pkgname=python2-upcean
pkgver=2.5.0
pkgrel=3
pkgdesc="A barcode library/moudle for python2."
url="https://github.com/GameMaker2k/PyUPC-EAN/"
arch=('any' 'i686' 'x86_64')
license=('BSD')
depends=('python2' 'python2-pillow' 'python2-cherrypy' 'readline' 'freetype2' 'tk')
makedepends=('curl')
conflicts=()
replaces=()
backup=()
install=''
_gitrevision='8d9aea45bb416e9f18e503acd9002ae03c6a219b'
_curluseragent="Mozilla/5.0 (X11; Linux ${CARCH}; rv:25.0) Gecko/20100101 Firefox/25.0"
source=("https://github.com/GameMaker2k/PyUPC-EAN/archive/${_gitrevision}.tar.gz")
md5sums=('5d00ddd32ea490b83542529b8cd4226f')
sha256sums=('02f365e66106c602f765de727d3839d5f2de945bffd0e447fe7bbed134959659')
sha384sums=('a37730ff799dbeaecb6170755fad9aac40074e4acbd0b0965b6f953a67e7712f55e2e5842ac1b874ca90f9ffbab68bd2')
sha512sums=('0bf0538621cd6ca135bfebe9ed8360e27fbe33cb7f83682683c2d6e3464836adc30a3ec55b22487753bfd6ad2b4769cf1ceb3ca489b45294c764c3080628cd86')

build() {
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upcean-pil"
  find . -iname "*.py"  | xargs sed -i.bak -e '1s"^#!.\+$"#!/usr/bin/python2"'
  rm -rfv *.py.bak
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upcean-pil/upcean"
  find . -iname "*.py"  | xargs sed -i.bak -e '1s"^#!.\+$"#!/usr/bin/python2"'
  rm -rfv *.py.bak
}

package() {
  cd "${srcdir}/PyUPC-EAN-${_gitrevision}/upcean-pil"
  test -z "${pkgdir}/usr/share/licenses/python2-upcean" || /usr/bin/install -v -d -m 0644 "${pkgdir}/usr/share/licenses/python2-upcean"
  install -v -d -m 0644 "${pkgdir}/usr/share/icons/hicolor/32x32/apps"
  curl --user-agent "${_curluseragent}" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/32x32/diagram-60.png" > "${pkgdir}/usr/share/icons/hicolor/32x32/apps/upcean-py2.png"
  install -v -d -m 0644 "${pkgdir}/usr/share/icons/hicolor/48x48/apps"
  curl --user-agent "${_curluseragent}" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/48x48/diagram-60.png" > "${pkgdir}/usr/share/icons/hicolor/48x48/apps/upcean-py2.png"
  install -v -d -m 0644 "${pkgdir}/usr/share/icons/hicolor/64x64/apps"
  curl --user-agent "${_curluseragent}" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/64x64/diagram-60.png" > "${pkgdir}/usr/share/icons/hicolor/64x64/apps/upcean-py2.png"
  install -v -d -m 0644 "${pkgdir}/usr/share/icons/hicolor/96x96/apps"
  curl --user-agent "${_curluseragent}" --referer "http://www.softicons.com/free-icons/toolbar-icons/diagram-old-icons-by-double-j-design/barcode-icon" "http://files.softicons.com/download/toolbar-icons/diagram-old-icons-by-double-j-design/png/96x96/diagram-60.png" > "${pkgdir}/usr/share/icons/hicolor/96x96/apps/upcean-py2.png"
  install -v -d -m 0644 "${pkgdir}/usr/share/applications"
  echo -e "[Desktop Entry]\nName=PyUPC-EAN GUI\nName[en_US]=PyUPC-EAN GUI\nComment=Create UPC/EAN barcodes and save as image.\nComment[en_US]=Create UPC/EAN barcodes and save as image.\nGenericName=Barcode Generator\nGenericName[en_US]=Barcode Generator\nExec=upc-ui-py2\nTryExec=upc-ui-py2\nTerminal=false\nType=Application\nIcon=/usr/share/icons/hicolor/64x64/apps/upcean-py2.png\nCategories=Graphics;Graphics;2DGraphics;Graphics;RasterGraphics;\n" > "${pkgdir}/usr/share/applications/upcean.desktop"
  install -v -d -m 0644 "${pkgdir}/usr/share/upcean-py2"
  /usr/bin/install -c "./upc-ui.py" "${pkgdir}/usr/share/upcean-py2/upc-ui-py2.py"
  install -v -d -m 0644 "${pkgdir}/usr/bin"
  touch "${pkgdir}/usr/bin/upc-ui-py2"
  echo -e '#!/bin/sh\n\n/usr/bin/python2 "/usr/share/upcean-py2/upc-ui-py2.py"\n' > "${pkgdir}/usr/bin/upc-ui-py2"
  chmod -v +x "${pkgdir}/usr/bin/upc-ui-py2"
  /usr/bin/install -c "./httpd.py" "${pkgdir}/usr/share/upcean-py2/upc-httpd-py2.py"
  touch "${pkgdir}/usr/bin/upc-httpd-py2"
  echo -e '#!/bin/sh\n\n/usr/bin/python2 "/usr/share/upcean-py2/upc-httpd-py2.py"\n' > "${pkgdir}/usr/bin/upc-httpd-py2"
  chmod -v +x "${pkgdir}/usr/bin/upc-httpd-py2"
  /usr/bin/install -v -c "./LICENSE" "${pkgdir}/usr/share/licenses/python2-upcean/LICENSE"
  /usr/bin/python2 ./setup.py build
  /usr/bin/python2 ./setup.py install --root "${pkgdir}"
  /usr/bin/python2 -m compileall "${pkgdir}/usr/lib/python2.7/site-packages/upcean/"
  /usr/bin/python2 -O -m compileall "${pkgdir}/usr/lib/python2.7/site-packages/upcean/"
}

# vim:set ts=2 sw=2 et:
