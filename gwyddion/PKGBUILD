# on the base of Gentoo gwyddion ebuild
# http://packages.gentoo.org/package/sci-visualization/gwyddion

pkgname=gwyddion
pkgver=2.24
pkgrel=2
pkgdesc="A modular program for SPM (scanning probe microscopy) and other 2D (height field) data visualization and analysis"
url="http://gwyddion.net/"
license=("GPL")
arch=('i686' 'x86_64')
depends=('gtk2>=2.8' 'pango' 'cairo')
#depends=('freeglut' 'gtksourceview')
makedepends=('pkgconfig>=0.16')
optdepends=('gtkglext: for 3D data view'
            'fftw: speed up of some operations'
            'desktop-file-utils: basic desktop integration'
            'libunique: for "remote control"'
            'libxmu: for alternative "remote control" backend'
            'pygtk: Python scripting interface pygwy'
            'gconf: better GNOME and XFce integration (SPM file thumbnails)'
            'libxml2: SPML file support'
            'zlib: Matlab MAT5 file support'
            'python: development of plug-in'
            'perl: development of plug-in'
            'ruby: development of plug-in'
            'fpc: development of plug-in'
            'gtksourceview2: Pygwy console syntax highlighting')
install=gwyddion.install
source=(http://downloads.sourceforge.net/sourceforge/gwyddion/$pkgname-$pkgver.tar.bz2
        http://gwyddion.net/download/2.24/gwyddion-2.24-maskedit-drawing-crash.patch)
md5sums=('6dd8b45a821f320e175575a83097dcca'
         '297a87ac42d584054b29e46559aad44f')


build() {
  cd "${srcdir}/$pkgname-$pkgver"

#  ./configure --prefix=/usr --disable-desktop-file-update \
#		--disable-rpath \
#		--enable-library-bloat \
#		--enable-plugin-proxy \

  patch -Np0 -i ../gwyddion-2.24-maskedit-drawing-crash.patch || return 1
  ./configure --prefix=/usr --sysconfdir=/etc \
              --localstatedir=/var || return 1
  make || return 1
  make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="${pkgdir}" install || return 1
  
  install -m755 -d "${pkgdir}/usr/share/gconf/schemas"

  gconf-merge-schema "${pkgdir}/usr/share/gconf/schemas/${pkgname}.schemas" --domain gwyddion ${pkgdir}/etc/gconf/schemas/*.schemas || return 1
  rm -f ${pkgdir}/etc/gconf/schemas/*.schemas
}
