# Maintainer: Robert Knauer <robert@privatdemail.net>

pkgname=freediameter
pkgver=1.1.2
pkgrel=1
pkgdesc="An open source implementation of the diameter protocol"
arch=('i686' 'x86_64')
url="http://www.freediameter.net/"
license=('BSD')
depends=('glib2' 'gnutls' 'lksctp-tools' 'libidn')
makedepends=('cmake' 'bison' 'flex')
install=freediameter.install
source=(freediameter http://www.freediameter.net/hg/freeDiameter/archive/${pkgver}.tar.gz)
md5sums=('9f98b5926802b7e8aa946f5c863d947a' '09a98286edbda44f96d9c0bf997b977f')
conflicts=('freediameter-hg')

build() {
	cd $srcdir/freeDiameter-$pkgver
	rm -rf build
	mkdir build || return 1
	cd build
	cmake -DCMAKE_INSTALL_PREFIX:STRING=/usr -DDEFAULT_CONF_PATH:STRING=/etc/freeDiameter ../ || return 1
	make || return 1
	make DESTDIR=$pkgdir install || return 1
	
	install -D -m 0644 $srcdir/freeDiameter-$pkgver/doc/freediameter.conf.sample $pkgdir/etc/freeDiameter/freeDiameter.conf.sample || return 1
	rm -f $srcdir/freeDiameter-$pkgver/doc/freediameter.conf.sample || return 1
	for f in $srcdir/freeDiameter-$pkgver/doc/*.conf.sample; do
		install -D -m 0644 $f $pkgdir/etc/freeDiameter/ || return 1
	done
	install -D -m 0755 $srcdir/freediameter $pkgdir/etc/rc.d/freediameter || return 1
}
