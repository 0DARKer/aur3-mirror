pkgname=clay-git
pkgver=20100316
pkgrel=1
pkgdesc="Clay is a programming language designed for Generic Programming."
arch=('i686' 'x86_64')
url="http://tachyon.in/clay/"
license=('custom')
depends=('clang-svn')
optdepends=('lua' 'python' 'svn')
makedepends=('cmake' 'git')
provides=('clay')
conflicts=('clay')
source=()

_gitroot="https://github.com/jckarter/clay.git"

build() {

  msg "Connecting to GIT server..."
  if [[ -d $srcdir/$pkgname-$pkgver ]]; then
    cd $srcdir/$pkgname-$pkgver && git pull origin || return 1
  else
    git clone $_gitroot $srcdir/$pkgname-$pkgver || return 1
    cd $srcdir/$pkgname-$pkgver
  fi
  
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cd "$srcdir/$pkgname-$pkgver"

  cmake . -DCMAKE_INSTALL_PREFIX=/usr

#  cd compiler/src/CMakeFiles/clay.dir
#  sed 's/-Wl,//g' -i link.txt
#  sed 's/--as-needed//g' -i link.txt
#  cd -
#  cd misc/bindgen/src/CMakeFiles/clay-bindgen.dir
#  sed 's/-Wl,//g' -i link.txt
#  sed 's/--as-needed//g' -i link.txt
#  cd -

  LDFLAGS="" make || return 1

}

package() {

  cd "$srcdir/$pkgname-$pkgver"
  make PREFIX="usr" DESTDIR="$pkgdir" install || return 1

}

# vim:set ts=2 sw=2 et: 
