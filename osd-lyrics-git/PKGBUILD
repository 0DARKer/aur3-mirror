pkgname=osd-lyrics-git
pkgver=20110731
pkgrel=1
pkgdesc="An OSD lyric show supporting multiple media players and downloading."
arch=('i686' 'x86_64')
url="https://github.com/tigersoldier/osd-lyrics/"
license=('GPL3')
depends=('gtk2' 'dbus-glib' 'curl' 'libnotify' 'libmpd')
makedepends=('git' 'pkgconfig' 'intltool')
conflicts=('osd-lyrics')
provides=('osd-lyrics')
install=osd-lyrics.install

_amarok1=false
_mpd=false
_xmms2=false

if [ "$_mpd" = "false" ]; then
     depends=('gtk2' 'dbus-glib' 'curl' 'libnotify')
fi

_gitroot="git://github.com/tigersoldier/osd-lyrics.git"
_gitname="osd-lyrics"

build() {
    cd "$startdir/src"
    msg "Connecting to github.com GIT server"
    
    if [ -d $startdir/src/$_gitname ]; then
        cd $_gitname && git pull origin
        msg "The local files are updated."
    else
        git clone $_gitroot
    fi
    
    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    cp -r $startdir/src/$_gitname $startdir/src/$_gitname-build
    cd $startdir/src/$_gitname-build

    ./autogen.sh || return 1

    if [ "$_amarok1" = "true" ]; then
	    configure="$configure --enable-amarok1"
    fi

    if [ "$_mpd" = "false" ]; then
	    configure="$configure --disable-mpd"
    fi

    if [ "$_xmms2" = "false" ]; then
	    configure="$configure --disable-xmms2"
    fi

    ./configure --prefix=/usr $configure || return 1
    make || return 1
    make DESTDIR="$pkgdir/" install || return 1
}
