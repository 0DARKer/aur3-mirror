# Maintainer: Alexander De Sousa <archaur.xandy21@spamgourmet.com>

pkgname=client175-svn
pkgver=116
pkgrel=1
pkgdesc="Full featured MPD web client, svn code."
arch=('any')
url="http://code.google.com/p/client175/"
license=('GPL3')
depends=('mpd>=0.14' 'python2')
makedepends=('subversion')
provides=('client175')
conflicts=('client175')
backup=('opt/client175/site.conf')
install=client175-svn.install
source=()
sha1sums=()

_svntrunk=http://client175.googlecode.com/svn/trunk/
_svnmod=client175

build() {
	cd "$srcdir"

	if [ -d $_svnmod/.svn ]; then
		msg2 "Updating downloaded sources..."
		(cd $_svnmod && svn up --quiet -r $pkgver)
	else
		msg2 "Downloading sources from the repository..."
		svn co --quiet $_svntrunk --config-dir ./ -r $pkgver $_svnmod
	fi

	msg2 "SVN checkout done or server timeout."
}

package() {
	msg2 "Installing files..."
	mkdir -p "$pkgdir/opt/"
	cp -r "$srcdir/client175" "$pkgdir/opt/"
	sed 's|python|python2|g' -i "$pkgdir/opt/client175/server.py"
	
	msg2 "Deleting .svn directories..."
	rm -fr `find "$pkgdir/opt" -type d -name .svn`

	msg2 "Allowing direct execution..."
	chmod +x "$pkgdir/opt/client175/server.py"
}
