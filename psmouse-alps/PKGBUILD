# Maintainer: Tai Chi Minh Ralph Eastwood <tcmreastwood@gmail.com>

pkgname=('psmouse-alps')
_kernelname=${pkgname#linux}
_basekernel=3.0
_patchver=${_basekernel}.4
pkgver=0.6
pkgrel=1
pkgdesc="psmouse kernel module with support with alps"
arch=('i686' 'x86_64')
url="http://www.kernel.org/"
license=('GPL2')
makedepends=('linux-headers')
options=('!strip')
install=psmouse.install
source=("http://ftp.ua.postgresql.org/pub/mirrors/kernel.org/linux/kernel/v3.0/linux-${_basekernel}.tar.bz2"
"http://ftp.ua.postgresql.org/pub/mirrors/kernel.org/linux/kernel/v3.0/patch-${_patchver}.bz2"
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0001-Revert-UBUNTU-SAUCE-no-up-Add-support-for-Intellimou.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0002-Input-ALPS-Move-protocol-information-to-Documentatio.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0003-Input-psmouse-Add-PSMOUSE_CMD_RESET_WRAP.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0004-Input-ALPS-Add-protocol-version-field-in-alps_model_.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0005-Input-ALPS-Remove-assumptions-about-packet-size.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0006-Input-ALPS-Add-support-for-protocol-versions-3-and-4.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0007-Input-ALPS-Add-documentation-for-protocol-versions-3.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.6/0008-Input-ALPS-Add-semi-MT-support-for-v3-protocol.patch
)

build() {
cd "${srcdir}/linux-${_basekernel}"
for i in ${srcdir}/0*.patch
do
echo "patch -Np1 -i $i" 
patch -Np1 -i $i || true
done
patch -p1 -i "${srcdir}/patch-${_patchver}"
cd drivers/input/mouse
make -C /usr/src/linux-`uname -r`/ M=`pwd` psmouse.ko
gzip -9 psmouse.ko
install -D -m 0644 psmouse.ko.gz ${pkgdir}/lib/modules/`uname -r`/updates/drivers/input/mouse/psmouse.ko.gz
}
md5sums=('398e95866794def22b12dfbc15ce89c0'
'62ca5f3caed233617127b2b3b7a87d15'
'18adb1c938537756d0e50f2683ac1f6e'
'a5cb602063bf1b8064fa77d1ab5c7d2e'
'0ac240ea77e7c78af94c1474238efe0b'
'116cbd73ab0e414f187f6a360063130f'
'c5b4aa36c922e247974f3217ce976478'
'868ce80507c281da58191ee4c0a83d72'
'e6163e666d4165ddf088fc519efe1d60'
'2710f7edd35d379acddbe0ccf668add9')
