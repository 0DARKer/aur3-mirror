# Maintainer: Tai Chi Minh Ralph Eastwood <tcmreastwood@gmail.com>

pkgname=('psmouse-alps')
_kernelname=${pkgname#linux}
_basekernel=3.0
pkgver=${_basekernel}.4
pkgrel=2
pkgdesc="psmouse kernel module with support with alps"
arch=('i686' 'x86_64')
url="http://www.kernel.org/"
license=('GPL2')
makedepends=('linux-headers')
options=('!strip')
install=psmouse.install
source=("http://ftp.ua.postgresql.org/pub/mirrors/kernel.org/linux/kernel/v3.0/linux-${_basekernel}.tar.bz2"
        "http://ftp.ua.postgresql.org/pub/mirrors/kernel.org/linux/kernel/v3.0/patch-${pkgver}.bz2"
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0001-Input-ALPS-Move-protocol-information-to-Documentatio.patch
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0002-Input-psmouse-Add-PSMOUSE_CMD_RESET_WRAP.patch
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0003-Input-ALPS-Add-protocol-version-field-in-alps_model_.patch
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0004-Input-ALPS-Remove-assumptions-about-packet-size.patch
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0005-Input-ALPS-Add-support-for-protocol-versions-3-and-4.patch
	http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.2/0006-Input-ALPS-Add-documentation-for-protocol-versions-3.patch)

build() {
  cd "${srcdir}/linux-${_basekernel}"
  for i in ${srcdir}/0*.patch
  do
    patch -Np1 -i $i
  done
  patch -p1 -i "${srcdir}/patch-${pkgver}"
  cd drivers/input/mouse
  make -C /usr/src/linux-`uname -r`/ M=`pwd` psmouse.ko
  gzip -9 psmouse.ko
  install -D -m 0644 psmouse.ko.gz ${pkgdir}/lib/modules/`uname -r`/updates/drivers/input/mouse/psmouse.ko.gz
}

md5sums=('398e95866794def22b12dfbc15ce89c0'
         '62ca5f3caed233617127b2b3b7a87d15'
         '8709db32be2961c669c7e5583b0fef5f'
         'eb5df2abc4e3c8d8168b42a76627fd6b'
         'a457496498363e024ecf2417deb12286'
         '9a5c564e1a77a279d182a764e57e218d'
         '8938ff9d07bbcc35096ff6494d6d4007'
         '9b47b04cec59e3c7d986b45d460ff0b6')
