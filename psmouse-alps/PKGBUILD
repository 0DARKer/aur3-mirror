# Maintainer: Paolo Stivanin <admin@polslinux.it>

pkgname=('psmouse-alps')
_kernelname=${pkgname#linux}
_basekernel=3.1
_patchver=${_basekernel}.7
pkgver=0.10
pkgrel=2
pkgdesc="psmouse kernel module with support with alps"
arch=('i686' 'x86_64')
url="http://www.kernel.org/"
license=('GPL2')
makedepends=('linux-headers')
options=('!strip')
install=psmouse.install
source=("http://www.kernel.org/pub/linux/kernel/v3.0/linux-${_basekernel}.tar.bz2"
"http://www.kernel.org/pub/linux/kernel/v3.0/patch-${_patchver}.bz2"
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0001-Input-ALPS-Move-protocol-information-to-Documentatio.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0002-Input-psmouse-Add-PSMOUSE_CMD_RESET_WRAP.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0003-Input-ALPS-Add-protocol-version-field-in-alps_model_.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0004-Input-ALPS-Remove-assumptions-about-packet-size.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0005-Input-ALPS-Add-support-for-protocol-versions-3-and-4.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0006-Input-ALPS-Add-semi-MT-support-for-v3-protocol.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0007-Input-ALPS-Add-documentation-for-protocol-versions-3.patch
http://people.canonical.com/~sforshee/alps-touchpad/psmouse-alps-0.10/0008-Input-ALPS-dump-raw-packet-data.patch
)

build() {
cd "${srcdir}/linux-${_basekernel}"
for i in ${srcdir}/0*.patch
do
echo "patch -Np1 -i $i" 
patch -Np1 -i $i || true
done
patch -p1 -i "${srcdir}/patch-${_patchver}"
cd drivers/input/mouse
make -C /usr/src/linux-`uname -r`/ M=`pwd` psmouse.ko
gzip -9 psmouse.ko
install -D -m 0644 psmouse.ko.gz ${pkgdir}/lib/modules/`uname -r`/updates/drivers/input/mouse/psmouse.ko.gz
}
md5sums=('8d43453f8159b2332ad410b19d86a931'
'13ea1e611a0a580138b8203e6f1353ed'
'a62122e3ca9c2ef9114556a731bbee13'
'c9c2ef0a00cb00fad69d58f380c5912d'
'c3333a937d556546134553e06b75d6d4'
'd3ae923976f06886f4fea0c725c92859'
'0ea5a13cfd082e2ecaea287a6abc15b8'
'ed097df3d3de8512545698a4a0be76b8'
'9843fa870c234ff007ba2fa1d42d48b2'
'a1e2dbf239201d307d392543bc0e58ba')
