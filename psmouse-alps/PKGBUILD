# Maintainer: Paolo Stivanin <admin@polslinux.it>
# Contributor: Paolo Stivanin <admin@polslinux.it>

pkgname=('psmouse-alps')
_kernelname=${pkgname#linux}
_basekernel=3.2
_patchver=3.2.2
pkgver=0.10
pkgrel=3.2.2.1
pkgdesc="psmouse kernel module with support for alps touchpad"
arch=('i686' 'x86_64')
url="http://www.kernel.org/"
license=('GPL2')
makedepends=('linux-headers')
options=('!strip')
install=psmouse.install
source=(http://www.kernel.org/pub/linux/kernel/v3.x/linux-${_basekernel}.tar.bz2
http://www.kernel.org/pub/linux/kernel/v3.x/patch-${_patchver}.bz2
drivers_input_mouse_alps.c
drivers_input_mouse_alps.h
drivers_input_mouse_psmouse-base.c
drivers_input_mouse_psmouse.h
)
md5sums=(
'7ceb61f87c097fc17509844b71268935'
'e9e53fba37c5e2afa4cdecab234120bd'
'f6c2b7f036fb98c239f211f4aeac4a11'
'9f3b437cdf3332b2c1a53de5362f45d4'
'1f9b5cf3a0c4430c6d3079ce2b87378c'
'a43352ca371f3b56268d82aeb836ff74'
)

build() {
cd ${srcdir}/linux-${_basekernel}
patch -p1 -i ${srcdir}/patch-${_patchver}
cp -v ${srcdir}/drivers_input_mouse_alps.c ${srcdir}/linux-${_basekernel}/drivers/input/mouse/
cp -v ${srcdir}/drivers_input_mouse_alps.h ${srcdir}/linux-${_basekernel}/drivers/input/mouse/
cp -v ${srcdir}/drivers_input_mouse_psmouse-base.c ${srcdir}/linux-${_basekernel}/drivers/input/mouse/
cp -v ${srcdir}/drivers_input_mouse_psmouse.h ${srcdir}/linux-${_basekernel}/drivers/input/mouse/
cd ${srcdir}/linux-${_basekernel}/drivers/input/mouse
make -C /usr/src/linux-`uname -r`/ M=`pwd` psmouse.ko
gzip -9 psmouse.ko
install -D -m 0644 psmouse.ko.gz ${pkgdir}/lib/modules/`uname -r`/updates/drivers/input/mouse/psmouse.ko.gz
}
