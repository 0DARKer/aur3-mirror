# Maintainer: cornholio <vigo.the.unholy.carpathian@gmail.com>
# Contributor: cornholio <vigo.the.unholy.carpathian@gmail.com>

pkgname=cula
pkgver=R14
pkgrel=1
pkgdesc="Provides GPU-accelerated implementations of the LAPACK and BLAS libraries for dense linear algebra. Contains routines for systems solvers, singular value decompositions, and eigenproblems."
arch=("i686" "x86_64")
url="http://www.culatools.com/downloads/"
license=(custom)
depends=("cuda-toolkit>=4.1.0")
sha1sums=('2437306728f59f1733018f25a0b22a77454f4ab4')
if test "$CARCH" == x86_64; then
  rarch="64"
else
  rarch="32"
fi

mainfile=("cula_dense_free_${pkgver}-linux${rarch}.run")
noextract=($mainfile)
source=("http://www.culatools.com/files/cula/${pkgver}/${mainfile}")

build() {
	sh ./${mainfile} --noexec --target $srcdir
	sed -i "s^install\_prefix\=\"^install\_prefix\=\"${pkgdir}^g" $srcdir/installcula.sh	
	sh $srcdir/installcula.sh silent-accept-eula
	rm $pkgdir/usr/local/cula/installcula.sh
	rm $pkgdir/usr/local/cula/$mainfile
	mkdir -p $pkgdir/usr/share/licenses/cula
	cp $pkgdir/usr/local/cula/doc/license.txt $pkgdir/usr/share/licenses/cula/LICENSE
}
