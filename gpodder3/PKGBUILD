# Contributor: Greg Fitzgerald <greg@gregf.org>

pkgname=gpodder3
_pkgname=gpodder
pkgver=3.2.0
pkgrel=3
pkgdesc='A podcast receiver/catcher'
license=('GPL3')
arch=('any')
url='http://gpodder.org/'
conflicts=('gpodder' 'gpodder2' 'gpodder-git')
depends=('pygtk' 'python2-feedparser' 'dbus-python' 'python2-mygpoclient')
makedepends=('intltool' 'imagemagick' 'help2man')
optdepends=('libgpod: for ipod support'
            'pymad: for ipod support'
            'mplayer: for ipod video support'
            'python-imaging: rockbox cover art support'
            'vorbis-tools: for ogg tag updating and converting to mp3'
            'lame: for converting ogg to mp3'
            'gnome-bluetooth: transfer podcast via bluethooth'
            'pywebkitgtk: render shownotes'
            'python-eyed3: for ipod support')
            # pymtp: for mtp support (AUR only)
source=(${_pkgname}-${pkgver}.tar.gz::http://${_pkgname}.org/source/${pkgver}
0001-Decode-enclosure-filename-properly-bug-1663.patch
0002-Fix-YouTube-download-URL-resolving-bug-1665.patch
)
md5sums=('29587ee5d88c9802a862ec41686bdd52'
         '910e42824c1037d058020e457ce6d5cc'
         '66033f164bd5f1b15f970c580e116869')
install=gpodder.install

package() {
  cd "${srcdir}/${_pkgname}-${pkgver}"

  patch -p1 < $startdir/0001-Decode-enclosure-filename-properly-bug-1663.patch
  patch -p1 < $startdir/0002-Fix-YouTube-download-URL-resolving-bug-1665.patch

  cd ${srcdir}/${_pkgname}-${pkgver}

  PYTHON=python2 make DESTDIR=${pkgdir}/ install

  sed -i -e 's|#!/usr/bin/python$|#!/usr/bin/python2|' \
         -e 's|#!/usr/bin/env python$|#!/usr/bin/env python2|' \
    $(find $pkgdir/usr/lib/python2.7/site-packages/gpodder/ -name '*.py')
}
