# Maintainer: Alessandro Pazzaglia <crazy2garlic at gmail dot com>

pkgname=typhon-svn
pkgver=100
pkgrel=1
pkgdesc="A slim and themeable OpenGL-based dashboard and emulator launcher"
arch=('i686' 'x86_64')
url="http://code.google.com/p/typhon-launcher/"
license=('GPL3')
depends=('devil' 'ffmpeg' 'python2' 'ftgl' 'sdl_mixer' 'libxrandr')
makedepends=('subversion' 'cmake')
optdepends=('scrot: for automatic screenshots'
'imagemagick: for automatic screenshots'
'xscreensaver: for animated backgrounds'
'leafpad: for editing configuration')

_svntrunk="http://typhon-launcher.googlecode.com/svn/trunk/"
_svnmod="typhon-svn"

build() {
    cd "$srcdir"

    msg "Starting SVN checkout ..."

    if [ -d $_svnmod/.svn ]
    then
        cd $_svnmod && svn up -r $pkgver
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    rm -rf "$srcdir/$_svnmod-build"
    cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"

    msg "Fixing scripts ..."

    cd "$srcdir/$_svnmod-build"
    sed -i '1s,python,python2,' "data/scripts/p3textractor.py"

    msg "Starting make ..."

    cd "$srcdir/$_svnmod-build/build"
    ./cmake.sh
    make
}

package() {
    cd "$srcdir/$_svnmod-build/build"
    make DESTDIR="$pkgdir/" install
}
