# Maintainer: Alessandro Pazzaglia <jackdroido at gmail dot com>

pkgname=typhon-svn
pkgver=171
pkgrel=1
pkgdesc="A slim and themeable OpenGL-based dashboard and emulator launcher"
arch=('i686' 'x86_64')
url="http://code.google.com/p/typhon-launcher/"
license=('GPL3')
depends=('ftgl' 'sfml' 'opencv')
makedepends=('subversion' 'cmake')
source=('patch_cmake_threads.diff')
md5sums=('7ea63284d6e45f5c70f131feccd520cb')

_svntrunk="http://typhon-launcher.googlecode.com/svn/trunk/"
_svnmod="typhon-svn"

build() {
    cd "$srcdir"

    msg "Starting SVN checkout ..."

    if [ -d $_svnmod/.svn ]
    then
        cd $_svnmod && svn up -r $pkgver
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    rm -rf "$srcdir/$_svnmod-build"
    cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"

    msg "Applying patches ..."

    cd "$srcdir/$_svnmod-build"
    patch -p1 < ../patch_cmake_threads.diff

    msg "Starting make ..."

    cd "$srcdir/$_svnmod-build/build"
    cmake -DCMAKE_INSTALL_PREFIX=/usr -DNOMMD=ON ..
    make
}

package() {
    cd "$srcdir/$_svnmod-build/build"
    make DESTDIR="$pkgdir/" install
}
