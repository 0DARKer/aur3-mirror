diff -Nur muduo-orig/CMakeLists.txt muduo/CMakeLists.txt
--- muduo-orig/CMakeLists.txt	2011-05-22 20:24:08.658154010 +0800
+++ muduo/CMakeLists.txt	2011-05-22 21:03:57.141881148 +0800
@@ -2,8 +2,13 @@
 
 project(muduo CXX)
 
+if(NOT CMAKE_BUILD_TYPE)
+  set(CMAKE_BUILD_TYPE "Debug" CACHE STRING
+	"Choose the type of build, options are:
+	None Debug Release RelWithDebInfo MinSizeRel Profile." FORCE)
+endif()
+
 set(CXX_FLAGS
- -g
  # -DVALGRIND
  # -DMUDUO_STD_STRING
  -Wall
@@ -20,13 +25,12 @@
  -march=native
  # -MMD
  # -std=c++0x
- -rdynamic
  )
 string(REPLACE ";" " " CMAKE_CXX_FLAGS "${CXX_FLAGS}")
 
 set(CMAKE_CXX_COMPILER "g++")
 #set(CMAKE_CXX_COMPILER "icpc")
-set(CMAKE_CXX_FLAGS_DEBUG "-O0")
+set(CMAKE_CXX_FLAGS_DEBUG "-O0 -g")
 set(CMAKE_CXX_FLAGS_RELEASE "-O2 -finline-limit=1000 -DNDEBUG")
 set(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
 set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
diff -Nur muduo-orig/examples/idleconnection/echo.cc muduo/examples/idleconnection/echo.cc
--- muduo-orig/examples/idleconnection/echo.cc	2011-05-22 20:24:08.648154062 +0800
+++ muduo/examples/idleconnection/echo.cc	2011-05-22 20:24:19.901426431 +0800
@@ -94,8 +94,7 @@
         ++it)
     {
       bool connectionDead = (*it)->weakConn_.expired();
-      printf("%p(%zd)%s, ", get_pointer(*it), it->use_count(),
-          connectionDead ? " DEAD" : "");
+      printf("%p(%zd)%s, ", get_pointer(*it), static_cast<signed size_t>(it->use_count()), connectionDead ? " DEAD" : "");
     }
     puts("");
   }
diff -Nur muduo-orig/muduo/base/CMakeLists.txt muduo/muduo/base/CMakeLists.txt
--- muduo-orig/muduo/base/CMakeLists.txt	2011-05-22 20:24:08.634820802 +0800
+++ muduo/muduo/base/CMakeLists.txt	2011-05-22 20:53:31.051939636 +0800
@@ -9,7 +9,17 @@
   ThreadPool.cc
   )
 
+find_package( Boost )
+if(NOT Boost_FOUND)
+  message(FATAL_ERROR "Can not find Boost!")
+endif()
+
+include_directories(${Boost_INCLUDE_DIRS})
 add_library(muduo_base ${base_SRCS})
 target_link_libraries(muduo_base pthread)
 
+install(TARGETS muduo_base DESTINATION lib)
+file(GLOB HEADERS "*.h")
+install(FILES ${HEADERS} DESTINATION include/muduo/base)
+
 add_subdirectory(tests)
diff -Nur muduo-orig/muduo/base/tests/Fork_test.cc muduo/muduo/base/tests/Fork_test.cc
--- muduo-orig/muduo/base/tests/Fork_test.cc	2011-05-22 20:24:08.631487487 +0800
+++ muduo/muduo/base/tests/Fork_test.cc	2011-05-22 20:24:19.961426107 +0800
@@ -4,18 +4,18 @@
 #include <sys/types.h>
 #include <unistd.h>
 
-__thread int x = 0;
+__thread int xxx = 0;
 
 void print()
 {
-  printf("pid=%d tid=%d x=%d\n", getpid(), muduo::CurrentThread::tid(), x);
+  printf("pid=%d tid=%d xxx=%d\n", getpid(), muduo::CurrentThread::tid(), xxx);
 }
 
 int main()
 {
   printf("parent %d\n", getpid());
   print();
-  x = 1;
+  xxx = 1;
   print();
   pid_t p = fork();
 
@@ -24,14 +24,14 @@
     printf("chlid %d\n", getpid());
     // child
     print();
-    x = 2;
+    xxx = 2;
     print();
 
     if (fork() == 0)
     {
       printf("grandchlid %d\n", getpid());
       print();
-      x = 3;
+      xxx = 3;
       print();
     }
   }
diff -Nur muduo-orig/muduo/net/CMakeLists.txt muduo/muduo/net/CMakeLists.txt
--- muduo-orig/muduo/net/CMakeLists.txt	2011-05-22 20:24:08.641487432 +0800
+++ muduo/muduo/net/CMakeLists.txt	2011-05-22 20:55:39.557910125 +0800
@@ -23,6 +23,11 @@
 add_library(muduo_net ${net_SRCS})
 target_link_libraries(muduo_net muduo_base)
 
+install(TARGETS muduo_net DESTINATION lib)
+file(GLOB HEADERS "*.h")
+install(FILES ${HEADERS} DESTINATION include/muduo/net)
+install(FILES poller/EPollPoller.h  poller/PollPoller.h DESTINATION include/muduo/net/poller)
+
 add_subdirectory(http)
 add_subdirectory(inspect)
 add_subdirectory(tests)
diff -Nur muduo-orig/muduo/net/http/CMakeLists.txt muduo/muduo/net/http/CMakeLists.txt
--- muduo-orig/muduo/net/http/CMakeLists.txt	2011-05-22 20:24:08.641487432 +0800
+++ muduo/muduo/net/http/CMakeLists.txt	2011-05-22 21:00:58.126184292 +0800
@@ -6,6 +6,10 @@
 add_library(muduo_http ${http_SRCS})
 target_link_libraries(muduo_http muduo_net)
 
+install(TARGETS muduo_http DESTINATION lib)
+file(GLOB HEADERS "*.h")
+install(FILES ${HEADERS} DESTINATION include/muduo/net/http)
+
 add_executable(httpserver_test tests/HttpServer_test.cc)
 target_link_libraries(httpserver_test muduo_http)
 
diff -Nur muduo-orig/muduo/net/inspect/CMakeLists.txt muduo/muduo/net/inspect/CMakeLists.txt
--- muduo-orig/muduo/net/inspect/CMakeLists.txt	2011-05-22 20:24:08.641487432 +0800
+++ muduo/muduo/net/inspect/CMakeLists.txt	2011-05-22 20:53:52.785155229 +0800
@@ -6,6 +6,10 @@
 add_library(muduo_inspect ${inspect_SRCS})
 target_link_libraries(muduo_inspect muduo_http)
 
+install(TARGETS muduo_inspect DESTINATION lib)
+file(GLOB HEADERS "*.h")
+install(FILES ${HEADERS} DESTINATION include/muduo/net/inspect)
+
 add_executable(inspector_test tests/Inspector_test.cc)
 target_link_libraries(inspector_test muduo_inspect)
 
diff -Nur muduo-orig/muduo/net/SocketsOps.cc muduo/muduo/net/SocketsOps.cc
--- muduo-orig/muduo/net/SocketsOps.cc	2011-05-22 20:24:08.638154117 +0800
+++ muduo/muduo/net/SocketsOps.cc	2011-05-22 20:24:19.981425999 +0800
@@ -40,13 +40,13 @@
   // non-block
   int flags = ::fcntl(sockfd, F_GETFL, 0);
   flags |= O_NONBLOCK;
-  int ret = ::fcntl(sockfd, F_SETFL, flags);
+  ::fcntl(sockfd, F_SETFL, flags);
   // FIXME check
 
   // close-on-exec
   flags = ::fcntl(sockfd, F_GETFD, 0);
   flags |= FD_CLOEXEC;
-  ret = ::fcntl(sockfd, F_SETFD, flags);
+  ::fcntl(sockfd, F_SETFD, flags);
   // FIXME check
 }
 
diff -Nur muduo-orig/muduo/net/SocketsOps.h muduo/muduo/net/SocketsOps.h
--- muduo-orig/muduo/net/SocketsOps.h	2011-05-22 20:24:08.641487432 +0800
+++ muduo/muduo/net/SocketsOps.h	2011-05-22 20:24:20.004759205 +0800
@@ -24,6 +24,7 @@
 // the inline assembler code makes type blur,
 // so we disable warnings for a while.
 #pragma GCC diagnostic ignored "-Wconversion"
+#pragma GCC diagnostic ignored "-Wold-style-cast"
 inline uint64_t hostToNetwork64(uint64_t host64)
 {
   return htobe64(host64);
@@ -54,6 +55,7 @@
   return ntohs(net16);
 }
 #pragma GCC diagnostic error "-Wconversion"
+#pragma GCC diagnostic error "-Wold-style-cast"
 
 ///
 /// Creates a non-blocking socket file descriptor,
diff -Nur muduo-orig/muduo/net/TimerQueue.cc muduo/muduo/net/TimerQueue.cc
--- muduo-orig/muduo/net/TimerQueue.cc	2011-05-22 20:24:08.641487432 +0800
+++ muduo/muduo/net/TimerQueue.cc	2011-05-22 20:24:20.028092413 +0800
@@ -190,6 +190,7 @@
   }
 }
 
+#pragma GCC diagnostic ignored "-Wunused-but-set-variable"
 bool TimerQueue::insert(Timer* timer)
 {
   bool earliestChanged = false;
@@ -203,4 +204,4 @@
   assert(result.second);
   return earliestChanged;
 }
-
+#pragma GCC diagnostic error "-Wunused-but-set-variable"
