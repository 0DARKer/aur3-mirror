# $Id: PKGBUILD 156673 2012-04-22 21:38:48Z eric $
# Maintainer: Eric BÃ©langer <eric@archlinux.org>

pkgname=fvwm+
pkgver=2.6.5
pkgrel=1
pkgdesc="A multiple large virtual desktop window manager originally derived from twm"
arch=('i686' 'x86_64')
url="http://www.fvwm.org"
license=('GPL' 'custom')
depends=('imlib' 'fribidi' 'perl' 'libstroke' 'libxpm' 'librsvg' 'libxinerama' 'libxcursor')
makedepends=('libxslt')
provides=('fvwm-devel')
conflicts=('fvwm-devel')
replaces=('fvwm-devel')
options=('!emptydirs' '!makeflags')
source=(ftp://ftp.fvwm.org/pub/fvwm/version-2/fvwm-$pkgver.tar.bz2 
        fvwm+.desktop 
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/01-fvwm-translucent-menus.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/03-ColourBorders.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/04-ResizeOutlineThin.patch
	04-ResizeOutlineThin1.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/05-Conditionals.patch
	06-FlatSeparators-2.6.2.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/07-BorderUnderTitle.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/08-InactiveFont.patch
	09-FluxRoundedCorners-2.6.2.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/10-TopBorder.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/11-ButtonWidth.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/12-MultiBorder.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/13-FvwmButtonsTips.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/14-FvwmIconMan.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/15-Hover.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/16-FirstItemUnderPointer.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/17-TextOffset.patch
	http://fvwm.tuxfamily.org/pub/wiki/portage/files/18-ThinGeometryProxy.patch )

patched() {
  cd "${srcdir}/fvwm-$pkgver"
  #Patching
  # Enables real transparency on menus
  echo "** Applying Translucent menus patch **"
  patch -p0 < $startdir/01-fvwm-translucent-menus.patch || return 1
  
  # Enables different colours on window's borders
  echo "** Applying ColourBorders patch **"
  patch -p0 < $startdir/03-ColourBorders.patch || return 1

  # Enables a single piwel rectangle when resizing
  echo "** Applying Resize Outline Thin patch **"
  patch -p0 < $startdir/04-ResizeOutlineThin1.patch || return 1

  # Enables other conditions for windows :)
  echo "** Applying Conditional patch **"
  patch -p0 < $startdir/05-Conditionals.patch || return 1

  # Enables the use of Flat Separators (single pixel separator)
  echo "** Applying flat separators patch **"
  patch -p0 < $startdir/06-FlatSeparators-2.6.2.patch || return 1

  # Adds a border under the titlebar
  echo "** Applying border under titlebar patch **"
  patch -p0 < $startdir/07-BorderUnderTitle.patch || return 1

  # Enables the use of a different font for Inactive windows
  echo "** Applying inactive fonts patch **"
#  patch -p0 < $startdir/08-InactiveFont.patch || return 1

  # A mix of FluxboxHandles and RoundedCorners
  # you can't activate both on the same window
  # Add corners in fluxbox style
  # or add rounded corners
  echo "** Applying FluxRounded Corners patch **"
  patch -p0 < $startdir/09-FluxRoundedCorners-2.6.2.patch || return 1

  # Sets the top border to a single pixel
  echo "** Applying Top Border patch **"
  patch -p0 < $startdir/10-TopBorder.patch || return 1

  # Sets the width of the title buttons
  echo "** Applying Button Width patch **"
  patch -p0 < $startdir/11-ButtonWidth.patch || return 1

  # Enables the use of 8 pixmaps for each borders
  echo "** Applying Multiborder patch **"
  patch -p0 < $startdir/12-MultiBorder.patch || return 1

  # Enables the uses of tips on FvwmButtons
  echo "** Applying FvwmButtonTips patch **"
  patch -p0 < $startdir/13-FvwmButtonsTips.patch || return 1

  # Enables rounded corners on FvwmIconMan
  echo "** Applying FvwmIconMan patch **"
  patch -p0 < $startdir/14-FvwmIconMan.patch || return 1

  # Allows you to specify button pixmaps that will be shown when you move the mouse over the buttons
  echo "** Applying Hover patch **"
  patch -p0 < $startdir/15-Hover.patch || return 1

  # Menus with titles are opened so that the first item is under the pointer without warping
  echo "** Applying First Item Under Pointer patch **"
  patch -p0 < $startdir/16-FirstItemUnderPointer.patch || return 1

  # Enables Offset of the text in TitleBar
  echo "** Applying TextOffset patch **"
  patch -p0 < $startdir/17-TextOffset.patch || return 1

  # The geometry window and proxy windows have a single pixel border
  echo "** Applying ThinGeometry patch **"
  patch -p0 < $startdir/18-ThinGeometryProxy.patch || return 1
}

build() {
  cd "${srcdir}/fvwm-${pkgver}"
patched
  ./configure --prefix=/usr \
    --sysconfdir=/etc \
    --libexecdir=/usr/lib \
    --with-stroke-library \
    --with-xft-prefix=/usr \
    --with-fontconfig-prefix=/usr \
    --with-fontconfig-exec-prefix=/usr/bin \
    --with-stroke-library \
    --enable-perllib \
    --enable-xinerama \
    --enable-bidi \
    --enable-nls --enable-iconv \
    --enable-xft
  make
}

package() {
  cd "${srcdir}/fvwm-${pkgver}"
  make DESTDIR="${pkgdir}" install
  install -D -m644 sample.fvwmrc/{decor_examples,DecorMwm,DecorWin95,new-features,system.*} "${pkgdir}/usr/share/doc/fvwm"
  install -D -m644 ../fvwm+.desktop "${pkgdir}/usr/share/xsessions/fvwm+.desktop"
  install -D -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname}/COPYING"
}
md5sums=('090ba4e0c517e8b94f71317951530f69'
         'a12c52729a74355838404ee2f5716e0c'
         '4b68e51fe69d9e6b124deaa0156bca7a'
         '8afc398a1072ef4dd5f9ff258c3bb6fa'
         'b1f104496906aea86d7cfe600ccd8be8'
         'f18a360369fc75994be62f424547c08d'
         'fdb78083da0f0149ce4f32392e58a95e'
         '3196f63023b252a3d1add752df1672a7'
         'a4e89818e29436165e99e49819f48464'
         '24be0e9b84289c2279226eb3a205a9c6'
         'd68c0287f6485aa4cc468a81466123f3'
         '3b4c3c63943c39615d5d1c9143a95763'
         'a8312189b8e5d9d2c294d7cce66fe271'
         '19500b8bdd9dc36909e8f0b7df49cbac'
         'c683c7645d479dfb8bf5ec0b755cbb1e'
         '64ce6e92d9466e40c462431a76232ddc'
         '951bd67053093e8a0c253c2ed8af95aa'
         'c12d238cbefc25bd19879401c327e6fe'
         'd41d8cd98f00b204e9800998ecf8427e'
         '9df3958e5b2e1f3c5ed3721e2f3a5cdd')
