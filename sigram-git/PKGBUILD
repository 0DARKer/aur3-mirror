# Maintainer: totoloco <totoloco@gmx.com>
_pkg=sigram
pkgname="$_pkg-git"
pkgver=r113.3cb43e3
pkgrel=2
pkgdesc="A different telegram client from Sialan.labs"
arch=('i686' 'x86_64')
url="http://labs.sialan.org/projects/sigram"
license=('GPL')
depends=('qt5-base' 'qt5-quickcontrols' 'qt5-declarative' 'qt5-graphicaleffects')
makedepends=('git')
provides=($_pkg)
conflicts=($_pkg)
replaces=($_pkg)
source=("$pkgname"::'git://github.com/sialan-labs/sigram.git' $_pkg $_pkg.desktop)
md5sums=('SKIP'
         '5cb62e592281b61226d461f3f91d7b1f'
         '9fd0f44f76a1711b40ee86339bef30f1')

pkgver() {
  cd "$srcdir/$pkgname"
  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$pkgname-build"
  git clone "$srcdir/$pkgname" "$srcdir/$pkgname-build"
  cd "$srcdir/$pkgname-build"

  #
  # BUILD HERE
  #
  dest="$pkgdir\/usr\/share\/$_pkg"
  sed -i -e "s/\.target = \./.target = build/" \
         -e "/^QT += qml quick dbus widgets sql/a target.path = $dest" \
    SialanTelegram.pro
  qmake SialanTelegram.pro
  make
}

package() {
  cd "$srcdir/$pkgname-build"
  make install
  cp -R build/* "$pkgdir/usr/share/$_pkg"
  install -dm755 "$pkgdir/usr/bin"
  install -m755 "$srcdir/$_pkg" "$pkgdir/usr/bin"
  install -Dm644 "$srcdir/${_pkg}.desktop" "${pkgdir}/usr/share/applications/${_pkg}.desktop"
  install -Dm644 "build/icons/icon.png" "${pkgdir}/usr/share/pixmaps/sigram.png"
}

# vim:set ts=2 sw=2 et:
