# Maintainer: totoloco <totoloco@gmx.com>
_pkg=sigram
pkgname="$_pkg-git"
pkgver=20140609
pkgrel=1
pkgdesc="A different telegram client from Sialan.labs"
arch=('i686' 'x86_64')
url="http://labs.sialan.org/projects/sigram"
license=('GPL')
depends=('qt5-base')
makedepends=('git')
provides=($_pkg)
conflicts=($_pkg)
replaces=($_pkg)
source=($_pkg)
md5sums=('5cb62e592281b61226d461f3f91d7b1f')

_gitroot=https://github.com/sialan-labs/sigram
_gitname="$_pkg-git"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"

  #
  # BUILD HERE
  #
  dest="$pkgdir\/usr\/share\/$_pkg"
  sed -i -e "s/\.target = \./.target = build/" \
         -e "/^QT += qml quick dbus widgets sql/a target.path = $dest" \
    SialanTelegram.pro
  qmake SialanTelegram.pro
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  make install
  cp -R build/* "$pkgdir/usr/share/$_pkg"
  mkdir -p "$pkgdir/usr/bin"
  cp "$srcdir/$_pkg" "$pkgdir/usr/bin"
}

# vim:set ts=2 sw=2 et:
