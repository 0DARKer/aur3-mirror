# Maintainer: Joschka Thurner <mail@joschkathurner.de>
# Contributor: Jan de Groot <jgc@archlinux.org>

pkgname=nautilus-typeahead
pkgver=3.12.2
pkgrel=1
pkgdesc="GNOME file manager with interactive-search patch from Ubuntu"
arch=(i686 x86_64)
license=(GPL)
depends=(libexif gnome-desktop exempi gvfs desktop-file-utils gnome-icon-theme dconf
         libtracker-sparql libnotify nautilus-sendto 'libnautilus-extension=3.12.2')
makedepends=(intltool gobject-introspection python)
conflicts=('nautilus')
provides=('nautilus=3.12.0')
install=nautilus-typeahead.install
groups=(gnome)
url="http://www.gnome.org"
options=('!emptydirs')
source=(http://download.gnome.org/sources/nautilus/${pkgver%.*}/nautilus-$pkgver.tar.xz
        
#source=(http://download.gnome.org/sources/$pkgbase/${pkgver:0:4}/$pkgbase-$pkgver.tar.xz
    interactive_search.patch)
sha256sums=('969c2bedc324eab7b9399bdb3a7db61f819a2995c733349ded081b059a1cafb1'
            '9bce1512772a1fcd266a1b3e696d6189cb1137390842b06dd30809569a129557')


prepare() {
  cd nautilus-$pkgver
  # bug: https://bugs.launchpad.net/ubuntu/+source/nautilus/+bug/1164016
  # source: https://bazaar.launchpad.net/~ubuntu-branches/ubuntu/trusty/nautilus/trusty/files/head:/debian/patches/
  patch -Np1 -i ../interactive_search.patch
}

build() {
  cd nautilus-$pkgver
  ./configure --prefix=/usr --sysconfdir=/etc \
      --localstatedir=/var --disable-static \
      --libexecdir=/usr/lib/nautilus \
      --disable-update-mimedb \
      --disable-packagekit \
      --disable-schemas-compile \
      --without-libnautilus-extension
  make
}

package() {
  cd nautilus-$pkgver
  make DESTDIR="$pkgdir" install

### Remove libnautilus-extension
  rm -r "$pkgdir"/usr/include
  rm -r "$pkgdir"/usr/lib/{girepository-1.0,pkgconfig}
  rm -r "$pkgdir"/usr/lib/libnautilus-extension.so*
  rm -r "$pkgdir"/usr/share/{gir-1.0,gtk-doc}
}
