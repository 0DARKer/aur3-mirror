--- omxplayer.orig/Makefile	2012-06-08 15:13:17.655817888 +0100
+++ omxplayer/Makefile	2012-06-08 16:59:53.635819421 +0100
@@ -1,9 +1,9 @@
 include Makefile.include
 
-CFLAGS+=-DSTANDALONE -D__STDC_CONSTANT_MACROS -D__STDC_LIMIT_MACROS -DTARGET_POSIX -D_LINUX -fPIC -DPIC -D_REENTRANT -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_CMAKE_CONFIG -D__VIDEOCORE4__ -U_FORTIFY_SOURCE -Wall -DHAVE_OMXLIB -DUSE_EXTERNAL_FFMPEG  -DHAVE_LIBAVCODEC_AVCODEC_H -DHAVE_LIBAVUTIL_OPT_H -DHAVE_LIBAVUTIL_MEM_H -DHAVE_LIBAVUTIL_AVUTIL_H -DHAVE_LIBAVFORMAT_AVFORMAT_H -DHAVE_LIBAVFILTER_AVFILTER_H -DOMX -DOMX_SKIP64BIT -ftree-vectorize -pipe -DUSE_EXTERNAL_OMX -DTARGET_RASPBERRY_PI -DUSE_EXTERNAL_LIBBCM_HOST -Wno-psabi -I$(SDKSTAGE)/opt/vc/include/ 
+CFLAGS+=-DSTANDALONE -D__STDC_CONSTANT_MACROS -D__STDC_LIMIT_MACROS -DTARGET_POSIX -D_LINUX -fPIC -DPIC -D_REENTRANT -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -DHAVE_CMAKE_CONFIG -D__VIDEOCORE4__ -U_FORTIFY_SOURCE -Wall -mfpu=vfp -mfloat-abi=softfp -mno-apcs-stack-check -DHAVE_OMXLIB -DUSE_EXTERNAL_FFMPEG -DHAVE_LIBAVCODEC_AVCODEC_H -DHAVE_LIBAVUTIL_MEM_H -DHAVE_LIBAVUTIL_AVUTIL_H -DHAVE_LIBAVFORMAT_AVFORMAT_H -DHAVE_LIBAVFILTER_AVFILTER_H -DOMX -DOMX_SKIP64BIT -ftree-vectorize -pipe -DUSE_EXTERNAL_OMX -DTARGET_RASPBERRY_PI -DHAVE_PLATFORM_RASPBERRY_PI -DUSE_EXTERNAL_LIBBCM_HOST -Wno-psabi -I$(SDKSTAGE)/opt/vc/include/
 
-LDFLAGS+=-L./ -lc -lWFC -lGLESv2 -lEGL -lbcm_host -lopenmaxil -Lffmpeg_compiled/usr/local/lib/
-INCLUDES+=-I./ -Ilinux -Iffmpeg_compiled/usr/local/include/
+LDFLAGS+=-L./ -lc -lWFC -lGLESv2 -lEGL -lbcm_host -lopenmaxil -lpthread -lrt
+INCLUDES+=-I./ -Ilinux
 
 SRC=linux/XMemUtils.cpp \
 		utils/log.cpp \
@@ -39,8 +39,7 @@
 	$(CXX) -O3 -o list_test list_test.cpp
 
 omxplayer.bin: $(OBJS)
-	$(CXX) $(LDFLAGS) -o omxplayer.bin $(OBJS) -lvchiq_arm -lvcos -lrt -lpthread -lavutil -lavcodec -lavformat -lswscale -lpcre
-	#arm-unknown-linux-gnueabi-strip omxplayer.bin
+	$(CXX) $(LDFLAGS) -o omxplayer.bin -Wl,--whole-archive $(OBJS) -Wl,--no-whole-archive -rdynamic -lavutil -lavcodec -lavformat -lswscale -lpcre
 
 clean:
 	for i in $(OBJS); do (if test -e "$$i"; then ( rm $$i ); fi ); done
@@ -50,16 +49,12 @@
 	@rm -f omxplayer-dist.tar.gz
 	make -f Makefile.ffmpeg clean
 
-ffmpeg:
-	@rm -rf ffmpeg
-	make -f Makefile.ffmpeg
-	make -f Makefile.ffmpeg install
-
-dist: omxplayer.bin
-	mkdir -p omxplayer-dist/usr/lib/omxplayer
-	mkdir -p omxplayer-dist/usr/usr/bin
-	mkdir -p omxplayer-dist/usr/share/doc
-	cp omxplayer omxplayer.bin omxplayer-dist/usr/usr/bin
-	cp README COPYING omxplayer-dist/usr/share/doc/
-	cp -a ffmpeg_compiled/usr/local/lib/*.so* omxplayer-dist/usr/lib/omxplayer/
-	tar -czf omxplayer-dist.tar.gz omxplayer-dist
+install:
+	install -d $(DESTDIR)/usr/bin
+	install -d $(DESTDIR)/usr/share/doc/omxplayer
+	install omxplayer $(DESTDIR)/usr/bin/
+	install omxplayer.dist.sh $(DESTDIR)/usr/bin/
+	install omxplayer.bin $(DESTDIR)/usr/bin/
+	install README COPYING $(DESTDIR)/usr/share/doc/omxplayer/
+
+	
--- omxplayer.orig/Makefile.include	2012-06-08 15:13:25.725818553 +0100
+++ omxplayer/Makefile.include	2012-06-08 15:55:36.505818102 +0100
@@ -1,37 +1,36 @@
-USE_BUILDROOT=1
+USE_BUILDROOT=0
 
 ifeq ($(USE_BUILDROOT), 1)
-BUILDROOT	:=/opt/xbmc-bcm/buildroot
+BUILDROOT	:=./
 SDKSTAGE	:=$(BUILDROOT)/output/staging
 TARGETFS	:=$(BUILDROOT)/output/target
 TOOLCHAIN	:=$(BUILDROOT)/output/host/usr/
-HOST			:=arm-unknown-linux-gnueabi
+HOST			:=
 SYSROOT		:=$(BUILDROOT)/output/host/usr/arm-unknown-linux-gnueabi/sysroot
 else
-BUILDROOT	:=/opt/bcm-rootfs
-SDKSTAGE	:=/opt/bcm-rootfs
-TARGETFS	:=/opt/bcm-rootfs
-TOOLCHAIN	:=/usr/local/bcm-gcc
-HOST			:=bcm2708
-SYSROOT		:=$(TOOLCHAIN)/arm-bcm2708-linux-gnueabi/sys-root
+BUILDROOT	:=
+SDKSTAGE	:=
+TARGETFS	:=
+TOOLCHAIN	:=gcc
+HOST		:=
+SYSROOT		:=
 endif
 
-JOBS=7
+JOBS=1
 
-CFLAGS			:= -isystem$(PREFIX)/include
+CFLAGS			:= 
 CXXFLAGS		:= $(CFLAGS)
 CPPFLAGS		:= $(CFLAGS)
-LDFLAGS			:= -L$(BUILDROOT)/lib
-LD					:= $(TOOLCHAIN)/bin/$(HOST)-ld --sysroot=$(SYSROOT)
-CC					:= $(TOOLCHAIN)/bin/$(HOST)-gcc --sysroot=$(SYSROOT)
-CXX         := $(TOOLCHAIN)/bin/$(HOST)-g++ --sysroot=$(SYSROOT)
-OBJDUMP			:= $(TOOLCHAIN)/bin/$(HOST)-objdump
-RANLIB			:= $(TOOLCHAIN)/bin/$(HOST)-ranlib
-STRIP				:= $(TOOLCHAIN)/bin/$(HOST)-strip
-AR 					:= $(TOOLCHAIN)/bin/$(HOST)-ar
+LDFLAGS			:= 
+LD			:= ld
+CC			:= gcc
+CXX         := g++
+OBJDUMP			:= objdump
+RANLIB			:= ranlib
+STRIP			:= strip
+AR 			:= ar
 CXXCP 			:= $(CXX) -E
-PATH 				:= $(PREFIX)/bin:$(BUILDROOT)/output/host/usr/bin:$(PATH)
 
 CFLAGS			+= -pipe -mfloat-abi=softfp -mcpu=arm1176jzf-s -fomit-frame-pointer -mabi=aapcs-linux -mtune=arm1176jzf-s -mfpu=vfp -Wno-psabi -mno-apcs-stack-check -O3 -mstructure-size-boundary=32 -mno-sched-prolog
 LDFLAGS			+= -L$(SDKSTAGE)/lib -L$(SDKSTAGE)/usr/lib -L$(SDKSTAGE)/opt/vc/lib/
-INCLUDES		+= -isystem$(SDKSTAGE)/staging/usr/include -isystem$(SDKSTAGE)/staging/opt/vc/include -isystem$(SYSROOT)/usr/include -isystem$(SDKSTAGE)/opt/vc/include/interface/vcos/pthreads
+INCLUDES		+= -I/opt/vc/include -I/opt/vc/include/interface/vcos/ -I/opt/vc/include/interface/vcos/pthreads
--- omxplayer.orig/omxplayer	2012-06-08 16:58:58.305816417 +0100
+++ omxplayer/omxplayer	2012-06-08 16:59:07.345818096 +0100
@@ -1,34 +1,8 @@
-#!/bin/sh
+#!/bin/bash
 
-#mount -t nfs -o rsize=32768,wsize=32768,intr 192.168.10.1:/data/video /media
+[ -e /usr/bin/omxplayer.bin ] && OMXPLAYER="/usr/bin/omxplayer.bin" || exit 255
 
-OMXPLAYER="./omxplayer.bin"
-FBSET="/usr/sbin/fbset"
+[ $# = 0 ] &&  exec omxplayer.bin --help || \
+ [ "$1" = '-h' -o $1 = '--help' ] && exec omxplayer.bin --help || \
+   clear ; exec omxplayer.bin "$@"  >/dev/null 2>&1
 
-if [ -e /usr/bin/omxplayer.bin ]; then
-  OMXPLAYER="/usr/bin/omxplayer.bin"
-fi
-
-if [ -e /usr/lib/omxplayer ]; then
-  export LD_LIBRARY_PATH=/opt/vc/lib:/usr/lib/omxplayer:$LD_LIBRARY_PATH 
-else
-  export LD_LIBRARY_PATH=$PWD/ffmpeg_compiled/usr/local/lib:/opt/vc/lib:$LD_LIBRARY_PATH
-fi
-
-XRES=1920
-YRES=1080
-
-XRES=1600
-YRES=900
-
-if [ -e $FBSET ]; then
-  echo 0 >  /sys/class/vtconsole/vtcon1/bind
-  fbset -xres 1 -yres 1
-fi
-
-./omxplayer.bin "$@"
-
-if [ -e $FBSET ]; then
-  fbset -xres ${XRES} -yres ${YRES}
-  echo 1 >  /sys/class/vtconsole/vtcon1/bind
-fi
