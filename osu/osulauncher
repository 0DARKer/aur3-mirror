#!/bin/sh
export WINEARCH=win32
export WINEPREFIX=$HOME/.osu
export WINEDEBUG=-all

function doinstall {
echo "Installing osu!"
echo
echo "Creating wineprefix..."
echo "Do NOT install Mono (press cancel)!"
wine hh || exit 1
echo "Wineprefix created successfully!"
echo "Installing .NET 2.0 and gdi"
if [ -z $(which winetricks) ]
then
echo "Install failed. Please install winetricks."
read
exit 1
fi
winetricks dotnet20sp2 gdiplus || exit 1
echo ".NET 2.0 and gdi instlled successfully!"
echo
echo "Applying some settings..."
winetricks ddr=opengl fontsmooth=rgb sound=alsa
regedit /opt/osu/directsound-latency.reg
echo "All done! Running osu! updater..."
sleep 10
wine /opt/osu/game/osume.exe
}

function doremove {
echo "Removing wineprefix..."
rm -r "$WINEPREFIX"
}


if [ "$1" == "install" ]
then
doinstall
exit 0
fi

if [ "$1" == "remove" ]
then
doremove
exit 0
fi

if [ "$1" == "reinstall" ]
then
doremove
doinstall
exit 0
fi


if [ ! -d "$WINEPREFIX" ]
then
if [ ! -t 0 ]
then
xterm -e "/opt/osu/osulauncher install"
else
doinstall
exit 0
fi
fi

if [ "$1" == "fullscreen" ]
then
RES=$(xrandr | grep +0 | awk '{print $3}' | sed 's/+0+0//')
vblank_mode=0 wine explorer /desktop=osu,$RES /opt/osu/game/osu\!.exe $@
else
vblank_mode=0 wine /opt/osu/game/osu\!.exe $@
fi
