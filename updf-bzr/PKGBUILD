# Maintainer: ValHue <vhuelamo at gmail dot com>

pkgname=updf-bzr
pkgver=17
pkgrel=4
pkgdesc='A tool to write and paint to an existing pdf file. uPdf can insert pages of another pdf, insert new pages, remove and extract pages, rotate pages, paste an image in the existing pdf, and much more.'
arch=('i686' 'x86_64')
url='https://launchpad.net/updf/'
license=('GPL3')
depends=('gtk3' 'python2' 'python2-cairo' 'python2-numpy' 'python2-polib' 'poppler-glib' 'libappindicator3')
makedepends=('bzr')
provides=('uPdf')

_bzrmod="updf"
_bzrtrunk="lp:${_bzrmod}"

build() {
    cd "${srcdir}"
    msg "Connecting to Launchpad server...."

    if [ -d ${_bzrmod} ] ; then
        cd "${_bzrmod}"
        bzr pull -r ${pkgver}
        msg "The local files are updated."
    else
        bzr branch ${_bzrtrunk} -r ${pkgver}
    fi

    msg "Bazaar checkout done or server timeout"
    msg "Starting make..."

    if [ -d ${_bzrmod}-build ] ; then
        rm -rf ${_bzrmod}-build
    fi

    cp -r ${_bzrmod} ${_bzrmod}-build
    cd "${srcdir}/${_bzrmod}-build"
    
    export PYTHON="/usr/bin/python2"
    python2 setup.py build
}

package() {
    cd "${srcdir}/${_bzrmod}-build/build"
    mkdir -p ${pkgdir}/usr/share    
    mv ./locale-langpack ${pkgdir}/usr/share/locale

    cd "${srcdir}/${_bzrmod}-build/data"
    mkdir -p ${pkgdir}/usr/share/applications
    mv updf.desktop ${pkgdir}/usr/share/applications
    rm page_formats.ods
    mkdir -p ${pkgdir}/usr/share/updf
    mv * ${pkgdir}/usr/share/updf

    cd "${srcdir}/${_bzrmod}-build/src"
    sed -i 's|/usr/bin/python$|/usr/bin/python2|' *.py
    mv * ${pkgdir}/usr/share/updf

    cd "${srcdir}/${_bzrmod}-build/bin"
    sed -i 's|#!/usr/bin/python$|#!/usr/bin/python2|' updf 
    mkdir -p ${pkgdir}/usr/bin
    install -m755 updf ${pkgdir}/usr/bin

    cd "${srcdir}"
    rm -rf ${_bzrmod}*
}
