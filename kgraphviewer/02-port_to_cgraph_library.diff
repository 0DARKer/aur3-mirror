diff -rup kgraphviewer-2.1.1/cmake/FindGraphViz.cmake kgraphviewer-2.1.1-new/cmake/FindGraphViz.cmake
--- kgraphviewer-2.1.1/cmake/FindGraphViz.cmake	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/cmake/FindGraphViz.cmake	2014-03-16 10:59:43.305163488 +0100
@@ -29,7 +29,7 @@
 if ( NOT WIN32 )
   
   find_package(PkgConfig)
-  pkg_check_modules( graphviz ${REQUIRED} libgvc libcdt libgraph libpathplan )
+  pkg_check_modules( graphviz ${REQUIRED} libgvc libcdt libcgraph libpathplan )
   if ( graphviz_FOUND )
     set ( graphviz_INCLUDE_DIRECTORIES ${graphviz_INCLUDE_DIRS} )
   endif ( graphviz_FOUND )
@@ -66,7 +66,7 @@ find_library( graphviz_CDT_LIBRARY
     )
 
 find_library( graphviz_GRAPH_LIBRARY
-    NAMES graph
+    NAMES cgraph
     PATHS
     ${graphviz_LIBRARY_DIRS}
     /usr/local/lib64
@@ -162,4 +162,4 @@ include(FindPackageHandleStandardArgs)
 
 # handle the QUIETLY and REQUIRED arguments and set GRAPHVIZ_FOUND to TRUE if 
 # all listed variables are TRUE
-find_package_handle_standard_args(GraphViz DEFAULT_MSG graphviz_LIBRARIES graphviz_INCLUDE_DIRECTORIES)
\ No newline at end of file
+find_package_handle_standard_args(GraphViz DEFAULT_MSG graphviz_LIBRARIES graphviz_INCLUDE_DIRECTORIES)
diff -rup kgraphviewer-2.1.1/src/part/CMakeLists.txt kgraphviewer-2.1.1-new/src/part/CMakeLists.txt
--- kgraphviewer-2.1.1/src/part/CMakeLists.txt	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/CMakeLists.txt	2014-03-16 11:04:23.431259534 +0100
@@ -30,7 +30,7 @@ set( kgraphviewerpart_PART_SRCS kgraphvi
 kde4_add_plugin(kgraphviewerpart ${kgraphviewerpart_PART_SRCS})
 
 add_definitions(-DQT_STL)
-target_link_libraries(kgraphviewerpart ${QT_QTXML_LIBRARY} ${QT_QTSVG_LIBRARY} ${KDE4_KDE3SUPPORT_LIBS} ${KDE4_KHTML_LIBS} ${KDE4_KWALLETCLIENT_LIBS} ${KDE4_KDESU_LIBS} gvc graph pathplan cdt kgraphviewerlib)
+target_link_libraries(kgraphviewerpart ${QT_QTXML_LIBRARY} ${QT_QTSVG_LIBRARY} ${KDE4_KDE3SUPPORT_LIBS} ${KDE4_KHTML_LIBS} ${KDE4_KWALLETCLIENT_LIBS} ${KDE4_KDESU_LIBS} gvc cgraph pathplan cdt kgraphviewerlib)
 
 install( TARGETS kgraphviewerpart DESTINATION ${PLUGIN_INSTALL_DIR})
 
Only in kgraphviewer-2.1.1-new/src/part: CMakeLists.txt.orig
diff -rup kgraphviewer-2.1.1/src/part/dotgraph.cpp kgraphviewer-2.1.1-new/src/part/dotgraph.cpp
--- kgraphviewer-2.1.1/src/part/dotgraph.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/dotgraph.cpp	2014-03-16 11:02:27.529542264 +0100
@@ -407,27 +407,25 @@ void DotGraph::updateWithGraph(graph_t*
     kDebug() << "_ldraw_: element renderOperations size is now " << renderOperations().size();
   }
   
-  Agsym_t *attr = agfstattr(newGraph);
+  Agsym_t *attr = agnxtattr(newGraph, AGRAPH, NULL);
   while(attr)
   {
-    kDebug() << newGraph->name << ":" << attr->name << agxget(newGraph,attr->index);
-    m_attributes[attr->name] = agxget(newGraph,attr->index);
-    attr = agnxtattr(newGraph,attr);
+    kDebug() << agnameof(newGraph) << ":" << attr->name << agxget(newGraph,attr);
+    m_attributes[attr->name] = agxget(newGraph,attr);
+    attr = agnxtattr(newGraph, AGRAPH, attr);
   }
   
   // copy subgraphs
-  for (edge_t* e = agfstout(newGraph->meta_node->graph, newGraph->meta_node); e;
-      e = agnxtout(newGraph->meta_node->graph, e))
+  for (graph_t* sg = agfstsubg(newGraph); sg; sg = agnxtsubg(sg))
   {
-    graph_t* sg = agusergraph(e->head);
-    kDebug() << "subgraph:" << sg->name;
-    if (subgraphs().contains(sg->name))
+    kDebug() << "subgraph:" << agnameof(sg);
+    if (subgraphs().contains(agnameof(sg)))
     {
       kDebug() << "known";
       // ???
       //       nodes()[ngn->name]->setZ(ngn->z());
-      subgraphs()[sg->name]->updateWithSubgraph(sg);
-      if (subgraphs()[sg->name]->canvasElement()!=0)
+      subgraphs()[agnameof(sg)]->updateWithSubgraph(sg);
+      if (subgraphs()[agnameof(sg)]->canvasElement()!=0)
       {
         //         nodes()[ngn->id()]->canvasElement()->setGh(m_height);
       }
@@ -437,7 +435,7 @@ void DotGraph::updateWithGraph(graph_t*
       kDebug() << "new";
       GraphSubgraph* newsg = new GraphSubgraph(sg);
       //       kDebug() << "new created";
-      subgraphs().insert(sg->name, newsg);
+      subgraphs().insert(agnameof(sg), newsg);
       //       kDebug() << "new inserted";
     }
 
@@ -450,14 +448,14 @@ void DotGraph::updateWithGraph(graph_t*
   while (ngn != NULL)
 //   foreach (GraphNode* ngn, newGraph.nodes())
   {
-    kDebug() << "node " << ngn->name;
-    if (nodes().contains(ngn->name))
+    kDebug() << "node " << agnameof(ngn);
+    if (nodes().contains(agnameof(ngn)))
     {
       kDebug() << "known";
 // ???
 //       nodes()[ngn->name]->setZ(ngn->z());
-      nodes()[ngn->name]->updateWithNode(ngn);
-      if (nodes()[ngn->name]->canvasElement()!=0)
+      nodes()[agnameof(ngn)]->updateWithNode(ngn);
+      if (nodes()[agnameof(ngn)]->canvasElement()!=0)
       {
         //         nodes()[ngn->id()]->canvasElement()->setGh(m_height);
       }
@@ -467,7 +465,7 @@ void DotGraph::updateWithGraph(graph_t*
       kDebug() << "new";
       GraphNode* newgn = new GraphNode(ngn);
       //       kDebug() << "new created";
-      nodes().insert(ngn->name, newgn);
+      nodes().insert(agnameof(ngn), newgn);
       //       kDebug() << "new inserted";
     }
 
@@ -475,11 +473,11 @@ void DotGraph::updateWithGraph(graph_t*
     edge_t* nge = agfstout(newGraph, ngn);
     while (nge != NULL)
     {
-      kDebug() << "edge " << nge->id;
-      QString edgeName = QString(nge->head->name) + nge->tail->name;
+//      kDebug() << "edge " << nge->id;
+      QString edgeName = QString(agnameof(aghead(nge))) + agnameof(agtail(nge));
       if (edges().contains(edgeName))
       {
-        kDebug() << "edge known" << nge->id;
+//        kDebug() << "edge known" << nge->id;
 //         edges()[nge->name]->setZ(nge->z());
         edges()[edgeName]->updateWithEdge(nge);
         if (edges()[edgeName]->canvasEdge()!=0)
@@ -494,20 +492,20 @@ void DotGraph::updateWithGraph(graph_t*
           GraphEdge* newEdge = new GraphEdge();
           newEdge->setId(edgeName);
           newEdge->updateWithEdge(nge);
-          if (elementNamed(nge->tail->name) == 0)
+          if (elementNamed(agnameof(agtail(nge))) == 0)
           {
             GraphNode* newgn = new GraphNode();
             //       kDebug() << "new created";
-            nodes().insert(nge->tail->name, newgn);
+            nodes().insert(agnameof(agtail(nge)), newgn);
           }
-          newEdge->setFromNode(elementNamed(nge->tail->name));
-          if (elementNamed(nge->head->name) == 0)
+          newEdge->setFromNode(elementNamed(agnameof(agtail(nge))));
+          if (elementNamed(agnameof(aghead(nge))) == 0)
           {
             GraphNode* newgn = new GraphNode();
             //       kDebug() << "new created";
-            nodes().insert(nge->head->name, newgn);
+            nodes().insert(agnameof(aghead(nge)), newgn);
           }
-          newEdge->setToNode(elementNamed(nge->head->name));
+          newEdge->setToNode(elementNamed(agnameof(aghead(nge))));
           edges().insert(edgeName, newEdge);
         }
       }
Only in kgraphviewer-2.1.1-new/src/part: dotgraph.cpp.orig
diff -rup kgraphviewer-2.1.1/src/part/graphedge.cpp kgraphviewer-2.1.1-new/src/part/graphedge.cpp
--- kgraphviewer-2.1.1/src/part/graphedge.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/graphedge.cpp	2014-03-16 11:03:35.095266936 +0100
@@ -137,12 +137,12 @@ void GraphEdge::updateWithEdge(edge_t* e
     parse_renderop(agget(edge, (char*)"_tldraw_"), renderOperations());
     kDebug() << "element renderOperations size is now " << renderOperations().size();
   }
-  Agsym_t *attr = agfstattr(edge);
+  Agsym_t *attr = agnxtattr(agraphof(agtail(edge)), AGEDGE, NULL);
   while(attr)
   {
-    kDebug() /*<< edge->name*/ << ":" << attr->name << agxget(edge,attr->index);
-    m_attributes[attr->name] = agxget(edge,attr->index);
-    attr = agnxtattr(edge,attr);
+    kDebug() /*<< edge->name*/ << ":" << attr->name << agxget(edge,attr);
+    m_attributes[attr->name] = agxget(edge,attr);
+    attr = agnxtattr(agraphof(agtail(edge)), AGEDGE, attr);
   }
   
 }
Only in kgraphviewer-2.1.1-new/src/part: graphedge.cpp.orig
diff -rup kgraphviewer-2.1.1/src/part/graphexporter.cpp kgraphviewer-2.1.1-new/src/part/graphexporter.cpp
--- kgraphviewer-2.1.1/src/part/graphexporter.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/graphexporter.cpp	2014-03-16 10:59:43.305163488 +0100
@@ -118,11 +118,11 @@ QString GraphExporter::writeDot(const Do
 
 graph_t* GraphExporter::exportToGraphviz(const DotGraph* graph)
 {
-  int type = graph->directed()
-      ?(graph->strict()?AGDIGRAPHSTRICT:AGDIGRAPH)
-      :(graph->strict()?AGRAPHSTRICT:AGRAPH);
+  Agdesc_t type = Agstrictundirected;
+  type.directed = graph->directed();
+  type.strict = graph->strict();
   
-  graph_t* agraph = agopen((graph->id()!="\"\"")?graph->id().toUtf8().data():QString("unnamed").toUtf8().data(), type);
+  graph_t* agraph = agopen((graph->id()!="\"\"")?graph->id().toUtf8().data():QString("unnamed").toUtf8().data(), type, NULL);
 
   QTextStream stream;
   graph->exportToGraphviz(agraph);
@@ -134,7 +134,7 @@ graph_t* GraphExporter::exportToGraphviz
   sit != graph->subgraphs().end(); ++sit )
   {
     const GraphSubgraph& s = **sit;
-    graph_t* subgraph = agsubg(agraph, s.id().toUtf8().data());
+    graph_t* subgraph = agsubg(agraph, s.id().toUtf8().data(), 1);
     s.exportToGraphviz(subgraph);
   }
   
@@ -142,7 +142,7 @@ graph_t* GraphExporter::exportToGraphviz
   GraphNodeMap::const_iterator nit;
   foreach (GraphNode* n, graph->nodes())
   {
-    node_t* node = agnode(agraph, n->id().toUtf8().data());
+    node_t* node = agnode(agraph, n->id().toUtf8().data(), 1);
     n->exportToGraphviz(node);
   }
   
@@ -151,8 +151,8 @@ graph_t* GraphExporter::exportToGraphviz
   foreach (GraphEdge* e, graph->edges())
   {
     kDebug() << "writing edge" << e->id();
-    edge_t* edge = agedge(agraph, agnode(agraph, e->fromNode()->id().toUtf8().data()),
-                          agnode(agraph, e->toNode()->id().toUtf8().data()));
+    edge_t* edge = agedge(agraph, agnode(agraph, e->fromNode()->id().toUtf8().data(), 0),
+                          agnode(agraph, e->toNode()->id().toUtf8().data(), 0), NULL, 1);
     e->exportToGraphviz(edge);
   }
   
diff -rup kgraphviewer-2.1.1/src/part/graphnode.cpp kgraphviewer-2.1.1-new/src/part/graphnode.cpp
--- kgraphviewer-2.1.1/src/part/graphnode.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/graphnode.cpp	2014-03-16 10:59:43.308496775 +0100
@@ -78,8 +78,8 @@ void GraphNode::updateWithNode(const Gra
 
 void GraphNode::updateWithNode(node_t* node)
 {
-  kDebug() << node->name;
-  m_attributes["id"] = node->name;
+  kDebug() << agnameof(node);
+  m_attributes["id"] = agnameof(node);
   m_attributes["label"] = ND_label(node)->text;
 
 
@@ -95,12 +95,12 @@ void GraphNode::updateWithNode(node_t* n
     kDebug() << "_ldraw_: element renderOperations size is now " << renderOperations().size();
   }
 
-  Agsym_t *attr = agfstattr(node);
+  Agsym_t *attr = agnxtattr(agraphof(node), AGNODE, NULL);
   while(attr)
   {
-    kDebug() << node->name << ":" << attr->name << agxget(node,attr->index);
-    m_attributes[attr->name] = agxget(node,attr->index);
-    attr = agnxtattr(node,attr);
+    kDebug() << agnameof(node) << ":" << attr->name << agxget(node,attr);
+    m_attributes[attr->name] = agxget(node,attr);
+    attr = agnxtattr(agraphof(node), AGNODE, attr);
   }
 }
 
Only in kgraphviewer-2.1.1-new/src/part: graphnode.cpp.orig
diff -rup kgraphviewer-2.1.1/src/part/graphsubgraph.cpp kgraphviewer-2.1.1-new/src/part/graphsubgraph.cpp
--- kgraphviewer-2.1.1/src/part/graphsubgraph.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/graphsubgraph.cpp	2014-03-16 11:06:14.896371359 +0100
@@ -102,8 +102,8 @@ void GraphSubgraph::updateWithSubgraph(c
 
 void GraphSubgraph::updateWithSubgraph(graph_t* subgraph)
 {
-  kDebug() << subgraph->name;
-  m_attributes["id"] = subgraph->name;
+  kDebug() << agnameof(subgraph);
+  m_attributes["id"] = agnameof(subgraph);
   if (GD_label(subgraph))
     m_attributes["label"] = GD_label(subgraph)->text;
   
@@ -120,27 +120,25 @@ void GraphSubgraph::updateWithSubgraph(g
     kDebug() << "_ldraw_: element renderOperations size is now " << renderOperations().size();
   }
   
-  Agsym_t *attr = agfstattr(subgraph);
+  Agsym_t *attr = agnxtattr(subgraph, AGRAPH, NULL);
   while(attr)
   {
-    kDebug() << subgraph->name << ":" << attr->name << agxget(subgraph,attr->index);
-    m_attributes[attr->name] = agxget(subgraph,attr->index);
-    attr = agnxtattr(subgraph,attr);
+    kDebug() << agnameof(subgraph) << ":" << attr->name << agxget(subgraph,attr);
+    m_attributes[attr->name] = agxget(subgraph,attr);
+    attr = agnxtattr(subgraph, AGRAPH, attr);
   }
 
 
-  for (edge_t* e = agfstout(subgraph->meta_node->graph, subgraph->meta_node); e;
-      e = agnxtout(subgraph->meta_node->graph, e))
+  for (graph_t* sg = agfstsubg(subgraph); sg; sg = agnxtsubg(sg))
   {
-    graph_t* sg = agusergraph(e->head);
-    kDebug() << "subsubgraph:" << sg->name;
-    if ( subgraphs().contains(sg->name))
+    kDebug() << "subsubgraph:" << agnameof(sg);
+    if ( subgraphs().contains(agnameof(sg)))
     {
       kDebug() << "known subsubgraph";
       // ???
       //       nodes()[ngn->name]->setZ(ngn->z());
-      subgraphs()[sg->name]->updateWithSubgraph(sg);
-      if (subgraphs()[sg->name]->canvasElement()!=0)
+      subgraphs()[agnameof(sg)]->updateWithSubgraph(sg);
+      if (subgraphs()[agnameof(sg)]->canvasElement()!=0)
       {
         //         nodes()[ngn->id()]->canvasElement()->setGh(m_height);
       }
@@ -150,7 +148,7 @@ void GraphSubgraph::updateWithSubgraph(g
       kDebug() << "new subsubgraph";
       GraphSubgraph* newsg = new GraphSubgraph(sg);
       //       kDebug() << "new created";
-      subgraphs().insert(sg->name, newsg);
+      subgraphs().insert(agnameof(sg), newsg);
       //       kDebug() << "new inserted";
     }
     
Only in kgraphviewer-2.1.1-new/src/part: graphsubgraph.cpp.orig
diff -rup kgraphviewer-2.1.1/src/part/loadagraphthread.cpp kgraphviewer-2.1.1-new/src/part/loadagraphthread.cpp
--- kgraphviewer-2.1.1/src/part/loadagraphthread.cpp	2010-11-12 09:07:15.000000000 +0100
+++ kgraphviewer-2.1.1-new/src/part/loadagraphthread.cpp	2014-03-16 10:59:43.308496775 +0100
@@ -28,7 +28,7 @@ void LoadAGraphThread::run()
   FILE* fp;
   gvc = gvContext();
   fp = fopen(m_dotFileName.toUtf8().data(), "r");
-  m_g = agread(fp);
+  m_g = agread(fp, NULL);
 }
 
 void LoadAGraphThread::loadFile(const QString& dotFileName)
