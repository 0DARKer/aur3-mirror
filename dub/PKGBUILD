# Maintainer: Moritz Maxeiner <moritz@ucworks.org>

pkgname=dub
pkgver=0.9.11
pkgrel=1
pkgdesc="Package manager for D packages"
arch=('i686' 'x86_64')
url="https://github.com/rejectedsoftware/dub"
license=('MIT')
depends=('dmd' 'curl')
makedepends=('git')
optdepends=()
source=()
conflicts=('dub-git')
md5sums=()

__gitroot=https://github.com/rejectedsoftware/dub.git
__gitname=dub

build() {
  cd "$srcdir"

  if [[ ! -d "$__gitname" ]]; then
    msg "Connecting to GIT server..."
    git clone "$__gitroot" "$__gitname"
    cd "$__gitname"
    git checkout v${pkgver}
    msg "GIT checkout done or server timeout"
    msg "Starting build..."
  fi

  cd "${srcdir}/${__gitname}"
  ./build.sh
}

package() {
  cd "${srcdir}/${__gitname}"
  install -D -m755 dub "${pkgdir}/usr/bin/dub"
  install -D -m644 LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt"
}
