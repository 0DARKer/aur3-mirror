#contributor: tantalum@online.de
pkgname=mdb-git
pkgver=1
pkgrel=1
pkgdesc='OpenLDAP Lightning Memory-Mapped Database (MDB)'
arch=(any)
license=(custom)
makedepends=(git)
depends=()
url=http://symas.com/mdb/

_giturl="git://git.openldap.org/openldap.git"

git_prepare () {
  giturl=$1
  cd $srcdir
  msg "Connecting to git server"
  if [[ -d openldap ]] ; then
    cd openldap && git pull
  else
    git clone $giturl
    cd openldap
  fi
  msg "Git clone done"
  git checkout mdb.master
}

build() {
  msg "The relevant sourcecode is part of openldap and the whole repository must be cloned"
  git_prepare $_giturl
  echo $PWD
  cd libraries/liblmdb
  make
}

package() {
  cd openldap/libraries/liblmdb
  #make with DESTDIR doesn't work, so we install manually
  mkdir -p ${pkgdir}/usr/{bin,lib,include}
  cp mdb_stat mdb_copy ${pkgdir}/usr/bin
  cp liblmdb.a liblmdb.so ${pkgdir}/usr/lib
  cp lmdb.h ${pkgdir}/usr/include
}
