# Maintainer: BxS <bxsbxs at gmail dot com>

pkgname=microchip-mplabxc8-bin
pkgver=1.01
pkgrel=2
pkgdesc="C compiler for PIC10 PIC12 PIC16 PIC18 MCUs"
arch=(i686 x86_64)
url=http://www.microchip.com/xc8
license=(custom)
[ $CARCH = x86_64 ] && depends=(lib32-glibc)
makedepends=(xclm-dirs)
provides=(mplabxc8)
conflicts=(mplabxc8)
options=(!strip docs libtool emptydirs !zipman)
install=$pkgname.install
instdir=/opt/microchip/xc8/v$pkgver
installer=xc8_v1_01_linux.run
source=(http://ww1.microchip.com/downloads/xc8/$installer)
md5sums=(0d723c0e100b48885e961a95884fba23)

package() {
  echo -e "Creating the Package\n  Please wait..."

  cd $pkgdir

  mkdir -p $pkgdir$instdir

  chmod 0755 $srcdir/$installer
  echo -e "i\ni\n\n\n\n\n\n\n\n\n\n\ny\n1\n1\n\ny\n1\n$pkgdir$instdir\nn\ny\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\ni\nn" > inst_input
  mkdir -p $pkgdir/home
  HOME=$pkgdir/home $srcdir/$installer --mode text < inst_input &> /dev/null
  rm inst_input
  rm -r $pkgdir/home

  rm $pkgdir$instdir/Uninstall*
  rm -r $pkgdir$instdir/rollbackBackupDirectory || true

  sed -i "s|/opt/microchip/xclm/bin|$instdir/bin|g" $pkgdir$instdir/bin/license.conf
  echo -e "#!/bin/sh\nexit 0" > $pkgdir$instdir/bin/xclm
  chmod 0755 $pkgdir$instdir/bin/xclm

  rm -r $pkgdir$instdir/license
  mkdir -p $pkgdir/usr/share/licenses/$pkgname
  ln -s $instdir/docs/licence.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE
} 
