#maintainer: kuno <neokuno AT gmail DOT com>

pkgname=clojurescript-git
_realname=clojurescript
pkgver=20120127
pkgrel=1
pkgdesc="Clojure to JS compiler, git version"
arch=('i686' 'x86_64')
url="https://github.com/clojure/clojurescript"
license=('EPL')
groups=()
depends=('java-runtime')
makedepends=('git' 'unzip' 'curl')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=$pkgname.install
source=(clojurescript.sh)
noextract=()
#md5sums=() #generate with 'makepkg -g'
_gitroot="git://github.com/clojure/clojurescript.git"
_gitname=$_realname       

build() {
  cd $srcdir

  if [ -d $_gitname-build ]; then
     rm -rf $_gitname-build
  fi

  msg "Connecting to the github...."
  if [ ! -d $_gitname/.git ]; then
    git clone $_gitroot $_gitname
  else
    cd $_gitname
    git pull $_gitroot
  fi

  cp -r $_gitname $srcdir/$_gitname-build
  cd $_gitname-build/

  msg "Building clojurescript...."
  ./script/bootstrap
}

package() {
  mkdir -p $pkgdir/etc/profile.d
  mkdir -p $pkgdir/opt/$_realname/bin
  mkdir -p $pkgdir/usr/share/licenses/$_realname

  cp $srcdir/$_gitname-build/bin/cljsc $pkgdir/opt/$_realname/bin/ || return 1
  cp $srcdir/$_gitname-build/script/repljs $pkgdir/opt/$_realname/bin/cljs || return 1
  cp -r $srcdir/$_gitname-build/{lib,src,test,script} $pkgdir/opt/$_realname/ || return 1

  cp $_realname.sh $pkgdir/etc/profile.d || return 1
  install -Dm644 $srcdir/$_gitname-build/epl-v10.html $pkgdir/usr/share/licenses/$_realname/

  rm -rf $srcdir/$_gitname-build
}
md5sums=('2265f31dcd3e5dad7ddd59a28b998bfb')
