# Maintainer: Christian Hesse <mail@eworm.de>

pkgname=remmina-git
pkgver=20120118
pkgrel=1
pkgdesc="Remmina remote desktop client written in GTK+ - git checkout "
arch=(i686 x86_64)
url="http://remmina.sourceforge.net/"
license=('GPL')
provides=(remmina)
conflicts=(remmina)
depends=(gtk3 telepathy-glib zlib libjpeg avahi vte libssh libgcrypt libunique libappindicator3)
makedepends=(git cmake intltool pkgconfig gettext libxdmcp)
optdepends=('remmina-plugins-git: Plugins for remmina, including xdmcp vnc telepathy rdp and nx')
install=remmina.install

_gitroot="https://github.com/FreeRDP/Remmina"
_gitname="remmina"

build() {
	cd "${srcdir}"
	msg "Connecting to GIT server...."

	if [ -d ${_gitname} ]; then
		cd ${_gitname} && git pull origin
		msg "The local files are updated."
	else
		git clone ${_gitroot} ${_gitname}
	fi
	msg "GIT checkout done or server timeout"

	msg "Cloning to build directory"
	rm -rf "${srcdir}/${_gitname}-build"
	git clone "${srcdir}/${_gitname}" "${srcdir}/${_gitname}-build"

	msg "Starting make..."
	cd "${srcdir}/${_gitname}-build/"

	cmake ./ -DCMAKE_INSTALL_PREFIX=/usr
	cd "remmina/"

	# What the hack?!
	# This is needed since binutils use the gold linker... Is there a proper fix?
	sed -i '/^\/usr\/bin\/gcc/s/$/ -lX11 -lgdk_pixbuf-2.0 -lgio-2.0 -lgobject-2.0 -lgmodule-2.0 -lavahi-client -lavahi-common -lgthread-2.0/' CMakeFiles/remmina.dir/link.txt

	make
	make DESTDIR=${pkgdir} install
}
md5sums=()
