#Actual maintainer: Konstantin Plotnikov <kostyapl at gmail dot com>

pkgname=fossil
pkgver=20120317175325
pkgrel=2
pkgdesc="Simple, high-reliability, distributed software configuration management"
arch=('i686' 'x86_64')
license=('BSD')
url="http://www.fossil-scm.org/"
depends=('openssl')

source=(
    "http://www.fossil-scm.org/download/fossil-src-${pkgver}.tar.gz"
    "fossil-xinetd"
)

md5sums=(
    "a7106450722e8477972d230fa535702f"
    "62f6fb3739191b352c3e2995ced9be4e"
)

package() {
	cd ${pkgname}-src-${pkgver}
	
	./configure --prefix=/usr
	
	# headers and translate targets are problematic with parallel jobs
	make -j1 bld bld/headers

	# build fossil
	make

	# install fossil
	install -Dm755 ${pkgname} \
		${pkgdir}/usr/bin/${pkgname}

    # install license
	install -Dm644 COPYRIGHT-BSD2.txt \
		${pkgdir}/usr/share/licenses/${pkgname}/LICENSE

	# install xinetd script
    install -Dm644 $srcdir/fossil-xinetd $pkgdir/etc/xinetd.d/fossil

    # create symlink "/usr/bin/fsl" pointing to "/usr/bin/fossil"
    cd ${pkgdir}/usr/bin && ln -s ${pkgname} fsl
} 
