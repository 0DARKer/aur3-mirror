# Contributor: Christoph Zeiler <archNOSPAM_at_moonblade.dot.org>
# Contributor: Zarra <zarraxx@gmail.com>
# Contributor: Nathan Owe ndowens04 at gmail
pkgname=dbus-c++-git
pkgver=20090520
pkgrel=1
pkgdesc="A C++ API for D-BUS"
arch=('i686' 'x86_64')
url="http://freedesktop.org/wiki/Software/dbus-c++/"
license=('GPL')
depends=('dbus-core>=1.2')
makedepends=('git' 'autoconf' 'automake')
provides=('dbus-c++')
conflicts=('dbus-c++')
options=('!libtool')

_gitroot="git://anongit.freedesktop.org/git/dbus/dbus-c++"
_gitname="dbus-c++"

build() {
  msg "Connecting to GIT server..."

  [ -d $_gitname ] && {
	cd $_gitname
	git pull origin
	cd ..

	msg "Local files have been updated."
  } || {
	git clone $_gitroot
  }

  msg "GIT checkout done or server timeout"

  rm -rf $_gitname-build
  git clone $_gitname $_gitname-build
  cd $_gitname-build

  sed '1i#include <cstdio>' -i examples/echo/echo-client.cpp

  ./autogen.sh --prefix=/usr

  msg "Starting make..."

  make || return 1
  make DESTDIR=$pkgdir install
}
