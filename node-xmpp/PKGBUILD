# Packager: Emmanuel Gil Peyrot <linkmauve@linkmauve.fr>
# Packager: Sonny Piers <sonny@fastmail.net>

pkgname=node-xmpp
pkgver=0.2.9
pkgrel=2
pkgdesc='Idiomatic XMPP client, component & server library for node.js'
arch=(i686 x86_64)
url="http://github.com/astro/node-xmpp"
license="GPLv3"
depends=("nodejs>=0.4.0" "node-expat>=1.2.0" "ltx>=0.0.4")
optdepends=('node-stringprep: for icu-based string normalization.')
source=("https://download.github.com/astro-node-xmpp-v0.2.9-0-g6de7f88.tar.gz")
md5sums=('cba43c9d932ed00a2de72da85ba2a7cd')

build() {
	cd $srcdir/astro-node-xmpp-6de7f88

	mkdir -p $pkgdir/usr/lib/node/$pkgname
	cp -r lib/* $pkgdir/usr/lib/node/$pkgname

	echo "#!/usr/bin/env node
	module.exports = require('./node-xmpp/xmpp');" > $pkgdir/usr/lib/node/node-xmpp.js

	sed -i "s,\.\./lib/,," examples/*.js
	mkdir -p $pkgdir/usr/share/$pkgname/examples/
	cp -r examples/* $pkgdir/usr/share/$pkgname/examples/

	mkdir -p $pkgdir/usr/share/$pkgname/
	install -Dm0644 README.markdown $pkgdir/usr/share/$pkgname/README.markdown
}
