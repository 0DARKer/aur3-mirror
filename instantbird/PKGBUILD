# Contributor: Connor Behan <connor.behan@gmail.com>

pkgname=instantbird
pkgver=0.2
pkgrel=2
pkgdesc="Instant messenger using libpurple and xulrunner"
arch=(i686 x86_64)
license=('MPL' 'GPL' 'LGPL')
url="http://instantbird.com"
depends=('xulrunner')
makedepends=('autoconf2.13' 'pkgconfig' 'python2' 'zip' 'libnotify')
source=(http://instantbird.com/downloads/${pkgver}/${pkgname}-${pkgver}.src.tgz nss.patch python2.7.patch  mozconfig)
_xulnum=`ls /usr/lib | grep -m1 xulrunner-devel | sed -e 's/.*-//'`

build() {
	cd ${srcdir}/${pkgname}-${pkgver}-src
	cp ${srcdir}/mozconfig .
	patch -Np1 -i ../python2.7.patch || return 1
	patch -Np1 -i ../nss.patch || return 1
	echo "ac_add_options --with-libxul-sdk=/usr/lib/xulrunner-devel-"${_xulnum} >> mozconfig
	sed -i -e 's|\$LIBXUL_SDK/sdk|\$LIBXUL_SDK|g' configure.in
	
	autoconf-2.13 || return 1
	make -j1 -f client.mk build || return 1
	cd ../obj-instantbird
	make package || return 1
	
	cd mozilla/dist
	bsdtar -x -f ${pkgname}-${pkgver}.en-US.linux-${CARCH}.tar.bz2
	mkdir ${pkgdir}/usr
	mkdir ${pkgdir}/usr/bin
	mkdir ${pkgdir}/usr/lib
	cp -R ./instantbird ${pkgdir}/usr/lib/instantbird
	cd ${pkgdir}/usr/bin
	ln -s /usr/lib/instantbird/instantbird instantbird
}
md5sums=('94d985bf4c22aeccfd0e61911fb5f7b4' 'aaebf48b1ae8ac984e49909d8d093d8b' 'a1fd5a52f1b6b46f51325b02bcf68386' '6aaa7fbc7276a552196a7e06acb0c5e8')
