# Contributor: Xavion <Xavion (dot) 0 (at) Gmail (dot) com>
# Contributor: Michael Witten <mfwitten>

_langname_=flash
_appname_=${_langname_}player
_basename_=${_langname_}plugin
_ver1_=10
_ver2_=3
_ver3_=183
_ver4_=48
pkgname=${_basename_}-${_ver1_}
pkgver=${_ver1_}.${_ver2_}.${_ver3_}.${_ver4_}
pkgrel=1
pkgdesc="Adobe Flash Player v10 (32-bit) - with GPU hardware acceleration"
arch=("i686" "x86_64")
url="http://kb2.adobe.com/cps/142/tn_14266.html#main_Archived_versions"
license=("custom")
if [ "${CARCH}" == "i686" ]; then
	depends=("mozilla-common" "hicolor-icon-theme" "libxt" "gtk2" "nss" "curl" "alsa-lib")
	optdepends=("libvdpau: video hardware decoding for supporting players")
elif [ "${CARCH}" == "x86_64" ]; then
	depends=("mozilla-common" "hicolor-icon-theme" "lib32-libxt" "lib32-gtk2" "lib32-nss" "lib32-curl" "lib32-alsa-lib")
	optdepends=("lib32-libvdpau: video hardware decoding for supporting players"
				"nspluginwrapper: make this plugin work with 64-bit browsers"
				"firefox32: 32-bit Firefox for 64-bit systems")
fi
provides=("${_basename_}=${pkgver}")
conflicts=("${_basename_}")
options=(!strip)
install="${pkgname}.install"
backup=("etc/adobe/mms.cfg")
archive="fp_${pkgver}_archive.zip"
source=("http://fpdownload.macromedia.com/get/${_appname_}/installers/archive/${archive}")

package() {
	cd "${srcdir}"

	# Variables
	local dirver1 dirver2 dirver3 directory tarball licfile;
	dirver1=${_ver1_}.${_ver2_}.r${_ver3_}.${_ver4_}
	dirver2=${_ver1_}_${_ver2_}_r${_ver3_}_${_ver4_}
	dirver3=${_ver1_}_${_ver2_}r${_ver3_}_${_ver4_}
	#directory="${archive%.*}"
	directory="fp_${dirver1}_archive"
	tarball=${directory}/${dirver2}/${_appname_}_${dirver3}_linux_sa.tar.gz
	licfile=${directory}/redme.txt

	# Directories
	install -d -m755 "${pkgdir}/usr/lib/mozilla/plugins"
	install -d -m755 "${pkgdir}/usr/share/licenses/${pkgname}"
	install -d -m755 "${pkgdir}/etc/adobe"

	# Files
	unzip -p "${archive}" "${tarball}" | tar -zx -C "${pkgdir}/usr/lib/mozilla/plugins" lib${_appname_}.so
	unzip -p "${archive}" "${licfile}" > "${pkgdir}/usr/share/licenses/${pkgname}/readme.txt"
	install -Dm644 "${startdir}/mms.cfg" "${pkgdir}/etc/adobe/mms.cfg"
}

sha1sums=('b29e0d7a69ef77ad9f6db736e2239a174807ce19')
