# Contributor: Alexis Robert <alexis.robert@gmail.com>
pkgname=repo-git
pkgver=20101023
pkgrel=1
pkgdesc="The Multiple Git Repository Tool from the Android Open Source Project"
arch=(i686 x86_64)
url="http://source.android.com/source/git-repo.html"
license=('APACHE')
depends=('git' 'python2')
makedepends=('git')
#source=($pkgname-$pkgver.tar.gz)
#noextract=()
#md5sums=() #generate with 'makepkg -g'

_gitroot="git://android.git.kernel.org/tools/repo.git"
_gitbranch="stable"
_gitname="repo"

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone -b $_gitbranch $_gitroot $_gitname
  fi

  msg "Patching for Python2 ..."
  sed -i 's/"""exec" python -E/"""exec" python2 -E/' $srcdir/repo/repo 
}

package() {
  mkdir -p $pkgdir/usr/bin/ || return 1
  install -oroot -groot -m0755 $srcdir/$_gitname/repo $pkgdir/usr/bin/repo
} 
