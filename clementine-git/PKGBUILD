# Mantainer: Adria Arrufat <swiftscythe@gmail.com>
# Contributor: Ike Devolder <ike.devolder@gmail.com>
# Contributor: Daniel Hill <daniel.hill@orcon.net.nz>

pkgname=clementine-git
_realname=clementine-player
pkgver=20111116
pkgrel=1
pkgdesc="A modern music player and library organiser and a port of Amarok 1.4, with some features rewritten to take advantage of Qt4."
arch=('i686' 'x86_64')
url="http://code.google.com/p/clementine-player/"
license=('GPL')
depends=('gstreamer0.10-base' 'taglib' 'glew' 'liblastfm' 'libgpod' 'libmtp' 'libplist' 'hicolor-icon-theme' 'qt' 'libimobiledevice' 'libspotify' 'python2-pyqt' 'qjson' 'protobuf')
optdepends=('gstreamer0.10-base-plugins: for more open formats'
            'gstreamer0.10-good-plugins: for use with "Good" plugin libraries'
            'gstreamer0.10-bad-plugins: for use with "Bad" plugin libraries'
            'gstreamer0.10-ugly-plugins: for use with "Ugly" plugin libraries')
makedepends=('git' 'boost' 'cmake' 'mesa')
provides=('clementine')
conflicts=('clementine' 'clementine-svn')
replaces=('clementine' 'clementine-svn')
source=()
md5sums=()

_gitroot="https://code.google.com/p/${_realname}"
_gitname=${_realname}

build() {
    if [ -d ${_gitname} ]; then
        cd ${_gitname} && git pull origin
        msg "The local files are updated."
    else
        git clone ${_gitroot}
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    rm -rf ${srcdir}/build
    git clone ${srcdir}/${_gitname} ${srcdir}/build

    cd ${srcdir}/build

    cmake . -DCMAKE_INSTALL_PREFIX=/usr \
            -DBUILDBOT_REVISION=$pkgver
    make 
}

package() {
    cd ${srcdir}/build
    make DESTDIR=${pkgdir} install
    # FIXME: Delete strange installed files
    cd ${$pkgdir}
    rm -rf $(ls | grep -v usr)
}
