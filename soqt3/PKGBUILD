# Contributor: marcus fritzsch <fritschy@googlemail.com>

pkgname=soqt3
pkgver=1.4.1
pkgrel=1
pkgdesc="SoQt is a library which provides the glue between Coin and Qt."
url="http://www.coin3d.org/lib/soqt/"
license="GPL"
depends=('coin' 'qt' 'libxmu')
makedepends=('gcc' 'doxygen' 'coin')
provides=('soqt')
conflicts=('soqt')
replaces=('soqt')
backup=()
options=('NOLIBTOOL')
install=
source=("http://ftp.coin3d.org/coin/src/all/SoQt-$pkgver.tar.gz")
md5sums=('6dddafb755e9afb9924da1d46f3cd0d4')

build() {
  cd $startdir/src

  export CXXFLAGS="-O3 -march=i686 -funroll-loops -fomit-frame-pointer -pipe"
  export CFLAGS="$CXXFLAGS"

  mkdir build
  cd build
  ../SoQt-$pkgver/configure --prefix=/usr --enable-optimization \
    --enable-threadsafe --enable-html --enable-man --enable-exceptions \
    --disable-debug --disable-maintainer-mode --disable-dependency-tracking \
    --enable-shared --disable-static

  make DESTDIR=$startdir/pkg install || return 1

  cd $startdir/pkg/usr/man/man3
  rm _*
  for i in *.3; do
    awk '{ if (NR==1) sub(" 3 ", " 3qt "); print }' < $i > ${i%3}3qt || return 1
    rm $i || return 1
  done

  unset CFLAGS CXXFLAGS
}

