# Maintainer: Spyhawk

pkgname=etlegacy
pkgver=2.71rc1
pkgrel=1
pkgdesc="Fully compatible client and server for the popular online FPS game Wolfenstein: Enemy Territory"
arch=('i686' 'x86_64')
url="http://www.etlegacy.com/"
license=('GPL3')
depends=('enemy-territory-data')
[[ "$CARCH" == "i686" ]] && depends+=('sdl' 'libjpeg' 'glu' 'libsm' 'curl' 'libvorbis' 'gcc-libs')
[[ "$CARCH" == "x86_64" ]] && depends+=('lib32-sdl' 'lib32-libjpeg' 'lib32-glu' 'lib32-libsm' 'lib32-curl' 'lib32-libvorbis' 'lib32-gcc-libs')
optdepends=('lua')
provides=('enemy-territory')
conflicts=('enemy-territory')
source=("http://mirror.etlegacy.com/$pkgname-linux-$pkgver.tar.gz"
        "$pkgname.desktop"
        "etl.sh"
        "etlded.sh")
md5sums=('9547660cb362e9708e2f27287167abca'
         '45bda68831d751c7fed587a6e3fd9de8'
         'cc5e8e5e028ab6899eb5d82c15200c75'
         '7341dd2600920aec0f988faefb51f75e')

package() {
    # create destination directories
    mkdir -p $pkgdir/usr/bin
    mkdir -p $pkgdir/usr/share/enemy-territory/{etmain,legacy}

    # extract
    tar -zxvf $pkgname-linux-$pkgver.tar.gz

    # bypass hardcoded fs_basepath (./) to /usr/share/enemy-territory
    sed -i -e "s/.\/legacy\/omni-bot/\/usr\/share\/enemy-territory\/legacy\/omni-bot/" $pkgname-linux-$pkgver/{etl_bot.sh,etlded_bot.sh}
    install -Dm 755 {etl.sh,etlded.sh} $pkgdir/usr/bin/
    # install files
    install -Dm 755 $pkgname-linux-$pkgver/{etl,etl_bot.sh,etlded,etlded_bot.sh} $pkgdir/usr/bin/
    install -Dm 644 $pkgname-linux-$pkgver/etmain/* $pkgdir/usr/share/enemy-territory/etmain/
    mv $pkgname-linux-$pkgver/legacy/ $pkgdir/usr/share/enemy-territory/

    # install doc
    mkdir -p $pkgdir/usr/share/doc/etlegacy
    install -Dm 644 $pkgname-linux-$pkgver/README.md $pkgdir/usr/share/doc/etlegacy/

    # install desktop file and icon
    install -Dm 644 $pkgname-linux-$pkgver/ETL.xpm $pkgdir/usr/share/pixmaps/$pkgname.xpm
    install -Dm 644 $pkgname.desktop $pkgdir/usr/share/applications/$pkgname.desktop
}

