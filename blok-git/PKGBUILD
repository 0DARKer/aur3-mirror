# Contributor: Harley Laue <losinggeneration@gmail.com>

pkgname=blok-git
pkgver=20100420
pkgrel=1
pkgdesc="The first game using KDE4/Gluon."
arch=('i686' 'x86_64')
url="http://gluon.tuxfamily.org/"
license=('GPL')
depends=('gluon-git')
makedepends=('git' 'eigen')
provides=('blok')
conflicts=('blok')
install=blok.install
source=('blok-cmake-libraries-kdebug.patch' 'blok.install')

_gitroot="git://gitorious.org/gluon/block.git"
_gitname="blok"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."

  if [ -d $_gitname ] ; then
    # make sure our patch gets reset
    cd ${_gitname} && git reset --hard && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi
  msg "GIT checkout done or server timeout"

  cd ${srcdir}/${_gitname} && patch -p1 -t -i ${startdir}/blok-cmake-libraries-kdebug.patch || return 1
  cd ${srcdir}

  msg "Starting make..."

  [ -d "${srcdir}/${_gitname}-build" ] && rm -rf ${srcdir}/${_gitname}-build"
  mkdir ${srcdir}/${_gitname}-build"
  cd $srcdir/$_gitname-build

  cmake -DCMAKE_INSTALL_PREFIX=/usr ${srcdir}/${_gitname} || return 1
  make || return 1
  make DESTDIR=${pkgdir} install
}

md5sums=('6cc7a46ed8a89c39f9f73478b9a9ba93'
         '347d94494ab0e27c7dd16c3f7f965a9d')
