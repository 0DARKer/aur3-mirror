# Copyright 1999-2009 Gentoo Foundation
# Distributed under the terms of the GNU General Public License v2
# $Header: /var/cvsroot/gentoo-x86/media-gfx/dawn/dawn-3.88a.ebuild,v 1.7 2009/05/05 19:45:23 fauli Exp $

pkgname=dawn
pkgver=3_88a
pkgrel=1
pkgdesc="3D geometrical postscript renderer"
url="http://geant4.kek.jp/~tanaka/DAWN/About_DAWN.html"
license="public-domain"
arch=(i686 x86_64)

depend=(tk libx11 tcsh texlive-core)

source=("http://geant4.kek.jp/~tanaka/src/${pkgname}_$pkgver.taz" dawn-3.88a-no-interactive.patch)


build () {
	cd $srcdir/${pkgname}_${pkgver}
	
	###打补丁及预处理
	patch -Np0 -i ../dawn-3.88a-no-interactive.patch
	sed -i -e '/strip/d' Makefile*in || die "sed Makefile failed"
	
	###开始编译
	make clean && make guiclean
	./configure
	
	echo "Compiling"
	make
	
	####安装部分
	INSTALLDIR=/usr/bin
	[ -d $pkgdir$INSTALLDIR ] || mkdir -p $pkgdir$INSTALLDIR
	make DESTDIR=$pkgdir install || die "make install failed"
		
	DOCDIR=/usr/share/doc/dawn
	[ -d $pkgdir$DOCDIR ] || mkdir -p $pkgdir$DOCDIR
	
	pdflatex DOC/G4PRIM_FORMAT_24.tex || die "pdf generation failed"
	cp DOC/*.pdf   $pkgdir$DOCDIR/
	cp DOC/*.html  $pkgdir$DOCDIR/
}
 
