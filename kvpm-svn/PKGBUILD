# Maintainer: laloch <laloch@atlas.cz>
pkgname=kvpm-svn
_pkgname=kvpm
pkgver=582
pkgrel=1
pkgdesc='KDE4 front end for Linux LVM and Gnu parted'
url='http://kvpm.sourceforge.net'
arch=('i686' 'x86_64')
license=('GPL3')
depends=('kdebase-runtime')
makedepends=('cmake' 'automoc4' 'subversion')
conflicts=('kvpm')
provides=('kvpm')
source=()
md5sums=()
install=${pkgname}.install

_svntrunk='https://kvpm.svn.sourceforge.net/svnroot/kvpm/trunk'
_svnmod='kvpm'

build() {
  cd ${srcdir}

  if [ -d ${_svnmod} ]; then
    svn up -r ${pkgver}
  else
    svn co ${_svntrunk} -r ${pkgver} .
  fi
  msg2 'SVN checkout done or server timeout'

  msg2 'Starting make...'
  if [ -d build ]; then
    msg2 'Clean previous build directory'
    rm -rf build
  fi
  mkdir build
  cd build
  cmake ${srcdir}/${_svnmod} \
    -DCMAKE_INSTALL_PREFIX=`kde4-config --prefix` \
    -DCMAKE_BUILD_TYPE=Release
  make
  echo "[Desktop Entry]
GenericName=LVM Frontend
Name=KVPM
Comment=KDE Volume Partition Manager
Exec=kdesu kvpm
Icon=kvpm
X-KDE-SubstituteUID=true
Type=Application
Categories=System;KDE;" > ${_pkgname}.desktop
}

package() {
  cd ${srcdir}/build
  make DESTDIR=${pkgdir} install
  cd ${srcdir}
  for size in 16 32 64; do
    install -Dm 644 kvpm_${size}x${size}.png ${pkgdir}/usr/share/icons/hicolor/${size}x${size}/apps/${_pkgname}.png
  done
  install -Dm 644 build/${_pkgname}.desktop ${pkgdir}/usr/share/applications/${_pkgname}.desktop
}
