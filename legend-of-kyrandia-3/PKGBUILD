# Contributor: Jens Staal <staal1978@gmail.com>

pkgname="legend-of-kyrandia-3"
pkgver="3.0"
pkgrel=1
pkgdesc="A classic adventure game from Abandonia, played in DosBox."
url='http://www.abandonia.com/en/games/289/Legend+of+Kyrandia+3+-+Malcolms+Revenge%2C+The.html'
arch=('any')
license=('custom-freeware' 'Abandonware')
install='kyrandia3.install'
depends=('dosbox')
source=('http://files.abandonia.com/download.php?game=Legend+of+Kyrandia+3+-+Malcolms+Revenge%2C+The&secure=a273a3468ff31ae8f7ca147289a6aa52&td=1297787834' 'start.bat')
md5sums=('afbcd76f02fe6cc5899369b9e2e25107' '4de094b81613ccd8f037f5951d1c7bdc')
_pkgabbrev="Kyrandia3"
_exe="start.bat"

build() {
	mkdir -p -m755 "$pkgdir/opt/" || return 1
	mkdir -p -m755 "$pkgdir/opt/abandonia" || return 1
	mkdir -p -m755 "$pkgdir/opt/abandonia/$_pkgabbrev" || return 1
	rm -f $srcdir/download* || return 1
	cp -ar $srcdir/KYRAND3/* "$pkgdir/opt/abandonia/$_pkgabbrev" || return 1
	cp -ar $srcdir/$_exe "$pkgdir/opt/abandonia/$_pkgabbrev" || return 1

	#ok, let's use a script to start the game

	mkdir -p -m755 /$pkgdir/usr/bin/ || return 1

	printf "#!${SHELL}
if whereis dosbox>/dev/null 2>&1;
	then
		dosbox /opt/abandonia/$_pkgabbrev/$_exe
	else
		echo '==> Please get sure to have dosbox installed and have it in your PATH array.'
fi
return \$?" >> /$pkgdir/usr/bin/$_pkgabbrev.sh || return 1

	chmod +x /$pkgdir/usr/bin/$_pkgabbrev.sh || return 1
	ln -s $_pkgabbrev.sh /$pkgdir/usr/bin/$_pkgabbrev || return 1
} 
