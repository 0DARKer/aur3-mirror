# Maintainer: Auguste Pop < auguste [at] gmail [dot] com >
# Contributor: P. Badredin <p dot badredin at gmail dot com>
# Contributor: Justin Blanchard <UncombedCoconut at gmail dot com>

pkgname=stockfish
pkgver=2.2.2
_bookver=2.1.1
pkgrel=1
pkgdesc="A strong chess engine written by Tord Romstad, Marco Costalba, Joona Kiiski"
arch=('i686' 'x86_64')
url="http://www.stockfishchess.com/"
license=('GPL3')
install=stockfish.install
_pkgfilever=${pkgver//./}
_bookfilever=${_bookver//./}
source=("http://api.cld.me/0s2G1s213J3q420b1X0S/download/stockfish-${_pkgfilever}-linux.zip"
        "http://api.cld.me/2R1L1Y0V0b1M3M1B1D26/download/sf-${_bookfilever}-book.zip")
md5sums=('e6edb709fe97ab7dd1af24a215340b83'
         'c41f7a3e30a141415591dba2355deccb')


build()
{
    cd "$srcdir/stockfish-${_pkgfilever}-linux/src"
    # Change the default book path to a system-wide location
    sed -i '/Book File/s:book.bin:/usr/share/stockfish/book.bin:' ucioption.cpp
    # Patch Makefile to enable profile-build
    sed -i 's/\(.*\)LDFLAGS += $(CXXFLAGS)/\1LDFLAGS += -flto/' Makefile

    [ "$CARCH" = "i686" ] && _arch=x86-32 || _arch=x86-64
    make profile-build ARCH=$_arch
}

package()
{
    cd "$srcdir/sf-${_bookfilever}-book"
    install -D -m644 Book.bin $pkgdir/usr/share/$pkgname/book.bin

    cd "$srcdir/stockfish-${_pkgfilever}-linux/src"
    make PREFIX="$pkgdir/usr" install
}
