# Maintainer: P. Badredin <p dot badredin at gmail dot com>
# Contributor: Justin Blanchard <UncombedCoconut at gmail dot com>

pkgname=stockfish
#pkgver=2.1.1
pkgver=22
_bookver=2.1.1
pkgrel=1
pkgdesc="A strong chess engine written by Tord Romstad, Marco Costalba, Joona Kiiski"
arch=('i686' 'x86_64')
url="http://www.stockfishchess.com/"
license=('GPL3')
makedepends=('unzip')
install=stockfish.install

source=("stockfish-$_bookver-book.zip::http://cl.ly/2R1L1Y0V0b1M3M1B1D26/sf-211-book.zip"
	"stockfish-$pkgver-linux.zip::http://api.cld.me/3f1E2D1F322y0z1F1k2b/download/stockfish-22-linux.zip"
	search-for-book-in-usr-share.patch)

md5sums=('c41f7a3e30a141415591dba2355deccb'
	 '6071b67bebffd002a113433060e88ce4'
	 '706b17e76636dd2a4dc99c65e66ca5c0')


build() {
  cd "$srcdir"
  unzip -o "stockfish-$pkgver-linux.zip" || return 1
  unzip -o "stockfish-$_bookver-book.zip" || return 1

  install -D -m644 sf-211-book/Book.bin $pkgdir/usr/share/$pkgname/book.bin || return 1
  cd "sf-211-linux-eng/src"
  # Change the default book path to a system-wide location
  patch -p1 < ../../search-for-book-in-usr-share.patch || return 1

  if [ "$CARCH" = "i686" ]; then
    ARCH=x86-32
  else
    ARCH=x86-64
  fi

  make ARCH=$ARCH || return 1
  install -D -m755 stockfish $pkgdir/usr/bin/stockfish
}
