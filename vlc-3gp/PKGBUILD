# Maintainer: Marco Maso <demind@gmail.com>

pkgname=vlc-3gp
_pkgname=vlc
pkgver='1.1.5'
pkgrel=1
arch=(any)
url="http://www.videolan.org/vlc/"
license=('GPL')
pkgdesc="A multi-platform MPEG, VCD/DVD, DivX player with .3gp support enabled"
depends=('a52dec' 'fluidsynth' 'libmtp' 'libdvbpsi' 'libcdio' 'libdvdnav>=4.1.3'
         'libdca' 'qt' 'libproxy' 'sdl_image' 'libdvdnav' 'mesa'
         'lua' 'libv4l' 'libcddb' 'smbclient' 'libmatroska' 'zvbi'
         'taglib' 'sysfsutils' 'libmpcdec' 'ffmpeg-amr-svn' 'faad2'
         'libshout' 'libmad' 'fribidi' 'libmpeg2' 'libmodplug'
         'ttf-freefont' 'libxv' 'libass' 'xdg-utils' 'libdvdread' 'libid3tag'
         'flac' 'libtheora' 'libva' 'mesa' 'speex')           
makedepends=('mesa' 'sdl_image'  'live-media' 'nspr' 'libxpm' 'alsa-lib' 'jack' 'udev'
             'subversion' 'xulrunner' 'pkgconfig' 'desktop-file-utils' 'hal')
optdepends=('firefox: to make use of the plugin' 
            'avahi: for service discovery using bonjour protocol'
            'libnotify: for notification plugin'
            'ncurses: for ncurses interface support'
            'libdvdcss: for decoding encrypted DVDs'
            'lirc-utils: for lirc plugin'
            'libavc1394: for devices using the 1394ta AV/C'
            'libdc1394: for IEEE 1394 plugin'
            'kdelibs: KDE Solid hardware integration'
            'vdpau-video: VDPAU backend for VA API (for GPU acceleration on Nvidia cards)')
options=('!libtool')
provides=('vlc' 'vlc-plugin')
source=(http://download.videolan.org/pub/videolan/vlc/$pkgver/${_pkgname}-${pkgver}.tar.bz2)
md5sums=('fdc23693351ed57af9f4c85ea885b536')

build() {

  cd ${srcdir}/${_pkgname}-${pkgver}
  sed -i -e 's:truetype/freefont:TTF:g' modules/misc/freetype.c

  # extrafeatures
  [ "${CARCH}" = "i686" ] && EXTRAFEATURES="--enable-loader"
  [ "${CARCH}" = "x86_64" ] && EXTRAFEATURES="--enable-fast-install"

  # export linker flags for the ffmpeg tree
  # this has to be in sync with how ffmpeg was configured above
  # export LDFLAGS_ffmpeg="-lfaad -la52 -lxvidcore -lmp3lame -lx264 -lamrnb -lamrwb -lfaac"

  LDFLAGS="${LDFLAGS} -lbz2"  CFLAGS="-fPIC" ./configure --prefix=/usr --enable-dvdread --enable-dvdnav --enable-jack \
	--disable-rpath --enable-faad --enable-flac --enable-snapshot --enable-v4l \
	--enable-alsa --enable-skins2 --enable-dvb --enable-theora --enable-mozilla --enable-libass\
	--enable-nls --enable-shout --enable-hal --enable-dbus --enable-dbus-control --enable-shared \
	--with-live555-tree=/usr/lib/live/  --enable-zvbi --enable-pvr --enable-realrtsp --enable-release

  make || return 1
  make DESTDIR=${pkgdir}/ install

  for res in 16 32 48 128 256; do
    install -D -m644 ${srcdir}/vlc-${pkgver}/share/icons/${res}x${res}/vlc.png \
        ${pkgdir}/usr/share/icons/hicolor/${res}x${res}/apps/vlc.png
  done

  rm -rf ${pkgdir}/usr/lib/mozilla

  #for linking against libvlc
  make -C src DESTDIR="${pkgdir}" install-libLTLIBRARIES

  make -C projects/mozilla DESTDIR=${pkgdir}/ install

  #clean up libvlc
  #make -C src DESTDIR="${pkgdir}" uninstall-libLTLIBRARIES
}
