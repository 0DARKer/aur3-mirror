# Contributor: Osman Ugus <ugus11@yahoo.com>
pkgname=sage-mathematics-bin
pkgver=4.5.3
pkgrel=1
pkgdesc="SAGE: Open Source Mathematics Software, a viable free alternative to Magma, Maple, Mathematica, and Matlab (Binary version)"
url="http://www.sagemath.org"
arch=(i686 x86_64)
license=('GPL')
depends=(xorg-utils)
provides=(sage-bin)
makedepends=('tar')
install=${pkgname}.install
#noextract=()

if [ "$CARCH" = "x86_64" ]; then
  _sage_bin_dir=sage-4.5.3-linux-64bit-ubuntu_10.04_lts-x86_64-Linux
  _toextract=sage-4.5.3-linux-64bit-ubuntu_10.04_lts-x86_64-Linux.tar.lzma
  source=(ftp://ftp.fu-berlin.de/unix/misc/sage/linux/64bit/sage-4.5.3-linux-64bit-ubuntu_10.04_lts-x86_64-Linux.tar.lzma \
  http://aur.archlinux.org/packages/sage-mathematics-bin/sage-mathematics-bin/SAGE-notebook-bin.desktop \
  http://aur.archlinux.org/packages/sage-mathematics-bin/sage-mathematics-bin/sage_logo.png)

md5sums=('649b24bc22f16a6550dff16da256bced'
         'ae959e16bf5a0db782493664ada2561f'
         '774c0593004314d09a00f2d26b933d5e')
                  
	
else
  _sage_bin_dir=sage-4.5.3-linux-32bit-ubuntu_10.04_lts-i686-Linux
  _toextract=sage-4.5.3-linux-32bit-ubuntu_10.04_lts-i686-Linux.tar.lzma
  source=(ftp://ftp.fu-berlin.de/unix/misc/sage/linux/32bit/sage-4.5.3-linux-32bit-ubuntu_10.04_lts-i686-Linux.tar.lzma \
  http://aur.archlinux.org/packages/sage-mathematics-bin/sage-mathematics-bin/SAGE-notebook-bin.desktop \
  http://aur.archlinux.org/packages/sage-mathematics-bin/sage-mathematics-bin/sage_logo.png)
                    
md5sums=('342ab8ba8f6da8c7b287c5d6653e1b0f'
         'ae959e16bf5a0db782493664ada2561f'
         '774c0593004314d09a00f2d26b933d5e')
                                       
fi
    
build() {
 
  #if [ "$CARCH" = "x86_64" ]; then
  #   echo "decompressed tar.gz"
  #else
     echo "decompressing lzma"
     tar -xf $_toextract     
  #fi

  
  # rename the sage binary directory
  mv ${startdir}/src/$_sage_bin_dir ${startdir}/src/sage-bin

  install -D ${startdir}/SAGE-notebook-bin.desktop ${startdir}/pkg/usr/share/applications/SAGE-notebook-bin.desktop || return 1
  install -D ${startdir}/sage_logo.png ${startdir}/src/sage-bin/notebook/sage_logo.png || return 1
  echo "# This file was *autogenerated* from the file /opt/sage-bin/notebook/notebook.sage." > ${startdir}/src/sage-bin/notebook/notebook.py || return 1
  echo "notebook(open_viewer=True)" > ${startdir}/src/sage-bin/notebook/notebook.sage || return 1
    
  # install sage components
  mkdir -p ${startdir}/pkg/opt || return 1
  mv ${startdir}/src/sage-bin ${startdir}/pkg/opt/sage-bin || return 1
  install -D ${startdir}/pkg/opt/sage-bin/sage ${startdir}/pkg/opt/bin/sage-bin || return 1
  ${startdir}/pkg/opt/sage-bin/local/bin/python ${startdir}/pkg/opt/sage-bin/local/bin/sage-hardcode_sage_root ${startdir}/pkg/opt/bin/sage-bin /opt/sage-bin || return 1
  echo "/opt/sage-bin" > ${startdir}/pkg/opt/sage-bin/local/lib/sage-current-location.txt || return 1
  mv ${startdir}/pkg/opt/sage-bin/local/lib/sage-flags.txt ${startdir}/pkg/opt/sage-bin/local/lib/sage-flags.txt.org
  touch ${startdir}/pkg/opt/sage-bin/local/lib/sage-flags.txt || return 1
  
  # fix for a broken version of libreadline for 64-Bit architecture
  #if [ "$CARCH" = "x86_64" ]; then
  cp /usr/lib/libreadline.so  ${startdir}/pkg/opt/sage-bin/local/lib/libreadline.so        
  #fi
}

