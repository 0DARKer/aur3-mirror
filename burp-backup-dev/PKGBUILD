# Maintainer: Rafa≈Ç Michalski <plum.michalski at gmail dot com>
pkgname="burp-backup-dev"
_pkgname="burp"
pkgver=2.0.16
pkgrel=1
pkgdesc="Burp is a backup and restore program. It uses librsync in order to save on the amount of space that is used by each backup"
arch=("any")
license=("AGPLv3")
depends=('librsync' 'openssl')
makedepends=('uthash')
conflicts=(burp-backup)
provides=(burp-backup)
install=$_pkgname.install
url='http://burp.grke.org/'
source=(
    "http://downloads.sourceforge.net/project/${_pkgname}/${_pkgname}-${pkgver}/${_pkgname}-${pkgver}.tar.bz2"
    "$_pkgname.install"
    "burp.service"
)
sha256sums=(

535593b6b8c8f3199e78d65d7e5ff4e84b0ed62b945ccb15e379e4b0675c9bd0 # burp-2.0.16.tar.bz2
ce030820046da1372949f9cc5a5123c6dcc1bda73acd18b6c02f96db1402e0c9 # burp.install
eb5ed9b87270edbd98425397824557e6d80fd429c19e8646f838d61ba3f68962 # burp.service

)


prepare() {
  cd $_pkgname-$pkgver
  sed -i 's/\/var\/run/\/run/' Makefile.in
}

build() {
  cd $srcdir/$_pkgname-$pkgver
  ./configure --sbindir=/usr/bin || return 1
}

package() {

  cd "$srcdir/$_pkgname-$pkgver"
  make || return 1
  make DESTDIR="$pkgdir/" install


 # cron.d logrotate
  mkdir $pkgdir/etc/cron.d
  cp debian/burp.cron.d $pkgdir/etc/cron.d/burp
  mkdir $pkgdir/etc/logrotate.d
  cp debian/logrotate $pkgdir/etc/logrotate.d/burp


 # fix permissions
  mkdir -p $pkgdir/var/spool/burp
  chmod 755 $pkgdir/var/spool
  chmod 0600 $pkgdir/etc/burp/burp.conf
  chmod 0600 $pkgdir/etc/burp/burp-server.conf
  chmod 0700 $pkgdir/etc/burp/clientconfdir
  chmod 0700 $pkgdir/var/spool/burp



}
