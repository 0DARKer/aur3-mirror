# Maintainer: Serge Ziryukin <ftrvxmtrx@gmail.com>

pkgname=ocaml-sqlite3
pkgver=1.6.3
pkgrel=1
pkgdesc="SQLite3 bindings for OCaml"
arch=('i686' 'x86_64')
url=("http://www.ocaml.info/home/ocaml_sources.html")
license=('MIT')
depends=('ocaml' 'ocaml-findlib' 'sqlite3')
makedepends=('ocaml')
source=(https://bitbucket.org/mmottl/sqlite3-ocaml/downloads/sqlite3-ocaml-${pkgver}.tar.gz
  install-fix.patch)
md5sums=('bb27e99eed1c35989854272f7e83a232'
         '068b3ae114220b7820c9d9a8e5b56eee')
install=ocaml-sqlite3.install
options=(!makeflags)

_pkgdir="sqlite3-ocaml-${pkgver}"

build () {
  OCAMLFIND_DESTDIR="${pkgdir}$(ocamlfind printconf destdir)"

  cd "${srcdir}/${_pkgdir}"

  patch -Np1 -i ../install-fix.patch
  ./configure --prefix=/usr || return 1
  make all || return 1
  mkdir -p "${OCAMLFIND_DESTDIR}/stublibs"
  DESTDIR="${pkgdir}" OCAMLFIND_DESTDIR="${OCAMLFIND_DESTDIR}" make install || return 1
}
