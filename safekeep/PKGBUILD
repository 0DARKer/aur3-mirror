# Maintainer: Jaroslav Lichtblau <dragonlord@aur.archlinux.org>

pkgname=safekeep
pkgver=1.3.2
pkgrel=1
pkgdesc="A client/server backup system which enhances the power of rdiff-backup"
arch=('any')
url="http://safekeep.sourceforge.net"
license=('GPL')
depends=('python2' 'rdiff-backup' 'openssh')
makedepends=('asciidoc' 'docbook-xsl' 'patch' 'xmlto')
install=$pkgname.install
source=(http://downloads.sourceforge.net/sourceforge/$pkgname/$pkgname-$pkgver.tar.gz)
sha256sums=('31d6aeacd6d0d1fc4b3f4b0df6199d709da548da0c4af347981dd3dd3a881ef2')

build() {
  cd ${srcdir}/$pkgname-$pkgver

  make docs
}

package () {
  cd ${srcdir}/$pkgname-$pkgver

#Python2 fix
  sed -i 's_env python_env python2_' $pkgname

#  make DESTDIR=${pkgdir} install
#installing files
  install -D -m755 $pkgname ${pkgdir}/usr/bin/$pkgname
  install -D -m644 $pkgname.conf ${pkgdir}/etc/safekeep/safekeep.conf
  install -D -m644 $pkgname.cron ${pkgdir}/usr/share/safekeep/safekeep.cron
  install -D -m644 doc/$pkgname.1 ${pkgdir}/usr/share/man/man1/$pkgname.1
  install -D -m644 doc/$pkgname.conf.5 ${pkgdir}/usr/share/man/man5/$pkgname.conf.5
  install -D -m644 doc/$pkgname.backup.5 ${pkgdir}/usr/share/man/man5/$pkgname.backup.5
  install -D -m644 samples/sample.backup ${pkgdir}/etc/safekeep/backup.d/sample.backup
}
