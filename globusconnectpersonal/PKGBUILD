# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Mike Dacre <mike.dacre@gmail.com>
pkgname=globusconnectpersonal
pkgver=2.1.1
pkgrel=1
pkgdesc="Tool to create a personal endpoint for the Globus file transfer utility"
arch=('x86_64' 'i386')
url="https://support.globus.org/entries/24078973-Installing-Globus-Connect-Personal-for-Linux-Using-the-Command-Line"
license=('Apache')
depends=('python2')
optdepends=('tk' 'libltdl' 'tcllib')
source=("https://s3.amazonaws.com/connect.globusonline.org/linux/stable/globusconnect-latest.tgz"
        $pkgname-$pkgver.patch)
noextract=()
md5sums=('046cab91cdbca85e8506fe09e0705e9b'
         'b8b67e46d9c1604764894a41880e3946')

prepare() {
  cd "$srcdir/$pkgname-$pkgver"
  patch -p1 -i "$srcdir/$pkgname-$pkgver.patch"
  perl -pi -e "s#UpdatePackageLocationWithPerlScript#/opt/$pkgname-$pkgver#" globusconnectpersonal
  if [ "$CARCH" == 'i386' ]; then
    rm -rf 'gt_amd64'
  elif [ "$CARCH" == 'x86_64' ]; then
    rm -rf 'gt_i386'
  fi
}

package() {
  mkdir -p "$pkgdir/opt"
  mkdir -p "$pkgdir/usr/bin"
  cp -r "$srcdir/$pkgname-$pkgver" "$pkgdir/opt/"
  cd "$pkgdir/usr/bin"
  ln -s "../../opt/$pkgname-$pkgver/globusconnectpersonal" "globusconnect"
}
