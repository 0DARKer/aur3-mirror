# Maintainer: Demind <demind@gmail.com>

pkgname=ffmpeg-amr-svn
pkgver=25753
pkgrel=1
pkgdesc="FFMpeg with AMR-NB and AMR-WB codecs from 3GPP."
arch=('i686' 'x86_64')
license=('LGPL' 'unknown')
depends=('alsa-lib' 'libvdpau' 'libxfixes' 'schroedinger' 'libvpx' 'libva>=1.0.4' 'openjpeg' 'lame' 'sdl' 'libvorbis' 'a52dec' 'faac' 'xvidcore' 'zlib' 'imlib2' 'x264' 'libtheora' 'opencore-amr-git' 'bzip2')
makedepends=('subversion' 'yasm')
conflicts=('ffmpeg')
provides=('ffmpeg=22837')
source=()
md5sums=()
url="http://ffmpeg.mplayerhq.hu/"

_svntrunk=svn://svn.mplayerhq.hu/ffmpeg/trunk
_svnmod=ffmpeg

build() {
	cd $startdir/src
	svn co $_svntrunk/ $_svnmod --config-dir ./ -r $pkgver

	mkdir $_svnmod-build
	cd $_svnmod-build

	$startdir/src/$_svnmod/configure \
		--prefix=/usr \
		--enable-gpl \
		--enable-nonfree \
		--enable-libmp3lame \
		--enable-libvorbis \
		--enable-shared \
		--enable-pthreads \
		--enable-x11grab \
		--enable-postproc \
		--enable-libfaac \
		--enable-libvpx \
		--enable-libxvid \
		--enable-libtheora \
		--enable-libopencore-amrnb \
		--enable-libopencore-amrwb \
		--enable-libx264 \
		--enable-version3 \
		--disable-stripping \
                --enable-nonfree \
                --enable-runtime-cpudetect \
                --enable-libschroedinger \
                --enable-libopenjpeg \
                --disable-debug 

	make -j 2 || return 1 
        make tools/qt-faststart
        make doc/ff{mpeg,play,server}.1
        make DESTDIR="$pkgdir" install install-man
        install -D -m755 tools/qt-faststart "$pkgdir/usr/bin/qt-faststart"

}

