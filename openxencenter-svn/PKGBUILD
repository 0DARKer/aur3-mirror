# Contributor: Sp0i3eR <Maxim.Bokov@gmail.com>

pkgname=openxencenter-svn
pkgver=238
pkgrel=1
pkgdesc="An opensource multiplatform clone of XenCenter (Citrix)"
arch=('i686' 'x86_64')
depends=('pygtk' 'pygtkchart-git')
license=('GPL2')
url="http://www.openxencenter.com/"
source=("oxc"
        "config.patch")
md5sums=('2deb1966df239b4049bab53ad52532de'
         '273c229d53d4cb03a17b6d6e41761bce')

_svntrunk=https://openxencenter.svn.sourceforge.net/svnroot/openxencenter
_svnmod=openxencenter

build() {
  svn co $_svntrunk $_svnmod  
  msg "SVN checkout done or server timeout"  
  msg "Starting make..."
  cd "$srcdir/$_svnmod"

  # patch
  patch < $srcdir/config.patch

  # byte compile
  python -O -m py_compile *.py

  # copy libraries
  if [ "$CARCH" == "i686" ];then
      _arch="32"
  else
      _arch="64"
  fi
  cp $_arch/oxcgtkvnc.so ./oxcgtkvnc.so
  cp $_arch/liboxcgtk-vnc-1.0.so.0 ./liboxcgtk-vnc-1.0.so.0

  # install
  install -dm755 $pkgdir/opt/$pkgname/{32,64,images,plugins} || return 1
  install -m644 *.{py,pyo,conf,glade,la,so} $pkgdir/opt/$pkgname || return 1
  install -m644 liboxcgtk-vnc-1.0.so.0 $pkgdir/opt/$pkgname || return 1
  install -m644 32/* $pkgdir/opt/$pkgname/32 || return 1
  install -m644 64/* $pkgdir/opt/$pkgname/64 || return 1
  install -m644 images/* $pkgdir/opt/$pkgname/images || return 1
  install -m644 plugins/* $pkgdir/opt/$pkgname/plugins || return 1
  install -Dm644 LICENSE $pkgdir/usr/share/licenses/$pkgname/LICENSE || return 1

  # install launcher
  install -Dm755 $srcdir/oxc $pkgdir/usr/bin/oxc || return 1
}
