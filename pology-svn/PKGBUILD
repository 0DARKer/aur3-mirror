# Maintainer: Pierre Buard <pierre buard gmail com>

pkgname=pology-svn
pkgver=1218044
pkgrel=1
pkgdesc="A framework for custom processing of PO files."
arch=('any')
license=('GPL')
url="http://techbase.kde.org/Localization/Tools/Pology"
depends=('python2' 'gettext' 'aspell' 'python2-pyenchant' 'dbus-python')
makedepends=('subversion')
optdepends=('aspell-ca: Catalan dictionary' 'aspell-es: Finnish dictionary' 'aspell-fr: French dictionary' 'aspell-nn: Norwegian Nynorsk dictionary' 'aspell-ro: Romanian dictionary' 'aspell-ru: Russian dictionary' 'aspell-sr: Serbian dictionary')
replaces=('pology')
provides=('pology')
install="pology.install"
source=(pology.profile)
md5sums=('4ff9f823c27ec74f9dd34a5d2de68334')

_svntrunk="svn://anonsvn.kde.org/home/kde/trunk/l10n-support/pology"
_svnmod="pology"

build() {
  cd ${srcdir}

  if [ -d $_svnmod/.svn ]; then
    msg "Updating SVN tree ..."
    (cd $_svnmod && svn up)
    msg "SVN update finished, starting installation..."
  else
    msg "Doing SVN checkout ..."
    svn co $_svntrunk $_svnmod
    msg "SVN checkout finished, starting installation..."
  fi
}

package() {
  install -d ${pkgdir}/opt
  cp -r ${srcdir}/pology ${pkgdir}/opt

  install -d ${pkgdir}/usr/share/doc/pology
  ln -s /opt/pology/README ${pkgdir}/usr/share/doc/pology

  # python2 fix
  sed -i -e 's|^#!/usr/bin/env python$|#!/usr/bin/env python2|' $(find $pkgdir -name '*.py')

  install -d ${pkgdir}/etc/bash_completion.d
  install -m644 ${srcdir}/pology/completion/bash/pology ${pkgdir}/etc/bash_completion.d/pology

  install -d ${pkgdir}/etc/profile.d
  install -m755 ${srcdir}/pology.profile ${pkgdir}/etc/profile.d/pology.sh
}
