# Maintainer: SpepS <dreamspepser at yahoo dot it>

pkgname=seismixgtk
pkgver=0.1.3
pkgrel=1
pkgdesc="Seismix-gtk is a front-end for the Seismix modular music production system."
arch=(i686 x86_64)
url="http://ayyi.org/"
license=('GPL')
depends=('libsndfile' 'libyaml' 'gtkhtml' 'librsvg'
         'clutter-gtk' 'libgnomecanvas' 'gtkglext')
options=('!libtool')
source=("http://ayyi.org/files/$pkgname-$pkgver.tar.gz")
md5sums=('3f94ef9f97ea8e2610de5ec5a5b3e578')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  export LDFLAGS="${LDFLAGS//-Wl,--as-needed}"

  sed -i "s|ayyi.h|ayyi/ayyi.h|" src/global.h
  sed -i "s|LASH_INCLUDES|LASH_CFLAGS|" src/Makefile*
  sed -i "s|0400|0600|;70s|//||" ayyi/ayyi_shm.c
  sed -i "40s|^|//|;41s|//||" ayyi/ayyi_song.c

  # Dirty debugging for tracking x86_64 segfaults
#  for (( cunt=50; cunt <= 83; cunt=cunt+2 )); do
#    sed -i "$cunt adbg(0,\"$cunt\");" ayyi/ayyi_shm.c
#  done

  ./configure \
	--prefix=/usr \
	--enable-clutter \
	--disable-help
  make
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  make DESTDIR="$pkgdir/" install
}
