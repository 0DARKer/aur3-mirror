# Maintainer : Alucryd <alucryd at gmail dot com>

pkgname=nvidia-source
pkgver=304.51
pkgrel=1
pkgdesc="NVIDIA kernel module source (DKMS)" 
arch=('i686' 'x86_64') 
[ "$CARCH" = x86_64 ] && ARCH=x86_64 && _srcname=NVIDIA-Linux-x86_64-${pkgver}-no-compat32
[ "$CARCH" = "i686" ] && ARCH=x86 && _srcname=NVIDIA-Linux-x86-${pkgver}
url="http://www.nvidia.com/"
license=('custom')
conflicts=('nvidia-beta-source')
source=("http://us.download.nvidia.com/XFree86/Linux-$ARCH/${pkgver}/${_srcname}.run") 

[ "$CARCH" = "i686" ] && md5sums=('4fde294e139a31528ea7f6efd8885a09')
[ "$CARCH" = "x86_64" ] && md5sums=('2ca10e05cd3b5d2a87caaaad9fd93c06')

package() {
  cd "${srcdir}"
  if [ -d ${_srcname} ]; then
    rm -rf ${_srcname}
  fi
  sh ${_srcname}.run --extract-only
  cd ${_srcname}
  install -m755 -d kernel "${pkgdir}/usr/src"
  cp -R kernel "${pkgdir}/usr/src/nvidia-${pkgver}"
  chmod 755 -R "${pkgdir}/usr/src/nvidia-${pkgver}"
}
