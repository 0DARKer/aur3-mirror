# Maintainer: Thomas Dziedzic < gostrc at gmail >

pkgname=cgminer
pkgver=1.2.4
pkgrel=1
pkgdesc="Con Kolivas's fork of cpuminer. http://forum.bitcoin.org/index.php?topic=28402.0"
arch=('i686' 'x86_64')
url='https://github.com/ckolivas/cgminer'
license=('GPL')
depends=('curl')
makedepends=('yasm')
source=("http://ck.kolivas.org/apps/cgminer-${pkgver}-1.tar.bz2")
md5sums=('ea7942823ca5f04c4044bc492ca9f4ea')

build() {
  cd cgminer-${pkgver}

  # Use in-tree jansson since it is not compatible with jansson 2.0
  #sed -e 's/^AC_CHECK_LIB(jansson, json_loads, request_jansson=false, request_jansson=true)$/request_jansson=true/' -i configure.ac

  # Here you may want to use custom CFLAGS
  #export CFLAGS="-O2 -march=native -mtune=native -msse2"

  ./configure \
    --prefix=/usr

  make
}

package() {
  cd cgminer-${pkgver}

  make DESTDIR=${pkgdir} install

  install -Dm600 "example-cfg.json" "${pkgdir}/etc/cpuminer.json"
  #install -Dm644 "${srcdir}/cpuminer.conf" "${pkgdir}/etc/conf.d/cpuminer.conf"
  #install -Dm755 "${srcdir}/rc-script.cpuminer" "${pkgdir}/etc/rc.d/cpuminer"
}
