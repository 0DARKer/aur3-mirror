# Contributor: Thomas Dziedzic < gostrc at gmail >
# Maintainer: monson <holymonson@gmail.com>

pkgname=cgminer
pkgver=1.5.3
pkgrel=2
pkgdesc="Multi-threaded multi-pool CPU and GPU miner for bitcoin, forked from cpuminer."
url='http://forum.bitcoin.org/index.php?topic=28402.0'
license=('GPLv2')
arch=('i686' 'x86_64')

depends=('ncurses' 'curl' 'libcl')
makedepends=('opencl-headers')
optdepends=('opencl-nvidia: OpenCL implementation for NVIDIA'
            'intel-opencl-sdk: OpenCL implementation for Intel'
            'amdstream: OpenCL implementation for AMD')

source=("http://ck.kolivas.org/apps/cgminer/cgminer-${pkgver}.tar.bz2")
md5sums=('faf6d79c2085f902971d719e59165088')

[ $CARCH == 'x86_64' ] && makedepends+=('yasm')

build() {
  cd "$srcdir"/$pkgname-$pkgver

  # Use in-tree jansson since it is not compatible with jansson 2.0
  #sed -e 's/^AC_CHECK_LIB(jansson, json_loads, request_jansson=false, request_jansson=true)$/request_jansson=true/' -i configure.ac

  # Here you may want to use custom CFLAGS
  #export CFLAGS="-O2 -march=native -mtune=native -msse2"

  ./configure --prefix=/usr
  
  make
}

package() {
  cd "$srcdir"/$pkgname-$pkgver

  make DESTDIR="$pkgdir" install
  
  msg "NOTICE: NOW cgminer must be executed in /usr/bin if mining by GPU."
  msg "        It's a stupid bug which the author may fix later."

#  install -Dm600 "example-cfg.json" "${pkgdir}/etc/cpuminer.json"
  #install -Dm644 "${srcdir}/cpuminer.conf" "${pkgdir}/etc/conf.d/cpuminer.conf"
  #install -Dm755 "${srcdir}/rc-script.cpuminer" "${pkgdir}/etc/rc.d/cpuminer"
}
