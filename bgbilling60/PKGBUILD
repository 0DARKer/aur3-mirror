# Maintainer: Aleksander Boiko <brdcom@ya.ru>
pkgname=bgbilling60
pkgver=6.0
pkgrel=1552
pkgdesc="Billing system BGBilling 6.0"
arch=('i686' 'x86_64') 
url="http://bgbilling.ru"
license=('custom')
depends=('mariadb' 'activemq' 'java-runtime>=6' 'pbzip2')
makedepends=('unzip' 'dos2unix')
source=('bgbilling60.conf'
	'bgbilling60.service'
	'bgscheduler60.service'
	'setenv.sh.patch')
install=bgbilling60.install
_pkgname=BGBillingServer

md5sums=('f7731f6c5dcc253a26d5f09c4e6235e4'
         '68d02d32d8379e189c7e607bef127c9e'
         '333541a8010fc45e71376fc1e213fdd5'
         '0f7f773fb2e39637f1db752e439561e9')

prepare() {
  wget -c ftp://bgbilling.ru/pub/bgbilling/${pkgver}/${_pkgname}_${pkgver}_*.zip
  wget -c http://bgbilling.ru/test_license/${pkgver}/lic.properties
  unzip -o ${_pkgname}_${pkgver}_*.zip
}
package() {
  install -d -m0755 ${pkgdir}/opt
  mv ./${_pkgname} ${pkgdir}/opt/${pkgname}

  for d in bgbilling60; do
    install -D -m 644 $pkgname.conf "$pkgdir/etc/conf.d/$d"
    backup+=("etc/conf.d/$d")
  done

  for d in bgbilling60 bgscheduler60; do
    install -D -m 644 $d.service "$pkgdir/usr/lib/systemd/system/$d.service"
  done
  
  install -D -m0644 ./dump.sql ${pkgdir}/opt/${pkgname}/dump.sql
  #install -D -m0644 ./lic.properties ${pkgdir}/opt/${pkgname}/data/lic.properties
  install -D -m0644 ./lic.properties ${pkgdir}/usr/share/${pkgname}/data/lic.properties

  cp ./setenv.sh.patch ${pkgdir}/opt/${pkgname}
  cd ${pkgdir}/opt/${pkgname}
  patch -p0 <setenv.sh.patch
  rm setenv.sh.patch
  rm -rf ./script
  rm -rf *.ini
  rm -rf *.bat
  rm -rf *.exe
  dos2unix *.sh
  chmod 0744 *.sh
}

# vim:set ts=2 sw=2 ft=sh et:
