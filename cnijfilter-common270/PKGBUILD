# Contributor: Eric Le Bras <eric.lebras@gmail.com>

pkgname=cnijfilter-common270
pkgver=2.70
pkgrel=3
pkgdesc="Canon IJ Printer Driver (Common package from version 2.70)"
arch=('i686' 'x86_64')
url="http://support-au.canon.com.au/contents/AU/EN/0100084103.html"
license=('GPL2' 'LGPL2' 'custom')
depends=('popt>=1.6' 'cups>=1.1.14' 'ghostscript>=5.50')
makedepends=('gtk' 'rpmextract' 'autoconf>=2.13' 'automake>=1.6' 'tar' 'make' 'gcc')
conflicts=('cnijfilter-common')
source=("http://gdlp01.c-wss.com/gds/5/0900007185/02/cnijfilter-common-${pkgver}-2.src.rpm")
md5sums=('478aa71f6f4c81ef788d2136152af4c3')

build() {
  cd ${srcdir}
  rpmextract.sh cnijfilter-common-${pkgver}-2.src.rpm
  tar xzf cnijfilter-common-${pkgver}-2.tar.gz

  cd ${srcdir}/cnijfilter-common-${pkgver}/libs
  ./autogen.sh --prefix=/usr || return 1
  make install DESTDIR=${pkgdir} || return 1
  cd ${srcdir}/cnijfilter-common-${pkgver}/cngpij
  ./autogen.sh --prefix=/usr --enable-progpath=/usr/bin || return 1
  make install DESTDIR=${pkgdir} || return 1
  cd ${srcdir}/cnijfilter-common-${pkgver}/pstocanonij
  ./autogen.sh --prefix=/usr --enable-progpath=/usr/bin || return 1
  make install DESTDIR=${pkgdir} || return 1

  cd ${srcdir}/cnijfilter-common-${pkgver}/cngpijmon
  ./autogen.sh --prefix=/usr || return 1
  cd ${srcdir}/cnijfilter-common-${pkgver}/cngpijmon/backend
  make clean
  make || return 1
  make install DESTDIR=${pkgdir} || return 1

  cd ${srcdir}/cnijfilter-common-${pkgver}
  install -D LICENSE-cnijfilter-${pkgver}E.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE-cnijfilter-${pkgver}E.txt
  install -D LICENSE-cnijfilter-${pkgver}J.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE-cnijfilter-${pkgver}J.txt
}
