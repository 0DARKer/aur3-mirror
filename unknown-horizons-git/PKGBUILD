# Contributor: Thomas Kinnen <thomas.kinnen@gmail.com>
pkgname=unknown-horizons-git
pkgver=20101128
pkgrel=1
pkgdesc="Open source real-time strategy with the comfy Anno1602 feeling"
arch=("i686" "x86_64")
url="http://www.unknown-horizons.org"
license=('GPL' 'CCPL')
depends=('fife-svn>=3514' 'python2' 'python-yaml' 'python-distutils-extra')
makedepends=('git')
conflicts=('unknown-horizons-svn')
replaces=('unknown-horizons-svn')

_gitroot="git://github.com/unknown-horizons/unknown-horizons.git"
_gitname="unknown-horizons"

source=()
md5sums=()

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."

  if [ -d "${srcdir}/${_gitname}" ] ; then
    cd ${_gitname} && git pull --rebase
  else
    git clone ${_gitroot}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}/${_gitname}
  sed -i 's/env python/env python2/' run_uh.py
  python2 setup.py install --home=$pkgdir/usr --optimize=1 || return 1
  mkdir -p $pkgdir/usr/lib/python2.7/site-packages/
  mv $pkgdir/usr/lib/python/* $pkgdir/usr/lib/python2.7/site-packages/
  rm -rf $pkgdir/usr/lib/python
}
