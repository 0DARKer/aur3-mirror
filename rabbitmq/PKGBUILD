# Maintainer: Stefan J. Betz <info at stefan-betz dot net>
# Contributor: p2k <Patrick dot Schneider at uni-ulm dot de>
pkgname=rabbitmq
pkgver=2.2.0
pkgrel=1
pkgdesc="Highly reliable and performant enterprise messaging implementation of AMQP written in Erlang/OTP"
arch=(i686 x86_64)
url="http://rabbitmq.com"
license=('MPL')
depends=('erlang')
backup=('etc/rabbitmq/rabbitmq.conf')
source=("http://www.rabbitmq.com/releases/${pkgname}-server/v${pkgver}/${pkgname}-server-generic-unix-${pkgver}.tar.gz" rabbitmq.conf rabbitmq-server)
install=rabbitmq.install
md5sums=('18b94e2bc4ef649bb9682e14283ecd5f'
         '98da754397bf31c1c172232597ca5943'
         '049a3970f79f296a317f0eacb405c007')

build(){
  cd $srcdir

  for i in usr/lib/erlang/lib usr/bin var/log/rabbitmq var/lib/rabbitmq/mnesia etc/rabbitmq; do
    mkdir -p $pkgdir/$i
  done

  cp rabbitmq.conf $pkgdir/etc/rabbitmq/

  cp -R ${pkgname}_server-${pkgver} $pkgdir/usr/lib/erlang/lib/

  for i in rabbitmq-server rabbitmqctl rabbitmq-multi rabbitmq-env; do
    ln -sf ../lib/erlang/lib/${pkgname}_server-${pkgver}/sbin/$i $pkgdir/usr/bin/
    chmod 755 $pkgdir/usr/lib/erlang/lib/${pkgname}_server-${pkgver}/sbin/$i
  done

  install -D rabbitmq-server "$pkgdir/etc/rc.d/rabbitmq-server"
}
