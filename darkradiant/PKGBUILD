# vim:set ts=2 sw=2 et:
# Contributor: ezzetabi <ezzetabi@gawab.com>
pkgname=darkradiant
pkgver=1.5.0
pkgrel=2
pkgdesc='Open-source fork of GtkRadiant: a level editor for Doom3 and The Dark Mod'
arch=(i686 x86_64)
url='http://darkradiant.sourceforge.net/'
license=('GPL')
groups=()
depends=('boost' 'freealut' 'glew' 'gtkglextmm' 'libgtksourceviewmm2' 'openal' 'python')
makedepends=('svn' 'sed')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
source=('source.diff')
noextract=()

build() {
  cd "$startdir"

  if [ ! -e sources ] ;then
    msg "Retrieving sources via svn for $pkgname version $pkgver..."
    svn export -q  'https://darkradiant.svn.sourceforge.net/svnroot/darkradiant/tags/'"$pkgver/" './sources'
    msg2 "Done"
  fi
  cp -r sources -t "$srcdir"

  cd "$startdir"/sources
  msg "Validating sources from svn: if building fails here try to delete"
  msg "  the directory 'sources' and try again."
  msg "If it continues to fails then the sources are changed and the package"
  msg "  needs to be updated. Please mark it as out-of-date in the AUR."

  echo '14e3e9bb95226c4a1b75defad8bdc8b1  -' >"$srcdir"/md5sources
  find . -type f -print0 | sort -z | xargs -0 cat | md5sum --status -c "$srcdir"/md5sources
  msg2 "Done"
}

package() {
  cd "$srcdir"/sources
  patch -p1 <'../source.diff'
  msg "Real building starts here..."
  ./configure --prefix=/usr --enable-darkmod-plugins  --enable-python --disable-nls
  echo -e 'all:\n' >install/i18n/Makefile
  echo -e 'install:\n' >>install/i18n/Makefile
  make
  make DESTDIR="$pkgdir/" install

  return 0
}

md5sums=('941d6fc40e9a22e12ab77591b7a96426')
