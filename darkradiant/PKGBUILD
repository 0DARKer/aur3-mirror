# vim:set ts=2 sw=2 et:
# Contributor: ezzetabi <ezzetabi@gawab.com>
pkgname=darkradiant
pkgver=1.7.0
pkgrel=1
pkgdesc='Open-source fork of GtkRadiant: a level editor for Doom3 and The Dark Mod'
arch=(i686 x86_64)
url='http://darkradiant.sourceforge.net/'
license=('GPL')
groups=()
depends=('boost' 'freealut' 'glew' 'gtkglextmm' 'libgtksourceviewmm2' 'openal' 'python')
makedepends=('svn')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
source=(source.diff)
noextract=()

build() {
  cd "$startdir"

  if [ ! -e sources ] ;then
    msg "Retrieving sources via svn for $pkgname version $pkgver..."
    svn export -q  'https://darkradiant.svn.sourceforge.net/svnroot/darkradiant/tags/'"$pkgver/" './sources'
    msg2 "Done"
  fi
  cp -r sources -t "$srcdir"

  cd "$startdir"/sources
  msg "Checking sources"
  echo 'd0e8050662f2c7584dc72cbe9e181267  -' >"$srcdir"/md5sources
  find . -type f -print0 | sort -z | xargs -0 cat | md5sum --status -c "$srcdir"/md5sources
  msg2 "Done"

  cd "$srcdir"/sources

  msg "Real building starts here"
  patch -p0 <../source.diff

  export PYTHON_CONFIG='python2.7-config'
  export CXXFLAGS="$CXXFLAGS"' -DBOOST_FILESYSTEM_VERSION=2'
  ./configure --prefix=/usr --enable-darkmod-plugins  --enable-python --disable-nls

  make
}

package() {
  cd "$srcdir"/sources

  make DESTDIR="$pkgdir/" install

  return 0
}

md5sums=('debba756a4cf015e8697dc95ef7281da')
