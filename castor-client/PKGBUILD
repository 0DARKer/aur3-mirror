# Contributor: Jan Ka≈°par <jan.kaspar at gmail dot com>
pkgname=castor-client
pkgver=2.1.11
pkgrel=7
pkgdesc="Client for CERN Advanced STORage manager."
arch=('i686' 'x86_64')
url="http://castor.web.cern.ch/castor/"
license=('EU DataGrid software license')
depends=()
makedepends=('make' 'imake' 'python2')

source=(
	"http://castorold.web.cern.ch/castorold/DIST/CERN/savannah/CASTOR.pkg/$pkgver-*/$pkgver-$pkgrel/castor-$pkgver-$pkgrel.tar.gz"
	"python2_patch"
	"bash-completion"
)

md5sums=('7ee5e5b41d526a38bf276dff43897af2'
         '8c838ccab6ed5267f280e68650ef4fea'
         '417cc791dcd0d1964a8900ef9c475c6a')

build()
{
	cd "$srcdir/castor-$pkgver"

	export MAJOR_CASTOR_VERSION=2.1
	export MINOR_CASTOR_VERSION=11.7

	patch -p0 < "../python2_patch"
	
	export LDFLAGS=""
	
	./configure || return 1
	make client || return 2
}

package()
{
	cd "$srcdir/castor-$pkgver"
	#export DESTDIR="$startdir/pkg"
	make DESTDIR="$pkgdir/" LIBDIR="/usr/lib" installclient

	mkdir -p "$pkgdir/etc/bash_completion.d"
	cp "../bash-completion" "$pkgdir/etc/bash_completion.d/castor"
}

