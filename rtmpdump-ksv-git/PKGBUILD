# Maintainer: burntsushi <jamslam[at]gmail.com>
pkgname=rtmpdump-ksv-git
_gitname=rtmpdump-ksv
pkgver=550a0ca
pkgrel=1
pkgdesc="A version of rtmpdump-git including numerous patches released by KSV. Forum thread: http://stream-recorder.com/forum/-t16103.html"
arch=('i686' 'x86_64')
url="http://rtmpdump.mplayerhq.hu/"
license=('GPL2' 'LGPL2.1')
depends=('openssl')
makedepends=('git')
conflicts=('rtmpdump' 'rtmpdump-svn' 'rtmpdump-git' 'rtmpdump-ksv')
provides=('rtmpdump')
source=('git://github.com/BurntSushi/rtmpdump-ksv')
md5sums=('SKIP')

pkgver() {
  cd $srcdir/$_gitname
  git describe --always | sed 's|-|.|g'
}

build() {
  cd $srcdir
  msg "Connecting to GIT server...."

  if [ -d $srcdir/$_gitname ] ; then
    cd $_gitname && git checkout ksv && git pull origin ksv
    msg "The local files are updated."
  else
    git clone $_gitroot
    cd $_gitname
    git checkout ksv
  fi

  cd $srcdir
  if [ -d $_gitname-build ]; then
    rm -rf $_gitname-build
  fi

  cp -a $_gitname $_gitname-build
  cd $_gitname-build

  make
}

package() {
  cd $srcdir/$_gitname-build
  install -d -m755 "${pkgdir}/usr/lib"
  make prefix=/usr sbindir=/usr/bin \
    mandir=/usr/share/man DESTDIR="$pkgdir" \
    install
}
