Description: exactimage: DoS, econvert crashes
 setjmp must be called before decoding an image using dcraw because
 it uses longjmp after an error.
Author: Sven Eckelmann <sven@narfation.org>

---
diff --git a/codecs/dcraw.cc b/codecs/dcraw.cc
index 4fad376cf099a62497f4261d17db61fb4a513c60..9d21c49528fc2d65a6ef78ad1c8121aa886a453c 100644
--- a/codecs/dcraw.cc
+++ b/codecs/dcraw.cc
@@ -161,7 +161,11 @@ int DCRAWCodec::readImage (std::istream* stream, Image& im, const std::string& d
 
   if (use_camera_matrix < 0)
       use_camera_matrix = use_camera_wb;
-  
+
+  // TODO: cleanup on failure
+  if (setjmp (failure))
+    return false;
+
   identify();
   
   if (!is_raw)
