# Maintainer: Jose Riha <jose 1711 gmail com>

pkgname=dualsub-git
pkgver=20140617
pkgrel=1
pkgdesc="tool for merging and translating subtitles"
url="https://github.com/bonigarcia/dualsub"
arch=('i686' 'x86_64')
license=('GPL-3')
source=(dualsub.png dualsub.desktop)
depends=('java-environment')
makedepends=('git' 'maven')
md5sums=('38af0208f8ec2831c38d72fce55e2a63'
         '3aef26346ba8deac17cea0e0336ea0af')

_gitname="dualsub"
_gitroot="git://github.com/bonigarcia/${_gitname}.git"


build() {
  cd $srcdir
  msg "Connecting to GIT (${_gitroot}) ..."

  if [ -d $_gitname ]; then
    cd $_gitname && git pull origin
    msg "The local files of ${_gitname} were updated."
  else
    git clone $_gitroot $_gitname
  fi
  
  msg "GIT checkout done or server timeout"

  cd ${srcdir}/$_gitname
  mvn clean compile assembly:single
}

package() {
  cd ${srcdir}/$_gitname
  install -Dm755 ./target/dualsub-1.0.1-jar-with-dependencies.jar ${pkgdir}/usr/share/java/${_gitname}/${_gitname}.jar
  install -D -m644 $srcdir/dualsub.png $pkgdir/usr/share/pixmaps/dualsub.png
  install -D -m644 $srcdir/dualsub.desktop $pkgdir/usr/share/applications/dualsub.desktop
  mkdir -p -m755 ${pkgdir}/usr/bin
  echo -e "#!/bin/sh
java -jar /usr/share/java/${_gitname}/${_gitname}.jar" > $pkgdir/usr/bin/${_gitname}
  chmod 755 ${pkgdir}/usr/bin/${_gitname}
}
