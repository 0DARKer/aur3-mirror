# Maintainer: viperpaulo
pkgname=openmodelica-svn
pkgver=19024
pkgrel=1
pkgdesc="The Open Source Modelica Compiler "
arch=('i686' 'x86_64')
url="https://openmodelica.org"
license=('GPL3')
depends=('lpsolve' 'sqlite3' 'omniorb' 'qwt' 'blas' 'lapack' 'gcc44')
makedepends=('rml-mmc-svn' 'antlr' 'subversion' 'jre7-openjdk' 'boost')

source=('openmodelica::svn+https://openmodelica.org/svn/OpenModelica/trunk/')
md5sums=('SKIP')
# options=('!makeflags')
_svntrunk="https://openmodelica.org/svn/OpenModelica/trunk/"
_svnmod="openmodelica"

pkgver() {
   cd "${SRCDEST}/${_svnmod}"
   svnversion
}
build() {
   export CC="gcc-4.4"
   export CXX="g++-4.4"
   export RMLHOME=/opt/rml-mmc/

   cd "${srcdir}/${_svnmod}"
   autoconf

   ./configure --prefix=/opt/openmodelica/ \
	--with-omniORB \
	--without-paradiseo \
	--disable-python-interface \
	--disable-modelica3d \
	--with-lapack='-llapack -lblas'
# 	--with-paradiseo=/usr/lib64 \
#    make
	make omc
	make mosh
	make qtclients
}

# check() {
#   cd "${srcdir}/${_svnmod}"
#   make test
# }

package() {
  mkdir -p ${pkgdir}/usr/bin
#   mkdir -p ${pkgdir}/opt/${_pkgname}

  cd "${srcdir}/${_svnmod}"
  make DESTDIR="${pkgdir}" install

  ln -s /opt/openmodelica/bin/OMEdit ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/OMNotebook ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/OMPlot ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/OMShell ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/OMShell-terminal ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/fmigenerator ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/interactiveclient ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/omc ${pkgdir}/usr/bin/
  ln -s /opt/openmodelica/bin/omc-diff ${pkgdir}/usr/bin/
}
