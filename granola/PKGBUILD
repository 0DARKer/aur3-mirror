# Maintainer: Paul Cox <pauldcox@gmail.com>
# Contributor: Matthew Bauer (previous maintainer)

pkgname=granola
pkgver=4.0.1
pkgrel=1
pkgdesc="Reduces the energy consumption of your laptops, PCs, and servers by 15-35% without any impact on the way you use these devices."
arch=('i686' 'x86_64')
  [ $CARCH = i686 ] && _arch=i386
  [ $CARCH = x86_64 ] && _arch=$CARCH
url="http://grano.la/"
license=('custom')
depends=('gcc-libs' 'cpufrequtils')
optdepends=('python2: for MiserWare customer support via the mw-feedback tool'
            'granola-connect: daemon for policy support you define at https://grano.la/dash/'
            'granola-gui: gui for granola-connect and for viewing statistics')
backup=('etc/granola.conf')
install=$pkgname.install
changelog=$pkgname.changelog

source=("https://download.miserware.com/linux/tar/$_arch/$pkgname-$pkgver-$_arch.tar.gz"
        'granola.confd'
        'rc_granola.sh'
        'python2.patch')

[ $_arch = i686 ] && md5sums=('a84bd5f2dc04e21d05dc1269fe263b6c')
[ $_arch = x86_64 ] && md5sums=('5127139840e11dc28a12fbe237066e02')
md5sums+=('8de199f0c344d253e6f9cd9b78d3ef8b'
          '8335aef39c176789bc71faf4e0fc423a'
          '6b491769026ff7b7549e9a253106d8a7')

build() {
  cd "$srcdir/$pkgname-$pkgver-$_arch"
  # change python script header to python2
  patch -p1 -i "$srcdir"/python2.patch
}

package() {
  cd "$srcdir/$pkgname-$pkgver-$_arch"

  cp -r usr var "$pkgdir"
  chmod 775 "$pkgdir"/var/lib/miserware
  chmod 664 "$pkgdir"/var/lib/miserware/*

  # put license in proper directory
  rm -fr "$pkgdir"/usr/share/doc
  install -Dm644 usr/share/doc/$pkgname-$pkgver/LICENSE.txt \
          "$pkgdir"/usr/share/licenses/$pkgname/LICENSE.txt

  install -Dm644 etc/granola.conf "$pkgdir"/etc/granola.conf

  # rc.d files
  install -Dm644 "$srcdir"/granola.confd "$pkgdir"/etc/conf.d/granola.conf
  install -Dm755 "$srcdir"/rc_granola.sh "$pkgdir"/etc/rc.d/granola
}

# vim:set ts=2 sw=2 et:
