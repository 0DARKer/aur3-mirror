# $Id$
# Maintainer:
# Contributor: Roman Kyrylych <roman@archlinux.org>
# Contributor: javonera <javonera@gmail.com>
# Contributor: Artiom MOLCHANOV <ar.molchanov@gmail.com>

pkgname=screenlets-pack
_bzr_name=indiv-screenlets
pkgver=0.0.3
pkgrel=2
_bzr_rel=1044
pkgdesc="Desktop widgets for Screenlets"
arch=('any')
url="https://launchpad.net/indiv-screenlets"
license=('GPL3')
depends=('screenlets-core')
makedepends=('bzr')
optdepends=('tomboy:              Tomboy Screenlet'
            'python-gdata:        Google Calendar Screenlet'
            'python2-gtkmozembed: Google Maps / Webframe Screenlet'
            'gnome-menus:         Main Menu Screenlet'
            'python-imaging:      Wallpaper Clock / Photo Wall / Slide Show Screenlets'
            'python2-feedparser:  Feed Reader Screenlet'
            'dropbox:             Dropbox Screenlet'
            'python2-numpy:       Lipik Screenlet'
            'nvidia-settings:     NVIDIA Screenlet'
            'pidgin:              Pidgin Screenlet'
            'mplayer:             Mplayer Screenlet'
            'orca:                Speech Screenlet'
            'python-twitter:      Twitter Screenlet'
            'python-evolution:    Evolution Contacts Screenlet'
            'alsa-utils:          Volume Control Screenlet'
            'python2-pytz: for time zones in clocks'
	    'python-solartz: for solar time clocks'
	    )

source=(setup.patch)
install=(screenlets.install)
_bzrtrunk=lp:indiv-screenlets
conflicts=(screenlets)
md5sums=('ceae13fb6014bd457924ba4cc00b4f0a')
build() {
  cd $srcdir
  msg "Connecting to the server...."
  if [ ! -d ./${_bzr_name} ]; then
    msg "Checkout"
    bzr co ${_bzrtrunk} ${_bzr_name} -r ${_bzr_rel}
  else
    msg "Updating"
    bzr up ${_bzr_name} -r ${_bzr_rel}
  fi
  msg "BZR checkout done or server timeout"
  msg "Starting make..."
  [ -d ./${_bzr_name}-build ] && rm -rf ./${_bzr_name}-build
  cp -r ./${_bzr_name} ./${_bzr_name}-build
  cd ./${_bzr_name}-build
  mv "$srcdir/${_bzr_name}-build/src/Lyrics/Quodlibet plugin" "$srcdir/${_bzr_name}-build/src/Lyrics/Quodlibet"  
#  cd "$srcdir/${pkgname}-${pkgver}"
  for _file in $( find ./src -name "*.py" ) ; do 
    sed -i 's:exec python:&2:g' ${_file}
    sed -i 's:/usr/bin/env python:&2:g' ${_file}
    sed -i 's:/usr/bin/python:&2:g' ${_file}
  done
  patch -p0 -i ${srcdir}/setup.patch
}
package() {
#  cd "$srcdir/${pkgname}-${pkgver}"
  cd ./${_bzr_name}-build

  python2 setup.py install --root="$pkgdir"
 
}
