#Maintainer Giorgio Gilestro crocowhile@gmail.com
#
pkgname=sphinxbase
pkgver=0.7
pkgrel=1
pkgdesc='Common library for sphinx speech recognition.'
url='http://cmusphinx.sourceforge.net/'
arch=('i686' 'x86_64')
license=('BSD') #think so??
options=('!libtool')
depends=('lapack' 'alsa-lib')
source=("http://downloads.sourceforge.net/cmusphinx/$pkgname-$pkgver.tar.gz"
        'cythonfix.diff')
md5sums=('c1e96fc9232d78e733375c928e23860b'
         '420821a910961ccd02a400b0edf323f5')
_pythondir="$pkgdir/usr/lib/python2.7/site-packages"

build() {
    cd $pkgname-$pkgver

    patch -Np1 -i ${srcdir}/cythonfix.diff

    find -type f -exec sed -i 's_#!/usr/bin/env python_#!/usr/bin/env python2_' {} \;
    find -type f -exec sed -i 's_/usr/bin/python_/usr/bin/python2_' {} \;
    find -type f -exec sed -i 's_python -c_python2 -c_' {} \;
    find -type f -exec sed -i 's_python-config_python2-config_' {} \;

    export PYTHON=/usr/bin/python2
    export PYTHON_CONFIG=/usr/bin/python2-config

     ./configure --prefix=/usr --with-python=/usr/bin/python2

    make
}

package() {
    cd $pkgname-$pkgver

    install -d $_pythondir
    PYTHONPATH=$_pythondir make DESTDIR="$pkgdir" install

    install -d "$pkgdir/usr/share/licenses/$pkgname"
    install -m644 COPYING "$pkgdir/usr/share/licenses/$pkgname/"
} 
