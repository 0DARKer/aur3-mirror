# Contributor: 3ED <krzysztof1987__at__gmail__dot__com>

pkgname=pydefrag-bzr
_bzrmod=pfbh
pkgver=122
pkgrel=3
pkgdesc="The defragmenter is written using a simple combination of filefrag (a readily available fragmentation checker for Linux) and atomic copy. Inspired by Gentoo's fragcheck.pl and Con Kolivas's defrag script. (pfbh branch)"
arch=('any')
url="https://code.launchpad.net/~brywilharris/pyfragtools/pfbh"
license=('GPL')
makedepends=('bzr')
depends=('python2' 'rsync')
optdepends=("psyco27-svn: JIT compiler for Python 2.7 (development version)")

source=('bzr+http://bazaar.launchpad.net/~brywilharris/pyfragtools/pfbh/')
md5sums=('SKIP')

pkgver() {
  cd $_bzrmod
  bzr revno
}

prepare() {
  cd $_bzrmod

  # overwriting..
  install -dm755 "${srcdir}"/patched
  install -m 755 "${srcdir}/${_bzrmod}"/pydefrag "${srcdir}"/patched/pydefrag

  # in that way because this is bzr... :[
  if head -n1 "${srcdir}"/patched/pydefrag|grep -q 'python$'; then
    sed 's:python$:python2:' -i "${srcdir}"/patched/pydefrag
  fi
}

package() {
  install -dm755 "${pkgdir}"/usr/sbin
  install -m 755 "${srcdir}"/patched/pydefrag "${pkgdir}"/usr/sbin
}
