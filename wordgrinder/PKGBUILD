# Maintainer: Kyle Keen <keenerd@gmail.com>
# Contributor: Henning Garus <henning.garus@gmail.com>

pkgname=wordgrinder
pkgver=0.3.3
pkgrel=3
pkgdesc="A word processor for processing words"
url="http://wordgrinder.sourceforge.net/"
arch=('i686' 'x86_64')
license=('MIT')
depends=('ncurses' 'lua51-filesystem>=1.4.1')
source=("http://downloads.sourceforge.net/$pkgname/$pkgname-$pkgver.tar.bz2"
        "http://downloads.sourceforge.net/project/primemover/primemover-0.1.6.2.tar.bz2")
md5sums=('1ae3bcf2fc4ee027bdd9518a73733505'
         '1ab641bc4b3ce1efb60890ac8b572959')
        

build() {
  # update build tool
  cd "$srcdir/primemover-0.1.6.2"
  sed -i 's/\tlua/&5.1/' build
  ./build && return 0
  cp bin/pm_uncompressed "$srcdir/$pkgname-$pkgver/pm"

  cd "$srcdir/$pkgname-$pkgver"

  sed -i 's/luac/luac5.1/' tools/lua.pm
  sed -i 's|usr/bin/lua|usr/bin/lua51|' pm

  #adjust prefix
  #make manpath FHS compliant
  sed -i pmfile \
    -e "/^PREFIX =/c PREFIX = \"$pkgdir/usr\"" \
    -e 's@/man/man1/@/share&@g' 

  ./pm install

  install -Dm644 COPYING "$pkgdir/usr/share/licenses/$pkgname/COPYING"
}
