# Maintainer: Stefan Damm <autama at nurfuerspam.de>

pkgname=qtwebengine
pkgver=1
pkgrel=2
pkgdesc="A Chromium integration for QT."
arch=('x86_64')
url="https://qt.gitorious.org/qt-labs/qtwebengine/source/39a0d09358a8cae4a3d65ed13b81a810355571e5:README.md"
license=('custom')
makedepends=('git')
provides=('libwebrtc')
source=('atk_focus.patch' 'v8_not_found.patch')
md5sums=('1341660de041b6eba77856345e0c5038'
         'fe61c5b64b7de077ce545d9adf15bb16')

_gitroot="git://gitorious.org/qt-labs/qtwebengine.git"
_gitname=qtwebengine

prepare() {
  cd "${srcdir}"

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
  else
    git clone $_gitroot
  fi
  
  # ugly workaround, taken from libwebrtc package
  mkdir -p .bin
  ln -sf /usr/bin/python2 "$(pwd)"/.bin/python
  export PATH="$(pwd)"/.bin:"${PATH}"

  git submodule init && git submodule update --recursive

  patch -p 1 -d "${srcdir}"/qtwebengine -i "$srcdir/v8_not_found.patch"
  patch -p 1 -d "${srcdir}"/qtwebengine/src/3rdparty -i "$srcdir/atk_focus.patch"
}

build() {
  cd "${srcdir}"/qtwebengine
  export PATH="$(pwd)"/.bin:"${PATH}"

  qmake -r
  make
  make docs
  make html_docs
}

package() {
  cd "${srcdir}"/qtwebengine
  export PATH="$(pwd)"/.bin:"${PATH}"
  export INSTALL_ROOT="${pkgdir}"

  make install
  make install_docs
  
}

# vim:set ts=2 sw=2 et:

