diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/initpost util-vserver-0.30.216-pre2967/distrib/arch/initpost
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/initpost	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/initpost	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,80 @@
+#!/bin/bash
+
+# Copyright (C) 2009 Jonathan Liu <net147@gmail.com>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; version 2 of the License.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+## Called as: initpost <cfgdir> <path of util-vserver-vars>
+
+cfgdir="$1"
+vdir="$cfgdir"/vdir
+. "$2"
+
+# go to vdir for chroot-sh
+pushd "$vdir" &>/dev/null
+
+# helper for sed in chroot
+chrootsed() {
+    local file="$1"
+    shift
+
+    sedtmp=$($_MKTEMP chrootsed.XXXXXX)
+
+    $_CHROOT_SH cat "$file" | $_SED "$@" > $sedtmp
+    $_CHROOT_SH truncate "$file" < $sedtmp
+
+    $_RM -f $sedtmp
+}
+
+echo ">>> Fixing /etc/syslog-ng.conf..."
+chrootsed /etc/syslog-ng.conf \
+    -e '/file("\/proc\/kmsg");/d'
+
+echo ">>> Fixing /etc/rc.conf..."
+chrootsed /etc/rc.conf \
+    -e 's#^DAEMONS=.*$#DAEMONS=(syslog-ng crond)#'
+
+if test -r "$cfgdir"/uts/nodename; then
+    echo ">>> Setting hostname..."
+    chrootsed /etc/rc.conf \
+        -e "s#\(^HOSTNAME\)=.*#\1=\"$(<"$cfgdir"/uts/nodename)\"#"
+fi
+
+echo ">>> Installing init scripts..."
+$_CHROOT_SH mkdir /opt &>/dev/null || :
+$_CHROOT_SH mkdir /opt/vserver-init >/dev/null
+
+$_CAT "$__DISTRIBDIR"/arch/rc | \
+$_CHROOT_SH truncate   /opt/vserver-init/rc
+$_CHROOT_SH chmod 0755 /opt/vserver-init/rc
+
+$_CAT "$__DISTRIBDIR"/arch/rc.sysinit | \
+$_CHROOT_SH truncate   /opt/vserver-init/rc.sysinit
+$_CHROOT_SH chmod 0755 /opt/vserver-init/rc.sysinit
+
+$_CAT "$__DISTRIBDIR"/arch/rc.shutdown | \
+$_CHROOT_SH truncate   /opt/vserver-init/rc.shutdown
+$_CHROOT_SH chmod 0755 /opt/vserver-init/rc.shutdown
+
+$_CAT "$__DISTRIBDIR"/arch/vserver.functions.d | \
+$_CHROOT_SH truncate   /etc/rc.d/functions.d/vserver
+$_CHROOT_SH chmod 0644 /etc/rc.d/functions.d/vserver
+
+echo /opt/vserver-init/rc > "$cfgdir"/apps/init/cmd.start
+echo /opt/vserver-init/rc > "$cfgdir"/apps/init/cmd.stop
+
+# restore original directory
+popd &>/dev/null
+
+# vim:set ts=4 sw=4 et:
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/initpre util-vserver-0.30.216-pre2967/distrib/arch/initpre
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/initpre	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/initpre	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,53 @@
+#!/bin/bash
+
+# Copyright (C) 2009 Jonathan Liu <net147@gmail.com>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; version 2 of the License.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+## Called as: initpre <cfgdir> <path of util-vserver-vars>
+
+cfgdir="$1"
+vdir="$cfgdir"/vdir
+. "$2"
+
+# initstyle sanity
+initstyle=sysv
+test -e "$cfgdir"/apps/init/style && initstyle=$(<"$cfgdir"/apps/init/style)
+
+echo ">>> Checking init-style... $initstyle."
+
+if test "$initstyle" != "sysv"; then
+	echo "!!! The init-style you specified is not supported for Arch Linux."
+	echo "!!! Please use: sysv."
+fi
+
+# go to vdir for chroot-sh
+pushd "$vdir" &>/dev/null
+
+# create new pacman database
+echo ">>> Creating new pacman database..."
+$_CHROOT_SH mkdir /var &>/dev/null || :
+$_CHROOT_SH mkdir /var/lib &>/dev/null || :
+$_CHROOT_SH mkdir /var/lib/pacman &>/dev/null || :
+
+# set permissions
+echo ">>> Setting permissions..."
+$_CHROOT_SH chmod 0555 /proc
+
+# restore original directory
+popd &>/dev/null
+
+echo ">>> Installing packages..."
+
+# vim:set ts=4 sw=4 et:
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/mirror util-vserver-0.30.216-pre2967/distrib/arch/mirror
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/mirror	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/mirror	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1 @@
+ftp://mirrors.easynews.com/linux/archlinux
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/packages util-vserver-0.30.216-pre2967/distrib/arch/packages
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/packages	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/packages	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,2 @@
+base
+base-devel
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/rc util-vserver-0.30.216-pre2967/distrib/arch/rc
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/rc	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/rc	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,33 @@
+#!/bin/bash
+
+# Copyright (C) 2009 Jonathan Liu <net147@gmail.com>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; version 2 of the License.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+case $RUNLEVEL in
+    2|3|4|5)
+        /opt/vserver-init/rc.sysinit
+        /etc/rc.single
+        /etc/rc.multi
+        ;;
+    6)
+        /opt/vserver-init/rc.shutdown
+        ;;
+    *)
+        ;;
+esac
+
+exit 0
+
+# vim:set ts=4 sw=4 et:
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/rc.shutdown util-vserver-0.30.216-pre2967/distrib/arch/rc.shutdown
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/rc.shutdown	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/rc.shutdown	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,59 @@
+#!/bin/bash
+#
+# /etc/rc.shutdown
+#
+
+. /etc/rc.conf
+. /etc/rc.d/functions
+
+# avoid staircase effect
+/bin/stty onlcr
+
+echo " "
+printhl "Initiating Shutdown..."
+echo " "
+
+# avoid NIS hanging syslog-ng on shutdown by unsetting the domainname
+if [ -x /bin/domainname ]; then
+	/bin/domainname ""
+fi
+
+if [ -x /etc/rc.local.shutdown ]; then
+	/etc/rc.local.shutdown
+fi
+
+if [ "$PREVLEVEL" = "3" -o "$PREVLEVEL" = "5" ]; then
+	# Shutdown daemons
+	let i=${#DAEMONS[@]}
+	while [ $i -ge 0 ]; do
+		if [ "${DAEMONS[$i]:0:1}" != '!' ]; then
+			ck_daemon ${DAEMONS[$i]#@} || stop_daemon ${DAEMONS[$i]#@}
+		fi
+		let i=i-1
+	done
+	# find any leftover daemons and shut them down in reverse order
+	if [ -d /var/run/daemons ]; then
+		for daemon in $(/bin/ls -1t /var/run/daemons); do
+			stop_daemon $daemon
+		done
+	fi
+fi
+
+# Terminate all processes
+stat_busy "Sending SIGTERM To Processes"
+/sbin/killall5 -15 &> /dev/null
+/bin/sleep 5
+stat_done
+
+stat_busy "Sending SIGKILL To Processes"
+/sbin/killall5 -9 &> /dev/null
+/bin/sleep 1
+stat_done
+
+# Write to wtmp file
+/sbin/halt -w
+
+exit 0
+
+# End of file
+# vim: set ts=2 sw=2 noet:
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/rc.sysinit util-vserver-0.30.216-pre2967/distrib/arch/rc.sysinit
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/rc.sysinit	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/rc.sysinit	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,88 @@
+#!/bin/bash
+#
+# /etc/rc.sysinit
+#
+
+. /etc/rc.conf
+. /etc/rc.d/functions
+
+echo " "
+printhl "Arch Linux\n"
+printhl "${C_H2}http://www.archlinux.org"
+printhl "Copyright 2002-2007 Judd Vinet"
+printhl "Copyright 2007-2009 Aaron Griffin"
+printhl "Distributed under the GNU General Public License (GPL)"
+printsep
+
+# start up our mini logger until syslog takes over
+/sbin/minilogd
+
+# Static /dev, our last resort
+status "Using static /dev filesystem" true
+
+# bring up the loopback interface
+if [ -d /sys/class/net/lo ]; then
+	stat_busy "Bringing up loopback interface"
+	/sbin/ifconfig lo 127.0.0.1 up
+	if [ $? -ne 0 ]; then
+		stat_fail
+	else
+		stat_done
+	fi
+fi
+
+stat_busy "Removing Leftover Files"
+/bin/rm -f /etc/nologin &>/dev/null
+/bin/rm -f /etc/shutdownpid &>/dev/null
+/bin/rm -f /var/lock/* &>/dev/null
+/bin/rm -rf /tmp/* /tmp/.* &>/dev/null
+/bin/rm -f /forcefsck &>/dev/null
+(cd /var/run && /usr/bin/find . ! -type d -exec /bin/rm -f -- {} \; )
+: > /var/run/utmp
+/bin/chmod 0664 /var/run/utmp
+# Keep {x,k,g}dm happy with xorg
+/bin/mkdir /tmp/.ICE-unix && /bin/chmod 1777 /tmp/.ICE-unix
+/bin/mkdir /tmp/.X11-unix && /bin/chmod 1777 /tmp/.X11-unix
+stat_done
+
+#status "Updating Shared Library Links" /sbin/ldconfig
+
+if [ "$HOSTNAME" != "" ]; then
+	status "Setting Hostname: $HOSTNAME" /bin/hostname $HOSTNAME
+fi
+
+# Set the NIS domain name, if necessary
+[ -f /etc/conf.d/nisdomainname ] && . /etc/conf.d/nisdomainname
+if [ "$NISDOMAINNAME" != "" ]; then
+	status "Setting NIS Domain Name: $NISDOMAINNAME" /bin/nisdomainname $NISDOMAINNAME
+fi
+
+# Flush old locale settings
+: >/etc/profile.d/locale.sh
+/bin/chmod 755 /etc/profile.d/locale.sh
+# Set user defined locale
+[ -z "$LOCALE" ] && LOCALE="en_US"
+stat_busy "Setting Locale: $LOCALE"
+echo "export LANG=$LOCALE" >>/etc/profile.d/locale.sh
+stat_done
+
+# Adding persistent network/cdrom generated rules
+if [ -f "/dev/.udev/tmp-rules--70-persistent-cd.rules" ]; then
+	stat_busy "Adding persistent cdrom udev rules"
+	/bin/cat /dev/.udev/tmp-rules--70-persistent-cd.rules >> /etc/udev/rules.d/70-persistent-cd.rules
+	stat_done
+fi
+if [ -f "/dev/.udev/tmp-rules--70-persistent-net.rules" ]; then
+	stat_busy "Adding persistent network udev rules"
+	/bin/cat /dev/.udev/tmp-rules--70-persistent-net.rules >> /etc/udev/rules.d/70-persistent-net.rules
+	stat_done
+fi
+
+# Save our dmesg output from this boot
+if [ -f /var/log/dmesg.log ]; then
+	/bin/rm /var/log/dmesg.log
+fi
+/bin/dmesg > /var/log/dmesg.log
+
+# End of file
+# vim: set ts=2 noet:
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/arch/vserver.functions.d util-vserver-0.30.216-pre2967/distrib/arch/vserver.functions.d
--- util-vserver-0.30.216-pre2967.orig/distrib/arch/vserver.functions.d	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/arch/vserver.functions.d	2011-05-18 21:46:58.002930185 +1000
@@ -0,0 +1,15 @@
+USECOLOR="yes"
+
+C_MAIN="\033[1;37;40m"      # main text
+C_OTHER="\033[1;34;40m"     # prefix & brackets
+C_SEPARATOR="\033[1;30;40m" # separator
+
+C_BUSY="\033[0;36;40m"      # busy
+C_FAIL="\033[1;31;40m"      # failed
+C_DONE="\033[1;37;40m"      # completed
+C_BKGD="\033[1;35;40m"      # backgrounded
+
+C_H1="\033[1;37;40m"        # highlight text 1
+C_H2="\033[1;36;40m"        # highlight text 2
+
+C_CLEAR="\033[1;0m"
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/Makefile.am util-vserver-0.30.216-pre2967/distrib/Makefile.am
--- util-vserver-0.30.216-pre2967.orig/distrib/Makefile.am	2011-05-15 02:36:31.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/Makefile.am	2011-05-18 21:46:58.002930185 +1000
@@ -39,7 +39,9 @@
 			   gentoo/initpre \
 			   debian/initpost \
 			   alpine/initpre \
-			   alpine/initpost
+			   alpine/initpost \
+			   arch/initpre \
+			   arch/initpost
 
 nobase_distrib_DATA	=  defaults/devs \
 			   defaults/apt.conf \
@@ -94,7 +96,10 @@
 			   suse91/apt/rpmpriorities suse91/pkgs/01 suse91/pkgs/02 \
 			   suse91/rpm/macros \
 			   gentoo/init-vserver.sh gentoo/net.vserver \
-			   gentoo/reboot.sh gentoo/shutdown.sh
+			   gentoo/reboot.sh gentoo/shutdown.sh \
+			   arch/mirror arch/packages \
+			   arch/rc arch/rc.shutdown arch/rc.sysinit \
+			   arch/vserver.functions.d
 
 nobase_confdistrib_DATA	=  rh9/apt/sources.list \
 			   fc1/apt/sources.list \
diff -Nur util-vserver-0.30.216-pre2967.orig/distrib/Makefile.am.orig util-vserver-0.30.216-pre2967/distrib/Makefile.am.orig
--- util-vserver-0.30.216-pre2967.orig/distrib/Makefile.am.orig	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/distrib/Makefile.am.orig	2011-05-15 02:36:31.000000000 +1000
@@ -0,0 +1,138 @@
+## $Id$
+
+## Copyright (C) 2003 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
+##  
+## This program is free software; you can redistribute it and/or modify
+## it under the terms of the GNU General Public License as published by
+## the Free Software Foundation; version 2 of the License.
+##  
+## This program is distributed in the hope that it will be useful,
+## but WITHOUT ANY WARRANTY; without even the implied warranty of
+## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+## GNU General Public License for more details.
+##  
+## You should have received a copy of the GNU General Public License
+## along with this program; if not, write to the Free Software
+## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+confdir =		$(sysconfdir)/vservers
+defaultsdir =		$(pkglibdir)/defaults
+distribdir =		$(pkglibdir)/distributions
+confdistribdir =	$(confdir)/.distributions
+confdefaultsdir =	$(confdir)/.defaults
+
+defaults_DATA =		misc/debootstrap.mirror \
+			misc/debootstrap.uri \
+			misc/fstab \
+			misc/mtab \
+			misc/vprocunhide-files \
+			misc/vunify-exclude \
+			misc/environment \
+			misc/context.start \
+			misc/h2ext.desc
+
+nobase_distrib_SCRIPTS	=  redhat/initpost \
+			   redhat/initpre \
+			   redhat/rc.sysinit \
+			   redhat/initctl \
+			   gentoo/initpost \
+			   gentoo/initpre \
+			   debian/initpost \
+			   alpine/initpre \
+			   alpine/initpost
+
+nobase_distrib_DATA	=  defaults/devs \
+			   defaults/apt.conf \
+			   defaults/rpm/macros \
+			   defaults/apt/apt.conf \
+			   template/initpost template/initpre \
+			   rh9/apt/rpmpriorities    rh9/pkgs/01    rh9/pkgs/02 \
+			   fc1/apt/rpmpriorities    fc1/pkgs/01    fc1/pkgs/02 \
+			   fc2/apt/rpmpriorities    fc2/pkgs/01    fc2/pkgs/02 \
+			   fc3/apt/rpmpriorities    fc3/pkgs/01    fc3/pkgs/02    fc3/pkgs/03 \
+			   fc3/yum/yum.conf $(wildcard $(srcdir)/fc3/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/fc3/rpmlist.d/*.lst) $(wildcard $(srcdir)/fc3/rpmlist.d/*.opt) \
+			   fc4/apt/rpmpriorities    fc4/pkgs/01    fc4/pkgs/02    fc4/pkgs/03 \
+			   fc4/yum/yum.conf $(wildcard $(srcdir)/fc4/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/fc4/rpmlist.d/*.lst) $(wildcard $(srcdir)/fc4/rpmlist.d/*.opt) \
+			   fc5/apt/rpmpriorities    fc5/pkgs/01    fc5/pkgs/02    fc5/pkgs/03 \
+			   fc5/yum/yum.conf $(wildcard $(srcdir)/fc5/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/fc5/rpmlist.d/*.lst) $(wildcard $(srcdir)/fc5/rpmlist.d/*.opt) \
+			   fc6/apt/rpmpriorities    fc6/pkgs/01    fc6/pkgs/02    fc6/pkgs/03 \
+			   fc6/yum/yum.conf $(wildcard $(srcdir)/fc6/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/fc6/rpmlist.d/*.lst) $(wildcard $(srcdir)/fc6/rpmlist.d/*.opt) \
+			   f7/apt/rpmpriorities    f7/pkgs/01    f7/pkgs/02    f7/pkgs/03 \
+			   f7/yum/yum.conf $(wildcard $(srcdir)/f7/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f7/rpmlist.d/*.lst) $(wildcard $(srcdir)/f7/rpmlist.d/*.opt) \
+			   f8/apt/rpmpriorities    f8/pkgs/01    f8/pkgs/02    f8/pkgs/03 \
+			   f8/yum/yum.conf $(wildcard $(srcdir)/f8/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f8/rpmlist.d/*.lst) $(wildcard $(srcdir)/f8/rpmlist.d/*.opt) \
+			   $(wildcard $(srcdir)/f8/pubkeys/RPM-GPG*) \
+			   f9/pkgs/01 f9/pkgs/02 f9/pkgs/03 f9/yum/yum.conf \
+			   $(wildcard $(srcdir)/f9/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f9/rpmlist.d/*.lst) $(wildcard $(srcdir)/f9/rpmlist.d/*.opt) \
+			   $(wildcard $(srcdir)/f9/pubkeys/RPM-GPG*) \
+			   f10/pkgs/01 f10/pkgs/02 f10/pkgs/03 f10/yum/yum.conf \
+			   $(wildcard $(srcdir)/f10/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f10/rpmlist.d/*.lst) $(wildcard $(srcdir)/f10/rpmlist.d/*.opt) \
+			   f11/pkgs/01 f11/pkgs/02 f11/pkgs/03 f11/yum/yum.conf \
+			   $(wildcard $(srcdir)/f11/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f11/rpmlist.d/*.lst) $(wildcard $(srcdir)/f11/rpmlist.d/*.opt) \
+			   f12/pkgs/01 f12/pkgs/02 f12/pkgs/03 f12/yum/yum.conf \
+			   $(wildcard $(srcdir)/f12/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f12/rpmlist.d/*.lst) $(wildcard $(srcdir)/f12/rpmlist.d/*.opt) \
+			   f13/pkgs/01 f13/pkgs/02 f13/pkgs/03 f13/yum/yum.conf \
+			   $(wildcard $(srcdir)/f13/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f13/rpmlist.d/*.lst) $(wildcard $(srcdir)/f13/rpmlist.d/*.opt) \
+			   f14/pkgs/01 f14/pkgs/02 f14/pkgs/03 f14/yum/yum.conf \
+			   $(wildcard $(srcdir)/f14/yum.repos.d/*.repo) \
+			   $(wildcard $(srcdir)/f14/rpmlist.d/*.lst) $(wildcard $(srcdir)/f14/rpmlist.d/*.opt) \
+			   centos4/pkgs/01 centos4/pkgs/02 centos4/pkgs/03 \
+			   centos4/yum/yum.conf $(wildcard $(srcdir)/centos4/yum.repos.d/*.repo) \
+			   centos5/pkgs/01 centos5/pkgs/02 centos5/pkgs/03 \
+			   centos5/yum/yum.conf $(wildcard $(srcdir)/centos5/yum.repos.d/*.repo) \
+			   suse91/apt/rpmpriorities suse91/pkgs/01 suse91/pkgs/02 \
+			   suse91/rpm/macros \
+			   gentoo/init-vserver.sh gentoo/net.vserver \
+			   gentoo/reboot.sh gentoo/shutdown.sh
+
+nobase_confdistrib_DATA	=  rh9/apt/sources.list \
+			   fc1/apt/sources.list \
+			   fc2/apt/sources.list \
+			   fc3/apt/sources.list \
+			   fc4/apt/sources.list \
+			   fc5/apt/sources.list \
+			   fc6/apt/sources.list \
+			   f7/apt/sources.list \
+			   suse91/apt/sources.list
+
+AM_INSTALLCHECK_STD_OPTIONS_EXEMPT \
+			=  $(nobase_distrib_SCRIPTS)
+
+EXTRA_DIST		=  $(nobase_distrib_DATA) \
+			   $(nobase_distrib_SCRIPTS) \
+			   $(nobase_confdistrib_DATA) \
+			   $(defaults_DATA)
+
+redhat_style		=  rh9 fc1 fc2 fc3 fc4 fc5 fc6 f7 f8 f9 f10 f11 f12 f13 f14 centos4 centos5
+sid_style		=  etch lenny squeeze wheezy sid
+
+install-exec-hook:	install-notify-xtra
+install-data-hook:	install-data-xtras
+
+install-data-xtras:
+			l="$(redhat_style)"; for i in $$l; do \
+				ln -sf ../redhat/initpost $(DESTDIR)$(distribdir)/$$i/ && \
+				ln -sf ../redhat/initpre  $(DESTDIR)$(distribdir)/$$i/; \
+			done
+			l="$(sid_style)"; for i in $$l; do \
+				ln -sf debian $(DESTDIR)$(distribdir)/$$i; \
+			done
+			$(mkinstalldirs) $(DESTDIR)$(confdir) \
+				$(DESTDIR)$(confdistribdir)/.common/pubkeys \
+				$(DESTDIR)$(confdefaultsdir) \
+				$(DESTDIR)$(confdefaultsdir)/apps/vunify/hash \
+				$(DESTDIR)$(confdefaultsdir)/files
+
+
+include $(top_srcdir)/m4/install-notify.am
diff -Nur util-vserver-0.30.216-pre2967.orig/scripts/Makefile-files util-vserver-0.30.216-pre2967/scripts/Makefile-files
--- util-vserver-0.30.216-pre2967.orig/scripts/Makefile-files	2011-05-15 02:36:31.000000000 +1000
+++ util-vserver-0.30.216-pre2967/scripts/Makefile-files	2011-05-18 21:46:58.006263836 +1000
@@ -49,6 +49,7 @@
 				scripts/vserver-build.template \
 				scripts/vserver-build.rsync \
 				scripts/vserver-build.clone \
+				scripts/vserver-build.pacman \
 				scripts/vserver-build.functions \
 				scripts/vserver-build.functions.apt \
 				scripts/vserver-build.functions.rpm \
diff -Nur util-vserver-0.30.216-pre2967.orig/scripts/Makefile-files.orig util-vserver-0.30.216-pre2967/scripts/Makefile-files.orig
--- util-vserver-0.30.216-pre2967.orig/scripts/Makefile-files.orig	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/scripts/Makefile-files.orig	2011-05-15 02:36:31.000000000 +1000
@@ -0,0 +1,136 @@
+## $Id$  -*- makefile -*-
+
+## Copyright (C) 2003 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
+##  
+## This program is free software; you can redistribute it and/or modify
+## it under the terms of the GNU General Public License as published by
+## the Free Software Foundation; either version 2, or (at your option)
+## any later version.
+##  
+## This program is distributed in the hope that it will be useful,
+## but WITHOUT ANY WARRANTY; without even the implied warranty of
+## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+## GNU General Public License for more details.
+##  
+## You should have received a copy of the GNU General Public License
+## along with this program; if not, write to the Free Software
+## Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+##  
+
+AM_INSTALLCHECK_STD_OPTIONS_EXEMPT += \
+				scripts/vapt-get-worker \
+				scripts/vrpm-worker \
+				scripts/vyum-worker \
+				scripts/vrpm-preload \
+				scripts/save_s_context \
+				scripts/vservers.grabinfo.sh \
+				scripts/vpstree \
+				scripts/vserver-wrapper \
+				scripts/vsysvwrapper \
+				scripts/vtop \
+				scripts/h2ext-worker \
+				scripts/legacy/distrib-info \
+				scripts/legacy/vps \
+				scripts/legacy/save_s_context \
+				scripts/legacy/vserver \
+				scripts/legacy/rootshell \
+				scripts/legacy/vserver-copy \
+				scripts/legacy/vserverkillall
+
+
+scripts_pkglib_src_DTA =	scripts/functions \
+				scripts/vserver-build.apt-rpm \
+				scripts/vserver-build.skeleton \
+				scripts/vserver-build.debootstrap \
+				scripts/vserver-build.fai \
+				scripts/vserver-build.rpm \
+				scripts/vserver-build.urpmi \
+				scripts/vserver-build.yum \
+				scripts/vserver-build.template \
+				scripts/vserver-build.rsync \
+				scripts/vserver-build.clone \
+				scripts/vserver-build.functions \
+				scripts/vserver-build.functions.apt \
+				scripts/vserver-build.functions.rpm \
+				scripts/vserver-build.functions.pkgmgmt \
+				scripts/vserver-build.functions.yum \
+				scripts/vserver-setup.functions \
+				scripts/vserver.functions \
+				scripts/vserver.start \
+				scripts/vserver.stop \
+				scripts/vserver.suexec \
+				scripts/vserver.delete \
+				scripts/vserver-init.functions
+
+scripts_pkglib_gen_DTA =	scripts/util-vserver-vars
+
+scripts_pkglib_src_SCRPTS =	scripts/pkgmgmt \
+				scripts/vapt-get-worker \
+				scripts/vpkg \
+				scripts/vrpm-worker \
+				scripts/vrpm-preload \
+				scripts/start-vservers \
+				scripts/vprocunhide \
+				scripts/vserver-build \
+				scripts/vserver-wrapper \
+				scripts/vservers.grabinfo.sh \
+				scripts/vshelper \
+				scripts/vsysvwrapper \
+				scripts/vurpm-worker \
+				scripts/vyum-worker \
+				scripts/h2ext-worker
+
+scripts_legacy_src_SCRPTS =	scripts/legacy/save_s_context \
+				scripts/legacy/vserver \
+				scripts/legacy/rootshell \
+				scripts/legacy/distrib-info \
+				scripts/legacy/vserverkillall
+scripts_legacy_gen_SCRPTS =	scripts/legacy/vps
+scripts_legacy_src_PRGS =	scripts/legacy/vserver-copy
+
+scripts_sbin_src_PRGS =		scripts/chbind \
+				scripts/chcontext \
+				scripts/vapt-get \
+				scripts/vdispatch-conf \
+				scripts/vemerge \
+				scripts/vesync \
+				scripts/vmount \
+				scripts/vnamespace \
+				scripts/vpstree \
+				scripts/vrpm \
+				scripts/vserver \
+				scripts/vsomething \
+				scripts/vtop \
+				scripts/vupdateworld \
+				scripts/vurpm \
+				scripts/vyum
+
+scripts_sbin_gen_PRGS =
+scripts_sbincfg_gen_DTA =
+
+scripts_subst_SRCS =		scripts/util-vserver-vars.pathsubst \
+				scripts/legacy/vps.pathsubst
+
+
+
+sbin_SCRIPTS +=			$(scripts_sbin_src_PRGS) $(scripts_sbin_gen_PRGS) \
+				$(scripts_legacy_src_PRGS)
+scripts_sbincfg_DTA =		$(scripts_sbincfg_gen_DTA)
+pkglib_SCRIPTS +=		$(scripts_pkglib_src_SCRPTS)
+legacy_SCRIPTS +=		$(scripts_legacy_src_SCRPTS) $(scripts_legacy_gen_SCRPTS)
+pkglib_DATA +=			$(scripts_pkglib_src_DTA) $(scripts_pkglib_gen_DTA)
+
+CLEANFILES +=			$(scripts_pkglib_gen_DTA) \
+				$(scripts_sbin_gen_PRGS) \
+				$(scripts_sbincfg_gen_DTA) \
+				$(scripts_legacy_gen_SCRPTS)
+
+EXTRA_DIST +=			$(scripts_pkglib_src_DTA) \
+				$(scripts_pkglib_src_SCRPTS) \
+				$(scripts_legacy_src_SCRPTS) \
+				$(scripts_legacy_src_PRGS) \
+				$(scripts_sbin_src_PRGS) \
+				$(scripts_subst_SRCS)
+
+scripts/util-vserver-vars:	scripts/.util-vserver-vars.pathsubst.stamp
+scripts/legacy/vps:		scripts/legacy/.vps.pathsubst.stamp
diff -Nur util-vserver-0.30.216-pre2967.orig/scripts/vserver-build util-vserver-0.30.216-pre2967/scripts/vserver-build
--- util-vserver-0.30.216-pre2967.orig/scripts/vserver-build	2011-05-15 02:36:31.000000000 +1000
+++ util-vserver-0.30.216-pre2967/scripts/vserver-build	2011-05-18 21:48:22.141142377 +1000
@@ -77,6 +77,8 @@
                 ...  installs a guest by rsyncing from <source> to the guest root
     clone       ... -- [-d <distribution>] --source <source> [--exclude-from <exclude-list>]
                 ...  clones a guest by linking unified files and copying the rest
+    pacman      ... -- -d <distribution> [-a <architecture>] [-c <cache-dir>] [-m <mirror>]
+                ...  bootstraps the vserver using Arch Linux's pacman package manager
 
 Please report bugs to $PACKAGE_BUGREPORT"
     exit 0
@@ -137,7 +139,7 @@
 
 case x"$method" in
     (xlegacy)	exec $_VSERVER_LEGACY "$VSERVER_NAME" build "$@" ;;
-    (xapt-rpm|xcopy|xskeleton|xdebootstrap|xyum|xrpm|xtemplate|xfai|xrsync|xclone|xurpmi)
+    (xapt-rpm|xcopy|xskeleton|xdebootstrap|xyum|xrpm|xtemplate|xfai|xrsync|xclone|xpacman|xurpmi)
 		. $__PKGLIBDIR/vserver-build.$method
 		;;
     (x)		panic $"No build-method specified";;
diff -Nur util-vserver-0.30.216-pre2967.orig/scripts/vserver-build.orig util-vserver-0.30.216-pre2967/scripts/vserver-build.orig
--- util-vserver-0.30.216-pre2967.orig/scripts/vserver-build.orig	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/scripts/vserver-build.orig	2011-05-15 02:36:31.000000000 +1000
@@ -0,0 +1,145 @@
+#! /bin/bash
+# $Id$
+
+# Copyright (C) 2003,2004,2005 Enrico Scholz <enrico.scholz@informatik.tu-chemnitz.de>
+#  
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; version 2 of the License.
+#  
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#  
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+: ${UTIL_VSERVER_VARS:=/usr/lib/util-vserver/util-vserver-vars}
+test -e "$UTIL_VSERVER_VARS" || {
+    echo $"Can not find util-vserver installation (the file '$UTIL_VSERVER_VARS' would be expected); aborting..." >&2
+    exit 1
+}
+. "$UTIL_VSERVER_VARS"
+. "$_LIB_FUNCTIONS"
+. "$_LIB_VSERVER_SETUP_FUNCTIONS"
+. "$_LIB_VSERVER_BUILD_FUNCTIONS"
+
+### Some local functions
+
+function showHelp()
+{
+    echo \
+$"Usage: $(basename $0) -m <method> -n <name> --force <cfg-options>*
+    --rootdir <dir> --pkgbase <dir> [--] <method-args>*
+
+Options:
+    --force     ...  remove/rename already existing vservers with the same
+                     name
+    --keep      ...  do not delete generated files and directories when
+                     build of vserver failed.
+    -m <method> ...  use method <method>; see below for possible values
+    --rootdir <dir>
+                ...  [default: $__DEFAULT_VSERVERDIR]
+    --pkgbase <dir>
+                ...  [default: $__DEFAULT_VSERVERPKGDIR]
+      
+cfg-options are: $SETUP_HELPMSG
+
+Possible methods are:
+    legacy      ...  the \"old\" copy-all-from-host method, which requires the
+                     old legacy  vserver-legacy script;  with  this method the
+		     cfg-options will be ignored
+    apt-rpm     ... -- -d <distribution>
+                ...  installs the base-packages of the given distribution with
+		     help of 'vapt-get'
+    yum         ... -- -d <distribution> [-- <packages>*]
+                ...  installs the base-packages of the given distribution with
+		     help of 'vyum'
+    urpmi       ... -- -d <distribution> -m <mirror>
+    rpm         ... -- [-d <distribution>] --empty|([--force] [--nodeps] <manifest>)+
+                ...  installs lists of rpm-packages
+    skeleton    ... -- [<cmd> <args>*]
+                ...  installs a minimal skeleton filesystem, creates the
+		     configuration file and calls an optional command then
+    debootstrap ... -- -d <distribution> [-m <mirror>] [-s <script> ] [-- <debootstrap-options>*]
+                ...  bootstraps the vserver with Debian's 'debootstrap' package
+    template    ... -- (-t <tarball>)+ [-d <distribution>]
+                ...  installs a guest using tarball(s)
+    fai         ... -- [ -f <fai_vserver> ] [-n <nfsroot>] [-d <fai_dir> ] [ -a ]
+                     bootstraps the vserver with Debian Fully Automatic Installation
+                     -f means use the nfsroot and profile in the vserver <fai_vserver>
+                     -n <nfsroot> specifies the 'NFS' root explicitly
+                     -d <fai_dir> specifies the location of the FAI profile
+                     the -f option implies -n and -d are relative to the <fai_vserver>
+    rsync       ... -- [-d <distribution>] --source <source> [-- <rsync options>*]
+                ...  installs a guest by rsyncing from <source> to the guest root
+    clone       ... -- [-d <distribution>] --source <source> [--exclude-from <exclude-list>]
+                ...  clones a guest by linking unified files and copying the rest
+
+Please report bugs to $PACKAGE_BUGREPORT"
+    exit 0
+}
+
+function showVersion()
+{
+    echo \
+$"vserver-build $PACKAGE_VERSION -- initializes a vserver
+This program is part of $PACKAGE_STRING
+
+Copyright (C) 2003,2004,2005 Enrico Scholz
+This program is free software; you may redistribute it under the terms of
+the GNU General Public License.  This program has absolutely no warranty."
+    exit 0
+}
+
+### main starts here
+
+set -e
+
+declare -a default_opts=()
+test -n "$NO_DEFAULT_OPTS" || getFileArray default_opts "$__CONFDIR/.defaults/apps/build/options" || :
+
+tmp=$(getopt -o +m:n: --long keep,force,debug,help,version,rootdir:,pkgbase:,$SETUP_OPTIONS -n "$(basename $0)" -- \
+	"${default_opts[@]}" "$@") || exit 1
+eval set -- "$tmp"
+
+VSERVER_NAME=
+OPTION_FORCE=
+OPTION_DEBUG=0
+OPTION_KEEP=
+
+while true; do
+    case "$1" in
+	(--help)    showHelp $0 ;;
+	(--version) showVersion ;;
+	(--force)   OPTION_FORCE=1;;
+	(--keep)    OPTION_KEEP=1;;
+	(--debug)   let ++OPTION_DEBUG;  set -x;;
+	(--rootdir) ROOTDIR=$2;      shift;;
+	(--pkgbase) PKGCFGBASE=$2;   shift;;
+	(-m)	    method=$2;       shift;;
+	(-n)	    VSERVER_NAME=$2; shift;;
+	(--)	    shift; break;;
+	(*)
+	    { setup_setOption2 "$1" "$2" && shift; } || \
+	      panic $"vserver-build: internal error."
+	    ;;
+    esac
+    shift
+done
+
+test -n "$VSERVER_NAME" ||
+    panic $"Name of vserver not specified"
+
+setup_setDefaults "$VSERVER_NAME"
+
+case x"$method" in
+    (xlegacy)	exec $_VSERVER_LEGACY "$VSERVER_NAME" build "$@" ;;
+    (xapt-rpm|xcopy|xskeleton|xdebootstrap|xyum|xrpm|xtemplate|xfai|xrsync|xclone|xurpmi)
+		. $__PKGLIBDIR/vserver-build.$method
+		;;
+    (x)		panic $"No build-method specified";;
+    (*)		panic $"Unknown build-method '$method'";;
+esac
diff -Nur util-vserver-0.30.216-pre2967.orig/scripts/vserver-build.pacman util-vserver-0.30.216-pre2967/scripts/vserver-build.pacman
--- util-vserver-0.30.216-pre2967.orig/scripts/vserver-build.pacman	1970-01-01 10:00:00.000000000 +1000
+++ util-vserver-0.30.216-pre2967/scripts/vserver-build.pacman	2011-05-18 21:46:58.006263836 +1000
@@ -0,0 +1,110 @@
+# $Id$
+
+# Copyright (C) 2009 Jonathan Liu <net147@gmail.com>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; version 2 of the License.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+function findPacman()
+{
+    test ! -x "$PACMAN" || return 0
+
+    PACMAN=$(which pacman 2>/dev/null) ||
+    PACMAN=$(which pacman.static 2>/dev/null) || {
+        echo "Could not find 'pacman' or 'pacman.static' installed." >&2
+        exit 1
+    }
+}
+
+function findMirror
+{
+    local file
+    findFile file "$__DISTRIBDIR/$DISTRIBUTION"/mirror ""
+    test -z "$file" || read MIRROR <"$file"
+
+    test -n "$MIRROR" || {
+        echo "Could not find a suitable mirror. Please specify a mirror with the -m option." >&2
+        exit 1
+    }
+}
+
+function configurePacman
+{
+    PACMAN_CONFIG=$($_MKTEMP pacman.conf.XXXXXX)
+    trap "rm -f \"$PACMAN_CONFIG\"; base.__cleanup" EXIT
+
+    echo "[core]" > "$PACMAN_CONFIG"
+    echo "Server = $MIRROR/core/os/$ARCH" >> "$PACMAN_CONFIG"
+}
+
+function findPackages()
+{
+    local file
+    findFile file "$__DISTRIBDIR/$DISTRIBUTION"/packages ""
+    test -z "$file" || PACKAGES=$(<"$file")
+
+    test -n "$PACKAGES" || {
+        echo "Could not determine packages to install." >&2
+        exit 1
+    }
+}
+
+tmp=$(getopt -o '+d:a:c:m:' --long debug -n "$0" -- "$@") || exit 1
+eval set -- "$tmp"
+ARCH="$(uname -m)"
+MIRROR=
+PACMAN_CACHE=
+PACMAN_CONFIG=
+PACKAGES=
+
+while true; do
+    case "$1" in
+	-d)		DISTRIBUTION=$2; shift;;
+    -a)     ARCH=$2; shift;;
+    -c)     PACMAN_CACHE=$2; shift;;
+    -m)     MIRROR=$2; shift;;
+    --debug)    set -x;;
+    --)     shift; break ;;
+    *)      echo "vserver-build.pacman: internal error: unrecognized option '$1'" >&2
+            exit 1
+            ;;
+    esac
+    shift
+done
+
+getDistribution
+
+base.init
+base.initFilesystem "$OPTION_FORCE"
+
+setup_writeOption "$VSERVER_NAME"
+setup_writeInitialFstab
+
+findPacman
+findMirror
+configurePacman
+findPackages
+
+test -z "$BUILD_INITPRE"  || "$BUILD_INITPRE"  "$SETUP_CONFDIR" "$UTIL_VSERVER_VARS"
+
+if test -z "$PACMAN_CACHE"; then
+    "$PACMAN" -Sy --noconfirm --config "$PACMAN_CONFIG" --root "$VDIR" $PACKAGES
+else
+    "$PACMAN" -Sy --noconfirm --config "$PACMAN_CONFIG" --root "$VDIR" $PACKAGES --cachedir "$PACMAN_CACHE"
+fi
+
+test -z "$BUILD_INITPOST" || "$BUILD_INITPOST" "$SETUP_CONFDIR" "$UTIL_VSERVER_VARS"
+
+base.setSuccess
+
+# vim:set ts=4 sts=4 sw=4 et:
