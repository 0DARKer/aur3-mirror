--- yacy/source/de/anomic/yacy/yacyVersion.java	2009-01-14 00:51:16.000000000 +0100
+++ yacy-tmp/source/de/anomic/yacy/yacyVersion.java	2009-01-17 12:04:08.000000000 +0100
@@ -438,12 +438,7 @@
                 serverLog.logInfo("RESTART", "INITIATED");
                 final String script =
                     "#!/bin/sh" + serverCore.LF_STRING +
-                    "cd " + sb.getRootPath() + "/DATA/RELEASE/" + serverCore.LF_STRING +
-                    "while [ -f ../yacy.running ]; do" + serverCore.LF_STRING +
-                    "sleep 1" + serverCore.LF_STRING +
-                    "done" + serverCore.LF_STRING +
-                    "cd ../../" + serverCore.LF_STRING +
-                    "nohup ./startYACY.sh > /dev/null" + serverCore.LF_STRING;
+                    "/etc/rc.d/yacy restart > /dev/null" + serverCore.LF_STRING;
                 final File scriptFile = new File(sb.getRootPath(), "DATA/RELEASE/restart.sh");
                 serverSystem.deployScript(scriptFile, script);
                 serverLog.logInfo("RESTART", "wrote restart-script to " + scriptFile.getAbsolutePath());
--- yacy/addon/yacyInit.m4	2009-01-14 00:51:20.000000000 +0100
+++ yacy-tmp/addon/yacyInit.m4	2009-01-17 13:13:52.000000000 +0100
@@ -185,7 +185,11 @@
 ')dnl
 define(`START_YACY_WITH_SUDO', `
 	cmdline="$JAVA $ARGS"
-	nice -$NICE_VAL sudo -u yacy $cmdline &>/dev/null &
+	if [ "$(whoami)" != "$USER" ]; then
+		nice -$NICE_VAL sudo -u yacy $cmdline &>/dev/null &
+	else
+		nice -$NICE_VAL $cmdline &>/dev/null &
+	fi
 	echo $! >$PID_FILE
 ')dnl
 ifdef(`ArchLinux', `START_YACY_WITH_SUDO()')dnl
@@ -206,6 +210,7 @@
 ')dnl
 ifdef(`ArchLinux', `
 		add_daemon yacy
+		chown yacy:root /var/run/daemons/yacy
 		stat_done
 ')dnl
 		RETVAL=0
@@ -244,7 +249,11 @@
 ')dnl
 		cd $YACY_HOME
 		cmdline="$JAVA $JAVA_ARGS -cp $CLASSPATH yacy -shutdown"
-		sudo -u yacy $cmdline &>/dev/null & 
+		if [ "$(whoami)" != "$USER" ]; then
+			sudo -u yacy $cmdline &>/dev/null & 
+		else
+			$cmdline &>/dev/null & 
+		fi
 		shutdown_pid=$!
 
 		timeout=$SHUTDOWN_TIMEOUT
@@ -274,6 +283,9 @@
 		done
 		if [ "$2" != "--leave-pidfile" ]; then
 			rm $PID_FILE
+ifdef(`ArchLinux', `
+			rm_daemon yacy
+')dnl
 		fi
 		cd - >/dev/null
 ifdef(`Debian', `
@@ -286,7 +298,6 @@
 		rc_status -v
 ')dnl
 ifdef(`ArchLinux', `
-		rm_daemon yacy
 		stat_done
 ')dnl
 		exit 0
