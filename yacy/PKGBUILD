# Maintainer: Dan Serban
# Contributor: Florian Richter <Florian_Richter@gmx.de>

pkgname=yacy
pkgver=0.99
pkgrel=2
pkgdesc="Peer to peer search engine"
arch=(i686 x86_64)
url=http://www.yacy.net/
license=(GPL)
depends=(java-runtime sudo)
makedepends=(apache-ant java-environment m4)
install=yacy.install
source=(http://www.yacy.net/release/yacy_v0.99_20110221_7509.tar.gz)
md5sums=('882f31538663195158e9987dcad6aae4')

build()
{
  cd yacy
  # Fix the problem of one comment containing a developer's name with umlauts and disrupting the progress of ant
  sed -i 's/Sebastian.*/Sebastian/' source/net/yacy/kelondro/io/ByteCount.java
  /usr/share/java/apache-ant/bin/ant all installonlinux -DDESTDIR="$pkgdir" || return 1
  mkdir -p "$pkgdir/usr/share/java/yacy"
  mv lib/*.jar "$pkgdir/usr/share/java/yacy/"
  mkdir -p "$pkgdir/etc/rc.d"
  m4 -DArchLinux "$srcdir/yacy/addon/yacyInit.m4" > yacy.init || return 1
  install -Dm755 yacy.init "$pkgdir/etc/rc.d/yacy"
}
