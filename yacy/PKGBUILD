# Maintainer: Dan Serban
# Contributor: Florian Richter <Florian_Richter@gmx.de>

pkgname=yacy
pkgver=0.99
pkgrel=1
pkgdesc="Peer to peer search engine"
arch=(i686 x86_64)
url="http://www.yacy.net/"
license="GPL"
depends=('java-runtime' 'sudo')
makedepends=('apache-ant' 'java-environment')
install=yacy.install
source=(http://www.yacy.net/release/yacy_v0.99_20110221_7509.tar.gz update.patch restart.patch)
md5sums=('882f31538663195158e9987dcad6aae4'
         'fe982a759ab77d5d6d8c75d7763b3e8c'
         'e95e10b9f8bc8583853db3020fbce96c')

build()
{
  cd $startdir/src/
  patch -p0 -i $startdir/update.patch
  patch -p0 -i $startdir/restart.patch
  cd $startdir/src/yacy/
  ant build-jar installonlinux -DDESTDIR=$startdir/pkg || return 1
  mkdir -p $startdir/pkg/usr/share/java/yacy/
  cp lib/*.jar $startdir/pkg/usr/share/java/yacy/
  cp libx/*.jar $startdir/pkg/usr/share/java/yacy/
  mkdir -p $startdir/pkg/etc/rc.d
  m4 -DArchLinux $startdir/src/yacy/addon/yacyInit.m4 >yacy.init || return 1
  install -Dm755 yacy.init $startdir/pkg/etc/rc.d/yacy
}
