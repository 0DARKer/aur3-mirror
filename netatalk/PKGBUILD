# Maintainer: SJ_UnderWater
# Based on netatalk package :
# Maintainer: Dominik Dingel <mail at wodar dot de>
# Contributor: William Udovich <nerdzrule7 at earthlink dot net>
# Contributor: Farhan Yousaf <farhany at xaviya dot com>

pkgname=netatalk
pkgver=2.2.2
pkgrel=1
pkgdesc='A kernel level implementation of the AppleTalk Protocol Suite'
conflicts=('netatalk-git' 'netatalk2')
arch=('i686' 'x86_64')
url='http://netatalk.sourceforge.net'
options=('!libtool')
license=('GPL')
backup=('etc/netatalk/afpd.conf'
	'etc/netatalk/netatalk.conf'
	'etc/netatalk/AppleVolumes.default'
	'etc/netatalk/AppleVolumes.system')
depends=('avahi>=0.6' 'openssl' 'pam' 'coreutils>=7.1-2' 'db>=4.6.0' 'libgcrypt>=1.2.3')
source=(http://hivelocity.dl.sourceforge.net/project/$pkgname/$pkgname/$pkgver/$pkgname-$pkgver.tar.bz2 a2boot afpd atalkd cnid_metad netatalk papd timelord)
md5sums=('bd42b686ec7209d9ab47bd8e2e2431c4'
	'747f0f3870fc0472fff5d502acd83fda'
	'3b936b466b00a479aadb32df60960538'
	'14dd9d43125eec9be438e4474b271ff0'
	'1eb353a1e0581f9d764826a2f2d9b6f2'
	'c89d35e5ea67edfd08ebfccb306f6c47'
	'd8fa2b290cac33b4de77a7b69ef03db9'
	'80299f81b0413329479073fe02e85de5')
_options='--disable-ddp --disable-srvloc --disable-timelord --disable-cups --disable-a2boot'
_ddp=

prompt() {
	read -n 1 -p "${BLUE}  ->${ALL_OFF}${BOLD} ${1}${ALL_OFF}"
	echo "$REPLY"
	if [ -n "$REPLY" ];then echo >&2;fi
}
build() {
	_ddp=`prompt 'Support OS X <= 10.3 (requires OpenSLP and CUPS)? [no] '`
	if [ -n "$_ddp" ];then _options=`echo $_options | sed s/disable/enable/g`;fi
	cd "$srcdir"/$pkgname-$pkgver
	msg2 'Configuring...'
	./configure --prefix=/usr --localstatedir=/var --with-cracklib --with-cnid-cdb-backend --enable-fhs $_options
	if [ -n "`prompt 'Make? [yes] '`" ]; then error 'Halting on user...';exit 1;fi
	make
}
package() {
	cd "$srcdir"/$pkgname-$pkgver
	msg2 'Building...'
	make DESTDIR="$pkgdir" install
	msg2 'Removing extraneous files...'
	rm -r "$pkgdir"/usr/include "$pkgdir"/usr/share/aclocal
	if [ -z "$_ddp" ]; then rm "$pkgdir"/usr/share/man/man8/timelord.8
	rmdir "$pkgdir"/usr/share/man/man3 "$pkgdir"/usr/share/man/man4;fi
	msg2 'Copying initscripts...'
	install -d "$pkgdir"/etc/rc.d
	install -m755 ../{afpd,cnid_metad,netatalk} "$pkgdir"/etc/rc.d
	if [ -n "$_ddp" ]; then install -m755 ../{a2boot,atalkd,papd,timelord} "$pkgdir"/etc/rc.d;fi
}