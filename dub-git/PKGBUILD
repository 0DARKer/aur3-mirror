# Maintainer: Moritz Maxeiner <moritz@ucworks.org>

pkgname=dub-git
pkgver=201302018
pkgrel=1
pkgdesc="Package manager for D packages, git version"
arch=('i686' 'x86_64')
url="https://github.com/rejectedsoftware/dub"
license=('MIT')
depends=('dmd' 'libevent>=2.0' 'openssl')
makedepends=('git' 'vibed')
optdepends=()
source=()
conflicts=('dub')
md5sums=()

_gitroot=https://github.com/rejectedsoftware/dub.git
_gitname=dub

build() {
  cd "$srcdir"
  msg "Connecting to GIT server..."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname"
    git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
    cd "$_gitname"
  fi

  msg "GIT checkout done or server timeout"

  msg "Starting build..."

  cd "${srcdir}/${_gitname}"
  vibe build
}

package() {
  cd "${srcdir}/${_gitname}"
  install -D -m755 app "${pkgdir}/usr/bin/dub"
  install -D -m644 LICENSE.txt "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt"
}
