#Mantainer: M0Rf30
pkgname=wolfsp-git
pkgver=32.90c419d
pkgrel=1
pkgdesc="Return to Castle Wolfenstein Single Player (Justin Crawford fork)"
arch=('i686' 'x86_64')
url="https://github.com/Justasic/RTCW-SP"
license=('GPL3')
depends=('sdl_sound' 'libxxf86vm' 'mesa')
makedepends=('git' 'make' 'libxxf86dga' 'cmake')
source=('wolfsp::git://github.com/Justasic/RTCW-SP.git'
	'wolfsp.launcher' 'wolfsp.png' 'wolfsp.desktop'
	"ftp://ftp.internat.freebsd.org/pub/FreeBSD/distfiles/wolf-linux-1.41b.x86.run")
install='wolfsp-git.install'

build() {
  cd wolfsp
  mkdir build && cd build
  unset CFLAGS
  cmake ../.
  make
}

package(){
  cd wolfsp
  cd build
  make DESTDIR=$pkgdir install
  # Extract Linux Game Files
  if [ ! -d $srcdir/wolfsh ]; then
     mkdir $srcdir/wolfsh && cd $srcdir/wolfsh
  else
     cd $srcdir/wolfsh
  fi
  chmod +x ../wolf-linux-1.41b.x86.run  
  $srcdir/wolf-linux-1.41b.x86.run --noexec --tar xf --group=root --owner=root
  
  # Move Data to Package Directory
    mv $srcdir/wolfsh/main/sp_pak* $pkgdir/opt/wolfsp/main
  
  # Install Launcher Script (Single Player Client)
    install -D -m 755 $srcdir/wolfsp.launcher \
        $pkgdir/usr/bin/wolfsp
  
  # Install Desktop File (Single Player)
    install -D -m 644 $srcdir/wolfsp.desktop \
        $pkgdir/usr/share/applications/wolfsp.desktop

    # Install Icon File (Single Player)
    install -D -m 644 $srcdir/wolfsp.png \
        $pkgdir/usr/share/pixmaps/wolfsp.png

  rm -rf "$srcdir/$_gitname-build"
} 

pkgver() {
  cd wolfsp
  echo $(git rev-list --count master).$(git rev-parse --short master)
}

md5sums=('SKIP'
	 '81ff046200847bcb29189eb91f753533'
         'bf26dc4c10d4bbfbd0c7a052a00c3cdf'
         'a1827afc1e7653fb4ba53b1a8aa939e1'
         '2aa37968aff19d665ed6c001773b2de3')
