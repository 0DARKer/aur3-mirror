# Contributor: Hannes Rist <cowider@gmail.com>

pkgname=gajim-otr-bzr
pkgver=8796
pkgrel=1
pkgdesc="Jabber client written in PyGTK, experimental OTR-Branch"
arch=('i686' 'x86_64')
provides=('gajim')
conflicts=('gajim' 'gajim-svn')
options=(!libtool)
license=('GPL')
url="http://www.gajim.org/"
depends=('gtkspell' 'dnsutils' 'pygtk' 'python-pysqlite' 'dbus-python' 'libxss' 'pycrypto' 'pkgconfig' 'python-otr' 'pyopenssl')
makedepends=('bzr' 'intltool')
source=()
md5sums=()

_bzrtrunk=http://bazaar.launchpad.net/~gajim-otr-dev/gajim/otr
_bzrmod=otr


build() {
  cd $startdir/src
  
  msg "Connecting to the server...."

  if [ ! -d ./$_bzrmod ]; then 
        bzr co $_bzrtrunk $_bzrmod -r $pkgver
  else
        bzr update $_bzrmod
  fi

  msg "BZR checkout done or server timeout"

  [ -d ./$_bzrmod-build ] && rm -rf ./$_bzrmod-build
  cp -r ./$_bzrmod ./$_bzrmod-build
  cd ./$_bzrmod-build
  
  msg "Starting make..."
  cd $startdir/src/$_bzrmod
  ./autogen.sh
  ./configure --prefix=/usr
  make
  make DESTDIR=$startdir/pkg install
}
