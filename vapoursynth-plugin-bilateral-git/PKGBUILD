# Maintainer:  Gustavo Alvarez <sl1pkn07@gmail.com>

_plug=bilateral
pkgname=vapoursynth-plugin-${_plug}-git
pkgver=r1.3.g74f7ada
pkgrel=1
pkgdesc="Plugin for Vapoursynth: ${_plug} (GIT version)"
arch=('i686' 'x86_64')
url="https://github.com/msg7086/VapourSynth-Bilateral"
license=('GPL')
depends=('vapoursynth')
makedepends=('git')
provides=("vapoursynth--plugin-${_plug}")
conflicts=("vapoursynth-plugin-${_plug}")
source=("${_plug}::git+https://github.com/msg7086/VapourSynth-Bilateral.git")
md5sums=('SKIP')
_gitname="${_plug}"

pkgver() {
  cd "${_gitname}"
  echo "$(git describe --long --tags | tr - .)"
}

prepare() {
  cd "${_gitname}/source"
  sed -e 's|#include "..\\include\\VapourSynth.h"|#include <VapourSynth.h>|g' \
      -e 's|#include "..\\include\\VSHelper.h"|#include <VSHelper.h>|g' \
      -e 's|#include "..\\include\\VSScript.h"|#include <VSScript.h>|g' \
      -e 's|\\include\\Numeric.h|/include/Numeric.h|g' \
      -e 's|\\include\\Bilateral.h|/include/Bilateral.h|g' \
      -e 's|\\include\\Gaussian.h|/include/Gaussian.h|g' \
      -i *.cpp
  rm -fr ../include/{VapourSynth,VSHelper,VSScript}.h
}

build() {
  cd "${_gitname}"
  sh ./configure --gcc --install="${pkgdir}/usr/lib/vapoursynth"
  make
}

package(){
  cd "${_gitname}"
  make install
  #install -Dm644 README.md "${pkgdir}/usr/share/doc/vapoursynth/plugins/${_plug}/README.md"
}
