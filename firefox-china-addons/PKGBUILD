# Contributor: Cheese Lee <cheeselee@126.com>

pkgname=firefox-china-addons
pkgver=2009.1
_ffver=3.0
pkgrel=4
pkgdesc="Addons for Firefox China Edition"
arch=(i686 x86_64)
url="http://g-fox.cn/index.html"
license=("MPL" "GPL" "custom")
depends=("firefox" "firefox-i18n")
noextract=(cpmanager.xpi zoompanel.xpi tabimprovelite.xpi
  fontsetter.xpi livemargins.xpi quicklaunch.xpi flashgot.xpi)
source=(cpmanager.xpi::http://g-fox.cn/chinaedition/addons/cpmanager/cpmanager-0.2.2.xpi
  zoompanel.xpi::http://g-fox.cn/chinaedition/addons/zoompanel/zoompanel-0.2.1.xpi
  tabimprovelite.xpi::http://g-fox.cn/chinaedition/addons/tabimprovelite/tabimprovelite-0.2.5.xpi
  fontsetter.xpi::http://g-fox.cn/chinaedition/addons/fontsetter/fontsetter-0.2.6.xpi
  livemargins.xpi::http://g-fox.cn/chinaedition/addons/livemargins/livemargins-0.1.15.xpi
  quicklaunch.xpi::http://g-fox.cn/chinaedition/addons/quicklaunch/quicklaunch-0.2.10.xpi
  flashgot.xpi::http://software.informaction.com/data/releases/flashgot-1.1.8.xpi)
md5sums=('0f24888b352f21c2388c8e149af94697'
         '82880bf8aa0a1ba278044e58284b7399'
	 '1146f52490df8b50b86ebec9e2c4a25b'
	 '8bd35b9dc6359ef0314d398a8bbbb97f'
	 'ed161177b60cc1ef26486786d70c0cd6'
         '7ff2132d28a8f22031c4684ce0c41ef1'
         '0873ca0aad10f111f7843de6127d626d')

_firefox-xpi-installer() {
  unzip -qq ${_xpifile} -d $srcdir
  local _dir=$pkgdir/usr/lib/firefox-${_ffver}/extensions/${_identifier}
  mkdir -p "${_dir}"
  cp -r $srcdir/* "${_dir}" && \
  find ${_dir} -type f -exec chmod 0644 {} \; && \
  touch ${_dir}/chrome.manifest
  rm -r $srcdir/*
  return 0
}

build() {
  cd $startdir
  rm -r $srcdir/*
  #echo ${#noextract[@]}
  _looplen=$((${#noextract[@]}-1))
  #for _i in "${noextract[@]}"; do
  _i=0
  while [ $_i -lt $_looplen ];do
    _xpifile=${noextract[$_i]}
    _identifier=${_xpifile%.xpi}@mozillaonline.com
    _firefox-xpi-installer || return 1
    _i=$(($_i+1))
  done
  _xpifile=flashgot.xpi
  _identifier={19503e42-ca3c-4c27-b1e2-9cdb2170ee34} 
  _firefox-xpi-installer || return 1
}
