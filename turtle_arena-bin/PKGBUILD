# Maintainer: Aliasbody <aliasbody@gmail.com>
pkgname=turtle_arena-bin
pkgver=0.6
pkgrel=0
pkgdesc="Turtle Arena (working title) is a free and open source cross-platform third-person action game using a modified version of the ioquake3 engine."
url="http://ztm.x10hosting.com/ta/index.htm"
arch=('x86_64' 'i686')
license=('GPLv2')
depends=('sdl' 'openal')
provides=('turtlearena' 'turtlearena-server')
source=("http://turtlearena.googlecode.com/files/turtlearena-${pkgver}-${pkgrel}.zip")

package() { 
	installDir="$pkgdir/opt/turtle_arena"
	fileName="turtlearena-${pkgver}-${pkgrel}"
	
	# Creates a directory called turtle_arena in /opt/
	msg "(1/6) Creating game folder"
	mkdir -p $installDir
	
	# Copying all the files from the original folder to the new one
	msg "(2/6) Moving Files"
	cp -R $fileName/* $installDir
	
	# Removing all the Unnecessary Files (Windows Files)
	msg "(3/6) Removing Unnecessary Files"
	rm -R $installDir/*.{dll,exe}
	
	# Creating the .desktop, icon and executable
	msg "(4/6) Installing menu icon..."
	mkdir -p $pkgdir/usr/share/applications/
	
	msg2 "(1/2) Creating turtle_arena.desktop file"
	cat > "$pkgdir/usr/share/applications/turtle_arena.desktop" <<EOF
[Desktop Entry]
Encoding=UTF-8
Name=Turtle Arena
Type=Application
Categories=Game
Icon=/opt/turtle_arena/iconw_sais.png
Path=/opt/turtle_arena/
Exec=turtlearena
EOF

	msg2 "(2/2) Downloading and adding the game icon"
	wget http://turtlearena.googlecode.com/svn-history/r1303/trunk/base/icons/iconw_sais.png
	mv iconw_sais.png $installDir
	
	# Creating the symlinks 
	msg "(5/6) Creating symlinks"
	mkdir -p $pkgdir/usr/sbin/

	msg2 "(1/3) Creating the turtlearena.sh file"
	cat > "$installDir/turtlearena.sh" <<EOF
#!/bin/sh

if [ $(uname -m) == "x86_64" ]; then
	exec "/opt/turtle_arena/turtlearena.x86_64"
else
	exec "/opt/turtle_arena/turtlearena.i386"
fi
EOF

	msg2 "(2/3) Creating the turtlearena-server.sh file"
	cat > "$installDir/turtlearena-server.sh" <<EOF
#!/bin/sh

if [ $(uname -m) == "x86_64" ]; then
	exec "/opt/turtle_arena/turtlearena-server.x86_64"
else
	exec "/opt/turtle_arena/turtlearena-server.i386"
fi
EOF

	msg2 "(3/4) Changing the file's permissions"
	chmod u+x $installDir/turtlearena.sh
	chmod u+x $installDir/turtlearena.sh

	msg2 "(4/4) Adding turtlearena & turtlearena-server into /usr/sbin directory"
	ln -s $installDir/turtlearena.sh $pkgdir/usr/sbin/turtlearena
	ln -s $installDir/turtlearena-server.sh $pkgdir/usr/sbin/turtlearena-server
	
	# Adding the game folder into the games group
	msg "(6/6) Defining Folder Permissions"
	chown -R root:games $installDir
}

md5sums=('eb2b60e35b7fa10257f26856b608018c')
