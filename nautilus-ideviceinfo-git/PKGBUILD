# Contributor: Joeny Ang <ang(dot)joeny(at)gmail(dot)com>

pkgname=nautilus-ideviceinfo-git
pkgver=20110306
pkgrel=1
pkgdesc="Get extra information about your iDevice"
arch=('i686' 'x86_64')
url="http://www.libimobiledevice.org/"
license=('GPL')
depends=('libimobiledevice' 'nautilus')
optdepends=('mobile-broadband-provider-info: to show mobile carrier'
            'libgpod>=0.7.90: to enable detailed audio/video information')
makedepends=('git' 'intltool')
options=(!libtool)
source=(providerinfo-cflags-fix.patch)
md5sums=('9235fa8a31ad45a4632177bfeb68db99')

_gitroot="git://git.gnome.org/nautilus-ideviceinfo"
_gitname="nautilus-ideviceinfo"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."
  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf ${srcdir}/${_gitname}-build
  git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
  cd ${srcdir}/${_gitname}-build

  ./autogen.sh --prefix=/usr
  patch -Np0 -i ../providerinfo-cflags-fix.patch || return 1
  make || return 1
}

package() {
  cd ${srcdir}/${_gitname}-build
  make DESTDIR=${pkgdir}/ install || return 1
}
