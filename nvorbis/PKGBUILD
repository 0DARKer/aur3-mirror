pkgname=nvorbis
pkgver=0.8.2
pkgrel=2
pkgdesc="NVorbis is a .Net library for decoding Xiph.org Vorbis files."
depends=(mono)
makedepends=(opentk dos2unix)
arch=(any)
license=("MSPL, public domain")
url="http://nvorbis.codeplex.com"
source=("nvorbis.zip::http://download-codeplex.sec.s-msft.com/Download/SourceControlFileDownload.ashx?ProjectName=nvorbis&changeSetId=0c8b03f835829e94852abe0089cf4b6437338da5"
"nvorbis.pc" "nvorbis-opentk.pc")
optdepends=("opentk: OpenTK support")
sha1sums=('daa8fe316d49e9107d083ef31ee1c40b80810572'
          '3d76ed8e3668477b647dddf208f5cfd0304f97e7'
          '1c3315ec24281a153f2f89749398373d20c82a8b')

prepare() {
	cd "$srcdir"
	find . -type f -exec dos2unix {} \;
}
          
build() {
	cd "$srcdir/NVorbis"
	xbuild NVorbis.csproj /p:Configuration=Release
	cd ../OpenTKSupport
	mcs /debug:pdbonly /optimize+ /out:../bin/NVorbis.OpenTKSupport.dll \
		`ls *.cs` Properties/AssemblyInfo.cs /t:library /define:TRACE \
		`pkg-config opentk --libs` /r:../bin/NVorbis.dll /warn:4
}

package() {
	cd "$srcdir"
	find . -name '*.pc' -exec install -Dm644 {} "$pkgdir/usr/lib/pkgconfig/"{} \;
	install -Dm644 COPYING "$pkgdir/usr/share/licenses/nvorbis/COPYING"
	cd bin
	rm *.XML
	find . -type f -exec install -Dm644 {} "$pkgdir/usr/lib/nvorbis/"{} \;
	find "$pkgdir/usr/lib/pkgconfig" -type f -exec sed -i "s|@VERSION@|${pkgver//_/-}|" {} \;
}
