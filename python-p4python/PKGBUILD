# Maintainer: Brett Bates <brett@bmb.io>
pkgname=python-p4python
pkgver=2014.2.962887
pkgrel=1
pkgdesc="Python api for Perforce SCM"
arch=('i686' 'x86_64')
url="http://www.perforce.com"
license=('custom:p4python')
options=('!emptydirs')
source=(ftp://ftp.perforce.com/perforce/r14.2/bin.tools/p4python.tgz 
        ftp://ftp.perforce.com/perforce/r14.2/bin.linux26${CARCH/i6/x}/p4api.tgz
        LICENSE)

[ "$CARCH" = "i686" ] && \
    sha256sums=('4101bd6c5d8811e18c5fe9aef75710bc3b4fcfc25818cad0cc308d6a48842414'
                '7cced31f8af34090c661177c77f87c54f31ec12007813488dd7bf70e52a01c9e'
                'c4ed3aef62b1bbf2d16ce4cceb65dc49ab9635b38e2fed0a595fe259283a9f32')

[ "$CARCH" = "x86_64" ] && \
 sha256sums=('4101bd6c5d8811e18c5fe9aef75710bc3b4fcfc25818cad0cc308d6a48842414'
             '0eec49af28d3726b7d8696f3bb40c22c38b22f06f3da3addbbcd1c3ee79b5dc2'
             'c4ed3aef62b1bbf2d16ce4cceb65dc49ab9635b38e2fed0a595fe259283a9f32')

package(){
    cd "$srcdir/p4python-$pkgver"
    python setup.py build --apidir "$srcdir/$(find $srcdir -name 'p4api-*' -type d -printf '%f')"
    python p4test.py
    python setup.py install --root="$pkgdir/" --apidir "$srcdir/$(find $srcdir -name 'p4api-*' -type d -printf '%f')"
}
