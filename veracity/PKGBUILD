# Maintainer: Scott Smith <jcdenton513 gmail com>
pkgname=veracity
pkgver=1.0.0
_verextra=10517
pkgrel=1
pkgdesc="A new open source distributed version control system."
url="http://www.veracity-scm.com"
arch=('x86_64' 'i686')
license=('APACHE')
depends=('curl' 'icu' 'zlib' 'util-linux' 'nspr')
makedepends=('cmake')
source=("http://download.sourcegear.com/Veracity/release/$pkgver.$_verextra/veracity-source-$pkgver.$_verextra.tar.gz"
        "cmake.patch")
md5sums=('27376a62073b23826280ee8b334bb126'
         '750cfb5cddcf2b3923e10e4332b652b7')

_thisarch=i686
if test "$CARCH" == x86_64; then
  _thisarch=x86_64
fi

 
build() {
  # Failure in final linking, undefined symbols.
  export LDFLAGS="${LDFLAGS//-Wl,--as-needed}"

  cd ${srcdir}/${pkgname}/thirdparty
  ./build_linux.sh

  cd ${srcdir}/${pkgname}
  # supress -Wunused. causes build to fail
  patch -p1 < ../cmake.patch
  cmake -G "Unix Makefiles" \
    -DVVTHIRDPARTY=${srcdir}/vv-thirdparty/${_thisarch} \
    -DCMAKE_INSTALL_PREFIX=/usr
  make
}
 
package() {
  cd "${srcdir}/${pkgname}"
  make DESTDIR="${pkgdir}" install
  install -Dm644 NOTICE.txt "$pkgdir/usr/share/licenses/$pkgname/NOTICE.txt"
  install -Dm644 TRADEMARKS.txt "$pkgdir/usr/share/licenses/$pkgname/TRADEMARKS.txt"
}
 
# vim:set ts=2 sw=2 et:
