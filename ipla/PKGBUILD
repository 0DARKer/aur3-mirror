# Contributor: Tom Wizetek <tom@wizetek.com>
pkgname=ipla
pkgver=1.1beta
pkgrel=3
pkgdesc="Interaktywna platforma multimedialna (PL)"
url="http://www.ipla.pl/"
license=('custom')
arch=('any')
depends=('adobe-air')
makedepends=('unzip')
source=(http://www.ipla.pl/templates/ipla/assets/iplalite.air)
md5sums=('28b1b697843933b5add28b72b0c9cf3b')

package() {
	_appver="1.1 Beta"
        _appverpath="META-INF/AIR/application.xml"

        unzip -q -u iplalite.air

        [[ -z $(grep ">$_appver<" "$_appverpath") ]] && \
        _airver=$(sed -n 's,[ \t]*</*version>,,gp' "$_appverpath") && \
        echo -e "\e[1;32m==> \e[0m\e[1mVERSION MISMATCH!\e[0m" && \
        echo -e "    Expected application version:\t\e[1;31m$_appver\e[0m" && \
        echo -e "    Current .air file version:\t\t\e[1;31m$_airver\e[0m" && \
        return 1

	install -D -m 644 "$srcdir/iplalite.air" "$pkgdir/opt/ipla/iplalite.air"
        install -D -m 644 "$srcdir/style/assets/LogoSmall.png" "$pkgdir/usr/share/pixmaps/ipla/ipla_small.png"
        install -D -m 644 "$srcdir/style/assets/logo16_16.png" "$pkgdir/usr/share/pixmaps/ipla/ipla_16x16.png"
        install -D -m 644 "$srcdir/style/assets/logo32_32.png" "$pkgdir/usr/share/pixmaps/ipla/ipla_32x32.png"
        install -D -m 644 "$srcdir/style/assets/logo48_48.png" "$pkgdir/usr/share/pixmaps/ipla/ipla_48x48.png"
        install -D -m 644 "$srcdir/style/assets/logo128_128.png" "$pkgdir/usr/share/pixmaps/ipla/ipla_128x128.png"

	cat > ipla-gnome << EoF
#!/bin/sh
GNOME_DESKTOP_SESSION_ID=1 adobe-air /opt/ipla/iplalite.air
EoF
	install -D -m 755 "$srcdir/ipla-gnome" "$pkgdir/usr/bin/ipla-gnome"

	cat > ipla-kde << EoF
#!/bin/sh
KDE_FULL_SESSION=true adobe-air /opt/ipla/iplalite.air
EoF
	install -D -m 755 "$srcdir/ipla-kde" "$pkgdir/usr/bin/ipla-kde"

	cat > ipla-gnome.desktop << EoF
[Desktop Entry]
Type=Application
Terminal=false
Categories=Application;Network;
Exec=/usr/bin/ipla-gnome
Icon=/usr/share/pixmaps/ipla/ipla_128x128.png
Name=ipla (GNOME)
Comment=Interaktywna platforma multimedialna
EoF
	install -D -m 644 "$srcdir/ipla-gnome.desktop" "$pkgdir/usr/share/applications/ipla-gnome.desktop"

	cat > ipla-kde.desktop << EoF
[Desktop Entry]
Type=Application
Terminal=false
Categories=Application;Network;
Exec=/usr/bin/ipla-kde
Icon=/usr/share/pixmaps/ipla/ipla_128x128.png
Name=ipla (KDE)
Comment=Interaktywna platforma multimedialna
EoF
	install -D -m 644 "$srcdir/ipla-kde.desktop" "$pkgdir/usr/share/applications/ipla-kde.desktop"

	msg ""
	msg "This application requires a password management tool:"
	msg "   libgnome-keyring (GNOME)"
	msg "or"
	msg "   kdeutils-kwallet (KDE)"
	msg ""
	msg "You may need to install from AUR:"
	msg "   libpng12 (32-bit)"
	msg "or"
	msg "   lib32-libpng12 (64-bit)"
	msg "for Adobe AIR to work properly (instead of using libpng 1.4)"
	msg ""
}
