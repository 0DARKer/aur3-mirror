# Mantainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname="dkms-nvidia-beta"
_modname=nvidia
pkgver=280.13
pkgrel=1
pkgdesc="NVIDIA dynamic kernel module (DKMS) drivers, utilities and libraries for kernel26. BETA DRIVERS"
arch=('i686' 'x86_64')
url="http://www.nvidia.com/"
license=('custom')
optdepends=("nvidia-utils-beta=${pkgver}")
makedepends=('kernel26-headers' 'dkms')
conflicts=('nvidia')
provides=('nvidia=${pkgver}')
install=('dkms-nvidia-beta.install')
options=(!strip)

if [ "$CARCH" = "i686" ]; then
    _arch='x86'
    _pkg="NVIDIA-Linux-${_arch}-${pkgver}"
    source=("http://es.download.nvidia.com/XFree86/Linux-${_arch}/${pkgver}/${_pkg}.run")
    md5sums=('c3992c8cef02b7773a398640d8830e77')
elif [ "$CARCH" = "x86_64" ]; then
    _arch='x86_64'
    _pkg="NVIDIA-Linux-${_arch}-${pkgver}-no-compat32"
    source=("http://es.download.nvidia.com/XFree86/Linux-${_arch}/${pkgver}/${_pkg}.run")
    md5sums=('05e62b61feb34bf412f83ca1074e1917')
fi

source[1]="dkms.conf"
source[2]="dkms-nvidia-beta.install"
md5sums[1]='fdcc576622bdcf15bfadc3a747b58a32'
md5sums[2]='9a1f6e9979ab16dc1b40b3802db99e6e'


build() {
    cd $srcdir
    sh ${_pkg}.run --extract-only
}

package() {
    mkdir -p ${pkgdir}/usr/src/${_modname}-${pkgver}
    cp -a ${srcdir}/${_pkg}/kernel/* ${pkgdir}/usr/src/${_modname}-${pkgver}
    install -d -m755 ${pkgdir}/etc/modprobe.d
    cp ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_modname}-${pkgver}/
    mkdir -p "${pkgdir}/etc/modprobe.d/"
    echo "blacklist nouveau" >> "${pkgdir}/etc/modprobe.d/nouveau_blacklist.conf"
}