#Maintainer: Simone Sclavi 'Ito' <darkhado@gmail.com>
pkgname=sikuli-ide
__pkgalias=Sikuli-X
pkgver=1.0rc1
pkgrel=2
pkgdesc='a visual technology to search and automate graphical user interfaces using screenshots'
arch=('x86_64' 'i686')
license=('MIT')
url="http://groups.csail.mit.edu/uid/sikuli/"
depends=('java-environment>=6' 'opencv-old' 'wmctrl')
if [ $CARCH = "x86_64" ]; then
    sikuli_md5='8ae2c0d54b856eef212c9f29b43ae1e1'
    sikuli_url=http://launchpad.net/sikuli/sikuli-x/x1.0-rc1/+download/${__pkgalias}-${pkgver}-linux-${CARCH}.zip
else    
    sikuli_md5='0f102746ef743bae49910a601e1e6fff'
    sikuli_url=http://launchpad.net/sikuli/sikuli-x/x1.0-rc1/+download/${__pkgalias}-${pkgver}-linux.zip
fi                
source=('sikuli-ide.xpm' 'sikuli-ide.desktop' $sikuli_url) 
md5sums=('219ed61ea3c12598ffa47216a3aa9d2f'
         'ab3050ce3daa0fb0615bfcdb4e1e9b12'
         $sikuli_md5)         

package(){
    cd $srcdir
    ##Desktop
    mkdir -p $pkgdir/usr/share/{applications,pixmaps} 
    install -m644 sikuli-ide.xpm $pkgdir/usr/share/pixmaps 
    install -m644 sikuli-ide.desktop $pkgdir/usr/share/applications 

    ##License###
    cd ${__pkgalias}-${pkgver}-linux
    mkdir -p $pkgdir/usr/share/licenses/$pkgname/ 
    install -m644 copyright.txt $pkgdir/usr/share/licenses/$pkgname/LICENSE 

    ##Binary
    mkdir -p $pkgdir/opt/$pkgname
    install -m644 Sikuli-IDE/*.jar $pkgdir/opt/$pkgname
    mkdir -p $pkgdir/opt/$pkgname/libs
    install -m644 Sikuli-IDE/libs/*.so $pkgdir/opt/$pkgname/libs
    cd Sikuli-IDE
    sed 's/DIR=`dirname $0`/DIR=\/opt\/sikuli-ide/' -i  sikuli-ide.sh 
    #sed '/opt/ a\cd "/tmp"' -i sikuli-ide.sh 
    mkdir -p $pkgdir/usr/bin
    install -m755 sikuli-ide.sh $pkgdir/opt/$pkgname
    ln -s /opt/${pkgname}/sikuli-ide.sh $pkgdir/usr/bin/sikuli-ide.sh

}

    
