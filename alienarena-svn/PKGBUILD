#! /bin/bash
# Maintainer: Jorge Barroso <jorge.barroso.11 at gmail dot com>
# Contributor: Paul Bredbury <brebs@sent.com>

pkgname=alienarena-svn
pkgver=3898
pkgrel=1
pkgdesc="Multiplayer retro sci-fi deathmatch game based on Quake3"
arch=('i686' 'x86_64')
url="http://icculus.org/alienarena/rpa/"
license=('GPL')
groups=('games')
depends=('curl' 'freetype2' 'libgl' 'libjpeg' 'libvorbis' 'libxxf86dga' 'libxxf86vm' 'libgl' 'sdl' 'openal' 'alienarena-data' 'zlib')
makedepends=('subversion')
provides=('alienarena')
conflicts=('alienarena')
source=(alienarena.desktop)
sha512sums=('4ceb9b838f689aa0b60cfb761411f1708ed852970cd62b218fd42d33db7d59c003ee52fcbb39cfe3d150e15d887696f26e9dadf60e4c4fca97c5d574a47f1402')

# View at https://svn.icculus.org/alienarena/trunk/
_svntrunk="svn://svn.icculus.org/alienarena/trunk"
_svnmod="trunk"
_datadir="/usr/share/${pkgname}"
_libdir="/usr/lib/${pkgname}"

build() {
	cd $srcdir

	#SVN
	
	# Force restoration of edited file
	rm -f $_svnmod/source/Makefile $_svnmod/source/unix/gl_glx.c

	msg "Checking for previous build"
	if [[ -d $_svnmod/.svn ]]; then
		msg "Retrieving updates"
		cd $_svnmod
		svn up
	else
		msg "Retrieving complete sources"
		svn co $_svntrunk
		cd $_svnmod
	fi
	
	#Build
	
	./configure

	make PREFIX=/usr
}

 package() {
	cd $_svnmod
	
	make DESTDIR=$pkgdir install
	
	mv $pkgdir/usr/local/bin $pkgdir/usr/bin
	mv $pkgdir/usr/local/share $pkgdir/usr/share
	rm $pkgdir/usr/local
	
	install -D -m755 $srcdir/alienarena.desktop $pkgdir/usr/share/applications/alienarena.desktop
}
