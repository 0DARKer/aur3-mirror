# Contributor: Anton Bazhenov <anton.bazhenov at gmail>
# Contributor: Jaroslav Lichtblau <dragonlord@aur.archlinux.org>
# Contributor: Gilles Gagniard <gilles@gagniard.org>
# Maintainer: JD Steffen <jd at steffennet dot org>

pkgname=simutrans
pkgver=110.0
_pkgpathver=110-0
pkgrel=1
pkgdesc="An open source transportation simulation game"
arch=('i686' 'x86_64')
url="http://www.simutrans.com/"
license=('PerlArtistic' 'custom')
depends=('gcc-libs' 'sdl' 'zlib' 'simutrans-pak64')
makedepends=('unzip')
conflicts=('simutrans-svn')
source=(http://downloads.sourceforge.net/project/$pkgname/$pkgname/$_pkgpathver/$pkgname-src-$_pkgpathver.zip
        $pkgname.desktop
        $pkgname.png
        $pkgname.patch)
md5sums=('7ca35618a72278ee826c2b8dd561e1b0'
         'd0a8807370b25d833f42b3151b9119b6'
         '7b69608dd812e8bed284b10984c6170e'
         'fc955d3d219a40a0a6fa68185fd586a2')

build() {
  
  cd "$srcdir"

  # make
  msg Compiling...
  cp -f $srcdir/config.template $srcdir/config.default
  patch -Np1 -i ../$pkgname.patch || return 1
  make || return 1

  # install data
  install -m755 -d "$pkgdir"/usr/share/$pkgname
  cp -rf $pkgname/* "$pkgdir"/usr/share/$pkgname/
  find "$pkgdir"/usr/share/$pkgname -type d -exec chmod 755 {} +
  find "$pkgdir"/usr/share/$pkgname -type f -exec chmod 644 {} +

  cd "$srcdir"

  # install binary
  install -Dm755 sim "$pkgdir"/usr/bin/$pkgname

  # install licenses, .desktop file and icon
  install -Dm644 $pkgname/copyright.txt "$pkgdir"/usr/share/licenses/$pkgname/COPYRIGHT
  install -Dm644 $pkgname/licence.txt   "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
  install -Dm644 $pkgname.desktop       "$pkgdir"/usr/share/applications/$pkgname.desktop
  install -Dm644 $pkgname.png           "$pkgdir"/usr/share/pixmaps/$pkgname.png

  msg "Finishing up..."
  # create link to font
  cd "$pkgdir"/usr/share/$pkgname/font
  ln -s Prop-Latin1.bdf PROP_FONT_FILE
  
  msg Done.
}
