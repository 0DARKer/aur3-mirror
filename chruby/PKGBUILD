# Maintainer: Max Meyer <dev@fedux.org>
pkgname=chruby
pkgver=0.3.4
pkgrel=1
pkgdesc="changes the current ruby. Supports both zsh and bash."
arch=(any)
url="https://github.com/postmodern/chruby"
license=('MIT')
depends=('bash')
optdepends=('zsh')
makedepends=('gnupg')
install=${pkgname}.install
#changelog="src/$pkgname-$pkgver/ChangeLog.md"
source=(https://github.com/postmodern/${pkgname}/archive/v${pkgver}.tar.gz profile.d-chruby.sh)
sha256sums=('1d3298d44b447ab7d8989e15cfbf9f45a35a8476b88455e8c3baa1dca71093c3'
            '8256f38a8908654c4d75793774cbb85da324d73ce0137c647f43e852e6618b54')

package() {
  if gpg --fingerprint 0xB9515E77 >/dev/null 2>&1; then

    #download key
    msg "Downloading package signature"
    curl -o  ${pkgname}-${pkgver}.tar.gz.asc https://raw.github.com/postmodern/chruby/master/pkg/${pkgname}-${pkgver}.tar.gz.asc -s

    #check key
    if gpg --verify ${pkgname}-${pkgver}.tar.gz.asc ${srcdir}/v${pkgver}.tar.gz;then 
      msg "Verification of package was successfull."
    else
      msg "Verification of package failed. Please check yourself with:"
      echo "gpg --verify ${pkgname}-${pkgver}.tar.gz.asc ${srcdir}/v${pkgver}.tar.gz"
    fi

  else

    echo ""
    echo ""
    msg "Please import the gpg key of the chruby-author, to check package integrity:"
    msg "http://postmodern.github.com/contact.html#pgp"
    echo ""
    echo ""

  fi

  cd "$srcdir/$pkgname-$pkgver"

  install -D -m644 ${srcdir}/profile.d-chruby.sh ${pkgdir}/etc/profile.d/chruby.sh
  install -d ${pkgdir}/usr/share/licenses/${pkgname}
  ln -s /usr/share/doc/${pkgname}-${pkgver}/LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt
  make PREFIX="${pkgdir}/usr" install >/dev/null

#  chmod a-x ${pkgdir}/usr/share/chruby/*
}

# vim:set ts=2 sw=2 et:
