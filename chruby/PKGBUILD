# Maintainer: Max Meyer <dev@fedux.org>
pkgname=chruby
pkgver=0.3.2
pkgrel=1
pkgdesc="changes the current ruby. Supports both zsh and bash."
arch=(any)
url="https://github.com/postmodern/chruby"
license=('MIT')
depends=('bash')
optdepends=('zsh')
makedepends=('gnupg')
install=${pkgname}.install
#changelog="src/$pkgname-$pkgver/ChangeLog.md"
source=(https://github.com/postmodern/${pkgname}/archive/v${pkgver}.tar.gz profile.d-chruby.sh)
sha256sums=('06fca87197a07b784f7314aa97df8c5e41003bacfeda165bcb97330dace636d3'
            'aa1f8b508a731f71c6391008bb9a7fa7264ad0577e7cb6f3073d1e06a600997a')

package() {
  if gpg --fingerprint 0xB9515E77 >/dev/null 2>&1; then

    #download key
    msg "Downloading package signature"
    curl -o  ${pkgname}-${pkgver}.tar.gz.asc https://raw.github.com/postmodern/chruby/master/pkg/${pkgname}-${pkgver}.tar.gz.asc -s

    #check key
    if gpg --verify ${pkgname}-${pkgver}.tar.gz.asc ${srcdir}/v${pkgver}.tar.gz;then 
      msg "Verification of package was successfull."
    else
      msg "Verification of package failed. Please check yourself with:"
      echo "gpg --verify ${pkgname}-${pkgver}.tar.gz.asc ${srcdir}/v${pkgver}.tar.gz"
    fi

  else

    echo ""
    echo ""
    msg "Please import the gpg key of the chruby-author, to check package integrity:"
    msg "http://postmodern.github.com/contact.html#pgp"
    echo ""
    echo ""

  fi

  cd "$srcdir/$pkgname-$pkgver"

  install -D -m644 ${srcdir}/profile.d-chruby.sh ${pkgdir}/etc/profile.d/chruby.sh
  install -d ${pkgdir}/usr/share/licenses/${pkgname}
  ln -s /usr/share/doc/${pkgname}-${pkgver}/LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt
  make PREFIX="${pkgdir}/usr" install >/dev/null

  chmod a-x ${pkgdir}/usr/share/chruby/*
}

# vim:set ts=2 sw=2 et:
