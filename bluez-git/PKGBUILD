# Mantainer: Juan Diego Tascon
pkgname=bluez-git
pkgver=20090923
pkgrel=2
pkgdesc="Libraries and tools for the Bluetooth protocol stack"

url="http://www.bluez.org/"
arch=('i686' 'x86_64')
license=('GPL2')

depends=('dbus-core' 'glib2>=2.20.1')
makedepends=('gstreamer0.10-base' 'alsa-lib' 'libusb' 'libnl' 'git' 'bison' 'flex')
optdepends=('gstreamer0.10-base' 'alsa-lib' 'libusb' 'libnl' 'dbus-python')

conflicts=('bluez' 'bluez-libs' 'bluez-utils')
provides=('bluez=4.53' 'bluez-libs' 'bluez-utils')

options=(!libtool)
backup=(etc/bluetooth/{main,rfcomm,audio,network,input}.conf etc/conf.d/bluetooth)

source=()
md5sums=()

_gitroot="git://git.kernel.org/pub/scm/bluetooth/bluez.git"
_gitname="bluez"

build() {
  cd ${srcdir}
  msg "Connecting to GIT server...."

  if [ -d ${srcdir}/${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot}
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."


  cd ${srcdir}/${_gitname}
  
  ./bootstrap || return 1
  
  ./configure --prefix=/usr \
	--sysconfdir=/etc \
	--localstatedir=/var \
	--libexecdir=/lib \
	--mandir=/usr/share/man \
	--enable-gstreamer \
	--enable-alsa \
	--enable-usb \
	--enable-netlink \
	--enable-tools \
	--enable-bccmd \
    --enable-pcmcia \
	--enable-hid2hci \
	--enable-dfutool \
	--enable-hidd \
	--enable-pand \
	--enable-dund \
	--enable-cups \
    --enable-udevrules \
	--enable-configfiles || return 1
	
  make || return 1
}

package() {
  cd ${srcdir}/${_gitname}
  make DESTDIR=${pkgdir} install || return 1

  install -D -m755 ${srcdir}/${_gitname}/test/simple-agent ${pkgdir}/usr/bin/bluez-simple-agent || return 1
}
