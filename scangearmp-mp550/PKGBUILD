pkgname=scangearmp-mp550
pkgver=1.40
pkgrel=2
_pkgver=1.40-1
pkgdesc="Canon Scanner Driver (For Multifunction MP550)"
url="http://support-sg.canon-asia.com/contents/SG/EN/0100237102.html"
arch=('i686')
license=('custom')
depends=('sane' 'gimp' 'libpng' 'gtk2' 'libusb')
makedepends=('rpmextract')
source=("http://gdlp01.c-wss.com/gds/1/0100002371/01/${pkgname}series-${_pkgver}-i386-rpm.tar.gz")
md5sums=('3bff6b1bc7cfae467b2806486c70db10')

build() {
	cd ${srcdir}
	tar -xzf ${pkgname}series-${_pkgver}-i386-rpm.tar.gz
	cd ${pkgname}series-${_pkgver}-i386-rpm/packages
	rpmextract.sh scangearmp-common-${_pkgver}.i386.rpm
	rpmextract.sh ${pkgname}series-${_pkgver}.i386.rpm
	mv usr/local/bin usr/bin
	mv usr/local/share usr/share
	mv usr/share/share/* usr/share
	rm -rf usr/share/share
	mkdir usr/share/licenses
	mv usr/share/doc/${pkgname}series-${pkgver} usr/share/licenses/scangearmp
	rm -rf usr/share/doc
	rm -rf usr/local
}

package() {
	install -d ${pkgdir}/etc
	install -d ${pkgdir}/usr/bin
	install -d ${pkgdir}/usr/lib/bjlib
	install -d ${pkgdir}/usr/share/licenses/scangearmp
	install -d ${pkgdir}/usr/share/scangearmp/pixmaps
	install -d ${pkgdir}/usr/share/locale
	cd ${srcdir}/${pkgname}series-${_pkgver}-i386-rpm/packages
	install -Dm 644 etc/udev/rules.d/80-canon_mfp.rules ${pkgdir}/etc/udev/rules.d/80-canon_mfp.rules
	install -Dm 755 usr/bin/scangearmp ${pkgdir}/usr/bin/scangearmp
	install -Dt ${pkgdir}/usr/lib usr/lib/*.*
	chmod 644 ${pkgdir}/usr/lib usr/lib/libsane-canon_mfp.a
	install -Dt ${pkgdir}/usr/lib/bjlib usr/lib//bjlib/*
	install -Dm 644 -t ${pkgdir}/usr/share/licenses/scangearmp usr/share/licenses/scangearmp/*
	install -Dm 644 -t ${pkgdir}/usr/share/scangearmp/pixmaps usr/share/scangearmp/pixmaps/*
	for locale in $(ls usr/share/locale); do
	    install -Dm 644 usr/share/locale/${locale}/LC_MESSAGES/scangearmp.mo ${pkgdir}/usr/share/locale/${locale}/LC_MESSAGES/scangearmp.mo
	done
}

