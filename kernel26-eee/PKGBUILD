# Maintainer: adriano <adriano.src@gmail.com>

pkgname=kernel26-eee
pkgver=2.6.29
_kernver=2.6.29-rc4
pkgrel=4
pkgdesc="The Linux Kernel and modules for the Asus Eee PC"
arch=('i686')
license=('GPL2')
url="http://www.kernel.org"
depends=('coreutils' 'module-init-tools')
replaces=('linux-uvc-eee-svn' 'madwifi-eee-svn')
source=(ftp://ftp.kernel.org/pub/linux/kernel/v2.6/testing/linux-$_kernver.tar.bz2
        kernelconfig
		)

md5sums=('78270d11e8b3193be1db0aa324bec291'
         'a66cff756f9f70e474266ed3d95bae36')

build() {
  # unset since our build machine may differ from eee
  unset CFLAGS CXXFLAGS

  # get into the linux source directory and start some magic
  cd $srcdir/linux-$_kernver
  
  # load configuration and build kernel + modules
  cp ../kernelconfig ./.config
  make menuconfig
  make || return 1

  # install our modules
  cd $srcdir/linux-$_kernver
  mkdir -p $pkgdir/{lib/modules,boot}
  make INSTALL_MOD_PATH=$pkgdir modules_install || return 1

  # remove the junk symlinks
  cd $srcdir/linux-$_kernver
  
  # IF
  if [ -d $pkgdir/lib/modules/${pkgver}/{build,source} ]; then 
  rm $pkgdir/lib/modules/${pkgver}/{build,source}
  fi
  
  # install the kernel
  cp System.map $pkgdir/boot/System.map26-eee
  cp arch/x86/boot/bzImage $pkgdir/boot/vmlinuz26-eee
}
