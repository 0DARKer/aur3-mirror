# Maintainer: LeeF <leef (at) hushmail (dot) com>
# Original Author: Andrwe <lord-weber-andrwe (at) renona-studios (dot) org>

pkgname=citrix-client
pkgver=11.100
pkgrel=5
pkgdesc="Provides XenApp(Citrix) for linux."
url="http://www.citrix.com"
arch=('i686')
license=('CAL')
depends=('gtk2' 'libx11' 'libxaw' 'libxext' 'libxft' 'libxmu' 'libxp' 'libxpm' 'libxt' 'openmotif' 'printproto' 'xextproto')
source=('http://www.citrix.com//English/SS/downloads/EULA_p.asp?downloadID=3323&versionID=1862392&productID=186')
install=citrix-client.install
md5sums=('069bb3337791b0b55cbbf666c95403e5')

build() {

	instdir="/usr/lib/ICAClient"
	# Create folder structure
	mkdir -p "${pkgdir}"/usr/lib/{ICAClient,mozilla/plugins}
	mkdir -p "${pkgdir}"/usr/bin/

	# copy needed files
	cp -r ./linuxx86/linuxx86.cor/* "${pkgdir}${instdir}"/
	cp ./setupwfc "${pkgdir}${instdir}"/
	
	# Create executable start wrapper
	echo -e "#!/bin/bash\n${instdir}/wfcmgr" > "${pkgdir}"/usr/bin/citrix-client.sh
	chmod a+x "${pkgdir}"/usr/bin/citrix-client.sh

	# Go to package directory
	cd "${pkgdir}${instdir}"/

	# Create executable wrapper for the binaries
	echo -e "#!/bin/sh\nICAROOT=/usr/lib/ICAClient\nexport \${ICAROOT}\n\${ICAROOT}/wfica -file \$1" > ./wfica.sh
	echo -e "#!/bin/sh\nICAROOT=/usr/lib/ICAClient\nexport \${ICAROOT}\n\${ICAROOT}/wfica -associate -fileparam \$1" > ./wfica_assoc.sh
	chmod a+x ./{wfica.sh,wfica_assoc.sh}
	
	# Create symlinks for the Npica.ad binary
	ln -s ./nls/en/Npica.ad ./Npica.ad
	ln -s ./Npica.ad ./Npica

	# Copy program inforamtion files to program root directory
	cp ${srcdir}/nls/en/{eula.txt,install.txt,readme.txt} ./

	# Copy default configuration files to config directory of the program and setting them readable
	cp ./nls/en/{appsrv.ini,wfclient.ini,module.ini} ./config/
	chmod 666 ./config/{appsrv.ini,wfclient.ini,module.ini}
	chmod 777 ./config

	# Copy Firefox plugin into plugin directory
#	cp ./npica.so "${pkgdir}"/usr/lib/mozilla/plugins/
	
}

