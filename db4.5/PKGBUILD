#! /bin/bash
# Maintainer: Jorge Barroso <jorge.barroso.11 at gmail dot com>
# Contributor: Oleg Smirnov <oleg.smirnov@gmail.com>
# Contributor: Jan de Groot <jgc@archlinux.org>
pkgname=db4.5
pkgver=5.3.21
pkgrel=1
pkgdesc="The Berkeley DB embedded database system 4.5"
arch=('any')
license=('custom:db4.5')
url="http://www.oracle.com/technology/software/products/berkeley-db/index.html"
options=('!libtool' '!makeflags')
source=(http://download.oracle.com/berkeley-db/db-${pkgver}.tar.gz)
sha512sums=('e09a08002b723a056b7a53dea275794a9df104296e7733ec1d7023888f23466095b38614f3ab1acbbb095d10cca70cc14c35c3519a41800eadd6863beb85e3a9')
build() {
  cd "${srcdir}/db-${pkgver}"

  cd build_unix
  ../dist/configure --prefix=/usr --enable-compat185 \
      --enable-shared --disable-static --enable-cxx || return 1
  make LIBSO_LIBS=-lpthread || return 1
  make prefix="${pkgdir}/usr" \
       includedir="${pkgdir}/usr/include/db4.5" install || return 1

  rm -rf "${pkgdir}/usr/docs"
  rm -f "${pkgdir}/usr/lib"/libdb{,_cxx}.so
  rm -f "${pkgdir}/usr/lib"/libdb{,_cxx}-4.so

  cd "${pkgdir}/usr/bin"
  for i in *; do
    mv ${i} db4.5_${i/db_/} || return 1
  done
  install -m755 -d "${pkgdir}/usr/share/licenses/${pkgname}"
  install -m644 "${srcdir}/db-${pkgver}/LICENSE" \
      "${pkgdir}/usr/share/licenses/${pkgname}/" || return 1
}

# vim:set ts=2 sw=2 et: