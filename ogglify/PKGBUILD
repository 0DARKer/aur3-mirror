pkgname=ogglify
pkgver=20130320
pkgrel=1
pkgdesc="Performs conversion from .mp3, .flac, and similar file types to .ogg and embeds them. Designed to replace oggchan"
arch=('i686' 'x86_64')
url="http://dnsev.github.com/4cs/"
license=('unknown:unknown')
depends=('ffmpeg' 'libstdc++5')
makedepends=('gcc-multilib' 'git')

_gitroot="git://github.com/dnsev/4cs.git"
_gitname="4cs"

build() {
  if [ -d ${srcdir}/${_gitname}/.git ] ; then
		(
			cd ${srcdir}/${_gitname} && \
				git checkout master && \
				git pull origin master
		)
		msg "The local files are updated."
	else
		( git clone ${_gitroot} ${_gitname} )
	fi
	msg "GIT checkout done or server timeout"

	cd ${_gitname}
	# when commit is set, check that out
	[[ "${_commit}" ]] && git checkout "${_commit}"
	if [ "${_gitphash}" == $(git show | grep -m 1 commit | sed 's/commit //') ]; then
		msg "Git hash is the same as previous build"
		return 1
	fi

  cd $srcdir/${_gitname}/ogglify/src
  g++ -o ${pkgname} SoundEmbedder.cpp
}

package() {
  install -Dm755 ${srcdir}/${_gitname}/${pkgname}/src/${pkgname} ${pkgdir}/usr/bin/${pkgname}
  install -Dm644 ${srcdir}/${_gitname}/readme.md ${pkgdir}/usr/share/doc/${pkgname}/README
}
