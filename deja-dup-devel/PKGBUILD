# Maintainer: Michael Pusterhofer <pusterhofer at student dot tugraz dot ..>
# Contributor: polslinux <garrett16 at hotmail dot it>
# Contributor: jijijaco <jijijaco at gmail dot com>
# Contributor: Jonathan Vasquez <jvasquez1011 at gmail dot com>

# There is a bug in this release (Upstream) where you can't build in parallel. The fix has been submited to trunk.
# https://bugs.launchpad.net/deja-dup/+bug/900395

# If you want nautilus support, make sure you add 'nautilus' to the depends array before compiling.

pkgname=deja-dup-devel
_pkgname=deja-dup
pkgver=21.2
_pkgmain=22
pkgrel=2
pkgdesc="A simple backup program. It hides the complexity of doing backups the 'right way' (encrypted, off-site, and regular) and uses duplicity as the backend."
arch=('i686' 'x86_64')
url="https://launchpad.net/deja-dup"
license=('GPL')
depends=('vala' 'duplicity' 'gnome-common' 'itstool')
optdepends=('bzr: A decentralized revision control system (bazaar)'
            'yelp-tools: Tools for creating Yelp documentation'  
            'xvfb: Virtual framebuffer X server'
            'nautilus: GNOME file manager'
            'gnome-control-center: GNOME control center integration')
provides=('deja-dup')
conflicts=('deja-dup' 'deja-dup-new')
install=deja-dup.install
source=("http://launchpad.net/${_pkgname}/${_pkgmain}/${pkgver}/+download/${_pkgname}-${pkgver}.tar.xz")
md5sums=('6fa0977a4049df137d0b2c5a8bb7574e')

build() {
    cd ${srcdir}/deja-dup-${pkgver} 
    ./configure --bindir=/usr/bin \
        --prefix=/usr \
		--sysconfdir=/etc \
		--datarootdir=/usr/share \
		--libexecdir=/usr/lib \
	
    # -j1 is used as a temporary fix to the parallel build bug. If -j1 isn't used,
    # then Arch systems that are configured for SMP builds, will fail.
    make -j1
}

check(){
    cd ${srcdir}/deja-dup-${pkgver}
    #make check #fixed in 21.3
}

package () {
    cd ${srcdir}/deja-dup-${pkgver}
    make DESTDIR="${pkgdir}" install
}
