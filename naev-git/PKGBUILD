# Maintainer:  John Pate <j.k.pate@sms.ed.ac.uk>

pkgname=naev-git
_pkgname=naev
pkgdesc="2d action/rpg space game"
pkgver=20101229
pkgrel=1
arch=('i686' 'x86_64')
license=('GPL')
url="http://code.google.com/p/naev/"

makedepends=('git')
depends=()
conflicts=('naev' 'naev-data')
provides=('naev' 'naev-data')

_gitroot="git://github.com/bobbens/naev.git"
_gitname="naev"


build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [ -d "$_gitname" ]; then
    cd "$_gitname"
    git pull origin
    cd ..
    msg "Files up to date"
  else
    git clone "$_gitroot" "$_gitname"
  fi

  cd $srcdir/$_gitname

  if [ "$( git branch | grep bigsys )" ] ; then
    git checkout bigsys
  else
    git checkout -b bigsys origin/bigsys
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"


  ./autogen.sh
  ./configure --prefix=/usr

  make
}

package() {
  cd "$srcdir/$_gitname-build"

  make DESTDIR="$pkgdir"  install
}
