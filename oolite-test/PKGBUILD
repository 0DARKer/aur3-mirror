# Maintainer: Lone_Wolf <lonewolf@xs4all.nl>
pkgname=oolite-test
pkgver=1.75.1
_realver=1.75.1
pkgrel=1
pkgdesc="A space-sim based on the classic Elite"
arch=('i686' 'x86_64')
url="http://oolite-linux.berlios.de"
license=('GPL2')
groups=()
depends=('gnustep-gui' 'sdl_mixer' 'mesa' 'libpng' 'espeak' 'nspr')
makedepends=('gcc-objc' 'subversion' 'gnustep-make')
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
source=(oolite)
noextract=()
md5sums=('653a862453d74f64c3d206656c6291e8')


_svntrunk=http://svn.berlios.de/svnroot/repos/oolite-linux/tags/${_realver}/
_svnmod=oolite-test-${_realver}

build() {
    cd $srcdir
    if [ -d $_svnmod/.svn ]; then
	(cd $_svnmod && svn up -r 4469)
    else
      svn co $_svntrunk --config-dir ./ -r 4469 $_svnmod
    fi
    msg "SVN checkout done or server timeout"
    msg "Starting make..."
    rm -rf ${srcdir}/${_svnmod}-build
    cp -r ${srcdir}/${_svnmod} ${srcdir}/${_svnmod}-build

# preparation

    mkdir -p ${pkgdir}/usr/bin
    mkdir -p ${pkgdir}/usr/share/{oolite.app,applications,pixmaps,doc/oolite}
    source /opt/GNUstep/System/Library/Makefiles/GNUstep.sh
# compile

    cd ${srcdir}/${_svnmod}-build/deps/Cocoa-deps/scripts
    ./update-mozilla.sh
    mkdir -p ${srcdir}/${_svnmod}-build/deps/Cross-platform-deps/mozilla/js/src/build-release
    cd ${srcdir}/${_svnmod}-build/deps/Cross-platform-deps/mozilla/js/src/build-release
    ../configure --disable-shared-js --enable-threadsafe --with-system-nspr --disable-tests --enable-trace-jscalls
    cd ${srcdir}/${_svnmod}-build
    make -f Makefile release
}

package() {
    cd ${srcdir}/${_svnmod}-build
    cp -r oolite.app/* ${pkgdir}/usr/share/oolite.app/
#install shellscript and icon
    install -D -m755 ../oolite ${pkgdir}/usr/bin/oolite
    install -D -m644 installers/FreeDesktop/oolite-icon.png ${pkgdir}/usr/share/pixmaps/oolite-icon.png
# copy  .desktop file
    install -D -m644 installers/FreeDesktop/oolite.desktop ${pkgdir}/usr/share/applications/oolite.desktop
# documentation
    install -D -m644 Doc/AdviceForNewCommanders.pdf Doc/OoliteReadMe.pdf Doc/OoliteRS.pdf ${pkgdir}/usr/share/doc/oolite/
 }
# vim:set ts=2 sw=2 et:
