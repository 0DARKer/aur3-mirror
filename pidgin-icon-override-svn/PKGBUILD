# Contributor: Jed Liu <jed@litech.org>
pkgname=pidgin-icon-override-svn
pkgver=3
pkgrel=1
pkgdesc="Pidgin Prpl Icon Override"
arch=('i686' 'x86_64')
url="http://pidgin-icon-override.googlecode.com/"
license=('GPL3')
groups=()
depends=('pidgin')
makedepends=('subversion')
provides=('pidgin-icon-override')
conflicts=('pidgin-icon-override')
replaces=()
backup=()
options=()
install=
source=(makefile.patch facebook16.png facebook22.png facebook48.png google-talk48.png)
noextract=()
md5sums=('d1f0dee924cf049862d166ed8ceebb9d'
         'acef0528b67eaa81b8a14165e9e33b33'
         'fad9c62d3535cf565efe781d4b167f4d'
         'f554b61b44817ca9ccdcdb9336877420'
         'e2155e15532ef0c87a30b27dde9116b3')
sha1sums=('1ffa0306f69d2bfe1e4df89770c3061a6ae485ef'
          'f957668dd61920f7122c340d44132287b70d563d'
          'a1e8447057b49ba237c1a42a052409c723dbca5d'
          '60ac16da0787557d121114a7e53ec94a979855e2'
          'fa17f073a65b8b47e814759c3a10976fd3d92dde')
sha256sums=('c8e0d8516e9b8e35d9c72bb91c6a0dacf921db3cef3fe96e81762a126e95fa24'
            'b91571b0af46907012f2a697540fa9748b20b8b27ead106ad7d8120ab2455083'
            '40d737dd243b7d397068c1e1d37bb81b923d91a7fc4580a1b7b623978e8eca17'
            'a2c25bedded91416455e57a994c19085a12563ac0e67997c98a391b989aa5622'
            'ef6303b968f7ea4129571bdeea5b3eb1a576ba35b7876ee23a1d891a2b997c1f')
sha384sums=('3d371d2ab2b3933073e85d1533fe925f6cbcf2e45c293545ff71aee6021d1906fc15a86f77df534f91e9e336c16ee8b0'
            '07bcb719f594e75f8860c09f2ea8434e9de58e4776365993c9e3c79b5e32147ba89fd992bfe1f3cc88634b7b629ccfad'
            '7836187101e6a27bd98c119fe8d4e005e69bf761f8d0cc55b5869b15cbe8edd9ec790aa44b8fb256197c1e481389110b'
            'e09342334865f5b62a209eb072d359e8b156da4bd005e07f18063bf40637eec2741cba9b55737669b73b28a1cc1a11e4'
            '920597cec4f04f54e569d310f025eb970e46dd8ab71248df00af1ca516e8f12fcae443a6026612a47161da12b8557ca9')
sha512sums=('f380e8ba8e4fffd8eb7d9c5050897705d0dca1e4de70b8837b2d20fed3f3831afda32dd2ffe963daf526f083bae249a048c213a38eaa7dc411ae2cbb4b72da8d'
            '5ec051424e6f22660d2ebec8c65cf70593d48733ebec7fd314d60342bba3c5f94a569a76b12528eb732de3e3a36ea9fecae7d3759395a2619298f58c638e97bb'
            'cdc246f404d1bef84d98d63b220019ae17cc8865876ad1bbe1af78a40d8c5d3faaed3bc3bcaec35482fb3cd4fe869cd9ba4bb8d547b2f4a13828926fd575e1ac'
            '492a6b26d6c8f79359f25fa038491792ace4245f756cc6fca4bb7984438d4a3f64e6f65a8e0319ba38592e182d6d2fb15bce4baa08a74b8bf296fa16cec00fc9'
            'ae9966c1fc490e87b8cf1703fa034892ac733a23b517db0c667675cb3dba5eb10494d81cf7f0a14790f3b763ea710ec3f1b3d17d2da1e3eae56c955b904e85bd')

_svntrunk=http://pidgin-icon-override.googlecode.com/svn/trunk/
_svnmod=pidgin-icon-override

build() {
  cd "$srcdir"

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_svnmod-build"
  cp -r "$srcdir/$_svnmod" "$srcdir/$_svnmod-build"
  cd "$srcdir/$_svnmod-build"

  patch < ${srcdir}/makefile.patch

  #
  # BUILD
  #
  make icon_override.so || return 1
  install -D -m 0755 icon_override.so ${pkgdir}/usr/lib/purple-2/icon_override.so
  for i in 16 22 48 ; do
    install -D -m 0644 ${srcdir}/facebook${i}.png \
      ${pkgdir}/usr/share/pixmaps/pidgin/protocols/${i}/facebook.png || return 1
  done

  install -D -m 0644 ${srcdir}/google-talk48.png \
    ${pkgdir}/usr/share/pixmaps/pidgin/protocols/${i}/google-talk.png
}
