# Maintainer: Nathan Hulse <nat.hulse@gmail.com>

pkgname=compiz-core-dev
pkgver=0.9.5.0
pkgrel=3
pkgdesc="Core package of the current Compiz development release, with optional GNOME integration."
url="http://www.compiz.org/"
license=('GPL' 'LGPL' 'MIT')
arch=('i686' 'x86_64')
depends=('startup-notification' 'librsvg' 'libgl' 'dbus' 'mesa' 'libxslt' 'fuse' 'boost' 'glib2' 'glibmm' 'libxrandr' 'libxcomposite' 'libxinerama')
optdepends=(
    'ccsm-dev: CompizConfig Settings Manager'
    'compizconfig-backend-gconf-dev: provides alternate storage of preferences and tighter GNOME integration'
    'compiz-plugins-main-dev: main plugin package for Compiz'
    'compiz-plugins-extra-dev: extra plugins for Compiz'
    'metacity: support for Metacity window decoration themes (requires rebuild)'
    'gnome-control-center: GNOME keybindings support (requires rebuild)'
    'kdebase-lib: for inclusion of the KDE window decorator (requires rebuild)'
    'automoc4: for inclusion of the KDE window decorator (requires rebuild)'
)
makedepends=('intltool' 'cmake')	
provides=('compiz-core')
conflicts=('compiz-core')
install=('compiz.install')
source=("http://releases.compiz.org/$pkgver/compiz-${pkgver}.tar.bz2"
	'gnome-compiz.session'
	'gnome-compiz.desktop'
	'compiz.desktop')
sha1sums=('fac758014e55b774cae0205251d15099b4ada9fc'
	'98c6af8323a328643e5d91175c560237114bf195'
	'4428c95d0edef93a20a0f621496f03429c6253f6'
	'6c1905bc9940618ad25c265609549a8374e9edb3')

# On = Integrate keybindings support with GNOME 
gnome_keybind="On"

# On = Build the GTK Window Decorator.
gtk_decor="On"

# On = Install GConf Schemas 
use_gconf="On"

# On = Build the KDE4 Window Decorator 
kde_decor="On"

# On = Build testing tools. 
testing="Off"

# On = Add GNOME session entries to enable starting Compiz ontop of the GNOME 3 stack
gnome_session_files="Off"

# See below for toggling of selected plugins. Be aware that some plugins are dependant on others.

build() {
	cd "compiz-${pkgver}"
	[[ -d build ]] || mkdir build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX=/usr -DCOMPIZ_DESTDIR="${pkgdir}" \
        -DBUILD_GNOME_KEYBINDINGS="$gnome_keybind" -DBUILD_GTK="$gtk_decor" -DUSE_GCONF="$use_gconf" \
        -DBUILD_KDE4="$kde_decor" -DBUILD_TESTING="$testing" \
		-DCOMPIZ_DEFAULT_PLUGINS="composite,opengl,decor,resize,place,move" \
		-DCOMPIZ_DISABLE_PLUGIN_FADE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_SCREENSHOT=Off \
		-DCOMPIZ_DISABLE_PLUGIN_OBS=Off \
		-DCOMPIZ_DISABLE_PLUGIN_DECOR=Off \
		-DCOMPIZ_DISABLE_PLUGIN_SCALE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_RESIZE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_CLONE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_WATER=Off \
		-DCOMPIZ_DISABLE_PLUGIN_ANNOTATE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_COMMANDS=Off \
		-DCOMPIZ_DISABLE_PLUGIN_BLUR=Off \
		-DCOMPIZ_DISABLE_PLUGIN_CUBE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_COMPOSITE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_COPYTEX=Off \
		-DCOMPIZ_DISABLE_PLUGIN_GNOMECOMPAT=Off \
		-DCOMPIZ_DISABLE_PLUGIN_OPENGL=Off \
		-DCOMPIZ_DISABLE_PLUGIN_KDE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_REGEX=Off \
		-DCOMPIZ_DISABLE_PLUGIN_COMPIZTOOLBOX=Off \
		-DCOMPIZ_DISABLE_PLUGIN_SWITCHER=Off \
		-DCOMPIZ_DISABLE_PLUGIN_INOTIFY=Off \
		-DCOMPIZ_DISABLE_PLUGIN_ROTATE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_PLACE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_MOVE=Off \
		-DCOMPIZ_DISABLE_PLUGIN_WOBBLY=Off \
		-DCOMPIZ_DISABLE_PLUGIN_INI=Off \
		-DCOMPIZ_DISABLE_PLUGIN_ZOOM=Off \
		-DCOMPIZ_DISABLE_PLUGIN_IMGPNG=Off \
		-DCOMPIZ_DISABLE_PLUGIN_DBUS=Off \
		-DCOMPIZ_DISABLE_PLUGIN_IMGSVG=Off
     	make
	make install
	make findcompiz_install
	if [ $gnome_session_files == "On" ]; then
                cd ../..
		install -m755 -d "$pkgdir"/usr/share/{gnome-session/sessions,xsessions,applications}/
		install -m644 gnome-compiz.session "$pkgdir"/usr/share/gnome-session/sessions/
		install -m644 gnome-compiz.desktop "$pkgdir"/usr/share/xsessions/
		install -m644 compiz.desktop "$pkgdir"/usr/share/applications/
        fi
}
