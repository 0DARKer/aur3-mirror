#Contributor: Bodor Dávid Gábor <david.gabor.bodor@gmail.com>

# Note: at the moment, only works with additional symlinks in /usr/lib
pkgname=python3-scipy
pkgver=0.9.0
pkgrel=1
pkgdesc="SciPy (pronounced 'Sigh Pie') is open-source software for mathematics, science, and engineering."
arch=('i686' 'x86_64')
url="http://www.scipy.org"
license=('BSD')
depends=('lapack' 'blas' 'python' 'python-numpy')
makedepends=('gcc' 'gcc-fortran')
conflicts=('scipy' 'scipy_core')
source=("http://downloads.sourceforge.net/scipy/scipy-${pkgver}.tar.gz")
md5sums=('ebfef6e8e82d15c875a4ee6a46d4e1cd')

build() {
    unset LDFLAGS
    unset FFLAGS

    cd ${srcdir}/scipy-${pkgver}
    #Changing the arithmetic parameter (Thanks to Fabrizio Castellano)
    #sed -i "s/\#define\ UNK\ 1/\#define\ IBMPC\ 1/" $srcdir/scipy-$pkgver/scipy/special/cephes/mconf.h

    # fix build with python 2.7 (see http://projects.scipy.org/scipy/ticket/1180)
    #patch -p1 < ${srcdir}/0001-FIX-define-macro-to-access-C99-extensions-from-C.patch

    # python2 fix
    #for file in $(find . -name '*.py' -print); do
    #    sed -i 's_^#!.*/usr/bin/python_#!/usr/bin/python2_' $file
    #    sed -i 's_^#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
    #done
    #export ATLAS=/usr/lib/libatlas.so
    ln -sf -T /usr/lib/liblapack.so ${srcdir}/liblapack.cpython-32mu.so
    ln -sf -T /usr/lib/libblas.so ${srcdir}/libblas.cpython-32mu.so
    export LAPACK=${srcdir}/
#liblapack.cpython32-mu.so
    export BLAS=${srcdir}/
#libblas.cpython32-mu.so
    python setup.py config_fc --fcompiler=gnu95 build
    #python setup.py build
    python setup.py config_fc --fcompiler=gnu95 install --prefix=/usr --root=${pkgdir}
    #python setup.py install --prefix=/usr --root=${pkgdir} 
    install -D -m644 LICENSE.txt ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE.txt
}
