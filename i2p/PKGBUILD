# Contributor: Rorschach <r0rschach@lavabit.com>
# Contributor: Cedric Chabanois <cchabanois@gmail.com>

pkgname=i2p
pkgver=0.8
pkgrel=1
pkgdesc="A distributed anonymous network"
url="http://www.i2p2.de"
license=('GPL')
depends=('java-runtime')
arch=('i686' 'x86_64')
install=i2p.install
source=(http://mirror.i2p2.de/i2pinstall_${pkgver}.exe i2prouter)
md5sums=('988f1011da4915c1cfe4584f2346a1bc'
         'a7add637da7eb646bef3f1c276bd9f56')
build() {
  cd $srcdir
  cat >install.properties << EOC
INSTALL_PATH=$pkgdir/opt/i2p
EOC
  java -jar i2pinstall_${pkgver}.exe -options install.properties
  sed -i "s|$pkgdir/opt/i2p|/opt/i2p|g" $pkgdir/opt/i2p/i2prouter $pkgdir/opt/i2p/wrapper.config $pkgdir/opt/i2p/runplain.sh $pkgdir/opt/i2p/eepget 
  sed -i 's/#RUN_AS_USER=/RUN_AS_USER=i2p/' $pkgdir/opt/i2p/i2prouter
  rm $pkgdir/opt/i2p/.installationinformation
  rm -r $pkgdir/opt/i2p/Uninstaller
  install -Dm755 i2prouter $pkgdir/etc/rc.d/i2prouter
}
