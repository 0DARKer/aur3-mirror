# Contributor: Anton Leontiev <bunder /at/ t-25.ru>
pkgname=perl-math-gsl
pkgver=0.22
pkgrel=2
pkgdesc="Interface to the GNU Scientific Library using SWIG"
arch=('i686' 'x86_64')
url="http://search.cpan.org/dist/Math-GSL/"
license=('GPL')
options=(!emptydirs)
depends=('perl' 'gsl')
makedepends=('perl' 'gsl' 'perl-extutils-pkgconfig') # 'perl-test-exception' 'perl-test-class'
source=(http://search.cpan.org/CPAN/authors/id/L/LE/LETO/Math-GSL-$pkgver.tar.gz)
md5sums=('bc2a8673eac9b2d3f162f68146351964')

build() {
  cd $srcdir/Math-GSL-$pkgver
  PERL_MM_USE_DEFAULT=1 perl Build.PL --installdirs vendor --destdir $pkgdir
  ./Build
  # ./Build test
  ./Build install

  # There is a bug in makepkg. It doesn't find *.so files with following command (see makepkg code)
  # find ${STRIP_DIRS[@]} -type f -perm -u+w
  # Thus the automatic stripping doesn't work.
  # I think the problem is in fakeroot environment.
  # Also, it is necessary to set a proper value to STRIP_DIRS, like (usr/lib).
  find $pkgdir/usr/lib/perl5 -name *.so -exec strip --strip-unneeded '{}' \;

  find $pkgdir -name perllocal.pod -delete
  find $pkgdir -name .packlist -delete
}
