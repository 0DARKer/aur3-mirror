# Contributor: Jonas Heinrich <onny@project-insanity.org>
# Maintainer: Jonas Heinrich <onny@project-insanity.org>

pkgname=dudle-bzr
pkgver=566
pkgrel=1
pkgdesc=""
arch=(any)
url="https://dudle.inf.tu-dresden.de"
license=('AFGPL3')
depends=('ruby' 'ruby-gettext')
makedepends=('bzr')
optdepends=('ruby-atom: Atom feed support')
source=('dudle.service')
sha512sums=('2199372422ba133ad152c101830ee928813fd3f8b2d3c14981d4175925f067123bcbb0378a83237454d6b7e1c1b03194b68884c958924a27a363db8785b3dceb')

_bzrtrunk="https://dudle.inf.tu-dresden.de/"
_bzrmod="dudle"

build() {
  cd "$srcdir"
  msg "Connecting to Bazaar server...."

  if [[ -d "$_bzrmod" ]]; then
    cd "$_bzrmod" && bzr --no-plugins pull "$_bzrtrunk" -r "$pkgver"
    msg "The local files are updated."
  else
    #bzr --no-plugins branch "$_bzrtrunk" "$_bzrmod" -q -r "$pkgver"
    bzr --no-plugins branch "$_bzrtrunk" "$_bzrmod" -q -r "$pkgver"
    #bzr --no-plugins branch ${_bzrtrunk} ${_bzrmod} -q
  fi

  msg "Bazaar checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_bzrmod-build"
  cp -r "$srcdir/$_bzrmod" "$srcdir/$_bzrmod-build"
  cd "$srcdir/$_bzrmod-build"
}

package() {
  cd "$srcdir/$_bzrmod-build"
  mkdir -p $pkgdir/usr/share/webapps/dudle
  cp -r * $pkgdir/usr/share/webapps/dudle
  install -Dm644 "${srcdir}/dudle.service" "${pkgdir}/usr/lib/systemd/system/dudle.service"
}

# vim:set ts=2 sw=2 et:
