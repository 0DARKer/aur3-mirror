# Maintainer: ssf <punx69 at gmx dot net>
pkgname=kvantum-tools-qt5-svn
pkgver=r137
pkgrel=1
pkgdesc="Kvantum config tools build against Qt5"
arch=('i686' 'x86_64')
url="https://github.com/tsujan/Kvantum"
license=("GPL3")
depends=('qt5-base' 'libxext')
makedepends=('subversion' 'coreutils' 'make')
optdepends=('qt5-style-kvantum-svn: An SVG theme engine for qt5' 'qt4-style-kvantum-svn: An SVG theme engine for qt4' 'kvantum-kde4-colorscheme-svn: Kvantum colorscheme for KDE4')
conflicts=('kdestyle-kvantum-kde4' 'kdestyle-kvantum-kde4-git' 'kvantum-tools-qt4-svn')
provides=("kvantum-tools-qt5=${pkgver}")
_svntrunk=https://github.com/tsujan/Kvantum/trunk/Kvantum
_svnmod="$pkgname"

pkgver() {
	cd "$srcdir"/"$_svnmod" >/dev/null 2>&1
	local ver="$(svnversion)"
	printf "r%s" "${ver//[[:alpha:]]}"
}

build() {
	cd "$srcdir"
	msg "Connecting to SVN server..."
	if [ -d "$_svnmod/.svn" ]; then
		(cd "$_svnmod" && svn up .)
	else
		svn co "$_svntrunk" --config-dir ./ "$_svnmod"
	fi
	msg "SVN checkout done or server timeout"
	cd "$srcdir/$_svnmod"
	cd kvantumpreview
	qmake-qt5
	make -j$(expr $(nproc) \* 2 - 1) -l$(nproc)
	cd ../kvantummanager
	qmake-qt5
	make -j$(expr $(nproc) \* 2 - 1) -l$(nproc)
}

package() {
	install -Dm0755 $srcdir/$pkgname/kvantumpreview/kvantumpreview $pkgdir/usr/bin/kvantumpreview
	install -Dm0755 $srcdir/$pkgname/kvantummanager/kvantummanager $pkgdir/usr/bin/kvantummanager
	install -Dm0644 $srcdir/$pkgname/kvantummanager/data/kvantummanager.desktop $pkgdir/usr/share/applications/kvantummanager.desktop
	install -Dm0644 $srcdir/$pkgname/kvantumpreview/kvantum.svg $pkgdir/usr/share/pixmaps/kvantum.svg
}
