# Maintainer : SpepS <dreamspepser at yahoo dot it>
# Contributor:  <farid at archlinux-br.org>

pkgname=supercollider
pkgver=3.4.2rc2
pkgrel=3
pkgdesc="An environment and programming language for real time audio synthesis and algorithmic composition"
arch=('i686' 'x86_64')
url="http://supercollider.sourceforge.net/"
license=('GPL')
depends=('jack' 'avahi' 'fftw' 'icu')
makedepends=('scons' 'emacs' 'vim' 'ruby')
optdepends=('emacs: emacs interface'
            'gedit: gedit interface'
            'vim: vim interface'
            'ruby: vim support'
            'unhtml: vim support')
install="$pkgname.install"
source=("http://downloads.sourceforge.net/project/$pkgname/Source/${pkgver/rc*}/SuperCollider-$pkgver-Source-linux.tar.gz")
md5sums=('ce8072fed7e4bbbd58a04f8b9829b5bd')

build() {
  cd "$srcdir/SuperCollider-Source/common"

  # Fix sclangpipe_app path in scvimrc
  sed -i "s|local/||" ../editors/scvim/scvimrc

  # Stripping Debian related code
  sed -i "34,52d" ../editors/scvim/bin/scvim

  # utf-8 encoding fix for ruby 1.9
  sed -i "s|ruby|& -Kn|" ../editors/scvim/bin/scvim_make_help

  scons PREFIX=/usr X11=yes SCEL=yes SCED=yes LID=yes READLINE=no
}

package() {
  cd "$srcdir/SuperCollider-Source/common"

  scons DESTDIR="$pkgdir" install

  # Installing vim files
  scons -C ../editors/scvim PREFIX="$pkgdir/usr" VIMFILE_DIR=/usr/share/vim/addons install-system

  install -d "$pkgdir/usr/share/vim/vimfiles"
  cp -a ../editors/scvim/{extra,ftplugin,indent,syntax} \
    "$pkgdir/usr/share/vim/vimfiles"
}
