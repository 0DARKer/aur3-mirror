# Maintainer: archtux <antonio dot arias99999 at gmail dot com>

pkgname=newton-adventure
pkgver=1.13
pkgrel=1
pkgdesc="Newton Adventure is a 2D platformer with a twist: the player can rotate gravity at 360Â°."
arch=('i686' 'x86_64')
url="http://devnewton.bci.im/games/newton_adventure"
license=('BSD' 'CC-BY-SA')
depends=('java-environment')
makedepends=('maven')
source=(http://dl.bci.im/games/newton_adventure/newton_adventure_${pkgver}_sources.zip)
md5sums=('437e3db0324ce976dc8e1211d167599c')

build() {
  cd $srcdir
  mvn package
}

package() {
  cd $srcdir/target
  mkdir -p $pkgdir/opt/newton_adventure/natives

  # Executable
  install -Dm755 newton_adventure-1.13.jar $pkgdir/opt/newton_adventure/newton_adventure.jar

  # Data
  cp -rf ../data $pkgdir/opt/newton_adventure
  
  # Desktop icon
  install -Dm644 newton_adventure.desktop $pkgdir/usr/share/applications/newton_adventure.desktop
  install -Dm644 classes/icon.png $pkgdir/usr/share/pixmaps/newton_adventure.png
  
  # Fix Desktop icon
  sed -i 's|Game;|Game;ArcadeGame|;s|icon|newton_adventure|;s|Exec=|Exec=java -jar |;s|Icon=/opt/newton_adventure|Icon=/usr/share/pixmaps|' $pkgdir/usr/share/applications/newton_adventure.desktop

  # Libraries
  cd natives
  if [ "${CARCH}" = 'x86_64' ]; then ar=64  
  fi
  cp -r libjinput-linux$ar.so liblwjgl$ar.so libopenal$ar.so  $pkgdir/opt/newton_adventure/natives
}