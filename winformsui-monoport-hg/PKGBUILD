pkgname=winformsui-monoport-hg
pkgver=5
pkgrel=1
pkgdesc="The docking library for .Net Windows Forms development which mimics Visual Studio .Net."
url="https://bitbucket.org/hindlemail"
arch=(any)
license=("MIT")
depends=(mono)
makedepends=(mono mercurial)
options=(!strip)
source=("${pkgname%-*}::hg+https://bitbucket.org/hindlemail/winformsui-monoport"
"WinFormsUI.snk")
md5sums=('SKIP' 'b9445c254930c4ca5cb78deaf9c95cdb')

pkgver() {
	"$SRCDEST/${pkgname%-*}"
	hg identify -ni | awk 'BEGIN{OFS=".";} {print $2,$1}'
}

build() {
  cd "${srcdir}/${pkgname%-*}"
  xbuild WinFormsUI.Docking.sln
  cd "WinFormsUI/bin/Debug"
  monodis WeifenLuo.WinFormsUI.Docking.dll --output=WeifenLuo.WinFormsUI.Docking.il
  ilasm /dll /key:$srcdir/WinFormsUI.snk WeifenLuo.WinFormsUI.Docking.il
}

package() {
  cd "${srcdir}/${pkgname%-*}/WinFormsUI/bin/Debug"
  install -Dm644 WeifenLuo.WinFormsUI.Docking.dll "$pkgdir/usr/lib/winformsui/WeifenLuo.WinFormsUI.Docking.dll"
  install -Dm644 WeifenLuo.WinFormsUI.Docking.dll.mdb "$pkgdir/usr/lib/winformsui/WeifenLuo.WinFormsUI.Docking.dll.mdb"
  gacutil -i WeifenLuo.WinFormsUI.Docking.dll -root "$pkgdir/usr/lib"
  install -Dm644 "${srcdir}/${pkgname%-*}/license.txt" "$pkgdir/usr/share/licenses/winformsui-monoport/license.txt"
}
