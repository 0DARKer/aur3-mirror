# Maintainer: Yann Kaiser <kaiser.yann@gmail.com>
pkgname=bittriprunner
pkgver=1.0
pkgrel=1
pkgdesc="Rhythm-based action platformer"
arch=('i686' 'x86_64')
url="http://bittripgame.com/bittrip-runner.html"
license=('custom')
depends=('sdl' 'libgl' 'openal' 'libvorbis' 'libogg' 'zlib')
makedepends=()
source=('bittriprunner.desktop' 'bittriprunner.sh')
md5sums=('a3b58d3afad9b24f29c1e49e0c649a36'
         '3f4cf7688a32a688fb1b9ce9fb4fc8f8')

_archive_name="bit.trip.runner"
if test "${CARCH}" == "x86_64"; then
  _archive_arch="amd64"
  _archive_md5="ba315db4752f1397d0577b63aea7cb34"
else
  _archive_arch="i386"
  _archive_md5="62bb8c0b411a0edba9f5d6d7ddc50962"
fi

_archive="${_archive_name}_${_archive_arch}.tar.gz"

build() {
  cd ${srcdir}

  if [ ! -f ${_btrarchivelocation}${_archive} ]; then
	  if [ ! -f ${_archive} ] && [ -n "${_humblebundle4key}" ]; then
		rm -f ${_archive}* index.html\?key\=${_humblebundle4key}*
		wget http://www.humblebundle.com/?key=${_humblebundle4key}
		wget $(cat index.html\?key\=${_humblebundle4key} | grep "${_archive}" | cut -d "'" -f 10)
		mv ${_archive}* ${_archive}
	  elif [ -z "${_humblebundle4key}" ]; then
		echo You can automate the download of the archive using the _humblebundle4key bash variable.
		echo Just add \'export _humblebundle4key\=\<Your key here\>\' to \.bashrc
		echo
		echo Otherwise please just place ${_archive} into $(pwd)/
		echo Press Enter to continue
		read -a _unused
	  fi
  fi

  if [ ! -f ${_btrarchivelocation}${_archive} ]; then
    echo "${_btrarchivelocation}${_archive} not found!"
    return 1
  fi

  if ! echo "${_archive_md5}  ${_btrarchivelocation}${_archive}" | md5sum -c --quiet; then
    echo "Invalid checksum for ${_btrarchivelocation}${_archive}"
    return 1
  fi

  bsdtar -xf ${_btrarchivelocation}${_archive}

  mkdir -p ${pkgdir}/opt/ ${pkgdir}/usr/bin/ \
    ${pkgdir}/usr/share/applications
  cp -r ${srcdir}/${_archive_name}-${pkgver}/${_archive_name}/ ${pkgdir}/opt/
  cp ${srcdir}/${pkgname}.desktop ${pkgdir}/usr/share/applications/
  cp ${srcdir}/${pkgname}.sh ${pkgdir}/opt/${_archive_name}/
  ln -s /opt/${_archive_name}/${pkgname}.sh \
    ${pkgdir}/usr/bin/${pkgname}
  chmod a+rx ${pkgdir}/opt/${_archive_name}/${pkgname}.sh
  chmod a+r ${pkgdir}/usr/share/applications/${pkgname}.desktop
}

# vim: et ts=2 sw=2 sts=2

