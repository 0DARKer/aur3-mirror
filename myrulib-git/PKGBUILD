pkgname=myrulib-git
_realpkgname=myrulib
pkgver=20100715
pkgrel=1
pkgdesc="Home library. Supports lib.rus.ec (lib.ololo.cc) and flibusta.net archives."
license=('GPL')
arch=('i686' 'x86_64')
url="http://www.lintest.ru/wiki/MyRuLib"
provides=("${_realpkgname}")
depends=('wxgtk' 'sqlite3' 'expat')
makedepends=('git' 'make')
conflicts=("${_realpkgname}")

_gitroot="git://github.com/lintest/myrulib.git"
_gitname="myrulib"

build() {
  cd ${srcdir}/

  msg "Connecting to the github.com GIT server...."
  if [[ -d ${srcdir}/${_gitname} ]] ; then
    cd ${srcdir}/${_gitname} && git pull origin
    msg "The local files are updated..."
  else
    git clone ${_gitroot}

	 cd ${srcdir}/${_gitname}
    git branch -f master origin/master
    git checkout master
  fi

  msg "GIT checkout done."

  if [[ -d ${srcdir}/${_gitname}-build ]]; then
    msg "Cleaning the previous build directory..." 
    rm -rf ${srcdir}/${_gitname}-build
  fi

  msg "Starting make for: ${pkgname}"
    
  cp -R ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build
  cd ${srcdir}/${_gitname}-build

  chmod +x configure
  ./configure --prefix=/usr

  make WX_SHARED=1 || return 1
  make DESTDIR=$pkgdir install || return 1
}
