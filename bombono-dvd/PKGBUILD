# $Id: PKGBUILD

pkgname=bombono-dvd
pkgver=1.2.1
pkgrel=3
pkgdesc="DVD authoring program with nice and clean GUI"
arch=('i686' 'x86_64')
url="http://www.bombono.org"
license=('GPL')
depends=('gtk2>=2.8' 'gtkmm>=2.4' 'mjpegtools>=1.8.0' 'ffmpeg' 'libdvdread' 'dvdauthor' \
         'dvd+rw-tools' 'twolame' 'libxml++' 'boost>=1.47' 'enca' 'scons>=0.96' 'cdrkit')
optdepends=('gvfs: web browser integration')
conflicts=('bombono-dvd-git')
source=(http://downloads.sourceforge.net/bombono/$pkgname-$pkgver.tar.bz2
        bombono-dvd-1.2.1-glib.patch bombono-dvd-boost-1.51.0-fix.patch bombono-dvd-ffmpeg-ffviewer.patch)
install=bombono-dvd.install
sha256sums=('89817ce134b5ee2879285dfb30e9f8b0603b2282989ecb91793e7b928d64152f'
            'bff2c5f84dc4aae2fc4bcbda393d752de794a8a956848c560e4d2f471113e359'
            'f96827cbf9ef0aa50c522dee4db863bdfe44994a5d3811f5a52a195ddafa2622'
            '251123afbd75b5450187a33943bd589379b9fa950591e5df8224d6627fb49785')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  # patch -p1 -i "$srcdir"/ffmpeg_arch.diff
  patch -Np0 -i "${srcdir}/bombono-dvd-1.2.1-glib.patch"
  patch -Np1 -i "${srcdir}/bombono-dvd-boost-1.51.0-fix.patch"
  patch -Np0 -i "${srcdir}/bombono-dvd-ffmpeg-ffviewer.patch"
  #find . -name "*.[hc]" -exec sed -ir 's/#include <glib[\/\-][^\.]*\.h>/#include <glib.h>/' '{}' \;
  # python2 fix
  for file in $(find . -name '*.py' -print); do
     sed -i 's_#!.*/usr/bin/python_#!/usr/bin/python2_' $file
     sed -i 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
  done
  for file in $(find . -name 'SConscript*' -print); do
     sed -i 's_#!.*/usr/bin/python_#!/usr/bin/python2_' $file
     sed -i 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
  done
  for file in $(find . -name 'menu_SConscript*' -print); do
     sed -i 's_#!.*/usr/bin/python_#!/usr/bin/python2_' $file
     sed -i 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
  done
  sed -i -e 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' Autoconfig
  for file in $(find . -name 'SConstruct*' -print); do
     sed -i 's_#!.*/usr/bin/python_#!/usr/bin/python2_' $file
     sed -i 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' $file
  done
  #sed -i -e 's_#!.*/usr/bin/env.*python_#!/usr/bin/env python2_' SConstruct

  scons  PREFIX="/usr" DESTDIR="$pkgdir" CPPFLAGS="-DBOOST_SYSTEM_NO_DEPRECATED -DBOOST_FILESYSTEM_VERSION=3" USE_EXT_BOOST=1
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  scons PREFIX="/usr" DESTDIR="$pkgdir" install
}

