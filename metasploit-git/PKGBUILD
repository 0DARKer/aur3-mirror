# Maintainer: Johannes Schleifenbaum <johannes [at] js-webcoding [dot] de>

pkgname=metasploit-git
pkgver=20130403
pkgrel=1
pkgdesc="A development platform for creating security tools and exploits."
arch=('any')
url='http://metasploit.com/'
license=('BSD')
depends=('ruby' 'ruby-msgpack')
makedepends=('git')
provides=('metasploit')
conflicts=('metasploit')
options=('!strip')
optdepends=('java-runtime: msfgui' 'ruby-pg: database support')
_gitroot='https://github.com/rapid7/metasploit-framework.git'

build() {
  cd "$srcdir"
  msg "Connecting to github.com GIT server...."

  if [ -d "$srcdir/$pkgname" ] ; then
    cd "$pkgname" && git pull origin master
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$pkgname"
  fi

  msg "GIT checkout done or server timeout"
}

package() {
  cd "$pkgdir"
  mkdir -p usr/{bin,src}

  cp -R $srcdir/$pkgname usr/src/$pkgname
  rm -R usr/src/$pkgname/.git
  rm usr/src/$pkgname/msfupdate

  install -Dm644 usr/src/$pkgname/COPYING usr/share/licenses/$pkgname/COPYING
  install -Dm644 usr/src/$pkgname/LICENSE usr/share/licenses/$pkgname/LICENSE

  cd usr/bin

  for f in ../src/$pkgname/msf*; do
    ln -s $f .
  done
}
