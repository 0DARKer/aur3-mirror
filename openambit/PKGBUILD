# Maintainer: Marius Orcsik <marius@habarnam.ro>

pkgname=openambit
pkgver=0.2
pkgrel=3
makedepends=('cmake')
depends=('libusb' 'qt4' 'systemd' 'zlib' 'qjson')
license=("GPL3")
pkgdesc="OpenAmbit application to upload workouts from Ambit watches to Suunto's Movescount"
arch=('i686' 'x86_64')
url="http://openambit.org/"

source=("https://github.com/openambitproject/openambit/archive/${pkgver}.tar.gz")
sha256sums=("45d0938c257268c992bf27813b6dbfb5ad06fff8e6175e0edbcf52af218ed9c2")

build() {
    if [ -d ${srcdir}/${pkgname}-${pkgver}/libambit-build ] ; then
        rm -rf ${srcdir}/${pkgname}-${pkgver}/libambit-build
    fi
    if [ -d ${srcdir}/${pkgname}-${pkgver}/openambit-build ] ; then
        rm -rf ${srcdir}/${pkgname}-${pkgver}/libambit-build
    fi
        
    mkdir -p ${srcdir}/${pkgname}-${pkgver}/libambit-build
    cd ${srcdir}/${pkgname}-${pkgver}/libambit-build
    cmake -DCMAKE_INSTALL_PREFIX=/usr ../src/libambit
    make 

    mkdir -p ${srcdir}/${pkgname}-${pkgver}/openambit-build
    cd ${srcdir}/${pkgname}-${pkgver}/openambit-build
    cmake -DCMAKE_INSTALL_PREFIX=/usr ../src/openambit
    make 
}
package() {
    cd ${srcdir}/${pkgname}-${pkgver}/libambit-build
    make DESTDIR=${pkgdir}/ install

    cd ${srcdir}/${pkgname}-${pkgver}/openambit-build
    make DESTDIR=${pkgdir}/ install
}
