# Maintainer: Louis-Guillaume Gagnon <louis.guillaume.gagnon@gmail.com>
pkgname=ghc-git
pkgver=2010.11.18.5777.g3e598fe
pkgrel=1
pkgdesc="The Glasgow haskell compiler (git version)"
arch=('x86_64')
url="http://haskell.org/ghc"
license=('custom')
depends=('')
makedepends=('ghc' 'alex' 'happy')
#source=(git+https://github.com/ghc/ghc.git)
md5sums=('SKIP')

_gitroot=https://github.com/ghc/ghc.git
_gitname=ghc

pkgver() {
    cd ${srcdir}/ghc
    git describe --always | sed 's|-|.|g'
}

prepare() {
    cd ${srcdir}
    msg "Connecting to GIT server...."

    if [[ -d "$_gitname" ]]; then
      cd "$_gitname" && git pull origin
      msg "The local files are updated."
    else
      git clone "$_gitroot" "$_gitname"
    fi

    msg "GIT checkout done or server timeout"

    cd ${srcdir}/ghc
    ./sync-all pull
    ./sync-all get
}

build() {
        cd ${srcdir}/ghc
        perl boot
        ./configure --prefix=/opt/ghc-git
        make
}

package() {
	cd ${srcdir}/ghc
	make DESTDIR=${pkgdir} install
}

