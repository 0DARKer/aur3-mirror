# Maintainer: Adrian King Legaspi <aki.legaspi@gmail.com>
pkgname=ghc-git
pkgver=ghc.7.9.start.4468.g3c1f2f7
pkgrel=2
pkgdesc="The Glasgow haskell compiler (git version)"
arch=('any')
url="https://github.com/ghc/ghc"
license=('custom')
#depends=('gmp4')
makedepends=('perl' 'python' 'ncurses' 'ghc' 'alex' 'happy' 'dblatex')
source=("git://github.com/ghc/ghc.git" 'build.mk')
provides=('ghc')
conflicts=('ghc')
install='ghc-git.install'
md5sums=('SKIP'
         'b85e5aa31f42ef80f82b58a324200a31')

_gitroot=git://github.com/ghc/ghc.git
_gitname=ghc

pkgver() {
    cd ghc
    git describe --always | sed 's|-|.|g'
}

prepare() {
    cd ${srcdir}
    msg "Connecting to GIT server...."

    if [[ -d "$_gitname" ]]; then
      cd "$_gitname" && git pull origin
      msg "The local files are updated."
    else
      git clone "$_gitroot" "$_gitname"
    fi

    msg "GIT checkout done or server timeout"

    cd ${srcdir}/ghc
    ./sync-all get
}

build() {
        cd ${srcdir}/ghc
        cp ${srcdir}/build.mk mk/build
        perl boot
        ./configure --prefix=/usr
        make
}

package() {
	cd ${srcdir}/ghc
	make DESTDIR=${pkgdir} install
  install -d ${pkgdir}/usr/share/licenses/ghc
  install -m644 LICENSE \
    ${pkgdir}/usr/share/licenses/ghc
}

