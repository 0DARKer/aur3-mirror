# Contributor: bubla <matej.tyc@gmail.com>

pkgname=mingw32-libtiff
pkgver=3.9.4
pkgrel=1
pkgdesc="Library for manipulation of TIFF images, mingw32 port"
arch=('any')
url="http://www.remotesensing.org/libtiff/"
license=('custom')
depends=('mingw32-libjpeg>=7' 'mingw32-zlib')
makedepends=()
optdepends=('freeglut: for using tiffgt')
options=('!libtool')
source=(ftp://ftp.remotesensing.org/pub/libtiff/tiff-3.9.4.tar.gz \
        libtiff-CVE-2009-2285.patch)
#        libtiff-CVE-2009-2285.patch tiff-3.9.0-CVE-2009-2347.patch)
md5sums=('2006c1bdd12644dbf02956955175afd6' 'ff61077408727a82281f77a94f555e2a')
sha1sums=('a4e32d55afbbcabd0391a9c89995e8e8a19961de' 'eadce8c8bd72ea9c74f35300bf299131813b0c8b')

build() {
  cd "${srcdir}/tiff-${pkgver}"
  #patch -p1 < ../libtiff-CVE-2009-2285.patch || return 1
  #patch -p0 < ../tiff-3.9.0-CVE-2009-2347.patch || return 1
  patch -p1 < ../libtiff-CVE-2009-2285.patch || return 1
  #because of hash style gnu 
  unset LDFLAGS
  ./configure --prefix=/usr/i486-mingw32 --host=i486-mingw32 --sysconfdir=/usr/i486-mingw32/etc --mandir=/usr/i486-mingw32/share/man || return 1
  make || return 1
}

package() {
  cd "${srcdir}/tiff-${pkgver}"
  make DESTDIR="${pkgdir}" install || return 1
  install -D -m644 COPYRIGHT "${pkgdir}/usr/i486-mingw32/share/licenses/${pkgname}/LICENSE" || return 1
}
