# Maintainer: Guillaume ALAUX <guillaume at alaux dot net>
pkgname=jonas
pkgver=5.1.5
pkgrel=1
pkgdesc="Java EE 5 certified Open Source OSGi Enterprise Server by OW2"
arch=('any')
url="http://jonas.ow2.org/"
license=('LGPL')
depends=('java-runtime' 'apache-ant>1.7')
makedepends=()
install=jonas.install

source=(\
  http://download.forge.objectweb.org/${pkgname}/${pkgname}-full-${pkgver}-bin.tar.gz \
  http://www.apache.org/dist/jakarta/bcel/binaries/bcel-5.2.tar.gz \
  jonas \
  jonas.sh
)

md5sums=('6d0ac3a1ccd5f01bff4fac0f120674be'
         '19bffd7f217b0eae415f1ef87af2f0bc'
         '0c4aea56e0e0369e51c7c76aea7441c7'
         'ab6a50bab9ecb98cb34f7fc1932009a1')

build()
{
  mkdir -p $pkgdir/opt || return 1
  # JOnAS files
  cp -a $srcdir/jonas-full-$pkgver $pkgdir/opt/$pkgname || return 1
  mkdir -p $pkgdir/var/log/ || return 1
  # BCEL jar
  mkdir -p $pkgdir/$ANT_HOME/lib || return 1
  cp $srcdir/bcel-5.2/bcel-5.2.jar $pkgdir/$ANT_HOME/lib || return 1
  # Daemon startup script
  install -D -m755 $srcdir/jonas $pkgdir/etc/rc.d/jonas || return 1
  # Cleanup
  find $pkgdir/opt/$pkgname/bin -name "*.bat" -delete
  # Environment variables
  install -D -m755 $srcdir/jonas.sh $pkgdir/etc/profile.d/jonas.sh
}
