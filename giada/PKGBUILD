# Maintainer: Limao Luo <luolimao+AUR@gmail.com>
# Contributor: rtfreedman
# Contributor: SpepS <dreamspepser@yahoo.it>

pkgname=giada
pkgver=0.5.8
pkgrel=1
pkgdesc="A minimal, hardcore audio tool and loop machine for DJs and live performers"
arch=(i686 x86_64)
url=http://www.giadamusic.com/
license=(GPL3)
depends=(libxpm fltk rtaudio)
install=$pkgname.install
#options=(!strip) #debug
source=($pkgname-$pkgver.tar.gz::$url/download-action.php?os=source
    $url/img/$pkgname-logo.png
    $pkgname.desktop)
sha256sums=('fd47966a0e5a59d36ee7e10ff4ca398976229dd48d7ec58902fe6c4456c859d2'
    'a0319be4b7f25ac52beee2e5d14b60bdb253ad574c36b49be63ac05328823512'
    'ab645cad52cf908f4d1957a0d166ee9ad3ec9f24b2593310fd634d648e2ce915')
sha512sums=('cdb796d3cee1d0183d5b6ebe7e9866ec84fc682a2ec70c27c18bf8f04075cccec9e5c1a8ff14a81f8e7486e3d141738b81a0ffeb6747dff196ef32644edf057c'
    'eb59a4f4a844e0c19939e5776d7fdc5fc8c737287930ad7250bd434a158b00bb536799e559c067715db567e4dd13baebfc01ee4cafb4000ec4f45148f1a6fe79'
    'f97dbcc0c76a08f456a205d10bf46d1cab1e61f203c7e693727c678ccf8f1b853faacf261da6b331f54452c379a6e0ad65800f8bcac47e3fbcd5b5ea0f4c9c22')

build() {
    cd "$srcdir"
    export CXXFLAGS+=" -I/usr/include/rtaudio" # -g
    export CPPFLAGS+=" -I/usr/include/rtaudio"

    sed -i "s:\((void\*)\)\([ic]\):\1(intptr_t)\2:" src/gg_keyboard.cpp

    # BUG: giada defaults on 44100 sampling rate becoming
    #      not jack server, run at 48000 (default), capable.
    # FIX: forcing giada working at 48000.
    # WIP: auto detect sampling rate safely (have little issues ATM)
    # FAQ: comment next line if you do not intend using it with jack@48000
    sed -i 's/44100/48000/' $(find -type f)

    ./configure --prefix=/usr --target=linux
    cd src/
    make
}

package() {
    cd "$srcdir"
    make DESTDIR="$pkgdir" install

    install -Dm644 $pkgname.desktop "$pkgdir"/usr/share/applications/$pkgname.desktop
    install -Dm644 $pkgname-logo.png "$pkgdir"/usr/share/pixmaps/$pkgname.png
}
