pkgname=qmplay
pkgver=1.53.10
pkgrel=1
pkgdesc="Polish, cross-platform music player. QMPlay plays music from hard disk, 4shared.com and wrzuta.pl. Supported formats: AudioCD, MODs, OGG Vorbis, MP3, AAC, and uncompressed audio."
url="http://zaps166.sourceforge.net/"
license="LGPL"
arch=('i686' 'x86_64')
depends=('qt' 'mpg123' 'libmikmod' 'libmodplug' 'faad2' 'libcdio' 'libcddb' 'curl' 'taglib' 'libvorbis' 'libogg' 'portaudio' 'libsndfile')
makedepends=('gcc' 'make')
install=QMPlay.install

build()
{
	cd $pkgdir

	mkdir -p usr/share/applications/
	mkdir -p usr/share/pixmaps/
	mkdir -p usr/bin/
	mkdir opt/

	cd $pkgdir/usr/bin
	ln -s ../../opt/qmplay/qmplay qmplay

	cd $srcdir
	if [ $PWD != $srcdir ]; then
		echo "Error"
		return 1
	fi
	rm -rf *
	wget "http://sourceforge.net/projects/zaps166/files/QMPlay/src/public_qmplay_src_1_53_10.tar.bz2/download"
	tar jxf *
	if [ $? != 0 ]; then
		echo "Can't unpack archive, exiting... ;("
		return 1
	fi
	cd *
	sh compile_unix.sh
	if [ $? != 0 ]; then
		echo "There are errors, exiting... ;("
		return 1
	fi
	rm -rf qmplay_binary/install
	mv qmplay_binary $pkgdir/opt/qmplay

	cp qmp_lib/icons/play_64x64.png $pkgdir/usr/share/pixmaps/QMPlay.png
	cp qmp/Linux/install/QMPlay.desktop $pkgdir/usr/share/applications/
	cp qmp/Linux/install/QMPlay_enqueue.desktop $pkgdir/usr/share/applications/
	cp qmp/Linux/install/qplst-qplst.xml $pkgdir/opt/qmplay/

	cd $pkgdir/opt/qmplay

	touch noautoupdates

	touch QMPlay_opis.pdf
	wget -O QMPlay_opis.pdf "http://zaps166.sourceforge.net/?dwn=qmplay/QMPlay_opis.pdf"
	f=`file QMPlay_opis.pdf`
	isPDF=`echo $f | awk '{
		printf( $2 );
	}'`
	if [ -e $isPDF ] || [ $isPDF != "PDF" ]; then
		rm -f QMPlay_opis.pdf
	fi

	return 0
}
