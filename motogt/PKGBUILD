# Maintainer: archtux <antonio.arias99999 at gmail.com>

pkgname=motogt
pkgver=20110505
pkgrel=1
pkgdesc="MotoGT is a 2D top-viewed game where you drive a MotoGP bike"
arch=('i686' 'x86_64')
url="http://motogt.sourceforge.net/"
license='GPL2'
depends=('sfml=1.6')
source=(http://prdownloads.sourceforge.net/motogt/MotoGT-$pkgver.zip)
md5sums='5fa3a8ba52ea75bc46f011906ddc6747'

# Due to that the program is written using old(incompatible) libraries, you must do 2 (dirty) hacks before compiling!
# 1. Install sfml 1.6(64 bits) from : http://schlunix.org/archlinux/community/os/x86_64/sfml-1.6-3-x86_64.pkg.tar.xz
# 1. Install sfml 1.6(32 bits) from : http://schlunix.org/archlinux/community/os/i686/sfml-1.6-3-i686.pkg.tar.xz
# 2. Create symlink to libglew library 1.5 -> 1.7 : ln -s /usr/lib/libGLEW.so.1.7 /usr/lib/libGLEW.so.1.5

build() {
  cd $srcdir/MotoGT

  # Patch (Add glut and OpenGL libraries in Makefile.lnx)
  sed -i "s/-s/-s -lglut -lGL/" src/Makefile.lnx

  # Build
  make

  # Installation
  mkdir -p $pkgdir/usr/share/MotoGT
  install -Dm755 MotoGT.bin $pkgdir/usr/share/MotoGT/MotoGT.bin
  cp -R data/ data_low/ $pkgdir/usr/share/MotoGT

  # Write permissions
  chmod 4511 -R $pkgdir/usr/share/MotoGT

  # Start file
  install -Dm755 $startdir/MotoGT_start $pkgdir/usr/bin/MotoGT_start

  # Desktop icon
  install -Dm644 ./data/bikes/01/thumbnail.png $pkgdir/usr/share/pixmaps/MotoGT.png
  install -Dm644 $startdir/MotoGT.desktop $pkgdir/usr/share/applications/MotoGT.desktop
}