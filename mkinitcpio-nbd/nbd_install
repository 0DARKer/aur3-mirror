# vim: set ft=sh:

install ()
{
    MODULES="nbd"

    BINARIES=""
    FILES=""
    SCRIPT="nbd"

    add_binary "/usr/sbin/nbd-client" "/bin/nbd-client"
}

help ()
{
cat<<HELPEOF
  This hook allows you to boot from a Network Block Device (nbd).
  The nbd hook depends on the net hook, so make sure you add net
  before nbd in the hook list in mkinitcpio.conf. You will also
  have to remove autodetect from the hook list because the initrd
  image will be created on the server and not the client.

  Kernel Parameters:

  <nbd_server>  IP address and port of the nbd server in the format <ip>:<port>.
	        Example: nbd_server=192.168.0.1:10809

  Also make sure that you set root=/dev/nbd0 and the ip parameter
  from the net hook (see 'mkinitcpio -H net' for details).
  Your hook list may then look like this:
  HOOKS="base udev net nbd filesystems"

  If your nbd device is encrypted, set cryptdevice=/dev/nbd0:nbdcrypt and
  root=/dev/mapper/nbdcrypt. You also will have to add the hooks usbinput,
  keymap and encrypt to your hook list after the net and nbd hooks.
  Your hook list may then look like this:
  HOOKS="base udev net nbd usbinput keymap encrypt filesystems"
HELPEOF
}
