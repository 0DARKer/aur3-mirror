_pkgbasename=openexr
pkgname=lib32-$_pkgbasename
pkgver=1.6.1
pkgrel=1
pkgdesc="Openexr library for EXR images (32 bit, library only)"
arch=('x86_64')
url="http://www.openexr.org"
license=('custom')
depends=('lib32-zlib' 'lib32-ilmbase' "$_pkgbasename>=$pkgver")
makedepends=('gcc-multilib')
options=('!libtool')
source=("http://savannah.nongnu.org/download/${_pkgbasename}/${_pkgbasename}-${pkgver}.tar.gz"
		'gcc43.patch')
md5sums=('11951f164f9c872b183df75e66de145a'
         '7c83ee3d69ad688142e7de63cb68e70a')

build() {
  cd ${srcdir}/${_pkgbasename}-${pkgver}
  patch -p1 -i ${srcdir}/gcc43.patch
  ./configure --prefix=/usr --libdir=/usr/lib32 CXX='g++ -m32'
  make
}

package() {
  cd ${srcdir}/${_pkgbasename}-${pkgver}
  
  make DESTDIR=${srcdir} install
  
  # Cleanup for a lib32 package
  rm -rf ${pkgdir}/usr/{bin,include,share,lib32/*.a}
  # Link to existing license folder, instead of creating new one
  mkdir -p ${pkgdir}/usr/share/licenses && cd ${pkgdir}/usr/share/licenses
  ln -sf ${_pkgbasename} ${pkgname}
}
