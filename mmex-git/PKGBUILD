# Maintainer: Igor Borges <igor@borges.me>
 
_pkgname=mmex
pkgname=mmex-git
pkgver=1.1.r347.gc991818
pkgrel=1
pkgdesc="Money Manager Ex, git version"
arch=('i686' 'x86_64')
url="http://www.moneymanagerex.org/"
license=('GPL')
depends=('wxgtk') # Dunno if wxgtk or wxgtk2.8
makedepends=('git' 'gettext')
provides=('mmex')
conflicts=('mmex')
options=(!strip)
source=("$_pkgname::git://github.com/moneymanagerex/moneymanagerex.git"
    "http://www.kryogenix.org/code/browser/sorttable/sorttable.js")
md5sums=('SKIP'
         '3809d26cbae145842e56f374192e56d9')
install=${_pkgname}.install
 
pkgver() {
  cd "$_pkgname"
  git describe --long --tags | sed -r 's/([^-]*-g)/r\1/;s/-/./g;s/v//'
}
 
prepare() {
  cd "$_pkgname"
  git clone --depth 1 https://github.com/moneymanagerex/wxsqlite3.git "${srcdir}/$_pkgname/lib/wxsqlite3/"
  git clone --depth 1 https://github.com/moneymanagerex/cajun.git "${srcdir}/$_pkgname/src/cajun"
  git clone --depth 1 https://github.com/moneymanagerex/html-template.git "${srcdir}/$_pkgname/src/html-template"
  cp -R "${srcdir}/$_pkgname/src/html-template/"* "${srcdir}/$_pkgname/src/"
  git clone --depth 1 https://github.com/moneymanagerex/mongoose.git "${srcdir}/$_pkgname/src/mongoose"
  git clone --depth 1 https://github.com/moneymanagerex/LuaGlue.git "${srcdir}/$_pkgname/src/LuaGlue"
  cp -R "${srcdir}/$_pkgname/src/LuaGlue/include/LuaGlue/"* "${srcdir}/$_pkgname/src/LuaGlue/"
  git clone --depth 1 https://github.com/moneymanagerex/route.git "${srcdir}/$_pkgname/src/route"
  git clone --depth 1 https://github.com/moneymanagerex/csv-parser.git "${srcdir}/$_pkgname/src/csv_parser"
  cp -R "${srcdir}/$_pkgname/src/csv_parser/include/csv_parser/"* "${srcdir}/$_pkgname/src/csv_parser/"
  cp -R "${srcdir}/$_pkgname/src/html-template/"* "${srcdir}/$_pkgname/3rd/cgitemplate/"
  cp -R "${srcdir}/$_pkgname/src/mongoose/"* "${srcdir}/$_pkgname/3rd/mongoose/"
  cp -R "${srcdir}/$_pkgname/src/csv_parser/"* "${srcdir}/$_pkgname/3rd/csv-parser/"
  cp -R "${srcdir}/$_pkgname/src/route/"* "${srcdir}/$_pkgname/3rd/route/"
  git clone --depth 1 https://github.com/nnnick/Chart.js.git "${srcdir}/$_pkgname/3rd/Chart.js"
  git clone --depth 1 https://github.com/FVANCOP/ChartNew.js.git "${srcdir}/$_pkgname/3rd/ChartNew.js"
  # Copy sorttable.js to 3rd
  cp ${srcdir}/sorttable.js "3rd/sorttable.js/sorttable.js"
}
 
build() {
  cd "$_pkgname"
  ./configure --prefix=/usr \
        --enable-unicode \
        --enable-shared \
        --with-wxshared \
        --with-gtk \
        --with-wx-config=/usr/lib/wx/config/gtk2-unicode-3.0 \
  #LIBS="-ldl -lm -lpthread"
  make
 
  cd "po"
  make
}
 
package() {
  cd "$_pkgname"
  make DESTDIR="$pkgdir" install
}

install() {
  gtk-update-icon-cache "${pkgdir}/usr/share/icons/hicolor"
}
 
# vim:set ts=2 sw=2 et: