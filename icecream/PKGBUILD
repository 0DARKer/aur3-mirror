#Contributor: Isaac C. Aronson <isaac@pingas.org>

pkgname=icecream
pkgver=20130220
pkgrel=1
pkgdesc="Icecream takes compile jobs from your build and distributes it to remote machines allowing a parallel build on several machines."
url="http://en.opensuse.org/Icecream"
license="GPL"
depends=('gcc' 'git')
provides=('icecream' 'icecream1')
optdepends=('icemon-svn' 'systemd')
conflicts=('icecream1')
backup=('etc/icecream.conf')
arch=('i686' 'x86_64')
install=icecream.install
_gitroot="https://github.com/icecc/icecream.git"
_gitname="icecream"
source=(icecream.conf icecream.service icecream-scheduler.service icecreamd icecream-schedulerd) 
md5sums=('51aae781751a11d108e174352d6e739d'
         '256dbfd08c2c7b51cbb62de3ae830afd'
         'b97228cf444282a995fa228b9969d7da'
         'aad41fb7f4b7dacf4321a64f55e65e39'
         '62295c0d75d9fd67a8dcf88ab3d04d7a')

build() {
    cd "$srcdir"
    msg "Connecting to GIT server..."
    if [ -d "$_gitname" ] ; then
        cd "$_gitname" && git pull origin
        cd "$srcdir"
        msg "The local files are updated."
    else
        git clone --depth=1 "$_gitroot" "$_gitname"
    fi
    msg "GIT checkout done or server timeout"
    cd "$srcdir/icecream"
    ./autogen.sh
    ./configure --prefix=/usr/lib/icecream
    make
}

package() {
    make DESTDIR="$pkgdir" install
    install -D -m755 ../icecream.conf "$pkgdir/etc/icecream.conf"
    install -D -m755 ../icecreamd "$pkgdir/usr/lib/icecream/icecreamd"
    install -D -m755 ../icecream-schedulerd "$pkgdir/usr/lib/icecream/icecream-schedulerd"
    install -D -m644 ../icecream-scheduler.service "$pkgdir/usr/lib/systemd/system/icecream-scheduler.service"
    install -D -m644 ../icecream.service "$pkgdir/usr/lib/systemd/system/icecream.service"
}
