#Contributor: Isaac C. Aronson <isaac@pingas.org>

pkgname=icecream
pkgver=1.1rc1
pkgrel=1
pkgdesc="Icecream takes compile jobs from your build and distributes it to remote machines allowing a parallel build on several machines."
url="http://en.opensuse.org/Icecream"
license="GPL"
builddepends=('docbook2x')
depends=('gcc' 'git')
provides=('icecream' 'icecream1')
optdepends=('icemon-svn' 'systemd')
conflicts=('icecream1')
backup=('etc/icecream.conf')
arch=('i686' 'x86_64')
install=icecream.install
source=("https://github.com/icecc/$pkgname/archive/1.1rc1/$pkgname-$pkgver.tar.gz"
        icecream.conf
        icecream.service
        icecream-scheduler.service
        icecreamd
        icecream-schedulerd)
md5sums=('fd2488ecbb62ea2abbd73d263ae674e5'
         '51aae781751a11d108e174352d6e739d'
         '256dbfd08c2c7b51cbb62de3ae830afd'
         'b97228cf444282a995fa228b9969d7da'
         'aad41fb7f4b7dacf4321a64f55e65e39'
         '62295c0d75d9fd67a8dcf88ab3d04d7a')

build() {
  cd "$srcdir/$pkgname-$pkgver"
  ./autogen.sh
  ./configure --prefix=/usr/lib/icecream --without-man
  make all
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  echo $(pwd)
  make DESTDIR="$pkgdir" install
  install -D -m755 "$srcdir"/icecream.conf "$pkgdir/etc/icecream.conf"
  install -D -m755 "$srcdir"/icecreamd "$pkgdir/usr/lib/icecream/icecreamd"
  install -D -m755 "$srcdir"/icecream-schedulerd "$pkgdir/usr/lib/icecream/icecream-schedulerd"
  install -D -m644 "$srcdir"/icecream-scheduler.service "$pkgdir/usr/lib/systemd/system/icecream-scheduler.service"
  install -D -m644 "$srcdir"/icecream.service "$pkgdir/usr/lib/systemd/system/icecream.service"
}
