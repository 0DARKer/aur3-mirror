# Maintainer: rtfreedman  (rob<d0t>til<d0t>freedman<aT>googlemail<d0t>com

pkgname=fsthost-svn
_svnmod=fsthost
pkgver=386
pkgrel=1
pkgdesc="A linux VST host using winelib, fork of FreeST."
arch=('i686' 'x86_64')
url="http://sourceforge.net/projects/fsthost/"
license=('GPL')
depends=('libxml2' 'lash' 'gtk2')
[[ "$CARCH" = 'x86_64' ]] &&
{  depends=(${depends[@]/#/lib32-})
}
depends+=('wine' 'zenity')
#optdepends=('zenity: for fsthost_menu')
makedepends=('subversion')
conflicts=('fsthost')
source=("$_svnmod::svn+http://svn.code.sf.net/p/fsthost/code/trunk")
md5sums=('SKIP')

pkgver() {
  cd "$SRCDEST/$_svnmod/"
  svnversion | tr -d [A-z]
}

#prepare() {
#  cd "$_svnmod"
#  cp -a "$SRCDEST/$_svnmod/.svn" .
#}

build() {
  cd "$_svnmod"
# this hack adds missing '#include <stdio.h>'
  sed 's@^#include@#include <stdio.h>\n#include@' -i lash/lash.c
# this hack adds a path to jfst.h
  sed 's@"jfst.h"@"../jfst/jfst.h"@' -i lash/lash.c
# make GTK=2 | GTK=0 | LASH_EXISTS=no | PLAT=32 | PLAT=64
  make LASH_EXISTS=no GTK=2 # PLAT=32 
}

package() {
  cd "$_svnmod"
  make PREFIX=/usr DESTDIR="${pkgdir}" install
}
