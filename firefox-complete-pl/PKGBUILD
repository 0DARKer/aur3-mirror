# Contributor: Toovix <toovix@null.net>

pkgname=firefox-complete-pl
pkgver=3.6.3
pkgrel=2
_xulver=1.9.2
pkgdesc="Standalone web browser from mozilla.org (polish version)"
arch=(i686 x86_64)
license=('MPL' 'GPL' 'LGPL')
depends=("xulrunner>=${_xulver}" 'desktop-file-utils')
makedepends=('zip' 'unzip' 'pkgconfig' 'diffutils' 'python' 'libgnomeui' 'patch')
replaces=('firefox' 'firefox3' 'firefox3-branded')
conflicts=('firefox' 'firefox3' 'firefox3-branded' "mozilla-firefox-${_language}" "firefox-${_language}" "firefox-spell-${_language}" )
_language=pl
provides=("firefox=${pkgver}")
install=firefox.install
url="http://www.mozilla.org/projects/firefox"
source=(http://releases.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/source/firefox-${pkgver}.source.tar.bz2
        mozconfig
        firefox.desktop
        firefox-safe.desktop
        mozilla-firefox-1.0-lang.patch
        browser-defaulturls.patch
        firefox-version.patch
        http://releases.mozilla.org/pub/mozilla.org/firefox/releases/${pkgver}/linux-i686/xpi/${_language}.xpi
        https://addons.mozilla.org/pl/firefox/downloads/file/26096/polski_slownik_poprawnej_pisowni-${pkgver}-fx+tb+sm.xpi)
md5sums=('5e4541ab23084b7b14ba228291ce2688'
         '1bb4a77a63891bd82b2e9fc7caecd4b6'
         'ba96924ece1d77453e462429037a2ce5'
         '5e68cabfcf3c021806b326f664ac505e'
         'bd5db57c23c72a02a489592644f18995'
         '8bf21158090c89fd834bb711aae0602e'
         '92c11c66dd69b03f214002fededd1fc8'
         '7830e4e59a54dd293cd485cbb5ca034a'
         '4e2f43e6e59f340316603efe823d1a3c')

build() {
  cd "${srcdir}/mozilla-${_xulver}"
  patch -Np1 -i "${srcdir}/mozilla-firefox-1.0-lang.patch" || return 1
  patch -Np0 -i "${srcdir}/browser-defaulturls.patch" || return 1
  patch -Np1 -i "${srcdir}/firefox-version.patch" || return 1

  cp "${srcdir}/mozconfig" .mozconfig
  unset CFLAGS
  unset CXXFLAGS

  export LDFLAGS="-Wl,-rpath,/usr/lib/firefox-${pkgver}"

  make -j1 -f client.mk build MOZ_MAKE_FLAGS="${MAKEFLAGS}" || return 1
  make -j1 DESTDIR="${pkgdir}" install || return 1

  rm -f ${pkgdir}/usr/lib/firefox-3.6/libjemalloc.so

  install -m755 -d ${pkgdir}/usr/share/applications
  install -m755 -d ${pkgdir}/usr/share/pixmaps
  install -m644 ${srcdir}/mozilla-${_xulver}/other-licenses/branding/firefox/default48.png ${pkgdir}/usr/share/pixmaps/firefox.png || return 1
  install -m644 ${srcdir}/firefox.desktop ${pkgdir}/usr/share/applications/ || return 1
  install -m644 ${srcdir}/firefox-safe.desktop ${pkgdir}/usr/share/applications/ || return 1
  
  cd ${startdir}/src
  unzip -o ${_language}.xpi
  sed -i "s|jar:chrome/${_language}.jar|jar:${_language}.jar|" chrome.manifest || return 1
  install -D -m 644 chrome/${_language}.jar ${pkgdir}/usr/lib/firefox-3.6/chrome/${_language}.jar || return 1
  install -D -m 644 chrome.manifest ${pkgdir}/usr/lib/firefox-3.6/chrome/${_language}.manifest || 
return 1

  cd $startdir/src/dictionaries
  install -D -m 644 pl.aff ${pkgdir}/usr/share/myspell/pl.aff || return 1
  install -D -m 644 pl.dic ${pkgdir}/usr/share/myspell/pl.dic || return 1
}

