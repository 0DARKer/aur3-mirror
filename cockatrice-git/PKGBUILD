pkgname=cockatrice-git
pkgver=20120110
pkgrel=1
pkgdesc="A multiplatform application for playing card games such as Magic: The Gathering over a network."
arch=('i686' 'x86_64')
url="http://www.cockatrice.de/index.php"
license=('GPL2')
depends=('qt>=4.5.1')
source=('cockatrice.sh' 'arch_build.patch')
md5sums=('c3158c4b53526148faa0a036dc521860'
         '0d2a8e4e983a12107490946e7585df94')
makedepends=('git')
install='cockatrice.install'

_gitroot="git://cockatrice.git.sourceforge.net/gitroot/cockatrice/cockatrice"
_gitname="cockatrice"

build() {
  cd "$srcdir"

  msg "Connecting to the GIT server...."
  if [ -d "$_gitname" ]; then
    cd $_gitname && git pull origin
    msg2 "Local files updated"
    cd ..
  else
    git clone $_gitroot
  fi
  msg2 "GIT checkout done or server timeout"

  rm -rf $_gitname-build
  cp -r $_gitname $_gitname-build
  cd $_gitname-build/cockatrice

  patch -Np2 -i "$srcdir/arch_build.patch"

  lrelease cockatrice.pro
  qmake
  make

  cd ../oracle

  lrelease oracle.pro
  qmake
  make

  cd ../servatrice

  lrelease servatrice.pro
  qmake
  make

  cd ..

  install -dm775 -g games $pkgdir/opt/cockatrice/{bin,oracle,pic}

  install -Dm755 $srcdir/cockatrice.sh $pkgdir/usr/bin/cockatrice
  install -Dm644 cockatrice/cockatrice.desktop $pkgdir/usr/share/applications/cockatrice.desktop
  install -Dm755 -g games cockatrice/cockatrice $pkgdir/opt/cockatrice/bin
  install -Dm755 -g games servatrice/servatrice $pkgdir/opt/cockatrice/bin
  install -Dm755 -g games oracle/oracle $pkgdir/opt/cockatrice/bin
  install -dm775 -g games zonebg/ $pkgdir/opt/cockatrice/zonebg
  install -m644 -g games zonebg/* $pkgdir/opt/cockatrice/zonebg/

  install -Dm664 -g games oracle/sets.xml $pkgdir/opt/cockatrice/oracle
  install -Dm644 -g games servatrice/servatrice.ini.example $pkgdir/opt/cockatrice/bin

}
