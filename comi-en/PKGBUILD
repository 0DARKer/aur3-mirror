pkgname=comi-en
pkgver=1.0
pkgrel=1
pkgdesc="The Curse of Monkey Island (English version) for ScummVM. Requires original files."
arch=('any')
url="http://www.lucasarts.com/products/monkey/Default.htm"
license=('custom')
depends=('scummvm' 'xdg-utils')
makedepends=('icoutils' 'imagemagick')
install=$pkgname.install
source=('comi-en.desktop'
        'comi.la0::local://comi.la0'
        'comi.la1::local://comi.la1'
        'comi.la2::local://comi.la2'
        'curse.exe::local://curse.exe'
        'readme.txt::local://readme.txt'
        'bbsan.san::local://bbsan.san'
        'curserng.san::local://curserng.san'
        'fg010gp.san::local://fg010gp.san'
        'finale.san::local://finale.san'
        'font0.nut::local://font0.nut'
        'font1.nut::local://font1.nut'
        'font2.nut::local://font2.nut'
        'font3.nut::local://font3.nut'
        'font4.nut::local://font4.nut'
        'kis030.san::local://kis030.san'
        'language.tab::local://language.tab'
        'lavaride.san::local://lavaride.san'
        'liftcrse.san::local://liftcrse.san'
        'moreslaw.san::local://moreslaw.san'
        'musdisk1.bun::local://musdisk1.bun'
        'musdisk2.bun::local://musdisk2.bun'
        'newboots.san::local://newboots.san'
        'opening.san::local://opening.san'
        'sb010.san::local://sb010.san'
        'sb020.san::local://sb020.san'
        'sinkshp.san::local://sinkshp.san'
        'voxdisk1.bun::local://voxdisk1.bun'
        'voxdisk2.bun::local://voxdisk2.bun'
        'wrecksan.san::local://wrecksan.san'
        'zap010.san::local://zap010.san')
sha256sums=('6b77afcc4d8377df53d4d5ff515a3ec6f4dcc0c27db2d9bf968585a925b5949a'
            '22cf910b853db0615b6e86b4fb320144bd807c99b5e93619bfaefa8a9d06d3b9'
            'fd71129d567c788555fdd55b870f52eb609582f12520b4474e7fb7c3827ca9e1'
            '3ee1ed35fefe472eb3a5ec35086650fcff96ee2752e1bc9d7831167c6c2413ac'
            'ebd7bf579fff80bc1593e9566489d51350a097fc8383cb12a6bb54e0d62b85d5'
            '9325da7845276418c14a715ad3748e40a65584bf890a54a417670aeaec78c0fa'
            '0522efeffea9905b51a48729fab4f3860da3619489dc9cecac3e64b685fe3d0d'
            'ed063511b33a71b39cf629b45d0327ddd148b9e2f10aed989b091c5adc6dacc6'
            '8be5a7be705aafbd08b610fe3a7e716a26222805a21427a2da788b05144a68ec'
            'f92c850fa0ec0bc9afa8f1b391843b63d37f7c3b3a08d5346a3508ca1a703e61'
            '22145873f8beae7bfaa0e13f88e25b7f480d5e367fdb7d9c3bb119a9ab1ecc03'
            'fa5dce384012cf9e5b832f1312e28122df8b2265ed439db8d4117bd6133d017d'
            'fa5dce384012cf9e5b832f1312e28122df8b2265ed439db8d4117bd6133d017d'
            'c1a99f65c6a18faa5b5071505c0a0509e8f6552e7d8202e174605f3175beee53'
            'dcb41776b61851ec84a39d54b810ff32b2b2cc128ee7ac602b657b0232e3b844'
            '5f7249141ea8a00c4c88fae5f4a0fd34de8c763a09b40f9eb8e0f29e77dd7e13'
            '9b64d17419b1509c07332d81edd0552d8db3d79d349e9285e9c702f32129f38c'
            '1da5bb095be25f35ea1b18323e4228dc37f36f3408ecdf52c4b345527601e762'
            '9f59c70a6e24c46d9bd2403ba68a8e0ecf89821e2957534fd05454eb35925a59'
            'e397a555797248182e39bf016bd2f2461db6219b2b86ee093c8c5cc0aaab0519'
            'd1c3d6c835975dac0adf9e9c1172aa1ae64a9216a8ac5ad59f31f43a43d26088'
            'd13f279e32fc563c64c499980662deb9d378974950c7e95975f9278d41be5211'
            '97ea0f295cfdc23498523ab772412b6bd1235afa6ca241ac762d241296022736'
            'bff4ecbea93ba708d89aafbd1b64594c17b322a5942669598910bd4a05cc2152'
            'a50573dedc3a458725a8ec82cf5daa880584e1112ff0354e944d3fda8e162bbe'
            'a40a2e07498cc9793d396009d2601e65d2fea1fd9dafce49c8df36017a1d600a'
            '960af263b4b527ca4f33d709fba338ec2363daf21aac69bc9df309b48c925dfd'
            '318168bb78ac0cf38e5391e56870996597e800ed6615a5f4c296d6fae216d146'
            '0732e0871ebe9c4e16ad4a684436dd64e2c89e06f97170f3b811461c5f0345b2'
            '17d726cd91ee53a0b721c7a046428e2f5a316b9ae7503f4d0b3d60acb2ad5712'
            'c63209370af4fad35e04d6e8b5a64c0e3bec31ccbdd68e59e085664f30d9c44a'
)
PKGEXT='.pkg.tar'
DLAGENTS=('local::/bin/true')

build() {
  wrestool -x -n 149 curse.exe > comi.ico
  convert comi.ico comi.png

  tail -n +220 readme.txt > LICENSE
}

package() {
  cd $srcdir

  install -d $pkgdir/usr/share/games/comi/
  install -m644 comi.la{0,1,2} $pkgdir/usr/share/games/comi/

  install -d $pkgdir/usr/share/games/comi/resource/
  install -m644 {*.bun,*.nut,*.san,language.tab} $pkgdir/usr/share/games/comi/resource/

  install -Dm644 comi.png $pkgdir/usr/share/icons/hicolor/48x48/apps/comi.png

  install -Dm644 LICENSE $pkgdir/usr/share/licenses/comi-en/LICENSE

  install -Dm644 comi-en.desktop $pkgdir/usr/share/applications/comi-en.desktop 
}
