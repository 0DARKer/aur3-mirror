# Contributor: Michael Thomas <bizthepirate@gmail.com>
pkgname=boxee
pkgver=0.9.3921
pkgrel=1
pkgdesc="Boxee is an open and connected social media center for Mac OS X and Linux."
arch=( i686 x86_64)
url="http://www.boxee.tv/"
license=( 'GPL' )
groups=()
depends=('alsa-lib' 'freetype2' 'glew' 'hal' 'jasper' 'libcdio' 'sdl_image' 'sdl_mixer' 'sdl_gfx' 'sdl_sound' 'fribidi' 'libgl' 'libmad' 'libmysqlclient' 'libxinerama' 'lzo2' 'mesa' 'unrar' 'smbclient' 'sqlite3' 'streamripper' 'freetype2' 'libogg' 'python-pysqlite' 'curl' 'gawk' 'libxrandr' 'libxrender' 'pmount' 'libmad' 'libvorbis' 'libmysqlclient' 'streamripper' 'pcre' 'dbus' 'hal' 'fontconfig' 'bzip2' 'boost' 'libtool' 'faac' 'enca' 'libxt' 'libxmu' 'gperf' 'unzip' 'libpng' 'libjpeg' 'python24' )
makedepends=( 'autoconf' 'boost' 'pkgconfig' 'gcc' 'make' 'ccache' 'automake' 'cmake' 'nasm')
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
source=( $pkgname-source-$pkgver.tar.gz )
noextract=()
md5sums=( 'b8a7e8419ee53816a0a449b70cf7a025' )
_src=${srcdir}/$pkgname-source-$pkgver
build() {
        cd ${_src}
        #Generating ./configure
        autoconf
	./configure --prefix=/opt/boxee --disable-debug || return 1
        make || return 1

mkdir -p ${pkgdir}/
mkdir -p ${pkgdir}/usr/share/applications
mkdir -p ${pkgdir}/usr/share/pixmaps

# language
mkdir -p ${pkgdir}/opt/boxee/language/
cp -r ${_src}/language/* ${pkgdir}/opt/boxee/language/

# media
mkdir ${pkgdir}/opt/boxee/media
cp ${_src}/media/defaultrss.png  ${_src}/media/downloadrss.png  ${_src}/media/test_sound.mp3  ${_src}/media/weather.rar ${pkgdir}/opt/boxee/media
chmod 644 ${pkgdir}/opt/boxee/media/*
mkdir ${pkgdir}/opt/boxee/media/Fonts
cp ${_src}/media/Fonts/boxee* ${pkgdir}/opt/boxee/media/Fonts
chmod 644 ${pkgdir}/opt/boxee/media/Fonts/*

# screensavers
mkdir ${pkgdir}/opt/boxee/screensavers
cp ${_src}/screensavers/Plasma.xbs  ${_src}/screensavers/Solarwinds.xbs ${_src}/screensavers/Euphoria.xbs ${pkgdir}/opt/boxee/screensavers

# scripts
mkdir ${pkgdir}/opt/boxee/scripts
# Lyrics
cp -r ${_src}/scripts/Lyrics ${pkgdir}/opt/boxee/scripts
cp -r ${_src}/scripts/RTorrent ${pkgdir}/opt/boxee/scripts
cp -r ${_src}/scripts/Apple\ Movie\ Trailers ${pkgdir}/opt/boxee/scripts
cp -r ${_src}/scripts/OpenSubtitles ${pkgdir}/opt/boxee/scripts

# plugins
mkdir ${pkgdir}/opt/boxee/plugins
mkdir ${pkgdir}/opt/boxee/plugins/music
mkdir ${pkgdir}/opt/boxee/plugins/pictures
cp -r ${_src}/plugins/pictures/flickr ${pkgdir}/opt/boxee/plugins/pictures
cp -r ${_src}/plugins/pictures/PicasaWeb ${pkgdir}/opt/boxee/plugins/pictures
mkdir ${pkgdir}/opt/boxee/plugins/video
cp -r ${_src}/plugins/video/Youtube ${pkgdir}/opt/boxee/plugins/video
cp -r "${_src}/plugins/video/CNN Video" ${pkgdir}/opt/boxee/plugins/video
cp -r "${_src}/plugins/video/Movie Trailers" ${pkgdir}/opt/boxee/plugins/video

# skin
mkdir -p ${pkgdir}/opt/boxee/skin/Boxee\ Skin\ NG
cp -r ${_src}/skin/Boxee\ Skin\ NG/* ${pkgdir}/opt/boxee/skin/Boxee\ Skin\ NG

# system
mkdir ${pkgdir}/opt/boxee/system
cp ${_src}/system/*-i486-linux.so  ${_src}/system/asound.conf ${pkgdir}/opt/boxee/system
mkdir ${pkgdir}/opt/boxee/system/players
mkdir ${pkgdir}/opt/boxee/system/players/dvdplayer
cp ${_src}/system/players/dvdplayer/*-i486-linux.so ${pkgdir}/opt/boxee/system/players/dvdplayer
mkdir ${pkgdir}/opt/boxee/system/players/paplayer
cp ${_src}/system/players/paplayer/*-i486-linux.so ${pkgdir}/opt/boxee/system/players/paplayer
mkdir ${pkgdir}/opt/boxee/system/players/flashplayer
cp ${_src}/system/players/flashplayer/*linux* ${_src}/system/players/flashplayer/bxoverride.so ${pkgdir}/opt/boxee/system/players/flashplayer
chmod 755 ${pkgdir}/opt/boxee/system/players/flashplayer/*
mkdir ${pkgdir}/opt/boxee/system/python
cp ${_src}/system/python/*-i486-linux.so ${pkgdir}/opt/boxee/system/python
mkdir ${pkgdir}/opt/boxee/system/python/lib
cp ${_src}/xbmc/lib/libPython/Python/build/lib.linux-i686-2.4/*.so ${pkgdir}/opt/boxee/system/python/lib
cd ${_src}/xbmc/lib/libPython/Python/Lib
../python -O >/dev/null << EOF
import compileall
compileall.compile_dir(".", force=1)
EOF

/bin/rm -rf test
tar cf - `find . -name \*.pyo` | (cd $curr_dir; cd ${pkgdir}/opt/boxee/system/python/lib; tar xf -)
cd $curr_dir
mkdir ${pkgdir}/opt/boxee/system/scrapers
cp -r ${_src}/system/scrapers/* ${pkgdir}/opt/boxee/system/scrapers
mkdir ${pkgdir}/opt/boxee/system/cdrip
cp ${_src}/system/cdrip/*-i486-linux.so  ${pkgdir}/opt/boxee/system/cdrip

# userdata
mkdir -p ${pkgdir}/opt/boxee/UserData
cp ${_src}/system/Keymap.xml ${_src}/system/Lircmap.xml ${pkgdir}/opt/boxee/system
chmod 644 ${pkgdir}/opt/boxee/system/*.xml
cp ${_src}/UserData/sources.xml.in.linux ${pkgdir}/opt/boxee/UserData
cp ${_src}/UserData/sources.xml.in.diff.linux ${pkgdir}/opt/boxee/UserData
chmod 644 ${pkgdir}/opt/boxee/UserData/*
ln -s UserData ${pkgdir}/opt/boxee/userdata

# visualizations
mkdir ${pkgdir}/opt/boxee/visualisations
cp ${_src}/visualisations/opengl_spectrum.vis  ${_src}/visualisations/ProjectM.vis  ${_src}/visualisations/Waveform.vis ${pkgdir}/opt/boxee/visualisations
cp -r ${_src}/visualisations/projectM  ${_src}/visualisations/projectM.presets ${pkgdir}/opt/boxee/visualisations

# rtorrent
mkdir -p ${pkgdir}/opt/boxee/bin
cp ${_src}/bin-linux/boxee-rtorrent ${pkgdir}/opt/boxee/bin
cp ${_src}/system/rtorrent.rc.linux ${pkgdir}/opt/boxee/system

# binary
cp ${_src}/Boxee ${pkgdir}/opt/boxee/
strip ${pkgdir}/opt/boxee/Boxee
cp ${_src}/run-boxee-desktop.in ${pkgdir}/opt/boxee/run-boxee-desktop

# give_me_my_mouse_back
cp ${_src}/give_me_my_mouse_back ${pkgdir}/opt/boxee/
strip ${pkgdir}/opt/boxee/give_me_my_mouse_back

# desktop stuff
cp ${_src}/debian/boxee.desktop ${pkgdir}/usr/share/applications
cp ${_src}/debian/boxee.png ${pkgdir}/usr/share/pixmaps

}