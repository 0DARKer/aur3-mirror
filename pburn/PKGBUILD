# Maintainer: hauzer <alokinpwn@gmail.com>
pkgname=pburn
pkgver=3.3.4
pkgrel=4
pkgdesc="CD/DVD recording program used in Puppy Linux."
arch=('any')
url="http://murga-linux.com/puppy/viewtopic.php?t=23881"
license=('GPL')
depends=('cddetect' 'dvd+rw-tools' 'gtkdialog' 'usleep')
makedepends=('pet2tgz')
optdepends=('dvdauthor: for burning video-DVD'
            'ffmpeg: for converting audio/video'
            'normalize: for volume settings on Audio-CD'
            'pfilesearch: for file search'
            'vamps: for shrinking video-DVD'
            'vcdimager: for burning Video-CD'
            'vobcopy: for copying video-DVD')
source=("${pkgname}-${pkgver}.pet")
md5sums=('6a8ab076fa4c90a69b0819f7d067dac2')

build() {
  pet2tgz -i "${srcdir}/${pkgname}-${pkgver}.pet" -o "${srcdir}/${pkgname}-${pkgver}.tar.gz"
  tar -xzf "${srcdir}/${pkgname}-${pkgver}.tar.gz"
}

package() {
  cat > ${pkgname} <<EOF
#!/bin/bash
if [[ ! -f $HOME/.pfilesearch/pfilesearchrc ]] ; then
  if [[ ! -d $HOME/.pfilesearch ]] ; then
    mkdir $HOME/.pfilesearch
  fi
  touch $HOME/.pfilesearch/pfilesearchrc
fi

"/usr/share/${pkgname}/${pkgname}" "\$@"
EOF

  cat > ${pkgname}.desktop <<EOF
[Desktop Entry]
Encoding=UTF-8
Name=Pburn CD/DVD/Blu-ray writer
Name[de]=Pburn CD/DVD/Blu-ray Brenner
Name[es]=Pburn-Grabador de CD/DVD/Blu-ray
Name[fr]=Graveur CD/DVD/Blu-ray
Name[hu_HU]=Pburn CD/DVD/Blu-ray író
Name[ja]=Pburn CD/DVD/Blu-ray書き込み
Icon=/usr/share/${pkgname}/pburn20.png
Comment=Pburn CD/DVD/Blu-ray writer
Exec=${pkgname}
Terminal=false
Type=Application
Categories=Multimedia;Utility;
GenericName=Pburn CD/DVD/Blu-ray writer
EOF

  install -D -m755 ${pkgname} "${pkgdir}/usr/bin/${pkgname}"
  install -D -m644 ${pkgname}.desktop "${pkgdir}/usr/share/applications/${pkgname}.desktop"

  mkdir -p "${pkgdir}/usr/share"
  cp -r "${srcdir}/${pkgname}-${pkgver}/usr/local/${pkgname}" "${pkgdir}/usr/share/"
  cp -r "${srcdir}/${pkgname}-${pkgver}/usr/share/doc" "${pkgdir}/usr/share"
}
