# Maintainer: Isaac C. Aronson <isaac at pingas dot org>

pkgname=minecraft-canary
pkgver=1.1.0.b4.4.10
pkgrel=2
epoch=
pkgdesc="CanaryMod Minecraft server systemd service"
arch=(any)
url="http://www.canarymod.net/"
license=('custom')
makedepends=('unzip')
depends=('java-runtime' 'systemd' 'screen' 'expect')
conflicts=('minecraft-server' 'minecraft-server-systemd')
options=(emptydirs)
install=minecraft-canary.install
source=(crow-b4.4.10.zip::http://dl.canarymod.net/crow/get.php?v=latest
        minecraftd
        minecraftd.service)
noextract=('crow-b4.4.10.zip')
md5sums=('6b9f9aea6ae77a54a8f8c89d4bfe8c73'
         '4e215a0e13fa4745d229950f1f7eeb7b'
         '0e0176eeb7266b2ccf6c717a0361ab6c')

package() {
  install -Dm755 "$srcdir/minecraftd" "$pkgdir/usr/bin/minecraftd"
  install -Dm644 "$srcdir/minecraftd.service" "$pkgdir/lib/systemd/system/minecraftd.service"

  install -d "$pkgdir/srv/minecraft"
  unzip -q crow-b4.4.10.zip -d $pkgdir/srv/minecraft
  # the current version.txt is invalid; removing it is a temporary workaround to get the server to start
  #rm $pkgdir/srv/minecraft/server* $pkgdir/srv/minecraft/version.txt
}
