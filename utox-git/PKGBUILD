# Maintainer: Madotsuki <madotsuki@cock.li>

pkgname=utox-git
pkgver=0.r123.g77151a5
pkgrel=1
pkgdesc="Lightweight Tox client"
arch=('i686' 'x86_64')
url="https://github.com/notsecure/uTox"
license=('GPLv3')
depends=('tox-git' 'freetype2' 'libpng' 'harfbuzz' 'openal')
makedepends=('gcc' 'make' 'git')
provides=('utox-git')
conflicts=('utox-git')
source=('git://github.com/notsecure/uTox.git')
sha256sums=('SKIP')

pkgver()
{
	cd uTox
	
	if GITTAG="$(git describe --abbrev=0 --tags 2>/dev/null)"; then
		echo "$(sed -e "s/^${pkgname%%-git}//" -e 's/^[-_/a-zA-Z]\+//' -e 's/[-_+]/./g' <<< ${GITTAG}).r$(git rev-list --count ${GITTAG}..).g$(git log -1 --format="%h")"
	else
		echo "0.r$(git rev-list --count master).g$(git log -1 --format="%h")"
	fi
}

build()
{
	cd uTox
	make
}

package()
{
	cd uTox
	mkdir -p $pkgdir/bin
	cp uTox $pkgdir/bin
}
