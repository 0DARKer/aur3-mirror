# Maintainer: Martinsh Shaiters <martinsh.shaiters@gmail.com>

pkgname=rust-sfml-git
pkgver=20130629
pkgrel=1
pkgdesc='Rust binding for SFML, the Simple and Fast Multimedia Library.'
arch=('i686' 'x86_64')
url='https://github.com/JeremyLetang/rust-sfml'
license=('ZLIB')
depends=('sfml>=2.0' 'csfml>=2.0')
makedepends=('git' 'rust-git')
source=('finalize_to_drop.patch')
sha1sums=('48e10e26d049f45a1e7284881f1f4de21b26f6e8')

_gitroot='https://github.com/JeremyLetang/rust-sfml.git'
_gitname='rust-sfml'


prepare() {
  cd "$srcdir"
  msg "Fetching source from Git..."

  if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "Local repository is now up-to-date."
  else
    git clone $_gitroot

    # TODO: remove this when upstream is patched
    msg "Patching source..."
    cd "$_gitname"
    git checkout 'master'
    git am < "$startdir/finalize_to_drop.patch"
  fi
  
}


build() {

  rm -rf "$srcdir/$_gitname/build/"
  mkdir "$srcdir/$_gitname/build/"
  cd "$srcdir/$_gitname/build/"

  rust build --out-dir ./ $srcdir/$_gitname/src/rsfml.rc
}

package() {
  cd "$srcdir/$_gitname/build/"

  install -d "$pkgdir/usr/lib/rust/"
  install -m644 `ls | grep 'lib.*\.so'` "$pkgdir/usr/lib/rust/"
  install -Dm644 "$srcdir/$_gitname/LICENSE.txt" "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
