# Contributor: Alexander 'z33ky' Hirsch <1zeeky@gmail.com>

pkgname=btogre-git
pkgver=20130221
pkgrel=1
pkgdesc="A thin Bullet-Ogre connection."
arch=('i686' 'x86_64')
url="http://www.ogre3d.org/forums/viewtopic.php?f=5&t=46856"
license=('zlib')
depends=('bullet' 'ogre')
makedepends=('git')

_gitroot="git://github.com/nikki93/btogre.git"
_gitname="btogre"

build() {
  cd ${srcdir}

  msg "Connecting to GIT server..."
  if [[ -d ${_gitname} ]]; then
    (cd ${_gitname} && git pull origin)
  else
    git clone ${_gitroot} ${_gitname}
  fi
  msg "GIT checkout done or server timeout"
  msg "Starting make..."

  rm -rf ${_gitname}-build
  git clone --depth 1 file://${srcdir}/${_gitname} ${_gitname}-build

  cd ${srcdir}/${_gitname}-build
  #append INSTALL info
  #https://github.com/nils/btogre/commit/45439c8c143a2db8712609e3bcdd441aa826ef25
  echo '
INSTALL(TARGETS BtOgre
  RUNTIME DESTINATION bin
  LIBRARY DESTINATION lib
  ARCHIVE DESTINATION lib)' >> CMakeLists.txt

  cmake -DCMAKE_INSTALL_PREFIX:PATH=/usr
  make
}

package() {
  cd ${srcdir}/${_gitname}-build

  make DESTDIR=${pkgdir} install
}
