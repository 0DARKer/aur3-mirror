# Contributor: Alexander Jakopin <setrodox@users.sourceforge.net>
# Maintainer: Matěj Týč <bubla@users.sourceforge.net>

pkgname=mingw32-allegro
pkgver=4.4.0.1
pkgrel=2
license=('zlib')
arch=('any')
options=('!strip')
depends=('mingw32-gcc')
makedepends=('cmake' 'mingw32-dx7-headers')
pkgdesc="Allegro is a multi-platform game library (MinGW32 version)"
source=('http://downloads.sourceforge.net/project/alleg/allegro/4.4.0.1/allegro-4.4.0.1.tar.gz' 
	'arch_mingw.patch')
url=("http://alleg.sourceforge.net/")
md5sums=('07a06e34a267363970aad4b465365675' 
	'728b0965986d6b482f715998255ff2ca')
build() {
	cd $srcdir/allegro-$pkgver
	patch -p0 < $startdir/src/arch_mingw.patch
	export MINGDIR=/usr/i486-mingw32
	mkdir package
	cd package
	cmake -DCMAKE_TOOLCHAIN_FILE=../cmake/Toolchain-mingw.cmake .. && make || return 1
	make install DESTDIR=$pkgdir || return 1
	# correct a 'make install' glitch
	cp lib/alleg44.dll $pkgdir/$MINGDIR/bin
	chmod 644 $pkgdir/$MINGDIR/bin/alleg44.dll
}

