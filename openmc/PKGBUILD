# Maintainer: Adam Nelson <nelsonag at umich dot edu>
pkgname=openmc
pkgver=0.5.1
pkgrel=2
pkgdesc="A Monte Carlo particle transport code specializing in nuclear reactor analysis."
arch=('i686' 'x86_64')
url="https://github.com/mit-crpg/openmc"
license=('MIT')
depends=('python2>=2.7')
makedepends=('gcc-fortran>=4.6')
provides=('openmc')
options=(!strip)
source=("https://github.com/mit-crpg/openmc/archive/v0.5.1.tar.gz"
         Makefile.patch
         convert_xsdata.patch
         convert_xsdir.patch
         statepoint_cmp.patch
         statepoint_histogram.patch
         statepoint_meshplot.patch
         statepoint.patch)
md5sums=('1ea6a4abed94e4c03a7cfe83f5891ad3'
         '9dd690d64d25fe23d1af919061099a74'
         'ceabee0427648c12a5c2be07d455dfac'
         '6c3100c5740dcc0cb37d411ab19e4410'
         '2987f2b679ac2488cf70fc91eb7bd422'
         '578e90e79674a3af210a43b4216b92cb'
         'ef95d08b921595811cdf9522d8828e1d'
         '98e22e4862891c6f786be39fc3086214')

build() {
	pwd
  cp Makefile.patch ${srcdir}/${pkgname}-${pkgver}/src/
  cp convert_xsdata.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cp convert_xsdir.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cp statepoint_cmp.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cp statepoint_histogram.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cp statepoint_meshplot.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cp statepoint.patch ${srcdir}/${pkgname}-${pkgver}/src/utils/
  cd ${srcdir}/${pkgname}-${pkgver}/src/
  patch -p0 < Makefile.patch
	make GNU=yes OPTIMIZE=yes -j1
  cd utils
  patch -p0 < convert_xsdata.patch
  patch -p0 < convert_xsdir.patch
  patch -p0 < statepoint_cmp.patch
  patch -p0 < statepoint_histogram.patch
  patch -p0 < statepoint_meshplot.patch
  patch -p0 < statepoint.patch
}

package() {
  cd ${srcdir}/${pkgname}-${pkgver}/src/
  make DESTDIR="${pkgdir}" prefix="/usr" install
}
