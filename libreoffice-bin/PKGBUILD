# Contributor: Vitaliy Berdinskikh ur6lad[at]i.ua

_mainver=3.3.0
_timestamp=20101115
pkgname=libreoffice-bin
pkgver=3.3.0_beta3
pkgrel=1
pkgdesc="A productivity suite that is compatible with other major office suites"
arch=('i686' 'x86_64')
url="http://www.documentfoundation.org/download/"
license=('LGPL3')
depends=('glibc' 'gtk2' 'at-spi')
makedepends=('rpmextract')
provides=('libreoffice-base')
conflicts=('libreoffice-base' 'libreoffice' 'openoffice-base' 'libreoffice-base-bin')

[ $CARCH = "i686" ] && _arch=x86
[ $CARCH = "x86_64" ] && _arch=x86-64

source=(http://download.documentfoundation.org/libreoffice/testing/${pkgver/_/-}/rpm/${_arch/-/_}/LibO_${_mainver}_Linux_${_arch}_install-rpm_en-US.tar.gz)

build() {
	cd ${srcdir}

	for i in $(ls LibO_${pkgver/_/}_${_timestamp}_Linux_${_arch}_install-rpm_en-US/RPMS/*.rpm); do
		rpmextract.sh $i
	done
	rpmextract.sh LibO_${pkgver/_/}_${_timestamp}_Linux_${_arch}_install-rpm_en-US/RPMS/desktop-integration/*freedesktop-menus*.rpm;
}

package() {
	mkdir -p ${pkgdir}/usr/lib/mozilla/plugins/
	mkdir -p ${pkgdir}/usr/share/licenses/${pkgname}
	
	cd ${srcdir}
	
	cp opt ${pkgdir} -r
	cp usr ${pkgdir} -r
	
	cd ${pkgdir}/usr/bin
	ln -s /opt/libreoffice3/program/soffice soffice
	ln -s /opt/libreoffice3/program/spadmin spadmin
	
	cd ${pkgdir}/usr/lib/mozilla/plugins/
	ln -s /opt/libreoffice3/program/libnpsoplugin.so .
	
	ln -s /opt/libreoffice3/THIRDPARTYLICENSEREADME.html ${pkgdir}/usr/share/licenses/${pkgname}/THIRDPARTY.html
}

if [ $CARCH = "i686" ]; then
md5sums=('712d2ec29a6c6f89511d82a40dbf9d4c')
sha256sums=('5a5841f1d6cfaa124dd4f8aa59e1a8d136d735480c66954a0bc0cc7fa426f374')
fi

if [ $CARCH = "x86_64" ]; then
md5sums=('f0abb53d6a85343b0c0b23ba9db27753')
sha256sums=('f11b8d9fea9c5abe6f7385a2378228021c5ec1deb8120b80d40d24ad3737d0c1')
fi
