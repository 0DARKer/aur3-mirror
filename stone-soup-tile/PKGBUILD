# Contributor: KillaB <xGenoBlast@gmail.com>
# Contributor: Nathan Jones <nathanj@insightbb.com>
# Contributor: Forgeot Eric <http://ifiction.free.fr>
# Contributor: Mael Clerambault <mael@clerambault.fr>

pkgname=stone-soup-tile
pkgver=0.7.1
pkgrel=2
pkgrubbish=-1-g7ce9b19
pkgdesc="Community maintained variant of Linley's Dungeon Crawl (tile & ncurses version)"
arch=('i686' 'x86_64' 'ppc')
url="http://crawl.develz.org"
depends=(lua libpng libx11 ncurses sdl_image)
makedepends=(gcc bison flex)
license=('custom')
conflicts=('stone-soup')
source=(http://downloads.sourceforge.net/sourceforge/crawl-ref/stone_soup-$pkgver-nodeps.tar.bz2 stone-soup-tile.desktop)

md5sums=('e5fa03fc9206ede190f288bf0b24500b'
         'c1104107beaad57531e825a7d26c7914')


build() {
  cd $srcdir/stone_soup-$pkgver$pkgrubbish/source
  cp -r $srcdir/stone_soup-$pkgver$pkgrubbish/source $srcdir/stone_soup-$pkgver$pkgrubbish/source-tiles

  cd $srcdir/stone_soup-$pkgver$pkgrubbish/source-tiles
  make TILES=y DATADIR=/usr/share/$pkgname SAVEDIR='~/.stone-soup' || return 1

  cd $srcdir/stone_soup-$pkgver$pkgrubbish/source
  make DATADIR=/usr/share/$pkgname SAVEDIR='~/.stone-soup' || return 1

  mkdir -p $pkgdir/usr/bin/
  mkdir -p $pkgdir/usr/share/$pkgname/
  cp $srcdir/stone_soup-$pkgver$pkgrubbish/source-tiles/crawl $pkgdir/usr/bin/stone-soup-tiles
  cp $srcdir/stone_soup-$pkgver$pkgrubbish/source/crawl $pkgdir/usr/bin/stone-soup
  cp -r $srcdir/stone_soup-$pkgver$pkgrubbish/{docs,settings} $pkgdir/usr/share/$pkgname/
  cp -r $srcdir/stone_soup-$pkgver$pkgrubbish/source-tiles/dat $pkgdir/usr/share/$pkgname/

  mkdir -p $pkgdir/usr/share/pixmaps
  mkdir -p $pkgdir/usr/share/applications
  mkdir -p $pkgdir/usr/share/licenses/$pkgname/

  cp $srcdir/stone_soup-$pkgver$pkgrubbish/licence.txt $pkgdir/usr/share/licenses/$pkgname/
  cp $srcdir/stone_soup-$pkgver$pkgrubbish/source/dat/tiles/stone_soup_icon-32x32.png $pkgdir/usr/share/pixmaps/$pkgname.png  
  cp $srcdir/$pkgname.desktop $pkgdir/usr/share/applications/
}


