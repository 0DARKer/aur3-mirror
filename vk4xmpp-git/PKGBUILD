# Maintainer: Andrey Makarov <xdersd@gmail.com>

_gitname='vk4xmpp'
pkgname="$_gitname-git"
pkgver=d50dd52
pkgrel=1
pkgdesc="XMPP vk.com transport service"
arch=('any')
url="https://github.com/mrDoctorWho/vk4xmpp"
license=('MIT')
depends=('python2')
makedepends=('git')
source=('git://github.com/mrDoctorWho/vk4xmpp.git')
md5sums=('SKIP')

pkgver() {
	cd "$srcdir/$_gitname"
	#echo `git rev-list HEAD --count && git rev-parse --short HEAD` | tr " " .
	git describe --always | sed 's/^v//;s/-/./g'
}

build() {
	cd "$srcdir/$_gitname"
}

package() {
	cd "$srcdir/$_gitname"

	install -d "$pkgdir/usr/share/$_gitname"
	cp -R * "$pkgdir/usr/share/$_gitname"
	install -Dm644 "Config_example.txt" "$pkgdir/etc/vk4xmpp_example.conf"
	install -Dm644 "systemd/vk4xmpp.service" "$pkgdir/usr/lib/systemd/system/vk4xmpp.service"
	install -Dm644 --owner=nobody /dev/null "$pkgdir/var/run/vk4xmpp.pid"
	install -Dm644 --owner=nobody /dev/null "$pkgdir/var/log/vk4xmpp.log"
}

post_install() {
	if [ -e /var/run/vk4xmpp.pid ] ; then
		chown nobody: /var/run/vk4xmpp.pid
	fi
	if [ -e /var/log/vk4xmpp.log ] ; then
		chown nobody: /var/log/vk4xmpp.log
	fi
}

