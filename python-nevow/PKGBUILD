# Contributor: Marco Elver <el.marcoe+arch at gmail dot com>

pkgname=python-nevow
pkgver=0.10.0
pkgrel=1
arch=(any)
license=('custom')
pkgdesc="Web application construction kit and templating engine written in python."
url="http://divmod.org/trac/wiki/DivmodNevow"
depends=('python')
optdepends=('twisted: to use all the advanced features of nevow, such as LivePage')
makedepends=('twisted')
source=(Nevow-$pkgver.tar.gz::http://divmod.org/trac/attachment/wiki/SoftwareReleases/Nevow-$pkgver.tar.gz?format=raw)
options=(!emptydirs)

build() {
  cd $startdir/src/Nevow-$pkgver
  python setup.py install --prefix=/usr --root=$startdir/pkg/ || return 1

  # is there a way to fix the doc path with the setup.py script ?
  mkdir -p $startdir/pkg/usr/share/doc/nevow
  mv $startdir/pkg/usr/doc/man $startdir/pkg/usr/share/
  mv $startdir/pkg/usr/doc/* $startdir/pkg/usr/share/doc/nevow/
  rm -r $startdir/pkg/usr/doc
  
  # same as above - in v0.9.33 nevow_widget.py was in the right place. can anybody explain why this has changed?
  # let's hope this get's fixed in their next setup.py
  _python_version=`python --version |& cut -d " " -f 2 | cut -d "." -f 1,2`
  _python_twisted_plugins="$startdir/pkg/usr/lib/python${_python_version}/site-packages/twisted/plugins/"
  mkdir -p $_python_twisted_plugins
  mv $startdir/pkg/usr/twisted/plugins/nevow_widget.py $_python_twisted_plugins
  rm -r $startdir/pkg/usr/twisted

  install -D -m644 LICENSE $startdir/pkg/usr/share/licenses/$pkgname/LICENSE
}

md5sums=('66dda2ad88f42dea05911add15f4d1b2')
