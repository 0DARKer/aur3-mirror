# Maintainer: rfk1ll <rfk1ll@rfk1ll.org>
# Contributor: dcell <josh@manjaroartwork.com>

pkgname=manarchy
pkgver=2013.07
pkgrel=2
pkgdesc="Collection of pentesting programs."
url="http://rfk1ll.org"
license=('GPL')
depends=('net-tools' 'sox' 'make' 'gcc' 'macchanger' 'nmap' 'wireshark-gtk' 'wxpython' 'iw' 'kismet' 'ettercap')
replaces=('aircrack-ng')
conflicts=('aircrack-ng')
arch=('any')
source=("http://rfk1ll.org/manarchy/$pkgver-$pkgrel/manarchy"
        "http://rfk1ll.org/manarchy/$pkgver-$pkgrel/aircrack-ng-1.2-beta1.tar.gz"
        "http://rfk1ll.org/manarchy/$pkgver-$pkgrel/theHarvester-2.2a.tar.gz"
        "http://rfk1ll.org/manarchy/$pkgver-$pkgrel/ws110.tar.gz")
optdepends=('flite: a lightweight speech synthesis substitute'
            'hashcat: A multithreaded cross platform hash cracker.'
            'oclhashcat-plus-bin: Worlds fastest WPA cracker with dictionary mutation engine')
sha512sums=('63a597be2f743217145035b5b27973160f137604a7771d04e183d141244946b2ed413c25e0f1948ddbf854a592b70756fceccc9f8d833d7593d869745c5bda62'
            'e436443251d4c7895c6c2a71abde382222b2e4fc0856271dfb9825eb4b00383523dfcc0d8c1e8e807a5420cecf9f512adf8564e02cee70f03bd33db3568f5afe'
            '6d4892e92aadac0fe3ed6c0bdadc4b288f13fc5e99320299077d0a9b9766660a20785f4a579508d3f25a807832a296342e4c19085800a94a01b6f24bca1fb369'
            '0fa351038260f97ad33fccf8520a1fda4d2172d06974458f4b94a37740b850e5361b78b0b555b19fd58fb6ab24296f39274b133414b3af0d21e57b427d4c7ec6')
package() {
    #creates neccesary directories
    mkdir -p $pkgdir/usr/share/theharvester
    mkdir -p $pkgdir/usr/share/webshag
    mkdir -p $pkgdir/usr/bin

    #installs the manarchy file
    cp manarchy $pkgdir/usr/bin/manarchy
    chmod +x $pkgdir/usr/bin/manarchy
    
    #installs aircrack
    cd $srcdir/aircrack-ng-1.2-beta1
    make -C $srcdir/aircrack-ng-1.2-beta1
    make -C $srcdir/aircrack-ng-1.2-beta1 strip
    make -C $srcdir/aircrack-ng-1.2-beta1 DESTDIR="${pkgdir}" prefix=/usr install
    
    #installs webshag
    cd $srcdir/webshag
    chmod +x $srcdir/webshag/setup.linux.py
    cp -rf $srcdir/webshag/* $pkgdir/usr/share/webshag
    ln -s /usr/share/webshag/webshag_gui.py "$pkgdir/usr/bin/webshag_gui"
    ln -s /usr/share/webshag/webshag_cli.py "$pkgdir/usr/bin/webshag_cli"
    ln -s /usr/share/webshag/setup.linux.py "$pkgdir/usr/bin/webshag_setup"
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/webshag_gui.py
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/webshag_cli.py
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/setup.linux.py

    #installs theharvester
    cd ${srcdir}/theHarvester-2.2a
    cp -rf $srcdir/theHarvester-2.2a/* $pkgdir/usr/share/theharvester
    ln -s /usr/share/theharvester/theHarvester.py "$pkgdir/usr/bin/theharvester"
    chmod +x $pkgdir/usr/share/theharvester/theHarvester.py
    sed -i '1s/$/2/' $pkgdir/usr/share/theharvester/theHarvester.py
}
