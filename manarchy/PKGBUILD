# Maintainer: rfk1ll <rfk1ll@rfk1ll.org>
# Contributor: dcell <josh@manjaroartwork.com>

pkgname=manarchy
pkgver=2013.07
pkgrel=1
pkgdesc="Collection of pentesting programs for manarchy."
url="http://rfk1ll.org"
license=('GPL')
depends=('net-tools' 'sox' 'make' 'gcc' 'macchanger' 'nmap' 'wireshark-gtk' 'wxpython' 'iw')
replaces=('aircrack-ng' 'kismet')
conflicts=('aircrack-ng' 'kismet')
arch=('any')
source=("http://rfk1ll.org/manarchy/$pkgver/aircrack-ng-1.2-beta1.tar.gz"
        "http://rfk1ll.org/manarchy/$pkgver/kismet-2013-03-R1b.tar.xz"
        "http://rfk1ll.org/manarchy/$pkgver/theHarvester-2.2a.tar.gz"
        "http://rfk1ll.org/manarchy/$pkgver/ws110.tar.gz"
        "http://rfk1ll.org/manarchy/$pkgver/manarchy")
optdepends=('flite: a lightweight speech synthesis substitute')
sha512sums=('e436443251d4c7895c6c2a71abde382222b2e4fc0856271dfb9825eb4b00383523dfcc0d8c1e8e807a5420cecf9f512adf8564e02cee70f03bd33db3568f5afe'
            '37b81dd89ba3c02af12e55ebddf86901dbe58123bf9b6928339803d80d01c2351b5376e829292859ecc89539cebd4e1db6aa0d104142ccb289696405a8b2c783'
            '6d4892e92aadac0fe3ed6c0bdadc4b288f13fc5e99320299077d0a9b9766660a20785f4a579508d3f25a807832a296342e4c19085800a94a01b6f24bca1fb369'
            '0fa351038260f97ad33fccf8520a1fda4d2172d06974458f4b94a37740b850e5361b78b0b555b19fd58fb6ab24296f39274b133414b3af0d21e57b427d4c7ec6'
            'be505b2093a5ebe055bf19a5e826050525d143093ed628bb4a1bfad4364e148362205ed5bafdcac21629b2c8aaa511d9d7df9256394c7fafbc1aad02ffe0a016')
package() {
    #creates neccesary directories
    mkdir -p $pkgdir/usr/share/theharvester
    mkdir -p $pkgdir/usr/share/webshag
    mkdir -p $pkgdir/usr/bin

    #installs the manarchy file
    cp manarchy $pkgdir/usr/bin/manarchy
    chmod +x $pkgdir/usr/bin/manarchy
    
    #installs aircrack
    cd $srcdir/aircrack-ng-1.2-beta1
    make -C $srcdir/aircrack-ng-1.2-beta1
    make -C $srcdir/aircrack-ng-1.2-beta1 strip
    make -C $srcdir/aircrack-ng-1.2-beta1 DESTDIR="${pkgdir}" prefix=/usr install

    #installs kismet
    cd $srcdir/kismet-2013-03-R1b
    bash $srcdir/kismet-2013-03-R1b/configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var
    make dep
    make
    make plugins
    ./configure --prefix=/usr --sysconfdir=/etc
    make
    make DESTDIR="$pkgdir" install
    make plugins-install DESTDIR="$pkgdir"

    #installs webshag
    cd $srcdir/webshag
    chmod +x $srcdir/webshag/setup.linux.py
    cp -rf $srcdir/webshag/* $pkgdir/usr/share/webshag
    ln -s /usr/share/webshag/webshag_gui.py "$pkgdir/usr/bin/webshag_gui"
    ln -s /usr/share/webshag/webshag_cli.py "$pkgdir/usr/bin/webshag_cli"
    ln -s /usr/share/webshag/setup.linux.py "$pkgdir/usr/bin/webshag_setup"
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/webshag_gui.py
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/webshag_cli.py
    sed -i '1s/$/2/' $pkgdir/usr/share/webshag/setup.linux.py

    #installs theharvester
    cd ${srcdir}/theHarvester-2.2a
    cp -rf $srcdir/theHarvester-2.2a/* $pkgdir/usr/share/theharvester
    ln -s /usr/share/theharvester/theHarvester.py "$pkgdir/usr/bin/theharvester"
    chmod +x $pkgdir/usr/share/theharvester/theHarvester.py
    sed -i '1s/$/2/' $pkgdir/usr/share/theharvester/theHarvester.py
}
