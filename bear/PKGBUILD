# Maintainer: Moritz Lipp <mlq@pwmt.org>

pkgname=bear
_pkgname=Bear
pkgver=1.2
pkgrel=2
pkgdesc="tool to generate compilation database for clang tooling"
arch=('i686' 'x86_64')
url="https://github.com/rizsotto/Bear"
license=('GPL3')
makedepends=('git' 'cmake' 'make')
depends=('libconfig>=1.4')
conflicts=('bear')
provides=('bear')
source=(https://github.com/rizsotto/$_pkgname/archive/$pkgver.tar.gz cmake.patch)
md5sums=('0b5420b29e6976bbce176ffb1f713b36'
         'd1417db533f50de85e743ee443c2ad96')

prepare() {
	cd "$srcdir/$_pkgname-$pkgver"
  patch -p1 < $startdir/cmake.patch
}

build() {
	cd "$srcdir/$_pkgname-$pkgver"
  cmake \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCMAKE_INSTALL_SYSCONFDIR=/etc \
    -DDEFAULT_CONFIG_FILE="/etc/bear.conf" \
    .
	make all
}

check() {
	cd "$srcdir/$_pkgname-$pkgver"
  PATH=/usr/bin:$PATH make -k check
}

package() {
	cd "$srcdir/$_pkgname-$pkgver"
	make DESTDIR="$pkgdir/" install
}
