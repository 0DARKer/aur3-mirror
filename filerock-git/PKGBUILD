# Maintainer: Francesco Marella <francesco.marella@anche.no>

pkgname=filerock-git
pkgver=20130114
pkgrel=2
pkgdesc="Client for FileRock Secure Cloud Storage"
arch=(any)
url="http://www.filerock.com"
license=("GPL3")
depends=("python2"
         "python2-pbkdf2"
         "python2-crypto"
         "python2-imaging"
         "python2-apscheduler"
         "python2-setproctitle"
         "wxpython"
         "python2-socksipy-git")
makedepends=("python2-distribute"
             "python2-distutils-extra")

_gitroot='git://github.com/alessio/FileRock-Client.git'
_gitname='FileRock-Client'

build() {
    cd "$srcdir"
    if [ -d "$_gitname" ] ; then
        cd "$_gitname" && git pull origin
    else
        git clone --depth 1 "$_gitroot" "$_gitname"
    fi

    cd "$srcdir/$_gitname"
    python2 setup.py install --root="$pkgdir" --prefix=/usr \
        --install-data=/usr/share/filerock-client/ \
        --install-scripts=/usr/share/filerock-client/

    find ./ -name "*.py" | xargs -n 1 sed -i 's|/usr/bin/python|/usr/bin/env python2|'
    find ${pkgdir} -name "*.py" | xargs -n 1 sed -i 's|\./data/|/usr/share/filerock-client/data/|'

    mkdir -p "$pkgdir"/usr/bin
    cp "$srcdir/$_gitname"/FileRock.py "$pkgdir"/usr/bin/filerock
    mkdir -p "$pkgdir"/usr/share/applications/
    cp "$srcdir/$_gitname"/data/filerock-client.desktop "$pkgdir"/usr/share/applications/
    mkdir -p "$pkgdir"/usr/share/pixmaps/
    cp "$srcdir/$_gitname"/data/icons/FileRock_icon.png "$pkgdir"/usr/share/pixmaps/filerock-client.png

#    rm "$pkgdir"/usr/share/filerock-client/FileRock.py
#    rm "$pkgdir"/usr/share/filerock-client/data/FileRock.pot
#    rm "$pkgdir"/usr/share/filerock-client/data/filerock-client.desktop
#    rm -rf "$pkgdir"/usr/share/filerock-client/data/update_scripts
}
