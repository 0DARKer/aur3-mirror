# Contributor: Tom Billiet (mouse256@ulyssis.org)
# Maintainer: Kevin Cox (youarefunny - kevincox.ca@gmail.com)
pkgname=piklab
pkgver=0.15.12
pkgrel=1
pkgdesc="IDE applications based on Microchip PIC and dsPIC microcontrollers similar to MPLAB"
url="http://piklab.sourceforge.net/"
license=('GPL')
arch=('i686' 'x86_64')
depends=('cmake' 'kdelibs3' 'hicolor-icon-theme' 'readline')
optdepends=('gputils: assembeler'
            'pk2cmd:  Upload via PikKit2 programer'
            'sdcc:    Compile C Code')
install=$pkgname.install
source=(
         "https://sourceforge.net/projects/$pkgname/files/$pkgname/$pkgver/$pkgname-$pkgver.tar.bz2"
         "Piklab.cmake.patch"
       )
md5sums=(
          '7fa372b967e8a38108073bdaa80f1798'
          'cf71047f8c6ce6f4daf7a6ffcf32f82d'
        )

build() {
	cd "${srcdir}/$pkgname-$pkgver"

	patch 'cmake/Piklab.cmake' "${srcdir}/Piklab.cmake.patch"

	export KDEDIRS=${pkgdir}/usr:/opt/kde
	cmake -D 'CMAKE_BUILD_TYPE=Release'                       \
	      -D 'CMAKE_INSTALL_PREFIX=/usr'                      \
	      -D 'QT_INCLUDE_DIR:PATH=/opt/qt/include'            \
	      -D 'QT_MOC_EXECUTABLE:FILEPATH=/opt/qt/bin/moc'     \
	      -D 'QT_UIC_EXECUTABLE:FILEPATH=/opt/qt/bin/uic'     \
	      -D 'QT_QT_LIBRARY:FILEPATH=/opt/qt/lib/libqt-mt'    \
	      .

	make
	make DESTDIR="${pkgdir}" install

	rm -rf ${pkgdir}/usr/share/doc/HTML/en/piklab/common
}
