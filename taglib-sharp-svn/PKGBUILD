# Contributor: scj <slytte@hotmail.com>
pkgname=taglib-sharp-svn
pkgver=86763
pkgrel=1
pkgdesc="C# implementation of taglib"
arch=('i686')
url="http://www.taglib-sharp.com"
license=('LGPL')
groups=()
depends=('mono')
makedepends=()
provides=('taglib-sharp')
conflicts=('taglib-sharp')
replaces=()
backup=()
options=()
install=taglib-sharp-svn.install
source=()
noextract=()
md5sums=()

_svntrunk=svn://anonsvn.mono-project.com/source/trunk/taglib-sharp
_svnmod=taglib-sharp

build() {
    cd "$startdir/src/"
    if [ -e $_svnmod/.svn ]; then
        (cd $_svnmod && svn up -r $pkgver)
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    msg "SVN checkout done or server timeout"
    msg "Starting make..."
    
    cp -r $_svnmod $_svnmod-build
    cd $_svnmod-build

    ./autogen.sh

    export MONO_SHARED_DIR=${startdir}/src/.wabi
    mkdir -p "${MONO_SHARED_DIR}"
    cd "$startdir/src/$_svnmod-build"
    
    if [[ -n "`pacman -Q | grep monodoc`" ]]; then
      ./configure --prefix=/usr
    else
      ./configure --prefix=/usr --disable-docs
    fi
    
    make || return 1
    
    cd $startdir/src/$_svnmod-build/src
    /usr/bin/gacutil -root $startdir/pkg/usr/lib -package taglib-sharp -i taglib-sharp.dll || return 1
    /usr/bin/gacutil -root $startdir/pkg/usr/lib -package taglib-sharp -i policy.2.0.taglib-sharp.dll || return 1
    
    mkdir -p $startdir/pkg/usr/lib/pkgconfig
    /bin/install -c -m 644 $startdir/src/$_svnmod-build/taglib-sharp.pc \
      $startdir/pkg/usr/lib/pkgconfig/taglib-sharp.pc
    
    if [[ -n "`pacman -Q | grep monodoc`" ]]; then
      mkdir -p $startdir/pkg/usr/lib/monodoc/sources
      for doc in {zip,tree,source}; do
          /bin/install -c -m 644 $startdir/src/$_svnmod-build/docs/taglib-sharp-docs.$doc \
             $startdir/pkg/usr/lib/monodoc/sources/taglib-sharp-docs.$doc
      done
    fi

    rm -r $MONO_SHARED_DIR
}
# vim:set ts=2 sw=2 et:

