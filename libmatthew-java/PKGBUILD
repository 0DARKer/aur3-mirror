# Contributor: Vitaliy Berdinskikh ur6lad[at]i.ua

pkgname=libmatthew-java
pkgver=0.7.2
pkgrel=3
pkgdesc="Libraries for Java: unix sockets, CGI, hexdump"
arch=('i686' 'x86_64')
url="http://www.matthew.ath.cx/projects/java"
license=('GPL')
depends=('java-runtime' 'glibc')
makedepends=('java-environment' 'apache-ant')
replaces=('matthew-java')
source=(${url}/${pkgname}-${pkgver}.tar.gz build.xml ant.patch Makefile setClasspath.sh)

build() {
	mkdir -p ${pkgdir}/usr/share/java/${pkgname} ${pkgdir}/usr/lib || return 1

	cd ${srcdir}

	install -m644 setClasspath.sh ${pkgdir}/usr/share/java/${pkgname} || return 1
	mv build.xml Makefile ${pkgname}-${pkgver}
	patch -p1 < ant.patch

	cd ${pkgname}-${pkgver}

	mkdir -p src/main/java
	mv cx src/main/java
	ant jars unix.h cgi.h || return 1
	make CFLAGS="${CFLAGS} -fpic -Wall -Os -pedantic -std=c99 -Werror" || return 1

	for i in dist/*.jar; do
		install -m 644 ${i} ${pkgdir}/usr/share/java/${pkgname} || return 1
	done
	for i in ${pkgdir}/usr/share/java/${pkgname}/*.jar; do
		_tmpfilename=${i##*\/}
		ln -sf ${_tmpfilename} ${pkgdir}/usr/share/java/${pkgname}/${_tmpfilename/-[0-9]\.[0-9]/}
	done
	for i in *.so; do
		install -m 644 ${i} ${pkgdir}/usr/lib || return 1
	done
}
md5sums=('774e0b0b9c021acd1f2280c908865c3c'
         'ae25623c6b6d44e3610847de56a0c785'
         'f54940c7bad5a895097469c7852d9e6b'
         '43a29f5e520ee11dc1986a89abfd00c8'
         '011e3b04cd61b7ab9d9608174c2853d2')
sha256sums=('9f48a00caa8c9731d7056346ba72445ebca508e17715e32e310aee45ef36ed03'
            '3f27d02259bb22fd33c16506186a9653d08305f597ec9ce74c777bfcafd11d2a'
            'bef2b4b358ad1903987c045cd86cd4eaed4ca074fc3442bff56b27deb3acf0b1'
            '2385e10800d579ae5e3469836bb54c16b1b836ca4fa2d678a63212af7b70742d'
            '3af2b33a2d7ae07f22856c21dc7dc385c4b1e6421fd64925c997c4ea3603e48d')
