# Contributor: Peter Vogl <peter.vogl@squeaker-media.net>
# Contributor: Jose Valecillos <valecillosjg (at) gmail (dot) com>
pkgname=avg-free
pkgver=r855_a3656
pkgrel=1
pkgdesc="AVG free anti-virus for private, non-commercial, single home computer use only"
url="http://free.grisoft.com"
makedepends=('rpmextract' 'coreutils')
arch=('i686' 'x86_64')
[ "$CARCH" = "i686" ] && depends=('glibc' 'expat')
[ "$CARCH" = "x86_64" ] && depends=('lib32-glibc' 'lib32-expat')
source=(http://aa-download.avg.com/filedir/inst/avg85flx-${pkgver//_/-}.i386.rpm avgd)
install=avg-free.install
license=('Free for Private Use')
md5sums=('7278ab598b1872ecbdb9d6e2c6b98fae'
         '45d3c64133167fcd4d1f885f90c64ea3')

build() {
  cd $srcdir/
  rpmextract.sh avg85flx-${pkgver//_/-}.i386.rpm
  # The line below is REALLY required
  chmod 755 `ls -AFR $srcdir/ | grep : | tr -d ':'`
  cp -a $srcdir/usr $pkgdir/
  cp -a $srcdir/opt $pkgdir/
  cp -a $srcdir/etc $pkgdir/
  mkdir -p $pkgdir/etc/rc.d
  cp $startdir/avgd $pkgdir/etc/rc.d
  #rm -f $pkgdir/etc/avg.conf
  #cp $startdir/avg.conf $pkgdir/etc/avg.conf

  sed 's/\/var\/lock\/subsys/\/var\/lock/g' $pkgdir/opt/avg/avg8/etc/init.d/avgdinit.conf >> $pkgdir/opt/avg/avg8/etc/init.d/avgdinit.conf

  #Copy licence key for post installation registration

  strings *.rpm | grep FREE | sed -n 's/.*"\(.*\)".*/\1/ip;T;q' >> $pkgdir/opt/avg/avg8/KEY

}
