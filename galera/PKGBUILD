# Maintainer: Nico Suarez <nicodoggie@gmail.com
# Contributor: Nico Suarez <nicodoggie@gmail.com

pkgname=galera
pkgver=23.2.2
pkgrel=2
pkgdesc='Galera WSREP Provider'
arch=('i686' 'x86_64')
license=('GPL')
depends=('boost>=1.41' 'openssl')
makedepends=('check' 'scons' 'patch')
url='http://www.codership.com'
options=('!libtool')
source=(https://launchpad.net/galera/2.x/$pkgver/+download/$pkgname-$pkgver-src.tar.gz
        galera-gcc-4.7.patch
        galera-boost.patch
        )

md5sums=('c0856236f987e58052f7e18d5fd80874'
         '6f341f9ce81f42e2d7d1e67a7f34aeb0'
         '6bf763ec39a8833682a7b6e10c161f5c')

build(){
  cd "$srcdir"
  cd "$pkgname-$pkgver-src"

  patch -p1 -i ../galera-gcc-4.7.patch
  patch -p0 -i ../galera-boost.patch
  rm -r .bzr*
  scons
}

package(){
  mkdir -p "$pkgdir"/usr/lib
  mkdir -p "$pkgdir"/usr/bin
  install -m0644 "$srcdir"/$pkgname-$pkgver-src/libgalera_smm.so "$pkgdir"/usr/lib/libgalera_smm.so
  install -m0644 "$srcdir"/$pkgname-$pkgver-src/garb/garbd "$pkgdir"/usr/bin/garbd
}
