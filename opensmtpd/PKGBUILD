# Submitter: Brad Arrington bradla8 at yahoo.com
# Maintainer: Brad Arrington bradla8 at yahoo.com

pkgname=opensmtpd
pkgver=1.1
pkgrel=2
pkgdesc="Port of OpenBSD's smtpd to Linux"
arch=('i686' 'x86_64')
url="http://www.openbsd.org/"
license="BSD"
depends=(gcc libbsd)
makedepends=(make gcc libbsd openssl)
provides=()
conflicts=()
replaces=()
backup=()
install=opensmtpd.install
source=(http://www.scramblemy.net/opensmtpd/$pkgname-$pkgver.tar.gz
	'opensmtpd.install'
	'smtpd.conf'
	'opensmtpd')

md5sums=('ccc2ec8c25042936eff5d723e24f5f0e'
         'f634561668c8a8c147fa404bf22111fa'
         '674e68a045c235069bc5f75cb2668770'
         '0fb8dfb0e7de501051fa02ba83b68e60')

build() {

  unset LDFLAGS

  cd $startdir/src/$pkgname-$pkgver
  make
}

package() {
  cd $srcdir/$pkgname-$pkgver
  gzip $startdir/src/$pkgname-$pkgver/makemap.8.out
  gzip $startdir/src/$pkgname-$pkgver/newaliases.8.out
  gzip $startdir/src/$pkgname-$pkgver/smtpctl.8.out
  gzip $startdir/src/$pkgname-$pkgver/smtpd.8.out
  gzip $startdir/src/$pkgname-$pkgver/smtpd.conf.5.out

  mkdir -p $pkgdir/usr/sbin
  mkdir -p $pkgdir/etc/mail
  mkdir -p $pkgdir/usr/share/man/man5
  mkdir -p $pkgdir/usr/share/man/man8
  cp makemap $pkgdir/usr/sbin/.
  cp smtpctl $pkgdir/usr/sbin/.
  cp smtpd $pkgdir/usr/sbin/.
  cp makemap.8.out.gz $pkgdir/usr/share/man/man8/makemap.8.gz
  cp newaliases.8.out.gz $pkgdir/usr/share/man/man8/newaliases.8.gz
  cp smtpctl.8.out.gz $pkgdir/usr/share/man/man8/smtpctl.8.gz
  cp smtpd.8.out.gz $pkgdir/usr/share/man/man8/smtpd.8.gz
  cp smtpd.conf.5.out.gz $pkgdir/usr/share/man/man5/smtpd.conf.5.gz

#  cp ../../smtpd.conf $pkgdir/etc/mail/.

  install -D -m755 $srcdir/opensmtpd $pkgdir/etc/rc.d/opensmtpd
  install -D -m644 ../../smtpd.conf $pkgdir/etc/mail/smtpd.conf
}
