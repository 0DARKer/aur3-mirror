# Maintainer: hauzer <alokinpwn@gmail.com>
pkgname=spiral-knights
pkgver=20110518
pkgrel=1
pkgdesc="The Spiral Knights have awoken on an alien world. Their equipment stores have been raided and their starship, The Skylark, will not recover from the crash. They must work together to survive on a journey that will take them to the very core of the world."
arch=('any')
url="http://spiralknights.com/"
license=('custom:Three Rings License')
depends=('java-runtime')
install="${pkgname}.install"
source=("http://download.threerings.net/spiral/client/spiral-install.bin"
           "${pkgname}"
           "${pkgname}.desktop")
md5sums=('e5f3efe7fd9e5479e73bfcda6ec939f9'
         'f00bea2647b87df472bf4fe58fc1ac10'
         'ed235cb306b756fba52e9ae47b5f5c35')

build() {
  chmod +x "${srcdir}/spiral-install.bin"
  mkdir -p "${srcdir}/${pkgname}-${pkgver}-${pkgver}"
  ./spiral-install.bin --noexec --keep --nochown --target "${srcdir}/${pkgname}-${pkgver}"
  rm "${srcdir}/${pkgname}-${pkgver}/finish_install.sh"
}

package() {
  mkdir -p "${pkgdir}/opt"
  cp -R "${srcdir}/${pkgname}-${pkgver}" "${pkgdir}/opt/${pkgname}"
  chgrp games "${pkgdir}/opt/${pkgname}"
  chmod 775 "${pkgdir}/opt/${pkgname}"

  ln -s "${JAVA_HOME}/bin/java" "${pkgdir}/opt/${pkgname}/java"
  install -D -m664 "${srcdir}/${pkgname}-${pkgver}/license.txt" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
  install -D -m755 "${pkgname}" "${pkgdir}/usr/bin/${pkgname}"
  install -D -m644 "${pkgname}.desktop" "${pkgdir}/usr/share/applications/${pkgname}.desktop"
}
