# Maintainer: Michael Gerhaeuser <michael dot gerhaeuser at gmail dot com>

pkgname=ios-webkit-debug-proxy-git
pkgver=1.3.r4.gc58b132
pkgrel=1
pkgdesc="A DevTools proxy (WebKit Remote Debugging) for iOS devices (Safari Remote Web Inspector)"
url="https://github.com/google/ios-webkit-debug-proxy"
arch=('i686' 'x86_64')
license=('BSD')
depends=('usbmuxd-git' 'libusbmuxd-git' 'libplist-git' 'libimobiledevice-git')
makedepends=('git')
provids=('ios-webkit-debug-proxy')
conflicts=('ios-webkit-debug-proxy')

source=("git+https://github.com/google/ios-webkit-debug-proxy.git"
        'ios7.patch')
md5sums=('SKIP' '4868dd71a33660ba6dd54567b26b5045')
_gitname="ios-webkit-debug-proxy"

pkgver() {
    cd ${srcdir}/${_gitname}
    git describe --long | sed -E 's/([^-]*-g)/r\1/;s/-/./g'
}

build() {
    cd ${srcdir}/${_gitname}
    msg "Starting make..."

    patch -p1 -i ${srcdir}/ios7.patch

    ./autogen.sh --prefix=/usr
    ./configure --prefix=/usr
    make || return 1
}

package() {
    cd ${srcdir}/${_gitname}
    make DESTDIR=${pkgdir} install || return 1

    # copy license
    install -D -m644 LICENSE.md "${pkgdir}/usr/share/licenses/${_gitname}/LICENSE.md"

    # move header files to /usr/include/ios-webkit-debug-proxy
    mkdir -p ${pkgdir}/usr/include/${_gitname}
    mv ${pkgdir}/usr/include/*.h $pkgdir/usr/include/${_gitname}
}
