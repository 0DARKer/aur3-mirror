# Maintainer: Sid Karunaratne <sid at karunaratne dot net>
pkgname=linux-tycoon
_pkgname=LinuxTycoon
pkgver=1.0b3.2
pkgrel=1
pkgdesc="a game where you design and manage your own distribution of Linux and compete against other Distros"
arch=('i686' 'x86_64')
url="http://lunduke.com/?page_id=2646"
license=('custom')
source=(${pkgname}.desktop)
sha256sums=("15a5a31de5c8e1a3462a1d755b951fb35743f13507d377dcd5f74f93b33476de")
_gamepkg="LinuxTycoon.tar.gz"
_gamesum="c8716f998418d0b7764d0f09aabdb44f5a49ed22ecc043c99f4e9e5a7fd3f55e"

if [[ $CARCH = 'i686' ]]; then
    depends=(gtk2)
elif [[ $CARCH = 'x86_64' ]]; then
    depends=(lib32-gtk2)
fi

build() {
    cp "${startdir}/${_gamepkg}" "${srcdir}/"
    msg "You need a full copy of this game in order to install it"
    msg "Searching for \"${_gamepkg}\" in dir: $(readlink -f ${srcdir})"
    pkgpath=${srcdir}

    if [[ ! ( -f "${pkgpath}/${_gamepkg}" ) ]]; then
        msg "Game package not found, please type absolute path to game setup package (/home/joe):"
        read pkgpath
        if [[ ! ( -f "${pkgpath}/${_gamepkg}" ) ]] ; then
           error "Unable to find game package." && return 1
        fi
    fi
    # Check the checksum
    echo "${_gamesum} ${_gamepkg}" > sums
    if [[ $(sha256sum --quiet -c sums 2> /dev/null) ]]; then
        error "${_gamepkg} FAILED the checksum"
        return 1
    fi
    msg "Found game package, installing..."
    cd $srcdir
    tar xzf $_gamepkg
}

package() {
    mkdir -p "${pkgdir}/opt/${_pkgname}" "${pkgdir}/usr/bin"
    cp -r "${srcdir}/${_pkgname}" "${pkgdir}/opt/"
    ln -s "/opt/${_pkgname}/${_pkgname}" "${pkgdir}/usr/bin/${pkgname}"
    install -Dm644 "${srcdir}/${_pkgname}/LinuxTycoon.png" "${pkgdir}/usr/share/pixmaps/LinuxTycoon.png"
    install -Dm644 ${srcdir}/${pkgname}.desktop "${pkgdir}/usr/share/applications/${pkgname}.desktop"
}
