# Maintainer: Moritz Fischer <moritz.fischer@student.kit.edu>
pkgname=gnuradio
pkgver=3.4.2
pkgrel=0
pkgdesc="free software development toolkit that provides the signal processing runtime and processing blocks to implement software radios using readily-available, low-cost external RF hardware and commodity processors"
arch=('i686' 'x86_64')
license=('GPL')
depends=('fftw' 'python2-numpy' 'boost-libs' 'cppunit' 'swig' 'gsl' 'blas' 'guile')
makedepends=('boost')
optdepends=('wxpython: gr-wxgui' 'python-cheetah: grc' 'python-lxml: grc' 'qwtplot3d: gr-qtgui' 'sdcc: firmware and all the parts needing USRP' 'doxygen: docs autogenerated documentation' 'pyxml: grc', 'pygtk: grc' 'python-lxml: grc')
provides=('gnuradio')
url="http://gnuradio.org"
source=(http://gnuradio.org/redmine/attachments/download/279/gnuradio-${pkgver}.tar.gz)
md5sums=('bb4eafa483375e3422802bc070c20827')

_options='--disable-gr-atsc --disable-gr-msdd6000 --disable-gr-usrp2 --enable-gr-uhd --disable-gr-usrp'

build() {
  cd ${srcdir}/${pkgname}-${pkgver}
  msg "Replacing filenames to use python2"
  sed -i -e "s|#![ ]*/usr/bin/env python$|#!/usr/bin/env python2|" $(find $srcdir -name '*.py')
  export PYTHON=`which python2`
  msg "Starting make..."
	./configure --prefix=/usr --with-boost-libdir=/usr/lib $_options --with-lv_arch="generic mmx sse sse2 sse3 sse3 sse4_1 sse4_2"
  make || return 1
  make check || return 1
}

package() 
{
  cd ${srcdir}/${pkgname}-${pkgver}
  make DESTDIR=${pkgdir} install || return 1
}
