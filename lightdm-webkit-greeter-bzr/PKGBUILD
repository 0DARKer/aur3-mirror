# Maintainer: Patrick Melo <patricK@patrickmelo.eti.br>

pkgname=lightdm-webkit-greeter-bzr
pkgver=15
pkgrel=2
pkgdesc="A lightweight display manager (with new LightDM API fixes)"
arch=('i686' 'x86_64')
url="https://launchpad.net/lightdm-webkit-greeter"
license=('GPL3' 'LGPL3')
source=()
depends=('libwebkit' 'lightdm')
options=(!libtool)
makedepends=('gnome-doc-utils' 'gobject-introspection' 'pkg-config')

_bzrbranch="lp:~xapantu/lightdm-webkit-greeter/fixes"
_bzrmod="lightdm-webkit-greeter-fixes"

build() {
  cd "${srcdir}"

  msg "Connecting to the server..."

  if [ -d ${_bzrmod} ]; then
    bzr up ${_bzrmod}
    msg "The local files are updated."
  else
    bzr co ${_bzrbranch} ${_bzrmod}
  fi

  msg "BZR checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${_bzrmod}-build"
  cp -r "${_bzrmod}" "${_bzrmod}-build"
  cd "${_bzrmod}-build"

  ./autogen.sh
  ./configure --prefix=/usr --sysconfdir=/etc \
              --libexecdir=/usr/lib/lightdm

   make || return 1
}

package() {
  cd "${srcdir}/${_bzrmod}-build"
  make DESTDIR="${pkgdir}" install
}

