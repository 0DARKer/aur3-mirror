# Maintainer: Cody Maloney <cmaloney@cs.nmt.edu>
pkgname=ganeti
pkgver=2.5.0~rc4
pkgrel=1
pkgdesc="Cluster-based virtualization management software"
arch=('any') #TODO: Not absolutely positive about this.
url="http://code.google.com/p/ganeti/"
license=('GPL2')
depends=(bridge-utils iproute2 iputils libvirt lvm2 ndisc6 openssh python2 python2-pyopenssl
  python-simplejson python2-pyparsing python2-pyinotify python-pycurl python-paramiko socat)
optdepends=(qemu-kvm)
source=(http://$pkgname.googlecode.com/files/$pkgname-$pkgver.tar.gz)
md5sums=('041db83fe0f86bce0efc3d531467536d')

build() {
  cd "$srcdir/$pkgname-$pkgver"

  #Python 2 fixes
  export PYTHON=python2
  sed -i 's_#!/usr/bin/python_#!/usr/bin/python2_' \
  autotools/check-tar autotools/check-news autotools/build-bash-completion daemons/import-export doc/design-2.1.rst \
  doc/html/design-2.1.html doc/html/_sources/design-2.1.txt Makefile.am Makefile.in qa/ganeti-qa.py  \
  test/ganeti.utils.io_unittest.py test/ganeti.opcodes_unittest.py test/ganeti.jqueue_unittest.py \
  test/ganeti.utils.log_unittest.py test/ganeti.utils.mlock_unittest.py test/ganeti.hypervisor.hv_lxc_unittest.py \
  test/ganeti.cli_unittest.py test/ganeti.daemon_unittest.py test/ganeti.rapi.baserlib_unittest.py \
  test/ganeti.utils.text_unittest.py test/ganeti.objects_unittest.py test/tempfile_fork_unittest.py \
  test/ganeti.cmdlib_unittest.py test/ganeti.utils.algo_unittest.py test/ganeti.serializer_unittest.py \
  test/ganeti.hypervisor_unittest.py test/ganeti.luxi_unittest.py test/ganeti.utils.nodesetup_unittest.py \
  test/ganeti.ssh_unittest.py test/ganeti.hooks_unittest.py test/ganeti.client.gnt_instance_unittest.py \
  test/ganeti.utils.x509_unittest.py test/ganeti.query_unittest.py test/ganeti.hypervisor.hv_fake_unittest.py \
  test/cfgupgrade_unittest.py test/ganeti.netutils_unittest.py test/ganeti.uidpool_unittest.py \
  test/ganeti.hypervisor.hv_chroot_unittest.py test/ganeti.http_unittest.py test/ganeti.runtime_unittest.py \
  test/ganeti.hypervisor.hv_kvm_unittest.py test/ganeti.config_unittest.py test/ganeti.rapi.rlib2_unittest.py \
  test/ganeti.rpc_unittest.py test/ganeti.mcpu_unittest.py test/ganeti.rapi.resources_unittest.py \
  test/ganeti.rapi.client_unittest.py test/ganeti.utils.retry_unittest.py test/ganeti.errors_unittest.py \
  test/ganeti.constants_unittest.py test/ganeti.workerpool_unittest.py test/ganeti.impexpd_unittest.py \
  test/ganeti.ht_unittest.py test/docs_unittest.py test/ganeti.utils_unittest.py test/ganeti.locking_unittest.py \
  test/ganeti.asyncnotifier_unittest.py test/import-export_unittest-helper test/ganeti.masterd.instance_unittest.py \
  test/ganeti.utils.hash_unittest.py test/ganeti.backend_unittest.py test/ganeti.bdev_unittest.py \
  test/ganeti.utils.process_unittest.py test/ganeti.utils.wrapper_unittest.py test/ganeti.hypervisor.hv_xen_unittest.py \
  test/ganeti.confd.client_unittest.py test/ganeti.utils.filelock_unittest.py test/ganeti.qlang_unittest.py \
  test/ganeti.compat_unittest.py tools/cluster-merge tools/sanitize-config tools/cfgupgrade12 tools/ganeti-listrunner \
  tools/setup-ssh tools/lvmstrap tools/cfgshell tools/burnin tools/move-instance tools/check-cert-expired \
  tools/cfgupgrade

  ./configure --prefix=/usr --localstatedir=/var --sysconfdir=/etc
  make
}

check() {
  cd "$srcdir/$pkgname-$pkgver"
  make -k check
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  #TODO: Copy doc/examples/ganeti.initd to /etc/init.d/ganeti
  make DESTDIR="$pkgdir/" install
}

# vim:set ts=2 sw=2 et:
