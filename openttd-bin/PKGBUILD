# Contributor: Alexander Kazarin <boiler@co.ru>

pkgname=openttd-bin
pkgver=1.0.5
pkgrel=1
pkgdesc="OpenTTD is an Open Source clone of Transport Tycoon Deluxe"
arch=('i686' 'x86_64')
url="http://www.openttd.org"
license=('GPL')
depends=(libpng sdl fontconfig icu)
makedepends=()
conflicts=('openttd')
optdepends=('openttd-opengfx: free graphics' 
            'openttd-opensfx: free soundset'
            'openttd-openmsx: free musicset')
_arch="i686"
_md5_tar='397d35173d5f70f40591940378723200'
if [ "${CARCH}" = 'x86_64' ] ; then
  _arch='amd64'
  _md5_tar='9f9068b8b35f70f9c534fa22ac6eac2a'
fi

source=(http://binaries.openttd.org/releases/${pkgver/_/-}/openttd-${pkgver/_/-}-linux-generic-${_arch}.tar.xz)
md5sums=(${_md5_tar})

build() {
  cd ${srcdir}/openttd-${pkgver/_/-}-linux-generic-${_arch}

  mkdir -p ${pkgdir}/usr/share/applications/
  mv media/openttd.desktop ${pkgdir}/usr/share/applications/

  mkdir -p ${pkgdir}/usr/share/doc/openttd/
  mv docs/* ${pkgdir}/usr/share/doc/openttd/

  mkdir -p ${pkgdir}/usr/share/man/man6/
  mv man/openttd.6.gz ${pkgdir}/usr/share/man/man6/

  mkdir -p ${pkgdir}/usr/share/pixmaps/
  mv media/openttd.32.xpm ${pkgdir}/usr/share/pixmaps/

  for isize in 16 32 48 64 128 256 ; do
    mkdir -p ${pkgdir}/usr/share/icons/hicolor/${isize}x${isize}/apps/
    mv media/openttd.${isize}.png ${pkgdir}/usr/share/icons/hicolor/${isize}x${isize}/apps/openttd.png
  done

  mkdir -p ${pkgdir}/usr/share/openttd
  for d in openttd ai data gm lang scripts ; do
    mv $d ${pkgdir}/usr/share/openttd/
  done

  mkdir -p ${pkgdir}/usr/bin/
  echo -e '#/bin/sh\ncd /usr/share/openttd && ./openttd $@' > ${pkgdir}/usr/bin/openttd
  chmod 755 ${pkgdir}/usr/bin/openttd
}
