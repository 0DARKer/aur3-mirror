# Contributor: T-T

if [ -f ./pkgver ]; then
	v=$(cat ./pkgver)
else
	until [ "$v" == '1.1.1' ] || [ "$v" == '1.1.2' ]; do
		echo 'Choose version:'
		echo '	1.1.2'
		echo '	1.1.1'
		read v
	done
fi
if test -f ./pkgver; then rm ./pkgver; else echo "$v" > pkgver; fi

pkgname=openttd-bin
pkgver='1.1.2'
if test "$v"; then pkgver="$v"; fi
pkgrel=1
pkgdesc="OpenTTD is an Open Source clone of Transport Tycoon Deluxe"
arch=('i686' 'x86_64')
url="http://www.openttd.org"
license=('GPL')
depends=(libpng sdl fontconfig icu)
makedepends=()
conflicts=('openttd')
optdepends=('openttd-opengfx: free graphics' 'openttd-opensfx: free soundset' 'openttd-openmsx: free musicset')
if [ "$pkgver" == '1.1.2' ]; then
	if [ "${CARCH}" = 'x86_64' ] ; then
		_arch='amd64'
		_md5_tar='f19cd685f6043be7654792537e42f903'
	else
		_arch="i686"
		_md5_tar='dc1d92453e25e3ab1699fc587124aad7'
	fi
elif [ "$pkgver" == '1.1.1' ]; then
	if [ "${CARCH}" = 'x86_64' ] ; then
		_arch='amd64'
		_md5_tar='16dd695eaeff5db52a9e8a395e59387a'
	else
		_arch="i686"
		_md5_tar='005b1a31086546c418295f4ebfacde10'
	fi
fi

source=(http://binaries.openttd.org/releases/${pkgver}/openttd-${pkgver}-linux-generic-${_arch}.tar.xz)
md5sums=(${_md5_tar})

build() {
	cd ${srcdir}/openttd-${pkgver}-linux-generic-${_arch}

	mkdir -p ${pkgdir}/usr/share/applications/
	mv media/openttd.desktop ${pkgdir}/usr/share/applications/

	mkdir -p ${pkgdir}/usr/share/doc/openttd/
	mv docs/* ${pkgdir}/usr/share/doc/openttd/

	mkdir -p ${pkgdir}/usr/share/man/man6/
	mv man/openttd.6.gz ${pkgdir}/usr/share/man/man6/

	mkdir -p ${pkgdir}/usr/share/pixmaps/
	mv media/openttd.32.xpm ${pkgdir}/usr/share/pixmaps/

	for isize in 16 32 48 64 128 256 ; do
		mkdir -p ${pkgdir}/usr/share/icons/hicolor/${isize}x${isize}/apps/
		mv media/openttd.${isize}.png ${pkgdir}/usr/share/icons/hicolor/${isize}x${isize}/apps/openttd.png
	done

	mkdir -p ${pkgdir}/usr/share/openttd
	for d in openttd ai data gm lang scripts ; do
		mv $d ${pkgdir}/usr/share/openttd/
	done

	mkdir -p ${pkgdir}/usr/bin/
	echo -e '#/bin/sh\ncd /usr/share/openttd && ./openttd $@' > ${pkgdir}/usr/bin/openttd
	chmod 755 ${pkgdir}/usr/bin/openttd
}
