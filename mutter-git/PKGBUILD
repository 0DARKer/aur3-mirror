# Previous Contributor: Hinrich Harms <arch@hinrich.de>
# Contributor: Flamelab <panosfilip@gmail.com>

pkgname=mutter-git
_realpkgname=mutter
pkgver=20101121
pkgrel=1
pkgdesc="The next-gen WM for gnome, with compositing by clutter"
arch=('i686' 'x86_64')
url="http://www.gnome.org"
license=('GPL')
depends=('startup-notification' 'gconf>=2.28.0' 'gnome-common' 'zenity>=2.28.0'
'gtk3>=2.91.4' 'gobject-introspection-git' 'clutter' 'libcanberra' 'glproto' 'freetype2')
makedepends=('intltool' 'gnome-doc-utils>=0.19.5' 'git')
provides=(${_realpkgname})
conflicts=(${_realpkgname})
#install=${pkgname}.install
options=(!libtool)

_gitroot=git://git.gnome.org/${_realpkgname}
_gitname=${_realpkgname}


build() {
  cd ${srcdir}/

    msg "Connecting to the GNOME GIT server...."
    if [[ -d ${srcdir}/${_gitname} ]] ; then
    	cd ${_gitname}
    	git pull origin
    	msg "The local files are updated..."
    else
    	git clone ${_gitroot}
    fi

    msg "GIT checkout done."

    msg "Starting make for: ${pkgname}"

    if [[ -d ${srcdir}/${_gitname}-build ]]; then
       msg "Cleaning the previous build directory..."
       rm -rf ${srcdir}/${_gitname}-build
    fi

    git clone ${srcdir}/${_gitname} ${srcdir}/${_gitname}-build

    cd ${srcdir}/${_gitname}-build

  ./autogen.sh --prefix=/usr --sysconfdir=/etc \
      --libexecdir=/usr/lib/mutter \
      --localstatedir=/var --disable-static


  sed -i 's/\-Werror//g' configure.in

  make || return 1

}

package()  {

  cd ${srcdir}/${_gitname}-build

  make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="${pkgdir}" install

  export GCONF_CONFIG_SOURCE=`gconftool-2 --get-default-source`

  gconftool-2 --makefile-install-rule ${pkgdir}/etc/gconf/schemas/mutter.schemas > /dev/null

}

