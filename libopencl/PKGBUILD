# Contributor: Vojtech "kralyk" Kral

pkgname='libopencl'
pkgver=1.1
pkgrel=1
_amdstream_ver=2.4

pkgdesc='OpenCL library and ICD loader'
arch=('i686' 'x86_64')
url="http://developer.amd.com/gpu/ATIStreamSDK/Pages/default.aspx"
license=("custom")
install='install'

provides=('libcl')
conflicts=('nvidia-utils')

#Architecture resolution
_arch='x86'
_other_arch='x86_64'
_bits='32'
[ "$CARCH" = 'x86_64' ] && _arch='x86_64'
[ "$CARCH" = 'x86_64' ] && _other_arch='x86'
[ "$CARCH" = 'x86_64' ] && _bits='64'

#Sources
source=("http://download2-developer.amd.com/amd/APPSDK/AMD-APP-SDK-v${_amdstream_ver}-lnx${_bits}.tgz")

#sha256sums
sha256sums=('de59238c792a420703449786e19fd8abeafee40a185aa934364196422747958c')
[ "$CARCH" = 'x86_64' ] && sha256sums=('2aa32269d206dd4e48580cc0e5aee03f4d9d9c539b10e8f29d0a21461a58a34a')

#Install path
_ipath='/opt/amdstream'

build() { true; }

package()
{
  cd "${srcdir}/AMD-APP-SDK-v${_amdstream_ver}-lnx${_bits}"

  mkdir -p "${pkgdir}/usr/"{bin,lib}
  install -m 755 "./bin/${_arch}/clinfo" "${pkgdir}/usr/bin"
  install -m 755 "./lib/${_arch}/libOpenCL.so.1" "${pkgdir}/usr/lib"
  ln -s 'libOpenCL.so.1' "${pkgdir}/usr/lib/libOpenCL.so"
}
