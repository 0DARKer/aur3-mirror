#Maintainer: Gustavo Alvarez <sl1pkn07@gmail.com>

pkgname=kdeplasma-applets-smooth-tasks-fork-hg
pkgver=19
pkgrel=1
pkgdesc="Is a fork of Smooth Task. Smooth Tasks is a fork of the STasks plasma applet (Mercurial)"
arch=('i686' 'x86_64')
url="https://bitbucket.org/flupp/smooth-tasks-fork"
license=('GPL')
depends=('kdebase-workspace')
makedepends=('mercurial' 'cmake' 'kdelibs' 'automoc4')
provides=('kdeplasma-applets-smooth-tasks')
replaces=('kdeplasma-applets-smooth-tasks')
conflicts=('smooth-tasks-fork' 'smooth-tasks' 'smooth-tasks2' 'kdeplasma-applets-smooth-tasks2')

_hgroot="https://bitbucket.org/flupp"
_hgname="smooth-tasks-fork"

build() {
  cd "${srcdir}"
  msg "Connecting to hg server..."
  if [ -d "${_hgname}" ]; then
    cd "${_hgname}" && hg pull -u
  else
    hg clone "${_hgroot}/${_hgname}" -r kde-4.8
  fi

  msg "hg checkout done or server timeout"
  msg "Starting make..."

  rm -rf "${srcdir}/${_hgname}-build"
  cp -r "${srcdir}/${_hgname}" "${srcdir}/${_hgname}-build" 
  cd "${srcdir}/${_hgname}-build"

  cmake . -DCMAKE_INSTALL_PREFIX="$(kde4-config --prefix)"
  make
}

package() {
  cd "${srcdir}/${_hgname}-build"
  make DESTDIR="${pkgdir}" install
}