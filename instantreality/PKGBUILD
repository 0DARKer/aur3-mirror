
# Maintainer: Florian Hofmann <fho@f12n.de>

# Special thanks to Gadget3000

pkgname=instantreality
pkgver=2.4.0
_pkgsubver=26843
pkgrel=1
pkgdesc="The framework provides a comprehensive set of features to support classic Virtual Reality (VR) and advanced Augmented Reality (AR) equally well."
arch=('x86_64')
url="http://www.instantreality.org"
license=('custom:Fraunhofer-Gesellschaft')
depends=(freealut libpng12 graphicsmagick gtkglext libgnomeui libjpeg6 ffmpeg python nvidia-cg-toolkit)
makedepends=(binutils)


md5sums=('2848c7a47893beb3998db543d5a73132'
         '7be414f4260e6a35a66c08b3c3f7f216'
         '9bba3d3ebd0c14e0de3fa77fd0cf52dc'
         'f36ebc59bb690b5994bf8600b65cccee'
         '423856f1fa176ceebbd980793e3d26c2'
         '23f0d7731566377c56ca7b086c92963a'
         '6b61bd2a756980f9056ed00a3b592b02'
         '77b7bb98814b9e94fd526cd4866450d9'
         '5f9bd6ce56d9527c7ffd8a32ecdcad74'
         '54580380361853ed1cbb393dc3b53a96'
         '98ec58aadbee2f9578fe700d621a19dd'
         '95f55a5e6f31e4ea818db1e44af1d093'
         '8be949a9bb46ade19b29e72ff4329a0a')


_iarch=x64
_uarch=amd64

source=("http://doc.instantreality.org/media/uploads/downloads/${pkgver}/InstantReality-Ubuntu-14.04-${_iarch}-${pkgver}.${_pkgsubver}.deb"

        "http://de.archive.ubuntu.com/ubuntu/pool/main/o/openexr/libopenexr6_1.6.1-7ubuntu1_${_uarch}.deb"
        "http://de.archive.ubuntu.com/ubuntu/pool/main/i/ilmbase/libilmbase6_1.0.1-6ubuntu1_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/main/t/tiff/libtiff5_4.0.3-7ubuntu0.1_${_uarch}.deb"
        "http://de.archive.ubuntu.com/ubuntu/pool/main/b/boost1.54/libboost-system1.54.0_1.54.0-4ubuntu3_${_uarch}.deb"
        "http://de.archive.ubuntu.com/ubuntu/pool/main/b/boost1.54/libboost-filesystem1.54.0_1.54.0-4ubuntu3_${_uarch}.deb"
        "http://de.archive.ubuntu.com/ubuntu/pool/main/b/boost1.54/libboost-regex1.54.0_1.54.0-4ubuntu3_${_uarch}.deb"
        "http://de.archive.ubuntu.com/ubuntu/pool/main/b/boost1.54/libboost-thread1.54.0_1.54.0-4ubuntu3_${_uarch}.deb"

        "http://de.archive.ubuntu.com/ubuntu/pool/main/i/icu/libicu52_52.1-3_${_uarch}.deb"

        "http://security.ubuntu.com/ubuntu/pool/universe/liba/libav/libavcodec54_9.14-0ubuntu0.14.04.1_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/universe/liba/libav/libavformat54_9.14-0ubuntu0.14.04.1_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/universe/liba/libav/libavutil52_9.14-0ubuntu0.14.04.1_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/main/j/jbigkit/libjbig0_2.0-2ubuntu4.1_${_uarch}.deb"

)

# don't extract anything ... we will do it by hand
noextract=(${source[@]##*/})



build() {


  cd ${srcdir}

  # ubuntu libraries

  # libtiff
  undeb libtiff libtiff5_4.0.3-7ubuntu0.1_${_uarch}.deb

  # libilmbase
  undeb libilmbase libilmbase6_1.0.1-6ubuntu1_${_uarch}.deb

  # libopenexr
  undeb libopenexr libopenexr6_1.6.1-7ubuntu1_${_uarch}.deb


  # libboost-system
  undeb libboost-system libboost-system1.54.0_1.54.0-4ubuntu3_${_uarch}.deb

  # libboost-filesystem
  undeb libboost-filesystem libboost-filesystem1.54.0_1.54.0-4ubuntu3_${_uarch}.deb

  # libboost-regex
  undeb libboost-regex libboost-regex1.54.0_1.54.0-4ubuntu3_${_uarch}.deb

  # libboost-thread
  undeb libboost-thread libboost-thread1.54.0_1.54.0-4ubuntu3_${_uarch}.deb

  # libicu
  undeb libicu libicu52_52.1-3_${_uarch}.deb


  # libavcodec
  undeb libavcodec libavcodec54_9.14-0ubuntu0.14.04.1_${_uarch}.deb

  # libavformat
  undeb libavformat libavformat54_9.14-0ubuntu0.14.04.1_${_uarch}.deb

  # libavutil
  undeb libavutil libavutil52_9.14-0ubuntu0.14.04.1_${_uarch}.deb

  # libjbig
  undeb libjbig libjbig0_2.0-2ubuntu4.1_${_uarch}.deb
}

function undeb {
  #echo "undebbing: $1"
  install -d ${srcdir}/$1
  ar x $2 > /dev/null
  tar -xaf data.tar.xz -C ${srcdir}/$1
}

#check() {
#  cd "$srcdir/$pkgname-$pkgver"
#  make -k check
#}

package() {
  cd "$srcdir"

  # install instant reality
  ar x InstantReality-Ubuntu-14.04-${_iarch}-${pkgver}.${_pkgsubver}.deb
  tar -xaf data.tar.xz -C ${pkgdir}



  # install ubuntu libs
  IRLIBS="${pkgdir}/opt/instantReality/lib/"
  install -d $IRLIBS

  # libtiff.so.4
  install -D -m644 "${srcdir}/libtiff/usr/lib/${CARCH}-linux-gnu/libtiff.so.5.2.0" $IRLIBS
  ln -s ./libtiff.so.5.2.0 "${IRLIBS}/libtiff.so.5"

  # libIlmImf
  install -D -m644 "${srcdir}/libopenexr/usr/lib/${CARCH}-linux-gnu/libIlmImf.so.6.0.0" $IRLIBS
  ln -s ./libIlmImf.so.6.0.0 "${IRLIBS}/libIlmImf.so.6"

  # libilmbase
  install -D -m644 "${srcdir}/libilmbase/usr/lib/${CARCH}-linux-gnu/libIex.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/${CARCH}-linux-gnu/libHalf.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/${CARCH}-linux-gnu/libImath.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/${CARCH}-linux-gnu/libIlmThread.so.6.0.0" $IRLIBS

  ln -s ./libIex.so.6.0.0 "${IRLIBS}/libIex.so.6"
  ln -s ./libHalf.so.6.0.0 "${IRLIBS}/libHalf.so.6"
  ln -s ./libImath.so.6.0.0 "${IRLIBS}/libImath.so.6"
  ln -s ./libIlmThread.so.6.0.0 "${IRLIBS}/libIlmThread.so.6"

  # libboost
  install -D -m644 "${srcdir}/libboost-system/usr/lib/${CARCH}-linux-gnu/libboost_system.so.1.54.0" $IRLIBS
  install -D -m644 "${srcdir}/libboost-filesystem/usr/lib/${CARCH}-linux-gnu/libboost_filesystem.so.1.54.0" $IRLIBS
  install -D -m644 "${srcdir}/libboost-regex/usr/lib/${CARCH}-linux-gnu/libboost_regex.so.1.54.0" $IRLIBS
  install -D -m644 "${srcdir}/libboost-thread/usr/lib/${CARCH}-linux-gnu/libboost_thread.so.1.54.0" $IRLIBS


  # libicu
  install -D -m644 "${srcdir}/libicu/usr/lib/${CARCH}-linux-gnu/libicuuc.so.52.1" $IRLIBS
  install -D -m644 "${srcdir}/libicu/usr/lib/${CARCH}-linux-gnu/libicui18n.so.52.1" $IRLIBS
  install -D -m644 "${srcdir}/libicu/usr/lib/${CARCH}-linux-gnu/libicudata.so.52.1" $IRLIBS

  ln -s ./libicuuc.so.52.1 "${IRLIBS}/libicuuc.so.52"
  ln -s ./libicui18n.so.52.1 "${IRLIBS}/libicui18n.so.52"
  ln -s ./libicudata.so.52.1 "${IRLIBS}/libicudata.so.52"


  # libavcodec
  install -D -m644 "${srcdir}/libavcodec/usr/lib/${CARCH}-linux-gnu/libavcodec.so.54.35.0" $IRLIBS
  ln -s ./libavcodec.so.54.35.0 "${IRLIBS}/libavcodec.so.54"

  # libavformat
  install -D -m644 "${srcdir}/libavformat/usr/lib/${CARCH}-linux-gnu/libavformat.so.54.20.4" $IRLIBS
  ln -s ./libavformat.so.53.20.4 "${IRLIBS}/libavformat.so.54"

  # libavutil
  install -D -m644 "${srcdir}/libavutil/usr/lib/${CARCH}-linux-gnu/libavutil.so.52.3.0" $IRLIBS
  ln -s ./libavutil.so.52.3.0 "${IRLIBS}/libavutil.so.52"

  # libjbig
  install -D -m644 "${srcdir}/libjbig/usr/lib/${CARCH}-linux-gnu/libjbig.so.0" $IRLIBS
}

# vim:set ts=2 sw=2 et:
