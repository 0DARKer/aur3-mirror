# This is an example PKGBUILD file. Use this as a start to creating your own,
# and remove these comments. For more information, see 'man PKGBUILD'.
# NOTE: Please fill out the license field for your package! If it is unknown,
# then please put 'unknown'.

# Maintainer: Florian Hofmann <florian@fhaust.de> 
pkgname=instantreality
pkgver=2.2.0
_pkgsubver=24102
pkgrel=1
pkgdesc="The framework provides a comprehensive set of features to support classic Virtual Reality (VR) and advanced Augmented Reality (AR) equally well."
arch=('i686' 'x86_64')
url="http://www.instantreality.org"
license=('custom:Fraunhofer-Gesellschaft')
depends=(freealut libpng12 graphicsmagick gtkglext libgnomeui libjpeg6 ffmpeg python)
makedepends=(binutils)


# set some values based on arch
if [ "${CARCH}" = "x86_64" ]; then

  md5sums=('7eb65ec855ce73f43e3c3322d37394bf'
           'a5e2e61adf2ee1e6136ac43f397bcf89'
           '0715483dfd7cbb36f5ee55ec6431757f'
           'eef44d3d9913612cc0793c4171f0627d'
           '35395ebb1b4f5e33087f0bf9420cfca7'
           'ff336586b35a35db899ab9523d3a4f4a'
           '728d7b54e149ed01596c45ccc7d55200'
           'b0bc3ef44e9409aca644d9d83d63a828'
           'eb45b2fdfd9919189e327c5981fc7f71'
           'afbcf1c3f59bd3fbc969fa04d1d4ddfc'
           '4311005afda9d0707df1ef6796300309'
           )

  _iarch=x64
  _uarch=amd64
elif [ "${CARCH}" = "i686" ]; then
  md5sums=('b94813da6cc59f05d7e175484c054fa8'
           'c6e695c4211215389062cc1a9bd3e184'
           '7a1df98a6e3c1bc82a6e4fd7fbb89748'
           '4380de966494a6ec7483934900b6bbcb'
           '9f7efd1684313e7be0681d6ba5aa128b'
           'd6fc4a2ee2ae4d566488fa574b4d3a64'
           'ac566ffe49c2049b589e0c6dc65cdd77'
           '564699c9e98d9af9dc0fcca8edfd53ea'
           '097c6c05940f8b75f11b10e0e4d55261'
           'b0baa6d28eeae76af382959b072d1ddb'
           '3904d6c871e9b3dbd09b3e2fcee06c0c')

  _iarch=x86
  _uarch=i386
fi

source=("http://doc.instantreality.org/media/uploads/downloads/${pkgver}/InstantReality-Ubuntu-12.04-${_iarch}-${pkgver}.${_pkgsubver}.deb"

        "http://mirror.pnl.gov/ubuntu//pool/main/o/openexr/libopenexr6_1.6.1-4.1_${_uarch}.deb"
        "http://mirror.pnl.gov/ubuntu//pool/main/i/ilmbase/libilmbase6_1.0.1-3build2_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/main/t/tiff/libtiff4_3.8.2-7ubuntu3.16_${_uarch}.deb"

        "http://mirror.pnl.gov/ubuntu//pool/universe/b/boost1.46/libboost-system1.46.1_1.46.1-7ubuntu3_${_uarch}.deb"
        "http://mirror.pnl.gov/ubuntu//pool/universe/b/boost1.46/libboost-filesystem1.46.1_1.46.1-7ubuntu3_${_uarch}.deb"
        "http://mirror.pnl.gov/ubuntu//pool/main/b/boost1.46/libboost-regex1.46.1_1.46.1-7ubuntu3_${_uarch}.deb"
        "http://mirror.pnl.gov/ubuntu//pool/universe/b/boost1.46/libboost-thread1.46.1_1.46.1-7ubuntu3_${_uarch}.deb"

        "http://mirror.pnl.gov/ubuntu//pool/main/i/icu/libicu48_4.8.1.1-3_${_uarch}.deb"

        "http://security.ubuntu.com/ubuntu/pool/main/liba/libav/libavcodec53_0.8.4-0ubuntu0.12.04.1_${_uarch}.deb"
        "http://security.ubuntu.com/ubuntu/pool/main/liba/libav/libavformat53_0.8.4-0ubuntu0.12.04.1_${_uarch}.deb"
)

# don't extract anything ... we will do it by hand
noextract=(${source[@]##*/})

build() {

  cd ${srcdir}
  ar x InstantReality-Ubuntu-12.04-${_iarch}-${pkgver}.${_pkgsubver}.deb > /dev/null || return 1
  tar -xf data.tar.gz -C ${pkgdir} || return 1

  # ubuntu libraries

  # libtiff - ubuntu precise
  undeb libtiff libtiff4_3.8.2-7ubuntu3.16_${_uarch}.deb

  # libilmbase - ubuntu precise
  undeb libilmbase libilmbase6_1.0.1-3build2_${_uarch}.deb

  # libopenexr - ubuntu precise
  undeb libopenexr libopenexr6_1.6.1-4.1_${_uarch}.deb


  # libboost-system - ubuntu precise
  undeb libboost-system libboost-system1.46.1_1.46.1-7ubuntu3_${_uarch}.deb
  
  # libboost-filesystem - ubuntu precise
  undeb libboost-filesystem libboost-filesystem1.46.1_1.46.1-7ubuntu3_${_uarch}.deb

  # libboost-regex - ubuntu precise
  undeb libboost-regex libboost-regex1.46.1_1.46.1-7ubuntu3_${_uarch}.deb

  # libboost-thread - ubuntu precise
  undeb libboost-thread libboost-thread1.46.1_1.46.1-7ubuntu3_${_uarch}.deb

  # libicu - ubuntu precise
  undeb libicu libicu48_4.8.1.1-3_${_uarch}.deb


  # libavcodec - ubuntu precise
  undeb libavcodec libavcodec53_0.8.4-0ubuntu0.12.04.1_${_uarch}.deb

  # libavformat - ubuntu precise
  undeb libavformat libavformat53_0.8.4-0ubuntu0.12.04.1_${_uarch}.deb
}

function undeb {
  #echo "undebbing: $1"
  install -d ${srcdir}/$1
  ar x $2 > /dev/null || return 1
  tar -xf data.tar.gz -C ${srcdir}/$1 || return 1
}

#check() {
#  cd "$srcdir/$pkgname-$pkgver"
#  make -k check
#}

package() {
  cd "$srcdir"


  # install ubuntu libs
  IRLIBS="${pkgdir}/opt/instantReality/lib/"
  install -d $IRLIBS 

  # libtiff.so.4
  install -D -m644 "${srcdir}/libtiff/usr/lib/libtiff.so.4.2.1" $IRLIBS
  ln -s ./libtiff.so.4.2.1 "${IRLIBS}/libtiff.so.4"

  # libIlmImf
  install -D -m644 "${srcdir}/libopenexr/usr/lib/libIlmImf.so.6.0.0" $IRLIBS
  ln -s ./libIlmImf.so.6.0.0 "${IRLIBS}/libIlmImf.so.6"

  # libilmbase
  install -D -m644 "${srcdir}/libilmbase/usr/lib/libIex.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/libHalf.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/libImath.so.6.0.0" $IRLIBS
  install -D -m644 "${srcdir}/libilmbase/usr/lib/libIlmThread.so.6.0.0" $IRLIBS

  ln -s ./libIex.so.6.0.0 "${IRLIBS}/libIex.so.6"
  ln -s ./libHalf.so.6.0.0 "${IRLIBS}/libHalf.so.6"
  ln -s ./libImath.so.6.0.0 "${IRLIBS}/libImath.so.6"
  ln -s ./libIlmThread.so.6.0.0 "${IRLIBS}/libIlmThread.so.6"
     
  # libboost
  install -D -m644 "${srcdir}/libboost-system/usr/lib/libboost_system.so.1.46.1" $IRLIBS
  install -D -m644 "${srcdir}/libboost-filesystem/usr/lib/libboost_filesystem.so.1.46.1" $IRLIBS
  install -D -m644 "${srcdir}/libboost-regex/usr/lib/libboost_regex.so.1.46.1" $IRLIBS
  install -D -m644 "${srcdir}/libboost-thread/usr/lib/libboost_thread.so.1.46.1" $IRLIBS


  # libicu
  install -D -m644 "${srcdir}/libicu/usr/lib/libicuuc.so.48.1.1" $IRLIBS
  install -D -m644 "${srcdir}/libicu/usr/lib/libicui18n.so.48.1.1" $IRLIBS
  install -D -m644 "${srcdir}/libicu/usr/lib/libicudata.so.48.1.1" $IRLIBS

  ln -s ./libicuuc.so.48.1.1 "${IRLIBS}/libicuuc.so.48"
  ln -s ./libicui18n.so.48.1.1 "${IRLIBS}/libicui18n.so.48"
  ln -s ./libicudata.so.48.1.1 "${IRLIBS}/libicudata.so.48"


  # libavcodec
  install -D -m644 "${srcdir}/libavcodec/usr/lib/${CARCH}-linux-gnu/libavcodec.so.53.35.0" $IRLIBS

  ln -s ./libavcodec.so.53.35.0 "${IRLIBS}/libavcodec.so.53"
  
  # libavformat
  install -D -m644 "${srcdir}/libavformat/usr/lib/${CARCH}-linux-gnu/libavformat.so.53.21.0" $IRLIBS
  ln -s ./libavformat.so.53.21.0 "${IRLIBS}/libavformat.so.53"
}

# vim:set ts=2 sw=2 et:
