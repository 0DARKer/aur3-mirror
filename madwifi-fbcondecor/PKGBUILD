# $Id: PKGBUILD,v 1.32 2007/12/05 07:10:20 tpowa Exp $
# Originally by kleptophobiac <kleptophobiac@gmail.com>
# Modified by James Rayner for the repositories <iphitus@gmail.com>
# Contributor : Juan Pablo Gonzalez <lord_jotape@yahoo.com.ar>
_kernver=2.6.24-fbcondecor;

pkgname=madwifi-fbcondecor
_pkgname=madwifi
_kernel_version=2.6.24
pkgver=0.9.3.3
pkgrel=1
pkgdesc="Madwifi drivers for Atheros wireless chipsets. For kernel26fbcondecor"
arch=(i686 x86_64)
license=('GPL')
url="http://madwifi.org"
depends=('madwifi-utils' "kernel26fbcondecor>=${_kernel_version}")
makedepends=('sharutils')
install=madwifi-ng.install
# subversion source: svn checkout http://svn.madwifi.org/madwifi/trunk madwifi
source=(http://ufpr.dl.sourceforge.net/sourceforge/madwifi/madwifi-${pkgver}.tar.gz
	#http://downloads.sourceforge.net/madwifi/madwifi-${pkgver}.tar.gz
	)
md5sums=('20349fdcaf38b8ae3296ef09146e5851')

build() {
  [ "${CARCH}" == "i686" ] && export ARCH=i386

  cd $startdir/src/$_pkgname-$pkgver
  #cd $startdir/src/$_pkgname
  sed -i -e 's/-Werror//g' Makefile.inc
  make KERNELPATH=/lib/modules/$_kernver/build KERNELRELEASE=$_kernver modules|| return 1
  make KERNELPATH=/lib/modules/$_kernver/build KERNELRELEASE=$_kernver modules \
       DESTDIR=$startdir/pkg KERNELRELEASE=$_kernver install-modules
  sed -i -e "s/KERNEL_VERSION='.*'/KERNEL_VERSION='${_kernver}'/" $startdir/*.install

  # install to wireless kernel directory
  mkdir -p $startdir/pkg/lib/modules/$_kernver/kernel/drivers/net/wireless/madwifi
  mv $startdir/pkg/lib/modules/$_kernver/net/* $startdir/pkg/lib/modules/$_kernver/kernel/drivers/net/wireless/madwifi
  rm -r $startdir/pkg/lib/modules/$_kernver/net/
}

