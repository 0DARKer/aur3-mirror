# Contributor: ilikenwf/Matt Parnell <parwok@gmail.com>
# Maintainer: ilikenwf/Matt Parnell <parwok@gmail.com>

pkgname=openoffice-uglyfix-freetype2
pkgver=2.4.4
pkgrel=5
pkgdesc="Compiles freetype2 .so files and puts them in the openoffice directory to fix font ugliness"
arch=(i686 x86_64)
license=('GPL')
url="http://freetype.sourceforge.net"
depends=('zlib' 'openoffice-base')
options=('!libtool')
source=(http://downloads.sourceforge.net/sourceforge/freetype/freetype-${pkgver}.tar.bz2
	freetype-2.3.0-enable-spr.patch
	freetype-2.2.1-enable-valid.patch
	freetype-2.2.1-memcpy-fix.patch
	openoffice.patch)
md5sums=('b3e2b6e2f1c3e0dffa1fd2a0f848b671'
         '816dc8619a6904a7385769433c0a8653'
         '214119610444c9b02766ccee5e220680'
         '6fb6606d28082ecb8e0c6d986b0b26aa'
         'c9ff451346b5f542479828df875e1d39')

build() {
  cd ${srcdir}/freetype-${pkgver}
  patch -Np1 -i ${srcdir}/freetype-2.3.0-enable-spr.patch || return 1
  patch -Np1 -i ${srcdir}/freetype-2.2.1-enable-valid.patch || return 1
  patch -Np1 -i ${srcdir}/freetype-2.2.1-memcpy-fix.patch || return 1
  patch -Np0 -i ${srcdir}/openoffice.patch || return 1
  
  # Make this work if go-openoffice is installed:
  if [ -a /usr/lib/go-openoffice ]
  then
	INSTDIR=go-openoffice
  else
	INSTDIR=openoffice
  fi

  ./configure --prefix=/usr --with-bytecode_interpreter --with-subpixel_rendering --disable-static || return 1
  make || return 1
  make DESTDIR=${startdir}/pkg install || return 1
  mkdir -p ${pkgdir}/usr/lib/${INSTDIR}/program
  /bin/install -c ${startdir}/pkg/usr/lib/libfreetype.so* ${pkgdir}/usr/lib/${INSTDIR}/program/
  rm -rf ${pkgdir}/usr/{bin,include,share}
  rm -rf ${pkgdir}/usr/lib/{pkgconfig,libfreetype.so,libfreetype.so.6,libfreetype.so.6.4.0}
 }
