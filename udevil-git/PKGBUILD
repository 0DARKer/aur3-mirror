# Maintainer: IgnorantGuru http://igurublog.wordpress.com/contact-ignorantguru/
pkgname="udevil-git"
pkgver=20120522
pkgrel=1
pkgdesc="Mount without password - git next branch"
arch=('i686' 'x86_64')
url=("http://ignorantguru.github.com/udevil/")
license=('GPL3')

makedepends=('intltool' 'gettext')
depends=('udev' 'glib2')
conflicts=('udevil')
provides=('udevil')
_gitroot="git://github.com/IgnorantGuru/udevil.git"
_gitname="udevil"

# Set USE_GDB=1 to build for gdb debugging, otherwise set USE_GDB=0
USE_GDB=1

if (( USE_GDB == 1 )); then
    options=('!strip')
fi

build() {
    cd "$srcdir"
    msg "Connecting to GIT server...."

    if [ -d $_gitname ] ; then
        cd $_gitname && git pull origin next
        msg "The local files are updated."
    else
        git clone -b next $_gitroot $_gitname
    fi

    msg "GIT checkout done or server timeout"
    msg "Starting make..."

    rm -rf "$srcdir/$_gitname-build"
    git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"

    if (( USE_GDB == 1 )); then
        CFLAGS+="-g" ./configure --prefix=/usr
        echo
        CFLAGS+="-g" make
    else
        ./configure --prefix=/usr
        echo
        make
    fi
    echo
}

package() {
    cd "${srcdir}/$_gitname-build"
    echo
    make DESTDIR="${pkgdir}/" install
    echo
}

