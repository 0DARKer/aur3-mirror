# $Id: PKGBUILD,v 1.13 2008/04/07 06:00:00 ArchPetr Exp $
# Maintainer: Jan de Groot <jgc@archlinxu.org>
# Contri-butor: Wael Nasreddine <gandalf@siemens-mobiles.org>
# Contributor: Tor Krill <tor@krill.nu>
# Contributor: Will Rea <sillywilly@gmail.com>
# Contributor: Valentine Sinitsyn <e_val@inbox.ru>
# Contributor: Petr Nov√°k <n_petr at seznam dot cz>

pkgname=networkmanager-beta
pkgver=0.7.0
pkgrel=1
pkgdesc="Network Management daemon - include true libnetworkmanger 0.7.0"
arch=('i686' 'x86_64')
license=('GPL')
url="http://www.gnome.org/projects/NetworkManager/"
provides=("libnetworkmanager=${pkgver}" "networkmanager=${pkgver}" "gnome-network-manager=${pkgver}")
replaces=('libnetworkmanager' 'networkmanager' 'gnome-network-manager')
conflicts=('libnetworkmanager' 'networkmanager' 'gnome-network-manager')
depends=('wireless_tools' 'iproute' 'dhcdbd' 'hal>=0.5.9.1' 'libnl' 'wpa_supplicant>=0.5.8')
makedepends=('pkgconfig' 'perlxml')
options=('!libtool')
source=(http://student.upce.cz/NetworkManager-${pkgver}.tar.gz 
	NetworkManager.conf
	ntpdate
	netfs)
md5sums=('fe670671b3379f46196c3682eaa03d59'
         'fbdcffdc2cc7740f99c6ef5047f35160'
         '9a3b8da1efac158d91bb9fc699736b03'
         'ee592ee567faf683e7aecf651bd15937')

build() {
  cd ${startdir}/src/NetworkManager-${pkgver}

  ./configure --prefix=/usr --sysconfdir=/etc \
      --with-distro=arch --localstatedir=/var \
      --disable-static --libexecdir=/usr/lib/networkmanager

  for dir in libnm-util utils gnome/libnm_glib include; do
    pushd ${dir}
    make || return 1
    make DESTDIR=${startdir}/pkg install
    popd
  done
  
  make || return 1
  sed -i -e '/\slibnm-util\s/d' -e '/\sinclude/d' -e '/\sgnome\s/d' Makefile
  make DESTDIR=${startdir}/pkg install
  install -d -m755 ${startdir}/pkg/usr/bin
  install -m755 test/nm-tool ${startdir}/pkg/usr/bin/nm-tool
  install -m644 ${startdir}/src/NetworkManager.conf ${startdir}/pkg/etc/dbus-1/system.d/NetworkManager.conf
  install -m755 ${startdir}/src/ntpdate ${startdir}/pkg/etc/NetworkManager/dispatcher.d/ntpdate
  install -m755 ${startdir}/src/netfs ${startdir}/pkg/etc/NetworkManager/dispatcher.d/netfs
}
