# Maintainer : Martin Wimpress <code@flexion.org>
# Contributor: Kurt J. Bosch <kjb-temp-2009 at alpenjodel.de>
# Contributor: Roberto Alsina <ralsina at kde.org>

pkgname=nullmailer
pkgver=1.11
pkgrel=2
pkgdesc="Simple relay-only mail transport agent."
arch=('i686' 'x86_64')
url="http://www.untroubled.org/nullmailer/"
license=("GPL")
provides=('smtp-forwarder')
conflicts=('smtp-forwarder' 'smtp-server')
depends=('gcc-libs' 'gnutls')
install=nullmailer.install
changelog=nullmailer.changelog
source=(http://www.untroubled.org/nullmailer/archive/$pkgname-$pkgver.tar.gz
        nullmailer.service)
md5sums=('c71157dafcfa4161ef0e1a9a59708784'
         'bf46f5fd46725c3e6fcf8f30160e467e')

build() {
  cd $srcdir/$pkgname-$pkgver
  ./configure --prefix=/usr --libexecdir=/usr/lib \
              --sysconfdir=/etc --localstatedir=/var \
              --enable-tls
  make || return 1
  make DESTDIR=$pkgdir install || return 1

  install -D -m 0644 ../nullmailer.service $pkgdir/usr/lib/systemd/system/nullmailer.service || return 1

  # remove pipe and create on install to work around makepkg hang on grep -R
  rm $pkgdir/var/nullmailer/trigger
}
