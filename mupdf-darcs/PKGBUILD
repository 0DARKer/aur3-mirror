# Maintainer: TDY <tdy@gmx.com>
# Contributor: peets
pkgname=mupdf-darcs
pkgver=20101127
pkgrel=1
pkgdesc="lightweight PDF viewer and toolkit written in portable C"
arch=('i686' 'x86_64')
url="http://mupdf.com"
license=(GPL3)
depends=(freetype2 libjpeg zlib jbig2dec openjpeg)
makedepends=('darcs')
provides=(mupdf)
conflicts=(mupdf)

_darcstrunk="http://mupdf.com/repos"
_darcsmod="mupdf"

build() {
cd "$srcdir"

msg "Checking for previous build"

if [[ -d $_darcsmod/_darcs ]]
then
  msg "Retrieving missing patches"
  cd $_darcsmod
  darcs pull -a $_darcstrunk/$_darcsmod
else
  msg "Retrieving complete sources"
  darcs get --partial --set-scripts-executable $_darcstrunk/$_darcsmod
  cd $_darcsmod
fi

rm -rf "$srcdir/$_darcsmod-build"
cp -r "$srcdir/$_darcsmod" "$srcdir/$_darcsmod-build"
cd "$srcdir/$_darcsmod-build"

msg "Starting build"

#
# BUILD
#

  make build=release prefix="$pkgdir/usr" install 

# added the folowing to avoid conflicts with poppler/other pdf toolkits:
  cd "$pkgdir/usr/bin" && for fff in pdf*; do mv "$fff" "$fff-mupdf"; done
}
