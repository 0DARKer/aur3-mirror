# Maintainer: Anatoliy Anischovich <lin.aaa.lin at gmail.com>
pkgname=qbs-git
conflicts=('qbs')
provides=('qbs')
pkgver=v1.0.0
pkgrel=1
pkgdesc='A tool that helps simplify the build process'
arch=('i686' 'x86_64')
url='http://qt-project.org/wiki/qbs'
license=('LGPL2.1')
depends=('qt5-base' 'qt5-script')
makedepends=('git')

_gitname='qbs'
_qt_dir="$(qmake -query QT_INSTALL_PREFIX)"
_qt_plugins_dir="$(qmake -query QT_INSTALL_PLUGINS)"

source=('git://gitorious.org/qt-labs/qbs.git')
md5sums=('SKIP')

build() {
  cd "${_gitname}"

# sed -i "s#{installPrefix}/plugins#{installPrefix}${_qt_plugins_dir#$_qt_dir}/qbs#g" src/plugins/plugins.pri

  qmake -r qbs.pro
  make
}

pkgver() {
  cd "$_gitname"

  # echo $(git rev-list --count HEAD)
  # Use the tag of the last commit
  git describe --always | sed -r -e 's/-/./g' -e 's/v(.*)\.g.*/\1/'
}

package(){
  cd "${srcdir}/${_gitname}"

  make INSTALL_ROOT="${pkgdir}/${_qt_dir}" install
}
