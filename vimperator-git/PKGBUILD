pkgname=('vimperator-git')
_srcname='vimperator'
pkgver=r4833.8d46cab
pkgrel=1
pkgdesc='Make Firefox look and behave like Vim'
arch=('any')
url='https://github.com/vimperator/vimperator-labs'
license=('MIT')

depends=('firefox')
makedepends=('git')
provides=('vimperator')
conflicts=('vimperator' 'vimperator-hg')

source=("$_srcname::git+https://github.com/vimperator/vimperator-labs.git" 'no_zip.patch')
sha256sums=('SKIP' 'df8f2f4a8b84f84e5b6908678534a5f650a2da03728c8617ea76bef55f3981dc')

_extension_id='vimperator@mozdev.org'

pkgver() {
	cd "$_srcname"
	printf 'r%s.%s\n' "$(git rev-list HEAD | wc -l)" "$(git describe --always)"
}

prepare() {
	cd "$_srcname"
	git apply ../no_zip.patch
}

build() {
	cd "${_srcname}/vimperator"
	make VERSION="$pkgver" xpi
}

package() {
	local destdir="${pkgdir}/usr/lib/firefox/browser/extensions"
	install -d "$destdir"
	cp -R "${_srcname}/downloads/vimperator-$pkgver" "${destdir}/$_extension_id"
}
