# Maintainer: Louis-Guillaume Gagnon <louis.guillaume.gagnon@gmail.com>
pkgname=mafalda-svn
pkgver=80
pkgrel=1
pkgdesc="Medipix pixel detector data analysis framework"
arch=('any')
url="https://twiki.cern.ch/bin/view/Main/MAFalda"
license=('GPL')
depends=('svn' 'root')
install='mafalda.install'
source=("svn+http://svn.cern.ch/guest/mafalda")

pkgver() { 
   cd $srcdir/mafalda 
    svnversion | tr -d [A-z]    
}

prepare() {
    msg "Applying Makefile patches"  
    cd $srcdir/mafalda/mafalda_framework
    patch < $srcdir/../mafalda_framework-Makefile.patch 
    cd $srcdir/mafalda/mpxdataconverter
    patch < $srcdir/../mpxdataconverter-Makefile.patch
}

build() {
	cd "$srcdir/mafalda/mafalda_framework"
	make
    cd "$srcdir/mafalda/mpxdataconverter"
    make
}

package() {
    mkdir -p $pkgdir/opt/mafalda/
    cp -r mafalda/mafalda_framework/* $pkgdir/opt/mafalda/
    mkdir -p $pkgdir/usr/bin/
    cp mafalda/mpxdataconverter/raw_to_pixeldm /$pkgdir/usr/bin/
    cp mafalda/mpxdataconverter/mpxdataconverter /$pkgdir/usr/bin/
}
md5sums=('SKIP')
