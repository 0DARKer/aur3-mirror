# Maintainer: Robert Holak <rholak@gmail.com>
pkgname=greyhole
pkgver=0.9.20
pkgrel=2
pkgdesc="Greyhole is an application that uses Samba to create a storage pool of all your available hard drives (whatever their size, however they're connected), and allows you to create redundant copies of the files you store, in order to prevent data loss when part of your hardware fails."
url="http://greyhole.net"
arch=('x86_64' 'i686')
license=('GPLv3')
depends=('php' 'samba' 'mysql' 'rsync' )
install='greyhole.install'
source=("https://github.com/downloads/gboudreau/Greyhole/${pkgname}-${pkgver}.tar.gz"
"greyhole.init")

md5sums=('0569712acca4161c9ea82ecac972c8f6'
         '685c78f4ca6c05312ad77cdcbcac6d0a')

build() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  GREYHOLE_INSTALL_DIR=`pwd`
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver}"
  GREYHOLE_INSTALL_DIR=`pwd`
  install -m 0755 -D -p greyhole $pkgdir/usr/bin/greyhole
  install -m 0755 -D -p greyhole-dfree $pkgdir/usr/bin/greyhole-dfree
  install -m 0750 -D -p greyhole-config-update $pkgdir/usr/bin/greyhole-config-update
  install -m 0644 -D -p logrotate.greyhole $pkgdir/etc/logrotate.d/greyhole
  install -m 0644 -D -p greyhole.cron.d $pkgdir/etc/cron.d/greyhole
  install -m 0644 -D -p greyhole.example.conf $pkgdir/etc/greyhole.conf
  install -m 0755 -D -p greyhole.cron.weekly $pkgdir/etc/cron.weekly/greyhole
  install -m 0755 -D -p greyhole.cron.daily $pkgdir/etc/cron.daily/greyhole
  install -m 0644 -D -p docs/greyhole.1.gz $pkgdir/usr/share/man/man1/greyhole.1.gz
  install -m 0644 -D -p docs/greyhole-dfree.1.gz $pkgdir/usr/share/man/man1/greyhole-dfree.1.gz
  install -m 0644 -D -p docs/greyhole.conf.5.gz $pkgdir/usr/share/man/man5/greyhole.conf.5.gz
  install -m 0644 -D -p samba-module/bin/3.6/greyhole-x86_64.so $pkgdir/usr/lib/samba/vfs/greyhole.so
  install -m 0755 -D -p $startdir/greyhole.init $pkgdir/etc/rc.d/greyhole
  install -m 0644 -D -p schema-mysql.sql $pkgdir/usr/share/greyhole/schema-mysql.sql
  install -m 0644 -D -p USAGE $pkgdir/usr/share/greyhole/USAGE
  mkdir -p $pkgdir/var/spool/greyhole
  chmod 777 $pkgdir/var/spool/greyhole
}

# vim:set ts=2 sw=2 et:
