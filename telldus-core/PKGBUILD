# Author: Andreas Johansson <stdin dot se>
# Maintainer: Olivier Biesmans <o dot archlinux at biesmans dot fr>
# Contributor: Peter Hultqvist <endnode dot se>
pkgname=telldus-core
pkgver=2.1.1
pkgrel=5
pkgdesc="TellStick application and library"
arch=('i686' 'x86_64' 'armv6h')
url="http://developer.telldus.se/wiki/TellStickInstallationSource"
license=('GPL2')
depends=('libftdi-compat' 'confuse')
makedepends=('gcc' 'make' 'cmake')
backup=('etc/tellstick.conf')
source=(
    http://download.telldus.se/TellStick/Software/$pkgname/$pkgname-$pkgver.tar.gz
    arch-config.patch
    arch-sbin-fix.patch
    telldusd
    telldus.service
    unistd-include.patch
    fix-cmake.patch
)
md5sums=(
    '5f1dfc03b500671caeb54bfa9f50b9ce'
    '86c42cd98dece16a9ad17eac2f2b3cb3'
    '49d8bef2c157dde2f222b7c46c6538fd'
    '53a57c8500f95482814e95a7e0226e29'
    '2c03c9a95afd4f694f3fed193b8f4811'
    '145389c5405261540b8522278616cc6f'
    'c510485c8b0c0fa1ff928b5638714140'
)

build()
{
    cd $srcdir/telldus-core-$pkgver/
    patch -p1 < $srcdir/arch-config.patch
    patch -p1 < $srcdir/arch-sbin-fix.patch
    patch -p1 < $srcdir/unistd-include.patch
    patch -p1 < $srcdir/fix-cmake.patch
    cmake -DCMAKE_INSTALL_PREFIX=/usr .
    make
    make DESTDIR="$pkgdir" install
    install -D -m0755 $srcdir/telldusd $pkgdir/etc/rc.d/telldusd || return 1
    install -D -m0755 $srcdir/telldus.service $pkgdir/etc/systemd/system/telldus.service || return 1
}
