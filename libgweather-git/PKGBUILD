# Maintainer: Yosef Or Boczko <yosefor3@walla.com>

_pkgname=libgweather
pkgname=$_pkgname-git
pkgver=20130320
pkgrel=1
pkgdesc="Provides access to weather information from the net"
arch=('i686' 'x86_64')
license=('LGPL')
depends=('libsoup-gnome' 'gnome-icon-theme' 'gtk3')
makedepends=('intltool' 'gtk-doc' 'gobject-introspection' 'gnome-common')
options=('!libtool' '!emptydirs')
url="http://www.gnome.org/"
conflicts=('libgweather')
replaces=('libgweather')
provides=('libgweather' 'libgweather=3.8.0')
install=libgweather.install

_gitroot=http://git.gnome.org/browse/libgweather
_gitname=libgweather

build() {
	cd $srcdir
	msg "Connecting to GIT server...."

	if [ -d $srcdir/$_gitname ] ; then
		cd $_gitname && git pull origin
		msg "The local files are updated."
	else
		git clone $_gitroot
		
		cd $_gitname
		
		git branch gnome-3-8
		
		cd ..
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	rm -rf "$srcdir/$_gitname-build"
	cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
	cd "$srcdir/$_gitname-build"

    ./autogen.sh --prefix=/usr --sysconfdir=/etc \
        --localstatedir=/var --disable-static \
        --enable-locations-compression --enable-gtk-doc
    make
}

package() {
    cd "$srcdir/$_gitname-build"
    make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="$pkgdir" install
    rm -rf "$srcdir/$_gitname-build"
}
