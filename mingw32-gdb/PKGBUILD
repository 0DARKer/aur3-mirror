# $Id:$
# Adapted from standard gdb package 
# Maintainer: Alexander 'hatred' Drozdov <adrozdoff@gmail.com>

pkgname=mingw32-gdb
pkgver=7.3.1
pkgrel=2
pkgdesc="The GNU Debugger for mingw32 target"
arch=('i686' 'x86_64')
url="http://www.gnu.org/software/gdb/"
license=('GPL3')
depends=('readline' 'expat' 'python2')
makedepends=('texinfo')
options=('!libtool')
source=(http://ftp.gnu.org/gnu/gdb/gdb-${pkgver}.tar.bz2)
md5sums=('b89a5fac359c618dda97b88645ceab47')

build() {
  cd ${srcdir}/gdb-${pkgver}

  unset LDFLAGS

  ./configure --prefix=/usr \
  --target=i486-mingw32 \
    --host=$CHOST \
    --build=$CHOST \
    --disable-nls \
    --enable-shared

  make || return 1
}

package() {
  cd ${srcdir}/gdb-${pkgver}
  make DESTDIR=${pkgdir} install || return 1

  # resolve conflicts with binutils / remove unneeded files
  rm -f  ${pkgdir}/usr/include/{bfd,dis-asm,symcat,ansidecl,bfdlink}.h
  rm -f  ${pkgdir}/usr/lib/{libiberty,libbfd,libopcodes}.a
  rm -rf ${pkgdir}/usr/share/info
  rm -rf ${pkgdir}/usr/share/gdb/syscalls
  rm -rf ${pkgdir}/usr/share/gdb/syscalls
  rm -rf ${pkgdir}/usr/share/gdb/python
  rm -rf ${pkgdir}/usr/i686-pc-linux-gnu/i486-mingw32
  rm -rf ${pkgdir}/usr/x86_64-unknown-linux-gnu/i486-mingw32
}
