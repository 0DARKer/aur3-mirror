# Maintainer: György Balló <ballogy@freestart.hu>
_pkgname=gwibber
pkgname=$_pkgname-bzr
pkgver=946
pkgrel=1
pkgdesc="An open source microblogging client for GNOME"
arch=('any')
url="http://gwibber.com/"
license=('GPL')
depends=('dbus-python>=0.80.2' 'python2-feedparser>=4.1' 'python2-gconf>=2.18.0' 'python2-libgnome>=2.18.0' 'python-gnomekeyring' 'python2-gtkspell' 'python-notify>=0.1.1' 'python-wnck' 'python-mako>=0.2.2' 'python-egenix-mx-base>=3.0.0' 'python2-oauth' 'python-imaging>=1.1.6' 'python-pycurl' 'python-simplejson>=1.9.1' 'pywebkitgtk>=1.0.1' 'pyxdg>=0.15' 'gnome-keyring')
makedepends=('bzr' 'python-distutils-extra')
optdepends=('indicator-application: indicator support'
            'libindicate: integrate to Message Menu')
provides=('gwibber')
conflicts=('gwibber')
options=(!emptydirs)

_bzrtrunk="lp:gwibber"
_bzrmod="gwibber"

build() {
  cd "$srcdir"
  msg "Connecting to Bazaar server...."

  if [ -d $_bzrmod ] ; then
    cd ${_bzrmod} && bzr pull ${_bzrtrunk} -r ${pkgver}
    msg "The local files are updated."
  else
    bzr branch ${_bzrtrunk} ${_bzrmod} -q -r ${pkgver}
  fi

  msg "Bazaar checkout done or server timeout"
  msg "Starting make..."

  rm -rf "$srcdir/$_bzrmod-build"
  cp -r "$srcdir/$_bzrmod" "$srcdir/$_bzrmod-build"
  cd "$srcdir/$_bzrmod-build"

  #
  # BUILD HERE
  #

  find . -type f | xargs sed -i 's@^#!.*python$@#!/usr/bin/python2@'

  python2 setup.py build
}

package() {
  cd "$srcdir/$_bzrmod-build"

  python2 setup.py install --root=$pkgdir/ --optimize=1
}
