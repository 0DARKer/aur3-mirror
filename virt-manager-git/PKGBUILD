# Maintainer: Patryk Kowalczyk <patryk at kowalczyk dot ws> 

pkgname=virt-manager-git
_pkgname=virt-manager
pkgver=20130516
pkgrel=2
pkgdesc="A desktop user interface for managing virtual machines."
arch=('any')
url="http://virt-manager.et.redhat.com"
license=('GPL')
depends=('dbus-python' 'libvirt' 'libxml2' 'vte' 'gtk-vnc' 'rarian' 'gconf'
         'yajl' 'librsvg' 'python2' 'python2-gconf' 'spice' 'python2-ipaddr' 'spice-gtk')
makedepends=('gnome-doc-utils' 'intltool>=0.35.0' 'git')
optdepends=('x11-ssh-askpass: for ssh authentication to remote servers'
            'libuser: for virt-manager-tui'
            'python2-ipy: for virt-manager-tui'
            'newt-syrup: for virt-manager-tui')
install=virt-manager.install
conflicts=('virt-manager' 'virtinst')
provides=('virt-manager')

_gitroot=git://git.fedorahosted.org/git/virt-manager.git
_gitname=virt-manager

build() {
  cd $srcdir

  msg "Connecting to GIT server...."
  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."
  rm -rf "$srcdir/$_gitname-build" | return 0 
  cp -rp "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  
  cd $srcdir/$_gitname-build
  export LDFLAGS=-lX11
  find . -type f | xargs sed -i 's:/usr/bin/python:/usr/bin/python2.7:'
}

package() {
  cd "$srcdir/$_gitname-build"
  python2.7 setup.py install --root="$pkgdir"
}
