# Maintainer: Mariano Street <mstreet@kde.org.ar>

pkgname=scope-git
_basename=scope
pkgver=20110516
pkgrel=1
pkgdesc='Lightweight Qt-based file manager from the Sapphire desktop environment'
arch=(i686 x86_64)
url="http://gitorious.org/delphos/$_basename"
license=('GPL3')
groups=('sapphire')
depends=('qt')
makedepends=('qt' 'git')
optdepends=('sapphire-desktop: innovative and usability-oriented desktop environment'
            'lcl: Live Command Line for managing Scope')
provides=('scope')

_gitroot="git://gitorious.org/delphos/$_basename.git"
_gitname="$_basename"

build ()
{
    cd "$srcdir"
    msg 'Connecting to GIT server....'
    
    if [ -d $_gitname ]; then
        cd $_gitname && git pull origin
        msg 'The local files are updated.'
    else
        git clone $_gitroot $_gitname
    fi
    
    msg 'GIT checkout done or server timeout.'
    msg 'Starting make...'
    
    rm -rf "$srcdir/$_gitname-build"
    git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
    cd "$srcdir/$_gitname-build"
    
    sed -i "s|QDir::currentPath() + \"/data|\"/usr/share/$_basename|" source/defaults.hpp
    qmake
    make
}

package ()
{
    cd "$srcdir/$_gitname-build"
    mkdir -p "$pkgdir/usr/bin" "$pkgdir/usr/share/$_basename"
    cp scope "$pkgdir/usr/bin"
    cp data/systemdirs.data "$pkgdir/usr/share/$_basename"
} 
