# Maintainer: Simon Thorpe <simon@hivetechnology.com.au>
pkgname=openmpt
pkgver=1.24.01.00
pkgrel=2
pkgdesc="Audio module tracker formerly known as ModPlug Tracker"
arch=('x86_64')
url="http://openmpt.org/"
license=('custom')
depends=('wine-mono' 'wine_gecko')
makedepends=('gendesk' 'imagemagick')
source=('http://sagamusix.de/openmpt/download/OpenMPT-1.24.01.00-x64.zip')
sha256sums=('3332b0eb0a4c5c8f5431840ed537f81f47861a57f4151ebb5b2d2d3fc496cd1d')

prepare(){
  convert "$srcdir/OpenMPT-$pkgver/mpt.ico" "$srcdir/icon.png"
  gendesk -n --pkgname "$pkgname" --pkgdesc "$pkgdesc" \
    --name='OpenMPT' \
    --categories 'Audio;Sequencer;Midi;AudioVideoEditing;Music;AudioVideo;'
}

package(){
  mkdir -p $pkgdir/usr/share
  mkdir -p $pkgdir/usr/bin
  cp -R $srcdir/OpenMPT-$pkgver $pkgdir/usr/share/openmpt
  echo -e '#!/bin/bash\nwine /usr/share/openmpt/mptrack.exe "$@"' >$pkgdir/usr/bin/openmpt
  chmod +x $pkgdir/usr/bin/openmpt
  install -Dm644 "$srcdir/icon-2.png" "$pkgdir/usr/share/pixmaps/$pkgname.png"
  install -Dm644 "$pkgname.desktop" "$pkgdir/usr/share/applications/$pkgname.desktop"
}
