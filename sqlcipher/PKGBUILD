pkgname=sqlcipher
pkgver=2.1.1
pkgrel=1
pkgdesc="SQLCipher is an SQLite extension that provides transparent 256-bit AES encryption of database files."
arch=('i686' 'x86_64')
url="http://sqlcipher.net/"
license=('BSD')
depends=()
makedepends=('tcl' 'openssl' 'sqlite3')
# if you dont apply the patches sqlcipher acts as drop-in replacement for sqlite3
#replaces=('sqlite3')
source=("$pkgname-v$pkgver.tar.gz::https://github.com/sqlcipher/sqlcipher/tarball/v$pkgver" "Makefile.in.patch" "sqlite3.pc.in.patch")

noextract=()
md5sums=('c80e1cfcbd5836bdbf2ce35a38cacb83'
         '6be4bb76dbd3bd9224bf642bc571edc9'
         '3034075dedf9dfe43c4dabbbe5d0d9f5')

build() {
    cd "$srcdir/sqlcipher-sqlcipher-ee2ce3e"
    patch -p 0 < "$startdir/Makefile.in.patch" || return 1
    patch -p 0 < "$startdir/sqlite3.pc.in.patch" || return 1
    # static linking
    #./configure --prefix=/usr --disable-tcl --enable-tempstore=yes CFLAGS="-DSQLITE_HAS_CODEC" LDFLAGS="/usr/lib/libcrypto.a"
    # dynamic linking
    ./configure --prefix=/usr --disable-tcl --enable-tempstore=yes CFLAGS="-DSQLITE_HAS_CODEC" LDFLAGS="-lcrypto"
    make
}

package() {
    cd "$srcdir/sqlcipher-sqlcipher-ee2ce3e"

    make DESTDIR="$pkgdir/" install
    install -D -m 0644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
} 
