# Contributor: Zephyr
# Contributor: favadi
pkgname=vba-m-gtk-svn
pkgver=1030
pkgrel=1
pkgdesc="Gameboy Advance Emulator combining features of all VBA forks - GTK GUI"
arch=(i686 x86_64)
url="http://vba-m.ngemu.com"
license=('GPL')
groups=()
depends=('gtkmm' 'sdl' 'glibmm' 'libpng' 'zlib' 'cairo' 'mesa' 'gtkglext' 'gtkglextmm' 'libxv' 'hicolor-icon-theme' 'ffmpeg')
makedepends=('cmake' 'pkgconfig' 'nasm' 'subversion')
source=('gvbam-linking.patch')
install='vba-m-gtk.install'
md5sums=('9332539870bedf4c7488c5196e90b0c6')

_svntrunk=https://vbam.svn.sourceforge.net/svnroot/vbam/trunk
_svnmod=vbam
_svndep=https://vbam.svn.sourceforge.net/svnroot/vbam/dependencies

build() {
 cd ${srcdir}
 
   if [ -d $_svnmod/.svn ]; then
     (cd $_svnmod && svn up -r $pkgver)
   else
     svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
     svn co $_svndep --config-dir ./
   fi
               
   msg "SVN checkout done or server timeout"
   msg "Starting make..."
                   
  cp -r $_svnmod $_svnmod-build
  cp -r dependencies/fex $_svnmod-build/
  cd $_svnmod-build
  
  patch -Np1 -i ${srcdir}/gvbam-linking.patch

  cmake . -DCMAKE_INSTALL_PREFIX=/usr -DDATA_INSTALL_DIR:PATH=share/vbam/gtk -DENABLE_WX=OFF
  make
}

package() {
  cd $_svnmod-build
  make DESTDIR=${pkgdir} install

  rm -rf ${srcdir}/$_svnmod-build
}
