#!/bin/bash

# arg 1:  the new package version
pre_install() {
	# Remove any old location work dirs
	while mountpoint -q lib/splash/cache &&	umount -l lib/splash/cache; do :; done
	rm -rf lib/splash/cache/arch-banner-*
}

# arg 1:  the new package version
# arg 2:  the old package version
pre_upgrade() {
	pre_install
}

# arg 1:  the new package version
post_install() {
	echo "> ---------------------------------------------------------------------------"
	echo "> Configuration: /etc/splash/arch-banner-icons/icons.conf"
	post_upgrade "$1"
}

# arg 1:  the new package version
# arg 2:  the old package version
post_upgrade() {
	# Unmount any stale theme cache tmpfs and install dummy icons
	# needed to silence fbcondecor_helper when not using SPLASH_DAEMON=early
	# and splash daemon when theme hook scripts not supported.
	# This also removes any old crap in the working directory.
	for theme in etc/splash/arch-banner-*; do
		SPLASH_THEME=${theme##*/} etc/splash/arch-banner-icons/scripts/cache-icons install
	done

	post_remove "$2"
}

# arg 1:  the old package version
pre_remove() {
	for theme in etc/splash/arch-banner-*; do
		SPLASH_THEME=${theme##*/} etc/splash/arch-banner-icons/scripts/cache-icons uninstall
	done

	pre_install
}

# arg 1:  the old package version
post_remove() {
	echo "> ---------------------------------------------------------------------------"
	echo "> Remember to rebuild the initcpio (if any) !"
	echo "> ---------------------------------------------------------------------------"
}

