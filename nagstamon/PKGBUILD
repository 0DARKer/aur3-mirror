pkgname=nagstamon
pkgver=0.9.5_rc1
_pkgver=${pkgver/_/-}
pkgrel=2
pkgdesc="Nagstamon is a Nagios status monitor for the desktop"
arch=('i686' 'x86_64')
url="http://nagstamon.sourceforge.net"
license=('GPL')
depends=('python2' 'pygtk' 'gnome-python-extras' 'python-lxml' 'python-rsvg' 'python2-distribute')
makedepends=('deb2targz')
source=("http://downloads.sourceforge.net/project/nagstamon/nagstamon/$pkgname%200.9.5%20RC1/${pkgname}_${_pkgver}_all.deb" 'nagstamon.desktop' 'nagstamon-rc.patch')
md5sums=('2a2ceae4c47cee3ddf1102fc1cdccf79'
         '18c28fc3f5eeeeb333621b54cacd0654'
         '0323a209d6d2b92df64fde7651e8a58d')

build() {
  cd $srcdir
  deb2targz ${pkgname}_${_pkgver}_all.deb
  tar -zxvf $srcdir/${pkgname}_${_pkgver}_all.tar.gz
  patch -p1 -d $srcdir/usr/share/nagstamon -i $srcdir/nagstamon-rc.patch

  mkdir -p $pkgdir/usr/bin
  ln -s /usr/share/nagstamon/nagstamon.py $pkgdir/usr/bin/nagstamon
  mkdir $pkgdir/usr/share
  cp -R $srcdir/usr/share/nagstamon $pkgdir/usr/share/
  install -D -m644 ${srcdir}/nagstamon.desktop $pkgdir/usr/share/applications/nagstamon.desktop
  install -D -m644 ${srcdir}/nagstamon.desktop $pkgdir/etc/xdg/autostart/nagstamon.desktop

  sed -i 's|/usr/bin/python|/usr/bin/env python2|' $pkgdir/usr/share/nagstamon/nagstamon.py
}
