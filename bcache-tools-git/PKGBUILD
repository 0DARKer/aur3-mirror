# Maintainer: bobpaul (bobpaul on archlinux forumsBoohbah <boohbah at gmail.com>)

pkgname=bcache-tools-git
pkgver=20130310
pkgrel=1
pkgdesc="Userspace tools for bcache until bcache merges with either dm or md"
changelog=bcache-tools.changelog
arch=('i686' 'x86_64')
url="http://bcache.evilpiepirate.org/"
license=('GPL')
makedepends=('git')
conflicts=()
source=('initcpio-arch.patch')
md5sums=('551b896e4bd67c9c146bf2ae5d5fe7b3')
sha256sums=('219099be1ce4692d2a19a23a710fa7bab3baaa14ba6f655f27fa1cb74808de06')
_gitroot="http://evilpiepirate.org/git/bcache-tools.git"
_gitname=bcache-tools

build() {
  cd "$srcdir"
  msg "Connecting to GIT server...."

  if [[ -d "$_gitname" ]]; then
    cd "$_gitname" && git pull origin
    msg "The local files are updated."
  else
    git clone "$_gitroot" "$_gitname"
  fi

  msg "GIT checkout done or server timeout"
  msg "Starting build..."

  rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
  cd "$srcdir/$_gitname-build"
  patch -Np1 -i "${srcdir}/../initcpio-arch.patch"
  make
}

package() {
  cd "$srcdir/$_gitname-build"
  #TODO: do I really need to mkdir? or am I missing something?
  mkdir ${pkgdir}/sbin
  mkdir -p ${pkgdir}/usr/sbin
  mkdir -p ${pkgdir}/lib/udev/rules.d
  mkdir -p ${pkgdir}/usr/share/man/man8
  mkdir -p ${pkgdir}/usr/lib/initcpio/{hooks,install}

  make DESTDIR="${pkgdir}" install
}

# vim:set ts=2 sw=2 et:
