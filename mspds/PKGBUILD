# Maintainer: Your Name <youremail@domain.com>
pkgname=mspds
pkgver=h
pkgrel=1
pkgdesc="MSP430 Debug Stack. Contains a dynamic link library as well as embedded firmware that runs on the MSP-FET430UIF or the eZ430 emulators."
arch=('i686' 'x86_64')
url="http://processors.wiki.ti.com/index.php/MSPDS_Open_Source_Package"
license=('custom:TI Open Source')
group=('msp430')
depends=('hidapi-git' 'boost')
makedepends=('unzip')
optdepends=('mspdebug-git')

#this has to be downloaded manually because ti returns a 403 if the normal wget/curl user agent is sent
file_name="slac460.zip"
manual_source="http://www-s.ti.com/sc/techzip/$file_name"
user_agent="Mozilla/4.0"

prepare() {
	wget $manual_source --user-agent="$user_agent" -O $file_name #this has to be downloaded manually because ti is annoying with wget
	unzip $file_name -d "$srcdir"
	
	#According to the readme we need to handhold it and move libhidapi to these folders
	mkdir "$srcdir/MSPDebugStack_OS_Package/ThirdParty/include"
	ln -s /usr/include/hidapi/hidapi.h "$srcdir/MSPDebugStack_OS_Package/ThirdParty/include/"
	mkdir "$srcdir/MSPDebugStack_OS_Package/ThirdParty/lib"
	ln -s /usr/lib/libhidapi-libusb.so "$srcdir/MSPDebugStack_OS_Package/ThirdParty/lib/hid-libusb.o"
}

build() {
	cd "$srcdir/MSPDebugStack_OS_Package"
	
	make
}

package() {
	cd "$srcdir/MSPDebugStack_OS_Package"
	
	mkdir -p ${pkgdir}/usr/lib/
	cp libmsp430.so ${pkgdir}/usr/lib/
}