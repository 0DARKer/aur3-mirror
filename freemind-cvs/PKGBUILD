# Contributor: Archie <Mymaud@gmail.com>
# Contributor: giniu <gginiu@gmail.com>
# Maintainer: Stefan Husmann <stefan-husmann@t-online.de>

pkgname=freemind-cvs
pkgver=20110109
pkgrel=1
pkgdesc="Free mind-mapping software written in Java - CVS sources"
depends=('java-runtime' 'bash')
makedepends=('apache-ant' 'cvs')
conflicts=('freemind' 'freemind-unstable')
provides=('freemind=0.9.0RC8')
arch=('any')
license=('GPL')
source=("$pkgname.sh"
        "$pkgname.png"
        "$pkgname.desktop")
md5sums=('f85e9fc62fff68eb7d31d24c147849f5'
         '92e7ccb968dbe04e0c5acb3352c4847e'
         '11d249d6c4443a6fab4740b22c140261')
url="http://freemind.sourceforge.net/wiki/index.php/Main_Page"
provides="freemind-unstable"
conflicts="freemind-unstable"

_cvsroot=":pserver:anonymous@freemind.cvs.sourceforge.net/cvsroot/freemind"
_cvsmod="freemind"
_cvstag="fm_060405_integration"

build() {
  install -d ${pkgdir}/usr/share/java/$pkgname
  install -d ${pkgdir}/usr/share/{applications,pixmaps}
  install -d ${pkgdir}/usr/bin

  cd "$srcdir"
  msg "Connecting to $_cvsmod.sourceforge.net CVS server...."
  if [ -d $_cvsmod/CVS ]; then
    cd $_cvsmod
    cvs -z3 update -d -r $_cvstag
  else
    cvs -z3 -d $_cvsroot co -D $pkgver -r $_cvstag -f $_cvsmod
    cd $_cvsmod
  fi

  msg "CVS checkout done or server timeout"
  msg "Starting make..."
  
  rm -rf "$srcdir/$_cvsmod-build"
  cp -r "$srcdir/$_cvsmod" "$srcdir/$_cvsmod-build"
  cd "$srcdir/$_cvsmod-build"

  /usr/share/java/apache-ant/bin/ant dist
  /usr/share/java/apache-ant/bin/ant post
}
package() {
	    
  cd ${srcdir}/
  cp -r bin/* ${pkgdir}/usr/share/java/$pkgname/
  chmod 755 ${pkgdir}/usr/share/java/$pkgname/dist/freemind.sh 
  install -D -m755 $pkgname.sh ${pkgdir}/usr/bin/freemind
  install -D -m644 $pkgname.png ${pkgdir}/usr/share/pixmaps
  install -D -m644 $pkgname.desktop ${pkgdir}/usr/share/applications
  rm $pkgdir/usr/share/java/freemind-cvs/dist/FreeMind.exe
}
