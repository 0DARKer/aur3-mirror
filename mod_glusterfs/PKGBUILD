# Contributor: Chris Tusa <linisys@gmail.com>  IRC - sharkoslinux
pkgname=mod_glusterfs
pkgver=1.4.0rc7
pkgrel=1
pkgdesc="Apache module utilizing libglusterfsclient. Provides high speed access to glusterfs, bypassing the FUSE layer to avoid filesystem context switches."
arch=('i686' 'x86_64')
url="http://www.gluster.org/"
license=('GPL3')
groups=('clustering')
depends=('glusterfs' 'apache')
makedepends=('flex' 'bison')
provides=()
conflicts=()
replaces=()
options=()
install=
source=(glusterfs-$pkgver.tar.gz mod_glusterfs.conf)
backup=('/etc/httpd/conf/extra/mod_glusterfs.conf')
noextract=()

md5sums=('7ab3176a880dd719e40919869236f158'
         '99933a2b69660a0147aeb52be79db4c0')

build() {


  cd "$srcdir/glusterfs-${pkgver}"

  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var \
	--enable-mod_glusterfs --with-apxs=/usr/sbin
  make || return 1
  make DESTDIR="$pkgdir" install

  rm -r ${pkgdir}/etc/glusterfs
  mkdir -p ${pkgdir}/etc/httpd/conf/extra ${pkgdir}/etc/httpd/modules
  install -m 755 ${pkgdir}/usr/lib/glusterfs/1.4.0rc7/apache/2.2/mod_glusterfs.so ${pkgdir}/etc/httpd/modules/mod_glusterfs.so

  # Cleanup GlusterFS build, we dont want the whole thing, just the module
  rm -r ${pkgdir}/sbin
  rm -r ${pkgdir}/var
  rm -r ${pkgdir}/usr

  mkdir -p ${pkgdir}/usr/lib/httpd/modules
  mv ${pkgdir}/etc/httpd/modules/mod_glusterfs.so ${pkgdir}/usr/lib/httpd/modules/mod_glusterfs.so

  install -m 644 ${srcdir}/mod_glusterfs.conf ${pkgdir}/etc/httpd/conf/extra

}

# vim:set ts=2 sw=2 et:
