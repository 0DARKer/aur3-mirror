diff -ruN stardict-tools-3.0.1-orig//src/bgl_babylon.cpp stardict-tools-3.0.1/src/bgl_babylon.cpp
--- stardict-tools-3.0.1-orig//src/bgl_babylon.cpp	2007-08-16 07:14:35.000000000 +0200
+++ stardict-tools-3.0.1/src/bgl_babylon.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -24,6 +24,7 @@
 #include<stdio.h>
 #include <glib/gstdio.h>
 #include <iconv.h>
+#include <cstring>
 
 #ifdef _WIN32
 #include <io.h>
diff -ruN stardict-tools-3.0.1-orig//src/bgl_stardictbuilder.cpp stardict-tools-3.0.1/src/bgl_stardictbuilder.cpp
--- stardict-tools-3.0.1-orig//src/bgl_stardictbuilder.cpp	2007-09-05 05:48:06.000000000 +0200
+++ stardict-tools-3.0.1/src/bgl_stardictbuilder.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -22,6 +22,7 @@
 
 #include <iostream>
 #include <glib.h>
+#include <cstring>
 
 StarDictBuilder::StarDictBuilder( std::string filename )
 {
diff -ruN stardict-tools-3.0.1-orig//src/bgl2txt.cpp stardict-tools-3.0.1/src/bgl2txt.cpp
--- stardict-tools-3.0.1-orig//src/bgl2txt.cpp	2007-08-01 05:00:02.000000000 +0200
+++ stardict-tools-3.0.1/src/bgl2txt.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -1,4 +1,6 @@
 #include "libbgl2txt.h"
+#include <cstring>
+#include <stdio.h>
 
 int main(int argc, char * argv[])
 {
diff -ruN stardict-tools-3.0.1-orig//src/dictbuilder.cpp stardict-tools-3.0.1/src/dictbuilder.cpp
--- stardict-tools-3.0.1-orig//src/dictbuilder.cpp	2007-07-10 09:16:06.000000000 +0200
+++ stardict-tools-3.0.1/src/dictbuilder.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -5,6 +5,7 @@
 #include <list>
 #include <string>
 #include <vector>
+#include <cstring>
 
 #include <libgen.h>
 #include <glib.h>
diff -ruN stardict-tools-3.0.1-orig//src/KangXi.cpp stardict-tools-3.0.1/src/KangXi.cpp
--- stardict-tools-3.0.1-orig//src/KangXi.cpp	2007-07-10 09:16:06.000000000 +0200
+++ stardict-tools-3.0.1/src/KangXi.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -57,7 +57,7 @@
 	gchar utf8[7];
 	gint n = g_unichar_to_utf8(uc, utf8);
 	utf8[n] = '\0';
-	char *p;
+	const char *p;
 	p = strchr(line, '\t');
 	if (!p) {
 		g_print("Error: %s\n", line);
diff -ruN stardict-tools-3.0.1-orig//src/libbgl2txt.cpp stardict-tools-3.0.1/src/libbgl2txt.cpp
--- stardict-tools-3.0.1-orig//src/libbgl2txt.cpp	2007-08-01 05:01:10.000000000 +0200
+++ stardict-tools-3.0.1/src/libbgl2txt.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -1,6 +1,7 @@
 #include "libbgl2txt.h"
 #include "bgl_babylonreader.h"
 #include "bgl_stardictbuilder.h"
+#include <cstring>
 
 void convert_bglfile(std::string infile, std::string source_charset, std::string target_charset)
 {
diff -ruN stardict-tools-3.0.1-orig//src/Makefile.am stardict-tools-3.0.1/src/Makefile.am
--- stardict-tools-3.0.1-orig//src/Makefile.am	2007-11-07 08:55:24.000000000 +0100
+++ stardict-tools-3.0.1/src/Makefile.am	2010-03-21 21:47:45.000000000 +0100
@@ -216,7 +216,7 @@
 
 bgl2txt_DEPENDENCIES = libbgl2txt.a
 bgl2txt_LDFLAGS =
-bgl2txt_LDADD = $(STARDICT_LIBS) -lz libbgl2txt.a
+bgl2txt_LDADD = $(STARDICT_LIBS) libbgl2txt.a -lz
 bgl2txt_SOURCES = bgl2txt.cpp
 
 stardict_verify_LDFLAGS =
@@ -225,7 +225,7 @@
 
 stardict_editor_DEPENDENCIES = libbgl2txt.a
 stardict_editor_LDFLAGS =
-stardict_editor_LDADD = $(STARDICT_LIBS) -lz libbgl2txt.a
+stardict_editor_LDADD = $(STARDICT_LIBS) libbgl2txt.a -lz
 stardict_editor_SOURCES = stardict-editor.cpp libtabfile.cpp libtabfile.h libcommon.cpp libcommon.h libbabylonfile.cpp libbabylonfile.h libstardict2txt.cpp libstardict2txt.h libstardictverify.cpp libstardictverify.h
 
 EXTRA_DIST = example.ifo example_treedict.tar.bz2 hanzim2dict.py jm2stardict.py uyghur2dict.py ncce2stardict.pl parse-oxford.perl dictgen.php DeKDic.exe KSDrip.exe Po2Tab.zip dictd2dic.sh ooo.sh myspell.sh exc.sh i2e.sh dictbuilder.readme dictbuilder.example KangXiZiDian-djvu2tiff.py \
diff -ruN stardict-tools-3.0.1-orig//src/Makefile.in stardict-tools-3.0.1/src/Makefile.in
--- stardict-tools-3.0.1-orig//src/Makefile.in	2007-11-07 08:55:32.000000000 +0100
+++ stardict-tools-3.0.1/src/Makefile.in	2010-03-21 21:47:45.000000000 +0100
@@ -748,14 +748,14 @@
 wordnet_SOURCES = wordnet.cpp
 bgl2txt_DEPENDENCIES = libbgl2txt.a
 bgl2txt_LDFLAGS = 
-bgl2txt_LDADD = $(STARDICT_LIBS) -lz libbgl2txt.a
+bgl2txt_LDADD = $(STARDICT_LIBS) libbgl2txt.a -lz
 bgl2txt_SOURCES = bgl2txt.cpp
 stardict_verify_LDFLAGS = 
 stardict_verify_LDADD = $(STARDICT_LIBS)
 stardict_verify_SOURCES = stardict_verify.cpp libstardictverify.cpp libstardictverify.h libcommon.cpp libcommon.h
 stardict_editor_DEPENDENCIES = libbgl2txt.a
 stardict_editor_LDFLAGS = 
-stardict_editor_LDADD = $(STARDICT_LIBS) -lz libbgl2txt.a
+stardict_editor_LDADD = $(STARDICT_LIBS) libbgl2txt.a -lz
 stardict_editor_SOURCES = stardict-editor.cpp libtabfile.cpp libtabfile.h libcommon.cpp libcommon.h libbabylonfile.cpp libbabylonfile.h libstardict2txt.cpp libstardict2txt.h libstardictverify.cpp libstardictverify.h
 EXTRA_DIST = example.ifo example_treedict.tar.bz2 hanzim2dict.py jm2stardict.py uyghur2dict.py ncce2stardict.pl parse-oxford.perl dictgen.php DeKDic.exe KSDrip.exe Po2Tab.zip dictd2dic.sh ooo.sh myspell.sh exc.sh i2e.sh dictbuilder.readme dictbuilder.example KangXiZiDian-djvu2tiff.py \
 extractKangXi.py makevietdict.py mkguangyunst.py stmerge.py lingea-trd-decoder.py
diff -ruN stardict-tools-3.0.1-orig//src/tabfile2sql.cpp stardict-tools-3.0.1/src/tabfile2sql.cpp
--- stardict-tools-3.0.1-orig//src/tabfile2sql.cpp	2007-08-15 07:56:06.000000000 +0200
+++ stardict-tools-3.0.1/src/tabfile2sql.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -4,6 +4,7 @@
 #include <sys/stat.h>
 #include <unistd.h>
 #include <glib.h>
+#include <cstring>
 
 #include <mysql.h>
 
diff -ruN stardict-tools-3.0.1-orig//src/Unihan.cpp stardict-tools-3.0.1/src/Unihan.cpp
--- stardict-tools-3.0.1-orig//src/Unihan.cpp	2007-07-10 09:16:06.000000000 +0200
+++ stardict-tools-3.0.1/src/Unihan.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -57,13 +57,14 @@
 	}
 	const char *han = line+2;
 
-	char *p;
+	const char *p;
 	p = strchr(han, '\t');
 	if (!p) {
 		g_print("Error: %s\n", line);
 		return;
 	}
-	*p = '\0';
+	std::string han_s(han, p - han);
+	//*p = '\0';
 	p++;
 	const char *key = p;
 
@@ -72,18 +73,19 @@
 		g_print("Error: %s\n", line);
 		return;
 	}
-	*p = '\0';
+	std::string key_s(key, p - key);
+	//*p = '\0';
 	p++;
 	const char *def = p;
 
-	std::map<std::string, std::list<std::pair<std::string, std::string> > >::iterator iter = unihan_map.find(han);
+	std::map<std::string, std::list<std::pair<std::string, std::string> > >::iterator iter = unihan_map.find(han_s);
 	if (iter == unihan_map.end()) {
 		std::list<std::pair<std::string, std::string> > han_list;
-		han_list.push_back(std::pair<std::string, std::string>(key, def));
-		unihan_map[han] = han_list;
+		han_list.push_back(std::pair<std::string, std::string>(key_s, def));
+		unihan_map[han_s] = han_list;
 	} else {
 		std::list<std::pair<std::string, std::string> > &han_list = iter->second;
-		han_list.push_back(std::pair<std::string, std::string>(key, def));
+		han_list.push_back(std::pair<std::string, std::string>(key_s, def));
 	}
 }
 
diff -ruN stardict-tools-3.0.1-orig//src/wordnet.cpp stardict-tools-3.0.1/src/wordnet.cpp
--- stardict-tools-3.0.1-orig//src/wordnet.cpp	2007-09-10 09:49:15.000000000 +0200
+++ stardict-tools-3.0.1/src/wordnet.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -2,6 +2,7 @@
 #include <stdlib.h>
 #include <glib.h>
 #include <string> 
+#include <cstring>
 
 
 static int hexalpha_to_int(int c)
diff -ruN stardict-tools-3.0.1-orig//src/wubi.cpp stardict-tools-3.0.1/src/wubi.cpp
--- stardict-tools-3.0.1-orig//src/wubi.cpp	2007-07-10 09:16:06.000000000 +0200
+++ stardict-tools-3.0.1/src/wubi.cpp	2010-03-21 21:47:45.000000000 +0100
@@ -5,6 +5,7 @@
 #include <unistd.h>
 #include <glib.h>
 #include <string>
+#include <cstring>
 
 void convert(const char *filename)
 {
