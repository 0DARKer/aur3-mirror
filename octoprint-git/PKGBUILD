# Contributor: feilen <feilen1000@gmail.com>

pkgname=octoprint-git
pkgver=20130316
pkgrel=1
pkgdesc="OctoPrint provides a responsive web interface for controlling a 3D printer (RepRap, Ultimaker, ...)"
arch=('i686' 'x86_64' 'armv6')
url="https://github.com/foosel/OctoPrint"
license=('GPL')
depends=( 'python2-flask' 'python2-numpy' 'python2-pyserial' 'python2-tornado' 'python2-tornadio2' 'python2-yaml' )
makedepends=( 'git' )
# No package for MJPG-Streamer yet. Perhaps make one?
optdepends=( 
	'ffmpeg: timelapse support' )
provides=( 'octoprint' )
conflicts=( 'octoprint' )
source=(octoprint.config
	octoprint.run
	octoprint.service)
md5sums=('df8a69bae5ff012274504b3dd6a43230'
         '3bee9901c9eabed94b7f9236f83bf053'
         '5c361350d5f9e40c3172673a801c2f68')

_gitroot="https://github.com/foosel/OctoPrint.git"
_gitbranch="master" # Use devel branch until daemon options are merged upstream
_gitname="octoprint"

build() {
	cd ${srcdir}

	msg "Connecting to git server..."
	if [[ -d ${_gitname} ]]; then
		(cd ${_gitname} && git pull origin)
	else
		git clone -b ${_gitbranch} ${_gitroot} ${_gitname}
	fi
	msg "Git checkout done or server timeout"
}

package() {
	cd ${srcdir}/${_gitname}

	mkdir -p ${pkgdir}/usr/share/octoprint/

	cp -a ${srcdir}/${_gitname}/* ${pkgdir}/usr/share/octoprint/

	install -D -m644 ${srcdir}/octoprint.config ${pkgdir}/etc/octoprint.conf
	install -D -m755 ${srcdir}/octoprint.run ${pkgdir}/usr/bin/octoprint
	install -D -m644 ${srcdir}/octoprint.service ${pkgdir}/usr/lib/systemd/system/octoprint.service
}
