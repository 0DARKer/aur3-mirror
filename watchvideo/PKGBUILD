# Maintainer: archtux <antonio.arias99999@gmail.com>

pkgname=watchvideo
pkgver=2.0.3
pkgrel=3
pkgdesc="Application to play, download or convert videos (to Ogg) from various YouTube-like sites."
arch=('i686' 'x86_64')
url="http://kde-apps.org/content/show.php/WatchVideo?content=133133"
license=('GPL3')
depends=('getmediumurl' 'python2-qt' 'vlc')
source=(http://qt-apps.org/CONTENT/content-files/128368-WatchVideo-$pkgver.tar.gz)
md5sums=('c5bf8845e3e578eb4ff184365a32e10e')

build() {
   cd $srcdir/WatchVideo-$pkgver

   # Python2 fix
   sed -i 's_#! /usr/bin/env python_#!/usr/bin/env python2_' setup.py
   cd ./watchvideo
   for file in $(find . -name '*.py' -print); do
   sed -i 's_^#!.*/usr/bin/python_#!/usr/bin/python2_' $file
   sed -i 's_^#!.*/usr/bin/env python_#!/usr/bin/env python2_' $file
   sed -i 's_^ #!/usr/bin/env python_ #!/usr/bin/env python2_' $file
   done

   # Install
   cd ..
   python2 setup.py install --root=$pkgdir/ --optimize=1

   # Desktop icon
   install -Dm644 ./media/watchvideo.svg $pkgdir/usr/share/pixmaps/watchvideo.svg
   install -Dm644 watchvideo.desktop $pkgdir/usr/share/applications/watchvideo.desktop
}