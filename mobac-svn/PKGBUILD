# Contributor: Jozef Riha <jose1711 at gmail dot com>

pkgname=mobac-svn
pkgver=1216
pkgrel=1
pkgdesc="application that creates atlases for the J2ME application TrekBuddy"
arch=('i686' 'x86_64')
url="http://mobac.dnsalias.org/"
license=('GPL')
depends=('java-runtime')
makedepends=('apache-ant' 'sed' 'subversion' 'jdk')
source=('mobac.desktop')
md5sums=('78a831bdc101f859138700f7e61ff148')
provides=('mobac')
conflicts=('mobac')

_svntrunk="https://trekbuddyatlasc.svn.sourceforge.net/svnroot/trekbuddyatlasc/trunk"
_svnmod="trekbuddyatlasc"

build() {
	cd $startdir/src/

	# get the sources
	msg "Connecting to $_svntrunk ..."
	if [ -d $_svnmod/.svn ]; then
		(cd $_svnmod && svn up) || return 1
	else
		svn co $_svntrunk $_svnmod || return 1
	fi
	msg "SVN checkout done or server timeout"

	cd $_svnmod

	cd $srcdir/trekbuddyatlasc/MOBAC
	ant || /usr/share/java/apache-ant/bin/ant || return 1
	install -Dm 644 ./Mobile_Atlas_Creator.jar $pkgdir/usr/share/mobac/Mobile_Atlas_Creator.jar
	install -Dm 644 ./README.HTM $pkgdir/usr/share/mobac/README.html
	install -Dm 644 ./CHANGELOG.txt $pkgdir/usr/share/mobac/CHANGELOG.txt
	install -Dm 644 ./gpl.txt $pkgdir/usr/share/mobac/gpl.txt
	# we need to supply the full path to starting script
	/bin/sed "s/Mobile_Atlas_Creator.jar/\/usr\/share\/mobac\/Mobile_Atlas_Creator.jar/" ./start.sh >./mobac
	install -Dm 755 ./mobac $pkgdir/usr/bin/mobac || return 1
	install -Dm 644 ../website/images/logo3.png $pkgdir/usr/share/pixmaps/mobac.png && \
	install -Dm 644 $srcdir/mobac.desktop $pkgdir/usr/share/applications/mobac.desktop || return 1
}
