# Contributor: Carlos Sanchez <cargabsj175@vegnux.org.ve>
# Maintainer for Parabola GNU/Linux: Omar Botta <omarbotta@gnulinuxlibre.net>
# Contributor: Frederic Bezies <fredbezies@gmail.com>
#
# Based on work made by Carlos Sanchez
#
pkgname=gnash-trunk-git
pkgver=20110327
pkgrel=1
pkgdesc="Gnash is the GNU SWF Player based on GameSWF. Development version based on git"
arch=('i686' 'x86_64')
url="http://www.gnu.org/software/gnash/"
license=('GPL3')
makedepends=(libldap sdl libjpeg libpng libtool
             fontconfig libva libxinerama
             gtk2 libldap xulrunner
             pkgconfig 'boost>=1.45'
             git automake autoconf)
depends=(speex ffmpeg gstreamer0.10-base boost-libs gtk2 giflib agg curl gsm libdca)
provides=(gnash-common gnash-gtk)
conflicts=(gnash-common gnash-gtk gnash-trunk-bzr)
replaces=(gnash-common gnash-gtk)
options=(!libtool !emptydirs)
_gitroot='http://git.savannah.gnu.org/r/gnash.git'
_gitname='gnash'

build() {
	cd ${srcdir}

	msg 'Connecting to GIT server...'

	if [ -d ${_gitname} ]; then
		rm -rf ${_gitname}
	fi
  git clone ${_gitroot}

	msg 'GIT checkout done or server timeout.'

  cd ${_gitname}
  
	msg 'Generating necessary files...'

chmod +x autogen.sh
./autogen.sh
./configure --prefix=/usr \
--sysconfdir=/etc \
--enable-renderer=agg \
--enable-gui=sdl,gtk \
--enable-media=gst,ffmpeg \
--with-plugindir=/usr/lib/mozilla/plugins \
--enable-hwaccel=vaapi \
--disable-kparts3 \
--disable-kparts4 \
--disable-cygnal || return 1

make || return 1

make DESTDIR="$pkgdir" install || return 1
make DESTDIR="$pkgdir" install-plugins || return 1
}
