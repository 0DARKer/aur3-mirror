# Contributor: ReNoM <renom@list.ru>
pkgname=vmware-vcli
pkgver=5.5.0
pkgrel=1
pkgdesc="The vCLI utilities make it possible to manage VMWare ESX servers (with the possibility of using vCenter). For make package, place VMware-vSphere-CLI-5.5.0-1384587.{your_arch}.tar.gz to PKGBUILD directory."
arch=('i686' 'x86_64')
url="https://my.vmware.com/group/vmware/details?downloadGroup=VCLI550&productId=352"
license=('custom:vmware')
depends=(e2fsprogs openssl libxml2 perl perl-xml-sax perl-crypt-ssleay perl-archive-zip perl-html-parser perl-data-dump perl-soap-lite perl-uri perl-lwp-protocol-https perl-class-methodmaker perl-net-ssleay perl-xml-libxml)
[ "$CARCH" == "i686" ] && source=(VMware-vSphere-CLI-5.5.0-1384587.i386.tar.gz for-arch.patch)
[ "$CARCH" == "x86_64" ] && source=(VMware-vSphere-CLI-5.5.0-1384587.x86_64.tar.gz for-arch.patch)

[ "$CARCH" == "i686" ] && md5sums=('2a3be7d991b7b8278794bff9860b2b32' '763f97c2d80de28b8be402d5f64eb1a0')
[ "$CARCH" == "x86_64" ] && md5sums=('6f03d69d2cb599d8a784c2c9e673f139' '763f97c2d80de28b8be402d5f64eb1a0')

build() {
	cd "$srcdir"
	patch -p0 < for-arch.patch
}

package ()
{
	cd "$pkgdir"
	mkdir -p usr/bin
	mkdir -p usr/lib/perl5/core_perl
	cd "$srcdir/vmware-vsphere-cli-distrib"
	export ftp_proxy=""
	export http_proxy=""
	./vmware-install.pl --prefix=../../pkg/vmware-vcli
	cd "$pkgdir"
	rm usr/lib/perl5/core_perl/Data/Dumper.pm
	rm usr/lib/perl5/core_perl/auto/Data/Dumper/Dumper.bs
	rm usr/lib/perl5/core_perl/auto/Data/Dumper/Dumper.so
	mv bin/* usr/bin/
	rmdir bin
}

