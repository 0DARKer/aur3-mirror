pkgname=lightdm
pkgver=1.1.0
pkgrel=5
pkgdesc="A lightweight display manager"
arch=('i686' 'x86_64')
url="https://launchpad.net/lightdm"
license=('GPL3' 'LGPL3')
source=("http://people.ubuntu.com/~robert-ancell/lightdm/releases/$pkgname-$pkgver.tar.gz"
lightdm
lightdm.service
lightdm-gtk-greeter.conf
lightdm.pam)
depends=('gnome-themes-standard' 'gnome-backgrounds' 'gnome-icon-theme' 'libwebkit' 'dbus-glib' 'gtk3' 'libxklavier' 'intltool' 
'accountsservice')
options=(!libtool)
optdepends=('xorg-server-xephyr: run lightdm in test mode' 
	    'lightdm-webkit-greeter-bzr')
makedepends=('gnome-doc-utils' 'gobject-introspection' 'pkg-config')
backup=(
etc/apparmor.d/lightdm-guest-session
etc/dbus-1/system.d/org.freedesktop.DisplayManager.conf
etc/lightdm/keys.conf
etc/lightdm/lightdm-gtk-greeter.conf
etc/lightdm/lightdm.conf
etc/lightdm/users.conf
)

build() {
  cd $srcdir/$pkgname-$pkgver
     ./configure --prefix=/usr \
     --sysconfdir=/etc --disable-static --libexecdir=/usr/lib/lightdm \
     --localstatedir=/var --with-greeter-user=root \
     --with-greeter-session=lightdm-gtk-greeter     
   sed -i 's/lightdm-session//' tests/src/Makefile
   make || return 1
}

package() {
  cd $srcdir/$pkgname-$pkgver
  make DESTDIR=$pkgdir install
  mkdir -p $pkgdir/etc/rc.d 
  mkdir -p $pkgdir/lib/systemd/system/
  mkdir -p $pkgdir/etc/pam.d 
# init services file 
  install -m755 ../lightdm $pkgdir/etc/rc.d
  install -m644 ../lightdm.service $pkgdir/lib/systemd/system/
# pam file for gnome-keyring
  install -m644 ../lightdm.pam $pkgdir/etc/pam.d/lightdm
# some tweaks  
  rm -r $pkgdir/etc/init
  cp ../lightdm-gtk-greeter.conf $pkgdir/etc/lightdm
  sed -i -e "s|minimum-uid=500|minimum-uid=1000|g" $pkgdir/etc/lightdm/users.conf  
  sed -i -e "s|/usr/sbin/nologin|/sbin/nologin|g" $pkgdir/etc/lightdm/users.conf

}

md5sums=('c2347200b1af29c677ef5ad83855217b'
         '6699eb35f65ff498d1d05e6782f4f902'
         '52003b799271a4d19be51f05b8184eff'
         'e3793e82604f0a7bd017425feba7853e')
md5sums=('c2347200b1af29c677ef5ad83855217b'
         '6699eb35f65ff498d1d05e6782f4f902'
         '52003b799271a4d19be51f05b8184eff'
         'e3793e82604f0a7bd017425feba7853e'
         '5a1daf8af982cfafccdd57f61878e88f')
