# Maintainer: Jeff Parent <jecxjo@sdf.lonestar.org>
# Contributor: Jeff Parent <jecxjo@sdf.lonestar.org>

pkgname=rtl8192
pkgver=0004.0816.2011
pkgrel=2
pkgdesc="Driver for Realtek 8192CE/DE/SE PCI wireless chipsets."
license=("GPL")
depends=('linux-headers')
source=("http://jecxjo.sdf.org/aur/92ce_se_de_linux_mac80211_0004.0816.2011.tar.gz"
        "wifi.h.patch")
arch=('i686' 'x86_64')
url="http://www.realtek.com.tw/"
install="${pkgname}.install"
md5sums=('42b1583c3aa3383995299e58bb787e9c'
         'cff801688499c4a5d9713679c328faba')

build() {
	cd "${srcdir}"/rtl_92ce_92se_92de_linux_mac80211_${pkgver}
    patch < "${srcdir}"/wifi.h.patch
	make
}

package() {
	cd "${srcdir}"/rtl_92ce_92se_92de_linux_mac80211_${pkgver}
	mkdir -p "${pkgdir}"/lib/firmware
	cp -rf firmware/rtlwifi "${pkgdir}"/lib/firmware/rtlwifi
	mkdir -p "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi/rtl8192{c,d,s}e
	cp -f rtl8192ce/rtl8192ce.ko "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi/rtl8192ce
	cp -f rtl8192de/rtl8192de.ko "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi/rtl8192de
	cp -f rtl8192se/rtl8192se.ko "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi/rtl8192se
	cp -f rtlwifi.ko "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi
    find "${pkgdir}"/lib/modules/$(uname -r)/kernel/drivers/net/wireless/rtlwifi -name '*.ko' -exec gzip {} \;
}
