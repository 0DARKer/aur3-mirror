# XChat-CVS: Installer: Arch
# Contributor: Chris Giles <Chris.G.27 (at) Gmail.com>
# Contributor: defcon <defcon@archlinux.us>

basename=xchat
pkgname=${basename}-cvs
pkgver=20090916
pkgrel=1
pkgdesc="A mature GTK+ IRC client"
arch=("i686" "x86_64")
url="http://www.${basename}.org/"
license=("GPL")
depends=("gtk2>=2.10.9" "dbus-glib>=0.7.2" "tcl")
makedepends=("cvs" "autoconf" "automake")
optdepends=("enchant: for spell checking support" "tcl: for tcl plugin")
conflicts=("${basename}")
options=("!libtool")

source=()
md5sums=()
_cvsroot=":pserver:anonymous@${basename}.cvs.sourceforge.net:/cvsroot/${basename}"
_cvsmod="${basename}2"

build() {
	cd ${srcdir}

	# Repository
	msg "Connecting to CVS server...."
	if [ -d ${_cvsmod}/CVS ]; then
		cd ${_cvsmod}
		cvs -z3 update -d
	else
	cvs -z3 -d ${_cvsroot} co -D ${pkgver} -f ${_cvsmod}
	cd ${_cvsmod}
	fi
	msg "CVS checkout done or server timeout"
	msg "Starting build ..."

	# Build
	cp -r ../${_cvsmod} ../${_cvsmod}-build
	cd ../${_cvsmod}-build
	./autogen.sh
	./configure --prefix=/usr --sysconfdir=/etc \
				--enable-openssl --enable-dbus \
				--disable-gnome --disable-textfe \
			--disable-ipv6 --enable-shm \
			--enable-spell=static || return 1
	make || return 1
	make DESTDIR=${pkgdir} install || return 1

	# Removals
	rm -rf ${srcdir}/${_cvsmod}-build || return 1
}
