pkgname=emily
pkgver=0.1
pkgrel=3
pkgdesc='A programming language where everything is a function'
arch=('i686' 'x86_64')
url='http://emilylang.org/'
license=('MIT')
#depends=('ocaml')
makedepends=('ocaml' 'opam')
#checkdepends=('curl')
options=('!emptydirs')
source=(https://github.com/mcclure/emily/archive/emily-$pkgver.tar.gz)
md5sums=('7edcd91bcf724538a6b6e4069d44d740')

prepare() {
  cd emily-emily-$pkgver
  msg 'fixing bin location in Makefile'
  sed -ie "s/\$(PREFIX)\/bin/\$(PREFIX)\/usr\/bin/" Makefile
  
  msg 'install ocaml package. opam init might be required first'
  opam init --yes
  eval `opam config env`
  opam install --yes ocamlfind sedlex containers
}

build() {
  cd emily-emily-$pkgver
  eval `opam --root=../opam config env`

  make
}

#check() {
#  cd emily-emily-$pkgver
#  make test || true
#}

package() {
  cd emily-emily-$pkgver

  make PREFIX="$pkgdir" install

  # install docs as per user request
  install -D -m644 LICENSE.md \
    "$pkgdir"/usr/share/licenses/emily/LICENSE
}

# vim:set ts=2 sw=2 et:
