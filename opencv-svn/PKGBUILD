# Contributor: Artyom Smirnov <smirnoffjr@gmail.com>

pkgname=opencv-svn
pkgver=1556
pkgrel=1
pkgdesc="Collection of algorithms, documentation and sample code for real time computer vision."
url="http://sourceforge.net/projects/opencvlibrary"
license=("BSD")
arch=(i686 x86_64)
conflicts=('opencv' 'opencv-cvs')
provides=('opencv')
options=(!libtool)

source=()
md5sums=()

depends=('jasper' 'gstreamer0.10' 'xine-lib' 'libdc1394' 'unicap')
makedepends=('subversion' 'cmake' 'swig' 'python')

_svntrunk=https://opencvlibrary.svn.sourceforge.net/svnroot/opencvlibrary/trunk/opencv
_svnmod=opencv

build() {
    cd "$srcdir"

    if [ -d $_svnmod/.svn ]; then
        (cd $_svnmod && svn up -r $pkgver)
    else
        svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
    fi

    msg "SVN checkout done or server timeout"
    msg "Starting make..."

    rm -rf $srcdir/$_svnmod-build
    cp -r $srcdir/$_svnmod $srcdir/$_svnmod-build
    cd $srcdir/$_svnmod-build

    mkdir build
    cd build
    cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr -D BUILD_PYTHON_SUPPORT=ON .. || return 1
    make
    make DESTDIR=$pkgdir install

    # adding license
    install -d -m755 $pkgdir/usr/share/licenses/$pkgname
    install -m644 $srcdir/$_svnmod/doc/license.txt $pkgdir/usr/share/licenses/$pkgname
}

