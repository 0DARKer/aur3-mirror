# Maintainer: Ner0

pkgname=chromium-pepper-flash
pkgver=11.2.31.118
pkgrel=1
pkgdesc="Google Chrome's Pepper Flash plugin for Chromium"
arch=('i686' 'x86_64')
_arch=amd64
[ $CARCH = 'i686' ] && _arch=i386
url="http://wiki.archlinux.org/index.php/Chromium"
license=('non-free')
depends=('chromium-browser' 'openssl098')
makedepends=('wget')
install=pepper.install
source=('default')
md5sums=('6036276cdd7cc4686486b2bc90467dcf')

package() {
  wget http://dl.google.com/linux/direct/google-chrome-unstable_current_${_arch}.deb
  bsdtar -xf google-chrome-unstable_current_${_arch}.deb data.tar.lzma
  bsdtar -xf data.tar.lzma opt/google/chrome/PepperFlash

  if [ -f /etc/chromium-browser/default ]; then
    install -Dm644 /etc/chromium-browser/default "$pkgdir/etc/chromium-browser/default"
    sed -i "s/ppapi-flash-version=.*[0-999]/ppapi-flash-version=${pkgver}/g" "$pkgdir/etc/chromium-browser/default"
    sed -i "s|opt/chromium-browser|usr/lib|g" "$pkgdir/etc/chromium-browser/default"
  else
    install -Dm644 "$srcdir/default" "$pkgdir/etc/chromium-browser/default"
  fi

  if [[ $(cat "$pkgdir/etc/chromium-browser/default") == *ppapi* ]]; then
    : # do nothing
  else
    sed -i '/CHROMIUM_FLAGS/s|"$| --ppapi-flash-path=/usr/lib/PepperFlash/libpepflashplayer.so --ppapi-flash-version='${pkgver}'"|' "$pkgdir/etc/chromium-browser/default"
  fi

  install -dm755 "$pkgdir/usr/lib/PepperFlash"
  for i in opt/google/chrome/PepperFlash/*; do install -m644 "$i" "$pkgdir/usr/lib/PepperFlash"; done
}
