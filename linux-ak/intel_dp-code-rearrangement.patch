--- drivers/gpu/drm/i915/intel_dp.c.orig	2013-09-03 00:46:10.000000000 +0400
+++ drivers/gpu/drm/i915/intel_dp.c	2013-09-03 19:42:27.865435832 +0400
@@ -710,8 +710,6 @@
 	/* Walk through all bpp values. Luckily they're all nicely spaced with 2
 	 * bpc in between. */
 	bpp = pipe_config->pipe_bpp;
-	if (is_edp(intel_dp) && dev_priv->vbt.edp_bpp)
-		bpp = min_t(int, bpp, dev_priv->vbt.edp_bpp);
 
 	for (; bpp >= 6*3; bpp -= 2*3) {
 		mode_rate = intel_dp_link_required(adjusted_mode->clock, bpp);
@@ -749,7 +747,6 @@
 
 	intel_dp->link_bw = bws[clock];
 	intel_dp->lane_count = lane_count;
-	pipe_config->pipe_bpp = bpp;
 	pipe_config->port_clock = drm_dp_bw_code_to_link_rate(intel_dp->link_bw);
 
 	DRM_DEBUG_KMS("DP link bw %02x lane count %d clock %d bpp %d\n",
@@ -764,6 +761,10 @@
 
 	intel_dp_set_clock(encoder, pipe_config, intel_dp->link_bw);
 
+	if (is_edp(intel_dp) && dev_priv->vbt.edp_bpp)
+		bpp = min_t(int, bpp, dev_priv->vbt.edp_bpp);
+	pipe_config->pipe_bpp = bpp;
+
 	return true;
 }
 
