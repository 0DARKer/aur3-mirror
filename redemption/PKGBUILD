# Maintainer: Martin Potier <mpo@wallix.com>
pkgname=redemption
pkgver=0.5.2
pkgrel=1
pkgdesc="A nice RDP proxy that plays nice with protocols"
arch=('i686' 'x86_64')
url="https://github.com/wallix/redemption"
license=('GPL')
groups=()
depends=('boost-libs' 'openssl' 'glibc' 'libx11')
makedepends=('boost' 'cmake')
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
source=("$pkgname-$pkgver.tar.gz::https://github.com/mpo-redemption/$pkgname/tarball/$pkgver")
noextract=()
md5sums=('676a4ddb1b28f409b68621721c353719') #generate with 'makepkg -g'

build() {
  if [[ ! -d $srcdir/$pkgname-$pkgver ]]
  then
    mv "$srcdir/mpo-redemption-redemption-c6fc376" "$srcdir/$pkgname-$pkgver"
  fi

  cd "$srcdir/$pkgname-$pkgver"

  if [[ ! -d "build" ]]
  then
    mkdir "build"
  fi

  cd "build"
  cmake ..
  make 2> log

  make test
}

package() {
  cd "$srcdir/$pkgname-$pkgver"
  cd "build"

  make install DESTDIR=$pkgdir
}
