# Maintainer:Bjoern Bidar <theodorstormgrade@gmail.com>

pkgname=ryzom-client-latest-hg
pkgver=20120614
pkgrel=1
pkgdesc="Ryzom is a Pay to Play MMORPG with a free demo. This version is for playing on an official server"
arch=('i686' 'x86_64')
url="http://www.ryzom.com/"
license=('AGPL3' 'CCPL:by-sa')
depends=('curl' 'freetype2' 'libx11' 'mesa' 'libxxf86vm' 'openal' 'freealut' 'libogg' 'libvorbis' 'libxml2' 'cmake' 'libpng' 'libjpeg' 'rrdtool' 'bison' 'libwww' 'boost' 'cpptest')
makedepends=('p7zip' 'mercurial')
provides=('ryzom')

_hg_root='http://ryzom.hg.sourceforge.net:8000/hgroot/ryzom/ryzom'
_hg_name='ryzom' 
# The package is big and xz is slow
PKGEXT='.pkg.tar.gz'

build() {
    
    if [ -d "$_hg_name" ] ; then
      cd "$_hg_name"
      hg pull && hg update
      cd ..
    else
      hg clone "$_hg_root"
    fi
    
    cd $_hg_name
    mkdir -p build
    cd build

    msg "hg clone done or server timeout"
    msg "Starting cmake..."
    cmake -b ../code
    

    msg "Starting make"
    
    make 
  
    make install

}

package() {
    cd "$srcdir/$_hg_name/build"
    make DESTDIR="$pkgdir/" install
}
 
