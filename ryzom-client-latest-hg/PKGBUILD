# Maintainer:Bjoern Bidar <theodorstormgrade@gmail.com>
_gui_toolkit=qt # qt or gtk
_build_server=false # set true to build with server
pkgname=ryzom-client-latest-hg
pkgver=20120614
pkgrel=2
pkgdesc="Ryzom is a Pay to Play MMORPG with a free demo. This version is for playing on an official server"
arch=('i686' 'x86_64')
url="http://www.ryzom.com/"
license=('AGPL3' 'CCPL:by-sa')
depends=('curl' 'freetype2' 'libx11' 'mesa' 'libxxf86vm' 'openal' 'freealut' 'libogg' 'libvorbis' 'libxml2' 'cmake' 'libpng' 'libjpeg' 'rrdtool' 'bison' 'libwww' 'boost' 'cpptest' 'luabind' 'libsquish' 'lua' ) 
makedepends=('p7zip' 'mercurial')
provides=('ryzom')
_CMAKE_ARGS=('-DWITH_STATIC=OFF' )

case $_gui_toolkit in
  qt) _CMAKE_ARGS=( ${_CMAKE_ARGS[*]} '-DWITH_QT=ON' ) ;;
  gtk) _CMAKE_ARGS=( ${_CMAKE_ARGS[*]} '-DWITH_GTK=ON' ) ;;
esac 

case $_build_server in
  true) _CMAKE_ARGS=( ${_CMAKE_ARGS[*]} '-DWITH_RYZOM_SERVER=ON' ) ;;
  false) _CMAKE_ARGS=( ${_CMAKE_ARGS[*]} '-DWITH_RYZOM_SERVER=OFF' ) ;;
esac 
_hg_root='http://ryzom.hg.sourceforge.net:8000/hgroot/ryzom/ryzom'
_hg_name='ryzom' 
# The package is big and xz is slow
PKGEXT='.pkg.tar.gz'

build() {
    
    if [ -d "$_hg_name" ] ; then
      cd "$_hg_name"
      hg pull && hg update
      cd ..
    else
      hg clone "$_hg_root"
    fi
    
    cd $_hg_name
    mkdir -p build
    cd build

    msg "hg clone done or server timeout"
    msg "Starting cmake..."
    cmake -b ../code -DWITH_STATIC=OFF -DWITH_QT=ON
    

    msg "Starting make"
    
    make 
  
    make install

}

package() {
    cd "$srcdir/$_hg_name/build"
    make DESTDIR="$pkgdir/" install
}
 



