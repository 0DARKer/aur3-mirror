# Maintainer: Serge Ziryukin <ftrvxmtrx@gmail.com>

pkgname=ocaml-postgresql
pkgver=1.18.0
pkgrel=1
pkgdesc="OCaml interface to the PostgreSQL database"
arch=('i686' 'x86_64')
url=("http://www.ocaml.info/home/ocaml_sources.html")
license=('LGPL')
depends=('ocaml' 'ocaml-findlib' 'postgresql')
makedepends=('ocaml' 'texlive-core' 'texlive-latexextra' 'ghostscript')
conflicts=('postgresql-ocaml')
source=(http://hg.ocaml.info/release/postgresql-ocaml/archive/release-${pkgver}.tar.bz2)
md5sums=('f6a07ff34347a1ad552c1f663f7e90ed')

_pkgdir="postgresql-ocaml-release-${pkgver}"

build () {
  OCAMLFIND_DESTDIR="${pkgdir}$(ocamlfind printconf destdir)"

  cd "${srcdir}/${_pkgdir}"

  make all doc || return 1
  mkdir -p "${OCAMLFIND_DESTDIR}/stublibs"
  DESTDIR="${pkgdir}" OCAMLFIND_DESTDIR="${OCAMLFIND_DESTDIR}" make install || return 1
  install -d -m 0755 "${pkgdir}/usr/share/doc/ocaml-postgresql/html"
  install -t "${pkgdir}/usr/share/doc/ocaml-postgresql/html" doc/postgresql/html/*
  install -T doc/postgresql/latex/doc.pdf "${pkgdir}/usr/share/doc/ocaml-postgresql/ocaml-postgresql.pdf"
}
