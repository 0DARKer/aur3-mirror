# Contributor: Chebotarev Sergey <sachebotarev@gmail.com>
# Maintainer: Aurélien DESBRIÈRES <ice.cube@gmx.com>

pkgname=fontmatrix-svn
pkgver=1203
pkgrel=1
pkgdesc="Font manager for Linux"
arch=('i686' 'x86_64')
url="http://fontmatrix.net/"
license=('GPL')
depends=('qt>=4.3.0')
conflicts=('fontmatrix')
makedepends=('subversion' 'cmake>=2.4.0')
source=()
md5sums=()

_svntrunk=http://svn.gna.org/svn/undertype/trunk/tools/typotek
_svnmod=fontmatrix

build()
{
	cd ${srcdir}

	if [ -d $_svnmod/.svn ]; then
	  (cd $_svnmod && svn up -r $pkgver)
  	else
	  svn co $_svntrunk --config-dir ./ $_svnmod -r $pkgver
  	fi

  	msg "SVN checkout done or server timeout"
  	msg "Starting make..."

  	cp -a ${srcdir}/${_svnmod} ${srcdir}/${_svnmod}-build
  	cd ${srcdir}/${_svnmod}-build

	export QTDIR=/usr
	if [ "${CARCH}" = "i686" ]; then
		export QMAKESPEC=/usr/share/qt/mkspecs/linux-g++-32
	elif [ "${CARCH}" = "x86_64" ]; then
		export QMAKESPEC=/usr/share/qt/mkspecs/linux-g++-64
	fi	
	mkdir build
	cd build
	cmake .. -DCMAKE_INSTALL_PREFIX=/usr || return 1
	make || return 1
	make DESTDIR=$startdir/pkg install || return 1

	rm -rf ${srcdir}/$_svnmod-build
}
