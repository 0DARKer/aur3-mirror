# Maintainer: graysky <graysky AT archlinux DOT us>
# Contributor: germar <germar DOT reitze AT gmail DOT com>

pkgname=('backintime' 'backintime-cli')
_pkgname="backintime"
pkgver=1.1.0
pkgrel=2
arch=('any')
url="https://launchpad.net/backintime"
license=('GPL')
source=("https://launchpadlibrarian.net/195031677/$_pkgname-$pkgver.tar.gz"
"https://launchpadlibrarian.net/195031678/$_pkgname-$pkgver.tar.gz.asc")
sha256sums=('7671ae80c297895cf7421eddcaf614789c82f47a728d1882664e31af2eee7841'
'SKIP')
validpgpkeys=('3E70692EE3DB8BDDA5991C90615F366D944B4826') # Germar Reitze
# https://wiki.archlinux.org/index.php/Makepkg#Signature_checking

build() {
	cd "$_pkgname-$pkgver/common"
	./configure --python --no-fuse-group
	make

	cd "$srcdir/$_pkgname-$pkgver/qt4"
	./configure --python --gksudo --kdesu
	make
}

package_backintime-cli() {
	pkgdesc="Simple backup system inspired from the Flyback Project and TimeVault. CLI version."
	depends=('rsync' 'cron' 'openssh' 'python-keyring' 'python-dbus')
	optdepends=('backintime: QT4 GUI version'
	'encfs: encrypted filesystem in user-space'
	'pm-utils: for laptops allows an option to not snapshot on battery'
	'sshfs: FUSE client based on the ssh file transfer protocol')
	conflicts=('backintime-bzr' 'backintime<1.1.0')
	replaces=('backintime<1.1.0')

	cd "$_pkgname-$pkgver/common"
	make DESTDIR="$pkgdir" install
}

package_backintime() {
	pkgdesc="Simple backup system inspired from the Flyback Project and TimeVault. QT4 GUI version."
	depends=("backintime-cli=$pkgver" 'xorg-utils' 'python-pyqt4' 'libnotify'
	'ttf-font' 'icu' 'gksu') # change gksu to kdesu if wanted
	
	# note users can optionally install EITHER kdesdk-kompare OR meld but not both!
	optdepends=('kdesdk-kompare: diff/patch frontend'
	'meld: diff/patch frontend'
	'python-keyring: store and access passwords safely')

	conflicts=("backintime<1.1.0" 'backintime-qt4' 'backintime-gtk'
	'backintime-gnome' 'backintime-kde4' 'backintime-bzr'
	'backintime-gnome-bzr' 'backintime-kde4-bzr' 'backintime-qt4-brz')
	replaces=("backintime<1.1.0" 'backintime-qt4' 'backintime-gtk'
	'backintime-gnome' 'backintime-kde4')

	cd "$_pkgname-$pkgver/qt4"
	make DESTDIR="$pkgdir" install
}
