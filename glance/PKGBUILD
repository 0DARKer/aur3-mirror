# Maintainer: Limao Luo <luolimao+AUR@gmail.com>
# Contributor: Josh Chase <jcjoshuachase@gmail.com>

pkgname=glance
pkgver=2013.1.g3
pkgrel=2
pkgdesc="OpenStack image registry and delivery service"
arch=(any)
url=https://launchpad.net/$pkgname
license=(custom)
depends=(python2-anyjson python2-argparse python2-boto python2-crypto python2-eventlet
    python2-glanceclient python2-greenlet python2-httplib2 python2-iso8601 python2-kombu
    python2-lxml python2-migrate python2-passlib python2-paste python2-paste-deploy python2-routes
    python2-sendfile python2-sqlalchemy python2-webob python2-wsgiref python2-xattr)
makedepends=(python2-distribute)
source=($url/grizzly/grizzly-${pkgver#*g}/+download/$pkgname-$pkgver.tar.gz)
sha256sums=('c6f0370f645edf9b51c1fb153ceca2bf6ca85e83469380cb19d2882e5d7bb588')
sha512sums=('83301bc06d6ecf68fec7e7052440441c746a6402abf9499103692a4493630d7c6b9bc17d56e91625cf4b6e9f069ee2161c7dbc3f3c846622f51ff36b8d323c31')

build() {
    cd $pkgname-$pkgver/
    find -type f -exec sed -ri 's:^#!/usr/bin/(env )?python$:&2:' '{}' \;
    python2 setup.py build
}

package() {
    cd $pkgname-$pkgver/
    python2 setup.py install --root="$pkgdir" --optimize=1

    install -d "$pkgdir"/etc/
    cp -r etc/ "$pkgdir"/etc/$pkgname/
    install -Dm644 LICENSE "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
}
