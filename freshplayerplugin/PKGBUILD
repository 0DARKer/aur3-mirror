# Maintainer: Corelli <corelli AT sent DOT com>
# Contributor:  BartÅ‚omiej Piotrowski <bpiotrowski@archlinux.org>
# Contributor: intelfx <intelfx100 [at] gmail [dot] com>
# Contributor: Behem0th <grantipak@gmail.com>

# Checks if Google Chrome is present
if [[ -d "/opt/google/chrome" ]];then
_use_chrome=yes;
fi

pkgname=freshplayerplugin
pkgver=0.2.2
pkgrel=3
pkgdesc='PPAPI-host NPAPI-plugin adapter.'
arch=('i686' 'x86_64')
url='https://github.com/i-rinat/freshplayerplugin'
license=('MIT')
depends=('chromium-pepper-flash' 'pango' 'alsa-lib' 'freetype2' 'libconfig' 'libevent' 'gtk2' 'libgl')
  if [[ -n $_use_chrome ]]; then
    depends[0]='google-chrome'
  fi
makedepends=('cmake' 'ragel')
provides=('freshplayerplugin')
conflicts=('freshplayerplugin-git')
backup=('etc/freshwrapper.conf')
source=($url/archive/v$pkgver.tar.gz)
md5sums=('65ea371b52b693cba2994c0edf8b7216')
options=(debug !strip)

build() {
  cd $pkgname-$pkgver
  cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr
  make
}

package() {
  cd $pkgname-$pkgver
  install -d "$pkgdir/usr/lib/mozilla/plugins"
  install -m644 libfreshwrapper-*.so "$pkgdir/usr/lib/mozilla/plugins"
  install -Dm644 LICENSE.MIT "$pkgdir"/usr/share/licenses/$pkgname/LICENSE
  install -Dm644 data/freshwrapper.conf.example "$pkgdir/etc/freshwrapper.conf"
    if [[ ! -n $_use_chrome ]]; then
      # configure path to libpepflashplayer.so
      sed -r -e 's|^(pepperflash_path).*|\1 = "/usr/lib/PepperFlash/libpepflashplayer.so"|' \
             -i "$pkgdir/etc/freshwrapper.conf"
    fi
}