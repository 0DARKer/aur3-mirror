# Maintainer: Andy Weidenbaum <archbaum@gmail.com>

pkgname=ripple-client-git
pkgver=20130306
pkgrel=2
pkgdesc="Client for the Ripple payment network"
arch=('any')
depends=('nodejs')
makedepends=('git' 'nodejs-grunt-cli')
url="https://github.com/rippleFoundation/ripple-client"
license=('MIT')
source=(ripple-client.install
        ripple-client.sh)
sha256sums=('c51ee81d63bf807f68200d0bd7454b77041abf21b38adc3dcc2439f64123222f'
            'b8015eea0f0deccca54117fd9f788d560ba7a70df3df701cdbce73758fc69d81')
provides=('ripple-client-git')
conflicts=('ripple-client')
install=ripple-client.install

_gitroot="git://github.com/rippleFoundation/ripple-client.git"
_gitname="ripple-client"

_insdir="/opt/${_gitname}"

build() {
  cd "${srcdir}"
  msg "Connecting to GIT server...."

  if [ -d ${_gitname} ] ; then
    cd ${_gitname} && git pull origin
    msg "The local files are updated."
  else
    git clone ${_gitroot} ${_gitname}
  fi

  msg "GIT checkout done or server timeout"

  mkdir -p "${pkgdir}/${_insdir}"
  cp -rf "${_gitname}/"* "${pkgdir}/${_insdir}"
  cd "${pkgdir}/${_insdir}"

  msg 'Installing NPM dependencies...'
  npm install -d

  msg 'Building with grunt...'
  grunt
}

package() {
  cd "${pkgdir}/${_insdir}"

  msg 'Creating default config.js file...'
  cp config-example.js config.js

  msg 'Installing executable (opens Ripple client in your default browser)'
  install -Dm755 "${srcdir}"/ripple-client.sh "${pkgdir}"/usr/bin/${_gitname}
}
