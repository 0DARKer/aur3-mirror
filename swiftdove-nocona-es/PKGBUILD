# Contributor: mightyjaym <jm.ambrosino@free.fr>
# Contributor: TuxSpirit <tuxspiritATarchlinuxDOTfr>


pkgname=swiftdove-nocona-es
_pkgname=swiftdove
_pkgproc=nocona
_pkgdate="07-24-08"
_pkglang=es-AR
pkgver=2.0.0.16
pkgrel=1
pkgdesc="Mozilla Thunderbird optimized build for Core Duo/Celeron D (32 and 64 bit) processors (Spanish version)."
arch=('i686' 'x86_64')
url="http://swiftweasel.tuxfamily.org/"
license=('MPL' 'GPL' 'LGPL')
depends=('mozilla-common' 'desktop-file-utils' 'nss' 'libxt' 'libstdc++5')
makedepends=('unzip')
provides=('thunderbird' 'swiftdove')
conflicts=('swiftdove')

if [ "$CARCH" = "x86_64" ]; then
     _nbits=64bit
md5sums=('508850d141b312aaac2cc80078460cb3'
         'e3e4e885744a0b309ec39babffc286f7'
         '9b2a0e6cfc06e756d8b1289e1da3dbe9')
else _nbits=32bit
md5sums=('10e22bfe6d8903bed506723977541786'
         'e3e4e885744a0b309ec39babff$c286f7'
         'c99e357b42f92bc905c9c665716314f6')
fi

source=(http://downloads.sourceforge.net/swiftweasel/${_pkgname}-${pkgver}_${_pkgdate}_${_pkgproc}-${_nbits}.tar.gz
	swiftdove.desktop
	ftp://ftp.mozilla.org/pub/mozilla.org/thunderbird/releases/${pkgver}/linux-i686/xpi/${_pkglang}.xpi)

build() {

  cd ${srcdir}
  mkdir ${pkgdir}/opt/
  cp -r ${_pkgname} ${pkgdir}/opt/${_pkgname}
  mkdir -p ${pkgdir}/usr/bin
  ln -s /opt/${_pkgname}/${_pkgname} ${pkgdir}/usr/bin/${_pkgname}

  install -d -m755 ${pkgdir}/usr/share/{applications,pixmaps}

  install -m644 ${srcdir}/swiftdove.desktop ${pkgdir}/usr/share/applications/
  install -m644 ${srcdir}/swiftdove/icons/swiftdove-128x128.png ${pkgdir}/usr/share/pixmaps/swiftdove.png

  # Translate
  unzip -o ${_pkglang}.xpi

  sed -i "s|jar:chrome/${_pkglang}.jar|jar:${_pkglang}.jar|" chrome.manifest || return 1

  install -D -m 644 chrome/${_pkglang}.jar ${pkgdir}/opt/${_pkgname}/chrome/${_pkglang}.jar || return 1
  install -D -m 644 chrome.manifest ${pkgdir}/opt/${_pkgname}/chrome/${_pkglang}.manifest || return 1
 
  rm ${pkgdir}/opt/${_pkgname}/chrome/en-US.jar
  rm ${pkgdir}/opt/${_pkgname}/chrome/en-US.manifest
  sed -i "s|en-US|${_pkglang}|" ${pkgdir}/opt/${_pkgname}/defaults/pref/all-l10n.js || return 1
}
