# Maintainer: Cravix < dr dot neemous at gmail dot org >
# Contributor: Ronald van Haren <ronald.archlinux.org>

# That's only what I select. Change it as you want.
# the order is the same as the module sets order in ./DOC.
defset=(alarm deskshow exebuf mail news places winselector forecasts 
	engage 
	empris 
	eenvader.fractal photo slideshow 
	eektool execwatch 
	everything-mpris everything-pidgin everything-tracker everything-websearch
)

pkgname=e-modules-extra-svn
pkgver=79887
pkgrel=1
pkgdesc="Extra gadgets for e17"
arch=('i686' 'x86_64')
groups=('e17-extra-svn')
url="http://www.enlightenment.org"
license=('GPLv2' 'LGPLv2' 'MIT')
depends=('enlightenment17' 'efreet' 'e_dbus')
makedepends=('subversion')
conflicts=('e-modules-extra')
provides=('e-modules-extra')
options=('!libtool')
source=('REST' 'DOC')
md5sums=('b597d6d56d72c488cd45dad06ac57015'
         '696e61718865b49f06c74d0ff726d08e')

echo -e "$(tput bold)You can customize the module set (defset) on your own in PKGBUILD.
Also, read ./DOC for more info about the functions of modules.$(tput sgr0)"
sleep 1

_svntrunk="http://svn.enlightenment.org/svn/e/trunk/E-MODULES-EXTRA"
_svnmod="E-MODULES-EXTRA"

build() {
   cd $srcdir
   _svnmod="E-MODULES-EXTRA"

  msg "Connecting to $_svntrunk SVN server...."
  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build

  for i in ${defset[@]}; do
    cd $i
    ./autogen.sh --prefix=/usr
    make
    cd ..
  done
} 

package() {
  _svnmod="E-MODULES-EXTRA"
  
  cd $srcdir/$_svnmod-build

  for i in ${defset[@]}; do

  cd $i
  make DESTDIR=$pkgdir install

# install license files
  if [ -e $srcdir/$_svnmod-build/$i/COPYING ]; then
    install -Dm644 $srcdir/$_svnmod-build/$i/COPYING \
        $pkgdir/usr/share/licenses/$pkgname/$i/COPYING
  fi
 
  if [ -e $srcdir/$_svnmod-build/$i/COPYING-PLAIN ]; then
    install -Dm644 $srcdir/$_svnmod-build/$i/COPYING-PLAIN \
        $pkgdir/usr/share/licenses/$pkgname/$i/COPYING-PLAIN
  fi
 
  cd ..
 done
 rm -r $srcdir/$_svnmod-build

}
