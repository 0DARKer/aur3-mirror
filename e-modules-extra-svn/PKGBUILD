# Maintainer: Cravix < dr dot neemous at gmail dot org >
# Contributor: Ronald van Haren <ronald.archlinux.org>

# That's only what I select. Change it as you want.
# the order is the same as the module sets order in ./DOC.
defset=(alarm deskshow exebuf mail news places winselector forecasts 
	engage 
	empris 
	eenvader.fractal photo slideshow 
	eektool execwatch 
	everything-mpris everything-pidgin everything-tracker everything-websearch
)

pkgname=e-modules-extra-svn
_pkgname=E-MODULES-EXTRA
pkgver=84534
pkgrel=1
pkgdesc="Extra gadgets for e17"
arch=('i686' 'x86_64')
groups=('e17-extra-svn')
url="http://www.enlightenment.org"
license=('GPLv2' 'LGPLv2' 'MIT')
depends=('enlightenment17')
makedepends=('subversion')
optdepends=('eweather-svn: nice weather forecast module')
conflicts=('e-modules-extra')
provides=('e-modules-extra')
options=('!libtool')
source=('REST' 'DOC')
[[ -z $(pacman -Q efl-git 2>/dev/null) ]] \
	&& source+=("svn+http://svn.enlightenment.org/svn/e/trunk/E-MODULES-EXTRA#revision=84534") \
	|| source+=("svn+http://svn.enlightenment.org/svn/e/trunk/E-MODULES-EXTRA")
md5sums=('31c815db3472b91a4cba273281f8fa1e'
         '85443d725a3aebe1a7680cad505b0630'
         'SKIP')

echo -e "$(tput bold)You can customize the module set (defset) on your own in PKGBUILD.
Also, read ./DOC for more info about the functions of modules.$(tput sgr0)"
sleep 1
pkgver() {
	[[ -z $(pacman -Q efl-git 2>/dev/null) ]] && echo 84534 || {
		cd "$SRCDEST/$_pkgname"
		LC_ALL=C svn info | awk '/Last Changed Rev/ {print $4}'
	}
}

build() {

  cd "$srcdir/$_pkgname"
    
  #Adjust
  [[ -n $(pacman -Q e_dbus 2>/dev/null) ]] && {
		for mod in everything-mpris everything-pidgin everything-shotgun everything-tracker everything-websearch empris; do
		  sed -i '1i\#include "E_DBus.h"' $mod/src/e_mod_main.c
    done
    sed -i '1i\#include "E_DBus.h"' everything-shotgun/src/evry_plug_msg.c
	}

  for i in ${defset[@]}; do
    cd $i
    ./autogen.sh --prefix=/usr
    make
    cd ..
  done
} 

package() {
  cd $srcdir/$_pkgname

  for i in ${defset[@]}; do
    cd $i
    make DESTDIR=$pkgdir install
    # install license files
    if [ -e $srcdir/$_svnmod-build/$i/COPYING ]; then
      install -Dm644 $srcdir/$_svnmod-build/$i/COPYING \
          $pkgdir/usr/share/licenses/$pkgname/$i/COPYING
    fi
    if [ -e $srcdir/$_svnmod-build/$i/COPYING-PLAIN ]; then
      install -Dm644 $srcdir/$_svnmod-build/$i/COPYING-PLAIN \
          $pkgdir/usr/share/licenses/$pkgname/$i/COPYING-PLAIN
    fi
    cd ..
 done
}
