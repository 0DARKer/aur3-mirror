# Contributor: Massimiliano Torromeo <Massimiliano DOT Torromeo AT gmail DOT com>
# Contributor: Tom < tomgparchaur at gmail dot com >

pkgname=dropbox-experimental
_pkgname=dropbox
pkgver=1.1.3
pkgrel=1
pkgdesc="Secure backup, sync and sharing made easy. (Experimental Build)"
arch=("i686" "x86_64")
url="http://www.dropbox.com"
license=(custom)
depends=("bzip2" "dbus-glib" "gtk2" "libsm")
provides=("dropbox")
conflicts=("dropbox")
options=('!strip')

_source_arch="x86"
[ "$CARCH" = "x86_64" ] && _source_arch="x86_64"

md5sums=('b210f4dac3b6d0fd45a6f7f4f6e166e3' '9ec50da2ce59ed8c17606394b9c5e1c0' '5365fa9ab8be10f2f9cd4fb53fa9f7e2' '619b5a2e49b48f564423a850c94312d7')
[ "$CARCH" = "x86_64" ] && md5sums[0]='d45d7e4db1b542facd919e3ff1c3aa99'

source=("https://dl-web.dropbox.com/u/17/${_pkgname}-lnx.${_source_arch}-${pkgver}.tar.gz" "dropbox.png" "dropbox.desktop" "terms.html")

build() {
	install -d "$pkgdir/opt"
	rm "$srcdir/.dropbox-dist/libstdc++.so.6"
	cp -R "$srcdir/.dropbox-dist" "$pkgdir/opt/dropbox"

	find ${pkgdir}/opt/dropbox/ -type f -exec chmod 644 {} \;
	find ${pkgdir}/opt/dropbox/ -type d -exec chmod 755 {} \;
	chmod 755 ${pkgdir}/opt/dropbox/dropboxd
	chmod 755 ${pkgdir}/opt/dropbox/dropbox
	chown -R root.root ${pkgdir}/opt/dropbox

	install -d "$pkgdir/usr/bin"
	ln -s "/opt/dropbox/dropboxd" "$pkgdir/usr/bin/dropboxd"

	install -D -m 644 "$srcdir/dropbox.desktop" "$pkgdir/usr/share/applications/dropbox.desktop"
	install -D -m 644 "$srcdir/dropbox.png" "$pkgdir/usr/share/pixmaps/dropbox.png"
	install -D -m 644 "$srcdir/terms.html" "$pkgdir/usr/share/licenses/${pkgname}/terms.html"
}
