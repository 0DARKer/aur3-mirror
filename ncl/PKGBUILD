# Maintainer: (epsilom) Xavier Corredor <xavier.corredor.llano (a) gmail.com>

pkgname=ncl
pkgver=5.2.1	
pkgrel=4
pkgdesc="Ncar Command Language, is an interpreted language designed specifically for scientific data analysis and visualization"
url="http://www.ncl.ucar.edu"
license=('custom:NCL Source Code License')
arch=('i686' 'x86_64')
depends=('netcdf' 'hdf5' 'triangle' 'hdf-eos2' 'hdf-eos5' 'hdf4-nonetcdf' 'vis5d+')
makedepends=('glibc' 'gcc' 'gcc-fortran' 'libjpeg' 'libpng' 'jasper' 'zlib' 'udunits2' 'unzip' 'tcsh' 'libx11' 'imake')
provides=('ncl')
source=('http://dl.dropbox.com/u/3383807/ncl_ncarg_src-5.2.1.tar.gz' 'http://www.netlib.org/voronoi/triangle.zip' 'patch' 'Site.local')
md5sums=('c7ba4847961f38bbbac30ac042eab43a'
         '10aff8d7950f5e0e2fb6dd2e340be2c9'
         '318196b35d1a2ae9013fabddf90e2032'
         '1f8f875d7a7f65097a631863b9d86f7b')

build() {
  
  #copy triangle library
  cd $srcdir
  cp triangle.c triangle.h ${pkgname}_ncarg-$pkgver/ni/src/lib/hlu/

  cd $srcdir/${pkgname}_ncarg-$pkgver

  #patch compile and install
  patch -Np1 -i ../../patch
  
  #configure
  #./Configure -ncar || return 1
  cp $srcdir/Site.local config/
  sed -i "s|YmakeRoot /usr|YmakeRoot ${pkgdir}/usr|g" config/Site.local
  ./config/ymkmf

  #build and install
  make  Everything || return 1
  
  #compress and put in order man files
  cd $pkgdir/usr/man
  for listman in `ls` 
  do
    mkdir -p $pkgdir/usr/share/man/$listman
    cd $pkgdir/usr/man/$listman
    for manfiles in `ls`
    do
      gzip $manfiles
      mv ${manfiles}.gz $pkgdir/usr/share/man/$listman/
    done
  done
  rm -Rf $pkgdir/usr/man/

}
