# Maintainer: David Spicer <azleifel at googlemail dot com>
# Contributor: Leszek Czurylo <leniu_user@wp.pl>

pkgname=vdr-epgsearch
_pluginname=epgsearch
pkgver=0.9.24
pkgrel=3
arch=('i686' 'x86_64')
pkgdesc="A VDR plugin providing a replacement schedule with extended functionality"
url="http://winni.vdr-developer.org/epgsearch/"
license=('GPL2')
depends=('vdr' 'perl')
backup=('etc/vdr/plugins/epgsearch/epgsearchcats.conf'
        'etc/vdr/plugins/epgsearch/epgsearchcmds.conf'
        'etc/vdr/plugins/epgsearch/epgsearchmenu.conf')
install=${pkgname}.install
source=(http://winni.vdr-developer.org/epgsearch/downloads/${pkgname}-${pkgver}.tgz
        epgsearch-0.9.24-const.diff
        epgsearch-0.9.24-langinfo.diff)
md5sums=('4f0b1d7bdc6f24478f2670769547d7db'
         '8c702742b790e4a234851f353117867e'
         '461b87271b9fa8f99277bb7eb19ebcda')

build() {
  cd ${srcdir}/${_pluginname}-${pkgver}

  patch -Np1 -i ${startdir}/epgsearch-0.9.24-const.diff || return 1
  patch -Np1 -i ${startdir}/epgsearch-0.9.24-langinfo.diff || return 1

  # Assumed VDR directory environment (VDRDIR/Make.config):
  # MANDIR       = /usr/share/man
  # BINDIR       = /usr/bin
  # LOCDIR       = /usr/share/locale
  # PLUGINLIBDIR = /usr/lib/vdr
  # VIDEODIR     = /var/spool/video
  # CONFDIR      = /etc/vdr
  
  install -d -m755 ${pkgdir}/etc/vdr/plugins/${_pluginname} || return 1
  install -d -m755 ${pkgdir}/usr/bin || return 1
  install -d -m755 ${pkgdir}/usr/lib/vdr || return 1
  install -d -m755 ${pkgdir}/usr/share/doc/${pkgname} || return 1
  install -d -m755 ${pkgdir}/usr/share/locale || return 1
  install -d -m755 ${pkgdir}/usr/share/man || return 1
  
  make VDRDIR=/usr/include/vdr \
       LIBDIR=${pkgdir}/usr/lib/vdr \
       LOCALEDIR=${pkgdir}/usr/share/locale \
       MANDIR=${pkgdir}/usr/share/man all install-doc || return 1

  # Install scripts
  install -m755 scripts/*.{pl,sh} ${pkgdir}/usr/bin || return 1

  # Install configuration files
  install -m644 conf/* ${pkgdir}/etc/vdr/plugins/${_pluginname} || return 1
  install -m644 conf/epgsearchcats.conf-epgdata ${pkgdir}/etc/vdr/plugins/${_pluginname}/epgsearchcats.conf || return 1
  install -m644 scripts/*.conf ${pkgdir}/etc/vdr/plugins/${_pluginname}

  # Install documents
  for _file in README README.DE HISTORY HISTORY.DE MANUAL; do
    install -m644 ${_file} ${pkgdir}/usr/share/doc/${pkgname} || return 1
  done
}
