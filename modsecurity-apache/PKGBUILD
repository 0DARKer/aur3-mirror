# Maintainer: dethwish <richiefrich AT penguinslair DOT org>
# Contributor: CRT <crt.011@gmail.com>

pkgname=modsecurity-apache
pkgver=2.5.13
_pkgname=modsecurity-crs
_pkgver=2.0.8
pkgrel=1
pkgdesc="An open source web application firewall that runs as an Apache module.\
        Core Rule Set which provides critical protections against attacks across most every web architecture."
url="http://www.modsecurity.org \
        http://www.modsecurity.org/projects/rules/"
arch=('i686' 'x86_64')
license=('GPLv2')
depends=('apache>=2.0' 'apr' 'apr-util' 'pcre' 'libxml2')
optdepends=('lua>=5.1' 'curl>=7.15.1')
#backup=('/etc/httpd/conf/mod_security.conf' '/etc/httpd/conf/httpd.conf')
source=(http://softlayer.dl.sourceforge.net/sourceforge/mod-security/${pkgname}_${pkgver}.tar.gz
        http://voxel.dl.sourceforge.net/project/mod-security/${_pkgname}/0-CURRENT/${_pkgname}_${_pkgver}.tar.gz
        mod_security.conf)

md5sums=('92b0ed7dec188650ea9d78dfc326e8ec'
         'c48f36a2b42ca47a01b445a44e72e448'
         '0c2e6216b2c988b79a9ef03457956b33')


build() {
	cd ${srcdir}/${pkgname}_${pkgver}/apache2

	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--enable-verbose-output \
		--with-apxs=/usr/sbin/apxs \
	make
	make mlogc
  make DESTDIR="${pkgdir}" install
}


package() {
	cd ${srcdir}/${pkgname}_${pkgver}

  install -D -dm755 ${pkgdir}/etc/httpd/${pkgname}
  install -m644 modsecurity.conf-minimal ${pkgdir}/etc/httpd/${pkgname}

#  install -D -m755 ${pkgdir}/usr/lib/httpd/modules/mod_security2.so

  install -D -dm755 ${pkgdir}/usr/share/licenses/${pkgname}
  install -m644 LICENSE ${pkgdir}/usr/share/licenses/${pkgname}/LICENSE
}
