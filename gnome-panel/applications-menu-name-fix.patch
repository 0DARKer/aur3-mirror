From 586704dd80b6d57d94f483fa4e2df4924b6343ac Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Alberts=20Muktup=C4=81vels?= <alberts.muktupavels@gmail.com>
Date: Tue, 3 Jun 2014 10:23:59 +0300
Subject: Use correct applications .menu file * gnome-menus renamed
 applications.menu to gnome-applications.menu   since 3.7.90 version. Update
 to reflect this change. * Bump required libgnome-menu-3.0 version to 3.7.90


diff --git a/configure.ac b/configure.ac
index 9442cc1..64aef07 100644
--- a/configure.ac
+++ b/configure.ac
@@ -70,7 +70,7 @@ GLIB_REQUIRED=2.35.0
 GTK_REQUIRED=3.3.8
 LIBWNCK_REQUIRED=3.4.6
 GCONF_REQUIRED=2.6.1
-LIBGNOME_MENU_REQUIRED=3.1.4
+LIBGNOME_MENU_REQUIRED=3.7.90
 TELEPATHY_GLIB_REQUIRED=0.14.0
 LIBECAL_REQUIRED=3.5.3
 LIBEDATASERVER_REQUIRED=3.5.3
diff --git a/gnome-panel/menu.c b/gnome-panel/menu.c
index 7bda2bc..96cc738 100644
--- a/gnome-panel/menu.c
+++ b/gnome-panel/menu.c
@@ -1399,7 +1399,7 @@ create_main_menu (PanelWidget *panel)
 {
 	GtkWidget *main_menu;
 
-	main_menu = create_applications_menu ("applications.menu", NULL, TRUE);
+	main_menu = create_applications_menu ("gnome-applications.menu", NULL, TRUE);
 
 	g_object_set_data (G_OBJECT (main_menu), "menu_panel", panel);
 	/* FIXME need to update the panel on parent_set */
diff --git a/gnome-panel/panel-addto.c b/gnome-panel/panel-addto.c
index 71da616..23eb179 100644
--- a/gnome-panel/panel-addto.c
+++ b/gnome-panel/panel-addto.c
@@ -663,7 +663,7 @@ panel_addto_make_application_model (PanelAddtoDialog *dialog)
 				    G_TYPE_POINTER,
 				    G_TYPE_STRING);
 
-	tree = gmenu_tree_new ("applications.menu", GMENU_TREE_FLAGS_SORT_DISPLAY_NAME);
+	tree = gmenu_tree_new ("gnome-applications.menu", GMENU_TREE_FLAGS_SORT_DISPLAY_NAME);
 
 	if (!gmenu_tree_load_sync (tree, NULL)) {
 		g_object_unref (tree);
@@ -672,7 +672,7 @@ panel_addto_make_application_model (PanelAddtoDialog *dialog)
 
 	if (tree != NULL && (root = gmenu_tree_get_root_directory (tree))) {
 		panel_addto_make_application_list (&dialog->application_list,
-						   root, "applications.menu",
+						   root, "gnome-applications.menu",
 						   PANEL_ADDTO_MENU_SHOW_ALL);
 		panel_addto_populate_application_model (store, NULL, dialog->application_list);
 
diff --git a/gnome-panel/panel-menu-bar.c b/gnome-panel/panel-menu-bar.c
index 157bb33..f633c8b 100644
--- a/gnome-panel/panel-menu-bar.c
+++ b/gnome-panel/panel-menu-bar.c
@@ -114,7 +114,7 @@ panel_menu_bar_init (PanelMenuBar *menubar)
 
 	menubar->priv->info = NULL;
 
-	menubar->priv->applications_menu = create_applications_menu ("applications.menu", NULL, TRUE);
+	menubar->priv->applications_menu = create_applications_menu ("gnome-applications.menu", NULL, TRUE);
 
 	menubar->priv->applications_item = panel_image_menu_item_new ();
 	gtk_menu_item_set_label (GTK_MENU_ITEM (menubar->priv->applications_item),
diff --git a/gnome-panel/panel-menu-button.c b/gnome-panel/panel-menu-button.c
index d2de81b..7846e5c 100644
--- a/gnome-panel/panel-menu-button.c
+++ b/gnome-panel/panel-menu-button.c
@@ -71,7 +71,7 @@ typedef struct {
 } MenuPathRootItem;
 
 static MenuPathRootItem root_items [] = {
-	{ APPLICATIONS_MENU, "applications", "applications.menu" },
+	{ APPLICATIONS_MENU, "applications", "gnome-applications.menu" },
 	{ GNOMECC_MENU,      "gnomecc",      "gnomecc.menu"      }
 };
 
diff --git a/gnome-panel/panel-run-dialog.c b/gnome-panel/panel-run-dialog.c
index 91a80d7..3d4ef3f 100644
--- a/gnome-panel/panel-run-dialog.c
+++ b/gnome-panel/panel-run-dialog.c
@@ -914,7 +914,7 @@ get_all_applications (void)
 	GMenuTreeDirectory *root;
 	GSList             *retval;
 
-	tree = gmenu_tree_new ("applications.menu", GMENU_TREE_FLAGS_SORT_DISPLAY_NAME);
+	tree = gmenu_tree_new ("gnome-applications.menu", GMENU_TREE_FLAGS_SORT_DISPLAY_NAME);
 
 	if (!gmenu_tree_load_sync (tree, NULL))
 		return NULL;
-- 
cgit v0.10.1

