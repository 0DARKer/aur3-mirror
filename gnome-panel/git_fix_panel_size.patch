Description: fix problem when panel size not updated
Origin: upstream
 - https://git.gnome.org/browse/gnome-panel/commit/?id=9441b094c2fa6a
 - https://git.gnome.org/browse/gnome-panel/commit/?id=66f077722a12e4
Last-Update: 2014-01-11

--- a/gnome-panel/panel-toplevel.c
+++ b/gnome-panel/panel-toplevel.c
@@ -2678,7 +2678,6 @@
 panel_toplevel_check_resize (GtkContainer *container)
 {
 	GtkAllocation   allocation;
-	GtkAllocation   widget_allocation;
 	GtkRequisition  requisition;
 	GtkWidget      *widget;
 
@@ -2687,17 +2686,12 @@
 	if (!gtk_widget_get_visible (widget))
 		return;
 
-	requisition.width  = -1;
-	requisition.height = -1;
-
 	gtk_widget_get_preferred_size (widget, &requisition, NULL);
-	gtk_widget_get_allocation (widget, &widget_allocation);
+	gtk_widget_get_allocation (widget, &allocation);
 
-	if (widget_allocation.width  != requisition.width ||
-	    widget_allocation.height != requisition.height)
-		return;
+	allocation.width = requisition.width;
+	allocation.height = requisition.height;
 
-	allocation = widget_allocation;
 	gtk_widget_size_allocate (widget, &allocation);
 }
 
--- a/gnome-panel/panel-widget.c
+++ b/gnome-panel/panel-widget.c
@@ -1286,14 +1286,6 @@
 		}
 	}
 
-
-	if (!panel->packed) {
-		if (panel->orient == GTK_ORIENTATION_HORIZONTAL)
-			requisition->width = panel->size;
-		else
-			requisition->height = panel->size;
-	}
-
 	dont_fill = panel->packed && panel->nb_applets_size_hints != 0;
 
 	if (panel->orient == GTK_ORIENTATION_HORIZONTAL) {
