# Contributor: Orivej Desh <masecretaire@gmx.fr>
# Maintainer: Orivej Desh <masecretaire@gmx.fr>
pkgname=tribler
pkgver=5.3.7
pkgrel=1
pkgdesc="A 4th generation file sharing system bittorrent client"
arch=('i686' 'x86_64')
url="http://www.tribler.org"
license=('MIT')
depends=('python2' 'openssl' 'swig' 'wxpython' 'python-m2crypto>=0.16' 'python2-apsw')
makedepends=('subversion')
source=("tribler.sh" "swarmplayer.sh" "poor-code.patch")
md5sums=('8cce1eee5f77dd740299623dce475dfd' '4dbb331a4f33eae1b779fe5a71a3e5a3' '7c17b25db7adcdd35f249352be6919e3')

build() {
  cd "$srcdir"

  svn co http://svn.tribler.org/abc/tags/tribler-$pkgver tribler-$pkgver

  cd tribler-$pkgver

  mkdir -p "$pkgdir/usr/share/tribler"
  cp -rf Tribler "$pkgdir/usr/share/tribler/"
  cd "$pkgdir/usr/share/tribler/Tribler"
  find . -name .svn -print0 | xargs -0 rm -rf
  sed -i -e 's#/usr/bin/python#/usr/bin/python2#' Main/{channelcast-supporter,metadata-injector,tribler,crawler}.py \
    Debug/memory.py Transport/bgprocess/{bgprocessd,swarmengined} Test/API/contentdir/file.avi
  patch -p2 -i "$srcdir/poor-code.patch"
  python2 -m compileall .

  install -Dm644 ./Main/Build/Ubuntu/tribler.1 "$pkgdir/usr/share/man/man1/tribler.1"
  install -D ./Main/Build/Ubuntu/tribler.desktop "$pkgdir/usr/share/applications/tribler.desktop"
  install -D ./Main/Build/Ubuntu/tribler_big.xpm "$pkgdir/usr/share/pixmaps/tribler.xpm"

  install -Dm644 ./Player/Build/Ubuntu/swarmplayer.1 "$pkgdir/usr/share/man/man1/swarmplayer.1"
  install -D ./Player/Build/Ubuntu/swarmplayer.desktop "$pkgdir/usr/share/applications/swarmplayer.desktop"
  install -D ./Player/Build/Ubuntu/swarmplayer_big.xpm "$pkgdir/usr/share/pixmaps/swarmplayer.xpm"

  install -D "$srcdir/tribler.sh" "$pkgdir/usr/bin/tribler"
  install -D "$srcdir/swarmplayer.sh" "$pkgdir/usr/bin/swarmplayer"
  install -Dm644 LICENSE.txt "$pkgdir/usr/share/licenses/tribler/LICENSE"
}

