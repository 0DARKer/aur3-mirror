pkgname=nyancat
pkgver=20120210
pkgrel=1
pkgdesc="Nyancat rendered with various bits of ANSI"
arch=('i686' 'x86_64')
url="http://miku.acm.uiuc.edu/"
license=('NCSA')
depends=()
makedepends=()
source=('nyancat')
md5sums=('a5979d314380ba110cc454fe32698a32')
optdepends=('socat: Telnet Daemon initscript')

_gitroot='git://github.com/klange/nyancat.git'
_gitname='nyancat-git'
_buildir=${_gitname}-build

build() {
	cd ${srcdir}

	msg 'Connecting to GIT server...'
	if [ -d ${_gitname} ]; then
		cd ${_gitname} && git pull origin
		cd ..
	else
		git clone ${_gitroot} ${_gitname}
	fi

	msg 'GIT checkout done or server timeout.'

	if [ -d ${_buildir} ]; then
		msg 'Cleaning previous build...'
		rm -rf ${_buildir}
	fi

	git clone ${_gitname} ${_buildir}
	cd ${_buildir}

	msg 'Starting make...'

	make || return 1

	msg 'Installing file(s)...'

	install -Dm755 src/nyancat ${pkgdir}/usr/bin/nyancat
	install -Dm754 ${srcdir}/nyancat ${pkgdir}/etc/rc.d/nyancat

	rm -rf ${srcdir}/${_buildir}
}
