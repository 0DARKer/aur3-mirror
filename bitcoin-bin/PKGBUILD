## Maintainer : shahid <helllamer@gmail.com>
## Long PKGBUILD description, todo, wiki:
## * https://bitbucket.org/helllamer/archlinux-pkgbuild/wiki/pkgbuild/bitcoin

## Wanna take part on development my PKGBUILDs? Feel welcome on my repo:
## * https://bitbucket.org/helllamer/archlinux-pkgbuild/

prog=bitcoin
pkgname=${prog}-bin
pkgver=0.4.0
pkgrel=1
pkgdesc="Bitcoin is a peer-to-peer network based digital currency (precompiled binary official version, statically linked against wxgtk-2.9 and libboost)"
arch=('i686' 'x86_64')
[ "$CARCH" = "i686"   ] && BTC_ARCH=32
[ "$CARCH" = "x86_64" ] && BTC_ARCH=64
url="http://www.bitcoin.org/"
depends=('expat' 'gcc-libs' 'freetype2' 'libpng12' 'libpng' 'libjpeg6' 'gtk2')
license=('MIT')
conflicts=('bitcoin')
# install=${prog}-bin.install
source=("http://downloads.sourceforge.net/sourceforge/${prog}/${prog}-${pkgver}-linux.tar.gz"
	"${prog}.desktop")
md5sums=('cb085fef9d49d25e7f3dd263950b1ed2'
	 '8902bb14f88911919dfc7bd369209114')
s1=$srcdir/${prog}-${pkgver}-linux
src=$s1/src/src/
bin=$s1/bin/$BTC_ARCH/

build() {
	msg "*** Please, use bitcoin package instead of bitcoin-bin if possible."
	cd $srcdir
	tar xf ${prog}-${pkgver}-linux.tar.gz
}

# 0.4.0: remove shit from macosx faggots
rm_macosx_shit() {
        pushd $srcdir
        find | grep bitcoin | grep '/\._' | xargs rm
        popd
}

package() {
        rm_macosx_shit >/dev/null

	mkdir -p $pkgdir/usr/bin
	mkdir -p $pkgdir/usr/share/pixmaps
	mkdir -p $pkgdir/usr/share/applications
	
	# pack pre-compiled binaries
	install -D -m755 $bin/* $pkgdir/usr/bin/ || return 1
	
	# install locales (FIXME bicycle with find|xargs)
	mkdir -p $pkgdir/usr/share/locale
	cd $s1/locale/
	find -name *.mo | xargs -I{} install -D -m644 {} $pkgdir/usr/share/locale/{}

	# add icon and .desktop file to pkg
	install -D -m644 $src/xpm/bitcoin48.xpm $pkgdir/usr/share/pixmaps/
	install -D -m644 $srcdir/${prog}.desktop $pkgdir/usr/share/applications/ 
}
