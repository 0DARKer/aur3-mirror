# Maintainer: Addict7 <nicolasfloquet@gmail.com>
# Contributor: eht16 <enrico.troeger@uvena.de>
pkgname=geany-plugins-svn
pkgver=1489
pkgrel=1
pkgdesc="Various plugins for Geany"
arch=('i686' 'x86_64')
url="http://geany.uvena.de"
license=('GPL')
depends=('gtk2' 'geany-svn>=0.18')
# gtkspell is an optional dep for GeanyVC, enchant is a hard dep for spellcheck
makedepends=('subversion' 'libtool' 'python' 'gtkspell' 'enchant')
install=geany-plugins-svn.install

source=()
md5sums=()

_svntrunk=https://geany-plugins.svn.sourceforge.net/svnroot/geany-plugins/trunk/geany-plugins
_svnmod=geany-plugins

build() {
  cd $startdir/src

  if [ -d $_svnmod/.svn ]; then
    (cd $_svnmod && svn up -r $pkgver)
  else
    svn co $_svntrunk --config-dir ./ -r $pkgver $_svnmod
  fi

  msg "SVN checkout done or server timeout"
  msg "Starting make..."

  cp -r $_svnmod $_svnmod-build
  cd $_svnmod-build

  # to build only a selection of the available plugins, add --enable-plugins to the configure line
  # like this : ./waf configure --prefix=/usr --enable-plugins=geanydoc,geanyvc,spellcheck
  ./waf configure --prefix=/usr || return 1
  ./waf build --jobs=1 || return 1 # makepkg has problems when waf is using more than one job
  ./waf --destdir=$startdir/pkg/ install

  rm -rf $startdir/src/$_svnmod-build
}
