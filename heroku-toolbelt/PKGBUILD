# Maintainer: pisuka <tekmon@gmail.com>
pkgname=heroku-toolbelt
pkgver=3.0.1
pkgrel=2
pkgdesc="Everything you need to get started using Heroku (including foreman 0.63.0)"
arch=(any)
url="https://toolbelt.heroku.com"
license=(MIT APACHE RUBY PerlArtistic GPL custom)
groups=()
depends=("ruby>=1.9")
makedepends=("ruby-bundler")
optdepends=(git)
provides=()
conflicts=(ruby-heroku ruby-foreman heroku-client)
replaces=()
backup=()
options=()
install=
source=(http://assets.heroku.com/heroku-client/heroku-client-${pkgver}.tgz Gemfile Gemfile.lock)
md5sums=(925db44aa0154ce873f1dd1a97370279 87c0b38b89cba72f964cff2a2df7c33e 8719f2ed74f0c2a34bb325161e5a5b50)

package() {
	cd "$pkgdir"
	mkdir -p "usr/lib/ruby/vendor_ruby/$pkgname" "usr/bin" "usr/share/man/man1"
	cd "usr/lib/ruby/vendor_ruby/$pkgname"

	cp -R "$srcdir/heroku-client" .
	cp -L "$srcdir"/Gemfile* .

	find "heroku-client/bin" -maxdepth 1 -type f -executable -printf "/usr/lib/ruby/vendor_ruby/$pkgname/heroku-client/bin/%f\n" | xargs ln -st "$pkgdir/usr/bin/"

	ln -s "/usr/lib/ruby/vendor_ruby/heroku-toolbelt/vendor/bundle/ruby/2.0.0/gems/foreman-0.63.0/man/foreman.1" "$pkgdir/usr/share/man/man1/foreman.1"

	msg "Installing foreman..."

	bundle install --standalone --deployment --binstubs="$pkgdir/usr/bin"

	rm "$pkgdir/usr/bin/thor"
}

# vim:set ts=2 sw=2 et:
