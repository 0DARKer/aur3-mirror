diff --git a/configure.ac b/configure.ac
index 9d95e4d..9bd55fa 100644
--- a/configure.ac
+++ b/configure.ac
@@ -14,6 +14,7 @@ AC_PROG_LIBTOOL
 AM_PROG_CC_C_O
 AC_PROG_INSTALL
 AM_ICONV
+PKG_PROG_PKG_CONFIG
 
 # Optionally enable and check for doxygen
 AC_ARG_ENABLE([doxygen],
@@ -39,6 +40,8 @@ AM_CONDITIONAL([BUILD_OPENCMA], [test "x$ac_enable_opencma" != "xno"])
 AM_CONDITIONAL([STATIC_OPENCMA], [test "x$ac_enable_opencma" != "xdynamic"])
 
 # Checks for libraries.
+PKG_CHECK_MODULES(LIBUSB, libusb-1.0)
+PKG_CHECK_MODULES(XML, libxml-2.0)
 AC_CHECK_LIB([xml2], [xmlReadMemory], [], [AC_MSG_ERROR([libxml2 not found])])
 #AC_CHECK_HEADERS([libxml/parser.h libxml/xmlmemory.h libxml/xmlwriter.h], [], [AC_MSG_ERROR([Cannot find libxml2 header])])
 AC_CHECK_LIB([usb-1.0], [libusb_init], [], [AC_MSG_ERROR([libusb-1.0 not found])])
diff --git a/src/Makefile.am b/src/Makefile.am
index 117ee51..d458ea1 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -31,8 +31,8 @@ LT_CURRENT_MINUS_AGE=`expr $(CURRENT) - $(AGE)`
 # shared library for installing
 lib_LTLIBRARIES=libvitamtp.la
 libvitamtp_la_SOURCES=vitamtp.h datautils.c device.c ptp.c vitamtp.c
-libvitamtp_la_CFLAGS=-std=gnu99 -fgnu89-inline
-libvitamtp_la_LDFLAGS=-no-undefined -export-symbols-regex "VitaMTP_[0-9A-Za-z_]+" -version-info $(SOVERSION)
+libvitamtp_la_CFLAGS=-std=gnu99 -fgnu89-inline $(XML_CFLAGS) $(LIBUSB_CFLAGS)
+libvitamtp_la_LDFLAGS=$(XML_LIBS) $(LIBUSB_LIBS) -no-undefined -export-symbols-regex "VitaMTP_[0-9A-Za-z_]+" -version-info $(SOVERSION)
 
 if BUILD_OPENCMA
 # static library for linking
