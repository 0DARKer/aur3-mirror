# Maintainer: Kowalczyk Patryk <patryk AT kowalczyk DOT ws>

pkgname=exfat-git 
_gitname=exfat-nofuse
pkgver=31.bc2d856
pkgrel=1
_kernver=`uname -r`
pkgdesc='Native support for exfat (nofuse) - git'
arch=('i686' 'x86_64')
url='https://github.com/rxrz/exfat-nofuse'
license=('unknown')
depends=('linux>=3.8' 'linux<3.10')
makedepends=('linux-headers' 'git')
source=("git+https://github.com/rxrz/exfat-nofuse.git")
md5sums=('SKIP')
install="$pkgname.install"
replaces=('exfat')
conflicts=('exfat')
provides=('exfat')

pkgver() {
  cd  "${srcdir}/${_gitname}"
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
}

build() {
    cd ${srcdir}
msg "GIT checkout done or server timeout"
msg "Starting make..."
#rm -rf "$srcdir/$_gitname-build"
#  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
 cd "${srcdir}/${_gitname}"

	make	
}

package() {
	gzip ${srcdir}/$_gitname/exfat_fs.ko
	gzip ${srcdir}/$_gitname/exfat_core.ko
 	install -Dm644 ${srcdir}/$_gitname/exfat_fs.ko.gz ${pkgdir}/usr/lib/modules/${_kernver}/extramodules/exfat_fs.ko.gz
 	install -Dm644 ${srcdir}/$_gitname/exfat_core.ko.gz ${pkgdir}/usr/lib/modules/${_kernver}/extramodules/exfat_core.ko.gz
}
