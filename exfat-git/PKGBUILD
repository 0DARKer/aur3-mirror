# Maintainer: Kowalczyk Patryk <patryk AT kowalczyk DOT ws>

pkgname=exfat-git 
pkgver=20130703
pkgrel=1
_kernver=`uname -r`
pkgdesc='Native support for exfat (nofuse) - git'
arch=('i686' 'x86_64')
url='https://github.com/rxrz/exfat-nofuse'
license=('unknown')
depends=('linux>=3.8' 'linux<3.10')
makedepends=('linux-headers' 'git')
_gitroot="https://github.com/rxrz/exfat-nofuse.git"
_gitname="exfat-nofuse"
install="$pkgname.install"
replaces=('exfat')
conflicts=('exfat')
provides=('exfat')

build() {
    cd ${srcdir}
    msg "Connecting..." 
if [ -d $_gitname ] ; then
    cd $_gitname && git pull origin
    msg "The local files are updated."
else
    git clone $_gitroot $_gitname
fi

msg "GIT checkout done or server timeout"
msg "Starting make..."
rm -rf "$srcdir/$_gitname-build"
  git clone "$srcdir/$_gitname" "$srcdir/$_gitname-build"
 cd "$srcdir/$_gitname-build"

#
# BUILD HERE
#
	make	
}

package() {
	gzip ${srcdir}/$_gitname-build/exfat_fs.ko
	gzip ${srcdir}/$_gitname-build/exfat_core.ko
 	install -Dm644 ${srcdir}/$_gitname-build/exfat_fs.ko.gz ${pkgdir}/usr/lib/modules/${_kernver}/extramodules/exfat_fs.ko.gz
 	install -Dm644 ${srcdir}/$_gitname-build/exfat_core.ko.gz ${pkgdir}/usr/lib/modules/${_kernver}/extramodules/exfat_core.ko.gz
}
