# Maintainer: zlowly <zlowly@gmail.com>
pkgname=wqy-microhei-nightly_build
_pkgname=wqy-microhei
pkgver=0.2
pkgrel=2
pkgdesc="A Sans-Serif style high quality CJK outline font. This is a nightly-build version."
arch=(any)
license=('GPL3' 'APACHE' 'custom:"font embedding exception"')
install=${pkgname}.install
url="http://wenq.org"
depends=('fontconfig' 'xorg-font-utils')
conflicts=('wqy-microhei')
provides=('wqy-microhei')
source=('44-wqy-microhei.conf')
md5sums=('ab808b1aeac032f505837bd3ab653c1e')
build() {
  cd ${srcdir}
  FX_SRC="${_pkgname}-${pkgver}.nightly-build.tar.gz"
  FX_SRC_URI="http://wenq.org/forum/download/file.php?id=26"
  msg "Downloading..."
  wget --keep-session-cookie --save-cookies "wqy.cookies" --post-data "login=登录&password=download&username=download" "http://wenq.org/forum/ucp.php?mode=login" -O "wqy.login" || exit 1
  wget --load-cookies "wqy.cookies" "$FX_SRC_URI" -O "$FX_SRC"|| exit 1
  msg "Extracting..."
  bsdtar -x -f ${FX_SRC} || return 1
  msg "Packaging..."
  cd $srcdir/${_pkgname}
  tail README.txt --lines=16|head --lines=-3>| FONTEXCEPTION
  mkdir -p $pkgdir/usr/share/fonts/wenquanyi/${_pkgname}
  mkdir -p $pkgdir/usr/share/licenses/${_pkgname}
  mkdir -p $pkgdir/etc/fonts/conf.avail/
  mkdir -p $pkgdir/etc/fonts/conf.d/
  install -m644 $srcdir/*.conf $pkgdir/etc/fonts/conf.avail/ || return 1
  install -m644 -D FONTEXCEPTION $pkgdir/usr/share/licenses/${_pkgname}/FONTEXCEPTION || return 1
  install -m644 *.ttc $pkgdir/usr/share/fonts/wenquanyi/${_pkgname}/ || return 1
  cd $pkgdir/etc/fonts/conf.d/
  ln -s ../conf.avail/44-wqy-microhei.conf .
}
# vim:set ts=2 sw=2 et:
