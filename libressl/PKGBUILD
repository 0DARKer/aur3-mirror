# Maintainer: Reventlov <contact@volcanis.me>
# Your system will be break if you install this. For breaking purpose only

pkgname=libressl
pkgver=2.0.0
pkgrel=6
pkgdesc='FREE version of the SSL/TLS protocol forked from OpenSSL - Portable edition'
arch=('i686' 'x86_64')
# Uncomment this if you know what you are doing - libressl is not yet a replacement of openssl
#provides=(openssl=2.0.0)
#conflicts=(openssl)
url='http://www.libressl.org/'
license=('custom:Openssl')
source=("http://ftp.openbsd.org/pub/OpenBSD/LibreSSL/libressl-$pkgver.tar.gz" "libressl-entropy-nonsense.patch" "libressl.install")
sha1sums=('c078e98f86bb37dca8340ab17bc1efd8620c3286'
          'b9545ab8fd29befdaf04da8b61ba308a1f682128'
          'b85f7b6e361292d083d16155fde0f56074618728')


build() {
    cd $srcdir/$pkgname-$pkgver
    sed -i "s/-Werror//g" configure
    # Avoid breaking anything that uses -fvisibility=hidden by removing the use of the adress of main() to generate entropy
    patch -p1 < $srcdir/libressl-entropy-nonsense.patch || exit 1
    ./configure  --prefix=/usr
    make
}

package() {
    cd $srcdir/$pkgname-$pkgver
    make DESTDIR=$pkgdir install
    # Ugly renaming of the libressl manual pages using the scheme of openssl because libressl doesn't provide the MANSUFFIX var yet - Look at the openssl PKGBUILD
    rename ".1" ".1ssl" $pkgdir/usr/share/man/man1/*
    rename ".3" ".3ssl" $pkgdir/usr/share/man/man3/*
    install -D -m644 COPYING $pkgdir/usr/share/licenses/$pkgname/LICENSE
}
