# Contributor: erm67@yahoo.it

pkgname=raceintospace
pkgver=20080418
_dataver=0.4.5
pkgrel=2
pkgdesc="The computer version of the Liftoff! board game by Fritz Bronner"
arch=(i686 x86_64)
url="http://www.raceintospace.org/"
license="GPL"
depends=( 'sdl' 'libvorbis' 'libtheora')
install=(raceintospace.install)
makedepends=('cvs' 'automake' )
source=(http://downloads.sourceforge.net/raceintospace/raceintospace-data-$_dataver.tar.gz
        raceintospace.desktop
        raceintospace.xpm)
md5sums=('618f3d68f6d2d49567b34e09c143221b'
         '39a17f03b2ca5288f2aaeed7854db869'
         '012ea13c5a093b0d59e598e0f35dd0d9')
_cvsroot=":pserver:anonymous:@raceintospace.cvs.sourceforge.net:/cvsroot/raceintospace"
_cvsmod="race"

build() {
  cd $startdir/src
  msg "Connecting to $_cvsmod.sourceforge.net CVS server...."
  if [ -d $_cvsmod/CVS ]; then
    cd $_cvsmod
    cvs -z3 update -d
  else
    cvs -z3 -d $_cvsroot co -D $pkgver -f $_cvsmod
    cd $_cvsmod
  fi
  msg "CVS checkout done or server timeout"
  msg "Starting make..."

  cp -r ../$_cvsmod ../$_cvsmod-build
  cd ../$_cvsmod-build

  sed -i -e 's/-Werror//' Makefile.in 
  aclocal -I m4 --install ||return 1
  autoconf -i ||return 1
  ./configure --prefix=/usr ||return 1
  make ||return 1
  make DESTDIR=${startdir}/pkg/ install ||return 1
  mkdir -p ${startdir}/pkg/usr/share/$pkgname
  mkdir -p ${startdir}/pkg/usr/share/$pkgname/gamedata
  install -D -m644 ${startdir}/src/gamedata/* ${startdir}/pkg/usr/share/$pkgname/gamedata
  mkdir -p ${startdir}/pkg/usr/share/$pkgname/images
  install -D -m644 ${startdir}/src/images/* ${startdir}/pkg/usr/share/$pkgname/images
  cd ..
  for i in `ls -d audio/*`; do
      mkdir -p ${startdir}/pkg/usr/share/$pkgname/$i
      install -D -m644 -t ${startdir}/pkg/usr/share/$pkgname/$i ${startdir}/src/$i/*
  done
  for i in `ls -d video/*`; do
      mkdir -p ${startdir}/pkg/usr/share/$pkgname/$i
      install -D -m644 -t ${startdir}/pkg/usr/share/$pkgname/$i ${startdir}/src/$i/*
  done

  # Install menu shortcut
  mkdir -p ${startdir}/pkg/usr/share/applications
  mkdir -p ${startdir}/pkg/usr/share/pixmaps
  install -D -m644 ${startdir}/src/$pkgname.xpm ${startdir}/pkg/usr/share/pixmaps/$pkgname.xpm
  install -D -m644  ${startdir}/src/$pkgname.desktop ${startdir}/pkg/usr/share/applications/$pkgname.desktop

  rm -R ${startdir}/src/$_cvsmod-build
}
