# $Id: PKGBUILD 170931 2012-11-13 12:56:29Z heftig $
# Maintainer: Jan de Groot  <jgc@archlinux.org>

_pkgname=gnome-weather
pkgname=$_pkgname-git
pkgver=20130320
pkgrel=1
pkgdesc="Access current weather conditions and forecasts"
arch=('i686' 'x86_64')
license=('GPL')
depends=('gjs' 'gtk3' 'glib2')
makedepends=('intltool'  'gobject-introspection' 'git')
options=('!libtool')
url="http://www.gnome.org/"
groups=('gnome-extra')
conflicts=('gnome-weather')
replaces=('gnome-weather')
provides=('gnome-weather' 'gnome-weather=3.7.92')
install=gnome-weather.install

_gitroot=http://git.gnome.org/browse/gnome-weather
_gitname=gnome-weather

build() {
	cd $srcdir
	msg "Connecting to GIT server...."

	if [ -d $srcdir/$_gitname ] ; then
		cd $_gitname && git pull origin
		msg "The local files are updated."
	else
		git clone $_gitroot

		cd $_gitname

		git branch gnome-3-8

		cd ..
	fi

	msg "GIT checkout done or server timeout"
	msg "Starting make..."

	rm -rf "$srcdir/$_gitname-build"
	cp -r "$srcdir/$_gitname" "$srcdir/$_gitname-build"
	cd "$srcdir/$_gitname-build"

	./autogen.sh --prefix=/usr
	make
}

package() {
	cd "$srcdir/$_gitname-build"
	make DESTDIR="$pkgdir" install
	rm -rf "$srcdir/$_gitname-build"
}

