# Maintainer: Adam Hani Schakaki (krzd) <krzd@krzd.net>
# Contributor: Det <nimetonmaili at gmail a-dot com>
# Contributor: Flamelab <panosfilip@gmail.com>

pkgname=gnome-shell
pkgver=2.91.90
_majorver=(`echo $pkgver | egrep -o '[0-9]+\.[0-9]*+'`)
pkgrel=1
pkgdesc="The experimental next generation GNOME Shell for GNOME 3"
arch=('i686' 'x86_64')
url="http://live.gnome.org/GnomeShell"
license=('GPL2')
depends=('dbus-glib' 'dconf' 'gtk3' 'libffi' 'gnome-desktop>=2.91'  'libgnomeui' 'cairo' 'librsvg' 'gnome-python' \
         'python2' 'spidermonkey' 'gnome-menus' 'gnome-control-center>=2.91' 'freetype2' 'gstreamer0.10' 'clutter>=1.6.4' \
         'mutter' 'gjs>=0.7.10' 'gsettings-desktop-schemas>=0.1.5' 'mesa-demos' 'gnome-settings-daemon>=2.91' 'evolution-data-server>=2.91')
makedepends=('xulrunner' 'gnome-common' 'intltool' 'libpulse' 'gnome-doc-utils>=0.12.0' 'gobject-introspection>=0.10')
install=gnome-shell.install
source=("http://ftp.gnome.org/pub/GNOME/sources/$pkgname/$_majorver/$pkgname-$pkgver.tar.bz2")
sha256sums=(`wget ${source/.t*}.sha256sum -qO - | grep tar.bz2 | cut -d " " -f1`)
options=(!libtool !emptydirs)

build() {
  cd "$pkgname-$pkgver"
  msg "Starting configure..."

  ./autogen.sh \
      --prefix=/usr \
      --disable-glibtest \
      --sysconfdir=/etc \
      --enable-compile-warnings=no \
      --enable-dependency-tracking

  sed -i 's/\-Werror//g' configure.ac

  export LD_LIBRARY_PATH=/usr/lib/xulrunner-devel-1.9.*/lib:/usr/lib/libfakeroot

  sed -i 's|^hardcode_libdir_flag_spec=.*|hardcode_libdir_flag_spec=""|g' libtool
  sed -i 's|^runpath_var=LD_RUN_PATH|runpath_var=DIE_RPATH_DIE|g'         libtool

  make
}

package()  {
  cd "$pkgname-$pkgver"
  make GCONF_DISABLE_MAKEFILE_SCHEMA_INSTALL=1 DESTDIR="$pkgdir" install

  sed -i -e "s|/usr/bin/python|/usr/bin/python2|" "${pkgdir}/usr/bin/gnome-shell"

  desktop-file-validate "${pkgdir}/usr/share/applications/gnome-shell.desktop"
}
